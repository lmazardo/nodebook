<?xml version="1.0" encoding="UTF-8"?>
<office:document xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" xmlns:style="urn:oasis:names:tc:opendocument:xmlns:style:1.0" xmlns:text="urn:oasis:names:tc:opendocument:xmlns:text:1.0" xmlns:table="urn:oasis:names:tc:opendocument:xmlns:table:1.0" xmlns:draw="urn:oasis:names:tc:opendocument:xmlns:drawing:1.0" xmlns:fo="urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" xmlns:number="urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0" xmlns:svg="urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0" xmlns:chart="urn:oasis:names:tc:opendocument:xmlns:chart:1.0" xmlns:dr3d="urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0" xmlns:math="http://www.w3.org/1998/Math/MathML" xmlns:form="urn:oasis:names:tc:opendocument:xmlns:form:1.0" xmlns:script="urn:oasis:names:tc:opendocument:xmlns:script:1.0" xmlns:config="urn:oasis:names:tc:opendocument:xmlns:config:1.0" xmlns:ooo="http://openoffice.org/2004/office" xmlns:ooow="http://openoffice.org/2004/writer" xmlns:oooc="http://openoffice.org/2004/calc" xmlns:dom="http://www.w3.org/2001/xml-events" xmlns:xforms="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:rpt="http://openoffice.org/2005/report" xmlns:of="urn:oasis:names:tc:opendocument:xmlns:of:1.2" xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:grddl="http://www.w3.org/2003/g/data-view#" xmlns:officeooo="http://openoffice.org/2009/office" xmlns:tableooo="http://openoffice.org/2009/table" xmlns:drawooo="http://openoffice.org/2010/draw" xmlns:calcext="urn:org:documentfoundation:names:experimental:calc:xmlns:calcext:1.0" xmlns:loext="urn:org:documentfoundation:names:experimental:office:xmlns:loext:1.0" xmlns:field="urn:openoffice:names:experimental:ooo-ms-interop:xmlns:field:1.0" xmlns:formx="urn:openoffice:names:experimental:ooxml-odf-interop:xmlns:form:1.0" xmlns:css3t="http://www.w3.org/TR/css3-text/" office:version="1.2" office:mimetype="application/vnd.oasis.opendocument.text">
  <office:meta>
    <meta:generator>asciidoctor-converter-opendocument</meta:generator>
    <dc:title>Node.js â€¢ Apprendre par la pratique</dc:title>
    <meta:creation-date>2019-04-07 11:38:06 UTC</meta:creation-date>
    <dc:language>fr</dc:language>
    <meta:editing-cycles>1</meta:editing-cycles>
    <meta:editing-duration>P0D</meta:editing-duration>
    <meta:document-statistic meta:character-count="0" meta:image-count="0" meta:non-whitespace-character-count="0" meta:object-count="0" meta:page-count="0" meta:paragraph-count="0" meta:table-count="0" meta:word-count="0"/>
    <meta:user-defined meta:name="Info 1"/>
    <meta:user-defined meta:name="Info 2"/>
    <meta:user-defined meta:name="Info 3"/>
    <meta:user-defined meta:name="Info 4"/>
  </office:meta>
  <office:settings>
  <config:config-item-set config:name="ooo:view-settings">
   <config:config-item config:name="ViewAreaTop" config:type="long">159715</config:config-item>
   <config:config-item config:name="ViewAreaLeft" config:type="long">0</config:config-item>
   <config:config-item config:name="ViewAreaWidth" config:type="long">19773</config:config-item>
   <config:config-item config:name="ViewAreaHeight" config:type="long">11601</config:config-item>
   <config:config-item config:name="ShowRedlineChanges" config:type="boolean">false</config:config-item>
   <config:config-item config:name="InBrowseMode" config:type="boolean">false</config:config-item>
   <config:config-item-map-indexed config:name="Views">
    <config:config-item-map-entry>
     <config:config-item config:name="ViewId" config:type="string">view2</config:config-item>
     <config:config-item config:name="ViewLeft" config:type="long">6055</config:config-item>
     <config:config-item config:name="ViewTop" config:type="long">164093</config:config-item>
     <config:config-item config:name="VisibleLeft" config:type="long">0</config:config-item>
     <config:config-item config:name="VisibleTop" config:type="long">159715</config:config-item>
     <config:config-item config:name="VisibleRight" config:type="long">19771</config:config-item>
     <config:config-item config:name="VisibleBottom" config:type="long">171314</config:config-item>
     <config:config-item config:name="ZoomType" config:type="short">0</config:config-item>
     <config:config-item config:name="ViewLayoutColumns" config:type="short">1</config:config-item>
     <config:config-item config:name="ViewLayoutBookMode" config:type="boolean">false</config:config-item>
     <config:config-item config:name="ZoomFactor" config:type="short">110</config:config-item>
     <config:config-item config:name="IsSelectedFrame" config:type="boolean">false</config:config-item>
     <config:config-item config:name="AnchoredTextOverflowLegacy" config:type="boolean">false</config:config-item>
    </config:config-item-map-entry>
   </config:config-item-map-indexed>
  </config:config-item-set>
  <config:config-item-set config:name="ooo:configuration-settings">
   <config:config-item config:name="PrintControls" config:type="boolean">true</config:config-item>
   <config:config-item config:name="PrintPageBackground" config:type="boolean">true</config:config-item>
   <config:config-item config:name="PrintAnnotationMode" config:type="short">0</config:config-item>
   <config:config-item config:name="PrintGraphics" config:type="boolean">true</config:config-item>
   <config:config-item config:name="PrintLeftPages" config:type="boolean">true</config:config-item>
   <config:config-item config:name="PrintProspect" config:type="boolean">false</config:config-item>
   <config:config-item config:name="PrintRightPages" config:type="boolean">true</config:config-item>
   <config:config-item config:name="PrintFaxName" config:type="string"/>
   <config:config-item config:name="PrintPaperFromSetup" config:type="boolean">false</config:config-item>
   <config:config-item config:name="PrintTextPlaceholder" config:type="boolean">false</config:config-item>
   <config:config-item config:name="DisableOffPagePositioning" config:type="boolean">true</config:config-item>
   <config:config-item config:name="ApplyParagraphMarkFormatToNumbering" config:type="boolean">false</config:config-item>
   <config:config-item config:name="PrintReversed" config:type="boolean">false</config:config-item>
   <config:config-item config:name="TabOverMargin" config:type="boolean">false</config:config-item>
   <config:config-item config:name="EmbedFonts" config:type="boolean">false</config:config-item>
   <config:config-item config:name="SurroundTextWrapSmall" config:type="boolean">false</config:config-item>
   <config:config-item config:name="BackgroundParaOverDrawings" config:type="boolean">false</config:config-item>
   <config:config-item config:name="ClippedPictures" config:type="boolean">false</config:config-item>
   <config:config-item config:name="FloattableNomargins" config:type="boolean">false</config:config-item>
   <config:config-item config:name="UnbreakableNumberings" config:type="boolean">false</config:config-item>
   <config:config-item config:name="EmbedSystemFonts" config:type="boolean">false</config:config-item>
   <config:config-item config:name="TabOverflow" config:type="boolean">false</config:config-item>
   <config:config-item config:name="PrintTables" config:type="boolean">true</config:config-item>
   <config:config-item config:name="PrintSingleJobs" config:type="boolean">false</config:config-item>
   <config:config-item config:name="SmallCapsPercentage66" config:type="boolean">true</config:config-item>
   <config:config-item config:name="CollapseEmptyCellPara" config:type="boolean">true</config:config-item>
   <config:config-item config:name="UseFormerLineSpacing" config:type="boolean">true</config:config-item>
   <config:config-item config:name="ProtectForm" config:type="boolean">false</config:config-item>
   <config:config-item config:name="PrinterSetup" config:type="base64Binary">AAA=</config:config-item>
   <config:config-item config:name="CurrentDatabaseCommand" config:type="string"/>
   <config:config-item config:name="ClipAsCharacterAnchoredWriterFlyFrames" config:type="boolean">false</config:config-item>
   <config:config-item config:name="DoNotCaptureDrawObjsOnPage" config:type="boolean">false</config:config-item>
   <config:config-item config:name="CurrentDatabaseCommandType" config:type="int">0</config:config-item>
   <config:config-item config:name="LoadReadonly" config:type="boolean">false</config:config-item>
   <config:config-item config:name="DoNotResetParaAttrsForNumFont" config:type="boolean">false</config:config-item>
   <config:config-item config:name="StylesNoDefault" config:type="boolean">false</config:config-item>
   <config:config-item config:name="AlignTabStopPosition" config:type="boolean">false</config:config-item>
   <config:config-item config:name="LinkUpdateMode" config:type="short">1</config:config-item>
   <config:config-item config:name="DoNotJustifyLinesWithManualBreak" config:type="boolean">true</config:config-item>
   <config:config-item config:name="RsidRoot" config:type="int">847901</config:config-item>
   <config:config-item config:name="PropLineSpacingShrinksFirstLine" config:type="boolean">false</config:config-item>
   <config:config-item config:name="ConsiderTextWrapOnObjPos" config:type="boolean">false</config:config-item>
   <config:config-item config:name="TabAtLeftIndentForParagraphsInList" config:type="boolean">false</config:config-item>
   <config:config-item config:name="RedlineProtectionKey" config:type="base64Binary"/>
   <config:config-item config:name="UnxForceZeroExtLeading" config:type="boolean">true</config:config-item>
   <config:config-item config:name="PrintDrawings" config:type="boolean">true</config:config-item>
   <config:config-item config:name="UseFormerTextWrapping" config:type="boolean">true</config:config-item>
   <config:config-item config:name="CurrentDatabaseDataSource" config:type="string"/>
   <config:config-item config:name="AllowPrintJobCancel" config:type="boolean">false</config:config-item>
   <config:config-item config:name="SubtractFlysAnchoredAtFlys" config:type="boolean">true</config:config-item>
   <config:config-item config:name="AddParaSpacingToTableCells" config:type="boolean">false</config:config-item>
   <config:config-item config:name="AddExternalLeading" config:type="boolean">false</config:config-item>
   <config:config-item config:name="AddVerticalFrameOffsets" config:type="boolean">false</config:config-item>
   <config:config-item config:name="TreatSingleColumnBreakAsPageBreak" config:type="boolean">false</config:config-item>
   <config:config-item config:name="MathBaselineAlignment" config:type="boolean">false</config:config-item>
   <config:config-item config:name="AddFrameOffsets" config:type="boolean">false</config:config-item>
   <config:config-item config:name="IsLabelDocument" config:type="boolean">false</config:config-item>
   <config:config-item config:name="MsWordCompTrailingBlanks" config:type="boolean">false</config:config-item>
   <config:config-item config:name="IgnoreFirstLineIndentInNumbering" config:type="boolean">true</config:config-item>
   <config:config-item config:name="OutlineLevelYieldsNumbering" config:type="boolean">false</config:config-item>
   <config:config-item config:name="PrinterName" config:type="string"/>
   <config:config-item config:name="IsKernAsianPunctuation" config:type="boolean">false</config:config-item>
   <config:config-item config:name="PrinterIndependentLayout" config:type="string">low-resolution</config:config-item>
   <config:config-item config:name="PrintBlackFonts" config:type="boolean">false</config:config-item>
   <config:config-item config:name="TableRowKeep" config:type="boolean">false</config:config-item>
   <config:config-item config:name="UpdateFromTemplate" config:type="boolean">true</config:config-item>
   <config:config-item config:name="EmbeddedDatabaseName" config:type="string"/>
   <config:config-item config:name="Rsid" config:type="int">973921</config:config-item>
   <config:config-item config:name="TabsRelativeToIndent" config:type="boolean">true</config:config-item>
   <config:config-item config:name="UseOldPrinterMetrics" config:type="boolean">false</config:config-item>
   <config:config-item config:name="IgnoreTabsAndBlanksForLineCalculation" config:type="boolean">false</config:config-item>
   <config:config-item config:name="InvertBorderSpacing" config:type="boolean">false</config:config-item>
   <config:config-item config:name="SaveGlobalDocumentLinks" config:type="boolean">false</config:config-item>
   <config:config-item config:name="PrintProspectRTL" config:type="boolean">false</config:config-item>
   <config:config-item config:name="PrintEmptyPages" config:type="boolean">true</config:config-item>
   <config:config-item config:name="ApplyUserData" config:type="boolean">true</config:config-item>
   <config:config-item config:name="UseOldNumbering" config:type="boolean">true</config:config-item>
   <config:config-item config:name="FieldAutoUpdate" config:type="boolean">true</config:config-item>
   <config:config-item config:name="UseFormerObjectPositioning" config:type="boolean">true</config:config-item>
   <config:config-item config:name="PrintHiddenText" config:type="boolean">false</config:config-item>
   <config:config-item config:name="AddParaTableSpacingAtStart" config:type="boolean">false</config:config-item>
   <config:config-item config:name="CharacterCompressionType" config:type="short">0</config:config-item>
   <config:config-item config:name="SaveVersionOnClose" config:type="boolean">false</config:config-item>
   <config:config-item config:name="ChartAutoUpdate" config:type="boolean">true</config:config-item>
   <config:config-item config:name="AddParaTableSpacing" config:type="boolean">false</config:config-item>
  </config:config-item-set>
 </office:settings>
  
  <office:font-face-decls>
  <style:font-face style:name="StarSymbol" svg:font-family="StarSymbol" style:font-charset="x-symbol"/>
  <style:font-face style:name="Wingdings" svg:font-family="Wingdings" style:font-adornments="Normal" style:font-pitch="variable" style:font-charset="x-symbol"/>
  <style:font-face style:name="Symbol" svg:font-family="Symbol" style:font-adornments="Normal" style:font-family-generic="roman" style:font-pitch="variable" style:font-charset="x-symbol"/>
  <style:font-face style:name="Times New Roman" svg:font-family="&apos;Times New Roman&apos;"/>
  <style:font-face style:name="Courier New" svg:font-family="&apos;Courier New&apos;" style:font-family-generic="modern"/>
  <style:font-face style:name="Courier New1" svg:font-family="&apos;Courier New&apos;" style:font-family-generic="modern" style:font-pitch="fixed"/>
  <style:font-face style:name="Arial Unicode MS" svg:font-family="&apos;Arial Unicode MS&apos;" style:font-pitch="variable"/>
  <style:font-face style:name="Fontin" svg:font-family="Fontin" style:font-adornments="Gras" style:font-pitch="variable"/>
  <style:font-face style:name="Fontin1" svg:font-family="Fontin" style:font-adornments="Italique" style:font-pitch="variable"/>
  <style:font-face style:name="HG Mincho Light J" svg:font-family="&apos;HG Mincho Light J&apos;" style:font-pitch="variable"/>
  <style:font-face style:name="Garamond" svg:font-family="Garamond" style:font-adornments="Normal" style:font-family-generic="roman" style:font-pitch="variable"/>
  <style:font-face style:name="Garamond Book" svg:font-family="&apos;Garamond Book&apos;" style:font-adornments="Normal" style:font-family-generic="roman" style:font-pitch="variable"/>
  <style:font-face style:name="Times New Roman1" svg:font-family="&apos;Times New Roman&apos;" style:font-family-generic="roman" style:font-pitch="variable"/>
  <style:font-face style:name="Arial" svg:font-family="Arial" style:font-family-generic="swiss" style:font-pitch="variable"/>
  <style:font-face style:name="Arial1" svg:font-family="Arial" style:font-adornments="Gras" style:font-family-generic="swiss" style:font-pitch="variable"/>
  <style:font-face style:name="Arial2" svg:font-family="Arial" style:font-adornments="Italique" style:font-family-generic="swiss" style:font-pitch="variable"/>
  <style:font-face style:name="Arial Narrow" svg:font-family="&apos;Arial Narrow&apos;" style:font-family-generic="swiss" style:font-pitch="variable"/>
  <style:font-face style:name="Arial Narrow1" svg:font-family="&apos;Arial Narrow&apos;" style:font-adornments="Normal" style:font-family-generic="swiss" style:font-pitch="variable"/>
  <style:font-face style:name="Arial Rounded MT Bold" svg:font-family="&apos;Arial Rounded MT Bold&apos;, Tahoma" style:font-family-generic="swiss" style:font-pitch="variable"/>
  <style:font-face style:name="Century Gothic" svg:font-family="&apos;Century Gothic&apos;" style:font-family-generic="swiss" style:font-pitch="variable"/>
  <style:font-face style:name="DejaVu Sans" svg:font-family="&apos;DejaVu Sans&apos;" style:font-adornments="Book" style:font-family-generic="swiss" style:font-pitch="variable"/>
  <style:font-face style:name="DejaVu Sans1" svg:font-family="&apos;DejaVu Sans&apos;" style:font-adornments="Oblique" style:font-family-generic="swiss" style:font-pitch="variable"/>
  <style:font-face style:name="DejaVu Sans Condensed1" svg:font-family="&apos;DejaVu Sans Condensed&apos;" style:font-adornments="Book" style:font-family-generic="swiss" style:font-pitch="variable"/>
  <style:font-face style:name="DejaVu Sans Condensed" svg:font-family="&apos;DejaVu Sans Condensed&apos;" style:font-adornments="Gras" style:font-family-generic="swiss" style:font-pitch="variable"/>
  <style:font-face style:name="Tahoma" svg:font-family="Tahoma" style:font-adornments="Italique gras" style:font-family-generic="swiss" style:font-pitch="variable"/>
 </office:font-face-decls>
  <office:styles>
  <style:default-style style:family="graphic">
   <style:graphic-properties svg:stroke-color="#000000" draw:fill-color="#99ccff" fo:wrap-option="no-wrap" draw:shadow-offset-x="0.1181in" draw:shadow-offset-y="0.1181in" draw:start-line-spacing-horizontal="0.1114in" draw:start-line-spacing-vertical="0.1114in" draw:end-line-spacing-horizontal="0.1114in" draw:end-line-spacing-vertical="0.1114in" style:flow-with-text="true"/>
   <style:paragraph-properties style:text-autospace="ideograph-alpha" style:line-break="strict" style:font-independent-line-spacing="false">
    <style:tab-stops/>
   </style:paragraph-properties>
   <style:text-properties fo:color="#000000" style:font-name="Times New Roman" fo:font-size="12pt" fo:language="en" fo:country="US" style:font-name-asian="HG Mincho Light J" style:font-size-asian="12pt" style:language-asian="zxx" style:country-asian="none" style:font-name-complex="Arial Unicode MS" style:font-size-complex="12pt" style:language-complex="zxx" style:country-complex="none"/>
  </style:default-style>
  <style:default-style style:family="paragraph">
   <style:paragraph-properties fo:hyphenation-ladder-count="no-limit" style:text-autospace="ideograph-alpha" style:punctuation-wrap="hanging" style:line-break="strict" style:tab-stop-distance="0.4925in" style:writing-mode="lr-tb"/>
   <style:text-properties fo:color="#000000" style:font-name="Times New Roman" fo:font-size="12pt" fo:language="en" fo:country="US" style:font-name-asian="HG Mincho Light J" style:font-size-asian="12pt" style:language-asian="zxx" style:country-asian="none" style:font-name-complex="Arial Unicode MS" style:font-size-complex="12pt" style:language-complex="zxx" style:country-complex="none" fo:hyphenate="false" fo:hyphenation-remain-char-count="2" fo:hyphenation-push-char-count="2"/>
  </style:default-style>
  <style:default-style style:family="table">
   <style:table-properties table:border-model="separating"/>
  </style:default-style>
  <style:default-style style:family="table-row">
   <style:table-row-properties fo:keep-together="auto"/>
  </style:default-style>
  <style:style style:name="Standard" style:family="paragraph" style:class="text">
   <style:paragraph-properties fo:margin-left="0.5909in" fo:margin-right="0in" fo:margin-top="0.0835in" fo:margin-bottom="0.0138in" loext:contextual-spacing="false" fo:text-align="justify" style:justify-single-word="false" fo:orphans="2" fo:widows="2" fo:text-indent="0.0008in" style:auto-text-indent="false"/>
   <style:text-properties style:use-window-font-color="true" style:font-name="Times New Roman1" fo:font-family="&apos;Times New Roman&apos;" style:font-family-generic="roman" style:font-pitch="variable" fo:font-size="10pt" fo:language="fr" fo:country="FR" style:font-name-asian="Times New Roman1" style:font-family-asian="&apos;Times New Roman&apos;" style:font-family-generic-asian="roman" style:font-pitch-asian="variable" style:font-size-asian="10pt"/>
  </style:style>
  <style:style style:name="Text_20_body" style:display-name="Text body" style:family="paragraph" style:parent-style-name="Standard" style:class="text">
   <style:paragraph-properties fo:margin-top="0in" fo:margin-bottom="0.0835in" loext:contextual-spacing="false"/>
  </style:style>
  <style:style style:name="Heading" style:family="paragraph" style:parent-style-name="Standard" style:next-style-name="Text_20_body" style:class="text">
   <style:paragraph-properties fo:margin-top="0.1665in" fo:margin-bottom="0.0835in" loext:contextual-spacing="false" fo:keep-with-next="always"/>
   <style:text-properties style:font-name="Arial" fo:font-family="Arial" style:font-family-generic="swiss" style:font-pitch="variable" fo:font-size="14pt" style:font-name-asian="HG Mincho Light J" style:font-family-asian="&apos;HG Mincho Light J&apos;" style:font-pitch-asian="variable" style:font-size-asian="14pt" style:font-name-complex="Arial Unicode MS" style:font-family-complex="&apos;Arial Unicode MS&apos;" style:font-pitch-complex="variable" style:font-size-complex="14pt"/>
  </style:style>
  <style:style style:name="Heading_20_1" style:display-name="Heading 1" style:family="paragraph" style:parent-style-name="Standard" style:next-style-name="Standard" style:class="text">
   <style:paragraph-properties fo:margin-top="0.139in" fo:margin-bottom="0.5555in" loext:contextual-spacing="false" fo:text-align="end" style:justify-single-word="false" fo:orphans="2" fo:widows="2" fo:padding-left="0in" fo:padding-right="0in" fo:padding-top="0in" fo:padding-bottom="0.0555in" fo:border-left="none" fo:border-right="none" fo:border-top="none" fo:border-bottom="0.06pt solid #000000"/>
   <style:text-properties style:use-window-font-color="true" style:font-name="Arial" fo:font-family="Arial" style:font-family-generic="swiss" style:font-pitch="variable" fo:font-size="20pt" fo:language="zxx" fo:country="none" fo:font-weight="bold" style:font-name-asian="Times New Roman1" style:font-family-asian="&apos;Times New Roman&apos;" style:font-family-generic-asian="roman" style:font-pitch-asian="variable" style:font-size-asian="20pt" style:language-asian="zxx" style:country-asian="none" style:font-weight-asian="bold"/>
  </style:style>
  <style:style style:name="Heading_20_2" style:display-name="Heading 2" style:family="paragraph" style:parent-style-name="Standard" style:next-style-name="Standard" style:class="text">
   <style:paragraph-properties fo:margin-top="0.3472in" fo:margin-bottom="0.0138in" loext:contextual-spacing="false" fo:keep-together="always" fo:orphans="2" fo:widows="2" fo:keep-with-next="always"/>
   <style:text-properties style:use-window-font-color="true" style:font-name="Arial" fo:font-family="Arial" style:font-family-generic="swiss" style:font-pitch="variable" fo:font-size="14pt" fo:language="zxx" fo:country="none" fo:font-weight="bold" style:font-name-asian="Times New Roman1" style:font-family-asian="&apos;Times New Roman&apos;" style:font-family-generic-asian="roman" style:font-pitch-asian="variable" style:font-size-asian="14pt" style:language-asian="zxx" style:country-asian="none" style:font-weight-asian="bold"/>
  </style:style>
  <style:style style:name="Heading_20_3" style:display-name="Heading 3" style:family="paragraph" style:parent-style-name="Standard" style:next-style-name="Standard" style:class="text">
   <style:paragraph-properties fo:margin-top="0.2083in" fo:margin-bottom="0.0138in" loext:contextual-spacing="false" fo:keep-together="always" fo:orphans="2" fo:widows="2" fo:keep-with-next="always"/>
   <style:text-properties style:use-window-font-color="true" style:font-name="Arial Narrow" fo:font-family="&apos;Arial Narrow&apos;" style:font-family-generic="swiss" style:font-pitch="variable" fo:font-size="13pt" fo:language="fr" fo:country="FR" fo:font-weight="bold" style:font-name-asian="Times New Roman1" style:font-family-asian="&apos;Times New Roman&apos;" style:font-family-generic-asian="roman" style:font-pitch-asian="variable" style:font-size-asian="13pt" style:font-weight-asian="bold"/>
  </style:style>
  <style:style style:name="Heading_20_4" style:display-name="Heading 4" style:family="paragraph" style:parent-style-name="Standard" style:next-style-name="Standard" style:class="text">
   <style:paragraph-properties fo:margin-top="0.139in" fo:margin-bottom="0.0138in" loext:contextual-spacing="false" fo:keep-together="always" fo:orphans="2" fo:widows="2" fo:keep-with-next="always"/>
   <style:text-properties style:use-window-font-color="true" style:font-name="Arial Narrow" fo:font-family="&apos;Arial Narrow&apos;" style:font-family-generic="swiss" style:font-pitch="variable" fo:font-size="11pt" fo:language="zxx" fo:country="none" fo:font-weight="bold" style:font-name-asian="Times New Roman1" style:font-family-asian="&apos;Times New Roman&apos;" style:font-family-generic-asian="roman" style:font-pitch-asian="variable" style:font-size-asian="11pt" style:language-asian="zxx" style:country-asian="none" style:font-weight-asian="bold"/>
  </style:style>
  <style:style style:name="Heading_20_5" style:display-name="Heading 5" style:family="paragraph" style:parent-style-name="Heading_20_4" style:next-style-name="Standard" style:class="text">
   <style:paragraph-properties fo:margin-left="0.5909in" fo:margin-right="0in" fo:margin-top="0.111in" fo:margin-bottom="0.0138in" loext:contextual-spacing="false" fo:text-indent="0.0008in" style:auto-text-indent="false"/>
   <style:text-properties fo:font-style="italic" fo:font-weight="normal" style:font-style-asian="italic" style:font-weight-asian="normal"/>
  </style:style>
  <style:style style:name="Heading_20_6" style:display-name="Heading 6" style:family="paragraph" style:parent-style-name="Standard" style:next-style-name="Standard" style:class="text">
   <style:paragraph-properties fo:margin-top="0.1665in" fo:margin-bottom="0.0417in" loext:contextual-spacing="false"/>
   <style:text-properties style:font-name="Arial" fo:font-family="Arial" style:font-family-generic="swiss" style:font-pitch="variable" style:text-underline-style="solid" style:text-underline-width="auto" style:text-underline-color="font-color"/>
  </style:style>
  <style:style style:name="Heading_20_7" style:display-name="Heading 7" style:family="paragraph" style:parent-style-name="Standard" style:next-style-name="Standard" style:class="text">
   <style:paragraph-properties fo:margin-top="0.1665in" fo:margin-bottom="0.0417in" loext:contextual-spacing="false"/>
   <style:text-properties style:font-name="Arial" fo:font-family="Arial" style:font-family-generic="swiss" style:font-pitch="variable"/>
  </style:style>
  <style:style style:name="Heading_20_8" style:display-name="Heading 8" style:family="paragraph" style:parent-style-name="Standard" style:next-style-name="Standard" style:class="text">
   <style:paragraph-properties fo:margin-top="0.1665in" fo:margin-bottom="0.0417in" loext:contextual-spacing="false"/>
   <style:text-properties style:font-name="Arial" fo:font-family="Arial" style:font-family-generic="swiss" style:font-pitch="variable" fo:font-style="italic" style:font-style-asian="italic"/>
  </style:style>
  <style:style style:name="Heading_20_9" style:display-name="Heading 9" style:family="paragraph" style:parent-style-name="Standard" style:next-style-name="Standard" style:class="text">
   <style:paragraph-properties fo:margin-top="0.1665in" fo:margin-bottom="0.0417in" loext:contextual-spacing="false"/>
   <style:text-properties style:font-name="Arial" fo:font-family="Arial" style:font-family-generic="swiss" style:font-pitch="variable" fo:font-size="9pt" fo:font-style="italic" style:font-size-asian="9pt" style:font-style-asian="italic"/>
  </style:style>
  <style:style style:name="Heading_20_10" style:display-name="Heading 10" style:family="paragraph" style:parent-style-name="Heading" style:next-style-name="Text_20_body" style:class="text">
   <style:text-properties fo:font-size="75%" fo:font-weight="bold" style:font-size-asian="75%" style:font-weight-asian="bold" style:font-size-complex="75%" style:font-weight-complex="bold"/>
  </style:style>
  <style:style style:name="List" style:family="paragraph" style:parent-style-name="Text_20_body" style:class="list">
   <style:text-properties style:font-name="Times New Roman" fo:font-family="&apos;Times New Roman&apos;"/>
  </style:style>
  <style:style style:name="Header" style:family="paragraph" style:parent-style-name="Standard" style:class="extra">
   <style:paragraph-properties fo:margin-left="0.5909in" fo:margin-right="0.0783in" fo:margin-top="0.0835in" fo:margin-bottom="0.0138in" loext:contextual-spacing="false" fo:text-align="end" style:justify-single-word="false" fo:orphans="0" fo:widows="0" fo:text-indent="0.0008in" style:auto-text-indent="false">
    <style:tab-stops>
     <style:tab-stop style:position="0.5409in" style:type="right" style:leader-style="solid" style:leader-text="_"/>
     <style:tab-stop style:position="5.2661in"/>
    </style:tab-stops>
   </style:paragraph-properties>
   <style:text-properties style:font-name="Century Gothic" fo:font-family="&apos;Century Gothic&apos;" style:font-family-generic="swiss" style:font-pitch="variable" fo:font-size="8pt" style:font-size-asian="8pt"/>
  </style:style>
  <style:style style:name="Header_20_left" style:display-name="Header left" style:family="paragraph" style:parent-style-name="Standard" style:class="extra">
   <style:paragraph-properties fo:margin-left="0in" fo:margin-right="0in" fo:text-indent="0in" style:auto-text-indent="false" text:number-lines="false" text:line-number="0">
    <style:tab-stops>
     <style:tab-stop style:position="3.5043in" style:type="center"/>
     <style:tab-stop style:position="7.0083in" style:type="right"/>
    </style:tab-stops>
   </style:paragraph-properties>
   <style:text-properties fo:font-variant="small-caps" style:font-name="DejaVu Sans Condensed" fo:font-family="&apos;DejaVu Sans Condensed&apos;" style:font-style-name="Gras" style:font-family-generic="swiss" style:font-pitch="variable" fo:font-size="10pt" fo:font-weight="bold"/>
  </style:style>
  <style:style style:name="Header_20_right" style:display-name="Header right" style:family="paragraph" style:parent-style-name="Standard" style:class="extra">
   <style:paragraph-properties fo:margin-left="0in" fo:margin-right="0in" fo:text-align="end" style:justify-single-word="false" fo:text-indent="0in" style:auto-text-indent="false" text:number-lines="false" text:line-number="0">
    <style:tab-stops>
     <style:tab-stop style:position="3.5043in" style:type="center"/>
     <style:tab-stop style:position="7.0083in" style:type="right"/>
    </style:tab-stops>
   </style:paragraph-properties>
   <style:text-properties fo:font-variant="small-caps" style:font-name="DejaVu Sans Condensed" fo:font-family="&apos;DejaVu Sans Condensed&apos;" style:font-style-name="Gras" style:font-family-generic="swiss" style:font-pitch="variable" fo:font-size="10pt" fo:font-weight="bold"/>
  </style:style>
  <style:style style:name="Footer" style:family="paragraph" style:parent-style-name="Standard" style:class="extra">
   <style:paragraph-properties>
    <style:tab-stops>
     <style:tab-stop style:position="3.15in" style:type="center"/>
     <style:tab-stop style:position="6.3in" style:type="right"/>
    </style:tab-stops>
   </style:paragraph-properties>
  </style:style>
  <style:style style:name="Footer_20_left" style:display-name="Footer left" style:family="paragraph" style:parent-style-name="Standard" style:class="extra">
   <style:paragraph-properties fo:margin-left="0in" fo:margin-right="0in" fo:text-align="start" style:justify-single-word="false" fo:text-indent="0in" style:auto-text-indent="false" fo:padding="0.0398in" fo:border-left="0.99pt solid #000000" fo:border-right="none" fo:border-top="none" fo:border-bottom="none" style:shadow="none" text:number-lines="false" text:line-number="0">
    <style:tab-stops>
     <style:tab-stop style:position="3.5043in" style:type="center"/>
     <style:tab-stop style:position="7.0083in" style:type="right"/>
    </style:tab-stops>
   </style:paragraph-properties>
   <style:text-properties style:font-name="Fontin" fo:font-family="Fontin" style:font-style-name="Gras" style:font-pitch="variable" fo:font-size="12pt" fo:font-weight="bold"/>
  </style:style>
  <style:style style:name="Footer_20_right" style:display-name="Footer right" style:family="paragraph" style:parent-style-name="Standard" style:class="extra">
   <loext:graphic-properties draw:fill="none" draw:fill-color="#99ccff"/>
   <style:paragraph-properties fo:text-align="end" style:justify-single-word="false" fo:background-color="transparent" fo:padding="0.0398in" fo:border-left="none" fo:border-right="0.99pt solid #000000" fo:border-top="none" fo:border-bottom="none" style:shadow="none" text:number-lines="false" text:line-number="0">
    <style:tab-stops>
     <style:tab-stop style:position="3.5043in" style:type="center"/>
     <style:tab-stop style:position="7.0083in" style:type="right"/>
    </style:tab-stops>
   </style:paragraph-properties>
   <style:text-properties style:font-name="Fontin" fo:font-family="Fontin" style:font-style-name="Gras" style:font-pitch="variable" fo:font-size="12pt" fo:font-weight="bold"/>
  </style:style>
  <style:style style:name="Table_20_Contents" style:display-name="Table Contents" style:family="paragraph" style:parent-style-name="Text_20_body" style:class="extra">
   <style:paragraph-properties text:number-lines="false" text:line-number="0"/>
  </style:style>
  <style:style style:name="Table_20_Heading" style:display-name="Table Heading" style:family="paragraph" style:parent-style-name="Table_20_Contents" style:class="extra">
   <style:paragraph-properties fo:text-align="center" style:justify-single-word="false" text:number-lines="false" text:line-number="0"/>
   <style:text-properties fo:font-style="italic" fo:font-weight="bold" style:font-style-asian="italic" style:font-weight-asian="bold" style:font-style-complex="italic" style:font-weight-complex="bold"/>
  </style:style>
  <style:style style:name="Caption" style:family="paragraph" style:parent-style-name="Standard" style:class="extra">
   <style:paragraph-properties fo:margin-top="0.0835in" fo:margin-bottom="0.0835in" loext:contextual-spacing="false" text:number-lines="false" text:line-number="0"/>
   <style:text-properties style:font-name="Times New Roman" fo:font-family="&apos;Times New Roman&apos;" fo:font-size="10pt" fo:font-style="italic" style:font-size-asian="10pt" style:font-style-asian="italic" style:font-size-complex="10pt" style:font-style-complex="italic"/>
  </style:style>
  <style:style style:name="Frame_20_contents" style:display-name="Frame contents" style:family="paragraph" style:parent-style-name="Text_20_body" style:class="extra">
   <style:paragraph-properties fo:margin-left="0in" fo:margin-right="0in" fo:text-indent="0in" style:auto-text-indent="false"/>
  </style:style>
  <style:style style:name="Footnote" style:family="paragraph" style:parent-style-name="Standard" style:class="extra">
   <style:text-properties fo:font-size="8pt" style:font-size-asian="8pt"/>
  </style:style>
  <style:style style:name="Index" style:family="paragraph" style:parent-style-name="Standard" style:class="index">
   <style:paragraph-properties text:number-lines="false" text:line-number="0"/>
   <style:text-properties style:font-name="Times New Roman" fo:font-family="&apos;Times New Roman&apos;"/>
  </style:style>
  <style:style style:name="Index_20_Heading" style:display-name="Index Heading" style:family="paragraph" style:parent-style-name="Heading" style:class="index">
   <style:paragraph-properties fo:margin-left="0in" fo:margin-right="0in" fo:text-indent="0in" style:auto-text-indent="false" text:number-lines="false" text:line-number="0"/>
   <style:text-properties fo:font-size="16pt" fo:font-weight="bold" style:font-size-asian="16pt" style:font-weight-asian="bold" style:font-size-complex="16pt" style:font-weight-complex="bold"/>
  </style:style>
  <style:style style:name="Index_20_1" style:display-name="Index 1" style:family="paragraph" style:parent-style-name="Standard" style:next-style-name="Standard" style:class="index">
   <style:paragraph-properties fo:margin-left="0.139in" fo:margin-right="0in" fo:margin-top="0.0835in" fo:margin-bottom="0.0138in" loext:contextual-spacing="false" fo:text-indent="-0.139in" style:auto-text-indent="false">
    <style:tab-stops>
     <style:tab-stop style:position="2.0138in" style:type="right"/>
    </style:tab-stops>
   </style:paragraph-properties>
   <style:text-properties fo:font-size="9pt" style:font-size-asian="9pt"/>
  </style:style>
  <style:style style:name="Index_20_2" style:display-name="Index 2" style:family="paragraph" style:parent-style-name="Standard" style:next-style-name="Standard" style:class="index">
   <style:paragraph-properties fo:margin-left="0.278in" fo:margin-right="0in" fo:margin-top="0.0835in" fo:margin-bottom="0.0138in" loext:contextual-spacing="false" fo:text-indent="-0.139in" style:auto-text-indent="false">
    <style:tab-stops>
     <style:tab-stop style:position="2.0138in" style:type="right"/>
    </style:tab-stops>
   </style:paragraph-properties>
   <style:text-properties fo:font-size="9pt" style:font-size-asian="9pt"/>
  </style:style>
  <style:style style:name="Index_20_3" style:display-name="Index 3" style:family="paragraph" style:parent-style-name="Standard" style:next-style-name="Standard" style:class="index">
   <style:paragraph-properties fo:margin-left="0.4165in" fo:margin-right="0in" fo:margin-top="0.0835in" fo:margin-bottom="0.0138in" loext:contextual-spacing="false" fo:text-indent="-0.139in" style:auto-text-indent="false">
    <style:tab-stops>
     <style:tab-stop style:position="2.0138in" style:type="right"/>
    </style:tab-stops>
   </style:paragraph-properties>
   <style:text-properties fo:font-size="9pt" style:font-size-asian="9pt"/>
  </style:style>
  <style:style style:name="Contents_20_Heading" style:display-name="Contents Heading" style:family="paragraph" style:parent-style-name="Heading" style:class="index">
   <style:paragraph-properties fo:margin-left="0in" fo:margin-right="0in" fo:text-indent="0in" style:auto-text-indent="false" text:number-lines="false" text:line-number="0"/>
   <style:text-properties fo:font-size="16pt" fo:font-weight="bold" style:font-size-asian="16pt" style:font-weight-asian="bold" style:font-size-complex="16pt" style:font-weight-complex="bold"/>
  </style:style>
  <style:style style:name="Contents_20_1" style:display-name="Contents 1" style:family="paragraph" style:parent-style-name="Standard" style:next-style-name="Standard" style:class="index">
   <loext:graphic-properties draw:fill="solid" draw:fill-color="#cccccc" draw:opacity="100%"/>
   <style:paragraph-properties fo:margin-left="0in" fo:margin-right="0in" fo:margin-top="0.139in" fo:margin-bottom="0.0693in" loext:contextual-spacing="false" fo:text-align="start" style:justify-single-word="false" fo:keep-together="always" fo:text-indent="0in" style:auto-text-indent="false" fo:background-color="#cccccc" fo:padding-left="0in" fo:padding-right="0in" fo:padding-top="0.0417in" fo:padding-bottom="0.0417in" fo:border-left="none" fo:border-right="none" fo:border-top="0.06pt solid #000000" fo:border-bottom="0.06pt solid #000000" fo:keep-with-next="always">
    <style:tab-stops>
     <style:tab-stop style:position="5.1189in" style:type="right" style:leader-style="dotted" style:leader-text="."/>
    </style:tab-stops>
   </style:paragraph-properties>
   <style:text-properties fo:text-transform="uppercase" style:font-name="Arial" fo:font-family="Arial" style:font-family-generic="swiss" style:font-pitch="variable" fo:font-weight="bold" style:font-weight-asian="bold"/>
  </style:style>
  <style:style style:name="Contents_20_2" style:display-name="Contents 2" style:family="paragraph" style:parent-style-name="Standard" style:next-style-name="Standard" style:class="index">
   <style:paragraph-properties fo:margin-left="0in" fo:margin-right="0in" fo:orphans="2" fo:widows="2" fo:text-indent="0in" style:auto-text-indent="false">
    <style:tab-stops>
     <style:tab-stop style:position="5.1181in" style:type="right" style:leader-style="dotted" style:leader-text="."/>
    </style:tab-stops>
   </style:paragraph-properties>
   <style:text-properties style:use-window-font-color="true" style:font-name="Times New Roman1" fo:font-family="&apos;Times New Roman&apos;" style:font-family-generic="roman" style:font-pitch="variable" fo:font-size="10pt" fo:language="zxx" fo:country="none" fo:font-weight="bold" style:font-name-asian="Times New Roman1" style:font-family-asian="&apos;Times New Roman&apos;" style:font-family-generic-asian="roman" style:font-pitch-asian="variable" style:font-size-asian="10pt" style:language-asian="zxx" style:country-asian="none" style:font-weight-asian="bold"/>
  </style:style>
  <style:style style:name="Contents_20_3" style:display-name="Contents 3" style:family="paragraph" style:parent-style-name="Standard" style:next-style-name="Standard" style:class="index">
   <style:paragraph-properties fo:margin-left="0.1492in" fo:margin-right="0in" fo:orphans="2" fo:widows="2" fo:text-indent="0.0008in" style:auto-text-indent="false">
    <style:tab-stops>
     <style:tab-stop style:position="5.1189in" style:type="right" style:leader-style="dotted" style:leader-text="."/>
    </style:tab-stops>
   </style:paragraph-properties>
   <style:text-properties style:use-window-font-color="true" style:font-name="Times New Roman1" fo:font-family="&apos;Times New Roman&apos;" style:font-family-generic="roman" style:font-pitch="variable" fo:font-size="9pt" fo:language="zxx" fo:country="none" style:font-name-asian="Times New Roman1" style:font-family-asian="&apos;Times New Roman&apos;" style:font-family-generic-asian="roman" style:font-pitch-asian="variable" style:font-size-asian="9pt" style:language-asian="zxx" style:country-asian="none"/>
  </style:style>
  <style:style style:name="Contents_20_4" style:display-name="Contents 4" style:family="paragraph" style:parent-style-name="Standard" style:next-style-name="Standard" style:class="index">
   <style:paragraph-properties fo:margin-left="0.2799in" fo:margin-right="0in" fo:orphans="2" fo:widows="2" fo:text-indent="0.0008in" style:auto-text-indent="false">
    <style:tab-stops>
     <style:tab-stop style:position="5.1189in" style:type="right" style:leader-style="dotted" style:leader-text="."/>
    </style:tab-stops>
   </style:paragraph-properties>
   <style:text-properties style:use-window-font-color="true" style:font-name="Times New Roman1" fo:font-family="&apos;Times New Roman&apos;" style:font-family-generic="roman" style:font-pitch="variable" fo:font-size="9pt" fo:language="zxx" fo:country="none" fo:font-style="normal" style:font-name-asian="Times New Roman1" style:font-family-asian="&apos;Times New Roman&apos;" style:font-family-generic-asian="roman" style:font-pitch-asian="variable" style:font-size-asian="9pt" style:language-asian="zxx" style:country-asian="none" style:font-style-asian="italic"/>
  </style:style>
  <style:style style:name="Contents_20_5" style:display-name="Contents 5" style:family="paragraph" style:parent-style-name="Index" style:class="index">
   <style:paragraph-properties fo:margin-left="0.7862in" fo:margin-right="0in" fo:text-indent="0in" style:auto-text-indent="false">
    <style:tab-stops>
     <style:tab-stop style:position="6.1028in" style:type="right" style:leader-style="dotted" style:leader-text="."/>
    </style:tab-stops>
   </style:paragraph-properties>
  </style:style>
  <style:style style:name="Contents_20_6" style:display-name="Contents 6" style:family="paragraph" style:parent-style-name="Index" style:class="index">
   <style:paragraph-properties fo:margin-left="0.9827in" fo:margin-right="0in" fo:margin-top="0.0043in" fo:margin-bottom="0in" loext:contextual-spacing="false" fo:text-indent="0in" style:auto-text-indent="false">
    <style:tab-stops>
     <style:tab-stop style:position="5.9063in" style:type="right" style:leader-style="dotted" style:leader-text="."/>
    </style:tab-stops>
   </style:paragraph-properties>
   <style:text-properties fo:font-size="9pt" fo:font-style="italic"/>
  </style:style>
  <style:style style:name="Contents_20_7" style:display-name="Contents 7" style:family="paragraph" style:parent-style-name="Index" style:class="index">
   <style:paragraph-properties fo:margin-left="1.1791in" fo:margin-right="0in" fo:text-indent="0in" style:auto-text-indent="false">
    <style:tab-stops>
     <style:tab-stop style:position="5.7098in" style:type="right" style:leader-style="dotted" style:leader-text="."/>
    </style:tab-stops>
   </style:paragraph-properties>
  </style:style>
  <style:style style:name="Contents_20_8" style:display-name="Contents 8" style:family="paragraph" style:parent-style-name="Index" style:class="index">
   <style:paragraph-properties fo:margin-left="1.3756in" fo:margin-right="0in" fo:text-indent="0in" style:auto-text-indent="false">
    <style:tab-stops>
     <style:tab-stop style:position="5.5134in" style:type="right" style:leader-style="dotted" style:leader-text="."/>
    </style:tab-stops>
   </style:paragraph-properties>
  </style:style>
  <style:style style:name="Contents_20_9" style:display-name="Contents 9" style:family="paragraph" style:parent-style-name="Index" style:class="index">
   <style:paragraph-properties fo:margin-left="1.572in" fo:margin-right="0in" fo:text-indent="0in" style:auto-text-indent="false">
    <style:tab-stops>
     <style:tab-stop style:position="5.3165in" style:type="right" style:leader-style="dotted" style:leader-text="."/>
    </style:tab-stops>
   </style:paragraph-properties>
  </style:style>
  <style:style style:name="Contents_20_10" style:display-name="Contents 10" style:family="paragraph" style:parent-style-name="Index" style:class="index">
   <style:paragraph-properties fo:margin-left="1.7689in" fo:margin-right="0in" fo:text-indent="0in" style:auto-text-indent="false">
    <style:tab-stops>
     <style:tab-stop style:position="5.1201in" style:type="right" style:leader-style="dotted" style:leader-text="."/>
    </style:tab-stops>
   </style:paragraph-properties>
  </style:style>
  <style:style style:name="Title" style:family="paragraph" style:parent-style-name="Heading" style:next-style-name="Subtitle" style:class="chapter">
   <style:paragraph-properties fo:text-align="center" style:justify-single-word="false"/>
   <style:text-properties style:font-name="Fontin" fo:font-family="Fontin" style:font-style-name="Gras" style:font-pitch="variable" fo:font-size="20pt" fo:font-weight="bold" style:font-size-asian="18pt" style:font-weight-asian="bold" style:font-size-complex="18pt" style:font-weight-complex="bold"/>
  </style:style>
  <style:style style:name="Subtitle" style:family="paragraph" style:parent-style-name="Heading" style:next-style-name="Text_20_body" style:class="chapter">
   <style:paragraph-properties fo:text-align="center" style:justify-single-word="false"/>
   <style:text-properties fo:font-size="14pt" fo:font-style="italic" style:font-size-asian="14pt" style:font-style-asian="italic" style:font-size-complex="14pt" style:font-style-complex="italic"/>
  </style:style>
  <style:style style:name="Code" style:family="paragraph">
   <style:paragraph-properties fo:margin-left="0.0398in" fo:margin-right="1.0236in" fo:margin-top="0in" fo:margin-bottom="0in" loext:contextual-spacing="false" fo:line-height="0.139in" fo:orphans="2" fo:widows="2" fo:text-indent="0in" style:auto-text-indent="false" style:border-line-width-left="0.0008in 0.0346in 0.0346in" fo:padding-left="0.0555in" fo:padding-right="0in" fo:padding-top="0in" fo:padding-bottom="0in" fo:border-left="5.05pt double #c0c0c0" fo:border-right="none" fo:border-top="none" fo:border-bottom="none">
    <style:tab-stops>
     <style:tab-stop style:position="0.3937in"/>
     <style:tab-stop style:position="0.5909in"/>
     <style:tab-stop style:position="0.7874in"/>
     <style:tab-stop style:position="0.9846in"/>
     <style:tab-stop style:position="1.1811in"/>
     <style:tab-stop style:position="1.3783in"/>
     <style:tab-stop style:position="1.5752in"/>
     <style:tab-stop style:position="1.772in"/>
     <style:tab-stop style:position="1.9689in"/>
     <style:tab-stop style:position="2.1661in"/>
     <style:tab-stop style:position="2.3626in"/>
     <style:tab-stop style:position="2.5598in"/>
     <style:tab-stop style:position="2.7563in"/>
     <style:tab-stop style:position="2.9535in"/>
     <style:tab-stop style:position="3.15in"/>
     <style:tab-stop style:position="3.3472in"/>
     <style:tab-stop style:position="3.5437in"/>
     <style:tab-stop style:position="3.7409in"/>
     <style:tab-stop style:position="3.9374in"/>
     <style:tab-stop style:position="4.1346in"/>
    </style:tab-stops>
   </style:paragraph-properties>
   <style:text-properties style:use-window-font-color="true" style:font-name="Courier New" fo:font-family="&apos;Courier New&apos;" style:font-family-generic="modern" fo:font-size="8pt" fo:language="fr" fo:country="FR" style:font-name-asian="Times New Roman1" style:font-family-asian="&apos;Times New Roman&apos;" style:font-family-generic-asian="roman" style:font-pitch-asian="variable" style:font-size-asian="8pt"/>
  </style:style>
  <style:style style:name="FigureEmplacement" style:family="paragraph" style:parent-style-name="TexteCourant" style:next-style-name="FigureNumero">
   <style:paragraph-properties fo:margin-top="0.2083in" fo:margin-bottom="0.2083in" loext:contextual-spacing="false" fo:text-align="center" style:justify-single-word="false" fo:orphans="2" fo:widows="2"/>
   <style:text-properties style:use-window-font-color="true" style:font-name="Times New Roman1" fo:font-family="&apos;Times New Roman&apos;" style:font-family-generic="roman" style:font-pitch="variable" fo:font-size="10pt" fo:language="zxx" fo:country="none" style:font-name-asian="Times New Roman1" style:font-family-asian="&apos;Times New Roman&apos;" style:font-family-generic-asian="roman" style:font-pitch-asian="variable" style:font-size-asian="10pt" style:language-asian="zxx" style:country-asian="none"/>
  </style:style>
  <style:style style:name="TexteCourant" style:family="paragraph">
   <style:paragraph-properties fo:margin-left="0in" fo:margin-right="0in" fo:margin-top="0.0835in" fo:margin-bottom="0.0138in" loext:contextual-spacing="false" fo:text-align="justify" style:justify-single-word="false" fo:orphans="2" fo:widows="2" fo:hyphenation-ladder-count="no-limit" fo:text-indent="0in" style:auto-text-indent="false"/>
   <style:text-properties style:use-window-font-color="true" style:font-name="Garamond" fo:font-family="Garamond" style:font-style-name="Normal" style:font-family-generic="roman" style:font-pitch="variable" fo:font-size="10.5pt" fo:language="fr" fo:country="FR" style:font-name-asian="Times New Roman1" style:font-family-asian="&apos;Times New Roman&apos;" style:font-family-generic-asian="roman" style:font-pitch-asian="variable" style:font-size-asian="10pt" fo:hyphenate="true" fo:hyphenation-remain-char-count="2" fo:hyphenation-push-char-count="2"/>
  </style:style>
  <style:style style:name="FigureNumero" style:family="paragraph" style:parent-style-name="TexteCourant" style:next-style-name="FigureLegende">
   <style:paragraph-properties fo:margin-top="0.3937in" fo:margin-bottom="0in" loext:contextual-spacing="false" fo:text-align="center" style:justify-single-word="false"/>
   <style:text-properties fo:color="#808080" style:font-name="DejaVu Sans" fo:font-family="&apos;DejaVu Sans&apos;" style:font-style-name="Book" style:font-family-generic="swiss" style:font-pitch="variable" fo:font-size="7pt" style:font-weight-asian="bold"/>
  </style:style>
  <style:style style:name="FigureLegende" style:family="paragraph" style:parent-style-name="TexteCourant" style:next-style-name="TexteCourant" style:default-outline-level="8">
   <style:paragraph-properties fo:margin-top="0.0827in" fo:margin-bottom="0.3937in" loext:contextual-spacing="false" fo:text-align="center" style:justify-single-word="false"/>
   <style:text-properties style:font-name="DejaVu Sans1" fo:font-family="&apos;DejaVu Sans&apos;" style:font-style-name="Oblique" style:font-family-generic="swiss" style:font-pitch="variable" fo:font-size="7pt" fo:font-style="italic"/>
  </style:style>
  <style:style style:name="ChapitreIntroduction" style:family="paragraph" style:parent-style-name="TexteCourant" style:next-style-name="ListeAPuce">
   <style:paragraph-properties fo:margin-left="0.1965in" fo:margin-right="0in" fo:text-indent="0in" style:auto-text-indent="false" fo:break-after="page"/>
   <style:text-properties fo:color="#000000" style:font-name="Garamond Book" fo:font-family="&apos;Garamond Book&apos;" style:font-style-name="Normal" style:font-family-generic="roman" style:font-pitch="variable" fo:font-size="10pt" fo:language="fr" fo:country="CA" fo:font-weight="normal" style:font-name-asian="Times New Roman1" style:font-family-asian="&apos;Times New Roman&apos;" style:font-family-generic-asian="roman" style:font-pitch-asian="variable" style:font-size-asian="9pt"/>
  </style:style>
  <style:style style:name="ListeAPuce" style:family="paragraph" style:parent-style-name="TexteCourant" style:list-style-name="List_20_1">
   <style:paragraph-properties fo:margin-left="0.3543in" fo:margin-right="0in" fo:margin-top="0.0398in" fo:margin-bottom="0in" loext:contextual-spacing="false" fo:text-indent="0in" style:auto-text-indent="false"/>
  </style:style>
  <style:style style:name="ListeAPuce2eNiveau" style:family="paragraph" style:parent-style-name="TexteCourant" style:list-style-name="List_20_4">
   <style:paragraph-properties fo:margin-left="0.5902in" fo:margin-right="0in" fo:margin-top="0in" fo:margin-bottom="0in" loext:contextual-spacing="false" fo:text-indent="0in" style:auto-text-indent="false"/>
  </style:style>
  <style:style style:name="ListeSuite" style:family="paragraph" style:parent-style-name="TexteCourant">
   <style:paragraph-properties fo:margin-left="0.9839in" fo:margin-right="2.5591in" fo:margin-top="0in" fo:margin-bottom="0in" loext:contextual-spacing="false" fo:text-indent="0in" style:auto-text-indent="false"/>
  </style:style>
  <style:style style:name="ChapitreTitre" style:family="paragraph" style:next-style-name="ChapitreIntroduction" style:default-outline-level="1">
   <loext:graphic-properties draw:fill="solid" draw:fill-color="#e6e6e6" draw:opacity="100%"/>
   <style:paragraph-properties fo:margin-top="0.5835in" fo:margin-bottom="0.3335in" loext:contextual-spacing="false" fo:text-align="end" style:justify-single-word="false" fo:orphans="2" fo:widows="2" fo:background-color="#e6e6e6" fo:padding-left="0in" fo:padding-right="0in" fo:padding-top="0in" fo:padding-bottom="0.0138in" fo:border-left="none" fo:border-right="none" fo:border-top="none" fo:border-bottom="0.06pt solid #000000" style:shadow="none"/>
   <style:text-properties style:use-window-font-color="true" style:font-name="Fontin" fo:font-family="Fontin" style:font-style-name="Gras" style:font-pitch="variable" fo:font-size="28pt" fo:language="fr" fo:country="FR" fo:font-weight="bold" style:font-name-asian="Times New Roman1" style:font-family-asian="&apos;Times New Roman&apos;" style:font-family-generic-asian="roman" style:font-pitch-asian="variable" style:font-size-asian="20pt" style:font-weight-asian="bold"/>
  </style:style>
  <style:style style:name="ChapitreNumero" style:family="paragraph" style:next-style-name="ChapitreTitre">
   <loext:graphic-properties draw:fill="solid" draw:fill-color="#e6e6e6" draw:opacity="100%"/>
   <style:paragraph-properties fo:margin-top="0.6945in" fo:margin-bottom="0.278in" loext:contextual-spacing="false" fo:text-align="end" style:justify-single-word="false" fo:orphans="2" fo:widows="2" fo:break-before="page" fo:background-color="#e6e6e6" fo:padding="0in" fo:border="none" style:shadow="none"/>
   <style:text-properties fo:font-variant="small-caps" style:use-window-font-color="true" style:font-name="Fontin" fo:font-family="Fontin" style:font-style-name="Gras" style:font-pitch="variable" fo:font-size="60pt" fo:language="zxx" fo:country="none" fo:font-weight="bold" style:font-name-asian="Times New Roman1" style:font-family-asian="&apos;Times New Roman&apos;" style:font-family-generic-asian="roman" style:font-pitch-asian="variable" style:font-size-asian="48pt" style:language-asian="zxx" style:country-asian="none" style:font-weight-asian="bold"/>
  </style:style>
  <style:style style:name="PartieTitre" style:family="paragraph" style:next-style-name="Standard">
   <style:paragraph-properties fo:margin-top="0.8335in" fo:margin-bottom="0.4165in" loext:contextual-spacing="false" fo:text-align="center" style:justify-single-word="false" fo:orphans="2" fo:widows="2"/>
   <style:text-properties style:use-window-font-color="true" style:font-name="Arial Rounded MT Bold" fo:font-family="&apos;Arial Rounded MT Bold&apos;, Tahoma" style:font-family-generic="swiss" style:font-pitch="variable" fo:font-size="36pt" fo:language="zxx" fo:country="none" fo:font-weight="bold" style:font-name-asian="Times New Roman1" style:font-family-asian="&apos;Times New Roman&apos;" style:font-family-generic-asian="roman" style:font-pitch-asian="variable" style:font-size-asian="36pt" style:language-asian="zxx" style:country-asian="none" style:font-weight-asian="bold"/>
  </style:style>
  <style:style style:name="PartieNumero" style:family="paragraph" style:parent-style-name="ChapitreNumero" style:next-style-name="Standard">
   <style:paragraph-properties fo:text-align="center" style:justify-single-word="false" fo:padding-left="0in" fo:padding-right="0in" fo:padding-top="0.111in" fo:padding-bottom="0in" fo:border-left="none" fo:border-right="none" fo:border-top="4.99pt solid #000000" fo:border-bottom="none"/>
   <style:text-properties fo:font-size="22pt" fo:font-weight="normal" style:font-size-asian="22pt" style:font-weight-asian="normal"/>
  </style:style>
  <style:style style:name="Remarque" style:family="paragraph" style:next-style-name="Standard">
   <loext:graphic-properties draw:fill="none" draw:fill-color="#99ccff"/>
   <style:paragraph-properties fo:margin-left="0.5902in" fo:margin-right="0in" fo:margin-top="0.0783in" fo:margin-bottom="0in" loext:contextual-spacing="false" fo:text-align="justify" style:justify-single-word="false" fo:orphans="2" fo:widows="2" fo:text-indent="0in" style:auto-text-indent="false" fo:background-color="transparent" fo:padding="0.0783in" fo:border-left="2.49pt solid #4c4c4c" fo:border-right="none" fo:border-top="none" fo:border-bottom="none" style:shadow="none"/>
   <style:text-properties style:use-window-font-color="true" style:font-name="DejaVu Sans Condensed1" fo:font-family="&apos;DejaVu Sans Condensed&apos;" style:font-style-name="Book" style:font-family-generic="swiss" style:font-pitch="variable" fo:font-size="8pt" fo:language="fr" fo:country="CA" style:font-name-asian="Times New Roman1" style:font-family-asian="&apos;Times New Roman&apos;" style:font-family-generic-asian="roman" style:font-pitch-asian="variable" style:font-size-asian="9pt"/>
  </style:style>
  <style:style style:name="RemarqueTitre" style:family="paragraph" style:parent-style-name="Remarque" style:next-style-name="Remarque" style:default-outline-level="7">
   <style:paragraph-properties fo:margin-left="0.5902in" fo:margin-right="0in" fo:margin-top="0.1102in" fo:margin-bottom="0.0783in" loext:contextual-spacing="false" fo:text-indent="0in" style:auto-text-indent="false" fo:padding="0in" fo:border="none" fo:keep-with-next="always"/>
   <style:text-properties fo:color="#4c4c4c" fo:font-weight="bold" style:font-weight-asian="bold"/>
  </style:style>
  <style:style style:name="RemarqueURL" style:family="paragraph" style:parent-style-name="Remarque" style:next-style-name="Remarque" style:list-style-name="List_20_2"/>
  <style:style style:name="RemarqueLivre" style:family="paragraph" style:parent-style-name="Remarque" style:next-style-name="Remarque" style:list-style-name="List_20_3"/>
  <style:style style:name="RemarquePuce" style:family="paragraph" style:parent-style-name="Remarque" style:list-style-name="List_20_1">
   <style:paragraph-properties fo:margin-left="0.5902in" fo:margin-right="0in" fo:margin-top="0.0398in" fo:margin-bottom="0in" loext:contextual-spacing="false" fo:text-indent="0in" style:auto-text-indent="false"/>
  </style:style>
  <style:style style:name="RemarqueNumero" style:family="paragraph" style:parent-style-name="Remarque">
   <style:paragraph-properties fo:margin-left="0.8661in" fo:margin-right="0.3937in" fo:margin-top="0.0398in" fo:margin-bottom="0in" loext:contextual-spacing="false" fo:text-indent="-0.2362in" style:auto-text-indent="false">
    <style:tab-stops/>
   </style:paragraph-properties>
  </style:style>
  <style:style style:name="RemarqueCode" style:family="paragraph" style:parent-style-name="Remarque">
   <style:paragraph-properties fo:text-align="start" style:justify-single-word="false"/>
   <style:text-properties style:font-name="Courier New" fo:font-family="&apos;Courier New&apos;" style:font-family-generic="modern" fo:font-size="8pt"/>
  </style:style>
  <style:style style:name="REMARQUE2Titre" style:family="paragraph" style:parent-style-name="REMARQUE2" style:next-style-name="REMARQUE2" style:default-outline-level="6">
   <style:paragraph-properties fo:margin-left="0in" fo:margin-right="0in" fo:text-indent="0in" style:auto-text-indent="false"/>
   <style:text-properties fo:font-weight="bold" style:font-weight-asian="bold"/>
  </style:style>
  <style:style style:name="REMARQUE2URL" style:family="paragraph" style:parent-style-name="REMARQUE2" style:list-style-name="List_20_2"/>
  <style:style style:name="REMARQUE2Puce" style:family="paragraph" style:parent-style-name="RemarquePuce" style:list-style-name="List_20_1">
   <style:paragraph-properties fo:margin-left="0in" fo:margin-right="0.0008in" fo:margin-top="0.0398in" fo:margin-bottom="0in" loext:contextual-spacing="false" fo:text-indent="0in" style:auto-text-indent="false"/>
   <style:text-properties fo:font-size="10pt"/>
  </style:style>
  <style:style style:name="REMARQUE2Numero" style:family="paragraph" style:parent-style-name="RemarqueNumero">
   <style:paragraph-properties fo:margin-left="0.2362in" fo:margin-right="0in" fo:margin-top="0.0398in" fo:margin-bottom="0in" loext:contextual-spacing="false" fo:text-indent="-0.2362in" style:auto-text-indent="false">
    <style:tab-stops/>
   </style:paragraph-properties>
   <style:text-properties fo:font-size="10pt"/>
  </style:style>
  <style:style style:name="RetraitSousListe1" style:family="paragraph">
   <style:paragraph-properties fo:margin-left="0.7874in" fo:margin-right="0in" fo:margin-top="0.0417in" fo:margin-bottom="0.0138in" loext:contextual-spacing="false" fo:orphans="2" fo:widows="2" fo:text-indent="0.0008in" style:auto-text-indent="false"/>
   <style:text-properties style:use-window-font-color="true" style:font-name="Times New Roman1" fo:font-family="&apos;Times New Roman&apos;" style:font-family-generic="roman" style:font-pitch="variable" fo:font-size="10pt" fo:language="fr" fo:country="FR" style:font-name-asian="Times New Roman1" style:font-family-asian="&apos;Times New Roman&apos;" style:font-family-generic-asian="roman" style:font-pitch-asian="variable" style:font-size-asian="10pt"/>
  </style:style>
  <style:style style:name="TableauTexte" style:family="paragraph">
   <style:paragraph-properties fo:margin-top="0.028in" fo:margin-bottom="0.0138in" loext:contextual-spacing="false" fo:line-height="0.139in" fo:keep-together="always" fo:orphans="0" fo:widows="0">
    <style:tab-stops>
     <style:tab-stop style:position="0.1972in"/>
     <style:tab-stop style:position="0.3154in"/>
     <style:tab-stop style:position="0.4335in"/>
    </style:tab-stops>
   </style:paragraph-properties>
   <style:text-properties style:use-window-font-color="true" style:font-name="Arial" fo:font-family="Arial" style:font-family-generic="swiss" style:font-pitch="variable" fo:font-size="8pt" fo:language="zxx" fo:country="none" style:font-name-asian="Times New Roman1" style:font-family-asian="&apos;Times New Roman&apos;" style:font-family-generic-asian="roman" style:font-pitch-asian="variable" style:font-size-asian="8pt" style:language-asian="zxx" style:country-asian="none"/>
  </style:style>
  <style:style style:name="TableauTitre" style:family="paragraph" style:parent-style-name="TexteCourant">
   <style:paragraph-properties fo:text-align="start" style:justify-single-word="false" fo:keep-together="always" fo:keep-with-next="always"/>
   <style:text-properties style:font-name="Fontin1" fo:font-family="Fontin" style:font-style-name="Italique" style:font-pitch="variable" fo:font-size="9pt" fo:font-style="italic" fo:font-weight="normal" style:font-size-asian="9pt" style:font-weight-asian="bold"/>
  </style:style>
  <style:style style:name="TableauTitreColonne" style:family="paragraph" style:next-style-name="TableauTexte">
   <style:paragraph-properties fo:margin-top="0.028in" fo:margin-bottom="0.028in" loext:contextual-spacing="false" fo:text-align="start" style:justify-single-word="false" fo:keep-together="always" fo:orphans="2" fo:widows="2" fo:keep-with-next="always"/>
   <style:text-properties style:use-window-font-color="true" style:font-name="DejaVu Sans Condensed" fo:font-family="&apos;DejaVu Sans Condensed&apos;" style:font-style-name="Gras" style:font-family-generic="swiss" style:font-pitch="variable" fo:font-size="9pt" fo:language="zxx" fo:country="none" fo:font-weight="bold" style:font-name-asian="Times New Roman1" style:font-family-asian="&apos;Times New Roman&apos;" style:font-family-generic-asian="roman" style:font-pitch-asian="variable" style:font-size-asian="9pt" style:language-asian="zxx" style:country-asian="none" style:font-weight-asian="bold"/>
  </style:style>
  <style:style style:name="CodeTableauCommentaireMarge" style:family="paragraph" style:parent-style-name="Remarque">
   <style:paragraph-properties fo:margin-left="0in" fo:margin-right="0in" fo:margin-top="0in" fo:margin-bottom="0in" loext:contextual-spacing="false" fo:text-align="start" style:justify-single-word="false" fo:text-indent="0.0008in" style:auto-text-indent="false"/>
  </style:style>
  <style:style style:name="TitreNiveau1" style:family="paragraph" style:next-style-name="TexteCourant" style:default-outline-level="2">
   <style:paragraph-properties fo:margin-left="-0.7874in" fo:margin-right="0in" fo:margin-top="0.3335in" fo:margin-bottom="0in" loext:contextual-spacing="false" fo:orphans="2" fo:widows="2" fo:text-indent="0in" style:auto-text-indent="false" fo:keep-with-next="always"/>
   <style:text-properties fo:color="#000080" style:font-name="Fontin" fo:font-family="Fontin" style:font-style-name="Gras" style:font-pitch="variable" fo:font-size="16pt" fo:language="fr" fo:country="FR" fo:font-weight="bold" style:font-name-asian="Times New Roman1" style:font-family-asian="&apos;Times New Roman&apos;" style:font-family-generic-asian="roman" style:font-pitch-asian="variable" style:font-size-asian="14pt" style:font-weight-asian="bold"/>
  </style:style>
  <style:style style:name="TitreNiveau2" style:family="paragraph" style:next-style-name="TexteCourant" style:default-outline-level="3">
   <style:paragraph-properties fo:margin-top="0.2083in" fo:margin-bottom="0in" loext:contextual-spacing="false" fo:orphans="2" fo:widows="2" fo:keep-with-next="always"/>
   <style:text-properties fo:color="#000080" style:font-name="Fontin" fo:font-family="Fontin" style:font-style-name="Gras" style:font-pitch="variable" fo:font-size="14pt" fo:language="fr" fo:country="FR" fo:font-weight="bold" style:font-name-asian="Times New Roman1" style:font-family-asian="&apos;Times New Roman&apos;" style:font-family-generic-asian="roman" style:font-pitch-asian="variable" style:font-size-asian="14pt" style:font-weight-asian="bold"/>
  </style:style>
  <style:style style:name="TitreNiveau3" style:family="paragraph" style:next-style-name="TexteCourant" style:default-outline-level="4">
   <style:paragraph-properties fo:margin-top="0.1665in" fo:margin-bottom="0in" loext:contextual-spacing="false" fo:orphans="2" fo:widows="2" fo:keep-with-next="always"/>
   <style:text-properties fo:color="#000080" style:font-name="Fontin" fo:font-family="Fontin" style:font-style-name="Gras" style:font-pitch="variable" fo:font-size="12pt" fo:language="fr" fo:country="FR" fo:font-weight="bold" style:font-name-asian="Times New Roman1" style:font-family-asian="&apos;Times New Roman&apos;" style:font-family-generic-asian="roman" style:font-pitch-asian="variable" style:font-size-asian="12pt" style:font-weight-asian="bold"/>
  </style:style>
  <style:style style:name="TitreNiveau4" style:family="paragraph" style:parent-style-name="TitreNiveau3" style:next-style-name="TexteCourant" style:default-outline-level="5">
   <style:paragraph-properties fo:margin-left="0.3937in" fo:margin-right="0in" fo:margin-top="0.111in" fo:margin-bottom="0in" loext:contextual-spacing="false" fo:text-indent="0.0008in" style:auto-text-indent="false"/>
   <style:text-properties fo:font-style="italic" fo:font-weight="normal" style:font-style-asian="italic" style:font-weight-asian="normal"/>
  </style:style>
  <style:style style:name="TableauCorps" style:family="paragraph">
   <style:paragraph-properties fo:margin-top="0.028in" fo:margin-bottom="0.0138in" loext:contextual-spacing="false" fo:line-height="0.139in" fo:keep-together="always" fo:orphans="0" fo:widows="0">
    <style:tab-stops>
     <style:tab-stop style:position="0.1972in"/>
     <style:tab-stop style:position="0.3154in"/>
     <style:tab-stop style:position="0.4335in"/>
    </style:tab-stops>
   </style:paragraph-properties>
   <style:text-properties style:use-window-font-color="true" style:font-name="DejaVu Sans Condensed1" fo:font-family="&apos;DejaVu Sans Condensed&apos;" style:font-style-name="Book" style:font-family-generic="swiss" style:font-pitch="variable" fo:font-size="8pt" fo:language="zxx" fo:country="none" style:font-name-asian="Times New Roman1" style:font-family-asian="&apos;Times New Roman&apos;" style:font-family-generic-asian="roman" style:font-pitch-asian="variable" style:font-size-asian="8pt" style:language-asian="zxx" style:country-asian="none"/>
  </style:style>
  <style:style style:name="CodeTableau" style:family="paragraph" style:parent-style-name="Code">
   <style:paragraph-properties fo:margin-left="0in" fo:margin-right="0in" fo:text-indent="0in" style:auto-text-indent="false"/>
  </style:style>
  <style:style style:name="CodeTitre" style:family="paragraph" style:parent-style-name="Code">
   <style:paragraph-properties fo:margin-left="0in" fo:margin-right="0in" fo:margin-top="0.1575in" fo:margin-bottom="0.0783in" loext:contextual-spacing="false" fo:text-indent="0in" style:auto-text-indent="false" fo:padding="0in" fo:border="none"/>
   <style:text-properties style:font-name="Arial1" fo:font-family="Arial" style:font-style-name="Gras" style:font-family-generic="swiss" style:font-pitch="variable" fo:font-size="9pt" style:text-underline-style="solid" style:text-underline-width="auto" style:text-underline-color="font-color" fo:font-weight="bold"/>
  </style:style>
  <style:style style:name="REMARQUE2" style:family="paragraph" style:parent-style-name="Remarque">
   <style:paragraph-properties fo:margin-left="0in" fo:margin-right="2.7563in" fo:margin-top="0.0398in" fo:margin-bottom="0in" loext:contextual-spacing="false" fo:text-indent="0in" style:auto-text-indent="false" style:shadow="none">
    <style:tab-stops/>
   </style:paragraph-properties>
   <style:text-properties style:font-name="Arial Narrow1" fo:font-family="&apos;Arial Narrow&apos;" style:font-style-name="Normal" style:font-family-generic="swiss" style:font-pitch="variable" fo:font-size="10pt"/>
  </style:style>
  <style:style style:name="REMARQUE2Code" style:family="paragraph" style:parent-style-name="REMARQUE2">
   <style:paragraph-properties fo:text-align="start" style:justify-single-word="false"/>
   <style:text-properties style:font-name="Courier New" fo:font-family="&apos;Courier New&apos;" style:font-family-generic="modern" fo:font-size="10pt"/>
  </style:style>
  <style:style style:name="REMARQUE2FigureNumero" style:family="paragraph" style:parent-style-name="FigureNumero" style:next-style-name="REMARQUE2FigureLegende">
   <style:paragraph-properties fo:margin-left="0in" fo:margin-right="0in" fo:text-indent="0in" style:auto-text-indent="false"/>
  </style:style>
  <style:style style:name="REMARQUE2FigureLegende" style:family="paragraph" style:parent-style-name="FigureLegende" style:next-style-name="REMARQUE2" style:default-outline-level="" style:list-style-name="">
   <style:paragraph-properties fo:margin-left="0in" fo:margin-right="0in" fo:text-indent="0in" style:auto-text-indent="false"/>
  </style:style>
  <style:style style:name="RemarqueFigureLegende" style:family="paragraph" style:parent-style-name="FigureLegende" style:next-style-name="Remarque" style:default-outline-level="" style:list-style-name=""/>
  <style:style style:name="RemarqueFigureNumero" style:family="paragraph" style:parent-style-name="FigureNumero" style:next-style-name="RemarqueFigureLegende"/>
  <style:style style:name="CodeCommentaireMarge" style:family="paragraph" style:parent-style-name="Remarque">
   <style:paragraph-properties fo:margin-left="0in" fo:margin-right="0in" fo:margin-top="0in" fo:margin-bottom="0in" loext:contextual-spacing="false" fo:text-indent="0.0008in" style:auto-text-indent="false"/>
  </style:style>
  <style:style style:name="ListeANumero" style:family="paragraph" style:parent-style-name="TexteCourant">
   <style:paragraph-properties fo:margin-left="0.3937in" fo:margin-right="0in" fo:margin-top="0.0398in" fo:margin-bottom="0in" loext:contextual-spacing="false" fo:text-indent="-0.248in" style:auto-text-indent="false">
    <style:tab-stops/>
   </style:paragraph-properties>
  </style:style>
  <style:style style:name="Ancre" style:family="paragraph" style:parent-style-name="TexteCourant" style:next-style-name="TexteCourant"/>
  <style:style style:name="Footnote_20_Symbol" style:display-name="Footnote Symbol" style:family="text">
   <style:text-properties style:text-position="37% 100%" fo:font-size="8pt" style:font-size-asian="8pt"/>
  </style:style>
  <style:style style:name="Page_20_Number" style:display-name="Page Number" style:family="text"/>
  <style:style style:name="Numbering_20_Symbols" style:display-name="Numbering Symbols" style:family="text"/>
  <style:style style:name="Bullet_20_Symbols" style:display-name="Bullet Symbols" style:family="text">
   <style:text-properties style:font-name="StarSymbol" fo:font-family="StarSymbol" style:font-charset="x-symbol" fo:font-size="9pt" style:font-name-asian="StarSymbol" style:font-family-asian="StarSymbol" style:font-charset-asian="x-symbol" style:font-size-asian="9pt" style:font-name-complex="StarSymbol" style:font-family-complex="StarSymbol" style:font-charset-complex="x-symbol" style:font-size-complex="9pt"/>
  </style:style>
  <style:style style:name="Internet_20_link" style:display-name="Internet link" style:family="text">
   <style:text-properties fo:color="#000080" style:text-underline-style="solid" style:text-underline-width="auto" style:text-underline-color="font-color"/>
  </style:style>
  <style:style style:name="Visited_20_Internet_20_Link" style:display-name="Visited Internet Link" style:family="text">
   <style:text-properties fo:color="#800000" style:text-underline-style="solid" style:text-underline-width="auto" style:text-underline-color="font-color"/>
  </style:style>
  <style:style style:name="Endnote_20_Symbol" style:display-name="Endnote Symbol" style:family="text"/>
  <style:style style:name="Line_20_numbering" style:display-name="Line numbering" style:family="text"/>
  <style:style style:name="Source_20_Text" style:display-name="Source Text" style:family="text">
   <style:text-properties style:font-name="Courier New1" fo:font-family="&apos;Courier New&apos;" style:font-family-generic="modern" style:font-pitch="fixed" style:font-name-asian="Courier New1" style:font-family-asian="&apos;Courier New&apos;" style:font-family-generic-asian="modern" style:font-pitch-asian="fixed" style:font-name-complex="Courier New1" style:font-family-complex="&apos;Courier New&apos;" style:font-family-generic-complex="modern" style:font-pitch-complex="fixed"/>
  </style:style>
  <style:style style:name="CodeDansTexte" style:family="text">
   <style:text-properties fo:color="#000080" style:font-name="Courier New" fo:font-family="&apos;Courier New&apos;" style:font-family-generic="modern" fo:font-size="8pt" fo:language="zxx" fo:country="none" style:font-size-asian="8pt" style:language-asian="zxx" style:country-asian="none"/>
  </style:style>
  <style:style style:name="RemarquePreTitre" style:family="text">
   <style:text-properties fo:font-variant="small-caps" style:use-window-font-color="true" style:font-name="DejaVu Sans Condensed1" fo:font-family="&apos;DejaVu Sans Condensed&apos;" style:font-style-name="Book" style:font-family-generic="swiss" style:font-pitch="variable" fo:font-size="9pt" style:text-underline-style="none"/>
  </style:style>
  <style:style style:name="URL" style:family="text">
   <style:text-properties style:font-name="Arial" fo:font-family="Arial" style:font-family-generic="swiss" style:font-pitch="variable" fo:font-size="8pt" style:font-size-asian="8pt"/>
  </style:style>
  <style:style style:name="CodeExergue" style:family="text">
   <style:text-properties fo:color="#000080" style:font-name="Courier New" fo:font-family="&apos;Courier New&apos;" style:font-family-generic="modern" fo:font-size="8pt" fo:language="zxx" fo:country="none" fo:font-weight="bold" style:font-weight-asian="bold"/>
  </style:style>
  <style:style style:name="CodeCommentaire" style:family="text">
   <style:text-properties fo:color="#808080" style:font-name="Courier New" fo:font-family="&apos;Courier New&apos;" style:font-family-generic="modern" fo:font-size="8pt"/>
  </style:style>
  <style:style style:name="Menu" style:family="text">
   <style:text-properties fo:color="#5c8526" style:font-name="Tahoma" fo:font-family="Tahoma" style:font-style-name="Italique gras" style:font-family-generic="swiss" style:font-pitch="variable" fo:font-size="7pt" fo:language="fr" fo:country="FR" fo:font-style="normal" fo:font-weight="bold"/>
  </style:style>
  <style:style style:name="Numero" style:family="text">
   <style:text-properties style:font-name="Arial1" fo:font-family="Arial" style:font-style-name="Gras" style:font-family-generic="swiss" style:font-pitch="variable" fo:font-size="8pt" fo:font-weight="bold" fo:background-color="transparent"/>
  </style:style>
  <style:style style:name="Hidden" style:family="text">
   <style:text-properties fo:color="#008080" style:font-name="Arial Narrow" fo:font-family="&apos;Arial Narrow&apos;" style:font-family-generic="swiss" style:font-pitch="variable" fo:font-size="7pt" fo:background-color="transparent"/>
  </style:style>
  <style:style style:name="Warning" style:family="text">
   <style:text-properties fo:color="#ff0000"/>
  </style:style>
  <style:style style:name="Symbol" style:family="text">
   <style:text-properties style:font-name="Symbol" fo:font-family="Symbol" style:font-style-name="Normal" style:font-family-generic="roman" style:font-pitch="variable" style:font-charset="x-symbol" fo:font-size="9pt"/>
  </style:style>
  <style:style style:name="WingDings" style:family="text">
   <style:text-properties style:font-name="Wingdings" fo:font-family="Wingdings" style:font-style-name="Normal" style:font-pitch="variable" style:font-charset="x-symbol" fo:font-size="9pt"/>
  </style:style>
  <style:style style:name="PuceCode" style:family="text">
   <style:text-properties fo:color="#ffffff" style:font-name="Arial1" fo:font-family="Arial" style:font-style-name="Gras" style:font-family-generic="swiss" style:font-pitch="variable" fo:font-size="8pt" fo:font-weight="bold" fo:background-color="#b80047"/>
  </style:style>
  <style:style style:name="Frame" style:family="graphic">
   <style:graphic-properties text:anchor-type="paragraph" svg:x="0in" svg:y="0in" style:wrap="parallel" style:number-wrapped-paragraphs="no-limit" style:wrap-contour="false" style:vertical-pos="top" style:vertical-rel="paragraph-content" style:horizontal-pos="center" style:horizontal-rel="paragraph-content"/>
  </style:style>
  <style:style style:name="Graphics" style:family="graphic">
   <style:graphic-properties text:anchor-type="paragraph" svg:x="0in" svg:y="0in" style:wrap="none" style:vertical-pos="top" style:vertical-rel="paragraph" style:horizontal-pos="center" style:horizontal-rel="paragraph"/>
  </style:style>
  <style:style style:name="OLE" style:family="graphic">
   <style:graphic-properties text:anchor-type="paragraph" svg:x="0in" svg:y="0in" style:wrap="none" style:vertical-pos="top" style:vertical-rel="paragraph" style:horizontal-pos="center" style:horizontal-rel="paragraph"/>
  </style:style>
  <style:style style:name="CadreSimple" style:family="graphic" style:parent-style-name="Frame">
   <style:graphic-properties svg:width="2.2835in" fo:min-height="0.472in" text:anchor-type="paragraph" svg:x="1.0634in" svg:y="0in" fo:margin-top="0.0783in" fo:margin-bottom="0in" style:wrap="none" style:vertical-pos="top" style:vertical-rel="paragraph-content" style:horizontal-pos="from-left" style:horizontal-rel="page-content" fo:background-color="transparent" draw:fill="none" draw:fill-color="#99ccff" fo:padding-left="0in" fo:padding-right="0in" fo:padding-top="0.028in" fo:padding-bottom="0.028in" fo:border-left="none" fo:border-right="none" fo:border-top="0.99pt solid #808080" fo:border-bottom="0.99pt solid #808080">
    <style:columns fo:column-count="1" fo:column-gap="0in"/>
   </style:graphic-properties>
  </style:style>
  <style:style style:name="CadrePrincipale" style:family="graphic" style:parent-style-name="Frame">
   <style:graphic-properties svg:width="4.4098in" fo:min-height="0.7874in" text:anchor-type="paragraph" svg:x="0in" svg:y="0in" fo:margin-top="0.1575in" fo:margin-bottom="0in" style:wrap="none" style:vertical-pos="top" style:vertical-rel="paragraph-content" style:horizontal-pos="left" style:horizontal-rel="paragraph" fo:padding="0.0591in" fo:border="0.06pt solid #808080">
    <style:columns fo:column-count="1" fo:column-gap="0in"/>
   </style:graphic-properties>
  </style:style>
  <style:style style:name="CadreEncadre" style:family="graphic" style:parent-style-name="CadreSimple">
   <style:graphic-properties svg:width="2.2835in" fo:min-height="0.472in" text:anchor-type="paragraph" fo:margin-left="0in" fo:margin-right="0in" style:wrap="none" fo:padding="0.0591in" fo:border="0.99pt solid #808080"/>
  </style:style>
  <style:style style:name="CadrePleinePage" style:family="graphic" style:parent-style-name="CadrePrincipale">
   <style:graphic-properties svg:width="7.0075in" fo:min-height="1.5752in" text:anchor-type="paragraph" fo:margin-top="0.0984in" fo:margin-bottom="0.0984in" fo:background-color="transparent" draw:fill="none" draw:fill-color="#99ccff" fo:padding-left="0in" fo:padding-right="0in" fo:padding-top="0.0591in" fo:padding-bottom="0.0591in" fo:border="0.06pt solid #808080">
    <style:columns fo:column-count="2" fo:column-gap="0.2362in">
     <style:column style:rel-width="32767*" fo:start-indent="0in" fo:end-indent="0.1181in"/>
     <style:column style:rel-width="32768*" fo:start-indent="0.1181in" fo:end-indent="0in"/>
    </style:columns>
   </style:graphic-properties>
  </style:style>
  <style:style style:name="CadreInLine" style:family="graphic" style:parent-style-name="Frame">
   <style:graphic-properties svg:width="0.7874in" fo:min-height="0.1181in" text:anchor-type="paragraph" svg:y="0in" fo:margin-left="0.0398in" fo:margin-right="0.0398in" style:vertical-pos="top" style:vertical-rel="paragraph-content" fo:background-color="transparent" draw:fill="none" draw:fill-color="#99ccff">
    <style:columns fo:column-count="1" fo:column-gap="0in"/>
   </style:graphic-properties>
  </style:style>
  <style:style style:name="CadreEncadreMarge" style:family="graphic" style:parent-style-name="CadreEncadre">
   <style:graphic-properties svg:width="2.2835in" fo:min-height="0.472in" text:anchor-type="paragraph" svg:x="1.0634in" style:wrap="left" style:number-wrapped-paragraphs="1" style:wrap-contour="false" style:horizontal-pos="right" style:horizontal-rel="page-content" fo:background-color="transparent" draw:fill="none" draw:fill-color="#99ccff" fo:padding="0.0193in" fo:border="0.99pt solid #808080">
    <style:columns fo:column-count="1" fo:column-gap="0in"/>
   </style:graphic-properties>
  </style:style>
  <style:style style:name="CadreSimpleMarge" style:family="graphic" style:parent-style-name="CadreSimple">
   <style:graphic-properties svg:width="2.2835in" fo:min-height="0.472in" text:anchor-type="paragraph" svg:x="1.0634in" style:wrap="left" style:number-wrapped-paragraphs="1" style:wrap-contour="false" style:horizontal-pos="right" style:horizontal-rel="page-content"/>
  </style:style>
  <style:style style:name="Figure" style:family="graphic" style:parent-style-name="CadreEncadre">
   <style:graphic-properties svg:width="4.4098in" fo:min-height="0.7874in" text:anchor-type="paragraph" svg:x="0in" svg:y="0in" fo:margin-left="0in" fo:margin-right="0in" fo:margin-top="0.1575in" fo:margin-bottom="0in" style:wrap="none" style:vertical-pos="top" style:vertical-rel="paragraph-content" style:horizontal-pos="left" style:horizontal-rel="paragraph" fo:background-color="transparent" draw:fill="none" draw:fill-color="#99ccff" fo:padding="0in" fo:border="none">
    <style:columns fo:column-count="1" fo:column-gap="0in"/>
   </style:graphic-properties>
  </style:style>
  <text:outline-style style:name="Outline">
   <text:outline-level-style text:level="1" style:num-format="">
    <style:list-level-properties/>
   </text:outline-level-style>
   <text:outline-level-style text:level="2" style:num-format="">
    <style:list-level-properties/>
   </text:outline-level-style>
   <text:outline-level-style text:level="3" style:num-format="">
    <style:list-level-properties/>
   </text:outline-level-style>
   <text:outline-level-style text:level="4" style:num-format="">
    <style:list-level-properties/>
   </text:outline-level-style>
   <text:outline-level-style text:level="5" style:num-format="">
    <style:list-level-properties/>
   </text:outline-level-style>
   <text:outline-level-style text:level="6" style:num-format="">
    <style:list-level-properties/>
   </text:outline-level-style>
   <text:outline-level-style text:level="7" style:num-format="">
    <style:list-level-properties/>
   </text:outline-level-style>
   <text:outline-level-style text:level="8" style:num-format="">
    <style:list-level-properties/>
   </text:outline-level-style>
   <text:outline-level-style text:level="9" style:num-format="">
    <style:list-level-properties/>
   </text:outline-level-style>
   <text:outline-level-style text:level="10" style:num-format="">
    <style:list-level-properties/>
   </text:outline-level-style>
  </text:outline-style>
  <text:list-style style:name="List_20_1" style:display-name="List 1">
   <text:list-level-style-bullet text:level="1" text:style-name="Numbering_20_Symbols" text:bullet-char="â€¢">
    <style:list-level-properties text:min-label-width="0.1575in"/>
    <style:text-properties style:font-name="StarSymbol"/>
   </text:list-level-style-bullet>
   <text:list-level-style-bullet text:level="2" text:style-name="Numbering_20_Symbols" text:bullet-char="â€¢">
    <style:list-level-properties text:space-before="0.1579in" text:min-label-width="0.1575in"/>
    <style:text-properties style:font-name="StarSymbol"/>
   </text:list-level-style-bullet>
   <text:list-level-style-bullet text:level="3" text:style-name="Numbering_20_Symbols" text:bullet-char="â€¢">
    <style:list-level-properties text:space-before="0.3146in" text:min-label-width="0.1575in"/>
    <style:text-properties style:font-name="StarSymbol"/>
   </text:list-level-style-bullet>
   <text:list-level-style-bullet text:level="4" text:style-name="Numbering_20_Symbols" text:bullet-char="â€¢">
    <style:list-level-properties text:space-before="0.4724in" text:min-label-width="0.1575in"/>
    <style:text-properties style:font-name="StarSymbol"/>
   </text:list-level-style-bullet>
   <text:list-level-style-bullet text:level="5" text:style-name="Numbering_20_Symbols" text:bullet-char="â€¢">
    <style:list-level-properties text:space-before="0.6299in" text:min-label-width="0.1575in"/>
    <style:text-properties style:font-name="StarSymbol"/>
   </text:list-level-style-bullet>
   <text:list-level-style-bullet text:level="6" text:style-name="Numbering_20_Symbols" text:bullet-char="â€¢">
    <style:list-level-properties text:space-before="0.7878in" text:min-label-width="0.1575in"/>
    <style:text-properties style:font-name="StarSymbol"/>
   </text:list-level-style-bullet>
   <text:list-level-style-bullet text:level="7" text:style-name="Numbering_20_Symbols" text:bullet-char="â€¢">
    <style:list-level-properties text:space-before="0.9445in" text:min-label-width="0.1575in"/>
    <style:text-properties style:font-name="StarSymbol"/>
   </text:list-level-style-bullet>
   <text:list-level-style-bullet text:level="8" text:style-name="Numbering_20_Symbols" text:bullet-char="â€¢">
    <style:list-level-properties text:space-before="1.1024in" text:min-label-width="0.1575in"/>
    <style:text-properties style:font-name="StarSymbol"/>
   </text:list-level-style-bullet>
   <text:list-level-style-bullet text:level="9" text:style-name="Numbering_20_Symbols" text:bullet-char="â€¢">
    <style:list-level-properties text:space-before="1.2598in" text:min-label-width="0.1575in"/>
    <style:text-properties style:font-name="StarSymbol"/>
   </text:list-level-style-bullet>
   <text:list-level-style-bullet text:level="10" text:style-name="Numbering_20_Symbols" text:bullet-char="â€¢">
    <style:list-level-properties text:space-before="1.4177in" text:min-label-width="0.1575in"/>
    <style:text-properties style:font-name="StarSymbol"/>
   </text:list-level-style-bullet>
  </text:list-style>
  <text:list-style style:name="List_20_2" style:display-name="List 2">
   <text:list-level-style-bullet text:level="1" text:style-name="Numbering_20_Symbols" text:bullet-char="&gt;">
    <style:list-level-properties text:min-label-width="0.1575in"/>
    <style:text-properties style:font-name="Arial Narrow"/>
   </text:list-level-style-bullet>
   <text:list-level-style-bullet text:level="2" text:style-name="Numbering_20_Symbols" text:bullet-char="â€“">
    <style:list-level-properties text:space-before="0.1181in" text:min-label-width="0.1181in"/>
    <style:text-properties style:font-name="StarSymbol"/>
   </text:list-level-style-bullet>
   <text:list-level-style-bullet text:level="3" text:style-name="Numbering_20_Symbols" text:bullet-char="â€“">
    <style:list-level-properties text:space-before="0.2362in" text:min-label-width="0.1181in"/>
    <style:text-properties style:font-name="StarSymbol"/>
   </text:list-level-style-bullet>
   <text:list-level-style-bullet text:level="4" text:style-name="Numbering_20_Symbols" text:bullet-char="â€“">
    <style:list-level-properties text:space-before="0.3539in" text:min-label-width="0.1181in"/>
    <style:text-properties style:font-name="StarSymbol"/>
   </text:list-level-style-bullet>
   <text:list-level-style-bullet text:level="5" text:style-name="Numbering_20_Symbols" text:bullet-char="â€“">
    <style:list-level-properties text:space-before="0.472in" text:min-label-width="0.1181in"/>
    <style:text-properties style:font-name="StarSymbol"/>
   </text:list-level-style-bullet>
   <text:list-level-style-bullet text:level="6" text:style-name="Numbering_20_Symbols" text:bullet-char="â€“">
    <style:list-level-properties text:space-before="0.5902in" text:min-label-width="0.1181in"/>
    <style:text-properties style:font-name="StarSymbol"/>
   </text:list-level-style-bullet>
   <text:list-level-style-bullet text:level="7" text:style-name="Numbering_20_Symbols" text:bullet-char="â€“">
    <style:list-level-properties text:space-before="0.7091in" text:min-label-width="0.1181in"/>
    <style:text-properties style:font-name="StarSymbol"/>
   </text:list-level-style-bullet>
   <text:list-level-style-bullet text:level="8" text:style-name="Numbering_20_Symbols" text:bullet-char="â€“">
    <style:list-level-properties text:space-before="0.8272in" text:min-label-width="0.1181in"/>
    <style:text-properties style:font-name="StarSymbol"/>
   </text:list-level-style-bullet>
   <text:list-level-style-bullet text:level="9" text:style-name="Numbering_20_Symbols" text:bullet-char="â€“">
    <style:list-level-properties text:space-before="0.9453in" text:min-label-width="0.1181in"/>
    <style:text-properties style:font-name="StarSymbol"/>
   </text:list-level-style-bullet>
   <text:list-level-style-bullet text:level="10" text:style-name="Numbering_20_Symbols" text:bullet-char="â€“">
    <style:list-level-properties text:space-before="1.063in" text:min-label-width="0.1181in"/>
    <style:text-properties style:font-name="StarSymbol"/>
   </text:list-level-style-bullet>
  </text:list-style>
  <text:list-style style:name="List_20_3" style:display-name="List 3">
   <text:list-level-style-bullet text:level="1" text:style-name="Numbering_20_Symbols" text:bullet-char="=">
    <style:list-level-properties text:min-label-width="0.1575in"/>
    <style:text-properties style:font-name="Arial Narrow"/>
   </text:list-level-style-bullet>
   <text:list-level-style-bullet text:level="2" text:style-name="Numbering_20_Symbols" text:bullet-char="â–¡">
    <style:list-level-properties text:space-before="0.1555in" text:min-label-width="0.1555in"/>
    <style:text-properties style:font-name="StarSymbol"/>
   </text:list-level-style-bullet>
   <text:list-level-style-bullet text:level="3" text:style-name="Numbering_20_Symbols" text:bullet-char="â˜‘">
    <style:list-level-properties text:min-label-width="0.1555in"/>
    <style:text-properties style:font-name="StarSymbol"/>
   </text:list-level-style-bullet>
   <text:list-level-style-bullet text:level="4" text:style-name="Numbering_20_Symbols" text:bullet-char="â–¡">
    <style:list-level-properties text:space-before="0.1555in" text:min-label-width="0.1555in"/>
    <style:text-properties style:font-name="StarSymbol"/>
   </text:list-level-style-bullet>
   <text:list-level-style-bullet text:level="5" text:style-name="Numbering_20_Symbols" text:bullet-char="â˜‘">
    <style:list-level-properties text:min-label-width="0.1555in"/>
    <style:text-properties style:font-name="StarSymbol"/>
   </text:list-level-style-bullet>
   <text:list-level-style-bullet text:level="6" text:style-name="Numbering_20_Symbols" text:bullet-char="â–¡">
    <style:list-level-properties text:space-before="0.1555in" text:min-label-width="0.1555in"/>
    <style:text-properties style:font-name="StarSymbol"/>
   </text:list-level-style-bullet>
   <text:list-level-style-bullet text:level="7" text:style-name="Numbering_20_Symbols" text:bullet-char="â˜‘">
    <style:list-level-properties text:min-label-width="0.1555in"/>
    <style:text-properties style:font-name="StarSymbol"/>
   </text:list-level-style-bullet>
   <text:list-level-style-bullet text:level="8" text:style-name="Numbering_20_Symbols" text:bullet-char="â–¡">
    <style:list-level-properties text:space-before="0.1555in" text:min-label-width="0.1555in"/>
    <style:text-properties style:font-name="StarSymbol"/>
   </text:list-level-style-bullet>
   <text:list-level-style-bullet text:level="9" text:style-name="Numbering_20_Symbols" text:bullet-char="â˜‘">
    <style:list-level-properties text:min-label-width="0.1555in"/>
    <style:text-properties style:font-name="StarSymbol"/>
   </text:list-level-style-bullet>
   <text:list-level-style-bullet text:level="10" text:style-name="Numbering_20_Symbols" text:bullet-char="â–¡">
    <style:list-level-properties text:space-before="0.1555in" text:min-label-width="0.1555in"/>
    <style:text-properties style:font-name="StarSymbol"/>
   </text:list-level-style-bullet>
  </text:list-style>
  <text:list-style style:name="List_20_4" style:display-name="List 4">
   <text:list-level-style-bullet text:level="1" text:style-name="Bullet_20_Symbols" text:bullet-char="â€¢">
    <style:list-level-properties text:min-label-width="0.1575in"/>
    <style:text-properties style:font-name="StarSymbol"/>
   </text:list-level-style-bullet>
   <text:list-level-style-bullet text:level="2" text:style-name="Bullet_20_Symbols" text:bullet-char="â€¢">
    <style:list-level-properties text:space-before="0.1579in" text:min-label-width="0.1575in"/>
    <style:text-properties style:font-name="StarSymbol"/>
   </text:list-level-style-bullet>
   <text:list-level-style-bullet text:level="3" text:style-name="Bullet_20_Symbols" text:bullet-char="â€¢">
    <style:list-level-properties text:space-before="0.3146in" text:min-label-width="0.1575in"/>
    <style:text-properties style:font-name="StarSymbol"/>
   </text:list-level-style-bullet>
   <text:list-level-style-bullet text:level="4" text:style-name="Bullet_20_Symbols" text:bullet-char="â€¢">
    <style:list-level-properties text:space-before="0.4724in" text:min-label-width="0.1575in"/>
    <style:text-properties style:font-name="StarSymbol"/>
   </text:list-level-style-bullet>
   <text:list-level-style-bullet text:level="5" text:style-name="Bullet_20_Symbols" text:bullet-char="â€¢">
    <style:list-level-properties text:space-before="0.6299in" text:min-label-width="0.1575in"/>
    <style:text-properties style:font-name="StarSymbol"/>
   </text:list-level-style-bullet>
   <text:list-level-style-bullet text:level="6" text:style-name="Bullet_20_Symbols" text:bullet-char="â€¢">
    <style:list-level-properties text:space-before="0.7878in" text:min-label-width="0.1575in"/>
    <style:text-properties style:font-name="StarSymbol"/>
   </text:list-level-style-bullet>
   <text:list-level-style-bullet text:level="7" text:style-name="Bullet_20_Symbols" text:bullet-char="â€¢">
    <style:list-level-properties text:space-before="0.9445in" text:min-label-width="0.1575in"/>
    <style:text-properties style:font-name="StarSymbol"/>
   </text:list-level-style-bullet>
   <text:list-level-style-bullet text:level="8" text:style-name="Bullet_20_Symbols" text:bullet-char="â€¢">
    <style:list-level-properties text:space-before="1.1024in" text:min-label-width="0.1575in"/>
    <style:text-properties style:font-name="StarSymbol"/>
   </text:list-level-style-bullet>
   <text:list-level-style-bullet text:level="9" text:style-name="Bullet_20_Symbols" text:bullet-char="â€¢">
    <style:list-level-properties text:space-before="1.2598in" text:min-label-width="0.1575in"/>
    <style:text-properties style:font-name="StarSymbol"/>
   </text:list-level-style-bullet>
   <text:list-level-style-bullet text:level="10" text:style-name="Bullet_20_Symbols" text:bullet-char="â€¢">
    <style:list-level-properties text:space-before="1.4177in" text:min-label-width="0.1575in"/>
    <style:text-properties style:font-name="StarSymbol"/>
   </text:list-level-style-bullet>
  </text:list-style>
  <text:list-style style:name="NumList1" text:consecutive-numbering="true">
   <text:list-level-style-number text:level="1" style:num-suffix="." style:num-format="1">
    <style:list-level-properties text:space-before="0.2563in" text:min-label-width="0.248in"/>
   </text:list-level-style-number>
   <text:list-level-style-number text:level="2" style:num-suffix="." style:num-format="a" style:num-letter-sync="true">
    <style:list-level-properties text:space-before="0.5118in" text:min-label-width="0.25in"/>
   </text:list-level-style-number>
   <text:list-level-style-number text:level="3" style:num-suffix="." style:num-format="i">
    <style:list-level-properties text:space-before="0.7874in" text:min-label-width="0.1252in" fo:text-align="end"/>
   </text:list-level-style-number>
   <text:list-level-style-number text:level="4" style:num-suffix="." style:num-format="1">
    <style:list-level-properties text:space-before="1.0429in" text:min-label-width="0.25in"/>
   </text:list-level-style-number>
   <text:list-level-style-number text:level="5" style:num-suffix="." style:num-format="a" style:num-letter-sync="true">
    <style:list-level-properties text:space-before="1.2992in" text:min-label-width="0.25in"/>
   </text:list-level-style-number>
   <text:list-level-style-number text:level="6" style:num-suffix="." style:num-format="i">
    <style:list-level-properties text:space-before="1.5748in" text:min-label-width="0.1252in" fo:text-align="end"/>
   </text:list-level-style-number>
   <text:list-level-style-number text:level="7" style:num-suffix="." style:num-format="1">
    <style:list-level-properties text:space-before="1.8307in" text:min-label-width="0.25in"/>
   </text:list-level-style-number>
   <text:list-level-style-number text:level="8" style:num-suffix="." style:num-format="a" style:num-letter-sync="true">
    <style:list-level-properties text:space-before="2.0866in" text:min-label-width="0.25in"/>
   </text:list-level-style-number>
   <text:list-level-style-number text:level="9" style:num-suffix="." style:num-format="i">
    <style:list-level-properties text:space-before="0.0028in" text:min-label-width="0.1252in" fo:text-align="end"/>
   </text:list-level-style-number>
   <text:list-level-style-number text:level="10" style:num-suffix="." style:num-format="1">
    <style:list-level-properties text:space-before="3.0118in" text:min-label-width="0.1965in"/>
   </text:list-level-style-number>
  </text:list-style>
  <text:list-style style:name="NumList2" text:consecutive-numbering="true">
   <text:list-level-style-number text:level="1" style:num-suffix="." style:num-format="1">
    <style:list-level-properties text:min-label-width="0.248in"/>
   </text:list-level-style-number>
   <text:list-level-style-number text:level="2" style:num-suffix="." style:num-format="1">
    <style:list-level-properties text:space-before="0.1972in" text:min-label-width="0.1965in"/>
   </text:list-level-style-number>
   <text:list-level-style-number text:level="3" style:num-suffix="." style:num-format="1">
    <style:list-level-properties text:space-before="0.3937in" text:min-label-width="0.1965in"/>
   </text:list-level-style-number>
   <text:list-level-style-number text:level="4" style:num-suffix="." style:num-format="1">
    <style:list-level-properties text:space-before="0.5909in" text:min-label-width="0.1965in"/>
   </text:list-level-style-number>
   <text:list-level-style-number text:level="5" style:num-suffix="." style:num-format="1">
    <style:list-level-properties text:space-before="0.7874in" text:min-label-width="0.1965in"/>
   </text:list-level-style-number>
   <text:list-level-style-number text:level="6" style:num-suffix="." style:num-format="1">
    <style:list-level-properties text:space-before="0.9846in" text:min-label-width="0.1965in"/>
   </text:list-level-style-number>
   <text:list-level-style-number text:level="7" style:num-suffix="." style:num-format="1">
    <style:list-level-properties text:space-before="1.1815in" text:min-label-width="0.1965in"/>
   </text:list-level-style-number>
   <text:list-level-style-number text:level="8" style:num-suffix="." style:num-format="1">
    <style:list-level-properties text:space-before="1.3787in" text:min-label-width="0.1965in"/>
   </text:list-level-style-number>
   <text:list-level-style-number text:level="9" style:num-suffix="." style:num-format="1">
    <style:list-level-properties text:space-before="1.5752in" text:min-label-width="0.1965in"/>
   </text:list-level-style-number>
   <text:list-level-style-number text:level="10" style:num-suffix="." style:num-format="1">
    <style:list-level-properties text:space-before="1.7724in" text:min-label-width="0.1965in"/>
   </text:list-level-style-number>
  </text:list-style>
  <text:list-style style:name="WW8Num10" text:consecutive-numbering="true">
   <text:list-level-style-number text:level="1" style:num-suffix="." style:num-format="1">
    <style:list-level-properties text:space-before="0.5909in" text:min-label-width="0.248in"/>
   </text:list-level-style-number>
   <text:list-level-style-number text:level="2" style:num-suffix="." style:num-format="a" style:num-letter-sync="true">
    <style:list-level-properties text:space-before="1.3409in" text:min-label-width="0.25in"/>
   </text:list-level-style-number>
   <text:list-level-style-number text:level="3" style:num-suffix="." style:num-format="i">
    <style:list-level-properties text:space-before="1.9657in" text:min-label-width="0.1252in" fo:text-align="end"/>
   </text:list-level-style-number>
   <text:list-level-style-number text:level="4" style:num-suffix="." style:num-format="1">
    <style:list-level-properties text:space-before="2.3409in" text:min-label-width="0.25in"/>
   </text:list-level-style-number>
   <text:list-level-style-number text:level="5" style:num-suffix="." style:num-format="a" style:num-letter-sync="true">
    <style:list-level-properties text:space-before="2.8409in" text:min-label-width="0.25in"/>
   </text:list-level-style-number>
   <text:list-level-style-number text:level="6" style:num-suffix="." style:num-format="i">
    <style:list-level-properties text:space-before="3.4657in" text:min-label-width="0.1252in" fo:text-align="end"/>
   </text:list-level-style-number>
   <text:list-level-style-number text:level="7" style:num-suffix="." style:num-format="1">
    <style:list-level-properties text:space-before="3.8409in" text:min-label-width="0.25in"/>
   </text:list-level-style-number>
   <text:list-level-style-number text:level="8" style:num-suffix="." style:num-format="a" style:num-letter-sync="true">
    <style:list-level-properties text:space-before="4.3409in" text:min-label-width="0.25in"/>
   </text:list-level-style-number>
   <text:list-level-style-number text:level="9" style:num-suffix="." style:num-format="i">
    <style:list-level-properties text:space-before="4.9657in" text:min-label-width="0.1252in" fo:text-align="end"/>
   </text:list-level-style-number>
   <text:list-level-style-number text:level="10" style:num-suffix="." style:num-format="1">
    <style:list-level-properties text:space-before="1.7724in" text:min-label-width="0.1965in"/>
   </text:list-level-style-number>
  </text:list-style>
  <text:notes-configuration text:note-class="footnote" text:citation-style-name="Footnote_20_Symbol" style:num-format="1" text:start-value="0" text:footnotes-position="page" text:start-numbering-at="page"/>
  <text:notes-configuration text:note-class="endnote" text:citation-style-name="Endnote_20_Symbol" text:master-page-name="Endnote" style:num-format="1" text:start-value="0"/>
  <text:linenumbering-configuration text:style-name="Line_20_numbering" text:number-lines="false" text:offset="0.1965in" style:num-format="1" text:number-position="left" text:increment="5"/>
 </office:styles>
 <office:automatic-styles>
  <style:style style:name="Tableau1" style:family="table">
   <style:table-properties style:width="5.4326in" table:align="margins"/>
  </style:style>
  <style:style style:name="Tableau1.A" style:family="table-column">
   <style:table-column-properties style:column-width="2.5083in" style:rel-column-width="30255*"/>
  </style:style>
  <style:style style:name="Tableau1.B" style:family="table-column">
   <style:table-column-properties style:column-width="2.9243in" style:rel-column-width="35280*"/>
  </style:style>
  <style:style style:name="Tableau1.A1" style:family="table-cell">
   <style:table-cell-properties style:vertical-align="top" fo:padding-left="0.0486in" fo:padding-right="0.0486in" fo:padding-top="0in" fo:padding-bottom="0in" fo:border-left="0.05pt solid #000000" fo:border-right="none" fo:border-top="0.05pt solid #000000" fo:border-bottom="0.05pt solid #000000"/>
  </style:style>
  <style:style style:name="Tableau1.B1" style:family="table-cell">
   <style:table-cell-properties style:vertical-align="top" fo:padding-left="0.0486in" fo:padding-right="0.0486in" fo:padding-top="0in" fo:padding-bottom="0in" fo:border="0.05pt solid #000000"/>
  </style:style>
  <style:style style:name="Tableau1.A2" style:family="table-cell">
   <style:table-cell-properties style:vertical-align="top" fo:padding-left="0.0486in" fo:padding-right="0.0486in" fo:padding-top="0in" fo:padding-bottom="0in" fo:border-left="0.05pt solid #000000" fo:border-right="none" fo:border-top="none" fo:border-bottom="0.05pt solid #000000"/>
  </style:style>
  <style:style style:name="Tableau1.B2" style:family="table-cell">
   <style:table-cell-properties style:vertical-align="top" fo:padding-left="0.0486in" fo:padding-right="0.0486in" fo:padding-top="0in" fo:padding-bottom="0in" fo:border-left="0.05pt solid #000000" fo:border-right="0.05pt solid #000000" fo:border-top="none" fo:border-bottom="0.05pt solid #000000"/>
  </style:style>
  <style:style style:name="P1" style:family="paragraph" style:parent-style-name="Header" style:master-page-name="">
   <style:paragraph-properties fo:margin-left="0in" fo:margin-right="0in" fo:margin-top="0in" fo:margin-bottom="0.1181in" loext:contextual-spacing="false" fo:text-align="start" style:justify-single-word="false" fo:text-indent="0in" style:auto-text-indent="false" style:page-number="auto">
    <style:tab-stops>
     <style:tab-stop style:position="0.5409in" style:type="right" style:leader-style="solid" style:leader-text="_"/>
     <style:tab-stop style:position="5.3752in"/>
    </style:tab-stops>
   </style:paragraph-properties>
  </style:style>
  <style:style style:name="P2" style:family="paragraph" style:parent-style-name="Header" style:master-page-name="">
   <style:paragraph-properties fo:margin-left="0in" fo:margin-right="0in" fo:margin-top="0in" fo:margin-bottom="0.1181in" loext:contextual-spacing="false" fo:text-align="start" style:justify-single-word="false" fo:text-indent="0in" style:auto-text-indent="false" style:page-number="auto">
    <style:tab-stops>
     <style:tab-stop style:position="0.5409in" style:type="right" style:leader-style="solid" style:leader-text="_"/>
     <style:tab-stop style:position="5.3752in"/>
    </style:tab-stops>
   </style:paragraph-properties>
  </style:style>
  <style:style style:name="P3" style:family="paragraph" style:parent-style-name="TexteCourant">
   <style:text-properties fo:font-weight="bold" style:font-weight-asian="bold" style:font-weight-complex="bold"/>
  </style:style>
  <style:style style:name="P4" style:family="paragraph" style:parent-style-name="TexteCourant">
   <style:text-properties style:text-underline-style="solid" style:text-underline-width="auto" style:text-underline-color="font-color"/>
  </style:style>
  <style:style style:name="P5" style:family="paragraph" style:parent-style-name="TableauTitre">
   <style:paragraph-properties>
    <style:tab-stops>
     <style:tab-stop style:position="0.3937in"/>
     <style:tab-stop style:position="0.5909in"/>
     <style:tab-stop style:position="0.7874in"/>
     <style:tab-stop style:position="0.9846in"/>
     <style:tab-stop style:position="1.1811in"/>
     <style:tab-stop style:position="1.3783in"/>
     <style:tab-stop style:position="1.5752in"/>
     <style:tab-stop style:position="1.772in"/>
     <style:tab-stop style:position="1.9689in"/>
     <style:tab-stop style:position="2.1661in"/>
     <style:tab-stop style:position="2.3626in"/>
     <style:tab-stop style:position="2.5598in"/>
     <style:tab-stop style:position="2.7563in"/>
     <style:tab-stop style:position="2.9535in"/>
     <style:tab-stop style:position="3.15in"/>
     <style:tab-stop style:position="3.3472in"/>
     <style:tab-stop style:position="3.5437in"/>
     <style:tab-stop style:position="3.7409in"/>
     <style:tab-stop style:position="3.9374in"/>
     <style:tab-stop style:position="4.1346in"/>
    </style:tab-stops>
   </style:paragraph-properties>
   <style:text-properties fo:language="fr" fo:country="CA"/>
  </style:style>
  <style:style style:name="P6" style:family="paragraph" style:parent-style-name="TableauTitreColonne">
   <style:paragraph-properties>
    <style:tab-stops>
     <style:tab-stop style:position="0.3937in"/>
     <style:tab-stop style:position="0.5909in"/>
     <style:tab-stop style:position="0.7874in"/>
     <style:tab-stop style:position="0.9846in"/>
     <style:tab-stop style:position="1.1811in"/>
     <style:tab-stop style:position="1.3783in"/>
     <style:tab-stop style:position="1.5752in"/>
     <style:tab-stop style:position="1.772in"/>
     <style:tab-stop style:position="1.9689in"/>
     <style:tab-stop style:position="2.1661in"/>
     <style:tab-stop style:position="2.3626in"/>
     <style:tab-stop style:position="2.5598in"/>
     <style:tab-stop style:position="2.7563in"/>
     <style:tab-stop style:position="2.9535in"/>
     <style:tab-stop style:position="3.15in"/>
     <style:tab-stop style:position="3.3472in"/>
     <style:tab-stop style:position="3.5437in"/>
     <style:tab-stop style:position="3.7409in"/>
     <style:tab-stop style:position="3.9374in"/>
     <style:tab-stop style:position="4.1346in"/>
    </style:tab-stops>
   </style:paragraph-properties>
   <style:text-properties fo:language="zxx" fo:country="none" style:language-asian="zxx" style:country-asian="none"/>
  </style:style>
  <style:style style:name="P7" style:family="paragraph" style:parent-style-name="TableauCorps">
   <style:paragraph-properties>
    <style:tab-stops/>
   </style:paragraph-properties>
   <style:text-properties fo:language="zxx" fo:country="none" style:language-asian="zxx" style:country-asian="none"/>
  </style:style>
  <style:style style:name="P8" style:family="paragraph" style:parent-style-name="Code">
   <style:paragraph-properties fo:margin-left="0.039in" fo:margin-right="1.0319in" fo:text-indent="0in" style:auto-text-indent="false"/>
  </style:style>
  <style:style style:name="P9" style:family="paragraph" style:parent-style-name="Contents_20_3">
   <style:paragraph-properties>
    <style:tab-stops>
     <style:tab-stop style:position="5.2827in" style:type="right" style:leader-style="dotted" style:leader-text="."/>
    </style:tab-stops>
   </style:paragraph-properties>
  </style:style>
  <style:style style:name="P10" style:family="paragraph" style:parent-style-name="Contents_20_2">
   <style:paragraph-properties>
    <style:tab-stops>
     <style:tab-stop style:position="5.4327in" style:type="right" style:leader-style="dotted" style:leader-text="."/>
    </style:tab-stops>
   </style:paragraph-properties>
  </style:style>
  <style:style style:name="P11" style:family="paragraph" style:parent-style-name="Contents_20_1">
   <style:paragraph-properties>
    <style:tab-stops>
     <style:tab-stop style:position="5.4327in" style:type="right" style:leader-style="dotted" style:leader-text="."/>
    </style:tab-stops>
   </style:paragraph-properties>
  </style:style>
  <style:style style:name="P12" style:family="paragraph" style:parent-style-name="Contents_20_Heading" style:master-page-name="PageEyrolles15-20">
   <style:paragraph-properties style:page-number="auto"/>
  </style:style>
  <style:style style:name="P13" style:family="paragraph" style:parent-style-name="RemarqueTitre">
   <style:paragraph-properties fo:padding-left="0.0555in" fo:padding-right="0.0555in" fo:padding-top="0.0138in" fo:padding-bottom="0.0138in" fo:border="0.06pt solid #000000">
    <style:tab-stops>
     <style:tab-stop style:position="0.3937in"/>
     <style:tab-stop style:position="0.5909in"/>
     <style:tab-stop style:position="0.7874in"/>
     <style:tab-stop style:position="0.9846in"/>
     <style:tab-stop style:position="1.1811in"/>
     <style:tab-stop style:position="1.3783in"/>
     <style:tab-stop style:position="1.5752in"/>
     <style:tab-stop style:position="1.772in"/>
     <style:tab-stop style:position="1.9689in"/>
     <style:tab-stop style:position="2.1661in"/>
     <style:tab-stop style:position="2.3626in"/>
     <style:tab-stop style:position="2.5598in"/>
     <style:tab-stop style:position="2.7563in"/>
     <style:tab-stop style:position="2.9535in"/>
     <style:tab-stop style:position="3.15in"/>
     <style:tab-stop style:position="3.3472in"/>
     <style:tab-stop style:position="3.5437in"/>
     <style:tab-stop style:position="3.7409in"/>
     <style:tab-stop style:position="3.9374in"/>
     <style:tab-stop style:position="4.1346in"/>
    </style:tab-stops>
   </style:paragraph-properties>
  </style:style>
  <style:style style:name="T1" style:family="text"/>
  <style:style style:name="T2" style:family="text">
   <style:text-properties fo:font-weight="normal" style:font-weight-asian="normal" style:font-weight-complex="normal"/>
  </style:style>
  <style:style style:name="T3" style:family="text">
   <style:text-properties fo:font-style="italic"/>
  </style:style>
  <style:style style:name="T4" style:family="text">
   <style:text-properties fo:font-style="italic" style:font-style-asian="italic" style:font-style-complex="italic"/>
  </style:style>
  <style:style style:name="T5" style:family="text">
   <style:text-properties style:font-name="Times New Roman" fo:font-size="10pt"/>
  </style:style>
  <style:style style:name="T6" style:family="text">
   <style:text-properties style:font-name="Arial2" fo:font-size="8pt"/>
  </style:style>
  <style:style style:name="T7" style:family="text">
   <style:text-properties fo:font-weight="bold" style:font-weight-asian="bold" style:font-weight-complex="bold"/>
  </style:style>
  <style:style style:name="Sect1" style:family="section">
   <style:section-properties style:editable="false">
    <style:columns fo:column-count="1" fo:column-gap="0in"/>
   </style:section-properties>
  </style:style>
  <style:page-layout style:name="pm1" style:page-usage="mirrored">
   <style:page-layout-properties fo:page-width="8.2681in" fo:page-height="11.6929in" style:num-format="1" style:print-orientation="portrait" fo:margin-top="1.4764in" fo:margin-bottom="1.8508in" fo:margin-left="0.6299in" fo:margin-right="0.6299in" style:writing-mode="lr-tb" style:layout-grid-color="#c0c0c0" style:layout-grid-lines="33" style:layout-grid-base-height="0.1945in" style:layout-grid-ruby-height="0.0555in" style:layout-grid-mode="none" style:layout-grid-ruby-below="false" style:layout-grid-print="false" style:layout-grid-display="false" style:footnote-max-height="0in">
    <style:footnote-sep style:width="0.0071in" style:distance-before-sep="0.0398in" style:distance-after-sep="0.0398in" style:line-style="none" style:adjustment="left" style:rel-width="25%" style:color="#000000"/>
   </style:page-layout-properties>
   <style:header-style>
    <style:header-footer-properties fo:min-height="0.1181in" fo:margin-left="0in" fo:margin-right="0in" fo:margin-bottom="0.0783in" style:dynamic-spacing="false"/>
   </style:header-style>
   <style:footer-style/>
  </style:page-layout>
  <style:page-layout style:name="pm2">
   <style:page-layout-properties fo:page-width="8.2681in" fo:page-height="11.6925in" style:num-format="1" style:print-orientation="portrait" fo:margin-top="0.3937in" fo:margin-bottom="0.3937in" fo:margin-left="0.6299in" fo:margin-right="0.6299in" style:writing-mode="lr-tb" style:layout-grid-color="#c0c0c0" style:layout-grid-lines="20" style:layout-grid-base-height="0.278in" style:layout-grid-ruby-height="0.139in" style:layout-grid-mode="none" style:layout-grid-ruby-below="false" style:layout-grid-print="false" style:layout-grid-display="false" style:footnote-max-height="0in">
    <style:footnote-sep style:width="0.0071in" style:distance-before-sep="0.0398in" style:distance-after-sep="0.0398in" style:line-style="none" style:adjustment="left" style:rel-width="25%" style:color="#000000"/>
   </style:page-layout-properties>
   <style:header-style/>
   <style:footer-style/>
  </style:page-layout>
  <style:page-layout style:name="pm3">
   <style:page-layout-properties fo:page-width="8.2681in" fo:page-height="11.6925in" style:num-format="1" style:print-orientation="portrait" fo:margin-top="0.7874in" fo:margin-bottom="0.7874in" fo:margin-left="0.7874in" fo:margin-right="0.7874in" style:writing-mode="lr-tb" style:layout-grid-color="#c0c0c0" style:layout-grid-lines="20" style:layout-grid-base-height="0.278in" style:layout-grid-ruby-height="0.139in" style:layout-grid-mode="none" style:layout-grid-ruby-below="false" style:layout-grid-print="false" style:layout-grid-display="false" style:footnote-max-height="0in">
    <style:footnote-sep style:line-style="none" style:adjustment="left" style:rel-width="25%" style:color="#000000"/>
   </style:page-layout-properties>
   <style:header-style/>
   <style:footer-style/>
  </style:page-layout>
  <style:page-layout style:name="pm4">
   <style:page-layout-properties fo:page-width="8.2673in" fo:page-height="11.6925in" style:num-format="1" style:print-orientation="portrait" fo:margin-top="0.7874in" fo:margin-bottom="0.7874in" fo:margin-left="1.4173in" fo:margin-right="1.4173in" style:shadow="none" fo:background-color="transparent" style:writing-mode="lr-tb" style:layout-grid-color="#c0c0c0" style:layout-grid-lines="20" style:layout-grid-base-height="0.278in" style:layout-grid-ruby-height="0.139in" style:layout-grid-mode="none" style:layout-grid-ruby-below="false" style:layout-grid-print="false" style:layout-grid-display="false" draw:fill="none" draw:fill-color="#99ccff" style:footnote-max-height="0in">
    <style:columns fo:column-count="1" fo:column-gap="0in"/>
    <style:footnote-sep style:width="0.0071in" style:distance-before-sep="0.0398in" style:distance-after-sep="0.0398in" style:line-style="none" style:adjustment="left" style:rel-width="25%" style:color="#000000"/>
   </style:page-layout-properties>
   <style:header-style>
    <style:header-footer-properties fo:min-height="0.3929in" fo:margin-left="0in" fo:margin-right="0in" fo:margin-bottom="0.1965in" style:dynamic-spacing="false"/>
   </style:header-style>
   <style:footer-style>
    <style:header-footer-properties fo:min-height="0.3929in" fo:margin-left="0in" fo:margin-right="0in" fo:margin-top="0.1965in" style:dynamic-spacing="false"/>
   </style:footer-style>
  </style:page-layout>
 </office:automatic-styles>
 <office:master-styles>
  <style:master-page style:name="Standard" style:page-layout-name="pm1">
   <style:header>
    <text:p text:style-name="P1">Auteurs/Titre â€“ Chapitre X<text:tab/>page <text:page-number text:select-page="current">0</text:page-number><text:s/>de <text:span text:style-name="Page_20_Number"><text:page-count style:num-format="1">7</text:page-count></text:span><text:span text:style-name="Page_20_Number"><text:s/></text:span></text:p>
   </style:header>
  </style:master-page>
  <style:master-page style:name="HTML" style:page-layout-name="pm2"/>
  <style:master-page style:name="Endnote" style:page-layout-name="pm3"/>
  <style:master-page style:name="PageEyrolles15-20" style:page-layout-name="pm4">
   <style:header>
    <text:p text:style-name="Header_20_right"><text:chapter text:display="number" text:outline-level="1"/><text:chapter text:display="name" text:outline-level="1">Mode dâ€™emploi du modÃ¨le .ott (Collection blanche, collection noire, Architecte logiciel)</text:chapter></text:p>
   </style:header>
   <style:header-left>
    <text:p text:style-name="Header_20_left"><text:title>Eyrolles AccÃ¨s Libre, Sans Taboo, Cahiers du programmeur/Admin</text:title></text:p>
   </style:header-left>
   <style:footer>
    <text:p text:style-name="Footer_20_right"><text:page-number text:select-page="current">7</text:page-number></text:p>
   </style:footer>
   <style:footer-left>
    <text:p text:style-name="Footer_20_left"><text:page-number text:select-page="current">6</text:page-number></text:p>
   </style:footer-left>
  </style:master-page>
 </office:master-styles>
  <office:body>
    <text:tracked-changes text:track-changes="true">
    </text:tracked-changes>
    <office:text><text:table-of-content text:style-name="Sect1" text:protected="true" text:name="Table des matiÃ¨res1">
  <text:index-body>
    <text:index-title text:style-name="Sect1" text:name="Table des matiÃ¨res_Head">
      <text:p text:style-name="P12">Table des matiÃ¨res</text:p>
    </text:index-title>
  </text:index-body>
</text:table-of-content>
<text:bookmark text:name="ref-avant_propos" /><text:h text:style-name="ChapitreTitre" text:outline-level="1">Avant-propos</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T7">Node.js</text:span>&#160;â€“ appelons-le <text:span text:style-name="T7">Node</text:span> dÃ¨s Ã  prÃ©sent&#160;â€“ est nÃ© dans le cerveau de
Ryan Dahl, ancien Ã©tudiant sans le sou et au parcours informatique atypique.
Son talent a Ã©tÃ© de s&#8217;obstiner Ã  <text:span text:style-name="T7">rÃ©soudre un problÃ¨me d&#8217;expÃ©rience utilisateur</text:span>
frÃ©quent sur le web&#160;: <text:span text:style-name="T7">l&#8217;attente devant un navigateur web figÃ©</text:span>.
Son but&#160;? Rendre possible et facile la crÃ©ation de <text:span text:style-name="T7">barres de progression</text:span>
dans les navigateurs&#160;web.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">J&#8217;ai utilisÃ© Node pour la premiÃ¨re fois en 2010, par curiositÃ©.
Nous en Ã©tions alors Ã  la version&#160;0.4.
CrÃ©er mon propre serveur HTTP Ã©tait un concept qui semblait Ã©trange,
habituÃ© que j&#8217;Ã©tais Ã  Ã©crire des applications PHP et Ã  les mettre derriÃ¨re
un serveur Apache&#160;â€“ nginx commenÃ§ait Ã  peine Ã  dÃ©coller.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;effet "wahou" Ã©tait pourtant lÃ &#160;: une installation en quelques secondes,
quelques lignes de JavaScript et j&#8217;avais une API REST cÃ¢blÃ©e avec une base
de donnÃ©es <text:span text:style-name="T4">CouchDB</text:span> pour impressionner mes collÃ¨gues.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Je bascule dans un <text:span text:style-name="T7">contexte startup</text:span> fin 2011&#160;: nous sommes quatre dÃ©veloppeurs
avec des bagages diffÃ©rents.
Nous voulions <text:span text:style-name="T7">un langage commun</text:span> pour le back-end et le front-end.
Nous partons sur Node, installÃ© sans encombre sur notre serveur dÃ©diÃ©
gÃ©rÃ© par l&#8217;hÃ©bergeur <text:span text:style-name="T4">AlwaysData</text:span>.
Nous avions la <text:span text:style-name="T7">sensation de progresser rapidement</text:span>.
Nous allions rÃ©ellement&#160;vite.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Depuis, de nombreuses entreprises ont communiquÃ© sur leur adoption de Node&#160;:
Paypal, LinkedIn, eBay, Airbnb, British&#160;Gas, AllocinÃ©, The&#160;New&#160;York&#160;Times,
Yahoo!, Microsoft, Mozilla, Flickr ou encore Twitter.
Ces entreprises l&#8217;utilisent pour faÃ§onner leur outillage mÃ©tier,
gÃ©rer les transactions bancaires, leurs serveurs LDAP, des services ou
des sites&#160;web.</text:p>
<text:bookmark text:name="ref-pourquoi_ce_livre" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Pourquoi ce livre ?</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Je trouve que <text:span text:style-name="T7">Node est un environnement Ã©lÃ©gant et agrÃ©able</text:span>.
Je prends beaucoup de plaisir Ã  l&#8217;utiliser au quotidien, mais je regrette
l&#8217;accent placÃ© sur la nouveautÃ© permanente et la sur-ingÃ©nierie des articles
et ouvrages en langue franÃ§aise.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Node est mon outil de travail principal depuis 2011 et je fais quasiment tout avec
â€“ y compris l&#8217;outillage de publication de cet ouvrage.
J&#8217;avais envie de communiquer sur la simplicitÃ©, l&#8217;architecture modulaire et
la versatilitÃ© de Node pour que vous puissiez <text:span text:style-name="T7">progresser dans l&#8217;usage de JavaScript</text:span>,
<text:span text:style-name="T7">faÃ§onner votre propre outillage</text:span> et pour mieux
<text:span text:style-name="T7">utiliser les ressources des systÃ¨mes d&#8217;exploitation</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Je vous propose donc un <text:span text:style-name="T7">contenu moins technique que d&#8217;ordinaire</text:span>, orientÃ© sur
l&#8217;apprentissage par la pratique et des concepts qui durent dans le temps.
Cet ouvrage s&#8217;installe avec Node&#160;: tous les exemples sont rÃ©els et fonctionnent
dans votre terminal.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Indirectement, je souhaite <text:span text:style-name="T7">dÃ©construire la posture d&#8217;expert et de lecteur</text:span>
en me mettant Ã  vos cÃ´tÃ©s pendant votre apprentissage.
Une partie des contenus a Ã©tÃ© conÃ§ue et relue en ateliers collectifs pour que
la progression se fasse de maniÃ¨re naturelle.</text:p>
<text:bookmark text:name="ref-Ã _qui_sadresse_cet_ouvrage" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Ã€ qui s&#8217;adresse cet ouvrage ?</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">J&#8217;ai Ã©crit cet ouvrage avec trois profils de lecteurs en tÃªte&#160;:
des personnes qui souhaitent <text:span text:style-name="T7">se mettre Ã  Node sans savoir par oÃ¹ commencer</text:span>,
celles et ceux qui font du <text:span text:style-name="T7"><text:span text:style-name="T4">front-end</text:span> et souhaitent mieux comprendre leur outillage</text:span>
et celles qui veulent <text:span text:style-name="T7">renforcer leurs connaissances</text:span> en Node et
JavaScript afin de changer de travail/mÃ©tier.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cet ouvrage s&#8217;adresse aussi Ã  des lecteurs qui ne programment pas pour gagner leur
vie mais qui veulent mieux comprendre de quoi parlent les dÃ©veloppeurs et dÃ©veloppeuses.
Je pense que les interactions de travail sont de meilleure qualitÃ© quand nous
comprenons les problÃ©matiques de celles et ceux avec qui nous travaillons.</text:p>
<text:bookmark text:name="ref-structure_de_louvrage" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Structure de l&#8217;ouvrage</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cet ouvrage se lit dans l&#8217;ordre de votre choix.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">J&#8217;ai fait en sorte que la lecture soit progressive, du plus simple au plus complexe.
Le contenu des chapitres explore une problÃ©matique et se termine
souvent sur une section avancÃ©e, pour aller plus&#160;loin.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette Ã©dition est composÃ©e de neuf chapitres et d&#8217;une annexe&#160;:</text:p>
<text:p text:style-name="ListeANumero">1.<text:tab/><text:span text:style-name="T7">Histoire, Ã©cosystÃ¨me et gouvernance</text:span><text:line-break/>
D&#8217;oÃ¹ vient Node et qui sont les acteurs participant Ã  son histoire&#160;?</text:p><text:p text:style-name="ListeANumero">2.<text:tab/><text:span text:style-name="T7">Installer, mettre Ã  jour et dÃ©velopper</text:span><text:line-break/>
ÃŠtre autonome pour installer Node.js
sur notre ordinateur ou un serveur, se tenir au courant
des mises Ã  jour et jongler entre diffÃ©rentes versions.
DÃ©couvrir des outils confortables pour Ã©crire du&#160;code.</text:p><text:p text:style-name="ListeANumero">3.<text:tab/><text:span text:style-name="T7">Jouer avec JavaScript</text:span><text:line-break/>
Comprendre les diffÃ©rences entre JavaScript, ECMAScript, le DOM et Node.js.
Revoir les bases du langage pour se sentir plus Ã  l&#8217;aise.</text:p><text:p text:style-name="ListeANumero">4.<text:tab/><text:span text:style-name="T7">Jouer avec Node.js</text:span><text:line-break/>
S&#8217;exercer avec des scripts et des modules Node.js&#160;:
les nÃ´tres, ceux fournis par Node et ceux de la communautÃ©.</text:p><text:p text:style-name="ListeANumero">5.<text:tab/><text:span text:style-name="T7">Jouer avec npm</text:span><text:line-break/>
Apprendre Ã  tirer parti de l&#8217;outil livrÃ© par dÃ©faut avec Node.js.
S&#8217;amuser Ã  crÃ©er nos propres outils dignes d&#8217;artisans du logiciel.</text:p><text:p text:style-name="ListeANumero">6.<text:tab/><text:span text:style-name="T7">DÃ©ployer notre code</text:span><text:line-break/>
DÃ©ployer notre code le plus tÃ´t possible pour cÃ©lÃ©brer notre premier programme&#160;!</text:p><text:p text:style-name="ListeANumero">7.<text:tab/><text:span text:style-name="T7">CrÃ©er une application web</text:span><text:line-break/>
CrÃ©er une application web en partant de zÃ©ro, en utilisant un framework puis
en parlant Ã  une base de donnÃ©es.
Bienvenue dans l&#8217;odyssÃ©e d&#8217;une requÃªte&#160;HTTP&#160;!</text:p><text:p text:style-name="ListeANumero">8.<text:tab/><text:span text:style-name="T7">CrÃ©er un outil en ligne de commande</text:span><text:line-break/>
Rendre du code mÃ©tier fonctionnel dans un terminal&#160;;
la ligne de commande ne paraÃ®tra plus aussi austÃ¨re.</text:p><text:p text:style-name="ListeANumero">9.<text:tab/><text:span text:style-name="T7">CrÃ©er une application <text:span text:style-name="T4">front-end</text:span></text:span><text:line-break/>
Utiliser la richesse de l&#8217;Ã©cosystÃ¨me&#160;npm et profiter des modules pour Ã©crire des
applications <text:span text:style-name="T4">front-end</text:span> de qualitÃ©.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;annexe complÃ¨te l&#8217;ouvrage avec une <text:span text:style-name="T7">sÃ©lection de modules</text:span>&#160;npm,
pour dÃ©marrer plus vite et mieux cerner ce qu&#8217;on peut faire avec&#160;Node.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Ressources</text:span> Contenu en <text:span text:style-name="T8">livre</text:span> libre accÃ¨s</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Le contenu de cet ouvrage est actualisÃ© en permanence sur <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://oncletom.io/node.js/" text:visited-style-name="Visited_20_Internet_20_Link">https://oncletom.io/node.js/</text:a></text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">L&#8217;intÃ©gralitÃ© du code source du livre et des exemples sont hÃ©bergÃ©s sur
<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://github.com/oncletom/nodebook" text:visited-style-name="Visited_20_Internet_20_Link">https://github.com/oncletom/nodebook</text:a></text:span>.
J&#8217;utilise la plate-forme collaborative GitHub pour recueillir vos avis,
corrections et suggestions.</text:p>
<text:bookmark text:name="ref-remerciements" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Remerciements</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cet ouvrage a Ã©tÃ© rÃ©digÃ© sur prÃ¨s de quatre annÃ©es&#160;â€“ longue est la liste
des personnes Ã  remercier.
Longue aussi est la liste de celles et ceux Ã  qui je demande pardon pour mes
sautes d&#8217;humeur, mes absences ou mes passages Ã  vide.
L&#8217;Ã©criture sur une longue durÃ©e est une activitÃ© que je trouve Ã©prouvante.
Elle nÃ©cessite un ajustement permanent vis-Ã -vis de moi-mÃªme pour ne pas
(trop) en souffrir.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Mes premiers remerciements vont Ã  NoÃ©mie.
Ta joie, tes encouragements et ta prÃ©sence sont essentiels Ã  mon Ã©quilibre.
Ils m&#8217;emplissent de confiance, m&#8217;inspirent et attÃ©nuent les peurs qui me paralysent.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Je remercie Karine, LaurÃ¨ne, Elsa et Alexandre des Ã‰ditions Eyrolles pour cette opportunitÃ©.
Vous avez fait preuve d&#8217;une patience et d&#8217;une confiance infinies malgrÃ© le dÃ©lai d&#8217;Ã©criture.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Je tiens Ã  remercier mes anciens collÃ¨gues de BBC&#160;R&amp;D pour leur soutien,
leur confiance et leur tolÃ©rance aux jeux de mots.
Olivier, Sean, Katie, Chris&#160;N et Chris&#160;L&#160;: c&#8217;Ã©tait un plaisir et un honneur
d&#8217;Ãªtre Ã  vos&#160;cÃ´tÃ©s.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">CertainÂ·eÂ·s d&#8217;entre vous m&#8217;ont beaucoup aidÃ© par leurs conseils,
leurs relectures et leurs encouragements.
Alors un grand merci pour cela Ã  BÃ©a, Claire, ClÃ©mentine, David, Efi, Fabien,
Frank, Philippe, StÃ©phane et Thierry.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Merci Ã  l&#8217;Ã©quipe d&#8217;Asciidoctor pour leur travail prÃ©cieux et leurs rÃ©ponses Ã 
mes innombrables questions.
Je pense notamment Ã  Guillaume et Ã &#160;Dan.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Merci Ã  Antoine pour notre travail en duo sur l&#8217;Ã©criture numÃ©rique.
Je suis fier d&#8217;apporter ce mode d&#8217;Ã©criture dans les communautÃ©s acadÃ©miques,
du design et des archivistes.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Enfin, je remercie toutes les personnes qui m&#8217;ont accueilli chez elles,
dans leur maison, dans leur bureau ou dans leur communautÃ©/<text:span text:style-name="T4">meet-up</text:span> pendant mon
Ã©criture itinÃ©rante en&#160;2017 et&#160;2018.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Bonne lecture,</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Thomas</text:p>
<text:bookmark text:name="ref-chapter-01" /><text:p text:style-name="ChapitreNumero">1</text:p><text:h text:style-name="ChapitreTitre" text:outline-level="1">Histoire, Ã©cosystÃ¨me et gouvernance</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Faisons le point sur ce qu&#8217;est Node pour mieux comprendre les discussions qui
animent la communautÃ© et d&#8217;oÃ¹ vient cette plate-forme qui fait tant parler d&#8217;elle.</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">Bref historique</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Les raisons du succÃ¨s</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Pourquoi Ã©viter Node</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Pourquoi choisir Node</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">L&#8217;Ã©cosystÃ¨me des acteurs</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Gouvernance du projet</text:p>
</text:list-item></text:list>
<text:p text:style-name="ChapitreIntroduction"><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Node.js est-il un langage de programmation&#160;?
Node.js est-il un framework JavaScript&#160;?
Qu&#8217;en restera-t-il une fois la frÃ©nÃ©sie retombÃ©e&#160;?</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce chapitre permet de <text:span text:style-name="T7">comprendre pourquoi Node a Ã©mergÃ©</text:span> et comment.
Surtout, il vous permettra de comprendre les choix techniques
Ã  l&#8217;origine des fondations de Node et ce que l&#8217;utiliser
peut vous apporter, que ce soit dans un contexte personnel ou professionnel.</text:p></text:p>
<text:bookmark text:name="ref-node_js_un_environnement_dexÃ©cution_javascript" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Node.js : un environnement d&#8217;exÃ©cution JavaScript</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Node.js n&#8217;est pas un langage de programmation.
Ce n&#8217;est pas non plus un framework JavaScript.
<text:span text:style-name="T7">Node.js est un environnement d&#8217;exÃ©cution JavaScript</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La diffÃ©rence entre ces trois dÃ©signations peut sembler subtile, futile voire
inutile, mais le terme "environnement" est la vÃ©ritable nature de Node.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">ExÃ©cuter du JavaScript cÃ´tÃ© serveur n&#8217;est pas une rÃ©volution.
Netscape Enterprise Server s&#8217;y est dÃ©jÃ  essayÃ© au milieu des annÃ©es 1990,
juste aprÃ¨s son introduction dans le navigateur web Netscape Navigator.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">En 1997, la sociÃ©tÃ© Netscape s&#8217;est attelÃ©e Ã  crÃ©er Rhino
(<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://www.mozilla.org/rhino/" text:visited-style-name="Visited_20_Internet_20_Link">https://www.mozilla.org/rhino/</text:a></text:span>), un environnement d&#8217;exÃ©cution JavaScript
tournant sous Java disponible sous licence libre.
C&#8217;Ã©tait un des projets liÃ©s Ã  la rÃ©Ã©criture de Netscape Navigator en Java.
Si la sociÃ©tÃ© a depuis fermÃ© ses portes, <text:span text:style-name="T4">Rhino</text:span> a entraÃ®nÃ© l&#8217;Ã©mergence de projets
utiles aux dÃ©veloppeurs&#160;web.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Entre-temps, le langage JavaScript Ã©volue, le Web&#160;2.0 Ã©merge des cendres de la
premiÃ¨re bulle Internet et d&#8217;autres initiatives voient le jour dans les annÃ©es 2000
comme APE (<text:span text:style-name="T4">Ajax Push Engine</text:span>, <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://ape-project.org/" text:visited-style-name="Visited_20_Internet_20_Link">http://ape-project.org/</text:a></text:span>).
Elles mettent Ã©galement en Å“uvre JavaScript cÃ´tÃ© serveur.
JavaScript Ã©tait surtout un choix logique de partage de code entre client et
serveur pour Comet, le prÃ©curseur des <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-websockets"  text:visited-style-name="Visited_20_Internet_20_Link">WebSockets</text:a>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Glossaire</text:span> Comet</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Comet est un terme regroupant les diffÃ©rentes tentatives techniques permettant
Ã  un serveur web d&#8217;envoyer des donnÃ©es Ã  un client sans que celui-ci ne les ait
demandÃ©es initialement.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Parmi ces techniques, on retrouve le <text:span text:style-name="T4">long polling</text:span>, consistant Ã  conserver une
connexion Ajax ouverte pendant la durÃ©e de vie d&#8217;une page web.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Glossaire</text:span> WebSockets</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">WebSockets est un protocole basÃ© sur&#160;TCP.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Il maintient une connexion HTTP active entre un client et un serveur et y fait
transiter les donnÃ©es de maniÃ¨re bidirectionnelle.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Ce protocole sera probablement rendu obsolÃ¨te par HTTP/2, le successeur de HTTP/1.1.
HTTP/2 a Ã©tÃ© lancÃ© par Google sous le nom de protocole SPDY (prononcer <text:span text:style-name="T4">speedy</text:span>).</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7">Cas d&#8217;utilisation modernes de Rhino</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Rhino est toujours utile dÃ¨s qu&#8217;un projet Java implique du JavaScript.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Google l&#8217;utilise comme environnement d&#8217;exÃ©cution de ses <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://gsuite-developers.googleblog.com/2012/11/using-open-source-libraries-in-apps.html" text:visited-style-name="Visited_20_Internet_20_Link">https://gsuite-developers.googleblog.com/2012/11/using-open-source-libraries-in-apps.html</text:a>.
Ces scripts sont destinÃ©s Ã  dÃ©velopper des extensions et des interactions
supplÃ©mentaires pour les documents Google&#160;Drive.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Rhino est Ã©galement employÃ© dans YUI Compressor (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://yui.github.io/yuicompressor/" text:visited-style-name="Visited_20_Internet_20_Link">https://yui.github.io/yuicompressor/</text:a></text:span>),
un optimiseur CSS et JavaScript crÃ©Ã© par Yahoo,
dÃ©sormais surpassÃ© par Closure Compiler (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://developers.google.com/closure/compiler/" text:visited-style-name="Visited_20_Internet_20_Link">https://developers.google.com/closure/compiler/</text:a></text:span>)
et UglifyJS (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/uglify-js" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/uglify-js</text:a></text:span>).
Ce dernier est Ã©crit en JavaScript et repose sur Node.
La boucle est bouclÃ©e.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Node reprÃ©sente un <text:span text:style-name="T7">environnement d&#8217;exÃ©cution</text:span> (<text:span text:style-name="T4">runtime</text:span>), un
<text:span text:style-name="T7">ensemble d&#8217;API JavaScript</text:span> ainsi qu&#8217;une <text:span text:style-name="T7">machine virtuelle&#160;(VM) JavaScript</text:span>
performante (parseur, interprÃ©teur et compilateur) capable d&#8217;accÃ©der Ã  des ressources
systÃ¨me telles que des fichiers (<text:span text:style-name="T4">filesystem</text:span>) ou des connexions rÃ©seau (<text:span text:style-name="T4">sockets</text:span>).
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Typiquement, une personne dÃ©veloppant en Node Ã©crit du code se basant sur les
API Ã  disposition.
Ce code est lu par le <text:span text:style-name="T4">runtime</text:span> Node, qui le transmet Ã  la&#160;VM JavaScript.
Enfin, cette derniÃ¨re traduit le programme en langage machine (<text:span text:style-name="T4">bytecode</text:span>)
avant que le programme soit effectivement exÃ©cutÃ© par le processeur.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Pour comprendre comment Node a optÃ© pour cette approche, retournons en 2009,
lorsque son crÃ©ateur Ryan&#160;Dahl cherche Ã  rÃ©soudre Ã©lÃ©gamment un problÃ¨me de
performance de programmation.</text:p>
<text:bookmark text:name="ref-bref_historique" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Bref historique</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">En 2006, Ryan&#160;Dahl est un Ã©tudiant amÃ©ricain en troisiÃ¨me annÃ©e de doctorat
de mathÃ©matiques.
Son but initial Ã©tait de devenir professeur dans cette matiÃ¨re, mais il prend la
dÃ©cision de ne pas terminer sa thÃ¨se et d&#8217;entreprendre un voyage au&#160;Chili.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Alors qu&#8217;il cherche Ã  effectuer des petits boulots, il y rencontre une autre
personne dÃ©veloppant des sites web.
Ruby&#160;on&#160;Rails connaÃ®t un succÃ¨s grandissant et attire son attention.
Alors que Ryan envisage d&#8217;utiliser Rails, il dÃ©couvre avec horreur la lenteur
du framework et cherche Ã  en dÃ©couvrir les causes.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ryan dÃ©bute alors sa quÃªte des applications web performantes et dÃ©couvre
Mongrel, un serveur HTTP Ã©crit en Ruby.
Il est sÃ©duit par deux choses&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">la possibilitÃ© d&#8217;inclure un serveur HTTP comme bibliothÃ¨que applicative&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">la simplicitÃ© de fonctionnement&#160;: recevoir une requÃªte HTTP et
dÃ©cider soi-mÃªme de la rÃ©ponse Ã  apporter.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La quÃªte initiale le dirige alors vers la possibilitÃ© de <text:span text:style-name="T7">crÃ©er un serveur web non bloquant</text:span>&#160;;
en d&#8217;autres termes, un serveur capable, dans un mÃªme processus, de traiter d&#8217;autres
requÃªtes en attendant de renvoyer la rÃ©ponse initiale.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous sommes alors en 2008 et le site de partage de photos Flickr innove avec un
nouveau systÃ¨me de tÃ©lÃ©versement d&#8217;images&#160;: une <text:span text:style-name="T7">barre de progression</text:span> reprÃ©sentant
le statut du tÃ©lÃ©versement remplace alors la page figÃ©e&#160;â€“ effet  inhÃ©rent Ã  l&#8217;envoi
de fichiers depuis un formulaire&#160;HTML.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-01/images/7112862941_3b8c8e9916_o_d.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>1-undefined.</text:span> Interface du service Flickr aprÃ¨s et avant l&#8217;introduction du tÃ©lÃ©versement progressif</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Lien</text:span> Annonce du nouveau Flickr Uploadr</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">L&#8217;Ã©quipe d&#8217;ingÃ©nierie de Flickr explique dans un article (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://wp.me/p2DMyG-ok" text:visited-style-name="Visited_20_Internet_20_Link">https://wp.me/p2DMyG-ok</text:a></text:span>)
comment elle a contournÃ© le problÃ¨me  de l&#8217;upload via un formulaire classique.
Ce problÃ¨me gelait la fenÃªtre du navigateur pendant la durÃ©e du tÃ©lÃ©versement.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">C&#8217;est le dÃ©clic pour Ryan&#160;: bien que Mongrel ait dÃ©jÃ  un plug-in pour cette fonctionnalitÃ©,
il souhaite simplifier davantage le travail pour les dÃ©veloppeurs.
Il reproduit le mÃ©canisme avec succÃ¨s en&#160;C.
Les dÃ©veloppeurs web jugeant la solution trop complexe, Ryan tente la mÃªme
approche avec d&#8217;autres langages, comme Python, Lua ou mÃªme Haskell.
Il se heurte au sempiternel problÃ¨me des ressources bloquantes des diffÃ©rents interprÃ©teurs.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le deuxiÃ¨me dÃ©clic se produit en janvier 2009,
lorsque JavaScript Ã©merge dans une discussion entre dÃ©veloppeurs.
<text:span text:style-name="T4">EurÃªka</text:span>&#160;!
La machine virtuelle JavaScript&#160;V8 de Google a Ã©tÃ© libÃ©rÃ©e en open source
depuis quelques mois et Apple, Microsoft, Mozilla et Google se livrent Ã  une
course Ã  la performance de leurs machines virtuelles respectives.
En ligne de mire, il faut rendre la navigation sur mobile et sur ordinateur plus
rapide et moins gourmande en ressources.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ryan admet que JavaScript dispose des caractÃ©ristiques idÃ©ales, mÃªme s&#8217;il n&#8217;est
pas un adepte du langage&#160;: fonctions anonymes, <text:span text:style-name="T4">closures</text:span> et l'<text:span text:style-name="T4">event loop</text:span>
(dans le DOM en tout cas).
Il manque juste aux machines virtuelles JavaScript la capacitÃ© d&#8217;accÃ©der Ã  des
<text:span text:style-name="T4">sockets</text:span>, au systÃ¨me de fichiers et Ã  d&#8217;autres fonctions systÃ¨me.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ryan quitte alors son travail, s&#8217;inspire de ses travaux de modules non bloquants
pour Nginx et s&#8217;affaire pendant six mois Ã  marier JavaScript, V8 et l&#8217;environnement
du systÃ¨me d&#8217;exploitation.
De ses efforts naÃ®t Node.js.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il prÃ©sente alors officiellement son travail (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://gist.github.com/ry/a3d0bbbff196af633995" text:visited-style-name="Visited_20_Internet_20_Link">https://gist.github.com/ry/a3d0bbbff196af633995</text:a></text:span>
et <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://www.youtube.com/watch?v=ztspvPYybIY" text:visited-style-name="Visited_20_Internet_20_Link">https://www.youtube.com/watch?v=ztspvPYybIY</text:a></text:span>) qui suscite l&#8217;enthousiasme
et attire l&#8217;attention.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;entreprise amÃ©ricaine Joyent l&#8217;embauche Ã  plein temps pour continuer le dÃ©veloppement de Node.
Ils pressentent que cet outil rÃ©pondra Ã  leurs projets de <text:span text:style-name="T4">datacenter</text:span> et d&#8217;hÃ©bergement.
<text:span text:style-name="T7">Node et sa communautÃ© se constituent</text:span> et continuent leur chemin depuis lors&#160;;
pour une simple affaire de barre de progression et une obsession pour la
perception de rapiditÃ©.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">En 2018, l&#8217;avenir de Node est au beau fixe avec plus de 2&#160;000
contributeurs et plus de 782&#160;000 modules publics hÃ©bergÃ©s sur
le registre&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">VidÃ©o</text:span> <text:span text:style-name="T4">History of Node.js</text:span></text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">La vidÃ©o <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://youtube.com/watch?v=SAc0vQCC6UQ" text:visited-style-name="Visited_20_Internet_20_Link">https://youtube.com/watch?v=SAc0vQCC6UQ</text:a></text:span> est une prÃ©sentation
donnÃ©e par Ryan&#160;Dahl, le crÃ©ateur de Node, au cours de l&#8217;annÃ©e 2011.
C&#8217;est la premiÃ¨re fois qu&#8217;il intervient pour expliquer son parcours et la
genÃ¨se du projet.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">VoilÃ  peut-Ãªtre un Ã©lÃ©ment qui figurera dans les livres d&#8217;histoire&#160;!</text:p>
<text:bookmark text:name="ref-les_raisons_du_succÃ¨s" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Les raisons du succÃ¨s</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La tension et l&#8217;attention autour de JavaScript sont Ã©normes en 2009.
La mode du tout Ajax et des <text:span text:style-name="T4">mashups</text:span> s&#8217;est estompÃ©e, mais une chose en est
ressortie&#160;: JavaScript n&#8217;a plus Ã  rougir ni Ã  Ãªtre relÃ©guÃ© au rang de sous-langage.
Les initiatives JSLint, CommonJS et les <text:span text:style-name="T4">good&#160;parts</text:span> de
Douglas&#160;Crockford sont pour beaucoup dans la crÃ©ation de code Ã©lÃ©gant.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">D&#8217;un autre cÃ´tÃ©, les entreprises dÃ©veloppant des navigateurs web se livrent Ã 
une fÃ©roce compÃ©tition d&#8217;optimisation.
Google, Mozilla et Apple ont besoin de navigateurs rapides pour amÃ©liorer leurs
parts de marchÃ© sur les ordinateurs, mais aussi les tÃ©lÃ©phones et tablettes.
On peut considÃ©rer que JavaScript est Ã  cette Ã©poque le langage de programmation
bÃ©nÃ©ficiant du plus grand investissement financier et humain en&#160;R&amp;D.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La communautÃ© JavaScript accueille avec ferveur Node lors
de la confÃ©rence JSConf Europe en&#160;2009.
Elle contribue Ã  son amÃ©lioration et Ã  la crÃ©ation d&#8217;un Ã©cosystÃ¨me
de modules rÃ©utilisables.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il faudra attendre la crÃ©ation de <text:span text:style-name="CodeDansTexte">npm</text:span> au tout dÃ©but 2010,
qui a pour but d&#8217;hÃ©berger des modules Node et de faciliter
leur installation.
DÃ¨s lors, une simple commande suffit pour inclure dans nos projets du
code Ã©crit par d&#8217;autres personnes.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="CodeDansTexte">npm</text:span> devient une pierre angulaire, Ã  tel point qu&#8217;il est inclus dans
l&#8217;installation de Node Ã  partir de la version&#160;0.6.3 en novembre&#160;2011.
La communautÃ© Node fait le reste du travail
en constituant un <text:span text:style-name="T7">Ã©cosystÃ¨me de modules riches et variÃ©s</text:span>&#160;:
frameworks web, pilotes de bases de donnÃ©es,
serveurs HTTP, serveurs WebSockets, prÃ©processeurs CSS,
CoffeeScript, parseurs, proxy, serveurs de log, modules de tests,
langages de <text:span text:style-name="T4">templating</text:span>,&#160;etc.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">MalgrÃ© ses dÃ©fauts de jeunesse, Node rÃ©ussit le tour
de force de la performance.
La recette de l&#8217;accÃ¨s non-bloquant a-t-elle fonctionnÃ©&#160;?
Ã€ en croire les personnes ayant migrÃ© vers Node pour ces raisons,
la rÃ©ponse est "oui".</text:p>
<text:bookmark text:name="ref-avoiding-node" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Pourquoi Ã©viter Node.js ?</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il est tentant de vouloir suivre un chemin populaire,
d&#8217;adopter le dernier outil ou framework Ã  la&#160;mode.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">J&#8217;ai pourtant envie d&#8217;Ã©crire qu&#8217;il n&#8217;est pas forcÃ©ment nÃ©cessaire
de passer Ã &#160;Node.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Si votre Ã©quipe dispose dÃ©jÃ  de fortes compÃ©tences,
d&#8217;aisance et de productivitÃ© dans un autre langage,
il n&#8217;y a pas de raison de passer Ã  Node.
Cette Ã©quipe a tout intÃ©rÃªt Ã  capitaliser sur ses
connaissances pour Ãªtre efficace et minimiser la dette technique
de ses applications.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L'<text:span text:style-name="T7">offre logicielle est Ã©galement Ã  prendre en compte</text:span>&#160;: CMS,
systÃ¨mes e-commerce ou autre application prÃªte Ã  l&#8217;emploi
que la communautÃ© Node n&#8217;offrirait pas Ã  ce&#160;jour.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un facteur important et souvent oubliÃ© est
<text:span text:style-name="T7">l&#8217;acceptation et la comprÃ©hension de l&#8217;utilisation de Node</text:span> par une Ã©quipe.
Il est alors plus intÃ©ressant de comprendre les raisons
d&#8217;un blocage que de forcer ou d&#8217;imposer cet outil.
La solution peut Ãªtre simple&#160;: balayer des idÃ©es reÃ§ues,
animer un atelier technique ou inviter unÂ·e expertÂ·e
pour rÃ©pondre aux questions, interrogations et utilitÃ© d&#8217;un tel changement.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Node ne vous aidera probablement pas si vous cherchez
Ã  <text:span text:style-name="T7">rÃ©aliser des choses contre-productives pour JavaScript</text:span>.
Je pense Ã  des opÃ©rations mathÃ©matiques de trÃ¨s haute prÃ©cision,
de l&#8217;apprentissage automatique avancÃ© (<text:span text:style-name="T4">machine learning</text:span>) ou
du calcul scientifique poussÃ© par exemple.
Il est difficile d&#8217;Ã©galer la richesse fonctionnelle de Python
et de ses bibliothÃ¨ques (SciPy, NumPy, scikit-learn)
ou la finesse de gestion de mÃ©moire de&#160;C&#43;&#43; ou de&#160;Rust.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T7">Node ne rÃ©sout pas les problÃ¨mes par magie</text:span>.
Cela reste avant tout une affaire de compÃ©tences et d&#8217;expÃ©rience.</text:p>
<text:bookmark text:name="ref-pourquoi_choisir_node_js" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Pourquoi choisir Node.js ?</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Node est un choix de langage principal tout Ã  fait viable.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il est prÃ©fÃ©rable que ce choix soit une <text:span text:style-name="T7">volontÃ© partagÃ©e</text:span> entre membres d&#8217;une Ã©quipe,
qu&#8217;il soit motivÃ© par ce que Node apporte et simplifie pour&#160;vous.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Node est tout dÃ©signÃ© pour crÃ©er des <text:span text:style-name="T7">applications Ã  nombreuses actions concurrentes</text:span>&#160;;
autrement dit, dÃ¨s qu&#8217;une application ou programme fait appel Ã  des accÃ¨s rÃ©seau,
aux fichiers ou au systÃ¨me.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Node est Ã©galement adaptÃ© pour <text:span text:style-name="T7">transformer des flux importants de donnÃ©es</text:span>
en Ã©conomisant la mÃ©moire.
Cela concerne aussi bien la lecture de fichiers CSV, JSON ou XML de plusieurs gigaoctets.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le mÃ©canisme de modules de Node encourage Ã  respecter le <text:span text:style-name="T4">principe de responsabilitÃ© unique</text:span>.
Nos applications seront <text:span text:style-name="T7">modulaires et autonomes</text:span> au lieu d&#8217;Ãªtre lourdes et monolithiques.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les dÃ©veloppeurs et dÃ©veloppeuses verront dans Node leur
<text:span text:style-name="T7">compagnon idÃ©al pour compiler, gÃ©nÃ©rer, assembler et minifier</text:span> leurs applications <text:span text:style-name="T4">front-end</text:span>.
Le bÃ©nÃ©fice Ã©vident est le partage d&#8217;un outillage CSS, JavaScript et HTML
entre Ã©quipes, par projet.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">ConsÃ©quence directe, Node offre l&#8217;opportunitÃ© d'<text:span text:style-name="T7">unifier vos Ã©quipes de dÃ©veloppement <text:span text:style-name="T4">front-end</text:span> et <text:span text:style-name="T4">back-end</text:span></text:span>.
Il devient un environnement commun, un langage partagÃ© entre les individus,
qui peuvent se focaliser sur des fonctionnalitÃ©s quelle que soit la cible,
aussi bien pour le Web, un serveur ou une&#160;API.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Node est un environnement adaptÃ© Ã  <text:span text:style-name="T7">l&#8217;apprentissage et l&#8217;amÃ©lioration de nos connaissances en JavaScript</text:span>.
On peut dÃ©sormais penser sur du long terme, en se souciant moins de devoir supporter de vieilles versions de Node ou de navigateurs web tant il est facile de passer d&#8217;une version du langage Ã  une autre.</text:p>
<text:bookmark text:name="ref-lÃ©cosystÃ¨me_des_acteurs" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">L&#8217;Ã©cosystÃ¨me des acteurs</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les dÃ©veloppements initiaux de Node sont en majoritÃ© financÃ©s par Joyent,
Ã  commencer par l&#8217;embauche de Ryan&#160;Dahl.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;Ã©cosystÃ¨me des acteurs se diversifie avec le temps.
Avec de nouveaux employÃ©s chez Joyent, puis avec des contributeurs externes
qui voient un avenir prometteur dans le projet.
S&#8217;ensuivent des entreprises privÃ©es comme IBM ou PayPal, qui sponsorisent le
projet ou le salaire de contributeurs.</text:p>
<text:bookmark text:name="ref-joyent" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Joyent</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Joyent est une entreprise amÃ©ricaine fondÃ©e en&#160;2004.
Elle propose Ã  l&#8217;origine des services de collaborations
en ligne&#160;: documents, calendriers, courriels,&#160;etc.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Elle se lance sur le marchÃ© de l&#8217;hÃ©bergement fin&#160;2005
par le biais d&#8217;une acquisition-fusion.
Parmi ses clients, on dÃ©nombre le site de Ruby&#160;on&#160;Rails
(sociÃ©tÃ© Basecamp), WordPress.com (sociÃ©tÃ© Automattic) ou
encore le site historique A&#160;List&#160;Apart (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://alistapart.com" text:visited-style-name="Visited_20_Internet_20_Link">https://alistapart.com</text:a></text:span>).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">En&#160;2009, Joyent se spÃ©cialise dans les infrastructures et
plates-formes Ã  la demande et Ã  haute performance.
L&#8217;entreprise se concentre sur des solutions dites temps rÃ©el
pour les rÃ©seaux sociaux, applications mobiles et compagnies
de jeux vidÃ©o en ligne.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">En avril&#160;2011, Joyent dÃ©pose la marque <text:span text:style-name="T4">Node.js</text:span> ainsi que son&#160;logo.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-01/images/nodejs-new-pantone-black.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>1-undefined.</text:span> Logo officiel de Node.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">En fÃ©vrier&#160;2015, Joyent transfÃ¨re la gestion de Node Ã  la
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-node-foundation"  text:visited-style-name="Visited_20_Internet_20_Link">Node.js&#160;Foundation</text:a>, mais reste propriÃ©taire de
la marque et de son&#160;logo.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Lien</text:span> Annonce du dÃ©pÃ´t de marque</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Ryan&#160;Dahl, alors dÃ©veloppeur actif de Node, annonce le dÃ©pÃ´t de marque par
l&#8217;entreprise Joyent sur le blog officiel du projet
(<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://nodejs.org/en/blog/uncategorized/trademark/" text:visited-style-name="Visited_20_Internet_20_Link">https://nodejs.org/en/blog/uncategorized/trademark/</text:a></text:span>).</text:p>
<text:bookmark text:name="ref-npm" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">npm</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">npm</text:span> est une dÃ©nomination qui abrite plusieurs concepts&#160;: un outil en ligne
de commandes, un registre de modules ainsi qu&#8217;une entreprise privÃ©e Ã  but lucratif
().</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ã€ l&#8217;origine, c&#8217;est un module Node crÃ©Ã© par Isaac&#160;Schlueter,
qui sert Ã  installer des modules tiers et Ã  les lier sous forme d&#8217;un
arbre de dÃ©pendances.
Il est lâ€™Ã©quivalent de RubyGems (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://rubygems.org" text:visited-style-name="Visited_20_Internet_20_Link">https://rubygems.org</text:a></text:span>) pour Ruby, de
CPAN (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://www.cpan.org" text:visited-style-name="Visited_20_Internet_20_Link">http://www.cpan.org</text:a></text:span>) pour Perl ou encore de PyPI
(<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://pypi.python.org/pypi" text:visited-style-name="Visited_20_Internet_20_Link">https://pypi.python.org/pypi</text:a></text:span>) pour Python.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous reviendrons plus en dÃ©tail sur son utilisation dans le
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-05"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;5</text:a>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="CodeDansTexte">npm</text:span> dÃ©signe Ã©galement le registre principal qui hÃ©berge les modules des
communautÃ©s Node&#160;: <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com</text:a></text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Lien</text:span> Annonce de l&#8217;inclusion de <text:span text:style-name="T4">npm</text:span> dans Node</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque"><text:span text:style-name="CodeDansTexte">npm</text:span> est installÃ© par dÃ©faut avec Node depuis la version&#160;0.6.3,
sortie en novembre&#160;2011.
Vous retrouverez son annonce sur <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://nodejs.org/en/blog/release/v0.6.3/" text:visited-style-name="Visited_20_Internet_20_Link">https://nodejs.org/en/blog/release/v0.6.3/</text:a></text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Auparavant, il fallait l&#8217;installer sÃ©parÃ©ment.</text:p>
<text:bookmark text:name="ref-npm-inc" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">npm,&#160;Inc.</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Isaac&#160;Schlueter est embauchÃ© par Joyent en septembre&#160;2010.
Il succÃ¨de Ã  Ryan&#160;Dahl dans la gestion du projet Node de
janvier&#160;2012 jusqu&#8217;Ã  janvier&#160;2014, date Ã  laquelle il quitte Joyent
pour fonder npm,&#160;Inc.
Cette entreprise a pour but de fournir des solutions professionnelles basÃ©es
sur <text:span text:style-name="CodeDansTexte">npm</text:span> et soutient en parallÃ¨le l&#8217;effort open source
et les coÃ»ts dâ€™infrastructure du registre.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Elle lÃ¨ve 2,6&#160;millions de dollars en fÃ©vrier&#160;2014 pour Ã©laborer
une nouvelle architecture du registre <text:span text:style-name="CodeDansTexte">npm</text:span>.
Ce financement a Ã©galement pour vocation la mise en place d&#8217;une stratÃ©gie
commerciale basÃ©e sur les modules privÃ©s et les solutions professionnelles.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La sociÃ©tÃ© npm,&#160;Inc dÃ©tient les marques npm, npm,&#160;Inc ainsi que
le logo npm.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-01/images/logo-npm.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>1-undefined.</text:span> Logo officiel de npm,&#160;Inc</text:p>
<text:bookmark text:name="ref-iojs" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">io.js</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">io.js</text:span> est un <text:span text:style-name="T4">fork</text:span> de Node initiÃ© par la communautÃ© en dÃ©cembre&#160;2014
en raison de la main-mise de Joyent sur les dÃ©veloppements et de la communication
erratique sur le projet.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les objectifs initiaux du projet io.js sont doubles&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">offrir Ã  la communautÃ© Node une gestion transparente, inclusive et ouverte&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">fournir un environnement technique plus moderne, une version de&#160;V8
plus rÃ©cente, ainsi qu&#8217;une intÃ©gration rapide des nouvelles fonctionnalitÃ©s ECMAScript.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le projet io.js connaÃ®t une fin heureuse en&#160;2015&#160;:
les efforts du projet et de sa communautÃ© auront abouti Ã 
la crÃ©ation de la <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-node-foundation"  text:visited-style-name="Visited_20_Internet_20_Link">Node.js Foundation</text:a> et
du Node.js Advisory Board, respectivement l&#8217;organe
de gestion du projet et le groupe d&#8217;individus qui en a la charge.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Lien</text:span> Clap de&#160;fin</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">L&#8217;annonce de la sortie de Node&#160;v4 et de la crÃ©ation de la Node.js Foundation
est consultable Ã  l&#8217;adresse suivante&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://nodejs.org/en/blog/announcements/foundation-v4-announce/" text:visited-style-name="Visited_20_Internet_20_Link">https://nodejs.org/en/blog/announcements/foundation-v4-announce/</text:a></text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-node-foundation" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Node.js Foundation</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La Node.js Foundation (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://foundation.nodejs.org" text:visited-style-name="Visited_20_Internet_20_Link">https://foundation.nodejs.org</text:a></text:span>) est l&#8217;un des
organes officiels de gouvernance du projet Node depuis juin&#160;2015.
C&#8217;est est une organisation Ã  but non lucratif.
Elle fait elle-mÃªme partie de la Linux Foundation (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://collabprojects.linuxfoundation.org" text:visited-style-name="Visited_20_Internet_20_Link">http://collabprojects.linuxfoundation.org</text:a></text:span>),
au mÃªme titre que des projets comme Open&#160;Container, Let&#8217;s&#160;Encrypt ou&#160;Xen.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La tÃ¢che premiÃ¨re de la fondation est d&#8217;opÃ©rer la fusion entre les bases de
code de Node et d'<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-iojs"  text:visited-style-name="Visited_20_Internet_20_Link">io.js</text:a> en septembre&#160;2015.
Cela donne lieu Ã  la sortie de Node&#160;v4.0.0.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La fondation fait partie intÃ©grante de la <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-governance"  text:visited-style-name="Visited_20_Internet_20_Link">gouvernance du projet&#160;Node</text:a>.</text:p>
<text:bookmark text:name="ref-nodejitsu" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Nodejitsu</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nodejitsu est une entreprise privÃ©e amÃ©ricaine fondÃ©e en&#160;2010.
Elle vise Ã  fournir des solutions professionnelles autour de Node en tant que
<text:span text:style-name="T4">Platform&#160;as&#160;a&#160;Service</text:span> (<text:span text:style-name="T4">PaaS</text:span>), ainsi qu&#8217;avec des dÃ©pÃ´ts <text:span text:style-name="CodeDansTexte">npm</text:span> privÃ©s.<text:line-break/>Son activitÃ© en fait un concurrent direct de  et de .</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nodejitsu dÃ©montre un investissement fort dans la communautÃ© Node en contribuant
Ã  plusieurs centaines de modules.
La sociÃ©tÃ© prend en charge l&#8217;hÃ©bergement du registre <text:span text:style-name="CodeDansTexte">npm</text:span> de&#160;2010 jusqu&#8217;en dÃ©cembre&#160;2013.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">En&#160;2013, l&#8217;entreprise lance l&#8217;initiative controversÃ©e <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-scalenpm"  text:visited-style-name="Visited_20_Internet_20_Link">#scalenpm</text:a>
(voir l&#8217;encadrÃ© ci-aprÃ¨s).
Elle vise Ã  collecter des fonds pour amÃ©liorer la performance
et la stabilitÃ© du registre <text:span text:style-name="CodeDansTexte">npm</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://www.npmjs.com/" text:visited-style-name="Visited_20_Internet_20_Link">https://www.npmjs.com/</text:a></text:span>).
Nodejitsu attise les tensions avec la compagnie npm,&#160;Inc.
en tentant de lui couper l&#8217;herbe sous le pied.
Ce ne sera pas un succÃ¨s.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">En fÃ©vrier&#160;2015, la sociÃ©tÃ© amÃ©ricaine GoDaddy rachÃ¨te Nodejitsu,
absorbe son Ã©quipe et met fin Ã  ses activitÃ©s commerciales.</text:p>
<text:bookmark text:name="ref-scalenpm" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Lien</text:span> La controverse #scalenpm</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">L&#8217;initiative #scalenpm rÃ©unit quelque 326&#160;000&#160;$ auprÃ¨s
d&#8217;entreprises privÃ©es et de la communautÃ©&#160;Node.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Son effort se poursuit dans le but de fournir une meilleure instrumentation et
une architecture rÃ©sistant Ã  la montÃ©e en puissance de l&#8217;utilisation des modules <text:span text:style-name="CodeDansTexte">npm</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Cette initiative a suscitÃ© une controverse dans la mesure oÃ¹ lâ€™opÃ©ration sâ€™est
dÃ©roulÃ©e lors de la naissance de npm,&#160;Inc et du dÃ©pÃ´t de marque associÃ©,
mais sans entente apparente entre les deux parties.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Le contenu est depuis archivÃ© sur
<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://web.archive.org/web/20160506191542/https://scalenpm.nodejitsu.com/" text:visited-style-name="Visited_20_Internet_20_Link">http://web.archive.org/web/20160506191542/https://scalenpm.nodejitsu.com/</text:a></text:span>.</text:p>
<text:bookmark text:name="ref-node_security_platform" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Node Security Platform</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La Node Security Platform (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://nodesecurity.io" text:visited-style-name="Visited_20_Internet_20_Link">https://nodesecurity.io</text:a></text:span>&#160;â€“
anciennement Node Security Project) est un projet Ã  but lucratif soutenu par
la sociÃ©tÃ© amÃ©ricaine &amp;yet (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://andyet.com" text:visited-style-name="Visited_20_Internet_20_Link">https://andyet.com</text:a></text:span>).
Il a Ã©tÃ© initiÃ© au dÃ©but de l&#8217;annÃ©e&#160;2013.
La sociÃ©tÃ©, les employÃ©s et les logiciels ont Ã©tÃ© rachetÃ©s par  en&#160;2018.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Son but est triple&#160;:</text:p>
<text:p text:style-name="ListeANumero">1.<text:tab/>auditer la sÃ©curitÃ© de tous les modules <text:span text:style-name="CodeDansTexte">npm</text:span>&#160;;</text:p><text:p text:style-name="ListeANumero">2.<text:tab/>communiquer les failles auprÃ¨s des auteurs de modules&#160;;</text:p><text:p text:style-name="ListeANumero">3.<text:tab/>communiquer Ã  tous si un module donnÃ© dÃ©pend de modules vulnÃ©rables.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le projet met Ã  disposition des services et des modules,
tout en cherchant Ã  impliquer la communautÃ© Node dans le processus.
Cela concerne aussi bien la dÃ©claration des vulnÃ©rabilitÃ©s
que leur rÃ©solution ou l&#8217;Ã©ducation des dÃ©veloppeurs Ã  la sÃ©curitÃ©.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous aborderons le sujet de la sÃ©curitÃ© tout au long de cet ouvrage&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">au <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-security"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;4</text:a>&#160;: mettre Ã  jour Node en cas de failles de sÃ©curitÃ©&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">au <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-security"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;6</text:a>&#160;: surveiller la santÃ© d&#8217;une application en production&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">au <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-security"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;7</text:a>&#160;: identifier les opÃ©rations Ã  risques dans une application&#160;web.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-governance" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Gouvernance du projet</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Node a connu une forte croissance depuis&#160;2012.
La gouvernance du projet open source a Ã©tÃ© effectuÃ©e
par la <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-joyent"  text:visited-style-name="Visited_20_Internet_20_Link">sociÃ©tÃ© Joyent</text:a>.
Ses agissements et la direction donnÃ©e au projet ont rÃ©guliÃ¨rement
fait grincer des dents, notamment en entretenant un climat d&#8217;incertitude sur
la pÃ©rennitÃ© Ã  long terme, si Node venait Ã  ne plus
rÃ©pondre aux intÃ©rÃªts commerciaux de Joyent.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Des voix se sont Ã©levÃ©es pour critiquer l&#8217;absence d&#8217;une
organisation ouverte, commercialement neutre et
ouverte aux contributeurs externes.
Cela a menÃ© Ã  la crÃ©ation d&#8217;un <text:span text:style-name="T4">fork</text:span> de Node&#160;:&#160;<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-iojs"  text:visited-style-name="Visited_20_Internet_20_Link">io.js</text:a>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La rÃ©conciliation entre les projets Node et io.js a sÃ©rieusement assaini
les rapports de gouvernance.
Cela a Ã©galement apportÃ© une direction et des opportunitÃ©s plus claires
de contribuer Ã  la direction du projet.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Depuis juin&#160;2015, la gÃ©rance du projet est garantie par plusieurs entitÃ©s&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">Technical Steering Committee (TSC)&#160;: planning, dÃ©cisions techniques, direction du projet, documentation et qualitÃ© du projet&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-node-foundation"  text:visited-style-name="Visited_20_Internet_20_Link">Node.js Foundation</text:a> Board&#160;: promotion du projet, relations commerciales&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-node-foundation"  text:visited-style-name="Visited_20_Internet_20_Link">Node.js Foundation</text:a> Community Committee (CommComm)&#160;: relation avec la communautÃ©, <text:span text:style-name="T4">onboarding</text:span>.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le <text:span text:style-name="T4">Technical Steering Committee</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://github.com/nodejs/TSC" text:visited-style-name="Visited_20_Internet_20_Link">https://github.com/nodejs/TSC</text:a></text:span>) rÃ©fÃ¨re
ses intentions d&#8217;actions au <text:span text:style-name="T4">Board</text:span>.
Son fonctionnement est rÃ©gi par une charte co-signÃ©e avec ce dernier.
Ce comitÃ© est composÃ© de contributeurs et de collaborateurs individuels.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Anecdote</text:span> Une fois n&#8217;est pas coutume</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Le TSC Ã©tait autrefois dissociÃ© d&#8217;une autre entitÃ©,
le Core&#160;Technical&#160;Committee (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://github.com/nodejs/CTC" text:visited-style-name="Visited_20_Internet_20_Link">https://github.com/nodejs/CTC</text:a></text:span>).
Les conflits de gouvernance ayant rÃ©sultÃ© dans la crÃ©ation du <text:span text:style-name="T4">fork</text:span> ayo.js
ont menÃ© Ã  la fusion des deux comitÃ©s.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">L&#8217;objectif recherchÃ© Ã©tait de rapprocher gouvernance et dÃ©cisions techniques
tout en rÃ©duisant les opportunitÃ©s d&#8217;abus de pouvoir par les membres
techniques Ã©minents.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ã€ l&#8217;inverse, le <text:span text:style-name="T4">Board</text:span> gÃ©rÃ© par la <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-node-foundation"  text:visited-style-name="Visited_20_Internet_20_Link">Node.js Foundation</text:a>
est composÃ© essentiellement d&#8217;acteurs de l&#8217;industrie&#160;â€“ dont Google,
IBM, Joyent et PayPal.
Certains membres Ã©mÃ©rites ou choisis par le <text:span text:style-name="T4">Board</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://github.com/nodejs/board" text:visited-style-name="Visited_20_Internet_20_Link">https://github.com/nodejs/board</text:a></text:span>)
sont des individus agissant en leur nom propre.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les participantÂ·eÂ·s du TSC ont une obligation
de rÃ©gularitÃ©, de prÃ©sence et de vote aux diffÃ©rents rendez-vous
organisÃ©s par le comitÃ©.
Ce mÃ©canisme a Ã©tÃ© choisi afin de prÃ©server la vitalitÃ© du projet.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un quota d&#8217;appartenance Ã  une mÃªme entreprise a Ã©tÃ© mis en place
pour maintenir une diversitÃ© de reprÃ©sentation.
Dans une moindre mesure, ce mÃ©canisme vise Ã  rÃ©duire les possibles conflits
d&#8217;intÃ©rÃªts ou une prise en otage du projet comme a pu le faire
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-joyent"  text:visited-style-name="Visited_20_Internet_20_Link">Joyent</text:a> avant l&#8217;apparition de ce modÃ¨le de gouvernance.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Liens</text:span> Documentation</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Les documents clÃ©s rÃ©gissant le fonctionnement du projet Node
sont rÃ©partis dans les dÃ©pÃ´ts GitHub des diffÃ©rents acteurs&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://github.com/nodejs/node/blob/master/GOVERNANCE.md" text:visited-style-name="Visited_20_Internet_20_Link">https://github.com/nodejs/node/blob/master/GOVERNANCE.md</text:a></text:span></text:p>
</text:list-item><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://github.com/nodejs/TSC/blob/master/TSC-Charter.md" text:visited-style-name="Visited_20_Internet_20_Link">https://github.com/nodejs/TSC/blob/master/TSC-Charter.md</text:a></text:span></text:p>
</text:list-item><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://github.com/nodejs/admin/blob/master/CODE_OF_CONDUCT.md" text:visited-style-name="Visited_20_Internet_20_Link">https://github.com/nodejs/admin/blob/master/CODE_OF_CONDUCT.md</text:a></text:span></text:p>
</text:list-item><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://github.com/nodejs/node/blob/master/COLLABORATOR_GUIDE.md" text:visited-style-name="Visited_20_Internet_20_Link">https://github.com/nodejs/node/blob/master/COLLABORATOR_GUIDE.md</text:a></text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-conclusion" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Conclusion</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous venons d&#8217;en apprendre davantage sur les origines de Node,
les diffÃ©rentes parties prenantes dans son dÃ©veloppement, mais aussi sa
philosophie&#160;â€“ de conception, de distribution et d&#8217;Ã©volution.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous allons voir dans le prochain chapitre comment installer un environnement
fonctionnel pour dÃ©velopper et exÃ©cuter des programmes&#160;Node.</text:p>
<text:bookmark text:name="ref-chapter-02" /><text:p text:style-name="ChapitreNumero">2</text:p><text:h text:style-name="ChapitreTitre" text:outline-level="1">Installer, mettre Ã  jour et dÃ©velopper</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Installons Node et l&#8217;outillage de dÃ©veloppement qui nous correspond le mieux,
peu importe notre niveau de familiaritÃ© avec le dÃ©veloppement logiciel.</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">Installer Node.js sur notre ordinateur</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Choisir un Ã©diteur de code pour Ã©crire nos programmes</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">DÃ©terminer quand migrer vers une nouvelle version de Node.js</text:p>
</text:list-item></text:list>
<text:p text:style-name="ChapitreIntroduction"><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Certains systÃ¨mes d&#8217;exploitation embarquent l&#8217;environnement d&#8217;exÃ©cution Node,
tandis que d&#8217;autres ne le font pas, ou alors dans une version trop ancienne.
IdÃ©alement, nous voudrions pouvoir <text:span text:style-name="T7">installer la version de Node de notre choix</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les <text:span text:style-name="T7">Ã©diteurs de code</text:span> nous facilitent la vie en rendant le code lisible
en ajoutant de la couleur et des repÃ¨res visuels.
Ces logiciels nous invitent Ã  piocher dans leur bibliothÃ¨que d&#8217;extensions
pour en faire un outil qui nous ressemble.</text:p></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Remarque</text:span> Versions de Node et npm</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Le contenu de ce chapitre utilise les versions <text:span text:style-name="T7">Node&#160;v10</text:span>
et <text:span text:style-name="T7">npm&#160;v6</text:span>.
Ce sont les versions stables recommandÃ©es en&#160;2019.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il n&#8217;est pas nÃ©cessaire d&#8217;avoir suivi des Ã©tudes d&#8217;informatique
pour vouloir s&#8217;essayer Ã  la programmation.
Cela n&#8217;implique pas non plus d&#8217;en faire son mÃ©tier.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Que l&#8217;on se qualifie de dÃ©butantÂ·e, confirmÃ©Â·e ou expertÂ·e,
il y a un petit rituel auquel on coupera difficilement&#160;:</text:p>
<text:p text:style-name="ListeANumero">1.<text:tab/>installer Node.js pour <text:span text:style-name="T7">voir le rÃ©sultat de nos programmes</text:span> Ã©crits en JavaScript&#160;;</text:p><text:p text:style-name="ListeANumero">2.<text:tab/>installer un Ã©diteur de code pour <text:span text:style-name="T7">Ã©crire nos programmes JavaScript plus confortablement</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Si l&#8217;idÃ©e est de jouer rapidement avec du code,
sans rien installer et avec le premier ordinateur qui vous passe sous la main,
je vous invite Ã  aller directement Ã  la section
<text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-online"  text:visited-style-name="Visited_20_Internet_20_Link">Sans installation, dans un navigateur web</text:a></text:span> ci-aprÃ¨s.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les sections qui suivent vont vous aider Ã  crÃ©er un environnement Node Ã  jour
sur votre ordinateur.
Ce contenu s&#8217;applique Ã©galement Ã  un serveur destinÃ© Ã  hÃ©berger vos applications.</text:p>
<text:bookmark text:name="ref-install" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Installer Node.js</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il y a plusieurs maniÃ¨res d&#8217;installer Node sur une machine.
Elles sont <text:span text:style-name="T4">toutes</text:span> correctes.
Certaines sont plus adaptÃ©es que d&#8217;autres,
selon votre aisance avec un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-shell"  text:visited-style-name="Visited_20_Internet_20_Link">terminal</text:a>
et selon le besoin de jongler rapidement entre diffÃ©rentes versions de Node.</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">Si vous vous Ãªtes dÃ©jÃ  servi d&#8217;un terminal&#160;: je recommande d&#8217;utiliser <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-nvm"  text:visited-style-name="Visited_20_Internet_20_Link">nvm</text:a>.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Si vous ne vous Ãªtes jamais servi d&#8217;un terminal&#160;: il est plus simple d&#8217;utiliser un <text:span text:style-name="T4">installeur</text:span> depuis le site officiel de Node.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Si vous souhaitez maÃ®triser les options d&#8217;installation&#160;: il serait logique de <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-build"  text:visited-style-name="Visited_20_Internet_20_Link">compiler depuis les <text:span text:style-name="T4">sources</text:span></text:a> et/ou <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-docker"  text:visited-style-name="Visited_20_Internet_20_Link">d&#8217;utiliser Docker</text:a>.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Si rien de tout Ã§a ne vous parle&#160;: des services en ligne rendent <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-online"  text:visited-style-name="Visited_20_Internet_20_Link">Node accessible depuis un simple navigateur&#160;web</text:a>.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Question</text:span> Pourquoi utiliser un installeur ?</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Les installeurs facilitent l&#8217;installation de Node, en quelques clics et sans toucher Ã  un terminal.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Si vous utilisez un installeur correspondant Ã  une version plus rÃ©cente de Node,
c&#8217;est celle-ci qui sera utilisÃ©e dans <text:span text:style-name="T4">tous</text:span> vos projets.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">C&#8217;est la solution la plus simple pour installer Node.</text:p>
<text:bookmark text:name="ref-online" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Sans installation, dans un navigateur web</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il est facile de s&#8217;essayer Ã  Node avec un navigateur web moderne comme
Firefox, Edge ou Chrome.
Des services en ligne combinent un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-ide"  text:visited-style-name="Visited_20_Internet_20_Link">Ã©diteur de texte</text:a>
et un environnement d&#8217;exÃ©cution Node Ã  distance.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous brosserons le portrait de trois services qui diffÃ¨rent par leurs
fonctionnalitÃ©s et leur rapiditÃ© de prise en main&#160;:_RunKit, Codenvy et Cloud9.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">RunKit (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://runkit.com" text:visited-style-name="Visited_20_Internet_20_Link">https://runkit.com</text:a></text:span>) est de loin le service le plus simple.
Il s&#8217;articule autour d&#8217;un concept de <text:span text:style-name="T4">bac Ã  sable</text:span>&#160;;
notre code ne sera pas plus long qu&#8217;un fichier.
Pour crÃ©er un nouveau bac Ã  sable,
il suffit de se rendre sur <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://runkit.com/new" text:visited-style-name="Visited_20_Internet_20_Link">https://runkit.com/new</text:a></text:span>.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-02/images/runkit-playground.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>2-undefined.</text:span> Bac Ã  sable sur RunKit</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Codenvy (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://codenvy.io" text:visited-style-name="Visited_20_Internet_20_Link">https://codenvy.io</text:a></text:span>) est un service basÃ© sur le
logiciel open source Eclipse et Ã©ditÃ© par la compagnie Red&#160;Hat.
L&#8217;interface est organisÃ©e exactement comme un des <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-ide"  text:visited-style-name="Visited_20_Internet_20_Link">Ã©diteurs de texte</text:a>
abordÃ© plus loin dans ce chapitre.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-02/images/codenvy-workspace.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>2-undefined.</text:span> Espace de travail sur Codenvy</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le processus de crÃ©ation de projet est relativement intuitif
et il est trÃ¨s facile d&#8217;importer du code hÃ©bergÃ© en ligne, sur GitHub
notamment.
La configuration minimale d&#8217;un projet est gratuite tandis que
les fonctionnalitÃ©s avancÃ©es et le travail en Ã©quipe sont payantes.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-02/images/codenvy-dashboard.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>2-undefined.</text:span> Processus de crÃ©ation d&#8217;un espace de travail sur Codenvy</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Enfin, Cloud9 (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://c9.io" text:visited-style-name="Visited_20_Internet_20_Link">https://c9.io</text:a></text:span>) est un service propriÃ©taire
Ã©ditÃ© par la compagnie Amazon Web Services (AWS, <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://aws.amazon.com" text:visited-style-name="Visited_20_Internet_20_Link">https://aws.amazon.com</text:a></text:span>).
Il intÃ¨gre des fonctionnalitÃ©s similaires Ã  celles de Codenvy
(Ã©diteur en ligne, configuration de machine)
et s&#8217;intÃ¨gre de maniÃ¨re poussÃ©e avec les autres services d&#8217;AWS,
dont <text:span text:style-name="T4">EC2</text:span> et <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-hosting.lambda"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="T4">Lambda</text:span></text:a>
(<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-06"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre 6</text:a>).
Le service est entiÃ¨rement gratuit&#160;; c&#8217;est la consommation de ressources qui
est payante, Ã  l&#8217;heure, en fonction du dimensionnement des ressources demandÃ©es.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-02/images/cloud9-configuration.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>2-undefined.</text:span> Configuration d&#8217;un espace de travail Cloud9</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cloud9 a peu d&#8217;opinions sur la maniÃ¨re dont votre environnement
doit Ãªtre configurÃ©.
Tout devra Ãªtre configurÃ©, des accÃ¨s Ã  votre compte GitHub Ã  la version de
Node Ã  installer.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-02/images/cloud9-workspace.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>2-undefined.</text:span> Espace de travail sur Cloud9</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cela tombe bien, <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-nvm"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">nvm</text:span></text:a> est prÃ©installÃ© sur chaque espace de travail.</text:p>
<text:bookmark text:name="ref-nvm" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Plusieurs versions sur la mÃªme machine&#160;(nvm)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="CodeDansTexte">nvm</text:span> est l&#8217;acronyme de <text:span text:style-name="T4">Node Version Manager</text:span>.
Ce logiciel permet d'<text:span text:style-name="T7">installer plusieurs versions de Node sur un mÃªme ordinateur</text:span>.
Si vous Ãªtes sous Windows, <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-nvm-windows"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">nvm-windows</text:span></text:a> offre exactement
les mÃªmes fonctionnalitÃ©s (voir encadrÃ©).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Si vous venez d&#8217;un autre univers de programmation,
<text:span text:style-name="CodeDansTexte">nvm</text:span> est l&#8217;Ã©quivalent de <text:span text:style-name="CodeDansTexte">rvm</text:span> ou <text:span text:style-name="CodeDansTexte">rbenv</text:span> dans le monde Ruby, de <text:span text:style-name="CodeDansTexte">phpenv</text:span> dans
le monde PHP ou encore de <text:span text:style-name="CodeDansTexte">virtualenv</text:span> pour Python.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le programme s&#8217;obtient Ã  l&#8217;adresse suivante&#160;: <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://github.com/creationix/nvm" text:visited-style-name="Visited_20_Internet_20_Link">https://github.com/creationix/nvm</text:a></text:span>.</text:p>
<text:bookmark text:name="ref-nvm-windows" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Alternatives</text:span> <text:span text:style-name="CodeDansTexte">nvm</text:span> pour&#160;Windows</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque"><text:span text:style-name="CodeDansTexte">nvm</text:span> ne fonctionne pas sur les ordinateurs Ã©quipÃ©s de Windows.
Il existe trois alternatives&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="CodeDansTexte">nvm-windows</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://github.com/coreybutler/nvm-windows" text:visited-style-name="Visited_20_Internet_20_Link">https://github.com/coreybutler/nvm-windows</text:a></text:span>) offre
les mÃªmes fonctionnalitÃ©s que son Ã©quivalent pour Linux et macOS.
Il est facile Ã  installer et ne demande pas de privilÃ¨ge systÃ¨me particulier
pour fonctionner.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="RemarquePuce">Deux autres solutions sont Ã  essayer si <text:span text:style-name="CodeDansTexte">nvm-windows</text:span> pose problÃ¨me&#160;:
<text:span text:style-name="CodeDansTexte">nvmw</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://github.com/hakobera/nvmw" text:visited-style-name="Visited_20_Internet_20_Link">https://github.com/hakobera/nvmw</text:a></text:span>) et
<text:span text:style-name="CodeDansTexte">nodist</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://github.com/marcelklehr/nodist" text:visited-style-name="Visited_20_Internet_20_Link">https://github.com/marcelklehr/nodist</text:a></text:span>).</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">Commande d&#8217;installation du logiciel nvm&#160;v0.33.11</text:p><text:p text:style-name="Code">$ curl -L https://github.com/creationix/nvm/raw/v0.33.11/install.sh | bash</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Alternative</text:span> nvm sous macOS</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque"><text:span text:style-name="CodeDansTexte">nvm</text:span> et Node s&#8217;installent encore plus facilement sous macOS si vous
utilisez le logiciel <text:span text:style-name="T4">Homebrew</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Rendez-vous dans la section Â«&#160;<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-install-macos"  text:visited-style-name="Visited_20_Internet_20_Link">macOS</text:a>{nbdp}Â» pour en
savoir&#160;plus.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous sommes libres d&#8217;installer toutes les versions de Node qui nous intÃ©ressent
en appelant la commande <text:span text:style-name="CodeDansTexte">nvm install</text:span> dans un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-shell"  text:visited-style-name="Visited_20_Internet_20_Link">terminal</text:a>.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">Installation de deux versions diffÃ©rentes de&#160;Node</text:p><text:p text:style-name="Code">$ nvm install v10</text:p><text:p text:style-name="Code">$ nvm install v9</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans cet exemple, nous installons deux versions de Node sur le mÃªme
ordinateur.
La version active est la derniÃ¨re installÃ©e.
On retrouve Ã  tout moment les versions installÃ©es avec la commande <text:span text:style-name="CodeDansTexte">nvm ls</text:span>.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">Liste des versions installÃ©es de Node avec la commande <text:span text:style-name="CodeDansTexte">nvm&#160;ls</text:span></text:p><text:p text:style-name="Code">$ nvm ls</text:p><text:p text:style-name="Code">-&gt;<text:s text:c="7"/>v10.9.0</text:p><text:p text:style-name="Code"><text:s text:c="9"/>v9.0.0</text:p><text:p text:style-name="Code"><text:s text:c="9"/>system</text:p><text:p text:style-name="Code">default -&gt; v10 (-&gt; v10.9.0) (default)</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cet exemple dÃ©taille la liste des versions de Node installÃ©es
et celle des <text:span text:style-name="T4">alias</text:span>&#160;â€“ associations entre un libellÃ© et une version.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La commande <text:span text:style-name="CodeDansTexte">nvm use</text:span> nous fait naviguer entre des versions diffÃ©rentes de Node.
L&#8217;utilisation rÃ©pÃ©tÃ©e de <text:span text:style-name="CodeDansTexte">nvm use v10</text:span> et de
<text:span text:style-name="CodeDansTexte">nvm use v9</text:span> nous fera aller et venir entre ces deux versions,
sans rien perdre de ce que nous Ã©tions en train de faire.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La commande <text:span text:style-name="CodeDansTexte">nvm --help</text:span> affiche de l&#8217;aide Ã  propos des commandes disponibles.
J&#8217;utilise principalement les suivantes&#160;:
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="CodeDansTexte">nvm install</text:span>&#160;: installe ou met Ã  jour une version de Node.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="CodeDansTexte">nvm ls</text:span>&#160;: liste les versions installÃ©es.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="CodeDansTexte">nvm use</text:span>&#160;: bascule vers une version donnÃ©e.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="CodeDansTexte">nvm alias &lt;nom&gt; &lt;version&gt;</text:span>&#160;: crÃ©e un alias nommÃ© vers une version.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="CodeDansTexte">nvm run &lt;version&gt; &lt;script&gt;</text:span>&#160;: exÃ©cute un script Node dans une version donnÃ©e.
undefined</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Quand nous avons fixÃ© une version de Node Ã  utiliser au quotidien,
l&#8217;alias spÃ©cial <text:span text:style-name="CodeDansTexte">default</text:span> en fait la version qui est systÃ©matiquement activÃ©e&#160;:
undefined</text:p>
<text:p text:style-name="Code">$ nvm alias default 10</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La commande <text:span text:style-name="CodeDansTexte">nvm use</text:span> nous sert alors Ã  activer une autre version pendant
la durÃ©e nÃ©cessaire Ã  notre expÃ©rimentation.</text:p>
<text:bookmark text:name="ref-install-ubuntu" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Distributions Linux : Debian/Ubuntu et RedHat/CentOS</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ces distributions Linux listent Node dans leurs paquets officiels.
Un simple <text:span text:style-name="CodeDansTexte">apt-get install nodejs</text:span> et Ã§a fonctionne&#160;!
Ou presque, car bien souvent on Ã©copera d&#8217;une vieille version de&#160;Node.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Des paquets officiels pour Debian (â‰¥&#160;jessie), Ubuntu (â‰¥&#160;12.04), Mint,
RedHat Enterprise Linux (RHEL) et CentOS sont maintenus sur
<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://github.com/nodesource/distributions" text:visited-style-name="Visited_20_Internet_20_Link">https://github.com/nodesource/distributions</text:a></text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;installation de Node&#160;10.x sous Ubuntu et Mint se rÃ©sume
aux commandes suivantes&#160;:</text:p>
<text:p text:style-name="Code">$ sudo su</text:p><text:p text:style-name="Code">$ curl -sL https://deb.nodesource.com/setup_10.x | bash -</text:p><text:p text:style-name="Code">$ sudo apt-get install -y nodejs</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Pour Debian, il faudra se mettre en <text:span text:style-name="CodeDansTexte">root</text:span> et ensuite saisir ces commandes&#160;:</text:p>
<text:p text:style-name="Code">$ curl -sL https://deb.nodesource.com/setup_10.x | bash -</text:p><text:p text:style-name="Code">$ apt-get install -y nodejs</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Pour RHEL et CentOS, il faudra se mettre en <text:span text:style-name="CodeDansTexte">root</text:span> et saisir la commande suivante&#160;:</text:p>
<text:p text:style-name="Code">$ curl -sL https://rpm.nodesource.com/setup_{v}.x | bash -</text:p>
<text:bookmark text:name="ref-distributions_linux_lesautres" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Distributions Linux : les&#160;autres</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Des paquets officiels pour d&#8217;autres distributions que Debian, Ubuntu et Mint
sont maintenus et accessibles par le biais des gestionnaires de paquets habituels&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">Gentoo&#160;: <text:span text:style-name="CodeDansTexte">emerge nodejs</text:span></text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Fedora (â‰¥ 18)&#160;: <text:span text:style-name="CodeDansTexte">sudo yum install nodejs npm</text:span></text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Arch Linux&#160;: <text:span text:style-name="CodeDansTexte">pacman -S nodejs</text:span></text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">FreeBSD, OpenBSD&#160;: <text:span text:style-name="CodeDansTexte">pkg install node</text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La liste Ã  jour est maintenue sur le site officiel de Node&#160;:
<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://nodejs.org/fr/download/package-manager" text:visited-style-name="Visited_20_Internet_20_Link">https://nodejs.org/fr/download/package-manager</text:a></text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Notez que vous pouvez aussi utiliser <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-nvm"  text:visited-style-name="Visited_20_Internet_20_Link">nvm</text:a> pour gÃ©rer vos versions de
Node indÃ©pendamment du cycle de vie de votre systÃ¨me d&#8217;exploitation Linux.</text:p>
<text:bookmark text:name="ref-install-macos" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">macOS</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un installeur officiel pour macOS est fourni sur le site de Node,
Ã  l&#8217;adresse <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://nodejs.org/fr/download/" text:visited-style-name="Visited_20_Internet_20_Link">https://nodejs.org/fr/download/</text:a></text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-nvm"  text:visited-style-name="Visited_20_Internet_20_Link">nvm</text:a> est la voie alternative recommandÃ©e pour gÃ©rer plusieurs versions
de Node en parallÃ¨le.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il est toutefois possible d&#8217;installer Node et <text:span text:style-name="CodeDansTexte">nvm</text:span> via le gestionnaire de
paquets Homebrew (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://brew.sh" text:visited-style-name="Visited_20_Internet_20_Link">https://brew.sh</text:a></text:span>).
Il aide Ã  installer des logiciels qui ne sont pas distribuÃ©s via le
<text:span text:style-name="T4">Mac&#160;App&#160;Store</text:span>.</text:p>
<text:p text:style-name="ListeANumero">1.<text:tab/>Installer les <text:span text:style-name="T4">Command Line Tools</text:span> pour compiler des logiciels depuis leur code source.</text:p><text:p text:style-name="ListeANumero">2.<text:tab/>Installation Homebrew.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">Installation des Command Line Tools et de Homebrew sous macOS</text:p><text:p text:style-name="Code">$ xcode-select --install</text:p><text:p text:style-name="Code">$ BREWRL=https://rawgit.com/Homebrew/install/master/install \</text:p><text:p text:style-name="Code"><text:s text:c="3"/>/usr/bin/ruby -e "$(curl -fsSL $BREWRL)"</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Pour installer <text:span text:style-name="CodeDansTexte">nvm</text:span>, il suffit alors de lancer la commande suivante&#160;:</text:p>
<text:p text:style-name="Code">$ brew install nvm</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ou, pour installer une seule version de Node, la plus rÃ©cente&#160;:</text:p>
<text:p text:style-name="Code">$ brew install node</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Vous obtiendrez des options d&#8217;installation et de configuration en tapant
<text:span text:style-name="CodeDansTexte">brew info nvm</text:span> et/ou <text:span text:style-name="CodeDansTexte">brew info node</text:span>.</text:p>
<text:bookmark text:name="ref-windows" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Windows</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un installeur officiel pour Windows est fourni sur le site de Node Ã  l&#8217;adresse
<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://nodejs.org/fr/download/" text:visited-style-name="Visited_20_Internet_20_Link">https://nodejs.org/fr/download/</text:a></text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-nvm"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">nvm-windows</text:span></text:a> est la voie alternative recommandÃ©e pour gÃ©rer plusieurs
versions de Node en parallÃ¨le.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-02/images/windows-node-installer.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>2-undefined.</text:span> Un des Ã©crans d&#8217;installation de Node sous&#160;Windows&#160;10</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;installeur officiel crÃ©era plusieurs raccourcis dans le
dossier du menu <text:span text:style-name="Menu">DÃ©marrer / Node.js</text:span>&#160;:</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-02/images/windows-node-menu.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>2-undefined.</text:span> Node.js dans le menu DÃ©marrer sous&#160;Windows&#160;10</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le menu crÃ©Ã© par l&#8217;installeur contient deux icÃ´nes que nous utiliserons tout
au long de la lecture de cet ouvrage&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="Menu">Node.js / Node.js</text:span>&#160;: un terminal pour jouer avec JavaScript et voir les rÃ©sultats que
Node va interprÃ©ter&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="Menu">Node.js / Node.js command prompt</text:span>&#160;: un terminal pour exÃ©cuter nos programmes Ã©crits
en JavaScript.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Si vous utilisez dÃ©jÃ  un gestionnaire de paquets comme Scoop (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://scoop.sh" text:visited-style-name="Visited_20_Internet_20_Link">http://scoop.sh</text:a></text:span>)
ou Chocolatey (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://chocolatey.org" text:visited-style-name="Visited_20_Internet_20_Link">https://chocolatey.org</text:a></text:span>),
le chemin d&#8217;installation vers Node s&#8217;en trouvera rÃ©duit Ã  une simple commande&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">Avec Scoop</text:p><text:p text:style-name="Code">$ scoop install nodejs</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">Avec Chocolatey</text:p><text:p text:style-name="Code">$ choco install nodejs</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Attention</text:span> Versions de Windows</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Node n&#8217;est pas compatible avec les versions antÃ©rieures Ã  Vista.
Cela inclut Windows&#160;XP.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Mieux vaudra utiliser un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-online"  text:visited-style-name="Visited_20_Internet_20_Link">service en ligne</text:a> pour essayer Node sur
votre ordinateur ou passer Ã  Linux pour lui redonner une seconde
vie en toute sÃ©curitÃ©&#160;!</text:p>
<text:bookmark text:name="ref-install-rpi" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Raspberry&#160;Pi</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Des binaires sont disponibles pour les microcontrÃ´leurs fonctionnant avec des
processeurs ARM&#160;v6/7/8, au cÅ“ur de ce que l&#8217;on appelle
<text:span text:style-name="T4">Internet des Objets</text:span> (<text:span text:style-name="T4">Internet of Things</text:span>, <text:span text:style-name="T4">IoT</text:span>).
Ces petits ordinateurs consomment peu d&#8217;Ã©nergie, disposent d&#8217;une connectique
pour se relier Ã  Internet et s&#8217;interfacent avec toutes sortes de capteurs.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un paquet <text:span text:style-name="CodeDansTexte">deb</text:span> est Ã©galement proposÃ© pour les utilisateurs du
systÃ¨me d&#8217;exploitation Raspbian (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://www.raspbian.org" text:visited-style-name="Visited_20_Internet_20_Link">https://www.raspbian.org</text:a></text:span>).
Les instructions d&#8217;installation sont identiques Ã  celles dÃ©crites
dans la section relative aux <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-install-ubuntu"  text:visited-style-name="Visited_20_Internet_20_Link">distributions Linux&#160;Debian</text:a>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">Installation de Node&#160;v10 sur Raspberry&#160;Pi Model&#160;3 (CPU&#160;ARMv8)</text:p><text:p text:style-name="Code">$ curl -SLO https://nodejs.org/dist/v10.9.0/node-v10.9.0-linux-arm64.tar.xz</text:p><text:p text:style-name="Code">$ tar -xJf "node-v10.9.0-linux-arm64.tar.xz" -C /usr/local --strip-components=1</text:p><text:p text:style-name="Code">$ ln -s /usr/local/bin/node /usr/local/bin/nodejs</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Tous les binaires et les instructions d&#8217;installation sont disponibles
sur <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://nodejs.org/fr/download/" text:visited-style-name="Visited_20_Internet_20_Link">https://nodejs.org/fr/download/</text:a></text:span>.</text:p>
<text:bookmark text:name="ref-build" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Compiler depuis les sources</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Certaines situations exigeront que vous compiliez Node.
C&#8217;est le cas si vous cherchez Ã  travailler au plus prÃ¨s du systÃ¨me sur lequel
vous comptez dÃ©ployer vos applications.
Je pense par exemple Ã  des architectures Ã  processeur ARM, PowerPC,
IBM&#160;System/390 ou bien Ã  des systÃ¨mes Android, OpenBSD ou&#160;AIX.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La compilation manuelle est Ã©galement intÃ©ressante pour rÃ©gler plus finement
certains aspects de Node&#160;: rendre le binaire indÃ©pendant des
bibliothÃ¨ques systÃ¨me (statique), le module <text:span text:style-name="CodeDansTexte">http/2</text:span>,
langues et fuseaux horaires fonctionnels avec l&#8217;API ECMA&#160;402&#160;Intl,
options de sÃ©curitÃ© liÃ©es Ã  OpenSSL, mais aussi l&#8217;intÃ©gration avec des
profileurs et dÃ©bogueurs externes (type XCode, GNU&#160;Debugger, Intel&#160;VTune).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">Ã‰tapes de compilation de Node&#160;v10.9.0</text:p><text:p text:style-name="Code">$ curl -sS https://nodejs.org/dist/v10.9.0/node-v10.9.0.tar.gz \</text:p><text:p text:style-name="Code"><text:s text:c="2"/>| tar -zxf -</text:p><text:p text:style-name="Code">$ cd node-v10.9.0</text:p><text:p text:style-name="Code">$ ./configure &amp;&amp; make &amp;&amp; make install</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La compilation manuelle requiert la prÃ©sence de GCC (â‰¥ 4.9), de Python (â‰¥ 2.6)
et de GNU Make (â‰¥ 3.81).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les instructions de compilation varient d&#8217;un systÃ¨me d&#8217;exploitation Ã  l&#8217;autre.
Consultez les dÃ©pendances et instructions complÃ¨tes Ã 
l&#8217;adresse suivante&#160;: <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://github.com/nodejs/node/blob/master/BUILDING.md" text:visited-style-name="Visited_20_Internet_20_Link">https://github.com/nodejs/node/blob/master/BUILDING.md</text:a></text:span>.</text:p>
<text:bookmark text:name="ref-install-docker" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Images Docker</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Docker (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://docker.com" text:visited-style-name="Visited_20_Internet_20_Link">https://docker.com</text:a></text:span>) est un outil open source dit d'<text:span text:style-name="T4">applications en conteneur</text:span>.
Une de ses qualitÃ©s principales est d'<text:span text:style-name="T7">isoler l&#8217;exÃ©cution d&#8217;applications de leur environnement</text:span>.
Une image Docker dÃ©crit la recette d&#8217;installation d&#8217;une application.
L&#8217;environnement d&#8217;exÃ©cution Docker fait office de "passe-plat" avec le systÃ¨me d&#8217;exploitation.
Une image Docker fonctionne ainsi de la mÃªme maniÃ¨re, qu&#8217;elle soit exÃ©cutÃ©e
sous Linux, macOS ou encore Windows.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les installeurs et instructions d&#8217;installation de Docker se trouvent
Ã  l&#8217;adresse <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://docker.com/community-edition" text:visited-style-name="Visited_20_Internet_20_Link">https://docker.com/community-edition</text:a></text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Une fois Docker installÃ©, on peut exÃ©cuter une image officielle pour
Node&#160;v10.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">Affiche la version de Node</text:p><text:p text:style-name="Code">$ docker run -ti --rm node:10 node --version</text:p><text:p text:style-name="Code">v10.9.0</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ici, Docker tÃ©lÃ©charge l&#8217;image <text:span text:style-name="CodeDansTexte">node:10</text:span> et exÃ©cute la commande
<text:span text:style-name="CodeDansTexte">node --version</text:span> dans un contexte isolÃ© du systÃ¨me d&#8217;exploitation.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Pour lancer un terminal Node dans Docker, il faudrait saisir la commande suivante&#160;:</text:p>
<text:p text:style-name="Code">$ docker run -ti --rm node:10 node</text:p><text:p text:style-name="Code">&gt; 2+2</text:p><text:p text:style-name="Code">4</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Plusieurs variantes d&#8217;images Node se trouvent Ã  notre disposition&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="Menu">standard</text:span> (<text:span text:style-name="CodeDansTexte">node:10</text:span>)</text:h>
<text:p text:style-name="Remarque">Base Linux Debian pour tout type d&#8217;applications Node.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="Menu">Debian</text:span> (<text:span text:style-name="CodeDansTexte">node:10-wheezy</text:span>)</text:h>
<text:p text:style-name="Remarque">Comme <text:span text:style-name="Menu">standard</text:span> mais sur des bases Debian diffÃ©rentes, comme Wheezy, Stretch, etc..</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="Menu">Alpine</text:span> (<text:span text:style-name="CodeDansTexte">node:10-alpine</text:span>)</text:h>
<text:p text:style-name="Remarque">Distribution spÃ©cialement crÃ©Ã©e pour Docker (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://alpinelinux.org" text:visited-style-name="Visited_20_Internet_20_Link">http://alpinelinux.org</text:a></text:span>), qui pÃ¨se Ã  peine quelques&#160;Mo.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="Menu">AllÃ©gÃ©e</text:span> (<text:span text:style-name="CodeDansTexte">node:10-slim</text:span>)</text:h>
<text:p text:style-name="Remarque">Base Linux Debian sans outillage parfois nÃ©cessaire Ã  des modules Node&#160;â€“ utile si vous souhaitez Ã©conomiser de l&#8217;espace disque.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;intÃ©gralitÃ© des versions et architectures prises en charge est disponible sur
le catalogue Docker&#160;Hub&#160;: <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://hub.docker.com/_/node/" text:visited-style-name="Visited_20_Internet_20_Link">https://hub.docker.com/_/node/</text:a></text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous reviendrons sur ce sujet dans la section
<text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy.docker"  text:visited-style-name="Visited_20_Internet_20_Link">DÃ©ploiement d&#8217;une image Docker</text:a></text:span> du
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-06"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;6</text:a>.</text:p>
<text:bookmark text:name="ref-shell" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">VÃ©rifier l&#8217;installation de Node depuis un terminal (shell)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous avons installÃ© un environnement d&#8217;exÃ©cution Node dans la section prÃ©cÃ©dente.
Pour vÃ©rifier que tout s&#8217;est bien dÃ©roulÃ©, ouvrez un terminal et saisissez
la commande suivante&#160;:</text:p>
<text:p text:style-name="Code">$ node --version</text:p><text:p text:style-name="Code">v10.9.0</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le numÃ©ro de version du Node fraichement installÃ© devrait apparaÃ®tre.
Si le mot <text:span text:style-name="T4">terminal</text:span> ne vous parle pas, la suite de cette section va vous
Ã©clairer&#160;â€“ vous pourrez ensuite revenir essayer cette commande.</text:p>
<text:bookmark text:name="ref-quest_ce_quun_terminal" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Qu&#8217;est-ce qu&#8217;un terminal ?</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-shell"  text:visited-style-name="Visited_20_Internet_20_Link">terminal</text:a> est notre compagnon pour dialoguer avec le systÃ¨me d&#8217;exploitation.
L'<text:span text:style-name="T4">invite de commandes</text:span> est son nom vÃ©ritable.
Ce nom nous donne un indice sur la fonction de ce type de logiciel&#160;:
inviter l&#8217;utilisateur Ã  saisir des commandes pour obtenir des rÃ©sultats calculÃ©s
par un ordinateur.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-02/images/macos-terminal.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>2-undefined.</text:span> Terminal iTerm2 sous macOS</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Histoire</text:span> Terminal physique</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">L&#8217;histoire des invites de commande remonte au temps oÃ¹ les ordinateurs
Ã©taient plus volumineux que nos logements.
Une Ã©poque lointaine oÃ¹ les ordinateurs Ã©taient vÃ©ritablement et physiquement
distants des claviers qui les interrogeaient.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Pour en savoir plus&#160;: <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://fr.wikipedia.org/wiki/Terminal_informatique" text:visited-style-name="Visited_20_Internet_20_Link">https://fr.wikipedia.org/wiki/Terminal_informatique</text:a></text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un terminal est notre <text:span text:style-name="T7">moyen privilÃ©giÃ© pour interagir avec Node</text:span> lorsqu&#8217;il
est installÃ© sur un ordinateur.
Les systÃ¨mes d&#8217;exploitation en ont pour la plupart un installÃ© par dÃ©faut.
Cela vaut Ã©galement pour la majoritÃ© des <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-online"  text:visited-style-name="Visited_20_Internet_20_Link">services en ligne</text:a>.
undefined</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-02/images/glitch-terminal.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>2-undefined.</text:span> Terminal du <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-online"  text:visited-style-name="Visited_20_Internet_20_Link">service en ligne</text:a> Glitch</text:p>
<text:bookmark text:name="ref-choisir_un_terminal" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Choisir un terminal</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Voici une liste non exhaustive d&#8217;applications de type terminal&#160;:
undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">macOS</text:h>
<text:p text:style-name="Remarque"></text:p><text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">Terminal.app&#160;: fourni par dÃ©faut (dans <text:span text:style-name="Menu">Applications / Utilitaires</text:span>)&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">iTerm2&#160;: une version amÃ©liorÃ©e disponible sur <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://iterm2.com" text:visited-style-name="Visited_20_Internet_20_Link">https://iterm2.com</text:a></text:span> (ou <text:span text:style-name="CodeDansTexte">brew cask install iterm2</text:span>)&#160;;</text:p>
</text:list-item></text:list><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Linux</text:h>
<text:p text:style-name="Remarque"></text:p><text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">GNOME Terminal&#160;: fourni par dÃ©faut sous Debian, Ubuntu et les distributions utilisant le bureau GNOME (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://wiki.gnome.org/Apps/Terminal" text:visited-style-name="Visited_20_Internet_20_Link">https://wiki.gnome.org/Apps/Terminal</text:a></text:span>)&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Terminator&#160;: un autre terminal populaire (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://gnometerminator.blogspot.com" text:visited-style-name="Visited_20_Internet_20_Link">https://gnometerminator.blogspot.com</text:a></text:span>)&#160;;</text:p>
</text:list-item></text:list><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Windows</text:h>
<text:p text:style-name="Remarque"></text:p><text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">Node.js Command Prompt&#160;: fourni avec l'<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-windows"  text:visited-style-name="Visited_20_Internet_20_Link">installeur Windows</text:a>&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">PowerShell&#160;: fourni par dÃ©faut depuis Windows&#160;7, sinon disponible sur <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://github.com/PowerShell/PowerShell" text:visited-style-name="Visited_20_Internet_20_Link">https://github.com/PowerShell/PowerShell</text:a></text:span>&#160;â€“ Ã©galement disponible pour macOS et&#160;Linux.</text:p>
</text:list-item></text:list>
<text:p text:style-name="RemarqueFigureNumero">(chapter-02/images/windows-terminal.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>2-undefined.</text:span> Node.js Command Prompt sous Windows&#160;10</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Maintenant que nous avons installÃ© Node et compris comment
y accÃ©der depuis notre systÃ¨me d&#8217;exploitation ou navigateur web,
attaquons-nous au dernier morceau du puzzle&#160;:
<text:span text:style-name="T7">avec quel logiciel Ã©crire du code JavaScript pour nos applications&#160;Node</text:span>&#160;?</text:p>
<text:bookmark text:name="ref-ide" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Choisir un Ã©diteur de texte</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Programmer pour Node revient dans la majoritÃ© des cas Ã  Ã©crire du JavaScript.
Ã€ cela s&#8217;ajoutent le HTML et le CSS dans le cas d&#8217;applications ou de sites&#160;web.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ã€ la base, si un Ã©diteur de texte suffit pour Ã©crire du code,
prenons le temps de regarder ce qui pourrait nous apporter un peu de confort
dans le processus d&#8217;Ã©criture.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les logiciels prÃ©sentÃ©s ci-aprÃ¨s couvrent bon nombre de fonctionnalitÃ©s
qui amÃ©liorent de prÃ¨s ou de loin notre capacitÃ© Ã  Ã©crire du code de qualitÃ©.
Parmi elles, on retrouve la coloration syntaxique,
l&#8217;inspection dynamique, le dÃ©bogage, des astuces de productivitÃ© et
d&#8217;intÃ©gration Ã  l&#8217;Ã©cosystÃ¨me&#160;Node.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette sÃ©lection a pour but de vous aider Ã  piocher au plus prÃ¨s
de vos goÃ»ts.
Le meilleur logiciel sera celui qui vous plaira.
Rien n&#8217;empÃªche d&#8217;en changer par la suite.</text:p>
<text:bookmark text:name="ref-atom" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Atom</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-02/images/atom.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>2-undefined.</text:span> Atom</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Atom (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://atom.io" text:visited-style-name="Visited_20_Internet_20_Link">https://atom.io</text:a></text:span>) est un Ã©diteur de code open-source,
multilingue et multi plate-forme, dont le dÃ©veloppement a Ã©tÃ© lancÃ©
par la sociÃ©tÃ© commerciale GitHub (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://github.com" text:visited-style-name="Visited_20_Internet_20_Link">http://github.com</text:a></text:span>).
Le logiciel est basÃ© sur Electron, un environnement d&#8217;exÃ©cution
d&#8217;applications de bureau reposant sur les technologies web et sur&#160;Node&#160;!</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Atom offre un Ã©cosystÃ¨me d&#8217;extensions pour Ã©tendre les fonctionnalitÃ©s de l&#8217;Ã©diteur.
On retrouvera des extensions dÃ©diÃ©es Ã  l&#8217;auto-complÃ©tion,
un dÃ©bogueur Node intÃ©grÃ© (pour exÃ©cuter nos programmes sans changer de fenÃªtre),
mais aussi une vÃ©rification syntaxique sur mesure.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Toutes les extensions d&#8217;Atom sont disponibles sur <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://atom.io/packages" text:visited-style-name="Visited_20_Internet_20_Link">https://atom.io/packages</text:a></text:span>&#160;;
voici une liste de celles que j&#8217;utilise au quotidien&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">minimap (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://atom.io/packages/minimap" text:visited-style-name="Visited_20_Internet_20_Link">https://atom.io/packages/minimap</text:a></text:span>)</text:h>
<text:p text:style-name="Remarque">Une prÃ©visualisation de l&#8217;intÃ©gralitÃ© du code source d&#8217;un fichier.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">file-icons (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://atom.io/packages/file-icons" text:visited-style-name="Visited_20_Internet_20_Link">https://atom.io/packages/file-icons</text:a></text:span>)</text:h>
<text:p text:style-name="Remarque">Une maniÃ¨re plus agrÃ©able de visualiser les diffÃ©rents types de fichiers
en fonction de leur icÃ´ne.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">pigments (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://atom.io/packages/pigments" text:visited-style-name="Visited_20_Internet_20_Link">https://atom.io/packages/pigments</text:a></text:span>)</text:h>
<text:p text:style-name="Remarque">Affiche les couleurs en marge et dans le code source.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">language-babel (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://atom.io/packages/language-babel" text:visited-style-name="Visited_20_Internet_20_Link">https://atom.io/packages/language-babel</text:a></text:span>)</text:h>
<text:p text:style-name="Remarque">Coloration syntaxique de tous les langages compris par l&#8217;outil
Babel (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://babeljs.io" text:visited-style-name="Visited_20_Internet_20_Link">https://babeljs.io</text:a></text:span>), dont les versions modernes
de JavaScript, JSX, GraphQL,&#160;etc.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">emmet (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://atom.io/packages/emmet" text:visited-style-name="Visited_20_Internet_20_Link">https://atom.io/packages/emmet</text:a></text:span>)</text:h>
<text:p text:style-name="Remarque">GÃ©nÃ¨re du HTML Ã  partir d&#8217;une Ã©criture sous forme de sÃ©lecteur&#160;CSS.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">linter-eslint (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://atom.io/packages/linter-eslint" text:visited-style-name="Visited_20_Internet_20_Link">https://atom.io/packages/linter-eslint</text:a></text:span>)</text:h>
<text:p text:style-name="Remarque">VÃ©rification syntaxique basÃ©e sur les rÃ¨gles projet du module
ESLint (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://eslint.org" text:visited-style-name="Visited_20_Internet_20_Link">https://eslint.org</text:a></text:span>, voir
l'<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-eslint"  text:visited-style-name="Visited_20_Internet_20_Link">annexe</text:a>).</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">atom-ternjs (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://atom.io/packages/atom-ternjs" text:visited-style-name="Visited_20_Internet_20_Link">https://atom.io/packages/atom-ternjs</text:a></text:span>)</text:h>
<text:p text:style-name="Remarque">AutocomplÃ©tion pour JavaScript, Node et d&#8217;autres bibliothÃ¨ques
populaires comme jQuery, chai et underscore.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">editorconfig (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://atom.io/packages/editorconfig" text:visited-style-name="Visited_20_Internet_20_Link">https://atom.io/packages/editorconfig</text:a></text:span>)</text:h>
<text:p text:style-name="Remarque">Adapte les rÃ©glages d&#8217;indentation et autres styles d&#8217;Ã©criture de code
documentÃ©s dans chaque projet.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">language-sass (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://atom.io/packages/language-sass" text:visited-style-name="Visited_20_Internet_20_Link">https://atom.io/packages/language-sass</text:a></text:span>)</text:h>
<text:p text:style-name="Remarque">Prise en charge du langage&#160;Sass.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">markdown-writer (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://atom.io/packages/markdown-writer" text:visited-style-name="Visited_20_Internet_20_Link">https://atom.io/packages/markdown-writer</text:a></text:span>)</text:h>
<text:p text:style-name="Remarque">Raccourcis et aides pour formater du texte au format Markdown.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">autocomplete-modules (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://atom.io/packages/autocomplete-modules" text:visited-style-name="Visited_20_Internet_20_Link">https://atom.io/packages/autocomplete-modules</text:a></text:span>)</text:h>
<text:p text:style-name="Remarque">Ã‰tend l&#8217;autocomplÃ©tion lors des appels aux
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-05"  text:visited-style-name="Visited_20_Internet_20_Link">modules <text:span text:style-name="CodeDansTexte">npm</text:span></text:a> (chapitre&#160;5).</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">linter-sass-lint (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://atom.io/packages/linter-sass-lint" text:visited-style-name="Visited_20_Internet_20_Link">https://atom.io/packages/linter-sass-lint</text:a></text:span>)</text:h>
<text:p text:style-name="Remarque">VÃ©rification syntaxique des fichiers&#160;Sass.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">node-debugger (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://atom.io/packages/node-debugger" text:visited-style-name="Visited_20_Internet_20_Link">https://atom.io/packages/node-debugger</text:a></text:span>)</text:h>
<text:p text:style-name="Remarque">IntÃ©gration du dÃ©bogueur&#160;Node.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">tablr (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://atom.io/packages/tablr" text:visited-style-name="Visited_20_Internet_20_Link">https://atom.io/packages/tablr</text:a></text:span>)</text:h>
<text:p text:style-name="Remarque">Ã‰diteur de fichiers&#160;CSV.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">linter-markdown (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://atom.io/packages/linter-markdown" text:visited-style-name="Visited_20_Internet_20_Link">https://atom.io/packages/linter-markdown</text:a></text:span>)</text:h>
<text:p text:style-name="Remarque">VÃ©rification syntaxique des fichiers Markdown.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">node-resolver (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://atom.io/packages/node-resolver" text:visited-style-name="Visited_20_Internet_20_Link">https://atom.io/packages/node-resolver</text:a></text:span>)</text:h>
<text:p text:style-name="Remarque">Navigation au sein des <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-05"  text:visited-style-name="Visited_20_Internet_20_Link">modules <text:span text:style-name="CodeDansTexte">npm</text:span></text:a>
en cliquant sur leurs mÃ©thodes ou propriÃ©tÃ©s.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">ProductivitÃ©</text:span> Installer vos extensions favorites</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Chaque extension peut Ãªtre ajoutÃ©e Ã  nos favoris sur le site <text:span text:style-name="URL">atom.io</text:span>,
aussi bien pour signaler que nous l&#8217;apprÃ©cions que pour la retrouver plus tard.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-02/images/atom-favourite.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>2-undefined.</text:span> Une extension Atom ajoutÃ©e aux favoris</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Le logiciel nous offre une commande Ã  saisir dans un terminal pour
installer toutes les extensions de nos favoris&#160;:</text:p>
<text:p text:style-name="RemarqueCode">$ apm stars --install</text:p>
<text:bookmark text:name="ref-vs-code" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Visual Studio Code</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-02/images/visual-studio-code.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>2-undefined.</text:span> Visual Studio Code</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Visual Studio Code (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://code.visualstudio.com" text:visited-style-name="Visited_20_Internet_20_Link">https://code.visualstudio.com</text:a></text:span>)
est un Ã©diteur de code open source, multilingue et multi plate-forme
dont le dÃ©veloppement a Ã©tÃ© lancÃ© par la sociÃ©tÃ© Microsoft.
Le logiciel est basÃ© sur Electron, un environnement d&#8217;exÃ©cution
d&#8217;applications de bureau reposant sur les technologies web et sur Node.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le systÃ¨me IntelliSense est un de ses atouts principaux.
Il se sert du contexte disponible pour offrir une auto-complÃ©tion
et des bulles d&#8217;aide pertinentes.
C&#8217;est un Ã©diteur parfaitement adaptÃ© au dÃ©veloppement d&#8217;applications Node
grÃ¢ce Ã  des fonctionnalitÃ©s natives comme l&#8217;exÃ©cution, le dÃ©bogage,
la gestion de tÃ¢ches et le versionnement&#160;â€“ du code et des modules <text:span text:style-name="CodeDansTexte">npm</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Visual Studio Code se complÃ¨te d&#8217;un mode Node (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://code.visualstudio.com/Docs/runtimes/nodejs" text:visited-style-name="Visited_20_Internet_20_Link">https://code.visualstudio.com/Docs/runtimes/nodejs</text:a></text:span>)
et d&#8217;une place de marchÃ© (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://marketplace.visualstudio.com/VSCode" text:visited-style-name="Visited_20_Internet_20_Link">https://marketplace.visualstudio.com/VSCode</text:a></text:span>) pour
Ã©tendre ses fonctionnalitÃ©s.</text:p>
<text:bookmark text:name="ref-webstorm" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">WebStorm</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-02/images/webstorm.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>2-undefined.</text:span> WebStorm</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">WebStorm (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://www.jetbrains.com/webstorm/" text:visited-style-name="Visited_20_Internet_20_Link">https://www.jetbrains.com/webstorm/</text:a></text:span>) est un environnement
de dÃ©veloppement (IDE) payant dÃ©diÃ© au dÃ©veloppement web
HTML5, JavaScript et&#160;Node.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le logiciel est commercialisÃ© par la sociÃ©tÃ© JetBrains, renommÃ©e pour ses
IDE Pycharm (pour Python),
PhpStorm (pour PHP) et IntelliJ&#160;IDEA (pour Java).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">WebStorm est compatible Windows, Linux et macOS.
Ses forces rÃ©sident dans sa relative lÃ©gÃ¨retÃ©,
une auto-complÃ©tion intelligente prenant en compte la rÃ©solution
des modules CommonJS et AMD, une intÃ©gration des outils populaires
dans l&#8217;Ã©cosystÃ¨me Node (<text:span text:style-name="CodeDansTexte">npm</text:span>, ESLint, Mocha, Karma, Bower, etc.)
ainsi qu&#8217;un dÃ©bogage avancÃ©.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le tÃ©lÃ©chargement de WebStorm inclut une pÃ©riode d&#8217;essai de 30&#160;jours.
La tarification du produit varie selon que vous soyez un individu ou
une entreprise et que le paiement soit mensuel ou annuel.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Astuce</text:span> Licence open source</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Vous pouvez demander Ã  bÃ©nÃ©ficier d&#8217;une licence gratuite sous rÃ©serve
d&#8217;une preuve de contribution Ã  un ou plusieurs projet(s) <text:span text:style-name="T4">open&#160;source</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Rendez-vous sur <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://www.jetbrains.com/buy/opensource/" text:visited-style-name="Visited_20_Internet_20_Link">https://www.jetbrains.com/buy/opensource/</text:a></text:span>.</text:p>
<text:bookmark text:name="ref-vs-ide" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Visual Studio IDE</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-02/images/visual-studio.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>2-undefined.</text:span> Visual Studio IDE</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Visual Studio (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://www.visualstudio.com/vs/" text:visited-style-name="Visited_20_Internet_20_Link">https://www.visualstudio.com/vs/</text:a></text:span>)
est un environnement de dÃ©veloppement Ã©ditÃ© par Microsoft.
Historiquement dÃ©diÃ© au dÃ©veloppement applicatif
Windows (Visual Basic, Visual&#160;C++), ce logiciel gÃ¨re aujourd&#8217;hui bien plus
de langages, dont&#160;C#, HTML, CSS, JavaScript, ASP.Net.
Il est surtout extensible, ce qui permet de lui ajouter Python ou encore Node, entre autres.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Visual Studio est compatible Windows uniquement.
Il existe en plusieurs versions, parmi lesquelles la <text:span text:style-name="T4">Community</text:span> qui est gratuite.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Afin de bÃ©nÃ©ficier de l&#8217;intÃ©gration complÃ¨te de l&#8217;Ã©cosystÃ¨me Node,
il est nÃ©cessaire d&#8217;installer l&#8217;extension Node.js Tools for Visual Studio
(aussi nommÃ©e NTVS).
Elle est gratuite, open source et disponible Ã  l&#8217;adresse suivante&#160;:
<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://www.visualstudio.com/vs/node-js/" text:visited-style-name="Visited_20_Internet_20_Link">https://www.visualstudio.com/vs/node-js/</text:a></text:span>.</text:p>
<text:bookmark text:name="ref-quand_mettre_Ã _jour_node_js" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Quand mettre Ã  jour Node.js ?</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le dÃ©veloppement de Node continue pendant que vous lisez ces lignes.
Les sections suivantes prÃ©sentent les diffÃ©rentes raisons
pour lesquelles de nouvelles versions de Node sont distribuÃ©es.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Quelle que soit la raison, la mise Ã  jour est identique Ã 
l'<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-install"  text:visited-style-name="Visited_20_Internet_20_Link">installation initiale de Node</text:a>&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">Si vous aviez utilisÃ© un <text:span text:style-name="T7">installeur</text:span>&#160;: tÃ©lÃ©chargez et installez
la nouvelle version.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Si vous aviez utilisÃ© un <text:span text:style-name="T7">gestionnaire de versions</text:span>&#160;: tÃ©lÃ©chargez la
nouvelle version et indiquez qu&#8217;elle devient celle par dÃ©faut.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Si vous aviez <text:span text:style-name="T7">compilÃ© depuis les sources</text:span>&#160;: tÃ©lÃ©chargez les sources
de la nouvelle version et compilez Ã  nouveau.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Si vous aviez utilisÃ© une <text:span text:style-name="T7">image Docker</text:span>&#160;: tÃ©lÃ©chargez la nouvelle
version en ayant recours Ã  la commande <text:span text:style-name="CodeDansTexte">docker pull node:&lt;version&gt;</text:span>.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-mises_Ã _jour_de_sÃ©curitÃ©" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Mises Ã  jour de sÃ©curitÃ©</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Node n&#8217;est pas exempt de bogues. Une catÃ©gorie en particulier nÃ©cessite d&#8217;Ãªtre
rÃ©actif&#160;: les failles de sÃ©curitÃ©.
Ces failles offrent une surface d&#8217;attaque Ã  des personnes
mal intentionnÃ©es, qui seraient tentÃ©es d&#8217;accÃ©der sans permission Ã  des serveurs,
et donc aux donnÃ©es qu&#8217;ils contiennent.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;impact peut Ãªtre faible pour un site personnel, Ã  condition de ne pas laisser
traÃ®ner de mots de passe ici et&#160;lÃ .
Cela risque de se rÃ©vÃ©ler beaucoup plus fÃ¢cheux pour un site e-commerce
ou une entreprise dont la santÃ© serait mise en&#160;jeu.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;Ã©quipe de Node livre des <text:span text:style-name="T7">versions corrigeant les failles de sÃ©curitÃ© aussitÃ´t qu&#8217;elle le peut</text:span>.
Une faille n&#8217;est d&#8217;ailleurs pas rÃ©vÃ©lÃ©e avant que le correctif
soit disponible, par mesure de prÃ©caution.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Que faire si la faille de sÃ©curitÃ© affecte la version de Node installÃ©e sur&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">notre ordinateur de dÃ©veloppement&#160;: c&#8217;est peu risquÃ©, sauf si un module tiers l&#8217;exploite&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">notre site web&#160;: redÃ©ployez aussitÃ´t le site en question avec une version corrigeant la faille.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les versions de Node qui corrigent des failles de sÃ©curitÃ© ou des bogues connus
n&#8217;ont quasiment aucun risque de casser une application existante.
On les appelle les versions <text:span text:style-name="T4">patch</text:span>.
Elles sont indiquÃ©es par le troisiÃ¨me numÃ©ro de version&#160;: <text:span text:style-name="CodeDansTexte">v10.0.<text:span text:style-name="T7">0</text:span></text:span>, <text:span text:style-name="CodeDansTexte">v10.0.<text:span text:style-name="T7">1</text:span></text:span>, â€¦</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Plusieurs ressources sont Ã  notre disposition pour se tenir informÃ©Â·e&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Liste de diffusion (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://groups.google.com/group/nodejs-sec" text:visited-style-name="Visited_20_Internet_20_Link">https://groups.google.com/group/nodejs-sec</text:a></text:span>)</text:h>
<text:p text:style-name="Remarque">Pour recevoir l&#8217;alerte par courriel (moins d&#8217;une par&#160;mois).</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Blog Node.js (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://nodejs.org/en/blog/vulnerability/" text:visited-style-name="Visited_20_Internet_20_Link">https://nodejs.org/en/blog/vulnerability/</text:a></text:span>)</text:h>
<text:p text:style-name="Remarque">Une page web Ã  consulter avec un navigateur.
Les mÃªmes messages sont relayÃ©s sur la liste de diffusion.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Fil RSS du blog Node.js (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://nodejs.org/en/feed/vulnerability.xml" text:visited-style-name="Visited_20_Internet_20_Link">https://nodejs.org/en/feed/vulnerability.xml</text:a></text:span>)</text:h>
<text:p text:style-name="Remarque">Comme le point prÃ©cÃ©dent mais auquel on peut souscrire
avec un lecteur RSS comme Feedly ou Mozilla Thunderbird.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Compte Twitter @nodesecurity (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://twitter.com/nodesecurity" text:visited-style-name="Visited_20_Internet_20_Link">https://twitter.com/nodesecurity</text:a></text:span>)</text:h>
<text:p text:style-name="Remarque">Annonce des informations liÃ©es Ã  la sÃ©curitÃ© gÃ©nÃ©rale de Node
et de son Ã©cosystÃ¨me.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Lien</text:span> Groupe de travail Node.js Security</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Un groupe de travail (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://github.com/nodejs/security-wg" text:visited-style-name="Visited_20_Internet_20_Link">https://github.com/nodejs/security-wg</text:a></text:span>) veille Ã 
maintenir et amÃ©liorer la sÃ©curitÃ© de Node.
Ces personnes se chargent d&#8217;Ãªtre proactives dans la dÃ©tection
de failles dans l&#8217;architecture de Node, mais aussi dans
l&#8217;intÃ©gration de code tiers, comme la brique OpenSSL
ou le module <text:span text:style-name="CodeDansTexte">npm</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-06"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;6</text:a> dÃ©crit
comment se maintenir Ã  jour sur les
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-security"  text:visited-style-name="Visited_20_Internet_20_Link">alertes de sÃ©curitÃ©</text:a> de nos
applications Node.
Celles-ci risquent notamment d&#8217;Ãªtre vulnÃ©rables Ã  cause des modules <text:span text:style-name="CodeDansTexte">npm</text:span>
dont elles dÃ©pendent&#160;â€“ en plus des vulnÃ©rabilitÃ©s de&#160;Node.</text:p>
<text:bookmark text:name="ref-versions_mineures" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Versions mineures</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les versions mineures de Node sont celles qui lui ajoutent de
nouvelles fonctionnalitÃ©s quasiment sans risque de casser une application existante.
Elles sont indiquÃ©es par le deuxiÃ¨me chiffre du numÃ©ro de version&#160;:
<text:span text:style-name="CodeDansTexte">v10.<text:span text:style-name="T7">0</text:span>.3</text:span>, <text:span text:style-name="CodeDansTexte">v10.<text:span text:style-name="T7">1</text:span>.0</text:span>, â€¦</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les versions mineures sortent une petite dizaine de fois par&#160;an.
Une migration ne demande pas nÃ©cessairement d&#8217;investir beaucoup de temps pour
adapter et tester nos applications&#160;Node.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">En cas de sortie d&#8217;une version mineure&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">Sur notre ordinateur de dÃ©veloppement&#160;: on peut migrer si l&#8217;on veut tester
ou bÃ©nÃ©ficier des nouvelles fonctionnalitÃ©s de cette version.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Sur notre site web&#160;: pas d&#8217;action immÃ©diate requise.
On peut migrer si l&#8217;on veut bÃ©nÃ©ficier des nouvelles fonctionnalitÃ©s
de cette version.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-versions_majeures" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Versions majeures</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les versions majeures ajoutent Ã©galement de nouvelles fonctionnalitÃ©s Ã  Node,
mais elles peuvent Ãªtre amenÃ©es Ã  changer des comportements qui casseraient
une application existante.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Elles sont indiquÃ©es par le premier chiffre du numÃ©ro de version&#160;:
<text:span text:style-name="CodeDansTexte">v<text:span text:style-name="T7">10</text:span>.0.0</text:span>, <text:span text:style-name="CodeDansTexte">v<text:span text:style-name="T7">11</text:span>.0.0</text:span>, â€¦</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les versions majeures sortent deux fois par&#160;an.
Une migration peut demander de consacrer un certain temps Ã  adapter
et Ã  tester nos applications Node.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">En cas de sortie d&#8217;une version majeure&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">Sur notre ordinateur de dÃ©veloppement&#160;: nous prenins du temps
pour tester nos applications et nous assurer de leur bon fonctionnement.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Sur la machine de production&#160;: il n&#8217;y a pas d&#8217;action immÃ©diate requise.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-lifecycle" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Comprendre le cycle de vie produit</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le dÃ©veloppement de la plate-forme Node prend soin de ne pas
aller trop vite ni d&#8217;altÃ©rer la stabilitÃ© des applications et des
outils en fonctionnement.
Il sort <text:span text:style-name="T7">au maximum deux versions majeures par&#160;an</text:span>,
dont une est maintenue Ã  long terme (<text:span text:style-name="T4">Long Term Support</text:span>, <text:span text:style-name="T4">LTS</text:span>).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La notion de version&#160;LTS a Ã©tÃ© introduite pour donner un repÃ¨re de stabilitÃ©.
On sait qu&#8217;on peut compter dessus sans se poser de question.
Les autres versions sont Ã  voir comme des coups d&#8217;essai, dans l&#8217;anticipation d&#8217;une migration
vers une version suivante, maintenue Ã  long terme.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-02/images/schedule.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>2-undefined.</text:span> Calendrier de publication des versions de Node</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Lien</text:span> Calendrier de sorties</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
Le calendrier des sorties de Node est tenu Ã  jour sur <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://github.com/nodejs/Release" text:visited-style-name="Visited_20_Internet_20_Link">https://github.com/nodejs/Release</text:a></text:span>.
RÃ©fÃ©rez-vous Ã  ce calendrier pour des informations Ã  jour sur
les prochaines versions et l&#8217;arrÃªt de maintenance des plus anciennes.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Si on rÃ©capitule&#160;:
undefined
- Les versions <text:span text:style-name="T7">impaires</text:span> (v5,&#160;v7,&#160;etc.)
  - sont dÃ©veloppÃ©es pendant <text:span text:style-name="T4">neuf mois</text:span>&#160;;
  - ne sont pas maintenues au-delÃ .
- Les versions <text:span text:style-name="T7">paires</text:span> (<text:span text:style-name="T4">LTS</text:span>,&#160;v10,&#160;etc.)
  - sont basÃ©es sur la version <text:span text:style-name="T4">impaire</text:span> prÃ©cÃ©dente&#160;;
  - sont dÃ©veloppÃ©es pendant <text:span text:style-name="T4">six&#160;mois</text:span>&#160;;
  - sont maintenues LTS pendant <text:span text:style-name="T4">dix-huit&#160;mois</text:span>&#160;;
  - basculent en maintenance pendant <text:span text:style-name="T4">douze&#160;mois</text:span> supplÃ©mentaires&#160;;
  - ne sont pas maintenues au-delÃ .</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les patchs de sÃ©curitÃ© ne concernent que les versions en <text:span text:style-name="T4">dÃ©veloppement</text:span>,
<text:span text:style-name="T4">LTS</text:span> ou en <text:span text:style-name="T4">maintenance</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette planification garantit une plate-forme et un ensemble de
fonctionnalitÃ©s stables de maniÃ¨re prÃ©dictible,
Ã  la fois pour les projets reposant sur Node, mais aussi
pour l&#8217;Ã©cosystÃ¨me de contributeurs de modules <text:span text:style-name="CodeDansTexte">npm</text:span>.</text:p>
<text:bookmark text:name="ref-conclusion_2" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Conclusion</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous sommes dÃ©sormais en mesure d&#8217;installer et mettre Ã  jour Node
sur notre ordinateur.
Nous savons aussi avec quel(s) logiciel(s) dÃ©velopper nos applications et
oÃ¹ nous informer pour savoir quand faire nos mises Ã  jour,
pour corriger des problÃ¨mes de sÃ©curitÃ© et bÃ©nÃ©ficier des nouvelles
fonctionnalitÃ©s du langage.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le prochain chapitre nous amÃ¨nera Ã  reprendre les bases du
langage JavaScript en jouant avec le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-shell"  text:visited-style-name="Visited_20_Internet_20_Link">terminal Node</text:a>.
On dÃ©couvrira Ã©galement les diffÃ©rences entre JavaScript, ECMAScript et&#160;Node.</text:p>
<text:bookmark text:name="ref-chapter-03" /><text:p text:style-name="ChapitreNumero">3</text:p><text:h text:style-name="ChapitreTitre" text:outline-level="1">Jouer avec JavaScript</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Passons en revue les variables et structures ECMAScript pour mieux comprendre
ce qui en fait un langage Ã©lÃ©gant et moderne.</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">Qu&#8217;est-ce que JavaScript&#160;?</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Comprendre l&#8217;Ã©volution de la spÃ©cification ECMAScript</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Jongler avec les diffÃ©rentes structures du langage</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">En savoir plus sur des Ã©lÃ©ments avancÃ©s du langage</text:p>
</text:list-item></text:list>
<text:p text:style-name="ChapitreIntroduction"><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">JavaScript est souvent raillÃ©.
Parce que ce n&#8217;est pas un vrai langage.
Parce qu&#8217;il a Ã©tÃ© crÃ©Ã© en 6 jours.
Parce qu&#8217;il n&#8217;est pas orientÃ© objet.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">JavaScript est un langage expressif qui a Ã©normÃ©ment gagnÃ© en maturitÃ©
depuis les annÃ©es 2010.
Il se rÃ©vÃ¨le parfaitement opÃ©rationnel dÃ¨s lors que l&#8217;on s&#8217;intÃ©resse
Ã  ses fonctionnalitÃ©s, sans faire de hors-piste.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les types de donnÃ©es et les mÃ©thodes de manipulations qu&#8217;elles nous offrent
permettent d&#8217;Ã©crire un code plus simple, Ã  lire et Ã  produire.
Certaines structures de donnÃ©es nous aident Ã  mieux organiser nos donnÃ©es
ainsi qu&#8217;Ã  mieux les traiter.</text:p></text:p>
<text:bookmark text:name="ref-definition" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Qu&#8217;est-ce que JavaScript ?</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Je vais vous prÃ©senter plusieurs exemples de code.
Ils ont en commun d&#8217;Ãªtre tous Ã©crits en JavaScript.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">intro/ecmascript.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const baseUrl = 'https://oncletom.io/node.js';</text:p><text:p text:style-name="Code">const filePath = `${baseUrl}/package.json`;</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cet exemple illustrait la crÃ©ation de variables, de chaÃ®nes de caractÃ¨res.
Ce sont des fonctionnalitÃ©s de base de la spÃ©cification ECMAScript.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">intro/web.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">fetch('https://oncletom.io/node.js/package.json')</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.then(response =&gt; response.json())</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.then(pkg =&gt; console.log(`${pkg.name}@${pkg.version}`));</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="CodeDansTexte">fetch()</text:span> ne fait pas partie de la spÃ©cification ECMAScript.
C&#8217;est un ajout des navigateurs web.
On parle alors d'<text:span text:style-name="T7">API JavaScript pour le Web</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Glossaire</text:span> API (Interface de programmation)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Les API sont des interfaces pour dialoguer avec un programme ou une
ressource informatique.
Elles dÃ©finissent des vocabulaires pour exÃ©cuter des actions spÃ©cifiques.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">intro/dom.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const docBody = document.querySelector('body');</text:p><text:p text:style-name="Code">docBody.addEventListener('click', () =&gt; alert('Hello World!'));</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La variable <text:span text:style-name="CodeDansTexte">document</text:span> et les mÃ©thodes <text:span text:style-name="CodeDansTexte">querySelector</text:span> et <text:span text:style-name="CodeDansTexte">addEventListener</text:span>
font aussi partie des API JavaScript pour le Web.
En l&#8217;occurrence, elles font partie de l&#8217;API DOM (<text:span text:style-name="T4">Document Object Model</text:span>),
un mÃ©canisme pour interagir avec une page web grÃ¢ce Ã  ECMAScript.
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">intro/node.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {homedir} = require('os');</text:p><text:p text:style-name="Code">const fs = require('fs');</text:p><text:p text:style-name="Code">fs.readdir(homedir(), (err, files) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>err ? console.error(err) : console.log(files);</text:p><text:p text:style-name="Code">});</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce dernier exemple est spÃ©cifique Ã  Node.
Ce dernier propose la fonction <text:span text:style-name="CodeDansTexte">require()</text:span> pour charger des modules et interagir
avec le systÃ¨me d&#8217;exploitation.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Autrement dit,
<text:span text:style-name="T7">ECMAScript est un langage, une grammaire avec des fonctionnalitÃ©s de base</text:span>.
Chaque environnement&#160;â€“ les navigateurs web, Node&#160;â€“ le comprend et lui ajoute
de nouvelles expressions, contextuelles Ã  cet environnement d&#8217;exÃ©cution.
<text:span text:style-name="T7">JavaScript est le grand ensemble des technologies qui reposent sur ECMAScript</text:span>
pour fonctionner.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Histoire</text:span> Ã€ propos de JavaScript</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">JavaScript est inventÃ© en 1995 par Brendan&#160;Eich alors qu&#8217;il est employÃ© de
la sociÃ©tÃ© Netscape Communications.
Microsoft lui emboÃ®te le pas en incluant JavaScript dans son logiciel
Internet&#160;Explorer, alors en version&#160;3.
Pour des raisons de droits de marque, il y est dÃ©nommÃ© JScript.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">La spÃ©cification est ensuite validÃ©e par l&#8217;organisme <text:span text:style-name="T4">Ecma International</text:span>
en juin 1997 sous le nom d&#8217;ECMAScript, standard ECMA-262.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Le terme JavaScript est restÃ© dans le vocabulaire courant, mais, en fait,
il s&#8217;agit bien d&#8217;ECMAScript.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Adobe Flash utilise un dÃ©rivÃ© d&#8217;ECMAScript&#160;: ActionScript.
Bien des machines virtuelles sont capables d&#8217;interprÃ©ter partiellement ou
intÃ©gralement ECMAScript&#160;: Rhino, Konq, BESEN en Object Pascal ou encore
Esprima, qui est elle-mÃªme Ã©crite dans ce langage.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Si d&#8217;autres langages de programmation se cantonnent
soit au cÃ´tÃ© client (VBScript, ActionScript, Elm),
soit au cÃ´tÃ© serveur (Ruby, Python, Haskell),
JavaScript a dÃ©butÃ© cÃ´tÃ© client pour s&#8217;Ã©tendre aussi cÃ´tÃ© serveur.
Un dÃ©veloppeur ou une dÃ©veloppeuse dite <text:span text:style-name="T4">full&#160;stack</text:span> programme des applications
sur les deux fronts.
Node a cet avantage d&#8217;unifier le langage de programmation entre les environnements
client et serveur.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le langage ECMAScript&#160;â€“ appelons-le ainsi Ã  partir de maintenant&#160;â€“
a Ã©voluÃ© au fil du temps.
Il s&#8217;est enrichi de nouvelles fonctionnalitÃ©s au fil des versions, mais aussi
de sucres syntaxiques (raccourcis d&#8217;Ã©criture)
et de rigueur aussi, pour corriger des dÃ©fauts de <text:span text:style-name="T4">design</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le comitÃ© de travail TC39 (<text:span text:style-name="T4">Technical Committee</text:span>,
<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://github.com/tc39" text:visited-style-name="Visited_20_Internet_20_Link">https://github.com/tc39</text:a></text:span>) est en charge de l&#8217;Ã©volution
du langage, standardisÃ© sous le doux sobriquet de <text:span text:style-name="T4">standard ECMA-262</text:span>,
Ã  charge ensuite aux diffÃ©rents implÃ©menteurs de suivre les changements
et de les incorporer dans leurs machines virtuelles.
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Node se base sur la machine virtuelle&#160;<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-v8"  text:visited-style-name="Visited_20_Internet_20_Link">V8 de Google</text:a>
pour interprÃ©ter les expressions ECMAScript.
De fait, Node comprend les mÃªmes expressions ECMAScript que&#160;V8.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous verrons un peu plus tard dans ce chapitre comment suivre la
compatibilitÃ© de Node avec ECMAScript.
IntÃ©ressons-nous Ã  l&#8217;Ã©volution du langage et Ã  ce que Ã§a nous apporte.</text:p>
<text:bookmark text:name="ref-ecmascript5_aka_es5" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">ECMAScript&#160;5 (aka ES5)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">ECMAScript a Ã©tÃ© standardisÃ© dans sa version&#160;5 en dÃ©cembre&#160;2009.
La rÃ©vision&#160;5.1 de juin&#160;2011 est une correction mineure de la spÃ©cification.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il s&#8217;agit d&#8217;une Ã©volution majeure dans l&#8217;histoire du langage.
La prÃ©cÃ©dente version&#160;â€“ ECMAScript&#160;3&#160;â€“ Ã©tait Ã¢gÃ©e de dix&#160;ans.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">ECMAScript&#160;5 limite drastiquement certains effets indÃ©sirables du langage
grÃ¢ce au <text:span text:style-name="T4">mode strict</text:span>.
De nouvelles mÃ©thodes de manipulation de tableaux et d&#8217;objets voient le jour,
ainsi qu&#8217;une prise en charge native du format de donnÃ©es&#160;<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-json"  text:visited-style-name="Visited_20_Internet_20_Link">JSON</text:a>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La standardisation de cette version d&#8217;ECMAScript a contribuÃ© Ã  redorer
l&#8217;image du langage, mais aussi Ã  faire Ã©merger de nouvelles pratiques
de programmation.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Table de compatibilitÃ©</text:h>
<text:p text:style-name="Remarque"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://kangax.github.io/compat-table/es5/" text:visited-style-name="Visited_20_Internet_20_Link">https://kangax.github.io/compat-table/es5/</text:a></text:span></text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">SpÃ©cification</text:h>
<text:p text:style-name="Remarque">  <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://www.ecma-international.org/ecma-262/5.1/" text:visited-style-name="Visited_20_Internet_20_Link">https://www.ecma-international.org/ecma-262/5.1/</text:a></text:span>
undefined
undefined</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-03/images/compat-table.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>3-undefined.</text:span> Table de compatibilitÃ©</text:p>
<text:bookmark text:name="ref-ecmascript_2015_akaes6_puises2015" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">ECMAScript 2015 (aka&#160;ES6 puis&#160;ES2015)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La spÃ©cification ECMAScript&#160;2015 (ES2015) a Ã©tÃ© publiÃ©e en juin&#160;2015.
Elle succÃ¨de Ã  ECMAScript&#160;5 aprÃ¨s six annÃ©es de gestation.
Cette version a successivement Ã©tÃ© appelÃ©e ECMAScript Harmony, ECMAScript&#160;6,
puis ECMAScript&#160;2015.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">De nombreuses idÃ©es ont Ã©tÃ© piochÃ©es dans le langage
CoffeeScript (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://coffeescript.org" text:visited-style-name="Visited_20_Internet_20_Link">http://coffeescript.org</text:a></text:span>).
Et surtout, un nouveau type d&#8217;outillage s&#8217;est formÃ© pour commencer
Ã  utiliser ce JavaScript du futur avec le compilateur
<text:span text:style-name="T4">traceur</text:span> de Google dÃ¨s&#160;2011 (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://github.com/google/traceur-compiler" text:visited-style-name="Visited_20_Internet_20_Link">https://github.com/google/traceur-compiler</text:a></text:span>),
puis avec le projet indÃ©pendant <text:span text:style-name="T4">6to5</text:span> dÃ¨s&#160;2014.
Ce dernier a Ã©tÃ© renommÃ© en Babel (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://babeljs.io" text:visited-style-name="Visited_20_Internet_20_Link">https://babeljs.io</text:a></text:span>)
et son instigateur a par la suite Ã©tÃ© embauchÃ© par Facebook.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La pratique de compiler du JavaScript en JavaScript Ã©tait en rupture
avec ce qui se faisait prÃ©cÃ©demment&#160;:
attendre qu&#8217;une fonctionnalitÃ© soit adoptÃ©e par un dÃ©nominateur commun
de navigateurs web pour s&#8217;en servir.
Cette fois-ci, on pouvait se servir du futur, dÃ¨s aujourd&#8217;hui.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">De fait, il n&#8217;y a pas eu Ã  attendre six ans et les diffÃ©rentes implÃ©mentations
pour profiter de ce qu&#8217;il y avait de meilleur.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le prix Ã  payer&#160;? Un ticket d&#8217;entrÃ©e plus Ã©levÃ© liÃ© Ã  la maÃ®trise
de l&#8217;outillage associÃ©.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Table de compatibilitÃ© (navigateurs&#160;web)</text:h>
<text:p text:style-name="Remarque"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://kangax.github.io/compat-table/es6/" text:visited-style-name="Visited_20_Internet_20_Link">https://kangax.github.io/compat-table/es6/</text:a></text:span></text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Table de compatibilitÃ© (Node.js)</text:h>
<text:p text:style-name="Remarque"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://node.green/" text:visited-style-name="Visited_20_Internet_20_Link">https://node.green/</text:a></text:span></text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">SpÃ©cification</text:h>
<text:p text:style-name="Remarque">  <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://www.ecma-international.org/ecma-262/6.0/" text:visited-style-name="Visited_20_Internet_20_Link">https://www.ecma-international.org/ecma-262/6.0/</text:a></text:span>
undefined</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-03/images/node-green.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>3-undefined.</text:span> Illustration de l&#8217;Ã©volution de la compatibilitÃ© ECMAScript au fil des versions de&#160;Node</text:p>
<text:bookmark text:name="ref-ecmascript_2016_etc_akaes2016" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">ECMAScript 2016, etc. (aka&#160;ES2016)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Depuis la sortie d&#8217;ECMAScript&#160;2015, l&#8217;intention est de publier une
nouvelle spÃ©cification par an, de travailler les fonctionnalitÃ©s une par une
pour ne pas attendre trop longtemps avant de les ratifier.
En consÃ©quence, les nouvelles versions annuelles sont beaucoup plus
incrÃ©mentales.
Elles se font moins attendre et contiennent moins de grands bouleversements.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les fonctionnalitÃ©s en cours de prÃ©paration sont listÃ©es
dans le dÃ©pÃ´t GitHub suivant&#160;: <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://github.com/tc39/proposals" text:visited-style-name="Visited_20_Internet_20_Link">https://github.com/tc39/proposals</text:a></text:span>.
Le dernier stade avant la validation est le <text:span text:style-name="T4">stage&#160;3</text:span>.
DÃ¨s qu&#8217;une fonctionnalitÃ© passe en <text:span text:style-name="T4">stage&#160;4</text:span>, elle est incluse
dans la prochaine version d&#8217;ECMAScript
â€“ ECMAScript&#160;2019 une fois l&#8217;annÃ©e 2019 terminÃ©e.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les fonctionnalitÃ©s approuvÃ©es sont consignÃ©es dans un document&#160;:
<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://github.com/tc39/proposals/blob/master/finished-proposals.md" text:visited-style-name="Visited_20_Internet_20_Link">https://github.com/tc39/proposals/blob/master/finished-proposals.md</text:a></text:span>.</text:p>
<text:bookmark text:name="ref-primitives" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Ã‰lÃ©ments de base du langage</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette section dÃ©crit les notions nÃ©cessaires
pour s&#8217;approprier le reste des exemples de l&#8217;ouvrage.
On apprendra notamment Ã  crÃ©er des variables, Ã  naviguer dans
des listes d&#8217;Ã©lÃ©ments et Ã  faire la diffÃ©rence
entre un objet et une fonction.</text:p>
<text:bookmark text:name="ref-les_types_de_donnÃ©es" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Les types de donnÃ©es</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Qu&#8217;entend-on par <text:span text:style-name="T4">type de donnÃ©es</text:span>&#160;?
Faisons-nous notre propre idÃ©e avec une suite d&#8217;exemples.
Ces notions seront dÃ©veloppÃ©es dans le reste du chapitre,
pour mieux comprendre ce que l&#8217;on peut en faire.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">base/string.js</text:p><text:p text:style-name="Code">'Node.js'</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Une valeur entourÃ©e de guillemets est considÃ©rÃ©e
par l&#8217;interprÃ©teur ECMAScript comme une chaÃ®ne de caractÃ¨res, du texte.
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ces guillemets sont selon les cas des guillemets simples&#160;('),
doubles (") ou obliques (`).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">On peut effectuer des opÃ©rations d&#8217;identification ou d&#8217;assemblage avec une
valeur de type <text:span text:style-name="T7">chaÃ®ne de caractÃ¨res</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">base/number.js</text:p><text:p text:style-name="Code">3</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">12.3</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">ECMAScript considÃ¨re les entiers (<text:span text:style-name="CodeDansTexte">3</text:span>&#160;dans cet exemple)
et les rÃ©els (<text:span text:style-name="CodeDansTexte">12.3</text:span>&#160;dans cet exemple) comme des nombres.
Il ne fait <text:span text:style-name="T4">pas</text:span> de distinction entre les&#160;deux.
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">On peut effectuer des opÃ©rations mathÃ©matiques entre plusieurs
valeurs de type <text:span text:style-name="T7">nombre</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">base/boolean.js</text:p><text:p text:style-name="Code">true</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">false</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">ECMAScript considÃ¨re deux valeurs pour signifier <text:span text:style-name="T4">vrai</text:span> ou <text:span text:style-name="T4">faux</text:span>&#160;:
respectivement <text:span text:style-name="CodeDansTexte">true</text:span> et <text:span text:style-name="CodeDansTexte">false</text:span>.
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">On peut effectuer des opÃ©rations logiques avec une
valeur de type <text:span text:style-name="T7">boolÃ©en</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">base/null.js</text:p><text:p text:style-name="Code">null</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">On utilise <text:span text:style-name="CodeDansTexte">null</text:span> pour signifier l'<text:span text:style-name="T7">absence de valeur</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">base/undefined.js</text:p><text:p text:style-name="Code">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La valeur <text:span text:style-name="CodeDansTexte">undefined</text:span> est utilisÃ©e pour signifier
qu&#8217;une <text:span text:style-name="T7">valeur</text:span> est <text:span text:style-name="T7">inconnue</text:span>.
Rares sont les cas oÃ¹ on choisira ce type de donnÃ©es par nous-mÃªme.
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> Primitives</text:h>
Rendez-vous sur <text:span text:style-name="T4">MDN web docs</text:span> pour en savoir plus sur primitives.<text:line-break/>
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://developer.mozilla.org/docs/fr/Web/JavaScript/Data_structures" text:visited-style-name="Visited_20_Internet_20_Link">https://developer.mozilla.org/docs/fr/Web/JavaScript/Data_structures</text:a>

<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il existe trois autres types de donnÃ©es qui se basent sur ces types
dits <text:span text:style-name="T4">primitifs</text:span>.
Ils sont destinÃ©s Ã  ranger, Ã  classer et Ã  exprimer de nouvelles valeurs
en fonction d&#8217;autres.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">base/array.js</text:p><text:p text:style-name="Code">[2, 'C', 2, 'G']</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un tableau se dÃ©clare en encadrant une suite de valeurs entre crochets.
Il est capable de contenir n&#8217;importe quel type de valeurs et autant que nÃ©cessaire.
L&#8217;ordre des valeurs a gÃ©nÃ©ralement une importance.
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">On peut effectuer des opÃ©rations de tri et de sÃ©lection avec un
<text:span text:style-name="T7">tableau de valeurs</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">base/object.js</text:p><text:p text:style-name="Code">{</text:p><text:p text:style-name="Code"><text:s text:c="2"/>title: 'Node.js',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>isbn: '978-2212139938',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>published: true</text:p><text:p text:style-name="Code">}</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un objet se dÃ©clare en encadrant une suite de <text:span text:style-name="T4">paires clÃ©/valeur</text:span>
entre accolades.
Il fonctionne comme un <text:span text:style-name="T4">dictionnaire</text:span>&#160;: on associe une valeur (type au choix)
Ã  une clÃ© (un intitulÃ©, un label).
L&#8217;ordre des paires n&#8217;a gÃ©nÃ©ralement pas d&#8217;importance.
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">On peut effectuer des opÃ©rations de sÃ©lection avec un
<text:span text:style-name="T7">objet de valeurs</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">base/function.js</text:p><text:p text:style-name="Code">function double(value) {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>return value * 2;</text:p><text:p text:style-name="Code">}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">double(3);</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Une fonction accepte des <text:span text:style-name="T4">arguments</text:span>, de n&#8217;importe quel type et
autant que nÃ©cessaire.
Elle doit Ãªtre <text:span text:style-name="T4">dÃ©clarÃ©e</text:span> pour Ãªtre <text:span text:style-name="T4">exÃ©cutÃ©e</text:span>
(derniÃ¨re ligne de l&#8217;exemple prÃ©cÃ©dent).
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Une fonction <text:span text:style-name="T4">retourne</text:span> un rÃ©sultat explicite avec le
mot-clÃ© <text:span text:style-name="CodeDansTexte">return</text:span>.
Dans le cas contraire, ECMAScript considÃ¨re
que la valeur retournÃ©e Ã©quivaut implicitement Ã  <text:span text:style-name="CodeDansTexte">undefined</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">On peut effectuer des opÃ©rations de transformation avec une fonction.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les fonctions sont destinÃ©es Ã  Ãªtre <text:span text:style-name="T4">appelÃ©es</text:span>, pour effectuer
des traitements rÃ©pÃ©titifs.
DÃ¨s que l&#8217;on doit Ã©crire deux fois la mÃªme chose,
on l&#8217;Ã©crit dans une fonction qu&#8217;on appelle deux&#160;fois.</text:p>
<text:bookmark text:name="ref-les_variables" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Les variables</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les variables servent Ã  ranger des valeurs.
On peut ainsi les rÃ©utiliser plus tard, les transmettre et prendre
des dÃ©cisions en fonction de ce qu&#8217;elles contiennent.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les variables nous aident Ã  <text:span text:style-name="T4">donner du sens</text:span> Ã  notre code,
Ã  le rendre intelligible par d&#8217;autres personnes
ainsi qu&#8217;Ã  nommer des choses comme on le ferait dans notre quotidien.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">base/variables.js</text:p><text:p text:style-name="Code">const book = {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>title: 'Node.js',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>isbn: '978-2212139938',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>published: true</text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const base_price = 13;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">function double(value) {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>return value * 2;</text:p><text:p text:style-name="Code">}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">book.price = double(base_price);</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ã€ votre avis, quel est le prix du livre calculÃ© dans
l&#8217;exemple prÃ©cÃ©dent&#160;?
Il suffit de suivre le chemin que prend la nouvelle valeur
rangÃ©e dans la clÃ© <text:span text:style-name="CodeDansTexte">price</text:span> de l&#8217;objet <text:span text:style-name="CodeDansTexte">book</text:span>, calculÃ©e par la fonction
<text:span text:style-name="CodeDansTexte">double</text:span> Ã  laquelle on passe la valeur contenue dans la variable <text:span text:style-name="CodeDansTexte">base_price</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le mot-clÃ© <text:span text:style-name="CodeDansTexte">const</text:span> nous a servi Ã  <text:span text:style-name="T4">dÃ©clarer</text:span> une variable.
On ne peut Ã©tiqueter ainsi une variable avec le mÃªme nom qu&#8217;une seule fois.
L&#8217;exemple suivant gÃ©nÃ©rera une erreur lors de la deuxiÃ¨me affectation&#160;:
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">variables/const.js</text:p><text:p text:style-name="Code">const base_price = 13;</text:p><text:p text:style-name="Code">const base_price = 14;</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Question</text:span> Une variable constante ?</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque"><text:span text:style-name="CodeDansTexte">const</text:span> est un type de variable qui ne peut Ãªtre ni redÃ©clarÃ© ni Ãªtre rÃ©affectÃ©&#160;:
c&#8217;est en Ã§a qu&#8217;il est <text:span text:style-name="T4">constant</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Une variable <text:span text:style-name="CodeDansTexte">const</text:span> n&#8217;empÃªche pas la modification de son contenu, dans le cas
d&#8217;un tableau ou d&#8217;un objet.
La fonction <text:span text:style-name="CodeDansTexte">Object.freeze()</text:span> est une rÃ©ponse adaptÃ©e pour garantir son immuabilitÃ©.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">variables/const-freeze.js</text:p><text:p text:style-name="RemarqueCode">const table = ['a', 'b'];</text:p><text:p text:style-name="RemarqueCode"></text:p><text:p text:style-name="RemarqueCode">table.push('c');</text:p><text:p text:style-name="RemarqueCode">console.log(table);<text:s text:c="7"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="RemarqueCode"></text:p><text:p text:style-name="RemarqueCode">Object.freeze(table);<text:s text:c="5"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="RemarqueCode">table.push('d');<text:s text:c="10"/><text:span text:style-name="PuceCode">3</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">[ 'a', 'b', 'c' ]</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> L&#8217;objet <text:span text:style-name="CodeDansTexte">table</text:span> est gelÃ© grÃ¢ce Ã  la fonction <text:span text:style-name="CodeDansTexte">Object.freeze()</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Cette ligne lance une erreur car nous tentons de modifier un objet gelÃ©.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-les_instructions" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Les instructions</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Des <text:span text:style-name="T4">instructions</text:span> nous servent Ã  suivre, Ã©viter ou rÃ©pÃ©ter
des chemins dans notre code.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;instruction&#160;<text:span text:style-name="CodeDansTexte">if</text:span> exÃ©cute du code s&#8217;il remplit une condition.
Cette derniÃ¨re peut Ãªtre une <text:span text:style-name="T4">valeur</text:span> ou une <text:span text:style-name="T4">expression</text:span> interprÃ©tÃ©e
pour savoir Ã  quel <text:span text:style-name="T4">boolÃ©en</text:span> elle correspond.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">instructions/if.js</text:p><text:p text:style-name="Code">const book = {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>title: 'Node.js',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>published: true</text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">if (book.published &amp;&amp; book.title) {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log('Le livre est publiÃ© (et a un titre)');</text:p><text:p text:style-name="Code">}</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exemple prÃ©cÃ©dent vÃ©rifie que les deux conditions sont remplies
(opÃ©rateur <text:span text:style-name="CodeDansTexte">&amp;&amp;</text:span>) pour afficher un message en consÃ©quence.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">On notera au passage que <text:span text:style-name="CodeDansTexte">book.title</text:span> n&#8217;est pas un boolÃ©en.
ECMAScript regarde dans ce cas que la chaÃ®ne de caractÃ¨res
contient <text:span text:style-name="T4">au moins un caractÃ¨re</text:span>.
On expliquera ce comportement plus en dÃ©tail dans la section
<text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-boolean"  text:visited-style-name="Visited_20_Internet_20_Link">Jongler avec des valeurs vraies ou fausses</text:a></text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;instruction&#160;<text:span text:style-name="CodeDansTexte">if</text:span> peut Ãªtre complÃ©tÃ©e avec l&#8217;instruction <text:span text:style-name="CodeDansTexte">else</text:span>
pour exÃ©cuter du code qui rÃ©pondrait au cas contraire.
Il est possible d&#8217;imbriquer plusieurs <text:span text:style-name="CodeDansTexte">else if</text:span> Ã  la suite.
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">instructions/else-if.js</text:p><text:p text:style-name="Code">const book = {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>title: 'Node.js',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>published: true</text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">if (book.published &amp;&amp; book.title) {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log('Le livre est publiÃ© avec un titre.');</text:p><text:p text:style-name="Code">}</text:p><text:p text:style-name="Code">else if (book.published) {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log('Le livre est publiÃ© (sans titre).');</text:p><text:p text:style-name="Code">}</text:p><text:p text:style-name="Code">else {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log('Le livre n\'est pas publiÃ©.');</text:p><text:p text:style-name="Code">}</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Notre exemple n&#8217;empruntera qu&#8217;un seul des chemins, mais on constate
qu&#8217;on pourrait en emprunter un autre
en modifiant la valeur des clÃ©s <text:span text:style-name="CodeDansTexte">title</text:span> et <text:span text:style-name="CodeDansTexte">published</text:span>.</text:p>
<text:bookmark text:name="ref-scope" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">La portÃ©e (scope)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La <text:span text:style-name="T4">portÃ©e</text:span> est un concept trÃ¨s prÃ©sent dans ECMAScript.
On y fait souvent rÃ©fÃ©rence en parlant de <text:span text:style-name="T4">variable globale</text:span>&#160;et
de <text:span text:style-name="T4">variable locale</text:span>.
C&#8217;est une sorte de frontiÃ¨re d&#8217;accÃ¨s Ã  la valeur
d&#8217;une variable.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">scopes/local.js</text:p><text:p text:style-name="Code">function secret(){</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const mot = 'devinette';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>return 'None shall pass';</text:p><text:p text:style-name="Code">}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(secret());</text:p><text:p text:style-name="Code">console.log(mot);</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans cet exemple, la variable <text:span text:style-name="CodeDansTexte">secret</text:span> de type fonction a une portÃ©e globale au script.
En revanche, la variable <text:span text:style-name="CodeDansTexte">mot</text:span> est dÃ©finie dans la fonction <text:span text:style-name="CodeDansTexte">secret</text:span>
et n&#8217;est donc pas accessible en dehors de la portÃ©e de la fonction.
Ã€ l&#8217;inverse, ce qui est dÃ©fini <text:span text:style-name="T4">en dehors</text:span> d&#8217;une fonction
est accessible <text:span text:style-name="T4">Ã  l&#8217;intÃ©rieur</text:span> d&#8217;une fonction.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La portÃ©e de la variable <text:span text:style-name="CodeDansTexte">mot</text:span> est locale Ã  la fonction <text:span text:style-name="CodeDansTexte">secret</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">scopes/global.js</text:p><text:p text:style-name="Code">const year = 2018;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">function next(value) {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>return value + 1;</text:p><text:p text:style-name="Code">}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">function nextYear() {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>return next(year);</text:p><text:p text:style-name="Code">}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(year);</text:p><text:p text:style-name="Code">console.log(nextYear());</text:p><text:p text:style-name="Code">console.log(value);</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ici, nous illustrons la portÃ©e globale de la variable
<text:span text:style-name="CodeDansTexte">year</text:span>.
Elle est dÃ©finie un cran au-dessus des fonctions <text:span text:style-name="CodeDansTexte">next</text:span> et <text:span text:style-name="CodeDansTexte">nextYear</text:span>.
On peut y accÃ©der, comme en atteste le code de la fonction <text:span text:style-name="CodeDansTexte">nextYear</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ã€ l&#8217;inverse, la variable <text:span text:style-name="CodeDansTexte">value</text:span> a une portÃ©e locale
â€“ elle est passÃ©e en paramÃ¨tre de la fonction <text:span text:style-name="CodeDansTexte">next</text:span>.
ECMAScript gÃ©nÃ¨rera une erreur si on tente
d&#8217;y accÃ©der en dehors de sa portÃ©e.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T7">La portÃ©e est dÃ©limitÃ©e par les fonctions</text:span>.
En l&#8217;absence de fonction, la portÃ©e maximale est celle du module (script)
dans lequel la variable est dÃ©clarÃ©e.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il existe un deuxiÃ¨me type de portÃ©e&#160;: la <text:span text:style-name="T4">portÃ©e lexicale</text:span>.
L&#8217;exemple suivant servira Ã  illustrer la nature de sa dÃ©limitation.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">scopes/lexical.js</text:p><text:p text:style-name="Code">const book = {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>title: 'Node.js',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>published: true</text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">if (book.published) {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const price = 32;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log(`Le livre ${book.title} coÃ»te ${price}â‚¬.`);</text:p><text:p text:style-name="Code">}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(`Le livre ${book.title} coÃ»te ${price}â‚¬.`);</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le mot-clÃ© <text:span text:style-name="CodeDansTexte">const</text:span> crÃ©e une variable certes,
mais une variable dont la portÃ©e est <text:span text:style-name="T4">lexicale</text:span>.
<text:span text:style-name="T7">La portÃ©e lexicale est dÃ©limitÃ©e par le bloc d&#8217;instructions</text:span>
dans lequel la variable est dÃ©clarÃ©e.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ainsi, la variable <text:span text:style-name="CodeDansTexte">price</text:span> n&#8217;existe que dans le cadre du bloc <text:span text:style-name="CodeDansTexte">if</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La portÃ©e lexicale sert Ã  dÃ©clarer des variables sans "polluer" le reste du script,
pour que son existence soit oubliÃ©e aussitÃ´t le bloc exÃ©cutÃ©.</text:p>
<text:bookmark text:name="ref-string" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Jongler avec du texte (chaÃ®nes de caractÃ¨res)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il est commun d&#8217;avoir Ã  travailler avec des chaÃ®nes de caractÃ¨res.
Elles servent Ã  stocker des URL, des titres, des identifiants,
des tweets, des messages et des textes longs, entre autres.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">string/base.js</text:p><text:p text:style-name="Code">// Utilisation de guillemets simples</text:p><text:p text:style-name="Code">console.log('L\'aprÃ¨s-midi\nLe soir');<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">// Utilisation de guillemets doubles</text:p><text:p text:style-name="Code">console.log("L'aprÃ¨s-midi\nLe soir");<text:s text:c="3"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">// Utilisation de guillemets obliques</text:p><text:p text:style-name="Code">console.log(`L'aprÃ¨s-midi</text:p><text:p text:style-name="Code">Le soir`);<text:s text:c="30"/><text:span text:style-name="PuceCode">3</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Utilisation de guillemets simples (<text:span text:style-name="CodeDansTexte">\n</text:span> sert Ã  revenir Ã  la ligne).<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Utilisation de guillemets doubles&#160;: Ã©vite d&#8217;Ã©chapper le guillemet simple.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Utilisation de guillemets obliques&#160;: autorise l&#8217;Ã©criture sur plusieurs lignes.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Tous les caractÃ¨res sont utilisables&#160;: lettres, chiffres,
caractÃ¨res accentuÃ©s, Ã©mojis et mÃªme des sinogrammes ou des kanjis.
Autrement dit, il n&#8217;y a pas de limite.
Les environnements d&#8217;exÃ©cution se reprÃ©sentent les caractÃ¨res au format
UTF-16 (tables de stockage Unicode sur 16&#160;bits de donnÃ©es).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il est frÃ©quent d&#8217;avoir Ã  <text:span text:style-name="T4">concatÃ©ner</text:span> des chaÃ®nes de caractÃ¨res,
ou Ã  les composer Ã  partir d&#8217;une autre variable.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">string/concat.js</text:p><text:p text:style-name="Code">const mot = 'pot';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(`${mot} de colle`);</text:p><text:p text:style-name="Code">console.log(`${mot} de fleur`);</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Toute chaÃ®ne de caractÃ¨res offre un ensemble
d'<text:span text:style-name="T4">attributs</text:span> (<text:span text:style-name="CodeDansTexte">.quelque-chose</text:span>)
et de <text:span text:style-name="T4">mÃ©thodes</text:span> (<text:span text:style-name="CodeDansTexte">.autre-chose()</text:span>) pour en savoir plus
sur la chaÃ®ne mais aussi pour la transformer.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Par exemple, on connaÃ®t la longueur d&#8217;une chaÃ®ne via son attribut <text:span text:style-name="CodeDansTexte">length</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">string/length.js</text:p><text:p text:style-name="Code">console.log('I â™¥ JavaScript'.length); <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(''.length);<text:s text:c="15"/><text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">14</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">0</text:span>.
undefined<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">On accÃ¨de Ã  un caractÃ¨re spÃ©cifique en utilisant
la chaÃ®ne comme un tableau, ou Ã  l&#8217;aide d&#8217;une mÃ©thode dÃ©diÃ©e&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">string/char-at.js</text:p><text:p text:style-name="Code">const mot = 'Node.js';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(mot[0]);<text:s text:c="8"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(mot.charAt(1)); <text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">N</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">o</text:span>.
undefined<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Attention</text:span></text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Le premier caractÃ¨re d&#8217;une chaÃ®ne est Ã  l&#8217;index&#160;0 et non pas Ã &#160;1.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Deux autres fonctions transforment
un texte en lettres minuscules ou majuscules&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">string/lower-upper-case.js</text:p><text:p text:style-name="Code">const mot = 'Node.js';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(mot.toLocaleLowerCase()); <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(mot.toLocaleUpperCase()); <text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">node.js</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">NODE.JS</text:span>.
undefined
undefined<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">D&#8217;autres fonctions nettoient ou complÃ¨tent les espaces autour,
au dÃ©but ou Ã  la fin d&#8217;une chaÃ®ne de caractÃ¨res&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">string/trim-pad.js</text:p><text:p text:style-name="Code">const mot = '<text:s text:c="2"/>Node.js<text:s text:c="2"/>';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(mot.trim());<text:s text:c="6"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(mot.trimLeft());<text:s text:c="2"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">console.log(mot.trimRight()); <text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const swiftCode = 'BARCGB22';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(swiftCode.padEnd(11, 'X')); <text:span text:style-name="PuceCode">4</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">Node.js</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">Node.js&#160;&#160;</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche <text:span text:style-name="CodeDansTexte">&#160;&#160;Node.js</text:span>.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Affiche <text:span text:style-name="CodeDansTexte">BARCGB22XXX</text:span>.
undefined<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans cet exemple, la mÃ©thode <text:span text:style-name="CodeDansTexte">padEnd</text:span> complÃ¨te jusqu&#8217;Ã  <text:span text:style-name="CodeDansTexte">11</text:span>&#160;caractÃ¨res,
avec la lettre <text:span text:style-name="CodeDansTexte">X</text:span>.
La mÃ©thode <text:span text:style-name="CodeDansTexte">padStart</text:span> fait la mÃªme chose mais avec le dÃ©but de la chaÃ®ne.
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="CodeDansTexte">indexOf</text:span> retourne la position de la <text:span text:style-name="T4">premiÃ¨re occurrence</text:span> dans une chaÃ®ne
d&#8217;une sous-chaÃ®ne passÃ©e en paramÃ¨tre.
Si la valeur n&#8217;est pas trouvÃ©e, la mÃ©thode renvoie la valeur&#160;<text:span text:style-name="CodeDansTexte">-1</text:span>.
Ã€ l&#8217;inverse, <text:span text:style-name="CodeDansTexte">lastIndexOf</text:span> retournera la derniÃ¨re occurrence trouvÃ©e&#160;:
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">string/index-of.js</text:p><text:p text:style-name="Code">console.log('I â™¥ JavaScript'.indexOf('JavaScript')); <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log('I â™¥ JavaScript'.indexOf('?'));<text:s text:c="10"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">console.log('I â™¥ JavaScript'.indexOf('a'));<text:s text:c="10"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">console.log('I â™¥ JavaScript'.lastIndexOf('a'));<text:s text:c="6"/><text:span text:style-name="PuceCode">4</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Retourne&#160;<text:span text:style-name="CodeDansTexte">4</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Retourne&#160;<text:span text:style-name="CodeDansTexte">-1</text:span>&#160;â€“ aucune occurrence n&#8217;a Ã©tÃ© trouvÃ©e.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Retourne&#160;<text:span text:style-name="CodeDansTexte">5</text:span>&#160;â€“ premiÃ¨re occurrence de la lettre&#160;<text:span text:style-name="CodeDansTexte">a</text:span>.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Retourne&#160;<text:span text:style-name="CodeDansTexte">7</text:span>&#160;â€“ derniÃ¨re occurrence de la lettre&#160;<text:span text:style-name="CodeDansTexte">a</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-regexp" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Expressions rÃ©guliÃ¨res (RegExp)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Si <text:span text:style-name="CodeDansTexte">indexOf</text:span> et <text:span text:style-name="CodeDansTexte">lastIndexOf</text:span> identifient des caractÃ¨res exacts,
comment faire lorsque l&#8217;on souhaite chercher de maniÃ¨re approximative,
plusieurs fois et selon certaines conditions&#160;?</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les <text:span text:style-name="T4">expressions rÃ©guliÃ¨res</text:span> (<text:span text:style-name="T4">RegExp</text:span>, pour <text:span text:style-name="T4">Regular Expressions</text:span>)
entrent en jeu dans ces cas plus avancÃ©s.
Leur mÃ©canisme dÃ©crit des <text:span text:style-name="T4">motifs</text:span> Ã  identifier.
Plusieurs <text:span text:style-name="T4">mÃ©thodes</text:span> servent ensuite Ã  tester, identifier et remplacer
ces motifs au sein d&#8217;une chaÃ®ne de caractÃ¨res.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Anecdote</text:span> RegExp et Perl</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">La syntaxe d&#8217;expressions rÃ©guliÃ¨res est inspirÃ©e de celle du langage
de programmation Perl (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://www.perl.org" text:visited-style-name="Visited_20_Internet_20_Link">https://www.perl.org</text:a></text:span>) dans sa version&#160;5.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Une expression rÃ©guliÃ¨re est dÃ©crite le plus souvent en tant que motif
encadrÃ© par des barres obliques, suffixÃ© d'<text:span text:style-name="T4">options</text:span> exprimÃ©es sous forme de lettres&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">regexp/base.js</text:p><text:p text:style-name="Code">/[a-z]+.js/i</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cet exemple utilise l&#8217;option&#160;<text:span text:style-name="CodeDansTexte">i</text:span> mais il en existe plusieurs&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Insensible Ã  la casse&#160;(<text:span text:style-name="CodeDansTexte">i</text:span>)</text:h>
<text:p text:style-name="Remarque">On souhaite identifier du contenu, peu importe s&#8217;il est en majuscules ou non.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Multiligne&#160;(<text:span text:style-name="CodeDansTexte">m</text:span>)</text:h>
<text:p text:style-name="Remarque">La recherche s&#8217;effectue sur <text:span text:style-name="T4">toutes</text:span> les lignes.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Global&#160;(<text:span text:style-name="CodeDansTexte">g</text:span>)</text:h>
<text:p text:style-name="Remarque">La recherche identifie <text:span text:style-name="T4">tous</text:span> les rÃ©sultats&#160;â€“ au lieu du seul premier.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Unicode&#160;(<text:span text:style-name="CodeDansTexte">u</text:span>)</text:h>
<text:p text:style-name="Remarque">S&#8217;utilise si le motif de recherche exprime des sÃ©quences de caractÃ¨res
Unicode sous la forme&#160;<text:span text:style-name="CodeDansTexte">\u{&#8230;&#8203;}</text:span> (voir les <text:span text:style-name="T4">classes de caractÃ¨res</text:span> ci-aprÃ¨s).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Illustrons leur utilisation en <text:span text:style-name="T4">identifiant du texte</text:span> rÃ©pondant (<text:span text:style-name="CodeDansTexte">match</text:span>)
Ã  une <text:span text:style-name="T4">expression rÃ©guliÃ¨re</text:span>&#160;(<text:span text:style-name="CodeDansTexte">/&#8230;&#8203;/</text:span>)&#160;:
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">regexp/flags.js</text:p><text:p text:style-name="Code">const text = 'I â™¥ Node.js &amp; Anode';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(text.match(/node/i));<text:s text:c="3"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(text.match(/ode/g));<text:s text:c="4"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">console.log(text.match(/node/ig));<text:s text:c="2"/><text:span text:style-name="PuceCode">3</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Identifie et affiche <text:span text:style-name="CodeDansTexte">Node</text:span>, l&#8217;occurrence contenue dans le mot <text:span text:style-name="CodeDansTexte">Node.js</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche deux fois <text:span text:style-name="CodeDansTexte">ode</text:span>&#160;â€“ les occurrences contenues dans les mots <text:span text:style-name="CodeDansTexte">Node.js</text:span> et <text:span text:style-name="CodeDansTexte">Anode</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche <text:span text:style-name="CodeDansTexte">Node</text:span> et <text:span text:style-name="CodeDansTexte">node</text:span> en combinant les deux options&#160;<text:span text:style-name="CodeDansTexte">i</text:span> et&#160;<text:span text:style-name="CodeDansTexte">g</text:span>&#160;â€“ les occurrences contenues dans les mots <text:span text:style-name="CodeDansTexte">Node.js</text:span> et <text:span text:style-name="CodeDansTexte">Anode</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Des Ã©lÃ©ments de syntaxe complÃ¨tent les options pour
identifier des motifs au sein de chaÃ®nes de caractÃ¨res&#160;:
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Ensemble de caractÃ¨res (entre&#160;<text:span text:style-name="CodeDansTexte">[</text:span>&#160;et&#160;<text:span text:style-name="CodeDansTexte">]</text:span>)</text:h>
<text:p text:style-name="Remarque">Liste l&#8217;ensemble des caractÃ¨res recherchÃ©s.
Le caractÃ¨re&#160;<text:span text:style-name="CodeDansTexte">-</text:span> indique une plage de caractÃ¨res.
(ex. <text:span text:style-name="CodeDansTexte">[a-d]</text:span> correspond Ã  <text:span text:style-name="CodeDansTexte">[abcd]</text:span>, donc <text:span text:style-name="T4">a</text:span> ou&#160;_b_ ou&#160;_c_&#160;ou&#160;_d_).</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Nombre de caractÃ¨res (entre&#160;<text:span text:style-name="CodeDansTexte">{</text:span>&#160;et&#160;<text:span text:style-name="CodeDansTexte">}</text:span>)</text:h>
<text:p text:style-name="Remarque">RÃ©pÃ¨te un caractÃ¨re ou une sous-chaÃ®ne&#160;;
<text:span text:style-name="T4">exactement</text:span> (<text:span text:style-name="CodeDansTexte">{2}</text:span>&#160;â€“ exactement deux fois),
<text:span text:style-name="T4">au moins</text:span> (<text:span text:style-name="CodeDansTexte">{2,}</text:span>&#160;â€“ au moins deux fois)
ou <text:span text:style-name="T4">entre</text:span> (<text:span text:style-name="CodeDansTexte">{1,2}</text:span>&#160;â€“ entre une et deux fois).</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Nombre de caractÃ¨res (<text:span text:style-name="CodeDansTexte">?</text:span>,&#160;<text:span text:style-name="CodeDansTexte">+</text:span>&#160;et&#160;<text:span text:style-name="CodeDansTexte">*</text:span>)</text:h>
<text:p text:style-name="Remarque">Version raccourcie du nombre de caractÃ¨res pour des besoins usuels&#160;:
0&#160;ou&#160;1 caractÃ¨re avec&#160;<text:span text:style-name="CodeDansTexte">?</text:span>,
1 caractÃ¨re et plus avec&#160;<text:span text:style-name="CodeDansTexte">+</text:span> et
0 caractÃ¨re et plus avec&#160;<text:span text:style-name="CodeDansTexte">*</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">regexp/syntax.js</text:p><text:p text:style-name="Code">const paris15 = '75015 Paris';</text:p><text:p text:style-name="Code">const avray = '92410 Ville-d\'Avray';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">// test du code postal uniquement</text:p><text:p text:style-name="Code">console.log(paris15.match(/[0-9]{2}/));<text:s text:c="10"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(paris15.match(/[0-9]{2,5}/));<text:s text:c="8"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">// test du code postal et de la ville</text:p><text:p text:style-name="Code">console.log(paris15.match(/[0-9]{5} [a-zA-Z]+/)); <text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">console.log(paris15.match(/[0-9]{5} [a-z]+/i));<text:s text:c="3"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">// test sur un nom de ville composÃ©</text:p><text:p text:style-name="Code">console.log(avray.match(/[0-9]{5} [a-z]+/i));<text:s text:c="5"/><text:span text:style-name="PuceCode">5</text:span></text:p><text:p text:style-name="Code">console.log(avray.match(/[0-9]{5} [a-z'-]+/i));<text:s text:c="3"/><text:span text:style-name="PuceCode">6</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">["75"]</text:span>&#160;â€“ les 2&#160;premiers caractÃ¨res numÃ©riques de la chaÃ®ne.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">["75015"]</text:span>&#160;â€“ les 5&#160;premiers caractÃ¨res numÃ©riques (satisfait la condition&#160;<text:span text:style-name="CodeDansTexte">5</text:span> de&#160;<text:span text:style-name="CodeDansTexte">{2,5}</text:span>).<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche <text:span text:style-name="CodeDansTexte">["75015 Paris"]</text:span>.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Affiche <text:span text:style-name="CodeDansTexte">["75015 Paris"]</text:span>&#160;â€“ l&#8217;option&#160;<text:span text:style-name="CodeDansTexte">i</text:span> Ã©vite de prÃ©ciser l&#8217;ensemble&#160;<text:span text:style-name="CodeDansTexte">A-Z</text:span>.<text:line-break/><text:span text:style-name="PuceCode">5</text:span> Affiche <text:span text:style-name="CodeDansTexte">["92410 Ville"]</text:span>&#160;â€“ capture les caractÃ¨res jusqu&#8217;Ã  ce que la condition ne soit plus remplie en rencontrant le trait d&#8217;union&#160;(<text:span text:style-name="CodeDansTexte">-</text:span>).<text:line-break/><text:span text:style-name="PuceCode">6</text:span> Affiche <text:span text:style-name="CodeDansTexte">["92410 Ville-d&#8217;Avray"]</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">D&#8217;autres opÃ©rateurs dÃ©limitent notre recherche&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">DÃ©but et fin de chaÃ®ne (<text:span text:style-name="CodeDansTexte">^</text:span>&#160;et&#160;<text:span text:style-name="CodeDansTexte">$</text:span>)</text:h>
<text:p text:style-name="Remarque">Quand l&#8217;option multiligne (<text:span text:style-name="CodeDansTexte">m</text:span>) est utilisÃ©e, les notions de dÃ©but
et de fin s&#8217;appliquent au niveau de la ligne.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Limite de mot&#160;(<text:span text:style-name="CodeDansTexte">\b</text:span>)</text:h>
<text:p text:style-name="Remarque">Symbolise tout caractÃ¨re ne faisant pas partie d&#8217;un mot, y compris le dÃ©but
ou la fin d&#8217;une chaÃ®ne.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Ou&#160;(<text:span text:style-name="CodeDansTexte">|</text:span>)</text:h>
<text:p text:style-name="Remarque">SÃ©pare deux choix (ex. <text:span text:style-name="CodeDansTexte">/noir|blanc/</text:span>).</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Groupe de capture (entre&#160;<text:span text:style-name="CodeDansTexte">(</text:span>&#160;et&#160;<text:span text:style-name="CodeDansTexte">)</text:span>)</text:h>
<text:p text:style-name="Remarque">  DÃ©limite un groupe de caractÃ¨res.
  Les groupes peuvent par la suite Ãªtre <text:span text:style-name="T4">identifiÃ©s</text:span> et <text:span text:style-name="T4">remplacÃ©s</text:span>.<text:line-break/>
  On notera Ã©galement que l&#8217;emploi des <text:span text:style-name="T4">groupes</text:span> change
  la structure des rÃ©sultats en un tableau de plusieurs Ã©lÃ©ments,
  de la forme <text:span text:style-name="CodeDansTexte">["chaÃ®ne identifiÃ©e", "groupe 1", "groupe 2" &#8230;&#8203;]</text:span>.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">regexp/limits.js</text:p><text:p text:style-name="Code">const postcode = '75015 Paris';</text:p><text:p text:style-name="Code">const cedex = `CODEPOSTAL VILLE CEDEX</text:p><text:p text:style-name="Code">33900 Bordeaux Cedex 9</text:p><text:p text:style-name="Code">33074 BORDEAUX CEDEX</text:p><text:p text:style-name="Code">33700 MERIGNAC Cidex 40`;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const nogroup = /^[0-9]{5} [a-z0-9' -]+/i;</text:p><text:p text:style-name="Code">const group = /^([0-9]{5}) [a-z0-9' -]+/i;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">// avec ou sans groupe de capture</text:p><text:p text:style-name="Code">console.log(postcode.match(nogroup));<text:s text:c="9"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(postcode.match(group));<text:s text:c="11"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">// mode multiligne avec ou sans option globale</text:p><text:p text:style-name="Code">console.log(cedex.match(/^([0-9]{5})/im));<text:s text:c="4"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">console.log(cedex.match(/^([0-9]{5})/gim));<text:s text:c="3"/><text:span text:style-name="PuceCode">4</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">["75015 Paris"]</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">["75015 Paris", "75015"]</text:span>&#160;â€“ le premier Ã©lÃ©ment correspond Ã  la chaÃ®ne identifiÃ©e tandis que le second correspond au <text:span text:style-name="T4">premier</text:span> groupe de capture.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche <text:span text:style-name="CodeDansTexte">["33900", "33900"]</text:span>&#160;â€“ l&#8217;option multiligne itÃ¨re de ligne en ligne jusqu&#8217;Ã  trouver un motif.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Affiche <text:span text:style-name="CodeDansTexte">["33900", "33074", "33700"]</text:span>&#160;â€“ l&#8217;option multiligne globale retourne tous les groupes de capture.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">On notera qu&#8217;il faut faire attention Ã  ce que l&#8217;on regarde&#160;:
le format de rÃ©sultat varie selon qu&#8217;on utilise ou non des groupes de capture et
selon qu&#8217;on utilise l&#8217;option globale ou multiligne.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Des symboles servent de raccourcis pour dÃ©signer
plusieurs caractÃ¨res simultanÃ©ment&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Tout caractÃ¨re&#160;(<text:span text:style-name="CodeDansTexte">.</text:span>)</text:h>
<text:p text:style-name="Remarque">tout caractÃ¨re sauf le saut de ligne.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">CaractÃ¨re de mot&#160;(<text:span text:style-name="CodeDansTexte">\w</text:span>)</text:h>
<text:p text:style-name="Remarque">Tout caractÃ¨re pouvant composer un mot anglais&#160;:
les caractÃ¨res accentuÃ©s ne sont pas englobÃ©s
(identique Ã  <text:span text:style-name="CodeDansTexte">[A-Za-z0-9_]</text:span>).</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">CaractÃ¨re numÃ©rique&#160;(<text:span text:style-name="CodeDansTexte">\d</text:span>)</text:h>
<text:p text:style-name="Remarque">Identique Ã &#160;<text:span text:style-name="CodeDansTexte">[0-9]</text:span>.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">CaractÃ¨re d&#8217;espacement&#160;(<text:span text:style-name="CodeDansTexte">\s</text:span>)</text:h>
<text:p text:style-name="Remarque">Tout caractÃ¨re d&#8217;espacement&#160;: espace, tabulation, retour chariot, etc.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">CaractÃ¨re Unicode&#160;(<text:span text:style-name="CodeDansTexte">\u{&#8230;&#8203;}</text:span>)</text:h>
<text:p text:style-name="Remarque">  Doit Ãªtre combinÃ© avec l&#8217;option&#160;<text:span text:style-name="CodeDansTexte">u</text:span> (<text:span text:style-name="CodeDansTexte">/&#8230;&#8203;/u</text:span>).
  Exemple&#160;: â™¥ï¸Ž&#160;&#8594;&#160;<text:span text:style-name="CodeDansTexte">\u{2665}</text:span>.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les alternatives de classes en majuscules sont des <text:span text:style-name="T4">nÃ©gations</text:span>.
<text:span text:style-name="CodeDansTexte">\W</text:span>&#160;pour "tout sauf un caractÃ¨re de mot", <text:span text:style-name="CodeDansTexte">\S</text:span>&#160;pour "tout sauf un caractÃ¨re
d&#8217;espacement", etc.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">regexp/classes.js</text:p><text:p text:style-name="Code">const text = 'I â™¥ RegExp in 2018';</text:p><text:p text:style-name="Code">console.log(text.match(/\u{2665} (\w+)/u));<text:s text:c="3"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const [,iLove,year] = text.match(/^(I \u{2665}).+(\d{4})$/u);</text:p><text:p text:style-name="Code">console.log(`${iLove} ${year}`);<text:s text:c="14"/><text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">["â™¥ RegExp", "RegExp"]</text:span>&#160;â€“ et s&#8217;arrÃªte lÃ  car l&#8217;espace suivant n&#8217;est pas un caractÃ¨re de&#160;mot.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">"I â™¥ 2019"</text:span>&#160;â€“ on a extrait le dÃ©but de la phrase et l&#8217;annÃ©e placÃ©e en fin de chaÃ®ne.
undefined<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> Expressions rÃ©guliÃ¨res</text:h>
Rendez-vous sur <text:span text:style-name="T4">MDN web docs</text:span> pour en savoir plus sur les expressions rÃ©guliÃ¨res.<text:line-break/>
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://developer.mozilla.org/docs/fr/Web/JavaScript/Reference/Global_Objects/RegExp" text:visited-style-name="Visited_20_Internet_20_Link">https://developer.mozilla.org/docs/fr/Web/JavaScript/Reference/Global_Objects/RegExp</text:a>

<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La mÃ©thode <text:span text:style-name="CodeDansTexte">test</text:span> est pratique si la seule chose qui vous intÃ©resse
est de tester si une chaÃ®ne correspond Ã  un motif&#160;:
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">regexp/test.js</text:p><text:p text:style-name="Code">const cedex = `CODEPOSTAL VILLE CEDEX</text:p><text:p text:style-name="Code">33900 Bordeaux Cedex 9</text:p><text:p text:style-name="Code">33074 BORDEAUX CEDEX</text:p><text:p text:style-name="Code">33700 MERIGNAC Cidex 40`;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const postcode_tester = /^\d{5}\s/m;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">if (postcode_tester.test(cedex)) {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log(cedex.match(/^(\d{5})\b/gm));</text:p><text:p text:style-name="Code">}</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Enfin, la mÃ©thode <text:span text:style-name="CodeDansTexte">replace</text:span> est trÃ¨s utile pour transformer des chaÃ®nes de
caractÃ¨res, surtout en combinaison avec les groupes de capture&#160;:
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">regexp/replace.js</text:p><text:p text:style-name="Code">const t = 'I â™¥ JavaScript';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(t.replace('â™¥', 'love'));<text:s text:c="4"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(t.replace(/\b\w+$/, 'PHP'));<text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const text = t.replace(/^.+(\u{2665}) (\w+)$/u, '$2 $1 me');</text:p><text:p text:style-name="Code">console.log(text);<text:s text:c="22"/><text:span text:style-name="PuceCode">3</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">"I love JavaScript"</text:span>&#160;â€“ si le premier argument de <text:span text:style-name="CodeDansTexte">replace</text:span> est une chaÃ®ne, elle est convertie automatiquement en expression rÃ©guliÃ¨re.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">"I â™¥ PHP"</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche <text:span text:style-name="CodeDansTexte">"JavaScript â™¥ me"</text:span>&#160;â€“ les symboles <text:span text:style-name="CodeDansTexte">$&lt;numÃ©ro&gt;</text:span> reprÃ©sentent les groupes de capture, qu&#8217;on place dans l&#8217;ordre de notre choix.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le second argument accepte une <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-functions"  text:visited-style-name="Visited_20_Internet_20_Link">fonction</text:a>
pour procÃ©der Ã  des remplacements dynamiques&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">regexp/replace-function.js</text:p><text:p text:style-name="Code">const text = 'I â™¥ JavaScript';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const shout = text.replace(/\b(\w+)$/u, (pattern, lang) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>return lang.toLocaleUpperCase();</text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(shout);<text:s text:c="3"/><text:span text:style-name="PuceCode">1</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">"I â™¥ JAVASCRIPT"</text:span>&#160;â€“ le dernier mot est transformÃ© en majuscules.<text:line-break/></text:p>
<text:bookmark text:name="ref-boolean" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Jongler avec des valeurs vraies ou fausses (boolÃ©ens)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un boolÃ©en est un Ã©lÃ©ment logique dont la valeur est soit <text:span text:style-name="CodeDansTexte">true</text:span> soit <text:span text:style-name="CodeDansTexte">false</text:span>,
c&#8217;est-Ã -dire respectivement <text:span text:style-name="T4">vrai</text:span> ou <text:span text:style-name="T4">faux</text:span>.
Ce type de valeur sert Ã  exprimer des rÃ©sultats de condition
("si&#160;Ã§a alors&#160;â€¦ sinon") ainsi qu&#8217;Ã  affirmer ou infirmer quelque chose.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">boolean/base.js</text:p><text:p text:style-name="Code">const counter = 3;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(counter);<text:s text:c="15"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(counter === 3);<text:s text:c="9"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const check = (counter === 3);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(check);<text:s text:c="17"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">console.log(check === true);<text:s text:c="8"/><text:span text:style-name="PuceCode">4</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">3</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">true</text:span>&#160;â€“ la condition est vÃ©rifiÃ©e.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche <text:span text:style-name="CodeDansTexte">true</text:span>&#160;â€“ c&#8217;est la valeur de la variable <text:span text:style-name="CodeDansTexte">check</text:span> suite Ã  son affectation Ã  la ligne prÃ©cÃ©dente.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Affiche <text:span text:style-name="CodeDansTexte">true</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Une donnÃ©e d&#8217;un autre type peut Ãªtre convertie en boolÃ©en.
La logique qui dÃ©terminera si la conversion retournera <text:span text:style-name="CodeDansTexte">true</text:span> ou <text:span text:style-name="CodeDansTexte">false</text:span>
est la suivante&#160;:
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">true</text:span></text:h>
<text:p text:style-name="Remarque">Toute valeur non&#160;nulle.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">false</text:span></text:h>
<text:p text:style-name="Remarque">Toute valeur nulle (<text:span text:style-name="CodeDansTexte">null</text:span>, <text:span text:style-name="CodeDansTexte">0</text:span>,&#160;<text:span text:style-name="CodeDansTexte">NaN</text:span>), vide (<text:span text:style-name="CodeDansTexte">''</text:span>)
ou indÃ©finie (<text:span text:style-name="CodeDansTexte">undefined</text:span>).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">boolean/convert.js</text:p><text:p text:style-name="Code">const counter = 3;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(Boolean(''));<text:s text:c="7"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(Boolean(counter));<text:s text:c="2"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">console.log(Boolean([]));<text:s text:c="7"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">if (counter) {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log('if (counter) Ã©quivaut Ã  if (Boolean(counter))');</text:p><text:p text:style-name="Code">}</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">false</text:span>&#160;â€“ il s&#8217;agit d&#8217;une chaÃ®ne&#160;vide.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">true</text:span>&#160;â€“ il s&#8217;agit d&#8217;une valeur non&#160;nulle.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche <text:span text:style-name="CodeDansTexte">true</text:span>&#160;â€“ le tableau est vide mais l&#8217;objet en lui-mÃªme <text:span text:style-name="T4">vaut</text:span> quelque chose&#160;: un tableau.<text:line-break/></text:p>
<text:bookmark text:name="ref-number" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Jongler avec des valeurs numÃ©riques (Number, Math)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">ECMAScript ne fait pas de distinction entre des entiers et des
nombres contenant des dÃ©cimales&#160;: ce sont des <text:span text:style-name="T4">nombres</text:span> un point c&#8217;est tout.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">number/base.js</text:p><text:p text:style-name="Code">console.log(40);</text:p><text:p text:style-name="Code">console.log(40.0);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(40 === 40.0);<text:s text:c="3"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(40 === '40.0'); <text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">true</text:span>&#160;â€“ les deux valeurs sont strictement Ã©quivalentes.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">false</text:span>&#160;â€“ un Ã©lÃ©ment entre guillemets est une chaÃ®ne de caractÃ¨res, pas un nombre.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les nombres sont reprÃ©sentÃ©s par dÃ©faut en <text:span text:style-name="T4">base&#160;10</text:span>.
La plage de nombres utilisable dans un programme est dÃ©finie par des
constantes ECMAScript&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">number/constants.js</text:p><text:p text:style-name="Code">console.log(Number.POSITIVE_INFINITY);<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(Number.NEGATIVE_INFINITY);<text:s text:c="2"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(Number.MAX_VALUE);<text:s text:c="10"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">console.log(Number.MIN_VALUE);<text:s text:c="10"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(Number.MAX_SAFE_INTEGER);<text:s text:c="3"/><text:span text:style-name="PuceCode">5</text:span></text:p><text:p text:style-name="Code">console.log(Number.MIN_SAFE_INTEGER);<text:s text:c="3"/><text:span text:style-name="PuceCode">6</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">Infinity</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">-Infinity</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">1.7976931348623157e+308</text:span>&#160;â€“ le plus grand rÃ©el utilisable.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">5e-324</text:span>&#160;â€“ le plus petit rÃ©el utilisable.<text:line-break/><text:span text:style-name="PuceCode">5</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">9007199254740991</text:span>&#160;â€“ le plus grand entier utilisable.<text:line-break/><text:span text:style-name="PuceCode">6</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">-9007199254740991</text:span>&#160;â€“ le plus petit entier utilisable.
undefined
undefined
undefined
undefined
undefined
undefined<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il est aussi possible de compter dans d&#8217;autres bases, notamment en hexadÃ©cimal
(<text:span text:style-name="T4">base&#160;16</text:span>).
Cette derniÃ¨re est exprimÃ©e en prÃ©fixant la valeur par&#160;<text:span text:style-name="CodeDansTexte">0x</text:span> et avec les
caractÃ¨res de&#160;0 Ã &#160;F&#160;â€“ 0&#160;Ã &#160;9 puis A (vaut&#160;10),
B (vaut&#160;11), etc.
undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">number/hexa.js</text:p><text:p text:style-name="Code">console.log(0x0000);<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(0x000A);<text:s text:c="2"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">console.log(0x00A0);<text:s text:c="2"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">console.log(0x0A00);<text:s text:c="2"/><text:span text:style-name="PuceCode">4</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">0</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">10</text:span>&#160;â€“ car <text:span text:style-name="CodeDansTexte">A</text:span>&#160;en hexadÃ©cimal vaut&#160;10 en dÃ©cimal.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">160</text:span>&#160;â€“ pour <text:span text:style-name="CodeDansTexte">10Ã—16</text:span> (une <text:span text:style-name="">dizaine</text:span> vaut&#160;16).<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">2560</text:span>&#160;â€“ pour <text:span text:style-name="CodeDansTexte">10Ã—16Ã—16</text:span> (une <text:span text:style-name="">centaine</text:span> vaut&#160;16Ã—16).<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Rumeur</text:span> JavaScript est nul en virgule flottante !</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
ECMAScript est souvent dÃ©criÃ© pour son incapacitÃ© Ã  gÃ©rer les opÃ©rations
mathÃ©matiques avec prÃ©cision.</text:p>
<text:p text:style-name="RemarqueCode">0.2 + 0.6</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">ECMAScript respecte le standard <text:span text:style-name="T4">IEEE&#160;754</text:span> de gestion de nombres Ã  virgule
flottante sur 64&#160;bits de donnÃ©es.
Qui d&#8217;autre l&#8217;utilise&#160;?
D&#8217;autres langages "inconnus" comme Python, PHP et Ruby, entre autres.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Pour en savoir plus&#160;: <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://fr.wikipedia.org/wiki/IEEE_754" text:visited-style-name="Visited_20_Internet_20_Link">https://fr.wikipedia.org/wiki/IEEE_754</text:a></text:span>.</text:p>
<text:bookmark text:name="ref-opÃ©rations_mathÃ©matiques" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">OpÃ©rations mathÃ©matiques</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les nombres s&#8217;utilisent pour effectuer des opÃ©rations mathÃ©matiques.
Chaque opÃ©ration est dotÃ©e d&#8217;un symbole&#160;:
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><table:table table:style-name="Tableau1"><table:table-column />,<table:table-column /><table:table-row><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>OpÃ©ration</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Symbole</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>addition</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">+</text:span></text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>soustraction</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">-</text:span></text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>multiplication</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">*</text:span></text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>division</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">/</text:span></text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>modulo (reste de division)</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">%</text:span></text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>exposant (puissance)</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">**</text:span></text:p></table:table-cell></table:table-row></table:table>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">number/operations.js</text:p><text:p text:style-name="Code">console.log(2 + 4);<text:s text:c="5"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(2 - 4);<text:s text:c="5"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">console.log(2 * 4);<text:s text:c="5"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">console.log(2 / 4);<text:s text:c="5"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code">console.log(2 % 4);<text:s text:c="5"/><text:span text:style-name="PuceCode">5</text:span></text:p><text:p text:style-name="Code">console.log(2 ** 4);<text:s text:c="4"/><text:span text:style-name="PuceCode">6</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">6</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">-2</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">8</text:span>.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">0.5</text:span>.<text:line-break/><text:span text:style-name="PuceCode">5</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">2</text:span>.<text:line-break/><text:span text:style-name="PuceCode">6</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">16</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-nan" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Les nombres qui n&#8217;en sont pas (<text:span text:style-name="T4">NaN</text:span>)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Attention</text:span> OpÃ©rations exotiques</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Est-ce que vous avez dÃ©jÃ  tentÃ© d&#8217;additionner un nombre avec un tableau&#160;?
Pas forcÃ©ment, mais ECMAScript ne vous en empÃªchera pas.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">number/operations-types.js</text:p><text:p text:style-name="RemarqueCode">console.log(10 / '1');<text:s text:c="4"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="RemarqueCode">console.log(10 / 0);<text:s text:c="6"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="RemarqueCode">console.log(10 / []);<text:s text:c="5"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="RemarqueCode">console.log(10 / {});<text:s text:c="5"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="RemarqueCode">console.log(10 + null);<text:s text:c="3"/><text:span text:style-name="PuceCode">5</text:span></text:p><text:p text:style-name="RemarqueCode">console.log(10 + true);<text:s text:c="3"/><text:span text:style-name="PuceCode">6</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> La chaÃ®ne&#160;<text:span text:style-name="CodeDansTexte">'1'</text:span> sera convertie en nombre (voir plus loin).<text:line-break/><text:span text:style-name="PuceCode">2</text:span> On nous a toujours interdit la division par zÃ©ro&#160;; ici, on affiche&#160;<text:span text:style-name="CodeDansTexte">Infinity</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche aussi&#160;<text:span text:style-name="CodeDansTexte">Infinity</text:span>.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Seule cette opÃ©ration retourne&#160;<text:span text:style-name="CodeDansTexte">NaN</text:span>.<text:line-break/><text:span text:style-name="PuceCode">5</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">10</text:span>.<text:line-break/><text:span text:style-name="PuceCode">6</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">11</text:span>&#160;â€” la valeur <text:span text:style-name="CodeDansTexte">true</text:span> est implicitement convertie en un entier.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Certaines opÃ©rations n&#8217;aboutiront pas mais n&#8217;afficheront pas d&#8217;erreur pour autant.
Dans ce cas, leur rÃ©sultat vaudra <text:span text:style-name="CodeDansTexte">NaN</text:span> pour <text:span text:style-name="T4">not&#160;a&#160;number</text:span>
(littÃ©ralement&#160;: "n&#8217;est pas un nombre").</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">number/nan.js</text:p><text:p text:style-name="Code">console.log(10 / 'fromage');</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La fonction <text:span text:style-name="CodeDansTexte">Number.isNaN()</text:span> nous aidera Ã  vÃ©rifier si la valeur d&#8217;une variable
ou le rÃ©sultat d&#8217;une opÃ©ration est un&#160;<text:span text:style-name="CodeDansTexte">NaN</text:span> ou non.
Cette fonction retourne un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-boolean"  text:visited-style-name="Visited_20_Internet_20_Link">boolÃ©en</text:a>.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">number/is-nan.js</text:p><text:p text:style-name="Code">console.log(Number.isNaN(NaN));<text:s text:c="13"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(Number.isNaN(10 / 'fromage'));<text:s text:c="2"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(Number.isNaN(10));<text:s text:c="14"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">console.log(Number.isNaN('fromage'));<text:s text:c="7"/><text:span text:style-name="PuceCode">4</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">true</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">true</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche <text:span text:style-name="CodeDansTexte">false</text:span>.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Affiche <text:span text:style-name="CodeDansTexte">false</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Assertion</text:span> <text:span text:style-name="CodeDansTexte">NaN</text:span> n&#8217;est pas un nombre ?</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Il faut se mÃ©fier de <text:span text:style-name="CodeDansTexte">NaN</text:span> comme de la peste, car il est considÃ©rÃ©
comme un nombre du point de vue d&#8217;ECMAScript.
Toute opÃ©ration mathÃ©matique impliquant&#160;<text:span text:style-name="CodeDansTexte">NaN</text:span> renverra un&#160;<text:span text:style-name="CodeDansTexte">NaN</text:span>&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">number/nan-number.js</text:p><text:p text:style-name="RemarqueCode">console.log(typeof NaN);<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="RemarqueCode">console.log(typeof 10);<text:s text:c="3"/><text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">'number'</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">'number'</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Il vaut mieux s&#8217;assurer qu&#8217;une variable est Ã  la fois un nombre et
qu&#8217;elle ne vaut pas&#160;<text:span text:style-name="CodeDansTexte">NaN</text:span>&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">number/is-not-a-nan.js</text:p><text:p text:style-name="RemarqueCode">const result = 10 / 'fromage';</text:p><text:p text:style-name="RemarqueCode"></text:p><text:p text:style-name="RemarqueCode">if (typeof result === 'number' &amp;&amp; !Number.isNaN(result)) {</text:p><text:p text:style-name="RemarqueCode"><text:s text:c="2"/>console.log('Ceci est un nombre.');</text:p><text:p text:style-name="RemarqueCode">}</text:p><text:p text:style-name="RemarqueCode">else {</text:p><text:p text:style-name="RemarqueCode"><text:s text:c="2"/>console.log('result n\'est pas un nombre.');</text:p><text:p text:style-name="RemarqueCode">}</text:p>
<text:bookmark text:name="ref-convertir_en_nombre" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Convertir en nombre</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">indexterm[nombre, conversion]</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les lignes qui prÃ©cÃ©dent l&#8217;Ã©voquent un peu&#160;: on peut passer d&#8217;autres types
de donnÃ©es Ã  des nombres.
IdÃ©alement, on voudra transformer explicitement quelque chose en un nombre.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Pour cela nous disposons de deux fonctions&#160;:
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="CodeDansTexte">parseInt</text:span> essaie d&#8217;interprÃ©ter un nombre entier.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="CodeDansTexte">parseFloat</text:span> essaie d&#8217;interprÃ©ter un nombre Ã  virgule. La fonction s&#8217;arrÃªte
dÃ¨s qu&#8217;elle n&#8217;a plus affaire Ã  un chiffre.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">number/parse.js</text:p><text:p text:style-name="Code">console.log(parseInt('3.141592653589793'));<text:s text:c="3"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(parseFloat('3.141592653589793')); <text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(parseInt('14.10-patch.2'));<text:s text:c="3"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">console.log(parseFloat('14.10-patch.2')); <text:span text:style-name="PuceCode">4</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">3</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">3.141592653589793</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">14</text:span>&#160;â€“ Ã§a ne change rien pour <text:span text:style-name="CodeDansTexte">parseInt</text:span>.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">14.1</text:span>&#160;â€“ la fonction s&#8217;arrÃªte Ã  la dÃ©cimale prÃ©cÃ©dant une lettre.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="CodeDansTexte">parseInt</text:span> a cette particularitÃ© que l&#8217;on peut choisir la base
de la conversion avec le second argument de la fonction.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">number/parse-int.js</text:p><text:p text:style-name="Code">console.log(parseInt(10, 16));<text:s text:c="4"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(parseInt('A', 16));<text:s text:c="3"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">console.log(parseInt('A00', 16)); <text:span text:style-name="PuceCode">3</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">16</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">10</text:span>&#160;â€“ <text:span text:style-name="CodeDansTexte">A</text:span>&#160;vaut&#160;<text:span text:style-name="CodeDansTexte">10</text:span> en hexadÃ©cimal.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">2560</text:span>&#160;â€“ aurait pu s&#8217;Ã©crire <text:span text:style-name="CodeDansTexte">0xA00</text:span>.
undefined
undefined<text:line-break/></text:p>
<text:bookmark text:name="ref-formater_et_arrondir_des_nombres" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Formater et arrondir des nombres</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Si l&#8217;envie vous prenait de vouloir arrondir des nombres, il existe
quelques fonctions pour vous aider&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">Math.round()</text:span></text:h>
<text:p text:style-name="Remarque">Arrondit Ã  l&#8217;entier le plus proche.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">Math.ceil()</text:span></text:h>
<text:p text:style-name="Remarque">Arrondit Ã  l&#8217;entier supÃ©rieur du nombre donnÃ©.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">Math.floor()</text:span></text:h>
<text:p text:style-name="Remarque">  Arrondit Ã  l&#8217;entier infÃ©rieur du nombre donnÃ©.
undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">number/round.js</text:p><text:p text:style-name="Code">console.log(Math.round(3.1));<text:s text:c="4"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(Math.round(3.8));<text:s text:c="4"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">console.log(Math.round(3.5));<text:s text:c="4"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(Math.ceil(3.14));<text:s text:c="4"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code">console.log(Math.floor(3.99));<text:s text:c="3"/><text:span text:style-name="PuceCode">5</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">3</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">4</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">4</text:span>.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">4</text:span>.<text:line-break/><text:span text:style-name="PuceCode">5</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">3</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Enfin, on peut prÃ©server le formatage du nombre de dÃ©cimales
aprÃ¨s la virgule en transformant le nombre <text:span text:style-name="T4">en chaÃ®ne de caractÃ¨res</text:span>
grÃ¢ce Ã  la mÃ©thode <text:span text:style-name="CodeDansTexte">toFixed()</text:span>&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">number/to-fixed.js</text:p><text:p text:style-name="Code">console.log(10.0101.toFixed(2));<text:s text:c="5"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(10.0101.toFixed(0));<text:s text:c="5"/><text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">'10.01'</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">'10'</text:span>.
undefined<text:line-break/></text:p>
<text:bookmark text:name="ref-functions" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">CrÃ©er et rÃ©utiliser des blocs de code (fonctions)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Une fonction est un <text:span text:style-name="T7">bloc de code rÃ©utilisable et paramÃ©trable</text:span>.
Elle <text:span text:style-name="T4">retourne</text:span> un rÃ©sultat dont la valeur se calcule en fonction des
paramÃ¨tres que nous lui passons.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cela se passe en deux temps&#160;:</text:p>
<text:p text:style-name="ListeANumero">1.<text:tab/>la <text:span text:style-name="T4">crÃ©ation</text:span> de la fonction&#160;;</text:p><text:p text:style-name="ListeANumero">2.<text:tab/>l'<text:span text:style-name="T4">exÃ©cution</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">ECMAScript fournit un ensemble de fonctions de base&#160;: <text:span text:style-name="CodeDansTexte">console.log()</text:span>,
<text:span text:style-name="CodeDansTexte">setTimeout()</text:span>, etc.
Node ajoute les siennes (comme <text:span text:style-name="CodeDansTexte">require()</text:span>).
Nous avons la libertÃ© d&#8217;en crÃ©er nous-mÃªmes, spÃ©cifiques Ã  nos besoins.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">functions/base.js</text:p><text:p text:style-name="Code">const hello = (mot) =&gt; `Hello ${mot}`;<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(hello);<text:s text:c="21"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">console.log(hello('World'));<text:s text:c="12"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">console.log(hello('toi'));</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const random = () =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const limit = 100;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>return Math.floor(Math.random() * limit);</text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(random());<text:s text:c="18"/><text:span text:style-name="PuceCode">4</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> On <text:span text:style-name="T4">crÃ©e</text:span> la fonction <text:span text:style-name="CodeDansTexte">hello</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">[Function: hello]</text:span>&#160;â€“ il s&#8217;agit de la dÃ©finition de la fonction.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche <text:span text:style-name="CodeDansTexte">"Hello World"</text:span>&#160;â€“ il s&#8217;agit de l'<text:span text:style-name="T4">exÃ©cution</text:span> de la fonction, qui <text:span text:style-name="T4">retourne</text:span> un rÃ©sultat.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Affiche un nombre alÃ©atoire entre&#160;0 et&#160;100&#160;â€“ cette fonction est invoquÃ©e sans paramÃ¨tre.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exemple prÃ©cÃ©dent nous indique qu&#8217;une fonction se dÃ©coupe en trois parties&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Les <text:span text:style-name="T7">arguments</text:span></text:h>
<text:p text:style-name="Remarque">C&#8217;est la partie Ã  gauche de la flÃ¨che&#160;(<text:span text:style-name="CodeDansTexte">&#8658;</text:span>).
Les arguments sont sÃ©parÃ©s par des virgules.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Le <text:span text:style-name="T7">corps</text:span></text:h>
<text:p text:style-name="Remarque">C&#8217;est la partie entre accolades.
Quand la fonction est sur une ligne,
le rÃ©sultat de l&#8217;opÃ©ration est <text:span text:style-name="T4">implicitement retournÃ©</text:span>.
On peut dans ce cas se passer du mot-clÃ© <text:span text:style-name="CodeDansTexte">return</text:span>.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">La <text:span text:style-name="T7">valeur de retour</text:span></text:h>
<text:p text:style-name="Remarque">  C&#8217;est la valeur renvoyÃ©e en dehors de la fonction.
  Elle est dÃ©finie Ã  l&#8217;aide du mot-clÃ© <text:span text:style-name="CodeDansTexte">return</text:span>.
  La valeur <text:span text:style-name="CodeDansTexte">undefined</text:span> est retournÃ©e de maniÃ¨re implicite
  lorsque ce dernier est absent.
undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Rappel</text:span> Variables et portÃ©e</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Le corps d&#8217;une fonction constitue une <text:span text:style-name="T4">portÃ©e</text:span>&#160;: toute variable dÃ©finie
dans le corps d&#8217;une fonction est invisible en dehors.</text:p>
<text:bookmark text:name="ref-anonymous-function" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Les fonctions anonymes</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les fonctions anonymes sont employÃ©es en arguments d&#8217;autres fonctions.
On les dit <text:span text:style-name="T4">anonymes</text:span>, car elles ne sont pas consignÃ©es dans des <text:span text:style-name="T4">variables</text:span>.
Il est frÃ©quent de les utiliser pour <text:span text:style-name="T4">itÃ©rer</text:span> sur des tableaux,
lors d&#8217;Ã©vÃ©nements ou dans des <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-promise"  text:visited-style-name="Visited_20_Internet_20_Link">promesses</text:a>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">C&#8217;est une maniÃ¨re Ã©lÃ©gante d&#8217;encapsuler du code Ã  exÃ©cuter plus tard.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">functions/anonymous.js</text:p><text:p text:style-name="Code">setTimeout(() =&gt; console.log('Une seconde plus tard'), 1000);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">setTimeout(() =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log('Deux secondes plus tard');<text:s text:c="5"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">}, 2000);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">process.on('exit', () =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log('Le processus se termine');<text:s text:c="5"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">"Deux secondes plus tard"</text:span> deux secondes aprÃ¨s le dÃ©but du script.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">"Le processus se termine"</text:span> quand le processus se termine, une fois que toutes les actions en attente ont Ã©tÃ© exÃ©cutÃ©es.<text:line-break/></text:p>
<text:bookmark text:name="ref-callback" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Les fonctions de rappel (callback)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Quand une fonction est passÃ©e en argument d&#8217;une autre fonction,
on appelle cela un <text:span text:style-name="T4">callback</text:span>.
On l&#8217;appelle plus tard (<text:span text:style-name="T4">to&#160;call back</text:span>) que le moment oÃ¹ elle est dÃ©finie.
Elle reÃ§oit des paramÃ¨tres qui aident Ã  reconstruire un contexte
<text:span text:style-name="T4">au moment</text:span> de son exÃ©cution.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">functions/callback.js</text:p><text:p text:style-name="Code">const printYear = (date) =&gt; {<text:s text:c="13"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log(date.getUTCFullYear());<text:s text:c="5"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">setTimeout(printYear, 1000, new Date());<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">// Ã©quivalent Ã </text:p><text:p text:style-name="Code">// setTimeout(date =&gt; printYear(date), 1000, new Date());</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Le troisiÃ¨me argument (et les suivants) de <text:span text:style-name="CodeDansTexte">setTimeout()</text:span> sont transmis en paramÃ¨tres de la fonction de rappel (<text:span text:style-name="T4">callback</text:span>).<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Cette fonction est invoquÃ©e une seconde aprÃ¨s le dÃ©but du script, et reÃ§oit en paramÃ¨tre la date du moment.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche l&#8217;annÃ©e de la date passÃ©e en argument&#160;â€“ dans cet exemple, l&#8217;annÃ©e en courss.<text:line-break/></text:p>
<text:bookmark text:name="ref-rest-parameters" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">ParamÃ¨tres du reste (rest parameters)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les <text:span text:style-name="T4">paramÃ¨tres du reste</text:span> sont un nombre indÃ©fini de paramÃ¨tres
regroupÃ©s dans un mÃªme <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-array"  text:visited-style-name="Visited_20_Internet_20_Link">tableau</text:a>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">functions/rest.js</text:p><text:p text:style-name="Code">const combien_de = (nom, ...params) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log(`On a comptÃ© ${params.length} ${nom}.`);</text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">combien_de('patates', 'un', 'deux', 'trois'); <text:span text:style-name="PuceCode">1</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">"On a comptÃ© 3 patates."</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-array" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Lister, filtrer et trier des Ã©lÃ©ments (Array)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les tableaux (ou listes indexÃ©es) servent Ã  lister des Ã©lÃ©ments,
de tout type et dans l&#8217;ordre de notre choix.
Chaque Ã©lÃ©ment de tableau se voit attribuer un numÃ©ro (<text:span text:style-name="T4">index</text:span>)
qui sert Ã  le retrouver, en itÃ©rant Ã  l&#8217;aide de boucles
ou en ayant recours Ã  d&#8217;autres mÃ©thodes d&#8217;identification.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">array/base.js</text:p><text:p text:style-name="Code">const weekdays = [</text:p><text:p text:style-name="Code"><text:s text:c="2"/>'lundi', 'mardi', 'mercredi', 'jeudi', 'vendredi'</text:p><text:p text:style-name="Code">];</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(weekdays);<text:s text:c="10"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(weekdays.length);<text:s text:c="3"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">console.log(weekdays[1]);<text:s text:c="7"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">console.log(weekdays[0]);</text:p><text:p text:style-name="Code">console.log(weekdays[5]);<text:s text:c="7"/><text:span text:style-name="PuceCode">4</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">["lundi", "mardi", "mercredi", "jeudi", "vendredi"]</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">5</text:span>&#160;â€“ soit la longueur du tableau.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche <text:span text:style-name="CodeDansTexte">"mardi"</text:span>&#160;â€“ un tableau commence Ã  l&#8217;index&#160;<text:span text:style-name="CodeDansTexte">0</text:span>.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Affiche <text:span text:style-name="CodeDansTexte">undefined</text:span>&#160;â€“ il n&#8217;y a aucun Ã©lÃ©ment dÃ©fini Ã  l&#8217;index&#160;<text:span text:style-name="CodeDansTexte">5</text:span>.
undefined<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exemple prÃ©cÃ©dent illustre plusieurs caractÃ©ristiques des collections&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">La numÃ©rotation dÃ©bute Ã  l&#8217;index <text:span text:style-name="CodeDansTexte">0</text:span>.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">La propriÃ©tÃ© <text:span text:style-name="CodeDansTexte">length</text:span> contient la longueur du tableau.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">La valeur <text:span text:style-name="CodeDansTexte">undefined</text:span> est retournÃ©e quand on tente d&#8217;accÃ©der Ã  un index
qui n&#8217;existe pas.
undefined</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-crÃ©er_des_tableaux_Ã _partir_dautres_valeurs" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">CrÃ©er des tableaux Ã  partir d&#8217;autres valeurs</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">indexterm[tableau, Array.from()]</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La fonction <text:span text:style-name="CodeDansTexte">Array.from()</text:span> est une maniÃ¨re de crÃ©er
un tableau Ã  partir de quelque chose qui <text:span text:style-name="T4">ressemble Ã  un tableau</text:span>.</text:p>
<text:bookmark text:name="ref-array.from" /><text:p text:style-name="CodeTitre">array/from.js</text:p><text:p text:style-name="Code">console.log(Array.from('fromage'));<text:s text:c="12"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">// utilisation du second argument</text:p><text:p text:style-name="Code">const uppercase = (letter) =&gt; letter.toUpperCase();</text:p><text:p text:style-name="Code">console.log(Array.from('fromage', uppercase)); <text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">["f", "r", "o", "m", "a", "g", "e"]</text:span>&#160;â€“ chaque lettre de la chaÃ®ne.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">["F", "R", "O", "M", "A", "G", "E"]</text:span>&#160;â€“ chaque lettre de la chaÃ®ne a Ã©tÃ© passÃ©e en majuscule.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le deuxiÃ¨me argument de <text:span text:style-name="CodeDansTexte">Array.from()</text:span> est facultatif.
C&#8217;est une <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-anonymous-function"  text:visited-style-name="Visited_20_Internet_20_Link">fonction anonyme</text:a> qui s&#8217;utilise comme les <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-array.forEach"  text:visited-style-name="Visited_20_Internet_20_Link">mÃ©thodes d&#8217;itÃ©ration</text:a> <text:span text:style-name="CodeDansTexte">Array.forEach()</text:span> et <text:span text:style-name="CodeDansTexte">Array.map()</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette mÃ©thode est des plus utiles pour itÃ©rer sur des listes d&#8217;Ã©lÃ©ments DOM
obtenues avec les fonctions <text:span text:style-name="CodeDansTexte">document.querySelectorAll()</text:span>
et <text:span text:style-name="CodeDansTexte">document.getElementsByTagName()</text:span>, entre autres.</text:p>
<text:p text:style-name="Code">const links = document.querySelectorAll('a');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(Array.from(links).map(a =&gt; a.textContent));</text:p><text:p text:style-name="Code">// parce qu'on ne peut pas faire</text:p><text:p text:style-name="Code">// links.map(a =&gt; a.textContent);</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-array.concat" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Combiner des tableaux</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il est relativement aisÃ© de composer des tableaux en fonction d&#8217;autres tableaux.
Une premiÃ¨re maniÃ¨re d&#8217;y parvenir est d&#8217;utiliser la mÃ©thode <text:span text:style-name="CodeDansTexte">concat()</text:span>&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">array/concat.js</text:p><text:p text:style-name="Code">const mousquetaires = ['Athos', 'Porthos', 'Aramis'];</text:p><text:p text:style-name="Code">const extras = ['d\'Artagnan', 'Albert'];</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(mousquetaires.concat(extras));<text:s text:c="6"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">// autre maniÃ¨re d'obtenir la liste des 5 mousquetaires</text:p><text:p text:style-name="Code">console.log([].concat(mousquetaires, extras));</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">["Athos", "Porthos", "Aramis", "d&#8217;Artagnan", "Albert"]</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette mÃ©thode <text:span text:style-name="T4">crÃ©e un nouveau tableau</text:span> Ã  partir de deux passÃ©s en paramÃ¨tres.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Alternative</text:span> OpÃ©rateur&#160;<text:span text:style-name="CodeDansTexte">&#8230;&#8203;</text:span>&#160;(<text:span text:style-name="T4">spread</text:span>)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
Une autre maniÃ¨re de faire est d&#8217;utiliser l&#8217;opÃ©rateur <text:span text:style-name="CodeDansTexte">&#8230;&#8203;</text:span>
(aussi appelÃ© <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-spread"  text:visited-style-name="Visited_20_Internet_20_Link">spread</text:a>) pour Ã©clater plusieurs tableaux et
les rassembler dans un autre&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">array/spread.js</text:p><text:p text:style-name="RemarqueCode">const mousquetaires = ['Athos', 'Porthos', 'Aramis'];</text:p><text:p text:style-name="RemarqueCode">const extras = ['d\'Artagnan', 'Albert'];</text:p><text:p text:style-name="RemarqueCode"></text:p><text:p text:style-name="RemarqueCode">console.log([...mousquetaires, ...extras]);<text:s text:c="3"/><text:span text:style-name="PuceCode">1</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">["Athos", "Porthos", "Aramis", "d&#8217;Artagnan", "Albert"]</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ã€ l&#8217;inverse, la mÃ©thode <text:span text:style-name="CodeDansTexte">join()</text:span> concatÃ¨ne tous les Ã©lÃ©ments dans une
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-string"  text:visited-style-name="Visited_20_Internet_20_Link">chaÃ®ne de caractÃ¨res</text:a> avec le sÃ©parateur de notre choix (optionnel).
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">array/join.js</text:p><text:p text:style-name="Code">const headers = ['ID', 'NOM', 'PRENOM'];</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(headers.join());<text:s text:c="4"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(headers.join(';')); <text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">console.log(headers.join(''));<text:s text:c="2"/><text:span text:style-name="PuceCode">3</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">"ID,NOM,PRENOM"</text:span>&#160;â€“ le sÃ©parateur par dÃ©faut est une virgule.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">"ID;NOM;PRENOM"</text:span>&#160;â€“ on a choisi le point-virgule comme sÃ©parateur.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche <text:span text:style-name="CodeDansTexte">"IDNOMPRENOM"</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-array.forEach" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">ItÃ©rer sur les valeurs avec des boucles</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les boucles sont une maniÃ¨re de parcourir plusieurs valeurs.
Elles aident Ã  mettre en place des automatismes pour Ã©viter de rÃ©pÃ©ter du code.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">array/loop.js</text:p><text:p text:style-name="Code">const weekdays = [</text:p><text:p text:style-name="Code"><text:s text:c="2"/>'lundi', 'mardi', 'mercredi', 'jeudi', 'vendredi'</text:p><text:p text:style-name="Code">];</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">for (const day of weekdays) {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log(day);<text:s text:c="27"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">// on obtient le mÃªme rÃ©sultat avec la mÃ©thode `forEach`</text:p><text:p text:style-name="Code">weekdays.forEach((day) =&gt; console.log(day));</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche successivement chaque valeur du tableau&#160;â€“ <text:span text:style-name="CodeDansTexte">"lundi"</text:span>, <text:span text:style-name="CodeDansTexte">"mardi"</text:span>, <text:span text:style-name="CodeDansTexte">"mercredi"</text:span>, <text:span text:style-name="CodeDansTexte">"jeudi"</text:span>, <text:span text:style-name="CodeDansTexte">"vendredi"</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Prenons le temps de revenir sur cet exemple.
On y dÃ©couvre plusieurs maniÃ¨res d&#8217;Ã©crire des boucles sur un tableau&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">for&#8230;&#8203;of</text:span></text:h>
<text:p text:style-name="Remarque">On affecte une variable avec chaque Ã©lÃ©ment (opÃ©rateur <text:span text:style-name="CodeDansTexte">of</text:span>) du tableau.
Les expressions situÃ©es entre accolade sont exÃ©cutÃ©es pour
chaque Ã©lÃ©ment du tableau.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">forEach(element &#8658; expression)</text:span></text:h>
<text:p text:style-name="Remarque">  La mÃ©thode <text:span text:style-name="CodeDansTexte">forEach</text:span> applique une <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-anonymous-function"  text:visited-style-name="Visited_20_Internet_20_Link">fonction anonyme</text:a>
  pour chaque Ã©lÃ©ment du tableau.
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il y a en rÃ©alitÃ© deux maniÃ¨res d&#8217;itÃ©rer avec la boucle&#160;<text:span text:style-name="CodeDansTexte">for</text:span>&#160;:
sur les <text:span text:style-name="T4">index</text:span> (avec l&#8217;opÃ©rateur&#160;<text:span text:style-name="CodeDansTexte">in</text:span>)
et sur les <text:span text:style-name="T4">valeurs</text:span> (avec l&#8217;opÃ©rateur&#160;<text:span text:style-name="CodeDansTexte">of</text:span>).
undefined
undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">array/for-of-in.js</text:p><text:p text:style-name="Code">const weekend = ['samedi', 'dimanche'];</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">for (const index in weekend) {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log(index);<text:s text:c="13"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log(weekend[index]);<text:s text:c="4"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">for (const day of weekend) {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log(day);<text:s text:c="15"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">}</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche successivement&#160;<text:span text:style-name="CodeDansTexte">0</text:span> puis&#160;<text:span text:style-name="CodeDansTexte">1</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche successivement <text:span text:style-name="CodeDansTexte">"samedi"</text:span> puis <text:span text:style-name="CodeDansTexte">"dimanche"</text:span>&#160;â€“ l&#8217;index sert Ã  retrouver la valeur dans le tableau.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche successivement <text:span text:style-name="CodeDansTexte">"samedi"</text:span> puis <text:span text:style-name="CodeDansTexte">"dimanche"</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La mÃ©thode <text:span text:style-name="CodeDansTexte">forEach()</text:span> propage en rÃ©alitÃ© trois arguments Ã  notre fonction anonyme&#160;:
l&#8217;Ã©lÃ©ment en cours de l&#8217;itÃ©ration, l&#8217;index de l&#8217;Ã©lÃ©ment et le tableau d&#8217;origine.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Pourquoi passer le tableau d&#8217;origine alors qu&#8217;on itÃ¨re dessus&#160;?
Pour donner du contexte au cas oÃ¹ on opÃ¨re
avec une <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-function"  text:visited-style-name="Visited_20_Internet_20_Link">fonction nommÃ©e</text:a>.
Nous verrons un usage concret de ce troisiÃ¨me argument
dans la section <text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-array.map"  text:visited-style-name="Visited_20_Internet_20_Link">Transformer les valeurs</text:a></text:span>.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">array/foreach-function.js</text:p><text:p text:style-name="Code">const undeux = ['un', 'deux'];</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const printIndex = (element, index, array) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log(`${element} : index ${index}`);<text:s text:c="2"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">undeux.forEach(printIndex);<text:s text:c="20"/><text:span text:style-name="PuceCode">1</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Applique la fonction <text:span text:style-name="CodeDansTexte">printIndex()</text:span> pour chaque Ã©lÃ©ment du tableau <text:span text:style-name="CodeDansTexte">undeux</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche successivement <text:span text:style-name="CodeDansTexte">"un&#160;: index 0"</text:span> puis <text:span text:style-name="CodeDansTexte">"deux&#160;: index 1"</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Outre l&#8217;inspection et l&#8217;affichage des valeurs, les boucles offrent la libertÃ©
de <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-array.sort"  text:visited-style-name="Visited_20_Internet_20_Link">trier</text:a>, de <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-array.map"  text:visited-style-name="Visited_20_Internet_20_Link">transformer les valeurs</text:a>,
de <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-array.filter"  text:visited-style-name="Visited_20_Internet_20_Link">filtrer selon des conditions</text:a>,
mais aussi de <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-array.reduce"  text:visited-style-name="Visited_20_Internet_20_Link">crÃ©er de nouvelles structures de donnÃ©es</text:a>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ces mÃ©thodes sont dÃ©crites dans les sections suivantes.</text:p>
<text:bookmark text:name="ref-array.sort" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Trier les valeurs</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La mÃ©thode <text:span text:style-name="CodeDansTexte">sort()</text:span> change l&#8217;ordre des Ã©lÃ©ments d&#8217;un tableau.
Elle utilise une <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-anonymous-function"  text:visited-style-name="Visited_20_Internet_20_Link">fonction anonyme</text:a> qui compare deux Ã©lÃ©ments
entre eux&#160;; elle retourne un nombre positif, nÃ©gatif ou Ã©gal Ã  zÃ©ro selon la
logique que l&#8217;on souhaite donner au tri&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">Quand la comparaison est <text:span text:style-name="T4">nÃ©gative</text:span>,
<text:span text:style-name="CodeDansTexte">sort()</text:span> place le premier Ã©lÃ©ment <text:span text:style-name="T4">avant</text:span> le second.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Quand la comparaison est <text:span text:style-name="T4">positive</text:span>,
<text:span text:style-name="CodeDansTexte">sort()</text:span> place le premier Ã©lÃ©ment <text:span text:style-name="T4">aprÃ¨s</text:span> le second.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Quand la comparaison est Ã©gale Ã  zÃ©ro, nulle ou non spÃ©cifiÃ©e,
l&#8217;ordre des Ã©lÃ©ments reste inchangÃ©.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">array/sort.js</text:p><text:p text:style-name="Code">const sortAsc = (a, b) =&gt; a - b;</text:p><text:p text:style-name="Code">const sortDesc = (a, b) =&gt; b - a;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log([1, 3, 2].sort(sortAsc));<text:s text:c="17"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const undeux = [</text:p><text:p text:style-name="Code"><text:s text:c="2"/>{label: 'deux', order: 2},</text:p><text:p text:style-name="Code"><text:s text:c="2"/>{label: 'un', order: 1}</text:p><text:p text:style-name="Code">];</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(undeux.sort((a, b) =&gt; a.order - b.order));<text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">[1, 2, 3]</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">[ { label: "un", order: 1 }, { label: "deux", order: 2 } ]</text:span>&#160;â€“ le tableau a Ã©tÃ© triÃ© sur la valeur de <text:span text:style-name="CodeDansTexte">order</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-string"  text:visited-style-name="Visited_20_Internet_20_Link">chaÃ®nes de caractÃ¨res</text:a> peuvent Ãªtre comparÃ©es avec <text:span text:style-name="CodeDansTexte">localeCompare()</text:span>.
Cette mÃ©thode retourne un nombre aprÃ¨s une comparaison caractÃ¨re par caractÃ¨re
entre deux chaÃ®nes.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">array/sort-strings.js</text:p><text:p text:style-name="Code">const sortAlpha = (a, b) =&gt; a.localeCompare(b);</text:p><text:p text:style-name="Code">console.log(['A', 'b', 'c', 'a'].sort(sortAlpha));<text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const undeux = [</text:p><text:p text:style-name="Code"><text:s text:c="2"/>{label: 'un', order: 1},</text:p><text:p text:style-name="Code"><text:s text:c="2"/>{label: 'deux', order: 2}</text:p><text:p text:style-name="Code">];</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const sortLabel = (a, b) =&gt; a.label.localeCompare(b.label);</text:p><text:p text:style-name="Code">console.log(undeux.sort(sortLabel));<text:s text:c="14"/><text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">["a", "A", "b", "c"]</text:span>&#160;â€“ les majuscules influencent le&#160;tri.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">[ { label: "deux", order: 2 }, { label: "un", order: 1 } ]</text:span>&#160;â€“ le tableau a Ã©tÃ© triÃ© sur la valeur de <text:span text:style-name="CodeDansTexte">label</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Alternative</text:span> <text:span text:style-name="CodeDansTexte">Array.reverse()</text:span></text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
La mÃ©thode <text:span text:style-name="CodeDansTexte">reverse()</text:span> transforme le tableau d&#8217;origine
en inversant l&#8217;ordre de ses Ã©lÃ©ments.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">array/reverse.js</text:p><text:p text:style-name="RemarqueCode">const weekend = ['samedi', 'dimanche'];</text:p><text:p text:style-name="RemarqueCode"></text:p><text:p text:style-name="RemarqueCode">weekend.reverse();</text:p><text:p text:style-name="RemarqueCode"></text:p><text:p text:style-name="RemarqueCode">console.log(weekend);<text:s text:c="5"/><text:span text:style-name="PuceCode">1</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">["dimanche", "samedi"]</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-array.map" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Transformer les valeurs</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La mÃ©thode <text:span text:style-name="CodeDansTexte">map()</text:span> fonctionne quasiment comme <text:span text:style-name="CodeDansTexte">forEach()</text:span>, Ã  ceci prÃ¨s qu&#8217;elle
retourne un nouveau tableau, constituÃ© des valeurs retournÃ©es par la fonction
appliquÃ©e sur chaque Ã©lÃ©ment.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">array/map.js</text:p><text:p text:style-name="Code">const newArray = ['a', ' b', 'c '].map(value =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>return value.trim().toUpperCase();</text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(newArray); <text:span text:style-name="PuceCode">1</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Retourne <text:span text:style-name="CodeDansTexte">['A', 'B', 'C']</text:span>&#160;â€“ on a passÃ© tous les Ã©lÃ©ments en lettres majuscules.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le troisiÃ¨me argument de la mÃ©thode <text:span text:style-name="CodeDansTexte">map()</text:span> prend ici tout son sens.
Par exemple, si l&#8217;on souhaite dÃ©doublonner un tableau&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">array/map-dedupe.js</text:p><text:p text:style-name="Code">const soundcheck = ['un', 'deux', 'un', 'deux'];</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const dedupe = (element, index, array) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>if (array.slice(index+1).includes(element)) {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>return null;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>return element;</text:p><text:p text:style-name="Code">}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(soundcheck.map(dedupe));<text:s text:c="10"/><text:span text:style-name="PuceCode">1</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">[null, null, "un", "deux"]</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cet exemple vÃ©rifie, Ã  chaque itÃ©ration, si la valeur de l&#8217;Ã©lÃ©ment
est contenue dans la <text:span text:style-name="T4">suite du tableau</text:span>.
<text:span text:style-name="CodeDansTexte">array.slice(index+1)</text:span> crÃ©e un nouveau tableau contenant tous les Ã©lÃ©ments
situÃ©s <text:span text:style-name="T4">aprÃ¨s</text:span> l&#8217;Ã©lÃ©ment courant (<text:span text:style-name="CodeDansTexte">index+1</text:span>).
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La mÃ©thode de transformation <text:span text:style-name="CodeDansTexte">reduce()</text:span> est diffÃ©rente, car elle passe le rÃ©sultat
de la prÃ©cÃ©dente itÃ©ration Ã  la suivante.
C&#8217;est comme si elle <text:span text:style-name="T4">accumulait</text:span> les rÃ©sultats.
Elle retourne une valeur finale qui peut Ãªtre autre chose qu&#8217;un tableau.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">array/reduce.js</text:p><text:p text:style-name="Code">const stats = [2, 4, 6, 10];</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const sum = (previous, element) =&gt; previous + element;<text:s text:c="2"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(stats.reduce(sum, 0));<text:s text:c="4"/><text:span text:style-name="PuceCode">1</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Effectue une <text:span text:style-name="T4">rÃ©duction</text:span> Ã  l&#8217;aide de la fonction <text:span text:style-name="CodeDansTexte">sum()</text:span> et d&#8217;une valeur par dÃ©faut de&#160;<text:span text:style-name="CodeDansTexte">0</text:span>&#160;â€“ affiche&#160;<text:span text:style-name="CodeDansTexte">22</text:span> Ã  l&#8217;issue des itÃ©rationsâ€¯.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> La valeur de l&#8217;Ã©lÃ©ment est le <text:span text:style-name="T4">second paramÃ¨tre</text:span>&#160;; le premier paramÃ¨tre correspond au rÃ©sultat de l&#8217;itÃ©ration prÃ©cÃ©dente ou Ã  la valeur initiale, passÃ©e en argument Ã  <text:span text:style-name="CodeDansTexte">reduce()</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-array.filter" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Filtrer les valeurs</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La mÃ©thode <text:span text:style-name="CodeDansTexte">filter()</text:span> retourne un nouveau tableau filtrÃ© Ã  l&#8217;aide
d&#8217;une <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-anonymous-function"  text:visited-style-name="Visited_20_Internet_20_Link">fonction anonyme</text:a>.
Seuls les Ã©lÃ©ments qui satisfont Ã  la condition Ã©tablie par la fonction
se retrouvent dans le nouveau tableau.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">array/filter.js</text:p><text:p text:style-name="Code">const values = [null, 'un', 'deux', 3];</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const is_finite = (value) =&gt; Number.isFinite(value);</text:p><text:p text:style-name="Code">const direct = (value) =&gt; value;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(values.filter(is_finite));<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(values.filter(direct));<text:s text:c="5"/><text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Retourne&#160;<text:span text:style-name="CodeDansTexte">[3]</text:span>&#160;â€“ c&#8217;est la seule valeur qui soit un nombre.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Retourne <text:span text:style-name="CodeDansTexte">["un", "deux", 3]</text:span>&#160;â€“ ce sont les valeurs non&#160;nulles.<text:line-break/></text:p>
<text:bookmark text:name="ref-array.find" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Identifier des valeurs</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les mÃ©thodes <text:span text:style-name="CodeDansTexte">indexOf()</text:span>, <text:span text:style-name="CodeDansTexte">lastIndexOf()</text:span> et <text:span text:style-name="CodeDansTexte">includes()</text:span> identifient une
<text:span text:style-name="T4">valeur exacte</text:span> au sein d&#8217;un tableau.
undefined
undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="CodeDansTexte">indexOf()</text:span> et <text:span text:style-name="CodeDansTexte">lastIndexOf()</text:span> retournent l&#8217;index de la valeur recherchÃ©e.
Si aucun Ã©lÃ©ment n&#8217;a Ã©tÃ© retrouvÃ©, elles retourneront la valeur&#160;<text:span text:style-name="CodeDansTexte">-1</text:span>.<text:line-break/><text:span text:style-name="CodeDansTexte">includes()</text:span> retourne un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-boolean"  text:visited-style-name="Visited_20_Internet_20_Link">boolÃ©en</text:a> indiquant si la recherche
est fructueuse (<text:span text:style-name="CodeDansTexte">true</text:span>) ou non (<text:span text:style-name="CodeDansTexte">false</text:span>).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">array/index-of-includes.js</text:p><text:p text:style-name="Code">const soundcheck = ['un', 'deux', 'un', 'deux'];</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(soundcheck.indexOf('un'));<text:s text:c="8"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(soundcheck.indexOf('deux'));<text:s text:c="6"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">console.log(soundcheck.indexOf('trois'));<text:s text:c="5"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(soundcheck.lastIndexOf('deux'));<text:s text:c="2"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(soundcheck.includes('deux'));<text:s text:c="5"/><text:span text:style-name="PuceCode">5</text:span></text:p><text:p text:style-name="Code">console.log(soundcheck.includes('trois'));<text:s text:c="4"/><text:span text:style-name="PuceCode">6</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">0</text:span>&#160;â€“ le premier <text:span text:style-name="CodeDansTexte">"un"</text:span> est l&#8217;Ã©lÃ©ment&#160;``0` du tableau.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">1</text:span>&#160;â€“ le premier <text:span text:style-name="CodeDansTexte">"deux"</text:span> est l&#8217;Ã©lÃ©ment&#160;``1` du tableau.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">-1</text:span>&#160;â€“ cet Ã©lÃ©ment est absent du tableau.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">3</text:span>&#160;â€“ le dernier <text:span text:style-name="CodeDansTexte">"deux"</text:span> est l&#8217;Ã©lÃ©ment&#160;``3` du tableau.<text:line-break/><text:span text:style-name="PuceCode">5</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">true</text:span>&#160;â€“ l&#8217;Ã©lÃ©ment <text:span text:style-name="CodeDansTexte">"un"</text:span> existe dans le tableau.<text:line-break/><text:span text:style-name="PuceCode">6</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">false</text:span>&#160;â€“ l&#8217;Ã©lÃ©ment <text:span text:style-name="CodeDansTexte">"trois"</text:span> n&#8217;existe pas dans le tableau.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il existe ensuite d&#8217;autres mÃ©thodes comme <text:span text:style-name="CodeDansTexte">find()</text:span>, <text:span text:style-name="CodeDansTexte">some()</text:span> et <text:span text:style-name="CodeDansTexte">every()</text:span>.
Elles <text:span text:style-name="T7">identifient des Ã©lÃ©ments Ã  partir d&#8217;une fonction</text:span>.
Les conditions de recherche sont plus complÃ¨tes, car on n&#8217;est pas obligÃ©
de connaÃ®tre la valeur exacte recherchÃ©e.
undefined
undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La mÃ©thode <text:span text:style-name="CodeDansTexte">find()</text:span> retourne le premier <text:span text:style-name="T4">Ã©lÃ©ment</text:span> qui remplisse la condition&#160;;
 <text:span text:style-name="CodeDansTexte">findIndex()</text:span> en retourne l'<text:span text:style-name="T4">index</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">array/find.js</text:p><text:p text:style-name="Code">const values = [null, 2, 10, 100];</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const biggerThan50 = (value) =&gt; value &gt; 50;<text:s text:c="3"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(values.find(biggerThan50));<text:s text:c="7"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">console.log(values.findIndex(biggerThan50));<text:s text:c="2"/><text:span text:style-name="PuceCode">3</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> La fonction retourne <text:span text:style-name="CodeDansTexte">true</text:span> si la valeur passÃ©e en argument est un nombre supÃ©rieur&#160;Ã &#160;<text:span text:style-name="CodeDansTexte">50</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">100</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">3</text:span>&#160;â€“ c&#8217;est l&#8217;index de la valeur&#160;<text:span text:style-name="CodeDansTexte">100</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les mÃ©thodes <text:span text:style-name="CodeDansTexte">some()</text:span> et <text:span text:style-name="CodeDansTexte">every()</text:span> retournent <text:span text:style-name="CodeDansTexte">true</text:span> respectivement
si <text:span text:style-name="T4">au moins une itÃ©ration</text:span> est satisfaisante et
si <text:span text:style-name="T4">toutes les itÃ©rations</text:span> sont satisfaisantes.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">array/some.js</text:p><text:p text:style-name="Code">const values = [1, 'a', 120, undefined, 4];</text:p><text:p text:style-name="Code">const isUndefined = (value) =&gt; value === undefined;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(values.every(isUndefined));<text:s text:c="16"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(values.some(isUndefined));<text:s text:c="17"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">console.log(values.filter(d =&gt; d).some(isUndefined));<text:s text:c="2"/><text:span text:style-name="PuceCode">3</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">false</text:span>&#160;â€“ toutes les valeurs ne sont pas Ã©gales Ã  <text:span text:style-name="CodeDansTexte">undefined</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">true</text:span>&#160;â€“ au moins une valeur est Ã©gale Ã  <text:span text:style-name="CodeDansTexte">undefined</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche <text:span text:style-name="CodeDansTexte">false</text:span>&#160;â€“ il n&#8217;y a plus de valeur <text:span text:style-name="CodeDansTexte">undefined</text:span> dans le tableau, car on a utilisÃ© la mÃ©thode <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-array.filter"  text:visited-style-name="Visited_20_Internet_20_Link">filter</text:a> pour supprimer les valeurs vides.<text:line-break/></text:p>
<text:bookmark text:name="ref-array-destructuring" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">DÃ©composition de tableau (destructuring)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;affectation par dÃ©composition (<text:span text:style-name="T4">destructuring</text:span>) est une maniÃ¨re Ã©lÃ©gante
de piocher des valeurs dans un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-array"  text:visited-style-name="Visited_20_Internet_20_Link">tableau</text:a>.
Ce mÃ©canisme n&#8217;altÃ¨re pas le contenu des variables dÃ©composÃ©es et existe aussi
pour les <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-object-destructuring"  text:visited-style-name="Visited_20_Internet_20_Link">objets</text:a>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">array/destructuring.js</text:p><text:p text:style-name="Code">const weekdays = [</text:p><text:p text:style-name="Code"><text:s text:c="2"/>'lundi', 'mardi', 'mercredi', 'jeudi', 'vendredi'</text:p><text:p text:style-name="Code">];</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const [first, second] = weekdays;</text:p><text:p text:style-name="Code">console.log(first);<text:s text:c="15"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(second);<text:s text:c="14"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const [,, third] = weekdays;</text:p><text:p text:style-name="Code">console.log(third);<text:s text:c="15"/><text:span text:style-name="PuceCode">3</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">"lundi"</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">"mardi"</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche <text:span text:style-name="CodeDansTexte">"mercredi"</text:span>&#160;â€“ l&#8217;utilisation des virgules sans variable a permis de <text:span text:style-name="T4">sauter</text:span> des positions dans la dÃ©composition.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La dÃ©composition se combine agrÃ©ablement avec l&#8217;opÃ©rateur <text:span text:style-name="CodeDansTexte">&#8230;&#8203;</text:span> (<text:span text:style-name="T4">spread</text:span>).
Il accumule le reste des Ã©lÃ©ments dans une variable, sous forme de tableau.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">array/destructuring-rest.js</text:p><text:p text:style-name="Code">const weekdays = [</text:p><text:p text:style-name="Code"><text:s text:c="2"/>'lundi', 'mardi', 'mercredi', 'jeudi', 'vendredi'</text:p><text:p text:style-name="Code">];</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const [first, second, ...rest] = weekdays;</text:p><text:p text:style-name="Code">console.log(rest);<text:s text:c="18"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">// revient au mÃªme que</text:p><text:p text:style-name="Code">// const [,, ...rest] = weekdays;</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">["mercredi", "jeudi", "vendredi"]</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La mÃ©thode <text:span text:style-name="CodeDansTexte">slice()</text:span> offre davantage de souplesse pour gÃ©rer les <text:span text:style-name="T4">limites</text:span>.
On choisit <text:span text:style-name="T4">l&#8217;index de dÃ©but</text:span> (inclus) et celui <text:span text:style-name="T4">de fin</text:span> (non inclus) de la dÃ©composition.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">array/slice.js</text:p><text:p text:style-name="Code">const values = ['un', 'deux', 'trois', 'quatre'];</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(values.slice(1));<text:s text:c="5"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(values.slice(1, 2));<text:s text:c="2"/><text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">["deux", "trois", "quatre"]</text:span>&#160;â€“ Ã  partir de l&#8217;index&#160;<text:span text:style-name="CodeDansTexte">1</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">["deux"]</text:span>&#160;â€“ Ã  partir de l&#8217;index&#160;<text:span text:style-name="CodeDansTexte">1</text:span> et jusqu&#8217;Ã  l&#8217;index&#160;<text:span text:style-name="CodeDansTexte">2</text:span> (non&#160;inclus).<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Si les valeurs de dÃ©but et/ou de fin sont <text:span text:style-name="T4">nÃ©gatives</text:span>,
les index sont calculÃ©s <text:span text:style-name="T4">Ã  partir de la fin</text:span> du tableau.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">array/slice-negative.js</text:p><text:p text:style-name="Code">const values = ['un', 'deux', 'trois', 'quatre'];</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(values.slice(-1));<text:s text:c="5"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(values.slice(-3));<text:s text:c="5"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(values.slice(0, -1));<text:s text:c="2"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">console.log(values.slice(0, -3));<text:s text:c="2"/><text:span text:style-name="PuceCode">4</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">["quatre"]</text:span>&#160;â€“ premier Ã©lÃ©ment Ã  partir de la&#160;fin.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">["deux", "trois", "quatre"]</text:span>&#160;â€“ les trois premiers Ã©lÃ©ments Ã  partir de la&#160;fin.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche <text:span text:style-name="CodeDansTexte">["un", "deux", "trois"]</text:span>&#160;â€“ jusqu&#8217;au dernier Ã©lÃ©ment Ã  partir de la fin (non&#160;inclus).<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Affiche <text:span text:style-name="CodeDansTexte">["un"]</text:span>&#160;â€“ jusqu&#8217;au troisiÃ¨me Ã©lÃ©ment Ã  partir de la fin (non&#160;inclus).<text:line-break/></text:p>
<text:bookmark text:name="ref-object" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">ReprÃ©senter des structures d&#8217;objet et y accÃ©der</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les structures d&#8217;objet servent Ã  lister des Ã©lÃ©ments de tout type
au sein d&#8217;une mÃªme variable.
L&#8217;indexation se fait <text:span text:style-name="T4">comme dans un dictionnaire</text:span>,
avec un identifiant unique pour chaque valeur.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">object/base.js</text:p><text:p text:style-name="Code">const francine = {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>first_name: 'Francine',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>location: 'DrÃ´me',</text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(francine.first_name); <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">francine.age = 25;<text:s text:c="16"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">console.log(francine.age);<text:s text:c="8"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">console.log(francine.twitter);<text:s text:c="4"/><text:span text:style-name="PuceCode">4</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">"Francine"</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> On affecte une valeur numÃ©rique Ã  l&#8217;index <text:span text:style-name="CodeDansTexte">age</text:span> une fois l&#8217;objet&#160;crÃ©Ã©.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche&#160;``25`&#160;â€“ la valeur numÃ©rique prÃ©cÃ©demment affectÃ©e.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Affiche&#160;``undefined`&#160;â€“ aucune valeur n&#8217;est affectÃ©e pour cette&#160;clÃ©.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Une autre syntaxe existe pour crÃ©er des valeurs et y accÃ©der en utilisant
des variables en guise d&#8217;identifiant d&#8217;index.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">object/dynamic.js</text:p><text:p text:style-name="Code">const SOCIAL_NETWORK = 'twitter';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const francine = {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>first_name: 'Francine',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>location: 'DrÃ´me',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>[SOCIAL_NETWORK]: '@FrancineDu26',<text:s text:c="4"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(francine[SOCIAL_NETWORK]);<text:s text:c="2"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">// maniÃ¨res Ã©quivalentes, sans utilisation de variable</text:p><text:p text:style-name="Code">console.log(francine.twitter);</text:p><text:p text:style-name="Code">console.log(francine['twitter']);</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affecte la chaÃ®ne <text:span text:style-name="CodeDansTexte">@FrancineDu26</text:span> dans l&#8217;index correspondant Ã  la valeur de la variable <text:span text:style-name="CodeDansTexte">SOCIAL_NETWORK</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">"@FrancineDu26"</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-object-destructuring" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">DÃ©composition d&#8217;objet (<text:span text:style-name="T4">destructuring</text:span>)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;affectation par dÃ©composition (<text:span text:style-name="T4">destructuring</text:span>) est une maniÃ¨re
Ã©lÃ©gante de piocher des valeurs dans un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-object"  text:visited-style-name="Visited_20_Internet_20_Link">objet</text:a>.
Ce mÃ©canisme existe aussi pour les <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-array-destructuring"  text:visited-style-name="Visited_20_Internet_20_Link">tableaux</text:a>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">object/destructuring.js</text:p><text:p text:style-name="Code">const francine = {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>first_name: 'Francine',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>location: 'DrÃ´me',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>twitter: '@FrancineDu26',</text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {location,twitter} = francine;</text:p><text:p text:style-name="Code">console.log(location);<text:s text:c="12"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {first_name:prenom} = francine;</text:p><text:p text:style-name="Code">console.log(prenom);<text:s text:c="14"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {is_admin=false} = francine;</text:p><text:p text:style-name="Code">console.log(is_admin);<text:s text:c="12"/><text:span text:style-name="PuceCode">3</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">"DrÃ´me"</text:span>&#160;â€“ on a dÃ©composÃ© la clÃ© <text:span text:style-name="CodeDansTexte">location</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">"Francine"</text:span>&#160;â€“ on a dÃ©composÃ© puis renommÃ© la clÃ© <text:span text:style-name="CodeDansTexte">first_name</text:span> en une nouvelle variable&#160;: <text:span text:style-name="CodeDansTexte">prenom</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche <text:span text:style-name="CodeDansTexte">false</text:span>&#160;â€“ on a dÃ©composÃ© la clÃ© <text:span text:style-name="CodeDansTexte">is_admin</text:span> et, comme elle n&#8217;existe pas, on a spÃ©cifiÃ© la valeur par dÃ©faut <text:span text:style-name="CodeDansTexte">false</text:span>, au lieu de <text:span text:style-name="CodeDansTexte">undefined</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La dÃ©composition se combine agrÃ©ablement avec l&#8217;opÃ©rateur <text:span text:style-name="CodeDansTexte">&#8230;&#8203;</text:span> (<text:span text:style-name="T4">spread</text:span>).
Il accumule <text:span text:style-name="T4">le reste</text:span> des Ã©lÃ©ments dans une variable, sous forme d&#8217;objet.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">object/destructuring-rest.js</text:p><text:p text:style-name="Code">const francine = {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>first_name: 'Francine',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>location: 'DrÃ´me',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>twitter: '@FrancineDu26',</text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {first_name, ...metadata} = francine;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(first_name);<text:s text:c="10"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(metadata);<text:s text:c="12"/><text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">"Francine"</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">{ location: "DrÃ´me", twitter: "@FrancineDu26" }</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-object.assign" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Combiner des objets</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="CodeDansTexte">Object.assign()</text:span> est une mÃ©thode qui sert Ã  Ã©tendre et combiner plusieurs objets.
On a le choix d&#8217;intÃ©grer les nouveaux Ã©lÃ©ments Ã  un objet existant
ou bien d&#8217;en crÃ©er un nouveau.
Les objets sont combinÃ©s dans le premier paramÃ¨tre de la fonction.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">object/assign.js</text:p><text:p text:style-name="Code">const o = {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>first_name: 'Francine',</text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const o2 = Object.assign({}, o, {location: 'DrÃ´me'});</text:p><text:p text:style-name="Code">console.log(o2);<text:s text:c="8"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(o);<text:s text:c="9"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">Object.assign(o2, {location: 'Paris'}, {location: 'ArdÃ¨che'});</text:p><text:p text:style-name="Code">console.log(o2);<text:s text:c="8"/><text:span text:style-name="PuceCode">3</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">{ first_name: "Francine", location: "DrÃ´me" }</text:span>&#160;â€“ la nouvelle variable contient nos deux objets combinÃ©s.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">{ first_name: "Francine" }</text:span>&#160;â€“ ce sont les valeurs originelles de notre objet.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche <text:span text:style-name="CodeDansTexte">{ first_name: "Francine", location: 'ArdÃ¨che' }</text:span>&#160;â€“ l&#8217;objet&#160;<text:span text:style-name="CodeDansTexte">o2</text:span> a reÃ§u la nouvelle propriÃ©tÃ© <text:span text:style-name="CodeDansTexte">location</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Notez que les affectations se font de <text:span text:style-name="T4">gauche Ã  droite</text:span>.
Toute clÃ© existante est remplacÃ©e.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-object-destructuring"  text:visited-style-name="Visited_20_Internet_20_Link">dÃ©composition d&#8217;objet</text:a> sert Ã©galement Ã  combiner
des objets entre&#160;eux.
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">object/destructuring-spread.js</text:p><text:p text:style-name="Code">const francine = {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>first_name: 'Francine',</text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const francine26 = {...francine, location: 'DrÃ´me'};</text:p><text:p text:style-name="Code">console.log(francine26);<text:s text:c="6"/><text:span text:style-name="PuceCode">1</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">{ first_name: "Francine", location: "DrÃ´me" }</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-itÃ©rer_sur_des_objets" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">ItÃ©rer sur des objets</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La mÃ©thode <text:span text:style-name="CodeDansTexte">Object.entries()</text:span> est probablement la plus adaptÃ©e pour itÃ©rer Ã  la
fois sur les <text:span text:style-name="T4">clÃ©s</text:span> et sur les <text:span text:style-name="T4">valeurs</text:span> d&#8217;un objet.
Elle retourne un tableau qui contient autant de paires de <text:span text:style-name="CodeDansTexte">[clÃ©, valeur]</text:span> qu&#8217;il y a
d&#8217;Ã©lÃ©ments dans l&#8217;objet.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">object/entries.js</text:p><text:p text:style-name="Code">const francine = {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>first_name: 'Francine',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>location: 'DrÃ´me',</text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(Object.entries(francine)); <text:span text:style-name="PuceCode">1</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">[[ "first_name", "Francine" ], [ "location", "DrÃ´me" ]]</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous sommes libres d'<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-array.forEach"  text:visited-style-name="Visited_20_Internet_20_Link">itÃ©rer sur les valeurs</text:a>
et d&#8217;utiliser la <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-array-destructuring"  text:visited-style-name="Visited_20_Internet_20_Link">dÃ©composition de tableaux</text:a>
pour rendre notre code explicite&#160;:
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">object/entries-loop.js</text:p><text:p text:style-name="Code">const francine = {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>first_name: 'Francine',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>location: 'DrÃ´me',</text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">Object.entries(francine).forEach(([key, value]) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log(`francine.${key} vaut ${value}`);<text:s text:c="3"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">})</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">// mÃªme rÃ©sultat, autre mÃ©thode</text:p><text:p text:style-name="Code">for (const [key, value] of Object.entries(francine)) {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log(`francine.${key} vaut ${value}`);</text:p><text:p text:style-name="Code">}</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche successivement <text:span text:style-name="CodeDansTexte">"francine.first_name vaut Francine"</text:span> puis <text:span text:style-name="CodeDansTexte">"francine.location vaut DrÃ´me"</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Deux autres mÃ©thodes rÃ©cupÃ¨rent soit <text:span text:style-name="T4">la liste des clÃ©s</text:span> d&#8217;un objet (<text:span text:style-name="CodeDansTexte">Object.keys()</text:span>)
soit <text:span text:style-name="T4">la liste de ses valeurs</text:span> (<text:span text:style-name="CodeDansTexte">Object.values()</text:span>).
Dans les deux cas, les rÃ©sultats sont retournÃ©s sous forme d&#8217;un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-array"  text:visited-style-name="Visited_20_Internet_20_Link">tableau</text:a>.
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">object/keys.js</text:p><text:p text:style-name="Code">const francine = {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>first_name: 'Francine',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>location: 'DrÃ´me',</text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(Object.keys(francine));<text:s text:c="5"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(Object.values(francine));<text:s text:c="3"/><text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">["first_name", "location"]</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">["Francine", "DrÃ´me"]</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-identifier_des_valeurs" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Identifier des valeurs</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il y a trois maniÃ¨res d&#8217;identifier si un objet contient une valeur
associÃ©e Ã  une&#160;clÃ©.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le plus simple est d&#8217;utiliser la mÃ©thode <text:span text:style-name="CodeDansTexte">hasOwnProperty()</text:span>.
Elle prend en argument le nom de la clÃ© Ã  tester et
retourne un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-boolean"  text:visited-style-name="Visited_20_Internet_20_Link">boolÃ©en</text:a>.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">object/has-own-property.js</text:p><text:p text:style-name="Code">const francine = {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>first_name: 'Francine',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>location: 'DrÃ´me',</text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(francine.hasOwnProperty('location'));<text:s text:c="3"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(francine.hasOwnProperty('twitter'));<text:s text:c="4"/><text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">true</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">false</text:span>&#160;â€“ cette clÃ© n&#8217;existe pas dans cet objet.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La seconde maniÃ¨re est d&#8217;utiliser l&#8217;opÃ©rateur&#160;<text:span text:style-name="CodeDansTexte">in</text:span>.
On l&#8217;aura dÃ©jÃ  rencontrÃ© lors des <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-array.forEach"  text:visited-style-name="Visited_20_Internet_20_Link">boucles</text:a>&#160;;
ici, on l&#8217;utilise une seule&#160;fois.
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">object/key-in.js</text:p><text:p text:style-name="Code">const francine = {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>first_name: 'Francine',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>location: 'DrÃ´me',</text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log('location' in francine);<text:s text:c="3"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log('twitter' in francine);<text:s text:c="4"/><text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">true</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">false</text:span>&#160;â€“ cette clÃ© n&#8217;existe pas dans cet objet.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Enfin, on peut tester la valeur associÃ©e avec la syntaxe standard <text:span text:style-name="CodeDansTexte">objet.clÃ©</text:span>.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">object/key.js</text:p><text:p text:style-name="Code">const francine = {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>first_name: 'Francine',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>location: 'DrÃ´me',</text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(Boolean(francine.location));<text:s text:c="3"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(Boolean(francine.twitter));<text:s text:c="4"/><text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">true</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">false</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Attention toutefois&#160;: cette mÃ©thode <text:span text:style-name="T4">teste uniquement la valeur</text:span>.
Si la clÃ© existe et contient <text:span text:style-name="CodeDansTexte">undefined</text:span>, vous ne verrez pas la diffÃ©rence.
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">object/key-undefined.js</text:p><text:p text:style-name="Code">const francine = {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>first_name: 'Francine',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>location: 'DrÃ´me',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>twitter: undefined</text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(Boolean(francine.twitter));<text:s text:c="10"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(francine.twitter !== undefined);<text:s text:c="5"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(francine.hasOwnProperty('twitter')); <text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">console.log('twitter' in francine);<text:s text:c="14"/><text:span text:style-name="PuceCode">4</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">false</text:span>&#160;â€“ la valeur <text:span text:style-name="CodeDansTexte">undefined</text:span> est convertie en <text:span text:style-name="CodeDansTexte">false</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">false</text:span>&#160;â€“ la clÃ© existe bien, mais elle contient la valeur <text:span text:style-name="CodeDansTexte">undefined</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche <text:span text:style-name="CodeDansTexte">true</text:span>&#160;â€“ le test se fait sur l&#8217;existence de la&#160;clÃ©.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Affiche <text:span text:style-name="CodeDansTexte">true</text:span>&#160;â€“ idem.<text:line-break/></text:p>
<text:bookmark text:name="ref-json" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Lire et Ã©crire des donnÃ©es au format JSON</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">JSON (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://json.org" text:visited-style-name="Visited_20_Internet_20_Link">http://json.org</text:a></text:span>) est un format de donnÃ©es textuel standardisÃ©.
Son but est de reprÃ©senter des donnÃ©es informatiques de maniÃ¨re
interopÃ©rable entre diffÃ©rents langages.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">json/base.json</text:p><text:p text:style-name="Code">{</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"title": "Node.js",</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"price_tag": 32,</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"keywords": [</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"JavaScript",</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"Node.js",</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"Apprendre par l'exemple"</text:p><text:p text:style-name="Code"><text:s text:c="2"/>]</text:p><text:p text:style-name="Code">}</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le format JSON ressemble beaucoup Ã  une structure d'<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-object"  text:visited-style-name="Visited_20_Internet_20_Link">objet</text:a> ECMAScript.
La reprÃ©sentation est plus stricte car <text:span text:style-name="T4">toute donnÃ©e</text:span> doit Ãªtre reprÃ©sentÃ©e
de maniÃ¨re textuelle.
Ainsi, toutes les clÃ©s sont entourÃ©es de <text:span text:style-name="T4">guillemets doubles</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les types de donnÃ©es autorisÃ©s sont les nombres, les chaÃ®nes de caractÃ¨res,
les boolÃ©ens, les tableaux, les objets et la valeur <text:span text:style-name="CodeDansTexte">null</text:span>.
On ne peut donc pas reprÃ©senter de <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-function"  text:visited-style-name="Visited_20_Internet_20_Link">fonction</text:a>,
d'<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-class"  text:visited-style-name="Visited_20_Internet_20_Link">instance d&#8217;objet</text:a> ni mÃªme la valeur <text:span text:style-name="CodeDansTexte">undefined</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">ECMAScript embarque le nÃ©cessaire pour <text:span text:style-name="T4">parser</text:span> depuis et <text:span text:style-name="T4">convertir</text:span> en JSON.
Cela se fait respectivement avec les fonctions <text:span text:style-name="CodeDansTexte">JSON.parse()</text:span> et <text:span text:style-name="CodeDansTexte">JSON.stringify()</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La fonction <text:span text:style-name="CodeDansTexte">JSON.parse()</text:span> consomme du texte.
Elle retourne une reprÃ©sentation ECMAScript ou lance une <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-error"  text:visited-style-name="Visited_20_Internet_20_Link">erreur</text:a>
en cas de problÃ¨me.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">json/parse.js</text:p><text:p text:style-name="Code">const json_object = '{ "title": "Node.js", "price_tag": 32 }';</text:p><text:p text:style-name="Code">const json_string = '"Hello World!"';</text:p><text:p text:style-name="Code">const json_number = '32';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(JSON.parse(json_string)); <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(JSON.parse(json_number)); <text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">console.log(JSON.parse(json_object)); <text:span text:style-name="PuceCode">3</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">"Hello World!"</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">32</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche <text:span text:style-name="CodeDansTexte">{price_tag: 32, title: "Node.js"}</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ã€ l&#8217;inverse, la fonction <text:span text:style-name="CodeDansTexte">JSON.stringify()</text:span> convertit une structure ECMAScript
en chaÃ®ne de caractÃ¨res au format&#160;JSON&#160;:
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">json/stringify.js</text:p><text:p text:style-name="Code">const location = {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>lat: 48.8503439,</text:p><text:p text:style-name="Code"><text:s text:c="2"/>lon: 2.34658949</text:p><text:p text:style-name="Code">}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(JSON.stringify(location));<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">"{\"lat\":48.8503439,\"lon\":2.34658949}"</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La fonction <text:span text:style-name="CodeDansTexte">JSON.stringify()</text:span> parcourt tous les Ã©lÃ©ments
pour les sÃ©rialiser en forme textuelle.
Quand elle rencontre la la clÃ© spÃ©ciale <text:span text:style-name="CodeDansTexte">toJSON()</text:span>,
elle l&#8217;utilise pour effectuer la conversion&#160;:
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">json/to-json.js</text:p><text:p text:style-name="Code">const location = {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>lat: 48.8503439,</text:p><text:p text:style-name="Code"><text:s text:c="2"/>lon: 2.34658949,</text:p><text:p text:style-name="Code"><text:s text:c="2"/>toJSON() {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>return `geo=${this.lat},${this.lon}`;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(JSON.stringify(location));<text:s text:c="4"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">delete location.toJSON;</text:p><text:p text:style-name="Code">console.log(JSON.stringify(location));<text:s text:c="4"/><text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">"\"geo=48.8503439,2.34658949\""</text:span>&#160;â€“ c&#8217;est la sÃ©rialisation dÃ©finie par notre fonction <text:span text:style-name="CodeDansTexte">toJSON</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">"{\"lat\":48.8503439,\"lon\":2.34658949}"</text:span>&#160;â€“ sans la clÃ© <text:span text:style-name="CodeDansTexte">toJSON</text:span>, notre objet initial est sÃ©rialisÃ© tel&#160;quel.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Notre implÃ©mentation contenue dans la fonction <text:span text:style-name="CodeDansTexte">toJSON()</text:span> est
responsable de renvoyer du texte seulement et de choisir les clÃ©s
Ã  sÃ©rialiser.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">json/to-json-extra.js</text:p><text:p text:style-name="Code">const location = {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>lat: 48.8503439,</text:p><text:p text:style-name="Code"><text:s text:c="2"/>lon: 2.34658949,</text:p><text:p text:style-name="Code"><text:s text:c="2"/>city: 'Paris',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>toJSON() {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>return `geo=${this.lat},${this.lon}`;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(JSON.stringify(location));<text:s text:c="4"/><text:span text:style-name="PuceCode">1</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">"\"geo=48.8503439,2.34658949\""</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans cette variante d&#8217;exemple, la clÃ© <text:span text:style-name="CodeDansTexte">city</text:span> n&#8217;a pas Ã©tÃ© sÃ©rialisÃ©e
car notre fonction <text:span text:style-name="CodeDansTexte">toJSON()</text:span> se prÃ©occupait seulement des clÃ©s <text:span text:style-name="CodeDansTexte">lat</text:span> et&#160;`lon`.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> JSON</text:h>
Rendez-vous sur <text:span text:style-name="T4">MDN web docs</text:span> pour en savoir plus sur JSON.<text:line-break/>
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://developer.mozilla.org/docs/fr/Web/JavaScript/Reference/Global_Objects/JSON" text:visited-style-name="Visited_20_Internet_20_Link">https://developer.mozilla.org/docs/fr/Web/JavaScript/Reference/Global_Objects/JSON</text:a>

<text:bookmark text:name="ref-date" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Interagir avec des dates</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les calculs de date s&#8217;effectuent Ã  l&#8217;aide des objets <text:span text:style-name="CodeDansTexte">Date</text:span>.
Chaque instance reprÃ©sente un moment dans le temps, Ã  un jour
et Ã  une heure donnÃ©e.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">date/base.js</text:p><text:p text:style-name="Code">const now = new Date();</text:p><text:p text:style-name="Code">const past = new Date('2013-12-04 10:00:00'); <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(past.getUTCFullYear());<text:s text:c="11"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">console.log(now.getUTCFullYear());<text:s text:c="12"/><text:span text:style-name="PuceCode">3</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> On initialise l&#8217;objet date <text:span text:style-name="CodeDansTexte">past</text:span> au 04&#160;dÃ©cembre&#160;2013.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">2013</text:span>&#160;â€“ l&#8217;annÃ©e liÃ©e Ã  l&#8217;objet&#160;<text:span text:style-name="CodeDansTexte">past</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche <text:span text:style-name="CodeDansTexte">2019</text:span>&#160;â€“ l&#8217;annÃ©e liÃ©e Ã  l&#8217;objet&#160;<text:span text:style-name="CodeDansTexte">now</text:span> (date du jour).
undefined<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un certain nombre de mÃ©thodes retournent diffÃ©rents Ã©lÃ©ments de la date
contenue dans l&#8217;objet&#160;: annÃ©e, secondes, jour de la semaine, etc.
Il en existe tout autant pour modifier ces Ã©lÃ©ments de date.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">date/set.js</text:p><text:p text:style-name="Code">const past = new Date('2013-12-04 10:00:00');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">past.setUTCFullYear('2015');<text:s text:c="11"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(past.toISOString());<text:s text:c="7"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">past.setUTCMonth(1);<text:s text:c="19"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">console.log(past.toISOString());<text:s text:c="7"/><text:span text:style-name="PuceCode">4</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Change la date vers l&#8217;annÃ©e&#160;<text:span text:style-name="CodeDansTexte">2015</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">"2015-12-04T10:00:00.000Z"</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Change la date vers le mois&#160;<text:span text:style-name="CodeDansTexte">1</text:span>.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Affiche <text:span text:style-name="CodeDansTexte">"2015-02-04T10:00:00.000Z"</text:span>&#160;â€“ pourquoi le mois de fÃ©vrier&#160;??
undefined
undefined
undefined<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exemple prÃ©cÃ©dent illustre l&#8217;ambiguÃ¯tÃ© de la notion de mois.
Il s&#8217;agit en rÃ©alitÃ© de l'<text:span text:style-name="T4">index du mois</text:span>&#160;:
0&#160;correspond Ã  janvier, 1 Ã  fÃ©vrier, etc.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les mÃ©thodes natives font pour la plupart rÃ©fÃ©rence Ã  l&#8217;anglais.
Elles offrent peu de confort de manipulation&#160;â€“ on aimerait pouvoir
compter facilement le nombre de jours entre deux dates, ou retirer 30&#160;jours.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Quand nous utiliserons <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-../chapter-04/index.adoc"  text:visited-style-name="Visited_20_Internet_20_Link">Node</text:a> et
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-../chapter-05/index.adoc"  text:visited-style-name="Visited_20_Internet_20_Link">npm</text:a>, nous verrons que nous aurons
Ã  disposition des bibliothÃ¨ques facilitant les manipulations de dates.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> Date</text:h>
Rendez-vous sur <text:span text:style-name="T4">MDN web docs</text:span> pour en savoir plus sur Date.<text:line-break/>
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://developer.mozilla.org/docs/fr/Web/JavaScript/Reference/Global_Objects/Date" text:visited-style-name="Visited_20_Internet_20_Link">https://developer.mozilla.org/docs/fr/Web/JavaScript/Reference/Global_Objects/Date</text:a>

<text:bookmark text:name="ref-intl.datetimeformat" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Formatage internationalisÃ© (Intl.DateTimeFormat)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La spÃ©cification <text:span text:style-name="T4">ECMA&#160;Intl</text:span> a Ã©tÃ© conÃ§ue pour ajouter des
fonctionnalitÃ©s relatives aux langues.
Cette spÃ©cification est complÃ©mentaire.
Son comportement varie en fonction du systÃ¨me d&#8217;exploitation
â€“ mode d&#8217;installation de Node et/ou version du navigateur&#160;web.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les mÃ©thodes <text:span text:style-name="CodeDansTexte">toLocaleString()</text:span>, <text:span text:style-name="CodeDansTexte">toLocaleDateString()</text:span> et
<text:span text:style-name="CodeDansTexte">toLocaleTimeString()</text:span> renvoient respectivement une version localisÃ©e
d&#8217;une date complÃ¨te, d&#8217;une date et d&#8217;une heure.
undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">date/to-locale-date.js</text:p><text:p text:style-name="Code">const past = new Date('2013-12-04 10:00:00');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(past.toLocaleDateString());<text:s text:c="17"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const options = { month: 'long' };</text:p><text:p text:style-name="Code">console.log(past.toLocaleDateString('fr-FR', options)); <text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">04/12/2013</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">dÃ©cembre</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Attention</text:span> M01,&#160;M02,&#160;etc. ?</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Si, en formatant une date, les caractÃ¨res <text:span text:style-name="CodeDansTexte">M01</text:span>, <text:span text:style-name="CodeDansTexte">M02</text:span> ou autre s&#8217;affichent,
c&#8217;est que le systÃ¨me n&#8217;est pas configurÃ© avec les libellÃ©s de la langue
demandÃ©e.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">La langue par dÃ©faut est l&#8217;anglais.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> Date/toLocaleDateString</text:h>
Rendez-vous sur <text:span text:style-name="T4">MDN web docs</text:span> pour en savoir plus sur Date/toLocaleDateString.<text:line-break/>
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://developer.mozilla.org/docs/fr/Web/JavaScript/Reference/Global_Objects/Date/toLocaleDateString" text:visited-style-name="Visited_20_Internet_20_Link">https://developer.mozilla.org/docs/fr/Web/JavaScript/Reference/Global_Objects/Date/toLocaleDateString</text:a>

<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Une version plus verbeuse consiste Ã  crÃ©er un formateur avec
<text:span text:style-name="CodeDansTexte">Intl.DateTimeFormat</text:span>.
Ce formateur se rÃ©utilise pour transformer plusieurs fois
des dates diffÃ©rentes avec les mÃªmes rÃ©glages
ou une mÃªme date avec des formatages diffÃ©rents.
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">date/intl.js</text:p><text:p text:style-name="Code">const past = new Date('2013-12-04 10:00:00');</text:p><text:p text:style-name="Code">const options = {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>year: 'numeric', month: 'short', day: 'numeric'</text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code">const longOptions = {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>year: 'numeric', month: 'long', day: 'numeric',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>weekday: 'long'</text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const fr = new Intl.DateTimeFormat('fr-FR', options);</text:p><text:p text:style-name="Code">const frLong = new Intl.DateTimeFormat('fr-FR', longOptions);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(fr.format(past));<text:s text:c="9"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(frLong.format(past));<text:s text:c="5"/><text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">4 dÃ©c. 2013</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">mercredi 4 dÃ©cembre 2013</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> DateTimeFormat</text:h>
Rendez-vous sur <text:span text:style-name="T4">MDN web docs</text:span> pour en savoir plus sur DateTimeFormat.<text:line-break/>
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://developer.mozilla.org/docs/fr/Web/JavaScript/Reference/Global_Objects/DateTimeFormat" text:visited-style-name="Visited_20_Internet_20_Link">https://developer.mozilla.org/docs/fr/Web/JavaScript/Reference/Global_Objects/DateTimeFormat</text:a>

<text:bookmark text:name="ref-class" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Partager une logique avec des objets de mÃªme nature (Class)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Une classe est une structure qui partage des propriÃ©tÃ©s
et des mÃ©thodes entre les objets qui y font appel.
Une instance de classe est crÃ©Ã©e en prÃ©fixant un appel de fonction
par l&#8217;opÃ©rateur&#160;`new`.</text:p>
<text:p text:style-name="Code">const date1 = new Date();</text:p><text:p text:style-name="Code">const date2 = new Date('2013-12-04');</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nos deux variables sont des objets issus de la classe <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-date"  text:visited-style-name="Visited_20_Internet_20_Link">Date</text:a>.
Chacune des variables bÃ©nÃ©ficie des mÃ©thodes dÃ©finies par cette classe.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Autrement dit, si les <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-object"  text:visited-style-name="Visited_20_Internet_20_Link">structures d&#8217;objet</text:a> dÃ©finissent des donnÃ©es,
les classes dÃ©finissent des comportements partagÃ©s.
undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">class/base.js</text:p><text:p text:style-name="Code">class Book {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>constructor({ title, ean13 }) {<text:s text:c="5"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>this.title = title;<text:s text:c="15"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>this.ean13 = ean13;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>toJSON() {<text:s text:c="26"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>const {title, ean13} = this;</text:p><text:p text:style-name="Code"><text:s text:c="4"/>return {title, ean13};</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>get isbn() {<text:s text:c="24"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>return this.ean13.split(3)[1];</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>static clean(value) {<text:s text:c="15"/><text:span text:style-name="PuceCode">5</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>return value.replace(/\D/g, '');</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">}</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Le constructeur reÃ§oit un ou plusieurs argument(s) lors de l&#8217;instanciation de la classe.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> <text:span text:style-name="CodeDansTexte">this</text:span> fait rÃ©fÃ©rence Ã  <text:span text:style-name="T4">ce contexte</text:span>, c&#8217;est-Ã -dire Ã  <text:span text:style-name="T4">cette instance de classe</text:span>&#160;; deux instances peuvent Ãªtre initialisÃ©es avec des donnÃ©es diffÃ©rentes.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> <text:span text:style-name="CodeDansTexte">toJSON()</text:span> est une mÃ©thode de la classe.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> <text:span text:style-name="CodeDansTexte">isbn()</text:span> est un accesseur (prÃ©fixe <text:span text:style-name="CodeDansTexte">get</text:span>)&#160;â€“ une propriÃ©tÃ© dont la valeur est calculÃ©e Ã  chaque fois qu&#8217;elle est appelÃ©e.<text:line-break/><text:span text:style-name="PuceCode">5</text:span> <text:span text:style-name="CodeDansTexte">clean()</text:span> est une mÃ©thode dite <text:span text:style-name="T4">statique</text:span>&#160;â€“ elle est appelÃ©e en dehors d&#8217;une instance.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous dÃ©velopperons cet exemple dans les sections qui suivent.
On peut d&#8217;ores et dÃ©jÃ  noter que la structure d&#8217;une classe
se dÃ©compose en plusieurs parties&#160;:
undefined
undefined
undefined
undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">La dÃ©finition</text:h>
<text:p text:style-name="Remarque">DÃ©finit le nom de la classe que l&#8217;on pourra instancier.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Le constructeur</text:h>
<text:p text:style-name="Remarque">Partie exÃ©cutÃ©e lorsque la classe est instanciÃ©e.
On y met le moins de choses possibles.
En gÃ©nÃ©ral, on copie les donnÃ©es passÃ©es en argument.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Les mÃ©thodes</text:h>
<text:p text:style-name="Remarque">Fonctions partagÃ©es entre toutes les instances de la classe.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Les mÃ©thodes statiques</text:h>
<text:p text:style-name="Remarque">Fonctions partagÃ©es sans avoir Ã  instancier la classe.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Les accesseurs et mutateurs</text:h>
<text:p text:style-name="Remarque">Fonctions qui dÃ©finissent le comportement de propriÃ©tÃ©s dynamiques.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Le contexte (<text:span text:style-name="CodeDansTexte">this</text:span>)</text:h>
<text:p text:style-name="Remarque">On peut s&#8217;y rÃ©fÃ©rer dans les mÃ©thodes de la classe pour dire
<text:span text:style-name="T4">je fais rÃ©fÃ©rence Ã  cet objet</text:span> et, donc,
appeler les donnÃ©es et mÃ©thodes attenantes.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> Classes</text:h>
Rendez-vous sur <text:span text:style-name="T4">MDN web docs</text:span> pour en savoir plus sur les classes.<text:line-break/>
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://developer.mozilla.org/docs/fr/Web/JavaScript/Reference/Classes" text:visited-style-name="Visited_20_Internet_20_Link">https://developer.mozilla.org/docs/fr/Web/JavaScript/Reference/Classes</text:a>

<text:bookmark text:name="ref-class.method" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">MÃ©thodes d&#8217;instance</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les mÃ©thodes dÃ©finissent des comportements partagÃ©s entre chaque instance
de la classe.
Elles servent Ã  retourner ou transformer des valeurs rattachÃ©es Ã  l&#8217;objet.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">class/methods.js</text:p><text:p text:style-name="Code">class Book {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>constructor({ title }) {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>this.title = title;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>isPublished() {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>return this.is_published === true;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>publish() {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>this.is_published = true;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const book1 = new Book({ title: 'Node.js' });</text:p><text:p text:style-name="Code">console.log(book1.isPublished());<text:s text:c="3"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">book1.publish();</text:p><text:p text:style-name="Code">console.log(book1.isPublished());<text:s text:c="3"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const book2 = new Book({ title: 'CSS maintenables' });</text:p><text:p text:style-name="Code">console.log(book2.isPublished());<text:s text:c="3"/><text:span text:style-name="PuceCode">3</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">false</text:span>&#160;â€“ la propriÃ©tÃ© n&#8217;existe pas.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">true</text:span>&#160;â€“ la propriÃ©tÃ© <text:span text:style-name="CodeDansTexte">is_published</text:span> a Ã©tÃ© changÃ©e Ã  la ligne prÃ©cÃ©dente.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche <text:span text:style-name="CodeDansTexte">false</text:span>&#160;â€“ les donnÃ©es sont Ã©tanches entre chaque instance.<text:line-break/></text:p>
<text:bookmark text:name="ref-class.static" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">MÃ©thodes statiques</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les mÃ©thodes statiques sont pratiques pour mettre Ã  disposition du code
mÃ©tier de maniÃ¨re organisÃ©e.
Elles se caractÃ©risent par le mot-clÃ© <text:span text:style-name="CodeDansTexte">static</text:span> devant un nom de fonction.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">class/static.js</text:p><text:p text:style-name="Code">class Book {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>constructor({ title, ean13 }) {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>this.title = title;</text:p><text:p text:style-name="Code"><text:s text:c="4"/>this.ean13 = ean13;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>static clean(value) {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>return value.replace(/\D/g, '');</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const nodebook = new Book({</text:p><text:p text:style-name="Code"><text:s text:c="2"/>title: 'Node.js',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>ean13: Book.clean('978-2212139938'),<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(nodebook.ean13);<text:s text:c="12"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">console.log(nodebook.clean);<text:s text:c="12"/><text:span text:style-name="PuceCode">3</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> On appelle la mÃ©thode statique <text:span text:style-name="CodeDansTexte">Book.clean()</text:span> pour nettoyer le code EAN13.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">"9782212139938"</text:span>&#160;â€“ la valeur a bien Ã©tÃ© nettoyÃ©e.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche <text:span text:style-name="CodeDansTexte">undefined</text:span>&#160;â€“ les mÃ©thodes statiques ne sont pas accessibles depuis l&#8217;instance de classe.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">On verra dans le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-../chapter-04/index.adoc"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre sur Node</text:a>
qu&#8217;on peut se baser sur les modules pour partager du code
sans avoir Ã  l&#8217;affecter Ã  une classe.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> MÃ©thodes statiques</text:h>
Rendez-vous sur <text:span text:style-name="T4">MDN web docs</text:span> pour en savoir plus sur les mÃ©thodes statiques.<text:line-break/>
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://developer.mozilla.org/docs/fr/Web/JavaScript/Reference/Classes/static" text:visited-style-name="Visited_20_Internet_20_Link">https://developer.mozilla.org/docs/fr/Web/JavaScript/Reference/Classes/static</text:a>

<text:bookmark text:name="ref-object-getset" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Accesseurs et mutateurs</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce type de mÃ©thode dÃ©finit des attributs dont la lecture ou l&#8217;Ã©criture
sont dynamiques.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;accesseur est une fonction prÃ©fixÃ©e par le mot-clÃ© <text:span text:style-name="CodeDansTexte">get</text:span>&#160;; elle retourne
la valeur d&#8217;un attribut.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">getters.js</text:p><text:p text:style-name="Code">const book = {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>title: 'Node.js',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>ean13: '9782212139938',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>get isbn() {<text:s text:c="12"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>return this.ean13.slice(3);</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(book.ean13);<text:s text:c="2"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">console.log(book.isbn);<text:s text:c="3"/><text:span text:style-name="PuceCode">3</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> DÃ©finition de l&#8217;accesseur&#160;<text:span text:style-name="CodeDansTexte">isbn()</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">"9782212139938"</text:span>&#160;â€“ c&#8217;est une propriÃ©tÃ© de l&#8217;objet <text:span text:style-name="CodeDansTexte">nodebook</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche <text:span text:style-name="CodeDansTexte">"2212139938"</text:span>&#160;â€“ <text:span text:style-name="CodeDansTexte">isbn()</text:span> s&#8217;utilise comme un attribut mais sa valeur est calculÃ©e Ã  chaque fois qu&#8217;elle est appelÃ©e.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le mutateur est une fonction prÃ©fixÃ©e par le mot-clÃ© <text:span text:style-name="CodeDansTexte">set</text:span>&#160;; elle dÃ©finit
la valeur d&#8217;un ou plusieurs attribut(s).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">setters.js</text:p><text:p text:style-name="Code">const book = {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>title: 'Node.js',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>set ean13 (value) {<text:s text:c="5"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>this.issn = value.slice(0, 3);</text:p><text:p text:style-name="Code"><text:s text:c="4"/>this.isbn = value.slice(3);</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">book.ean13 = '9782212139938';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(book.issn);<text:s text:c="3"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">console.log(book.isbn);<text:s text:c="3"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">console.log(book.ean13);<text:s text:c="2"/><text:span text:style-name="PuceCode">4</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> DÃ©finition du mutateur <text:span text:style-name="CodeDansTexte">ean13()</text:span>&#160;â€“ il accepte un seul argument.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">978</text:span>&#160;â€“ l&#8217;attribut a Ã©tÃ© crÃ©Ã© lors de l&#8217;appel du mutateur.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche <text:span text:style-name="CodeDansTexte">2212139938</text:span>&#160;â€“ idem.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Affiche <text:span text:style-name="CodeDansTexte">undefined</text:span>&#160;â€“ il faudrait crÃ©er un accesseur <text:span text:style-name="CodeDansTexte">get ean13()</text:span> pour recomposer dynamiquement sa valeur.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> Accesseurs</text:h>
Rendez-vous sur <text:span text:style-name="T4">MDN web docs</text:span> pour en savoir plus sur les accesseurs.<text:line-break/>
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://developer.mozilla.org/docs/fr/Web/JavaScript/Reference/Functions/get" text:visited-style-name="Visited_20_Internet_20_Link">https://developer.mozilla.org/docs/fr/Web/JavaScript/Reference/Functions/get</text:a>

<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> Mutateurs</text:h>
Rendez-vous sur <text:span text:style-name="T4">MDN web docs</text:span> pour en savoir plus sur les mutateurs.<text:line-break/>
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://developer.mozilla.org/docs/fr/Web/JavaScript/Reference/Functions/set" text:visited-style-name="Visited_20_Internet_20_Link">https://developer.mozilla.org/docs/fr/Web/JavaScript/Reference/Functions/set</text:a>

<text:bookmark text:name="ref-class.extends" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">HÃ©ritage</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;hÃ©ritage est un mÃ©canisme d&#8217;extension de classe.
C&#8217;est une pratique peu employÃ©e en JavaScript,
principalement en raison de sa nature modulaire et fonctionnelle.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;hÃ©ritage se caractÃ©rise par l&#8217;usage du mot-clÃ© <text:span text:style-name="CodeDansTexte">extends</text:span> lors de la
dÃ©finition de la classe et aussi par l&#8217;utilisation de l&#8217;opÃ©rateur <text:span text:style-name="CodeDansTexte">super()</text:span>
dans le constructeur.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">class/extends.js</text:p><text:p text:style-name="Code">class Product {<text:s text:c="15"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>constructor() {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>this.title = 'Sans titre';</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">class Book extends Product {<text:s text:c="2"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>constructor(options) {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>super(options);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="4"/>if (options.title) {</text:p><text:p text:style-name="Code"><text:s text:c="6"/>this.title = options.title;</text:p><text:p text:style-name="Code"><text:s text:c="4"/>}</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const book = new Book({ title: 'Node.js' });</text:p><text:p text:style-name="Code">console.log(book.title);<text:s text:c="4"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const product = new Product({ title: 'Node.js' });</text:p><text:p text:style-name="Code">console.log(product.title); <text:span text:style-name="PuceCode">4</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> La classe <text:span text:style-name="CodeDansTexte">Product</text:span> affecte un titre par dÃ©faut lorsqu&#8217;un nouvel objet est initialisÃ©.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> La classe <text:span text:style-name="CodeDansTexte">Book</text:span> affecte un titre donnÃ© en argument et, sinon, se base sur la valeur par dÃ©faut de la classe <text:span text:style-name="CodeDansTexte">Product</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche <text:span text:style-name="CodeDansTexte">'Node.js'</text:span>.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Affiche <text:span text:style-name="CodeDansTexte">'Sans titre'</text:span>&#160;â€“ la propriÃ©tÃ© <text:span text:style-name="CodeDansTexte">title</text:span> ne se dÃ©finit pas dans le constructeur (cf.&#160;<text:span text:style-name="CodeDansTexte">class Product</text:span>).<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">En pratique, c&#8217;est comme si on empilait les classes les unes sur les autres.
On lÃ¨gue des mÃ©thodes aux classes qui hÃ©ritent.
Si une mÃ©thode porte le mÃªme nom, la mÃ©thode <text:span text:style-name="">en haut de la pile</text:span> a la prioritÃ©.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;appel Ã  la fonction <text:span text:style-name="CodeDansTexte">super()</text:span> <text:span text:style-name="T4">appelle le constructeur de la classe Ã©tendue</text:span>.
Si on ne l&#8217;appelle pas, le constructeur de la classe parente ne sera pas invoquÃ©.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">On reparlera de l&#8217;hÃ©ritage dans le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-../chapter-09/index.adoc"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre 9</text:a>
avec un exemple populaire d&#8217;hÃ©ritage appliquÃ© aux composants visuels avec
la bibliothÃ¨que React.</text:p>
<text:bookmark text:name="ref-promise" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Coordonner des actions asynchrones (Promise)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Une promesse est <text:span text:style-name="T7">un objet retournÃ© immÃ©diatement</text:span> mais dont le
<text:span text:style-name="T7">rÃ©sultat est obtenu plus tard</text:span>, de maniÃ¨re asynchrone.
Cette rÃ©solution est soit <text:span text:style-name="T4">positive</text:span> soit <text:span text:style-name="T4">nÃ©gative</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">promise/base.js</text:p><text:p text:style-name="Code">const p = new Promise((resolve) =&gt; resolve('promesse tenue'));</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(p);<text:s text:c="27"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log('un');<text:s text:c="24"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">p.then(message =&gt; console.log(message));<text:s text:c="2"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code">console.log('deux');<text:s text:c="22"/><text:span text:style-name="PuceCode">3</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">Promise</text:span>&#160;â€“ ce n&#8217;est pas le rÃ©sultat que l&#8217;on voit, mais l&#8217;objet avec lequel interagir pour Ãªtre prÃ©venu de la mise Ã  disposition du rÃ©sultat.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">"un"</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche <text:span text:style-name="CodeDansTexte">"deux"</text:span>&#160;â€“ c&#8217;est parce que la ligne d&#8217;avant a mis en attente la <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-anonymous-function"  text:visited-style-name="Visited_20_Internet_20_Link">fonction anonyme</text:a>.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Affiche <text:span text:style-name="CodeDansTexte">"promesse tenue"</text:span> en dernier.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Design Pattern</text:span> Executor</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Le fait qu&#8217;une fonction nous passe d&#8217;autres fonctions pour commander
un rÃ©sultat s&#8217;appelle le <text:span text:style-name="T4">pattern Executor</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Une <text:span text:style-name="CodeDansTexte">Promise</text:span> s&#8217;orchestre en deux temps&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">L&#8217;initialisation<text:line-break/>
On dÃ©cide de la maniÃ¨re dont le traitement asynchrone sera effectuÃ©.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">La rÃ©solution<text:line-break/>
<text:span text:style-name="T4">Positive</text:span> en appelant <text:span text:style-name="CodeDansTexte">resolve()</text:span> ou <text:span text:style-name="T4">nÃ©gative</text:span>, en appelant <text:span text:style-name="CodeDansTexte">reject()</text:span>.
Le rÃ©sultat passÃ© Ã  <text:span text:style-name="CodeDansTexte">resolve()</text:span> sera transmis au premier argument de <text:span text:style-name="CodeDansTexte">then()</text:span>.
Le rÃ©sultat passÃ© Ã  <text:span text:style-name="CodeDansTexte">reject()</text:span> sera transmis au deuxiÃ¨me argument de <text:span text:style-name="CodeDansTexte">then()</text:span>,
mais aussi au premier argument de <text:span text:style-name="CodeDansTexte">catch()</text:span>.
undefined
undefined
undefined
undefined</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Une instance de <text:span text:style-name="CodeDansTexte">Promise</text:span> expose plusieurs mÃ©thodes pour propager
le statut de son exÃ©cution&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">then(onSuccess[, onError])</text:span></text:h>
<text:p text:style-name="Remarque">Fonction acceptant un <text:span text:style-name="T4">callback</text:span> de rÃ©solution et
un autre de rejet (facultatif).</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">catch(onError)</text:span></text:h>
<text:p text:style-name="Remarque">Fonction acceptant un <text:span text:style-name="T4">callback</text:span> de rejet.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">promise/then-catch.js</text:p><text:p text:style-name="Code">const oddTime = (date) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>return new Promise((resolve, reject) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>parseInt(date.getTime() / 1000) % 2<text:s text:c="17"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="6"/>? resolve('le nombre de secondes est impair :-)')</text:p><text:p text:style-name="Code"><text:s text:c="6"/>: reject('le nombre de secondes n\'est pas impair :-(');</text:p><text:p text:style-name="Code"><text:s text:c="2"/>});</text:p><text:p text:style-name="Code">}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const now = new Date();</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">oddTime(now)<text:s text:c="44"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>.then(msg =&gt; console.log(msg), msg =&gt; console.error(msg));</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">oddTime(new Date(now.getTime() + 1000))<text:s text:c="17"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>.then(msg =&gt; console.log(msg))<text:s text:c="24"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>.catch(msg =&gt; console.error(msg))<text:s text:c="21"/><text:span text:style-name="PuceCode">5</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> La fonction <text:span text:style-name="CodeDansTexte">oddTime()</text:span> accepte un argument de type &lt;&lt;date,Date&gt;. Elle rÃ©sout la promesse <text:span text:style-name="T4">positivement</text:span> (<text:span text:style-name="CodeDansTexte">resolve()</text:span>) si le nombre de secondes est impair et <text:span text:style-name="T4">nÃ©gativement</text:span> (<text:span text:style-name="CodeDansTexte">reject</text:span>) sinon.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Utilisation de la forme compacte de <text:span text:style-name="CodeDansTexte">then()</text:span> avec deux <text:span text:style-name="T4">callbacks</text:span>&#160;: un de succÃ¨s (associÃ© Ã  <text:span text:style-name="CodeDansTexte">resolve()</text:span>) et un d&#8217;Ã©chec (associÃ© Ã  <text:span text:style-name="CodeDansTexte">reject()</text:span>).<text:line-break/><text:span text:style-name="PuceCode">3</text:span> On crÃ©e une nouvelle promesse, avec une date calÃ©e une seconde plus tard.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Affiche <text:span text:style-name="CodeDansTexte">"le nombre de secondes est impair&#160;:-)"</text:span> puisque la rÃ©solution est positive.<text:line-break/><text:span text:style-name="PuceCode">5</text:span> Affiche <text:span text:style-name="CodeDansTexte">"le nombre de secondes n&#8217;est pas impair&#160;:-("</text:span> puisque la rÃ©solution est nÃ©gative.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Histoire</text:span> Standard <text:span text:style-name="CodeDansTexte">Promise/A+</text:span></text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
undefined
undefined
Historiquement, de nombreuses bibliothÃ¨ques ont proposÃ© leur propre implÃ©mentation de promesses.
Elles avaient le dÃ©faut de ne pas Ãªtre interopÃ©rables.
La spÃ©cification <text:span text:style-name="T4">Promise/A+</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://github.com/promises-aplus/promises-spec" text:visited-style-name="Visited_20_Internet_20_Link">https://github.com/promises-aplus/promises-spec</text:a></text:span>)
a Ã©mergÃ© pour Ã©tablir un standard de compatibilitÃ©.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">ECMAScript&#160;2015 introduit nativement cette API.
Il n&#8217;y a donc plus besoin de <text:span text:style-name="T4">polyfill</text:span> ou de bibliothÃ¨que pour en bÃ©nÃ©ficier.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">En gÃ©nÃ©ral, on utilise les promesses <text:span text:style-name="T7">pour aller plus vite</text:span>,
parce qu&#8217;on peut continuer Ã  traiter d&#8217;autres actions en attendant
l&#8217;arrivÃ©e du rÃ©sultat.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">C&#8217;est comme quand on se rend au restaurant&#160;:
les personnes en cuisine traitent des commandes
(actions longues) tandis que les personnes au service gÃ¨rent
des interactions plus courtes mais plus frÃ©quentes.
Au final, le ticket de commande contient la liste des promesses dont
on attend la rÃ©solution.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous verrons d&#8217;autres utilisations des promesses
dans le reste de l&#8217;ouvrage, plus particuliÃ¨rement
avec <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-io-fetch"  text:visited-style-name="Visited_20_Internet_20_Link">fetch()</text:a> au chapitre&#160;9
ainsi qu&#8217;avec <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-util.promisify"  text:visited-style-name="Visited_20_Internet_20_Link">promisify</text:a> au chapitre&#160;4.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> Promise</text:h>
Rendez-vous sur <text:span text:style-name="T4">MDN web docs</text:span> pour en savoir plus sur les promesses.<text:line-break/>
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://developer.mozilla.org/docs/fr/Web/JavaScript/Reference/Global_Objects/Promise" text:visited-style-name="Visited_20_Internet_20_Link">https://developer.mozilla.org/docs/fr/Web/JavaScript/Reference/Global_Objects/Promise</text:a>

<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Lien</text:span> Guide des promesses</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Le guide <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://www.w3.org/2001/tag/doc/promises-guide" text:visited-style-name="Visited_20_Internet_20_Link">https://www.w3.org/2001/tag/doc/promises-guide</text:a></text:span> est <text:span text:style-name="T4">trÃ¨s</text:span> complet.
Il est en anglais ainsi qu&#8217;en libre consultation sur le site du&#160;W3C.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Son dÃ©pÃ´t GitHub <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://github.com/w3ctag/promises-guide" text:visited-style-name="Visited_20_Internet_20_Link">https://github.com/w3ctag/promises-guide</text:a></text:span> permet
d&#8217;y contribuer.</text:p>
<text:bookmark text:name="ref-promise.all" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Collection de promesses</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="CodeDansTexte">Promise.all()</text:span> est une <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-class.static"  text:visited-style-name="Visited_20_Internet_20_Link">mÃ©thode statique</text:a> de la class <text:span text:style-name="T4">Promise</text:span>.
Elle accepte un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-array"  text:visited-style-name="Visited_20_Internet_20_Link">tableau</text:a> de promesses et en retourne elle-mÃªme une promesse.
Cette derniÃ¨re est rÃ©solue positivement si toutes les promesses rÃ©ussissent
et nÃ©gativement dÃ¨s que l'<text:span text:style-name="T4">une d&#8217;entre elles</text:span> Ã©choue.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">promise/all.js</text:p><text:p text:style-name="Code">const asyncRandom = () =&gt; new Promise((resolve) =&gt; {<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>const timing = Math.floor(Math.random() * 2000);</text:p><text:p text:style-name="Code"><text:s text:c="2"/>setTimeout(() =&gt; resolve(`rÃ©solu en ${timing}ms`), timing);</text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const all = Promise.all([<text:s text:c="29"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>asyncRandom(),</text:p><text:p text:style-name="Code"><text:s text:c="2"/>asyncRandom(),</text:p><text:p text:style-name="Code"><text:s text:c="2"/>asyncRandom()</text:p><text:p text:style-name="Code">]);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">all.then(messages =&gt; console.log(messages));<text:s text:c="10"/><text:span text:style-name="PuceCode">3</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Cette fonction rÃ©sout la promesse aprÃ¨s un dÃ©lai alÃ©atoire compris entre&#160;0 et 2000&#160;millisecondes.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> On passe trois promesses Ã  <text:span text:style-name="CodeDansTexte">Promise.all()</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> La rÃ©solution est dÃ©clenchÃ©e dÃ¨s que les trois promesses sont rÃ©solues&#160;â€“ l&#8217;argument contient un tableau listant les rÃ©sultats <text:span text:style-name="T4">dans l&#8217;ordre initial</text:span> des promesses.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exemple prÃ©cÃ©dent illustre la <text:span text:style-name="T7">parallÃ©lisation des actions</text:span>.
Si la promesse la plus longue est rÃ©solue en une seconde,
alors le temps d&#8217;attente pour la rÃ©solution de <text:span text:style-name="T4">toutes les promesses</text:span>
est de une seconde.<text:line-break/>Si on avait Ã©tÃ© dans un enchaÃ®nement sÃ©quentiel, le temps d&#8217;attente
final aurait Ã©tÃ© l&#8217;accumulation des temps d&#8217;attente de la rÃ©solution
de chacune des promesses.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les promesses sont un des meilleurs moyens Ã  notre disposition pour
<text:span text:style-name="T7">modulariser</text:span>, <text:span text:style-name="T7">linÃ©ariser</text:span> et <text:span text:style-name="T7">clarifier le sens</text:span> du flot de notre code.</text:p>
<text:bookmark text:name="ref-async-await" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">async/await</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les opÃ©rateurs <text:span text:style-name="CodeDansTexte">async</text:span> et <text:span text:style-name="CodeDansTexte">await</text:span> aident Ã  mettre en pause
l&#8217;interprÃ©teur ECMAScript, en attendant le rÃ©sultat d&#8217;une
fonction asynchrone (prÃ©fixÃ©e par <text:span text:style-name="CodeDansTexte">async</text:span>).
Les <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-promise"  text:visited-style-name="Visited_20_Internet_20_Link">promesses</text:a> sont implicitement compatibles.
On peut donc les mettre Ã  plat pour obtenir un rÃ©sultat
sans avoir Ã  utiliser <text:span text:style-name="CodeDansTexte">then()</text:span> ni&#160;`catch()`.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Transformons l&#8217;exemple de la <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-promise.all"  text:visited-style-name="Visited_20_Internet_20_Link">section prÃ©cÃ©dente</text:a>
pour comprendre l&#8217;impact de <text:span text:style-name="CodeDansTexte">async</text:span> et de&#160;`await`.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">promise/async-await.js</text:p><text:p text:style-name="Code">function asyncRandom() {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>return new Promise((resolve) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>const timing = Math.floor(Math.random() * 2000);</text:p><text:p text:style-name="Code"><text:s text:c="4"/>setTimeout(() =&gt; resolve(`rÃ©solu en ${timing}ms`), timing);</text:p><text:p text:style-name="Code"><text:s text:c="2"/>});</text:p><text:p text:style-name="Code">}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">(async () =&gt; {<text:s text:c="18"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>const all = [<text:s text:c="17"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>await asyncRandom(),</text:p><text:p text:style-name="Code"><text:s text:c="4"/>await asyncRandom(),</text:p><text:p text:style-name="Code"><text:s text:c="4"/>await asyncRandom()</text:p><text:p text:style-name="Code"><text:s text:c="2"/>];</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log(all);<text:s text:c="13"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">})();</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> On crÃ©e une <text:span text:style-name="T4">fonction asynchrone auto-invoquÃ©e</text:span>&#160;â€“ parce qu&#8217;on ne peut pas encore utiliser de fonction asynchrone directement au niveau principal d&#8217;un script.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Chaque utilisation de <text:span text:style-name="CodeDansTexte">await</text:span> met l&#8217;interprÃ©teur en pause.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> L&#8217;affichage du temps d&#8217;exÃ©cution de chaque promesse se fait lorsque les trois promesses sont rÃ©solues.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">On gagne en lisibilitÃ©, mais on perd en vitesse.
Les promesses sont exÃ©cutÃ©es sÃ©quentiellement et non en parallÃ¨le.
Il est important d&#8217;arbitrer les choix de conception et d&#8217;Ã©viter de bloquer
l&#8217;exÃ©cution de vos scripts sans raison explicite.</text:p>
<text:bookmark text:name="ref-conclusion_3" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Conclusion</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">ECMAScript est un langage bien plus riche, complet et Ã©lÃ©gant qu&#8217;il n&#8217;y paraÃ®t.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce chapitre nous a <text:span text:style-name="T7">appris les diffÃ©rentes structures de langage</text:span>
communes Ã  tous les environnements comprenant ECMAScript.
Cela s&#8217;applique aussi bien Ã  Node qu&#8217;aux navigateurs web.<text:line-break/>Je vous invite Ã  revenir Ã  ce chapitre pour vous rafraÃ®chir la mÃ©moire,
mais aussi pour jouer avec les exemples afin de confirmer votre comprÃ©hension
du langage.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-../chapter-04/index.adoc"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre suivant</text:a>, nous allons
<text:span text:style-name="T7">relier ces apprentissages avec Node</text:span>&#160;â€“ notre interprÃ©teur et environnement
d&#8217;exÃ©cution JavaScript.</text:p>
<text:bookmark text:name="ref-chapter-04" /><text:p text:style-name="ChapitreNumero">4</text:p><text:h text:style-name="ChapitreTitre" text:outline-level="1">Jouer avec Node.js</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous allons faire un tour d&#8217;horizon des capacitÃ©s de Node et de son systÃ¨me
de modules pour nous interfacer avec les systÃ¨mes d&#8217;exploitation Linux, macOS
et Windows.</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">Interagir avec l&#8217;interprÃ©teur&#160;Node</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Les modules de base</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">CrÃ©er ses propres modules</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">S&#8217;en sortir quand Ã§a ne se passe pas comme prÃ©vu</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Les diffÃ©rences de JavaScript entre Node et les navigateurs&#160;web</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Options utiles pour dÃ©marrer&#160;Node</text:p>
</text:list-item></text:list>
<text:p text:style-name="ChapitreIntroduction"><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">AprÃ¨s avoir exÃ©cutÃ© notre premier script Node, nous allons dÃ©couvrir
l&#8217;Ã©tendue des modules Node et ce qu&#8217;ils nous offrent en termes de capacitÃ©
d&#8217;interaction avec le systÃ¨me d&#8217;exploitation&#160;â€“ disque, rÃ©seau, calculs, etc.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous apprendrons ensuite Ã  crÃ©er et organiser nos propres modules&#160;â€“ nous
dÃ©couvrirons comment les partager et les distribuer dans le chapitre 5.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Enfin, nous passerons en revue des erreurs typiques pour apprendre Ã  les lire
et Ã  mieux rÃ©agir avant de terminer sur des maniÃ¨res alternatives d&#8217;exÃ©cuter
des scripts Node, par exemple pour dÃ©bogueur ou charger d&#8217;autres modules.</text:p></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Remarque</text:span> Versions de Node et npm</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Le contenu de ce chapitre utilise les versions <text:span text:style-name="T7">Node&#160;v10</text:span>
et <text:span text:style-name="T7">npm&#160;v6</text:span>.
Ce sont les versions stables recommandÃ©es en&#160;2019.</text:p>
<text:bookmark text:name="ref-interagir_avec_linterprÃ©teur_node" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Interagir avec l&#8217;interprÃ©teur Node</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;interprÃ©teur Node est le programme qui nous fournit des rÃ©sultats
en Ã©change d&#8217;instructions ECMAScript.
Le terminal est un autre programme permettant de faire dialoguer
un ordinateur avec les programmes installÃ©s.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-02"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre 2</text:a> dÃ©taille comment installer
Node et un terminal.
Il contient Ã©galement des conseils pour utiliser Node depuis un
navigateur web.
Cela peut rendre l&#8217;accÃ¨s au terminal plus facile.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce chapitre se base sur le principe que vous avez un terminal installÃ©,
sur lequel vous allez saisir des instructions ECMAScript.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-04/images/terminal.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>4-undefined.</text:span> Exemple de terminal sous macOS</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Pratique</text:span> Jouer avec les exemples dans un terminal</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Les exemples titrÃ©s d&#8217;un nom de fichier peuvent Ãªtre installÃ©s sur votre ordinateur.
ExÃ©cutez-les dans un terminal et amusez-vous Ã  les modifier en parallÃ¨le de
votre lecture pour voir ce qui change.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Installation des exemples via le module npm <text:span text:style-name="CodeDansTexte">nodebook</text:span></text:p><text:p text:style-name="RemarqueCode">$ npm install --global nodebook</text:p><text:p text:style-name="RemarqueCode">$ nodebook install chapter-04</text:p><text:p text:style-name="RemarqueCode">$ cd $(nodebook dir chapter-04)</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">La commande suivante devrait afficher un rÃ©sultat qui confirme que vous Ãªtes
au bon endroit&#160;:</text:p>
<text:p text:style-name="RemarqueCode">$ node hello.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Suivez Ã  nouveau les instructions d&#8217;installation pour rÃ©tablir les exemples
dans leur Ã©tat initial.</text:p>
<text:bookmark text:name="ref-node-version" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Afficher la version</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">CommenÃ§ons par afficher la version de l&#8217;interprÃ©teur Node.
Nous nous assurons ainsi que nous pouvons interagir avec
lui avec succÃ¨s et qu&#8217;il est celui que nous attendons, dans la bonne version.
La version de Node conditionne la liste des fonctionnalitÃ©s du langage
ECMAScript Ã  disposition.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">CompatibilitÃ©</text:span> Syntaxe ECMAScript</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Le site web <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://node.green" text:visited-style-name="Visited_20_Internet_20_Link">https://node.green</text:a></text:span> liste le niveau de compatibilitÃ©
des fonctionnalitÃ©s ECMAScript.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Cette page vous aidera Ã  comprendre quelles fonctionnalitÃ©s utiliser en toute
sÃ©curitÃ©, version par version de&#160;Node.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Une fois votre terminal ouvert, saisissez la commande suivante&#160;:</text:p>
<text:p text:style-name="Code">$ node --version</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le numÃ©ro de version de l&#8217;interprÃ©teur Node s&#8217;affiche alors,
par exemple <text:span text:style-name="CodeDansTexte">v10.9.0</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Si c&#8217;est ce Ã  quoi vous vous attendiez, passez Ã  la suite.
Ã€ l&#8217;inverse, si une erreur se produit ou si la version
n&#8217;est pas la bonne, retournez Ã  la section
<text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-install"  text:visited-style-name="Visited_20_Internet_20_Link">Installer Node.js</text:a></text:span> du chapitre&#160;2.</text:p>
<text:bookmark text:name="ref-script" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Avec un script</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exÃ©cution d&#8217;un script Node est trÃ¨s certainement la pratique la plus courante.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;interprÃ©teur Node lit le contenu d&#8217;un fichier et exÃ©cute les instructions.
L&#8217;interprÃ©teur reste actif jusqu&#8217;Ã  ce que toutes les instructions
soient traitÃ©es.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">script.js</text:p><text:p text:style-name="Code">console.log(2 + 2);</text:p><text:p text:style-name="Code">console.log('abc'.toLocaleUpperCase());</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le fichier exemple <text:span text:style-name="CodeDansTexte">script.js</text:span> contient deux instructions.
Node les interprÃ¨te lorsqu&#8217;on lui passe le chemin du fichier en paramÃ¨tre
dans une invite de commandes&#160;:</text:p>
<text:p text:style-name="Code">$ node script.js</text:p><text:p text:style-name="Code">4</text:p><text:p text:style-name="Code">ABC</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Node nous rend ensuite la main pour exÃ©cuter d&#8217;autres commandes.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">On apprendra Ã  passer des <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process.argv"  text:visited-style-name="Visited_20_Internet_20_Link">arguments d&#8217;exÃ©cution</text:a>
dans la section sur le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process"  text:visited-style-name="Visited_20_Internet_20_Link">module <text:span text:style-name="CodeDansTexte">process</text:span></text:a>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Performances</text:span> Ressources machine</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">DÃ©marrer un processus Node a un coÃ»t incompressible en ressources machine&#160;:
environ <text:span text:style-name="T7">30&#160;Mo de&#160;RAM</text:span> et <text:span text:style-name="T7">40&#160;ms de CPU</text:span> avant d&#8217;exÃ©cuter nos
instructions.</text:p>
<text:bookmark text:name="ref-repl" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Avec l&#8217;invite de commandes interactive (REPL)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;invite de commandes interactive est un moyen de parler
Ã  l&#8217;interprÃ©teur Node sans Ã©crire de fichier.
Je l&#8217;utilise pour tester des idÃ©es et des Ã©lÃ©ments de syntaxe
quand je ne m&#8217;en rappelle&#160;plus.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le mode interactif s&#8217;active en exÃ©cutant Node sans aucun argument&#160;:</text:p>
<text:p text:style-name="Code">$ node</text:p><text:p text:style-name="Code">&gt; </text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">On notera au passage que l&#8217;invite est prÃ©fixÃ©e par le caractÃ¨re&#160;`&gt;`
afin de marquer notre prÃ©sence dans un environnement diffÃ©rent.
On retrouve un comportement similaire dans les invites de commande
des langages Ruby&#160;(<text:span text:style-name="CodeDansTexte">irb</text:span>), Python&#160;(<text:span text:style-name="CodeDansTexte">python</text:span>) et PHP&#160;(<text:span text:style-name="CodeDansTexte">php -a</text:span>)</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Lorsque nous sommes dans l&#8217;interprÃ©teur interactif,
toutes les expressions sont interprÃ©tÃ©es par Node&#160;:</text:p>
<text:p text:style-name="Code">$ node</text:p><text:p text:style-name="Code">&gt; 2 + 2</text:p><text:p text:style-name="Code">4</text:p><text:p text:style-name="Code">&gt; "abc".toLocaleUpperCase()</text:p><text:p text:style-name="Code">'ABC'</text:p><text:p text:style-name="Code">&gt; </text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Des expressions sont rÃ©servÃ©es pour obtenir de l&#8217;aide, sortir de l&#8217;interprÃ©teur
ou simplement nettoyer ce que l&#8217;on voit Ã  l&#8217;Ã©cran.
Pour cela on fait appel Ã  l&#8217;instruction <text:span text:style-name="CodeDansTexte">.help</text:span>&#160;:</text:p>
<text:p text:style-name="Code">$ node</text:p><text:p text:style-name="Code">&gt; .help</text:p><text:p text:style-name="Code">.break<text:s text:c="4"/>Sometimes you get stuck, this gets you out</text:p><text:p text:style-name="Code">.clear<text:s text:c="4"/>Alias for .break</text:p><text:p text:style-name="Code">.editor<text:s text:c="3"/>Enter editor mode</text:p><text:p text:style-name="Code">.exit<text:s text:c="5"/>Exit the repl</text:p><text:p text:style-name="Code">.help<text:s text:c="5"/>Print this help message</text:p><text:p text:style-name="Code">.load<text:s text:c="5"/>Load JS from a file into the REPL session</text:p><text:p text:style-name="Code">.save<text:s text:c="5"/>Save all evaluated commands in this REPL session to a file</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les touches ou combinaisons de touches suivantes sont utiles pour naviguer dans
l&#8217;invite de commandes&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="Menu">[Ctrl+C]</text:span> annule
la saisie de la ligne en cours&#160;â€“ c&#8217;est <text:span text:style-name="Menu">[âŒƒ+C]</text:span> sous macOS.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="Menu">[&#11014;]</text:span> et <text:span text:style-name="Menu">[&#11015;]</text:span> aident Ã  naviguer dans l&#8217;historique des commandes.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="Menu">[TAB]</text:span> tente de complÃ©ter la saisie avec une expression ou variable connue.
undefined
undefined</text:p>
</text:list-item></text:list>
<text:p text:style-name="Code">$ node</text:p><text:p text:style-name="Code">&gt; conso<text:span text:style-name="Menu">[TAB]</text:span></text:p><text:p text:style-name="Code">&gt; console</text:p><text:p text:style-name="Code">&gt; console.<text:span text:style-name="Menu">[TAB]</text:span></text:p><text:p text:style-name="Code">...</text:p><text:p text:style-name="Code">console.assert<text:s text:c="16"/>console.clear<text:s text:c="17"/>console.count</text:p><text:p text:style-name="Code">...</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">On notera que l&#8217;utilisation de <text:span text:style-name="Menu">[TAB]</text:span> aprÃ¨s un caractÃ¨re <text:span text:style-name="T4">point</text:span>&#160;(<text:span text:style-name="CodeDansTexte">.</text:span>)
liste l&#8217;intÃ©gralitÃ© des propriÃ©tÃ©s de cet objet.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Raccourci</text:span> Afficher toutes les variables connues</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">La touche <text:span text:style-name="Menu">[TAB]</text:span> affiche toutes les variables connues
de la session interactive en cours.
Il suffit d&#8217;appuyer une ou deux fois dessus dans une invite vide&#160;:</text:p>
<text:p text:style-name="RemarqueCode">$ node</text:p><text:p text:style-name="RemarqueCode">&gt; <text:span text:style-name="Menu">[TAB]</text:span><text:span text:style-name="Menu">[TAB]</text:span></text:p><text:p text:style-name="RemarqueCode">Array<text:s text:c="25"/>Boolean<text:s text:c="23"/>Date</text:p><text:p text:style-name="RemarqueCode">Error<text:s text:c="25"/>EvalError<text:s text:c="21"/>Function</text:p><text:p text:style-name="RemarqueCode">Infinity<text:s text:c="22"/>JSON<text:s text:c="26"/>Math</text:p><text:p text:style-name="RemarqueCode">NaN<text:s text:c="27"/>Number<text:s text:c="24"/>Object</text:p><text:p text:style-name="RemarqueCode">...</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">C&#8217;est un excellent moyen de dÃ©couvrir des Ã©lÃ©ments du langage qui nous
Ã©taient inconnus jusque-lÃ .</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La sortie de l&#8217;invite de commandes se fait Ã  l&#8217;aide de
l&#8217;utilisation rÃ©pÃ©tÃ©e de la combinaison de touches <text:span text:style-name="Menu">[Ctrl+C]</text:span>
(ou <text:span text:style-name="Menu">[âŒƒ+C]</text:span> sous macOS).
On revient ainsi Ã  l&#8217;Ã©tat initial oÃ¹ l&#8217;on Ã©tait avant de
saisir la commande&#160;`node`&#160;:</text:p>
<text:p text:style-name="Code">$ node</text:p><text:p text:style-name="Code">&gt; </text:p><text:p text:style-name="Code">(To exit, press ^C again or type .exit)</text:p><text:p text:style-name="Code">&gt; </text:p><text:p text:style-name="Code">$ </text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce mÃªme rÃ©sultat s&#8217;obtient en saisissant <text:span text:style-name="CodeDansTexte">.exit</text:span>
ou en utilisant la combinaison de touches <text:span text:style-name="Menu">[Ctrl+D]</text:span> (ou <text:span text:style-name="Menu">[âŒƒ+D]</text:span> sous macOS).
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Raccourci</text:span> Variable magique&#160;<text:span text:style-name="CodeDansTexte">_</text:span></text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">La variable&#160;<text:span text:style-name="CodeDansTexte">_</text:span> est spÃ©cifique Ã  l&#8217;invite de commandes Node.
Elle contient systÃ©matiquement le rÃ©sultat retournÃ© par
la derniÃ¨re Ã©valuation de code&#160;:</text:p>
<text:p text:style-name="RemarqueCode">$ node</text:p><text:p text:style-name="RemarqueCode">&gt; 2 + 2</text:p><text:p text:style-name="RemarqueCode">4</text:p><text:p text:style-name="RemarqueCode">&gt; _ + 2</text:p><text:p text:style-name="RemarqueCode">6</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Elle est Ã©quivalente Ã  la variable&#160;<text:span text:style-name="CodeDansTexte">$_</text:span> dans la console
des outils de dÃ©veloppement des navigateurs web.</text:p>
<text:bookmark text:name="ref-modules-builtin" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Les modules de base</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les modules de base <text:span text:style-name="T7">Ã©tendent le champ d&#8217;action de Node</text:span>.
Ils servent d&#8217;interfaces pour communiquer avec le systÃ¨me d&#8217;exploitation,
le systÃ¨me de fichiers, des ressources HTTP et des connexions rÃ©seau, entre autres.
Ils sont inclus avec chaque installation de Node.
On peut donc en bÃ©nÃ©ficier sans effort supplÃ©mentaire.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un module de base se charge en passant son identifiant
Ã  la fonction <text:span text:style-name="CodeDansTexte">require()</text:span>, qui retourne alors un objet avec un certain nombre
de propriÃ©tÃ©s et de fonctions.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ainsi, on charge le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-fs"  text:visited-style-name="Visited_20_Internet_20_Link">module <text:span text:style-name="CodeDansTexte">fs</text:span></text:a> (pour <text:span text:style-name="T4">file system</text:span>&#160;â€“ <text:span text:style-name="T4">systÃ¨me de fichiers</text:span>)
afin d&#8217;interagir avec les fichiers et les rÃ©pertoires prÃ©sents sur l&#8217;ordinateur&#160;:
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">fs/read-dir.js</text:p><text:p text:style-name="Code">const fs = require('fs');<text:s text:c="13"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">fs.readdir('.', (error, files) =&gt; {<text:s text:c="3"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log(files);<text:s text:c="17"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> On charge les fonctions et attributs du module <text:span text:style-name="CodeDansTexte">fs</text:span> dans la variable du mÃªme nom (on pourrait l&#8217;appeler autrement).<text:line-break/><text:span text:style-name="PuceCode">2</text:span> L&#8217;appel Ã  la fonction <text:span text:style-name="CodeDansTexte">fs.readdir()</text:span> passe un objet d&#8217;erreur ainsi que la liste des fichiers et rÃ©pertoires contenus dans le chemin indiquÃ©.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche un tableau contenant les noms de fichiers et de rÃ©pertoires prÃ©sents dans le dossier courant.
undefined<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ces modules de base reprÃ©sentent la pierre angulaire de nos applications Node.
Ils fournissent le nÃ©cessaire pour tout faire&#160;!
On apprendra Ã  Ã©tendre encore plus le champ des possibles dans
le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-05"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;5</text:a>,
grÃ¢ce aux <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-modules"  text:visited-style-name="Visited_20_Internet_20_Link">modules&#160;<text:span text:style-name="CodeDansTexte">npm</text:span></text:a>.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les modules de base changent au fil du temps&#160;:
les nouvelles versions de Node ajoutent, corrigent et complÃ¨tent les modules et
fonctions existants.
La documentation officielle de Node reflÃ¨te ces changements et
affiche un indice de stabilitÃ© pour savoir Ã  quoi s&#8217;en&#160;tenir.
undefined</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-04/images/api-fs.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>4-undefined.</text:span> Documentation du module <text:span text:style-name="CodeDansTexte">fs</text:span> et son indice de stabilitÃ©</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Exceptionnellement, un module de base (ou une de ses fonctions) peut Ãªtre supprimÃ©.
L&#8217;Ã©quipe de Node annonce ces changements en dÃ©prÃ©ciant le module en question&#160;:
le code reste en place et sera supprimÃ© dans une version ultÃ©rieure.
En gÃ©nÃ©ral, c&#8217;est une question de mois voire d&#8217;annÃ©es.
On verra plus loin comment <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deprecation"  text:visited-style-name="Visited_20_Internet_20_Link">afficher les alertes de dÃ©prÃ©ciation</text:a>.
undefined</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-04/images/api-deprecation-fs-exists.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>4-undefined.</text:span> Documentation de la fonction <text:span text:style-name="CodeDansTexte">fs.exists()</text:span>, affichÃ©e comme dÃ©prÃ©ciÃ©e depuis Node&#160;v1</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> Lecture des indices de stabilitÃ©</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Node communique un indice de stabilitÃ© pour les modules de base.
Cette Ã©chelle se dÃ©compose en trois niveaux&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="T7">DÃ©prÃ©ciÃ©</text:span>&#160;: le module sera supprimÃ© dans une prochaine version majeure.
Ã€ l&#8217;avenir, il vaut mieux ne pas se compter dessus.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="T7">ExpÃ©rimental</text:span>&#160;: le module est en cours de dÃ©veloppement.
Une fonctionnalitÃ© expÃ©rimentale peut changer radicalement entre deux
versions de Node.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="T7">Stable</text:span>&#160;: on peut faire confiance Ã  ce module.
Des choses peuvent changer exceptionnellement mais l&#8217;intention est d&#8217;offrir
une stabilitÃ©.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">L&#8217;indice est parfois appliquÃ© Ã  des fonctions dont les attentes
changeraient d&#8217;une version Ã  l&#8217;autre de&#160;Node.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les sections suivantes illustrent des usages courants des modules de base
pour mieux comprendre ce qu&#8217;on peut en attendre et comment les utiliser.</text:p>
<text:bookmark text:name="ref-console" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">console : dÃ©boguer rapidement des variables</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;objet <text:span text:style-name="CodeDansTexte">console</text:span> est une boÃ®te Ã  outils pour afficher
ce qui se passe Ã  un moment donnÃ© dans un de nos scripts.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">console/log.js</text:p><text:p text:style-name="Code">let count = 0;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">count++; count++; count++;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log('Valeur de count :', count);</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La fonction Ã©crit les messages et la valeur des variables dans la
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process.std"  text:visited-style-name="Visited_20_Internet_20_Link">sortie standard</text:a> du terminal&#160;:
undefined
undefined</text:p>
<text:p text:style-name="Code">$ node console/log.js</text:p><text:p text:style-name="Code">Valeur de count : 3</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Raccourci</text:span> Variable globale console</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Node charge automatiquement le module pour nous et
le rend utilisable Ã  tout moment Ã  travers la variable globale <text:span text:style-name="CodeDansTexte">console</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Il est donc inutile de charger le module manuellement avec <text:span text:style-name="CodeDansTexte">require('console')</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="CodeDansTexte">console.log()</text:span> sait interpoler les valeurs passÃ©es en argument avec le marqueur&#160;<text:span text:style-name="CodeDansTexte">%s</text:span>.
C&#8217;est utile pour structurer un message complexe en gardant les variables Ã  part&#160;:
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">console/interpolate.js</text:p><text:p text:style-name="Code">console.log('Soupe %s et carottes', 'lentilles');<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">Soupe lentilles et carottes</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="CodeDansTexte">%s</text:span>&#160;ne sait afficher que des chaÃ®nes de caractÃ¨res.
D&#8217;autres marqueurs savent afficher d&#8217;autres types de donnÃ©es&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">%d</text:span></text:h>
<text:p text:style-name="Remarque">Affiche la valeur en tant que <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-number"  text:visited-style-name="Visited_20_Internet_20_Link">nombre</text:a>.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">%j</text:span></text:h>
<text:p text:style-name="Remarque">Affiche la valeur en tant que <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-json"  text:visited-style-name="Visited_20_Internet_20_Link">structure&#160;JSON</text:a>.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">%O</text:span></text:h>
<text:p text:style-name="Remarque">Affiche l&#8217;objet avec une profondeur maximum de 4&#160;Ã©lÃ©ments.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">%o</text:span></text:h>
<text:p text:style-name="Remarque">Idem que&#160;<text:span text:style-name="CodeDansTexte">%O</text:span> mais sur une profondeur maximum de 2&#160;Ã©lÃ©ments.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">console.log()</text:span></text:h>
<text:p text:style-name="Remarque">Affichage de messages et de variables dans le terminal.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">console.error()</text:span></text:h>
<text:p text:style-name="Remarque">Comportement identique Ã  <text:span text:style-name="CodeDansTexte">console.log()</text:span> mais Ã  rÃ©server aux erreurs.
La fonction Ã©crit dans la <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process.std"  text:visited-style-name="Visited_20_Internet_20_Link">sortie erreur</text:a>.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">console.dir()</text:span></text:h>
<text:p text:style-name="Remarque">Affichage dÃ©diÃ© aux objets et tableaux.
On peut paramÃ©trer la profondeur d&#8217;affichage
(par dÃ©faut, jusqu&#8217;Ã  deux niveaux).</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">console.group()</text:span></text:h>
<text:p text:style-name="Remarque">Regroupe visuellement les appels Ã  <text:span text:style-name="CodeDansTexte">console.log</text:span> et <text:span text:style-name="CodeDansTexte">console.error</text:span>.
Un groupe se clÃ´t avec <text:span text:style-name="CodeDansTexte">console.groupEnd()</text:span>.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">console.time()</text:span></text:h>
<text:p text:style-name="Remarque">DÃ©marre un chronomÃ¨tre en lui attribuant un nom.
Le chronomÃ¨tre s&#8217;arrÃªte et sa durÃ©e s&#8217;affiche avec <text:span text:style-name="CodeDansTexte">console.timeEnd()</text:span>.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">classe <text:span text:style-name="CodeDansTexte">Console</text:span></text:h>
<text:p text:style-name="Remarque">  CrÃ©e un objet similaire Ã  <text:span text:style-name="CodeDansTexte">console</text:span> mais en dirigeant l&#8217;affichage ailleurs
  que vers les <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process.std"  text:visited-style-name="Visited_20_Internet_20_Link">flux standards</text:a>.
undefined
undefined
undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Web</text:span> Console et navigateurs&#160;web</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">L&#8217;objet <text:span text:style-name="CodeDansTexte">console</text:span> est originaire du monde des navigateurs web.
C&#8217;est un onglet de la boÃ®te Ã  outils de dÃ©veloppement.
On peut y lire des messages placÃ©s dans le code JavaScript de la page web.
On l&#8217;utilise aussi pour inspecter la page et interagir avec du&#160;code.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-04/images/web-console.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>4-undefined.</text:span> Console web dans le navigateur web Firefox</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> Module console</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">La documentation du module <text:span text:style-name="CodeDansTexte">console</text:span> est disponible sur le site officiel de Node&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://nodejs.org/docs/latest-v10.x/api/console.html" text:visited-style-name="Visited_20_Internet_20_Link">https://nodejs.org/docs/latest-v10.x/api/console.html</text:a></text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-path" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">path : manipuler des chemins de&#160;fichiers</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le module <text:span text:style-name="CodeDansTexte">path</text:span> offre un ensemble de fonctions et de propriÃ©tÃ©s pour
manipuler et construire des chemins vers des fichiers et rÃ©pertoires.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ces opÃ©rations permettent Ã  notre code de fonctionner de maniÃ¨re identique
sur des systÃ¨mes d&#8217;exploitation qui expriment diffÃ©remment les chemins&#160;â€“
Linux et Windows par exemple.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">path/intro.js</text:p><text:p text:style-name="Code">const path = require('path');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(path.dirname('/tmp/package.json'));<text:s text:c="3"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(path.basename('/tmp/package.json'));<text:s text:c="2"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">console.log(path.extname('/tmp/package.json'));<text:s text:c="3"/><text:span text:style-name="PuceCode">3</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">/tmp</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">package.json</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche <text:span text:style-name="CodeDansTexte">.json</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Certaines fonctions comme <text:span text:style-name="CodeDansTexte">path.join()</text:span> tiennent compte de la nature du systÃ¨me
d&#8217;exploitation.
Le rÃ©sultat d&#8217;un mÃªme appel de fonction sera diffÃ©rent, mais correspondra
Ã  la mÃªme intention&#160;:
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">path/platform.js</text:p><text:p text:style-name="Code">const path = require('path');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(path.sep);<text:s text:c="26"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(path.join('tmp', 'package.json'));<text:s text:c="2"/><text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">/</text:span> (<text:span text:style-name="CodeDansTexte">\</text:span>&#160;sous Windows).<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">tmp/package.json</text:span>&#160;â€“ <text:span text:style-name="CodeDansTexte">tmp\package.json</text:span> sous Windows.
undefined<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">On constate que <text:span text:style-name="CodeDansTexte">path.join()</text:span> assemble les chemins en utilisant la valeur de
<text:span text:style-name="CodeDansTexte">path.sep</text:span>.
Ce qui est bien pour nous, c&#8217;est qu&#8217;on n&#8217;a pas besoin d&#8217;y penser&#160;:
<text:span text:style-name="T7">Node se charge de la compatibilitÃ© avec le systÃ¨me d&#8217;exploitation</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La diffÃ©rence de rÃ©sultats se prÃ©cise un peu plus lorsque l&#8217;on tente de calculer
des chemins complets, <text:span text:style-name="T4">relatifs Ã  notre emplacement</text:span> actuel&#160;:
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">path/relative.js</text:p><text:p text:style-name="Code">const path = require('path');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const relative_diff = path.relative(</text:p><text:p text:style-name="Code"><text:s text:c="2"/>'/tmp/package.json', '/tmp/source'</text:p><text:p text:style-name="Code">);</text:p><text:p text:style-name="Code">const resolve_diff = path.resolve(</text:p><text:p text:style-name="Code"><text:s text:c="2"/>'/tmp/package.json', '..', './source'</text:p><text:p text:style-name="Code">);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(relative_diff);<text:s text:c="5"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(resolve_diff);<text:s text:c="6"/><text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">../source</text:span> (<text:span text:style-name="CodeDansTexte">..\source</text:span> sous Windows)&#160;â€“ c&#8217;est ce qu&#8217;il faut parcourir pour aller du premier chemin au second.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">/tmp/source</text:span> (<text:span text:style-name="CodeDansTexte">C:\tmp\source</text:span> sous Windows)&#160;â€“ on constate que le chemin <text:span text:style-name="T4">rÃ©solu</text:span> est absolu, et intÃ¨gre la lettre du lecteur sous Windows.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les rÃ©sultats produits par les fonctions du module <text:span text:style-name="CodeDansTexte">path</text:span>
se combinent particuliÃ¨rement bien avec celles <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-fs"  text:visited-style-name="Visited_20_Internet_20_Link">du module&#160;<text:span text:style-name="CodeDansTexte">fs</text:span></text:a>, pour
accÃ©der aux fichiers.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">path.basename()</text:span></text:h>
<text:p text:style-name="Remarque">Retourne le nom de fichier.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">path.dirname()</text:span></text:h>
<text:p text:style-name="Remarque">Retourne le nom de rÃ©pertoire.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">path.extname()</text:span></text:h>
<text:p text:style-name="Remarque">Retourne l&#8217;extension d&#8217;un fichier.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">path.isAbsolute()</text:span></text:h>
<text:p text:style-name="Remarque">Indique si le chemin est <text:span text:style-name="T4">absolu</text:span> ou&#160;non.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">path.join()</text:span></text:h>
<text:p text:style-name="Remarque">Assemble des bouts de chemin.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">path.parse()</text:span></text:h>
<text:p text:style-name="Remarque">Retourne des informations liÃ©es Ã  la comprÃ©hension d&#8217;un chemin
(extension, nom de fichier, nom de rÃ©pertoire).</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">path.relative()</text:span></text:h>
<text:p text:style-name="Remarque">Calcule le chemin relatif entre un chemin source et un de destination.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">path.resolve()</text:span></text:h>
<text:p text:style-name="Remarque">Calcule un chemin absolu Ã  partir de plusieurs bouts de chemin.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Attribut <text:span text:style-name="CodeDansTexte">path.sep</text:span></text:h>
<text:p text:style-name="Remarque">  Retourne le caractÃ¨re servant de sÃ©parateur de rÃ©pertoires
  pour le systÃ¨me d&#8217;exploitation sur lequel est exÃ©cutÃ© le script&#160;:
  <text:span text:style-name="CodeDansTexte">/</text:span>&#160;pour Linux et macOS, <text:span text:style-name="CodeDansTexte">\</text:span>&#160;pour Windows.
undefined
undefined
undefined
undefined
undefined
undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">CompatibilitÃ©</text:span> Manipuler des chemins Windows sous Linux et vice-versa</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">On peut avoir besoin de manipuler des chemins Windows avec du code
exÃ©cutÃ© sur un autre systÃ¨me d&#8217;exploitation comme Linux ou macOS.
C&#8217;est exactement ce que proposent les fonctions de <text:span text:style-name="CodeDansTexte">path.win32</text:span>.
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">path/win32.js</text:p><text:p text:style-name="RemarqueCode">const {join,resolve} = require('path').win32; <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="RemarqueCode"></text:p><text:p text:style-name="RemarqueCode">console.log(join('tmp', 'package.json'));<text:s text:c="5"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="RemarqueCode">console.log(resolve('C:\\tmp', '../etc'));<text:s text:c="7"/><text:span text:style-name="PuceCode">3</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> On dÃ©structure les fonctions depuis la variante <text:span text:style-name="CodeDansTexte">win32</text:span> du module <text:span text:style-name="CodeDansTexte">path</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">tmp\package.json</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche <text:span text:style-name="CodeDansTexte">C:\etc</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">L&#8217;objet <text:span text:style-name="CodeDansTexte">path.posix</text:span> fonctionne de la mÃªme maniÃ¨re pour des chemins Linux.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> Module path</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">La documentation du module <text:span text:style-name="CodeDansTexte">path</text:span> est disponible sur le site officiel de Node&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://nodejs.org/docs/latest-v10.x/api/path.html" text:visited-style-name="Visited_20_Internet_20_Link">https://nodejs.org/docs/latest-v10.x/api/path.html</text:a></text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-url" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">url : manipuler des URL</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le module <text:span text:style-name="CodeDansTexte">url</text:span> offre des outils pour interprÃ©ter des URL, les transformer
et les assembler Ã  nouveau sous forme de chaÃ®ne de caractÃ¨res.
La variable <text:span text:style-name="CodeDansTexte">URL</text:span> (en majuscules) est disponible de maniÃ¨re globale.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">url/intro.js</text:p><text:p text:style-name="Code">const example = new URL('https://oncletom.io/node.js/');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(example.hostname);<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(example.pathname);<text:s text:c="2"/><text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">oncletom.io</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">/node.js/</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Web</text:span> CompatibilitÃ© avec les navigateurs</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
La classe <text:span text:style-name="CodeDansTexte">URL</text:span> que nous utilisons dans Node est la mÃªme que dans les
navigateurs web modernes.
Son fonctionnement suit le standard <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://url.spec.whatwg.org" text:visited-style-name="Visited_20_Internet_20_Link">https://url.spec.whatwg.org</text:a></text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;objet retournÃ© par le constructeur de <text:span text:style-name="CodeDansTexte">URL</text:span> est modifiable.
Il est ainsi possible de changer les parties de l&#8217;URL qui nous intÃ©ressent
et de rÃ©cupÃ©rer une URL sous forme d&#8217;une chaÃ®ne de caractÃ¨res&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">url/to-string.js</text:p><text:p text:style-name="Code">const example = new URL('https://oncletom.io/node.js/');</text:p><text:p text:style-name="Code">example.pathname = '/';</text:p><text:p text:style-name="Code">example.hash = '#top';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(example.toString());<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://oncletom.io/#top" text:visited-style-name="Visited_20_Internet_20_Link">https://oncletom.io/#top</text:a></text:span>&#160;â€“ le chemin et le fragment ont Ã©tÃ© modifiÃ©s.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La fonction <text:span text:style-name="CodeDansTexte">format()</text:span> va plus loin que <text:span text:style-name="CodeDansTexte">url.toString()</text:span>.
Ses options contrÃ´lent plus finement ce qui sera conservÃ© ou retirÃ© lors
de la conversion en chaÃ®ne de caractÃ¨res.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">url/format.js</text:p><text:p text:style-name="Code">const {format} = require('url');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const url = 'https://user:password@oncletom.io/#top?test=1';</text:p><text:p text:style-name="Code">const example = new URL(url);</text:p><text:p text:style-name="Code">const options = {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>auth: false,</text:p><text:p text:style-name="Code"><text:s text:c="2"/>search: false,</text:p><text:p text:style-name="Code"><text:s text:c="2"/>fragment: false,</text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(format(example, options));<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://oncletom.io/" text:visited-style-name="Visited_20_Internet_20_Link">https://oncletom.io/</text:a></text:span>&#160;â€“Â les identifiants, l&#8217;ancre et les arguments ont Ã©tÃ© retirÃ©s par la fonction <text:span text:style-name="CodeDansTexte">format()</text:span>.
undefined<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le constructeur <text:span text:style-name="CodeDansTexte">URL</text:span> accepte une URL de rÃ©fÃ©rence en second argument.
Cette adresse rÃ©sout un chemin absolu Ã  partir du premier argument&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">url/resolve.js</text:p><text:p text:style-name="Code">const url1 = new URL('/node.js/', 'https://oncletom.io');</text:p><text:p text:style-name="Code">const url2 = new URL('../', 'https://oncletom.io/node.js/');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(url1.toString()); <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(url2.toString()); <text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://oncletom.io/node.js/" text:visited-style-name="Visited_20_Internet_20_Link">https://oncletom.io/node.js/</text:a></text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://oncletom.io/" text:visited-style-name="Visited_20_Internet_20_Link">https://oncletom.io/</text:a></text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">url.parse()</text:span></text:h>
<text:p text:style-name="Remarque">Transforme une chaÃ®ne de caractÃ¨res en un objet utilisable avec la fonction
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-http.request"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">http.request()</text:span></text:a>.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">classe <text:span text:style-name="CodeDansTexte">URL</text:span></text:h>
<text:p text:style-name="Remarque">ReprÃ©sentation de la structure d&#8217;une&#160;URL.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">classe <text:span text:style-name="CodeDansTexte">URLSearchParams</text:span></text:h>
<text:p text:style-name="Remarque">  ReprÃ©sentation des paramÃ¨tres&#160;d&#8217;URL.
undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">url.format()</text:span></text:h>
<text:p text:style-name="Remarque">Transforme un objet <text:span text:style-name="CodeDansTexte">URL</text:span> en chaÃ®ne de caractÃ¨res grÃ¢ce Ã  des contrÃ´les&#160;fins.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">url.toString()</text:span></text:h>
<text:p text:style-name="Remarque">Transforme l&#8217;objet <text:span text:style-name="CodeDansTexte">URL</text:span> en chaÃ®ne de caractÃ¨res.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">attribut <text:span text:style-name="CodeDansTexte">url.hash</text:span></text:h>
<text:p text:style-name="Remarque">Fragment de&#160;l&#8217;URL.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">attribut <text:span text:style-name="CodeDansTexte">url.hostname</text:span></text:h>
<text:p text:style-name="Remarque">Nom de l&#8217;hÃ´te.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">attribut <text:span text:style-name="CodeDansTexte">url.pathname</text:span></text:h>
<text:p text:style-name="Remarque">Chemin d&#8217;accÃ¨s Ã  la ressource.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">attribut <text:span text:style-name="CodeDansTexte">url.protocol</text:span></text:h>
<text:p text:style-name="Remarque">Protocole spÃ©cifiÃ©.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">attribut <text:span text:style-name="CodeDansTexte">url.search</text:span></text:h>
<text:p text:style-name="Remarque">ParamÃ¨tres de l&#8217;URL, caractÃ¨re&#160;<text:span text:style-name="CodeDansTexte">?</text:span> inclus.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">attribut <text:span text:style-name="CodeDansTexte">url.searchParams</text:span></text:h>
<text:p text:style-name="Remarque">Objet permettant de manipuler les paramÃ¨tres.
Voir ci-aprÃ¨s.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Manipuler une URL est plus aisÃ© lorsqu&#8217;elle est structurÃ©e sous forme d&#8217;objet.
Les paramÃ¨tres ne sont pas en reste avec l&#8217;attribut <text:span text:style-name="CodeDansTexte">searchParams</text:span>&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">url/search-params.js</text:p><text:p text:style-name="Code">const example = new URL('https://oncletom.io/');</text:p><text:p text:style-name="Code">example.searchParams.set('search', 'node.js');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(example.toString());<text:s text:c="15"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(example.searchParams.toString());<text:s text:c="2"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">example.searchParams.delete('search');</text:p><text:p text:style-name="Code">console.log(example.toString());<text:s text:c="15"/><text:span text:style-name="PuceCode">3</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://oncletom.io/?search=node.js" text:visited-style-name="Visited_20_Internet_20_Link">https://oncletom.io/?search=node.js</text:a></text:span>&#160;â€“ reprÃ©sentation de l&#8217;URL complÃ¨te.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">search=node.js</text:span>&#160;â€“ reprÃ©sentation des paramÃ¨tres seulement.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche <text:span text:style-name="CodeDansTexte"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://oncletom.io/" text:visited-style-name="Visited_20_Internet_20_Link">https://oncletom.io/</text:a></text:span>&#160;â€“ le paramÃ¨tre <text:span text:style-name="CodeDansTexte">search</text:span> et sa valeur ont Ã©tÃ© supprimÃ©s de&#160;l&#8217;URL.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">searchParams.append()</text:span></text:h>
<text:p text:style-name="Remarque">Ajoute un paramÃ¨tre Ã  la suite de l&#8217;URL.
Cette fonction permet d&#8217;ajouter plusieurs fois une mÃªme clÃ©, peu importe sa valeur.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">searchParams.delete()</text:span></text:h>
<text:p text:style-name="Remarque">Supprime un paramÃ¨tre&#160;d&#8217;URL.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">searchParams.get()</text:span></text:h>
<text:p text:style-name="Remarque">Retoure la valeur d&#8217;un paramÃ¨tre donnÃ©.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">searchParams.getAll()</text:span></text:h>
<text:p text:style-name="Remarque">Renvoie toutes les valeurs d&#8217;un paramÃ¨tre donnÃ©.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">searchParams.has()</text:span></text:h>
<text:p text:style-name="Remarque">Indique <text:span text:style-name="CodeDansTexte">true</text:span> si les paramÃ¨tres contiennent une clÃ© donnÃ©e.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">searchParams.set()</text:span></text:h>
<text:p text:style-name="Remarque">Affecte une valeur Ã  un paramÃ¨tre&#160;d&#8217;URL.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">searchParams.toString()</text:span></text:h>
<text:p text:style-name="Remarque">Retourne une reprÃ©sentation de l&#8217;objet sous forme d&#8217;une chaÃ®ne
de caractÃ¨res exploitable dans une&#160;URL.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> Module url</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">La documentation du module <text:span text:style-name="CodeDansTexte">url</text:span> est disponible sur le site officiel de Node&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://nodejs.org/docs/latest-v10.x/api/url.html" text:visited-style-name="Visited_20_Internet_20_Link">https://nodejs.org/docs/latest-v10.x/api/url.html</text:a></text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-fs" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">fs : manipuler le systÃ¨me de fichiers</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le module&#160;<text:span text:style-name="CodeDansTexte">fs</text:span> est un incontournable.
On y a recours dÃ¨s que l&#8217;on a besoin de lire ou d&#8217;Ã©crire dans un fichier.
On s&#8217;en sert Ã©galement pour crÃ©er, dÃ©placer ou supprimer des fichiers
et des rÃ©pertoires.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">fs/intro.js</text:p><text:p text:style-name="Code">const fs = require('fs');</text:p><text:p text:style-name="Code">const path = require('path');</text:p><text:p text:style-name="Code">const filename = path.join(__dirname, 'package.json');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">fs.readFile(filename, (err, content) =&gt; {<text:s text:c="3"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log(String(content));<text:s text:c="13"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Lorsque la lecture du fichier aboutit, la <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-callbacks"  text:visited-style-name="Visited_20_Internet_20_Link">fonction de rappel</text:a> est appelÃ©e avec deux paramÃ¨tres&#160;: un objet d&#8217;erreur et le contenu.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche le contenu d&#8217;un fichier <text:span text:style-name="CodeDansTexte">package.json</text:span>.
undefined<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Raccourci</text:span> Variables __filename et __dirname</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque"><text:span text:style-name="CodeDansTexte">__filename</text:span> est une chaÃ®ne de caractÃ¨res faisant rÃ©fÃ©rence au fichier actuel.<text:line-break/><text:span text:style-name="CodeDansTexte">__dirname</text:span> fait rÃ©fÃ©rence au rÃ©pertoire du fichier actuel.
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">dirname-filename.js</text:p><text:p text:style-name="RemarqueCode">console.log(__filename);<text:s text:c="22"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="RemarqueCode">console.log(module.filename === __filename);<text:s text:c="2"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="RemarqueCode"></text:p><text:p text:style-name="RemarqueCode">console.log(__dirname);<text:s text:c="23"/><text:span text:style-name="PuceCode">3</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">/&#8230;&#8203;/chapter-04/examples/dirname-filename.js</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">true</text:span>&#160;â€“ Ã§a ne serait pas un <text:span text:style-name="T4">raccourci</text:span> sinon&#160;;-).<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche <text:span text:style-name="CodeDansTexte">/&#8230;&#8203;/chapter-04/examples</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Ces variables sont utiles pour opÃ©rer sur des <text:span text:style-name="T4">chemins relatifs au fichier actuel</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans l&#8217;exemple prÃ©cÃ©dent, nous avons parcouru le contenu d&#8217;un fichier.
<text:span text:style-name="CodeDansTexte">fs.readdir()</text:span> parcourt un rÃ©pertoire&#160;:
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">fs/ls.js</text:p><text:p text:style-name="Code">const {readdir} = require('fs');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">readdir('.', (error, files) =&gt; console.log(files));</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">En l&#8217;exÃ©cutant, nous obtenons le rÃ©sultat suivant&#160;:</text:p>
<text:p text:style-name="Code">$ node fs/ls.js</text:p><text:p text:style-name="Code">[ '.eslintrc.yaml',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>'console',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>'debug.txt',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>'deprecation-warning.js',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>'process/env.js',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>...</text:p><text:p text:style-name="Code"><text:s text:c="2"/>'util' ]</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans les environnements UNIX, le point&#160;(<text:span text:style-name="CodeDansTexte">.</text:span>) pour faire rÃ©fÃ©rence au
<text:span text:style-name="T4">rÃ©pertoire courant</text:span> et deux points (<text:span text:style-name="CodeDansTexte">..</text:span>) pour le <text:span text:style-name="T4">rÃ©pertoire parent</text:span>.
C&#8217;est le cas avec Node Ã©galement.
La notion de <text:span text:style-name="T4">courant</text:span> fait rÃ©fÃ©rence Ã  l&#8217;emplacement depuis lequel nous
appelons l&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">node</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Changeons de rÃ©pertoire&#160;:</text:p>
<text:p text:style-name="Code">$ cd ../..</text:p><text:p text:style-name="Code">$ node chapter-04/examples/fs/ls.js</text:p><text:p text:style-name="Code">[ '.eslintignore',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>'README.md',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>'chapter-01'</text:p><text:p text:style-name="Code"><text:s text:c="2"/>'chapter-02'</text:p><text:p text:style-name="Code"><text:s text:c="2"/>...</text:p><text:p text:style-name="Code"><text:s text:c="2"/>'tests' ]</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les <text:span text:style-name="T4">chemins relatifs</text:span> se dÃ©finissent par rapport Ã  l&#8217;emplacement depuis
lequel on exÃ©cute la commande <text:span text:style-name="CodeDansTexte">node</text:span>.
<text:span text:style-name="CodeDansTexte">__dirname</text:span> et <text:span text:style-name="CodeDansTexte">__filename</text:span> sont dÃ©terminÃ©es par rapport
Ã  l&#8217;emplacement du script qui fait rÃ©fÃ©rence Ã  ces variables.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Puisque les opÃ©rations liÃ©es au systÃ¨me de fichiers ne sont pas immÃ©diates
les fonctions de ce module sont en majoritÃ© <text:span text:style-name="T7">asynchrones</text:span>.
Leur rapiditÃ© d&#8217;exÃ©cution varie en fonction du support de stockage utilisÃ©
(disque, mÃ©moire), de son usure et de la capacitÃ© de traitement de la CPU
de l&#8217;ordinateur.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cela veut aussi dire que les erreurs sont obtenues de maniÃ¨re asynchrone&#160;:
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">fs/rmdir.js</text:p><text:p text:style-name="Code">const fs = require('fs');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">fs.rmdir(__dirname, (error) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.error(error.message);<text:s text:c="3"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Indique que la suppression n&#8217;a pas abouti car le rÃ©pertoire en question n&#8217;est pas vide&#160;â€“ et pour cause, c&#8217;est celui qui contient notre fichier d&#8217;exemple.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">On peut articuler plusieurs opÃ©rations entre elles et utiliser le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-path"  text:visited-style-name="Visited_20_Internet_20_Link">module&#160;<text:span text:style-name="CodeDansTexte">path</text:span></text:a>
pour construire des chemins robustes qui fonctionnent avec tous les systÃ¨mes
d&#8217;exploitation, sans effort.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exemple suivant crÃ©e un rÃ©pertoire dans un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-os"  text:visited-style-name="Visited_20_Internet_20_Link">dossier temporaire</text:a>,
copie un fichier sous un autre nom et liste le contenu du rÃ©pertoire
une fois la copie effectuÃ©e.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">fs/copy-tmp.js</text:p><text:p text:style-name="Code">const {tmpdir} = require('os');</text:p><text:p text:style-name="Code">const {join} = require('path');</text:p><text:p text:style-name="Code">const fs = require('fs');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const dest_dir = join(tmpdir(), 'test');<text:s text:c="10"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">fs.mkdir(dest_dir, (error) =&gt; {<text:s text:c="19"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>const dest = join(dest_dir, 'example-copy.js');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>fs.copyFile(__filename, dest, (error) =&gt; {<text:s text:c="6"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>if (error === null) {</text:p><text:p text:style-name="Code"><text:s text:c="6"/>console.log(`La copie vers ${dest} s'est bien passÃ©e.`);</text:p><text:p text:style-name="Code"><text:s text:c="4"/>}</text:p><text:p text:style-name="Code"><text:s text:c="2"/>});</text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> On assemble un chemin composÃ© Ã  partir du <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-os"  text:visited-style-name="Visited_20_Internet_20_Link">rÃ©pertoire temporaire</text:a> fourni par le systÃ¨me d&#8217;exploitation.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> CrÃ©e le rÃ©pertoire en question.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Copie le contenu de ce script d&#8217;exemple vers le rÃ©pertoire en question en lui attribuant un nouveau nom.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">SÃ©curitÃ©</text:span> Utilisateur et permissions</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
undefined
Le script Node exÃ©cutÃ© a le droit d&#8217;accÃ©der, d&#8217;altÃ©rer et de supprimer
au mÃªme titre que l&#8217;utilisateur systÃ¨me qui lance le script.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Ce n&#8217;est pas grave si on exÃ©cute du code Ã©crit soi-mÃªme.
Il faut Ãªtre vigilantÂ·e si le code exÃ©cutÃ© provient d&#8217;une autre personne.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Si l&#8217;exemple prÃ©cÃ©dent semble agrÃ©able Ã  lire, il rÃ©vÃ¨le deux points de vigilance.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">J&#8217;ai Ã©crit le code de maniÃ¨re "optimiste", pour des questions de lisibilitÃ©.
Pourtant, Ã  chaque opÃ©ration, il y a une possibilitÃ© d&#8217;erreur Ã  gÃ©rer&#160;:
de la crÃ©ation du rÃ©pertoire jusqu&#8217;Ã  la lecture des fichiers qu&#8217;il contient.
Il faudrait vÃ©rifier l&#8217;argument <text:span text:style-name="CodeDansTexte">error</text:span> Ã  chaque fois et dÃ©cider quoi faire
en fonction de la <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-errors"  text:visited-style-name="Visited_20_Internet_20_Link">nature du problÃ¨me</text:a>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Je vous invite Ã  modifier ce code
pour afficher la valeur des variables <text:span text:style-name="CodeDansTexte">error</text:span> Ã  l&#8217;aide des
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-console"  text:visited-style-name="Visited_20_Internet_20_Link">fonctions du module <text:span text:style-name="CodeDansTexte">console</text:span></text:a>.
Certaines erreurs apparaissent quand nous invoquons le script une seconde fois.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;imbrication des <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-callbacks"  text:visited-style-name="Visited_20_Internet_20_Link">fonctions de rappel</text:a> fait qu&#8217;il est
<text:span text:style-name="T7">difficile d&#8217;en interrompre la suite</text:span>.
Une bonne piste serait d&#8217;appliquer l'<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-util"  text:visited-style-name="Visited_20_Internet_20_Link">utilitaire <text:span text:style-name="CodeDansTexte">promisify</text:span></text:a>
sur les fonctions du module&#160;<text:span text:style-name="CodeDansTexte">fs</text:span> afin de crÃ©er une
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-promise"  text:visited-style-name="Visited_20_Internet_20_Link">chaÃ®ne de promesses</text:a>.<text:line-break/>Nous apprendrons Ã  le faire dans la section sur le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-util"  text:visited-style-name="Visited_20_Internet_20_Link">module&#160;<text:span text:style-name="CodeDansTexte">util</text:span></text:a>.
undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">fs.appendFile()</text:span></text:h>
<text:p text:style-name="Remarque">Ajoute un contenu Ã  la suite d&#8217;un fichier existant.
Le fichier sera crÃ©Ã© le cas Ã©chÃ©ant.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">fs.copyFile()</text:span></text:h>
<text:p text:style-name="Remarque">Copie un fichier depuis un emplacement vers un autre.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">fs.mkdir()</text:span></text:h>
<text:p text:style-name="Remarque">CrÃ©e un nouveau rÃ©pertoire.
Le rÃ©pertoire parent doit dÃ©jÃ  exister.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">fs.readdir()</text:span></text:h>
<text:p text:style-name="Remarque">Obtient la liste des fichiers et dossiers contenus dans un rÃ©pertoire donnÃ©.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">fs.readFile()</text:span></text:h>
<text:p text:style-name="Remarque">Lit le contenu d&#8217;un fichier.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">fs.rename()</text:span></text:h>
<text:p text:style-name="Remarque">Renomme un fichier ou un rÃ©pertoire.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">fs.rmdir()</text:span></text:h>
<text:p text:style-name="Remarque">Supprime un rÃ©pertoire.
Il doit Ãªtre vide.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">fs.stat()</text:span></text:h>
<text:p text:style-name="Remarque">Retourne des informations Ã  propos d&#8217;un chemin d&#8217;accÃ¨s&#160;:
est-ce que c&#8217;est un fichier, un rÃ©pertoire, un lecteur, un lien symbolique&#160;?
Des attributs prÃ©cisent la taille du fichier (en octets), l&#8217;identifiant
systÃ¨me de son propriÃ©taire, la date de crÃ©ation/modification/dernier accÃ¨s, etc.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">fs.symlink()</text:span></text:h>
<text:p text:style-name="Remarque">CrÃ©e un lien symbolique vers un emplacement.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">fs.truncate()</text:span></text:h>
<text:p text:style-name="Remarque">Raccourcit le contenu d&#8217;un fichier Ã  une longueur donnÃ©e (en nombre d&#8217;octets).
Si aucun argument n&#8217;est donnÃ©, le contenu du fichier est remis Ã &#160;zÃ©ro.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">fs.createReadStream()</text:span></text:h>
<text:p text:style-name="Remarque">CrÃ©e un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-stream"  text:visited-style-name="Visited_20_Internet_20_Link">flux de lecture</text:a>, pour lire un fichier en continu.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">fs.createWriteStream()</text:span></text:h>
<text:p text:style-name="Remarque">CrÃ©e un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-stream"  text:visited-style-name="Visited_20_Internet_20_Link">flux d&#8217;Ã©criture</text:a>, pour Ã©crire en continu dans un fichier.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">DÃ©finition</text:span> Lien symbolique</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Fichier qui fait rÃ©fÃ©rence Ã  un autre fichier&#160;â€“ c&#8217;est comme un <text:span text:style-name="T4">alias</text:span>.
Toutes les modifications effectuÃ©es sur le lien symbolique sont
rÃ©percutÃ©es sur le fichier d&#8217;origine.</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://fr.wikipedia.org/wiki/Lien_symbolique" text:visited-style-name="Visited_20_Internet_20_Link">https://fr.wikipedia.org/wiki/Lien_symbolique</text:a></text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> Module fs</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">La documentation du module <text:span text:style-name="CodeDansTexte">fs</text:span> est disponible sur le site officiel de Node&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://nodejs.org/docs/latest-v10.x/api/fs.html" text:visited-style-name="Visited_20_Internet_20_Link">https://nodejs.org/docs/latest-v10.x/api/fs.html</text:a></text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-events" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">events : programmer des Ã©vÃ©nements</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le module <text:span text:style-name="CodeDansTexte">events</text:span> contient le nÃ©cessaire pour crÃ©er du code communiquant
Ã  l&#8217;aide de fonctions d&#8217;Ã©coute et d&#8217;Ã©mission de messages.
C&#8217;est comme un <text:span text:style-name="T4">centre de tri postal</text:span>, mais avec des variables
en guise de courriers.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">events/intro.js</text:p><text:p text:style-name="Code">const EventEmitter = require('events');</text:p><text:p text:style-name="Code">const emitter = new EventEmitter();<text:s text:c="15"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">emitter.on('date', (date) =&gt; {<text:s text:c="20"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log('AnnÃ©e : %d', date.getFullYear());</text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">emitter.emit('date', new Date('2018-03-01'));<text:s text:c="5"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">emitter.emit('date', new Date('1983-03-24'));</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> CrÃ©ation d&#8217;un gestionnaire d&#8217;Ã©vÃ©nements.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Enregistrement d&#8217;une fonction d&#8217;Ã©coute&#160;â€“ elle sera exÃ©cutÃ©e Ã  chaque Ã©mission de l&#8217;Ã©vÃ©nement&#160;<text:span text:style-name="CodeDansTexte">date</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Ã‰mission d&#8217;un Ã©vÃ©nement <text:span text:style-name="CodeDansTexte">date</text:span>, avec comme argument, un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-date"  text:visited-style-name="Visited_20_Internet_20_Link">objet&#160;<text:span text:style-name="CodeDansTexte">Date</text:span></text:a>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un Ã©vÃ©nement se dÃ©compose en trois parties&#160;: les fonctions d&#8217;Ã©coute,
les Ã©missions de message et un objet <text:span text:style-name="CodeDansTexte">EventEmitter</text:span>
qui fait le lien entre les deux.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Langage</text:span> ECMAScript n&#8217;est pas Ã©vÃ©nementiel</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Contrairement Ã  ce que l&#8217;on pourrait penser, le langage ECMAScript ne possÃ¨de
aucune structure de gestion d&#8217;Ã©vÃ©nements.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">S&#8217;il est possible de rÃ©agir Ã  des Ã©vÃ©nements dans les navigateurs web,
c&#8217;est grÃ¢ce Ã  la spÃ©cification DOM&#160;â€“ l&#8217;API JavaScript pour manipuler
une structure de document&#160;HTML.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://developer.mozilla.org/fr/docs/Web/Events" text:visited-style-name="Visited_20_Internet_20_Link">https://developer.mozilla.org/fr/docs/Web/Events</text:a></text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">On peut dÃ©cider d&#8217;Ã©couter un Ã©vÃ©nement une seule fois avec&#160;<text:span text:style-name="CodeDansTexte">once()</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">events/once.js</text:p><text:p text:style-name="Code">const EventEmitter = require('events');</text:p><text:p text:style-name="Code">const emitter = new EventEmitter();</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">emitter.once('date', (date) =&gt; {<text:s text:c="18"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log('AnnÃ©e : %d', date.getFullYear());</text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">emitter.emit('date', new Date('2018-03-01'));</text:p><text:p text:style-name="Code">emitter.emit('date', new Date('1983-03-24'));</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Bien que l&#8217;Ã©vÃ©nement <text:span text:style-name="CodeDansTexte">date</text:span> soit appelÃ© deux fois, la fonction d&#8217;Ã©coute ne rÃ©agira qu&#8217;une seule fois.
undefined<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La fonction <text:span text:style-name="CodeDansTexte">removeListener()</text:span> dÃ©branche une fonction d&#8217;Ã©coute selon
les critÃ¨res de notre choix&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">events/remove.js</text:p><text:p text:style-name="Code">const EventEmitter = require('events');</text:p><text:p text:style-name="Code">const emitter = new EventEmitter();</text:p><text:p text:style-name="Code">const tick = () =&gt; process.stdout.write('.');</text:p><text:p text:style-name="Code">let counter = 0;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">setInterval(() =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>counter++;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>emitter.emit('date', new Date());<text:s text:c="13"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>if (counter === 5) {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>process.exit(0);</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">}, 1000);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">emitter.on('date', tick);<text:s text:c="23"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">emitter.on('date', () =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>if (counter === 3) {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>emitter.removeListener('date', tick);<text:s text:c="7"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> L&#8217;Ã©vÃ©nement <text:span text:style-name="CodeDansTexte">date</text:span> est Ã©mis toutes les secondes.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> La fonction <text:span text:style-name="CodeDansTexte">tick</text:span> est appelÃ©e toutes les secondes.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> La fonction <text:span text:style-name="CodeDansTexte">tick</text:span> est dÃ©branchÃ©e de l&#8217;Ã©vÃ©nement <text:span text:style-name="CodeDansTexte">date</text:span> au bout de trois incrÃ©ments.
undefined<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">On remarquera qu&#8217;il faut pouvoir faire rÃ©fÃ©rence Ã  la fonction d&#8217;Ã©coute
afin de la dÃ©brancher.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Une utilisation alternative des Ã©vÃ©nements consiste Ã  Ã©tendre la classe <text:span text:style-name="CodeDansTexte">EventEmitter</text:span>.
Une fois Ã©tendue, notre nouvelle classe bÃ©nÃ©ficiera des mÃ©thodes <text:span text:style-name="CodeDansTexte">.on()</text:span> etc.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">events/class.js</text:p><text:p text:style-name="Code">const EventEmitter = require('events');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">class Car extends EventEmitter {<text:s text:c="19"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>constructor (name) {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>super();<text:s text:c="39"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>this.name = name;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>start () {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>this.emit('action', this, 'dÃ©marrer');<text:s text:c="9"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const auto = new Car('Boombo');</text:p><text:p text:style-name="Code">auto.on('action', (car, action) =&gt; {<text:s text:c="15"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log('%s est en train de %s', car.name, action);</text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">auto.start();</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Extension de la classe <text:span text:style-name="CodeDansTexte">EventEmitter</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> L&#8217;utilisation de la fonction spÃ©ciale <text:span text:style-name="CodeDansTexte">super()</text:span> est indispensable. Elle revient Ã  invoquer <text:span text:style-name="CodeDansTexte">new EventEmitter()</text:span> par mÃ©canisme de cascade.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> La mÃ©thode <text:span text:style-name="CodeDansTexte">.start()</text:span> encapsule un appel Ã  la mÃ©thode <text:span text:style-name="CodeDansTexte">.emit()</text:span>.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> La fonction rÃ©agira Ã  l&#8217;Ã©mission de l&#8217;Ã©vÃ©nement <text:span text:style-name="CodeDansTexte">action</text:span> quand la mÃ©thode <text:span text:style-name="CodeDansTexte">.start()</text:span> sera appelÃ©e.
undefined
undefined
undefined
undefined<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce mÃ©canisme est utile pour cacher de la complexitÃ© applicative,
pour exÃ©cuter une fonction plusieurs fois lors d&#8217;un Ã©vÃ©nement donnÃ©,
pour exposer une surface d&#8217;action comprÃ©hensible,
tout en rendant notre code communiquant vers l&#8217;extÃ©rieur.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Plusieurs modules Node utilisent les Ã©vÃ©nements pour nous permettre d&#8217;y
rÃ©agir de maniÃ¨re totalement optionnelle.
Tout ce que l&#8217;on vient d&#8217;expliquer s&#8217;applique Ã  l&#8217;identique aux modules
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">process</text:span></text:a>, <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-child_process"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">child_process</text:span></text:a> et <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-http"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">http</text:span></text:a>.
undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">on()</text:span></text:h>
<text:p text:style-name="Remarque">Enregistre une nouvelle fonction rÃ©agissant Ã  un Ã©vÃ©nement donnÃ©.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">once()</text:span></text:h>
<text:p text:style-name="Remarque">Enregistre une nouvelle fonction rÃ©agissant <text:span text:style-name="T4">une seule fois</text:span> Ã  un Ã©vÃ©nement donnÃ©.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">emit()</text:span></text:h>
<text:p text:style-name="Remarque">Ã‰met un Ã©vÃ©nement.
Si des arguments additonnels sont prÃ©sents,
ils sont transmis aux fonctions Ã©coutant cet Ã©vÃ©nement.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">eventNames()</text:span></text:h>
<text:p text:style-name="Remarque">Liste les Ã©vÃ©nements pour lesquels on a enregistrÃ© au moins une fonction d&#8217;Ã©coute.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">listeners()</text:span></text:h>
<text:p text:style-name="Remarque">Liste les fonctions Ã©coutant les Ã©vÃ©nements.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">removeListener()</text:span></text:h>
<text:p text:style-name="Remarque">Supprime une fonction d&#8217;Ã©coute d&#8217;un Ã©vÃ©nement donnÃ©.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">removeAllListeners()</text:span></text:h>
<text:p text:style-name="Remarque">Supprime toutes les fonctions d&#8217;Ã©coute d&#8217;un Ã©vÃ©nement donnÃ©.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">setMaxListeners()</text:span></text:h>
<text:p text:style-name="Remarque">  Change le nombre maximum de fonctions d&#8217;Ã©coute possibles (10&#160;par dÃ©faut,
  c&#8217;est&#160;peu).
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> Module events</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">La documentation du module <text:span text:style-name="CodeDansTexte">events</text:span> est disponible sur le site officiel de Node&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://nodejs.org/docs/latest-v10.x/api/events.html" text:visited-style-name="Visited_20_Internet_20_Link">https://nodejs.org/docs/latest-v10.x/api/events.html</text:a></text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-util" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">util : transformer des fonctions de rappel en promesses</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le petit module <text:span text:style-name="CodeDansTexte">util</text:span> contient des fonctions utilitaires
qui n&#8217;entreraient pas dans le pÃ©rimÃ¨tre d&#8217;autres modules.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">On y trouve <text:span text:style-name="CodeDansTexte">util.format()</text:span>, une fonction qui fait beaucoup penser Ã 
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-console"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">console.log()</text:span></text:a> mais sans afficher le message&#160;:
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">util/format.js</text:p><text:p text:style-name="Code">const {format} = require('util');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const message = format(<text:s text:c="11"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>'Il fait %s aujourd\'hui',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>'â˜€ï¸ '</text:p><text:p text:style-name="Code">);</text:p><text:p text:style-name="Code">// console.log(message);</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affecte le message formatÃ© Ã  une variable sans l&#8217;afficher.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Pour afficher la valeur de la variable <text:span text:style-name="CodeDansTexte">message</text:span> de l&#8217;exemple prÃ©cÃ©dent,
il suffirait de dÃ©commenter la derniÃ¨re ligne et de (re)lancer le script.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La fonction <text:span text:style-name="CodeDansTexte">util.debuglog()</text:span> formate aussi des messages.
Son affichage est toutefois conditionnel, ce qui est pratique quand on veut
dÃ©boguer des variables sans toucher au code entre deux exÃ©cutions.
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">util/debuglog.js</text:p><text:p text:style-name="Code">const {debuglog} = require('util');</text:p><text:p text:style-name="Code">const {cpus} = require('os');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const debug = debuglog('nodebook');<text:s text:c="21"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">const infos = cpus().map(cpu =&gt; cpu.model);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log('Cet ordinateur a %d CPU.', infos.length);<text:s text:c="2"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">debug('Le modÃ¨le de CPU est %s.', infos[0]);<text:s text:c="12"/><text:span text:style-name="PuceCode">3</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> CrÃ©ation d&#8217;un dÃ©bogueur nommÃ© <text:span text:style-name="CodeDansTexte">nodebook</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Ce message s&#8217;affiche systÃ©matiquement quand on exÃ©cute le script.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Le modÃ¨le de CPU sera affichÃ© en invoquant Node en prÃ©sence de la variable d&#8217;environnement <text:span text:style-name="CodeDansTexte">NODE_DEBUG</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">En lanÃ§ant la commande suivante, seul le message de <text:span text:style-name="CodeDansTexte">console.log()</text:span> s&#8217;affiche&#160;:</text:p>
<text:p text:style-name="Code">$ node util/debuglog.js</text:p><text:p text:style-name="Code">Cet ordinateur a 4 CPU.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il nous faut alors utiliser la <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process.env"  text:visited-style-name="Visited_20_Internet_20_Link">variable d&#8217;environnement</text:a> <text:span text:style-name="CodeDansTexte">NODE_DEBUG</text:span>.
En lui attribuant la mÃªme valeur que notre dÃ©bogueur, celui-ci affichera alors
le contenu attendu&#160;:
undefined
undefined
undefined</text:p>
<text:p text:style-name="Code">$ NODE_DEBUG=nodebook node util/debuglog.js</text:p><text:p text:style-name="Code">Cet ordinateur a 4 CPU.</text:p><text:p text:style-name="Code">NODEBOOK 32486: Le modÃ¨le de CPU est Intel(R) Core(TM) i5-6267U CPU @ 2.90GHz.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Si l&#8217;on souhaite avoir plusieurs dÃ©bogueurs, dans un ou plusieurs script(s),
il suffit de sÃ©parer leurs noms par des virgules
(ex: <text:span text:style-name="CodeDansTexte">NODE_DEBUG=nodebook,test,fromage</text:span>).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Une de mes fonctions prÃ©fÃ©rÃ©es est <text:span text:style-name="CodeDansTexte">util.promisify()</text:span>.
Elle convertit une fonction acceptant un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-callback"  text:visited-style-name="Visited_20_Internet_20_Link">callback</text:a> en une fonction
retournant une <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-promise"  text:visited-style-name="Visited_20_Internet_20_Link">promesse</text:a>.
C&#8217;est particuliÃ¨rement pratique quand on n&#8217;a pas la maÃ®trise du
code source original.
undefined
undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">util/fs-readdir-promisified.js</text:p><text:p text:style-name="Code">const {promisify} = require('util');</text:p><text:p text:style-name="Code">const readdir = promisify(require('fs').readdir);<text:s text:c="3"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">readdir(__dirname)<text:s text:c="34"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>.then((files) =&gt; console.log(files))<text:s text:c="14"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>.catch((error) =&gt; console.error(error.message));</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affecte une version transformÃ©e de <text:span text:style-name="CodeDansTexte">fs.readdir()</text:span> grÃ¢ce Ã  <text:span text:style-name="CodeDansTexte">util.promisify()</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> On ne passe pas de <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-callbacks"  text:visited-style-name="Visited_20_Internet_20_Link">fonction de rappel</text:a> contrairement Ã  <text:span text:style-name="CodeDansTexte">fs.readdir()</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Le rÃ©sultat de l&#8217;opÃ©ration est passÃ© Ã  la rÃ©solution de promesse.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cela ne paraÃ®t pas important mais cela ouvre un potentiel de simplification
Ã©norme pour nous.
Fini l&#8217;argument <text:span text:style-name="CodeDansTexte">error</text:span> qui nous embÃªte&#160;: on peut le collecter quand cela
nous arrange grÃ¢ce Ã  <text:span text:style-name="CodeDansTexte">.catch()</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cela limite Ã©galement le nombre de lignes de code Ã  Ã©crire
pour arriver au mÃªme rÃ©sultat&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">util/fs-readdir-promise.js</text:p><text:p text:style-name="Code">const fs = require('fs');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const readdir = (path) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>return new Promise((resolve, reject) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>fs.readdir(path, (error, files) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="6"/>error ? reject(error) : resolve(files);</text:p><text:p text:style-name="Code"><text:s text:c="4"/>});</text:p><text:p text:style-name="Code"><text:s text:c="2"/>});</text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">readdir(__dirname)</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.then((files) =&gt; console.log(files))</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.catch((error) =&gt; console.error(error.message));</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">util.debuglog()</text:span></text:h>
<text:p text:style-name="Remarque">CrÃ©e une fonction de dÃ©bogage similaire Ã  <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-console"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">console.error</text:span></text:a>.
Les messages ne s&#8217;afficheront que si la <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process.env"  text:visited-style-name="Visited_20_Internet_20_Link">variable d&#8217;environnement</text:a>
<text:span text:style-name="CodeDansTexte">NODE_DEBUG</text:span> mentionne l&#8217;identifiant du dÃ©bogueur.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">util.deprecate()</text:span></text:h>
<text:p text:style-name="Remarque">Affiche un message d&#8217;avertissement lorsque vous souhaitez retirer une fonction
partagÃ©e dans une version ultÃ©rieure de votre&#160;code.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">util.format()</text:span></text:h>
<text:p text:style-name="Remarque">Retourne une chaÃ®ne de caractÃ¨res formatÃ©e, comme <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-console"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">console.log</text:span></text:a>
mais sans l&#8217;envoyer dans un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process.std"  text:visited-style-name="Visited_20_Internet_20_Link">flux de sortie</text:a>.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">util.promisify()</text:span></text:h>
<text:p text:style-name="Remarque">Transforme une <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-callbacks"  text:visited-style-name="Visited_20_Internet_20_Link">fonction de rappel</text:a> en
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-promise"  text:visited-style-name="Visited_20_Internet_20_Link">promesse</text:a>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> Module util</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">La documentation du module <text:span text:style-name="CodeDansTexte">util</text:span> est disponible sur le site officiel de Node&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://nodejs.org/docs/latest-v10.x/api/util.html" text:visited-style-name="Visited_20_Internet_20_Link">https://nodejs.org/docs/latest-v10.x/api/util.html</text:a></text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-http" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">http : crÃ©er et interroger des ressources via le protocole&#160;HTTP</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le module <text:span text:style-name="CodeDansTexte">http</text:span> est un incontournable de Node.
Il a deux facettes&#160;: la crÃ©ation de requÃªtes et celle de serveurs.
Dans le premier cas, on utilise le protocole HTTP pour accÃ©der Ã  une ressource distante
et recevoir une rÃ©ponse.
Dans le second, on utilise le protocole HTTP pour
<text:span text:style-name="T7">mettre Ã  disposition des ressources</text:span> et les envoyer en rÃ©ponse.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le module <text:span text:style-name="CodeDansTexte">https</text:span> offre exactement les mÃªmes propriÃ©tÃ©s.
Il est Ã  privilÃ©gier pour Ã©tablir des connexions sÃ©curisÃ©es
vers des adresses commenÃ§ant par&#160;<text:span text:style-name="CodeDansTexte">https://</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">http/intro.js</text:p><text:p text:style-name="Code">const {get} = require('https');</text:p><text:p text:style-name="Code">const url = 'https://oncletom.io/node.js/package.json';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">get(url, (response) =&gt; {<text:s text:c="24"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.on('data', (data) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>console.log(data.toString());<text:s text:c="15"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>});</text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Initialisation de la requÃªte&#160;â€“ un objet reprÃ©sentant la <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-http.IncomingMessage"  text:visited-style-name="Visited_20_Internet_20_Link">rÃ©ponse du serveur distant</text:a> nous est transmis. Ã€ ce stade-lÃ , le serveur n&#8217;a pas encore commencÃ© Ã  renvoyer des donnÃ©es.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> On en est Ã  l&#8217;Ã©tape oÃ¹ on reÃ§oit des donnÃ©es. Le contenu du fichier <text:span text:style-name="CodeDansTexte">package.json</text:span> est affichÃ© sous forme de chaÃ®nes de caractÃ¨res.
undefined<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce premier exemple met en lumiÃ¨re <text:span text:style-name="T7">la nature asynchrone et non-bloquante par dÃ©faut de Node</text:span>.
La crÃ©ation d&#8217;une requÃªte et l&#8217;obtention de la rÃ©ponse sont sÃ©parÃ©es d&#8217;un dÃ©lai
variable, pendant lequel Node ne bloque pas le reste du code.
Les <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-callbacks"  text:visited-style-name="Visited_20_Internet_20_Link">fonctions de rappel</text:a> sont appelÃ©es lorsque l&#8217;action est terminÃ©e.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">En regardant le code de l&#8217;exemple prÃ©cÃ©dent, on en apprend un peu plus sur
le fonctionnement d&#8217;une requÃªte&#160;HTTP&#160;:</text:p>
<text:p text:style-name="ListeANumero">1.<text:tab/>Envoi de la requÃªte au serveur distant&#160;: <text:span text:style-name="CodeDansTexte">get()</text:span>.</text:p><text:p text:style-name="ListeANumero">2.<text:tab/>Obtention d&#8217;une rÃ©ponse&#160;: objet <text:span text:style-name="CodeDansTexte">response</text:span> dans la fonction de rappel.</text:p><text:p text:style-name="ListeANumero">3.<text:tab/>Transmission d&#8217;informations&#160;: Ã©vÃ©nement <text:span text:style-name="CodeDansTexte">data</text:span>.</text:p><text:p text:style-name="ListeANumero">4.<text:tab/>ClÃ´ture de la transmission&#160;: Ã©vÃ©nement <text:span text:style-name="CodeDansTexte">end</text:span>&#160;â€“ voir exemple suivant.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Pour rester rapide, Node fait aussi le choix de transmettre les donnÃ©es
au fur et Ã  mesure.
L'<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-events"  text:visited-style-name="Visited_20_Internet_20_Link">Ã©vÃ©nement</text:a> <text:span text:style-name="CodeDansTexte">data</text:span> renvoie en rÃ©alitÃ© environ 10&#160;Ko de donnÃ©es.
L&#8217;exemple prÃ©cÃ©dent a tout renvoyÃ© d&#8217;un coup car le volume des donnÃ©es
Ã©tait infÃ©rieur Ã  10&#160;Ko.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Voyons maintenant ce qui se passe lorsqu&#8217;on fait appel Ã  un fichier
plus volumineux&#160;:
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">http/get.js</text:p><text:p text:style-name="Code">const {get} = require('https');</text:p><text:p text:style-name="Code">let count = 0;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">get('https://oncletom.io/node.js/index.html', (response) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.on('data', (data) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>count = count + 1;</text:p><text:p text:style-name="Code"><text:s text:c="4"/>const ko = data.length/1024;</text:p><text:p text:style-name="Code"><text:s text:c="4"/>console.log('Morceau #%d : %iKo', count, ko); <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.on('end', () =&gt; {<text:s text:c="22"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>console.log('Fini (%d morceaux)', count);<text:s text:c="5"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>});</text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche ce message Ã  chaque morceau/paquet reÃ§u.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> L&#8217;Ã©vÃ©nement <text:span text:style-name="CodeDansTexte">end</text:span> se dÃ©clenche lorsque la requÃªte n&#8217;a plus de donnÃ©es Ã  recevoir.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche le nombre de morceaux reÃ§us pour obtenir une rÃ©ponse complÃ¨te.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Pratique</text:span> ParamÃ¨tre&#160;URL</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
undefined
Les fonctions <text:span text:style-name="CodeDansTexte">http.get()</text:span> et <text:span text:style-name="CodeDansTexte">http.request()</text:span> acceptent une chaÃ®ne de caractÃ¨res
comme premier argument.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Il est aussi possible de leur passer un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-url"  text:visited-style-name="Visited_20_Internet_20_Link">objet&#160;URL</text:a>.
C&#8217;est plus pratique si vous manipulez des URL complexes ou si vous paginez.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">En clair, on peut recevoir une rÃ©ponse en plusieurs fois, petit bout par petit bout.
Les donnÃ©es reÃ§ues ne sont pas forcÃ©ment complÃ¨tes.
Cela pose problÃ¨me Ã  des fonctions comme
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-json"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">JSON.parse()</text:span></text:a>, qui nÃ©cessitent un document
JSON complet pour produire un rÃ©sultat.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Une solution consiste Ã  accumuler les morceaux de rÃ©ponse et Ã  les assembler.
Cela veut aussi dire que l&#8217;on consomme autant de mÃ©moire que l&#8217;on reÃ§oit de donnÃ©es.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Une autre solution repose sur l&#8217;utilisation des <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-stream"  text:visited-style-name="Visited_20_Internet_20_Link">flux de donnÃ©es</text:a>.
Ils pompent et brassent les donnÃ©es comme du liquide, en consommant peu de mÃ©moire.
On en parle plus loin, dans la section sur le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-stream"  text:visited-style-name="Visited_20_Internet_20_Link">module <text:span text:style-name="CodeDansTexte">stream</text:span></text:a>.
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">http.createServer()</text:span></text:h>
<text:p text:style-name="Remarque">Initialise un serveur HTTP et fournit une boÃ®te Ã  outils pour
gÃ©rer les connexions entrantes via <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-http.Server"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">http.Server</text:span></text:a></text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">http.get()</text:span></text:h>
<text:p text:style-name="Remarque">CrÃ©e une connexion HTTP de type&#160;<text:span text:style-name="CodeDansTexte">GET</text:span>.
Il s&#8217;agit d&#8217;une version simplifiÃ©e de <text:span text:style-name="CodeDansTexte">http.request()</text:span>.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">http.request()</text:span></text:h>
<text:p text:style-name="Remarque">CrÃ©e une connexion HTTP du type de son choix&#160;: <text:span text:style-name="CodeDansTexte">GET</text:span>, <text:span text:style-name="CodeDansTexte">POST</text:span>, <text:span text:style-name="CodeDansTexte">OPTION</text:span>, <text:span text:style-name="CodeDansTexte">PUT</text:span>,
etc.</text:p>
<text:bookmark text:name="ref-http.request" /><text:p text:style-name="TexteCourant">La fonction <text:span text:style-name="CodeDansTexte">http.request()</text:span> gÃ¨re une requÃªte plus finement.
On peut aisÃ©ment rÃ©gler les en-tÃªtes, le verbe HTTP et les modalitÃ©s de
transmission des donnÃ©es.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exemple suivant illustre l&#8217;envoi d&#8217;une requÃªte <text:span text:style-name="CodeDansTexte">HEAD</text:span>.
Ce verbe HTTP indique au serveur distant de rÃ©pondre avec les mÃ©tadonnÃ©es
de la ressource, mais sans les donnÃ©es (<text:span text:style-name="CodeDansTexte">response.on('data')</text:span>)&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">http/request.js</text:p><text:p text:style-name="Code">const https = require('https');</text:p><text:p text:style-name="Code">const options = {<text:s text:c="33"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>protocol: 'https:',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>host: 'oncletom.io',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>path: '/node.js/package.json',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>method: 'HEAD',</text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const request = https.request(options);</text:p><text:p text:style-name="Code">request.setHeader('Accept', 'application/json');<text:s text:c="2"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">request.end();<text:s text:c="36"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">request.on('response', (response) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const lastModified = response.headers['last-modified'];</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log('ModifiÃ© le %s', lastModified);<text:s text:c="5"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Construction des paramÃ¨tres de requÃªte pour <text:span text:style-name="CodeDansTexte">http.request()</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Explicite au serveur distant la nature du contenu que l&#8217;on s&#8217;apprÃªte Ã  recevoir.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> DÃ©clenche l&#8217;envoi de la requÃªte sur le rÃ©seau.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Affiche la date de modification de la ressource distante.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">AvancÃ©</text:span> Parser, destructurer, combiner</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">La fonction <text:span text:style-name="CodeDansTexte">url.parse()</text:span> du <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-url"  text:visited-style-name="Visited_20_Internet_20_Link">module&#160;<text:span text:style-name="CodeDansTexte">url</text:span></text:a> est une alternative Ã  la
construction manuelle de l&#8217;URL.
Les opÃ©rateurs de <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-object"  text:visited-style-name="Visited_20_Internet_20_Link">manipulation d&#8217;objets</text:a>
comme le <text:span text:style-name="T4">destructuring</text:span> et l&#8217;expansion (<text:span text:style-name="T4">rest</text:span>) favorisent
une Ã©criture concise et Ã©lÃ©gante.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">http/request-advanced.js</text:p><text:p text:style-name="RemarqueCode">const https = require('https');</text:p><text:p text:style-name="RemarqueCode">const {parse} = require('url');</text:p><text:p text:style-name="RemarqueCode">const url = parse('https://oncletom.io/node.js/package.json');</text:p><text:p text:style-name="RemarqueCode"></text:p><text:p text:style-name="RemarqueCode">const request = https.request({ ...url, method: 'HEAD'});</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;utilisation de <text:span text:style-name="CodeDansTexte">http.get()</text:span> et <text:span text:style-name="CodeDansTexte">http.request()</text:span> est simple tant qu&#8217;on Ã©vite
la personnalisation de la requÃªte.
On ajoute progressivement de plus en plus de travail pour bien envoyer une
requÃªte, collecter les donnÃ©es et gÃ©rer les erreurs.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous verrons comment arriver au mÃªme rÃ©sultat en Ã©crivant moins de code grÃ¢ce aux
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-modules"  text:visited-style-name="Visited_20_Internet_20_Link">modules&#160;<text:span text:style-name="CodeDansTexte">npm</text:span></text:a>
(<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-05"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;5</text:a>).
undefined</text:p>
<text:bookmark text:name="ref-http.ClientRequest" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">request.on('response')</text:span></text:h>
<text:p text:style-name="Remarque">Se dÃ©clenche lorsque la ressource distante a acceptÃ© la requÃªte et s&#8217;apprÃªte
Ã  nous transmettre les donnÃ©es.</text:p><text:bookmark text:name="ref-http.ClientRequest" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">request.on('end')</text:span></text:h>
<text:p text:style-name="Remarque">Se dÃ©clenche lorsque la ressource distante a signalÃ© ne plus avoir de donnÃ©es
Ã  nous transmettre.</text:p><text:bookmark text:name="ref-http.ClientRequest" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">request.end()</text:span></text:h>
<text:p text:style-name="Remarque">Termine l&#8217;initialisation et entame la connexion vers la ressource distante.
Dans le cas d&#8217;une requÃªte <text:span text:style-name="CodeDansTexte">POST</text:span>, <text:span text:style-name="CodeDansTexte">PUT</text:span> ou <text:span text:style-name="CodeDansTexte">DELETE</text:span>, le premier paramÃ¨tre
sert Ã  passer une donnÃ©e au serveur distant.</text:p><text:bookmark text:name="ref-http.ClientRequest" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">request.getHeader()</text:span></text:h>
<text:p text:style-name="Remarque">Retourne la valeur d&#8217;un en-tÃªte de requÃªte.</text:p><text:bookmark text:name="ref-http.ClientRequest" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">request.setHeader()</text:span></text:h>
<text:p text:style-name="Remarque">Change la valeur d&#8217;un en-tÃªte de requÃªte.
C&#8217;est une pratique courante pour prÃ©ciser nos intentions auprÃ¨s du serveur
distant&#160;: format de fichier rÃ©ponse attendu (<text:span text:style-name="CodeDansTexte">Accept</text:span>), agent utilisateur
(<text:span text:style-name="CodeDansTexte">User-Agent</text:span>), nature des donnÃ©es envoyÃ©es (<text:span text:style-name="CodeDansTexte">Content-Type</text:span>), etc.</text:p><text:bookmark text:name="ref-http.ClientRequest" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">request.setTimeout()</text:span></text:h>
<text:p text:style-name="Remarque">DÃ©finit un chronomÃ¨tre pour dÃ©clarer la requÃªte en erreur si aucune rÃ©ponse
n&#8217;a Ã©tÃ© obtenue dans ce dÃ©lai imparti.</text:p><text:bookmark text:name="ref-http.ClientRequest" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">request.write()</text:span></text:h>
<text:p text:style-name="Remarque">Transmet un morceau de contenu vers la ressource distante.
Cette mÃ©thode s&#8217;utilise lorsque l&#8217;on effectue un tÃ©lÃ©versement progressif.</text:p>
<text:bookmark text:name="ref-http.IncomingMessage" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">message.on('data')</text:span></text:h>
<text:p text:style-name="Remarque">Se dÃ©clenche quand un morceau de donnÃ©es est obtenu par le client.</text:p><text:bookmark text:name="ref-http.IncomingMessage" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">message.on('end')</text:span></text:h>
<text:p text:style-name="Remarque">Se dÃ©clenche quand nous avons obtenu toutes les donnÃ©es Ã©mises par le serveur.</text:p><text:bookmark text:name="ref-http.IncomingMessage" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">message.on('readable')</text:span></text:h>
<text:p text:style-name="Remarque">Se dÃ©clenche quand nous pouvons commencer Ã  lire les donnÃ©es.</text:p><text:bookmark text:name="ref-http.IncomingMessage" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">message.read()</text:span></text:h>
<text:p text:style-name="Remarque">Obtient un morceau de donnÃ©es manuellement&#160;â€“ au lieu d&#8217;utiliser
l&#8217;Ã©vÃ©nement <text:span text:style-name="CodeDansTexte">data</text:span>, automatique.
On apprendra Ã  mieux manipuler cette fonction dans la section sur le
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-stream"  text:visited-style-name="Visited_20_Internet_20_Link">module <text:span text:style-name="CodeDansTexte">stream</text:span></text:a>.</text:p><text:bookmark text:name="ref-http.IncomingMessage" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">message.destroy()</text:span></text:h>
<text:p text:style-name="Remarque">Termine la transmission des donnÃ©es sans que le serveur distant
nous aie tout transmis.</text:p><text:bookmark text:name="ref-http.IncomingMessage" /><text:h text:style-name="RemarqueTitre">Attribut <text:span text:style-name="CodeDansTexte">message.headers</text:span></text:h>
<text:p text:style-name="Remarque">Objet contenant les en-tÃªtes de la rÃ©ponse&#160;â€“ le serveur distant dÃ©cide
de leur contenu.</text:p><text:bookmark text:name="ref-http.IncomingMessage" /><text:h text:style-name="RemarqueTitre">Attribut <text:span text:style-name="CodeDansTexte">message.statusCode</text:span></text:h>
<text:p text:style-name="Remarque">Code qui reflÃ¨te l&#8217;Ã©tat de comprÃ©hension de notre requÃªte par le serveur distant.
<text:span text:style-name="CodeDansTexte">200</text:span>&#160;correspond Ã  <text:span text:style-name="T4">tout va bien</text:span>, <text:span text:style-name="CodeDansTexte">404</text:span>&#160;Ã  <text:span text:style-name="T4">ressource introuvable</text:span>,
<text:span text:style-name="CodeDansTexte">301</text:span>&#160;Ã  <text:span text:style-name="T4">la ressource a Ã©tÃ© dÃ©placÃ©e</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il est temps de nous pencher sur l&#8217;autre versant du module&#160;: la crÃ©ation
d&#8217;un serveur&#160;HTTP.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">http/server.js</text:p><text:p text:style-name="Code">const http = require('http');</text:p><text:p text:style-name="Code">const server = http.createServer();</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">server.listen(4000, 'localhost');<text:s text:c="19"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">server.on('listening', () =&gt; {<text:s text:c="22"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log('Serveur dÃ©marrÃ© !');</text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">server.on('request', (request, response) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const {method, url} = request;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log('URL demandÃ©e : %s %s', method, url); <text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.end('Coucou');<text:s text:c="27"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Ouverture de l&#8217;acceptation des connexions rÃ©seau sur le port <text:span text:style-name="CodeDansTexte">4000</text:span>, uniquement sur la boucle locale (<text:span text:style-name="CodeDansTexte">localhost</text:span>)&#160;â€“ une erreur sera affichÃ©e si ce port rÃ©seau est dÃ©jÃ  pris par un autre processus.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">Serveur dÃ©marrÃ©&#160;!</text:span> quand Node a fini de nÃ©gocier l&#8217;accÃ¨s aux ressources rÃ©seau avec le systÃ¨me d&#8217;exploitation&#160;â€“ Ã  ce stade, le serveur est prÃªt Ã  recevoir des <text:span text:style-name="T4">connexions entrantes</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Lorsqu&#8217;une requÃªte arrive, affiche l&#8217;URL demandÃ©e par le client.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Termine la connexion avec le client&#160;â€“ ce dernier considÃ¨re sa requÃªte comme terminÃ©e.
undefined<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">ApartÃ©</text:span> Pourquoi dÃ©marrer un serveur&#160;HTTP ?</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
undefined
Ce concept peut sembler Ã©trange lorsqu&#8217;on vient d&#8217;un autre langage de programmation.
AprÃ¨s tout, Apache ou nginx s&#8217;en chargent trÃ¨s bien pour nous.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Un serveur HTTP embarquÃ© avec Node, c&#8217;est avant tout
<text:span text:style-name="T7">une question d&#8217;autonomie et d&#8217;interopÃ©rabilitÃ©</text:span>.
Il n&#8217;y a pas besoin de module spÃ©cial pour Apache ni pour nginx.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">On peut dÃ©velopper un site web et le faire fonctionner instantanÃ©ment sans
installer autre chose.
L&#8217;intÃ©gration avec un serveur Apache, nginx ou autre nÃ©cessite ensuite
trÃ¨s peu d&#8217;efforts.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le serveur se dÃ©marre de la mÃªme maniÃ¨re qu&#8217;un script ordinaire&#160;:</text:p>
<text:p text:style-name="Code">$ node http/server.js</text:p><text:p text:style-name="Code">Serveur dÃ©marrÃ© !</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le serveur continuera d&#8217;accepter les requÃªtes entrantes jusqu&#8217;Ã  ce que le
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process"  text:visited-style-name="Visited_20_Internet_20_Link">processus</text:a> soit interrompu par une erreur ou par un
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-signals"  text:visited-style-name="Visited_20_Internet_20_Link">signal d&#8217;arrÃªt</text:a>
â€“ en utilisant la combinaison de touches <text:span text:style-name="Menu">[Ctrl+C]</text:span> par exemple.
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">AccÃ©dez au serveur HTTP en ouvrant un navigateur web comme Firefox ou Chrome
puis en inscrivant <text:span text:style-name="CodeDansTexte"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://localhost:4000" text:visited-style-name="Visited_20_Internet_20_Link">http://localhost:4000</text:a></text:span> dans la barre d&#8217;adresses.
Dirigez ensuite le navigateur vers <text:span text:style-name="CodeDansTexte"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://localhost:4000/test" text:visited-style-name="Visited_20_Internet_20_Link">http://localhost:4000/test</text:a></text:span> et observez les
changements.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Pratique</text:span> Parler au serveur depuis le terminal</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">La commande Unix <text:span text:style-name="CodeDansTexte">curl</text:span> sait envoyer des requÃªtes HTTP.
On peut l&#8217;utiliser pour lire les rÃ©ponses de notre serveur&#160;:</text:p>
<text:p text:style-name="RemarqueCode">$ curl -i http://localhost:4000/test</text:p><text:p text:style-name="RemarqueCode">$ curl -i -XHEAD http://localhost:4000/test</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">L&#8217;option&#160;<text:span text:style-name="CodeDansTexte">-i</text:span> affiche les en-tÃªtes de rÃ©ponse.
C&#8217;est l&#8217;Ã©quivalent de <text:span text:style-name="CodeDansTexte">response.headers</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">On a posÃ© les bases d&#8217;un serveur HTTP minimaliste sur lequel on pourra
construire pas Ã  pas tout type d&#8217;application web.
Que manque-t-il pour en faire un serveur web&#160;?
Il faut encore typer les ressources renvoyÃ©es afin qu&#8217;elles soient comprises
par un navigateur, c&#8217;est-Ã -dire signaler que nos rÃ©ponses
contiennent du HTML, du CSS, des images, etc.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Modifions notre exemple prÃ©cÃ©dent pour renvoyer du&#160;HTML&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">http/web-server.js</text:p><text:p text:style-name="Code">const http = require('http');</text:p><text:p text:style-name="Code">const server = http.createServer();</text:p><text:p text:style-name="Code">server.listen(4000, 'localhost');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">server.on('request', (request, response) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.write('&lt;h1&gt;Salut Ã  toi&lt;/h1&gt;');</text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.end();</text:p><text:p text:style-name="Code">});</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Important</text:span> La fonction <text:span text:style-name="CodeDansTexte">response.end()</text:span></text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">L&#8217;appel de la fonction <text:span text:style-name="CodeDansTexte">response.end()</text:span> est impÃ©ratif.
Sinon, le client&#160;â€“ ici, le navigateur&#160;â€“ pense que des donnÃ©es vont encore arriver.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Si on supprime l&#8217;appel Ã  <text:span text:style-name="CodeDansTexte">response.end()</text:span> dans l&#8217;exemple prÃ©cÃ©dent,
l&#8217;indicateur de chargement du navigateur sera actif pendant deux minutes,
suite Ã  quoi Node interrompra la connexion, considÃ©rant qu&#8217;elle met trop
de temps pour aboutir.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dirigeons notre navigateur vers <text:span text:style-name="CodeDansTexte"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://localhost:4000" text:visited-style-name="Visited_20_Internet_20_Link">http://localhost:4000</text:a></text:span> pour observer
le rÃ©sultat.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-04/images/web-server.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>4-undefined.</text:span> Rendu navigateur de l&#8217;exemple <text:span text:style-name="CodeDansTexte">http/web-server.js</text:span></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La balise HTML&#160;<text:span text:style-name="CodeDansTexte">&lt;h1&gt;</text:span> a bien Ã©tÃ© prise en compte, mais le
caractÃ¨re&#160;<text:span text:style-name="CodeDansTexte">Ã </text:span> n&#8217;a pas Ã©tÃ© compris par le navigateur, qui affiche <text:span text:style-name="CodeDansTexte">Ãƒ&#160;</text:span>.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Si le serveur distant ne prÃ©cise pas l&#8217;encodage des caractÃ¨res,
le navigateur l&#8217;interprÃ¨te en <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-ascii"  text:visited-style-name="Visited_20_Internet_20_Link">ASCII</text:a>.
undefined
Or, les Ã©diteurs de code enregistrent les fichiers avec un autre encodage&#160;: UTF-8.
Ce standard englobe les alphabets du monde entier, dont les accents et
signes diacritiques de la langue franÃ§aise.
undefined</text:p>
<text:bookmark text:name="ref-ascii" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Histoire</text:span> American Standard Code for Information Interchange&#160;(ASCII)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Au dÃ©but de l&#8217;informatique contemporaire, les systÃ¨mes Ã©taient conÃ§us
pour comprendre l&#8217;alphabet anglais, les signes de ponctuations et
des caractÃ¨res spÃ©ciaux.
On parle alors de standard d&#8217;encodage&#160;ASCII.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">L&#8217;Ã©mergence d&#8217;Internet et du World&#160;Wide&#160;Web ont popularisÃ© l&#8217;encodage UTF-8
afin d&#8217;exprimer de maniÃ¨re commune les caractÃ¨res spÃ©ciaux de toutes les
langues du monde entier.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Pour indiquer aux navigateurs web quel est l&#8217;encodage utilisÃ©,
le protocole HTTP dispose de l&#8217;en-tÃªte <text:span text:style-name="CodeDansTexte">Content-Type</text:span>&#160;:
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">http/web-server-ok.js</text:p><text:p text:style-name="Code">const http = require('http');</text:p><text:p text:style-name="Code">const server = http.createServer();</text:p><text:p text:style-name="Code">server.listen(4000, 'localhost');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">server.on('request', (request, response) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const content_type = 'text/html; charset=utf-8';</text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.setHeader('Content-Type', content_type); <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.write('&lt;h1&gt;Salut Ã  toi&lt;/h1&gt;');</text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.end();</text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> L&#8217;en-tÃªte HTTP <text:span text:style-name="CodeDansTexte">Content-Type</text:span> indique explicitement que le contenu transfÃ©rÃ© est du HTML, encodÃ© en&#160;UTF-8.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette indication suffit au navigateur pour dÃ©coder les caractÃ¨res
et les afficher comme on l&#8217;espÃ©rait.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-04/images/web-server-ok.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>4-undefined.</text:span> Rendu navigateur de l&#8217;exemple <text:span text:style-name="CodeDansTexte">http/web-server-ok.js</text:span></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;Ã©tape suivante consisterait Ã  transmettre deux contenus diffÃ©rents selon
l&#8217;URL demandÃ©e, par exemple, une page HTML et un fichier CSS pour l&#8217;habiller.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">http/web-server-routes.js</text:p><text:p text:style-name="Code">const http = require('http');</text:p><text:p text:style-name="Code">const server = http.createServer();</text:p><text:p text:style-name="Code">server.listen(4000, 'localhost');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">server.on('request', (request, response) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>if (request.url === '/main.css') {<text:s text:c="21"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>response.setHeader('Content-Type', 'text/css');<text:s text:c="6"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>response.write('body{ font-size: 18px; color: blue; }');</text:p><text:p text:style-name="Code"><text:s text:c="4"/>response.end();</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code"><text:s text:c="2"/>else {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>const content_type = 'text/html; charset=utf-8';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="4"/>response.setHeader('Content-Type', content_type);</text:p><text:p text:style-name="Code"><text:s text:c="4"/>response.write('&lt;link rel="stylesheet" href="/main.css"&gt;');</text:p><text:p text:style-name="Code"><text:s text:c="4"/>response.end('&lt;h1&gt;Salut Ã  toi&lt;/h1&gt;');</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Si la requÃªte entrante indique <text:span text:style-name="CodeDansTexte">/main.css</text:span> comme chemin, alors on lui renvoie du contenu interprÃ©table comme du&#160;CSS.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> On indique au client que ce contenu est du texte contenant une feuille de styles&#160;CSS.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Si tout se passe bien, le chargement de la page HTML devrait dÃ©clencher
une requÃªte vers <text:span text:style-name="CodeDansTexte"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://localhost:4000/main.css" text:visited-style-name="Visited_20_Internet_20_Link">http://localhost:4000/main.css</text:a></text:span>.
Nous en avons la confirmation visuelle en visitant le serveur grÃ¢ce Ã  un
navigateur&#160;web&#160;:</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-04/images/web-server-routes.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>4-undefined.</text:span> Rendu navigateur de l&#8217;exemple <text:span text:style-name="CodeDansTexte">http/web-server-routes.js</text:span></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">On est en situation de contrÃ´le&#160;: on dÃ©cide de ce qu&#8217;on rÃ©pond.
C&#8217;est une maniÃ¨re d&#8217;apprendre petit Ã  petit comment fonctionne
le protocole HTTP sur lequel repose une majoritÃ© de notre activitÃ© sur Internet.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">On a couvert les principes du module&#160;<text:span text:style-name="CodeDansTexte">http</text:span>, mais il reste beaucoup de choses
Ã  apprendre pour dÃ©velopper une application web maintenable.
Ce sera le sujet du <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-../chapter-07/index.adoc"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;7</text:a>,
aidÃ© par les <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-modules"  text:visited-style-name="Visited_20_Internet_20_Link">modules&#160;<text:span text:style-name="CodeDansTexte">npm</text:span></text:a> que l&#8217;on apprendra
Ã  manipuler dans le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-05"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;5</text:a>.</text:p>
<text:bookmark text:name="ref-http.Server" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">server.close()</text:span></text:h>
<text:p text:style-name="Remarque">ArrÃªte l&#8217;Ã©coute de nouvelles connexions.
Les connexions existantes sont maintenues jusqu&#8217;Ã  ce qu&#8217;elles soient honorÃ©es.</text:p><text:bookmark text:name="ref-http.Server" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">server.listen()</text:span></text:h>
<text:p text:style-name="Remarque">DÃ©marre l&#8217;acceptation des connexions sur un port et une adresse donnÃ©s.
CombinÃ©e avec <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-os"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">os.networkInterfaces()</text:span></text:a>, vous pourriez choisir
sur quelle carte/adresse rÃ©seau Ã©couter les requÃªtes entrantes.</text:p><text:bookmark text:name="ref-http.Server" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">server.on('close')</text:span></text:h>
<text:p text:style-name="Remarque">Se dÃ©clenche lorsque le serveur s&#8217;arrÃªte et a terminÃ© d&#8217;honorer toutes les
connexions dÃ©jÃ  ouvertes.</text:p><text:bookmark text:name="ref-http.Server" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">server.on('connection')</text:span></text:h>
<text:p text:style-name="Remarque">Se dÃ©clenche lorsqu&#8217;une nouvelle connexion rÃ©seau est Ã©tablie.</text:p><text:bookmark text:name="ref-http.Server" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">server.on('request')</text:span></text:h>
<text:p text:style-name="Remarque">Se dÃ©clenche lorsqu&#8217;une nouvelle requÃªte entrante est adressÃ©e au serveur.</text:p><text:bookmark text:name="ref-http.Server" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">server.on('upgrade')</text:span></text:h>
<text:p text:style-name="Remarque">Se dÃ©clenche lorsqu&#8217;une requÃªte entrante demande un changement de protocole.
UtilisÃ©e pour basculer vers HTTP/2 et
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-io-websocket"  text:visited-style-name="Visited_20_Internet_20_Link">WebSocket</text:a>.</text:p><text:bookmark text:name="ref-http.Server" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">response.on('close')</text:span></text:h>
<text:p text:style-name="Remarque">Se dÃ©lenche lorsque la requÃªte a Ã©tÃ© terminÃ©e par le client,
avant qu&#8217;on ait pu transmettre l&#8217;intÃ©gralitÃ© des donnÃ©es.</text:p><text:bookmark text:name="ref-http.Server" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">response.on('finish')</text:span></text:h>
<text:p text:style-name="Remarque">Se dÃ©lenche aprÃ¨s l&#8217;envoi du dernier morceau de donnÃ©es.</text:p><text:bookmark text:name="ref-http.Server" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">response.end()</text:span></text:h>
<text:p text:style-name="Remarque">Signale au client que nous n&#8217;avons plus de donnÃ©es Ã  transmettre.</text:p><text:bookmark text:name="ref-http.Server" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">response.getHeader()</text:span></text:h>
<text:p text:style-name="Remarque">Retourne la valeur d&#8217;un en-tÃªte de la rÃ©ponse.</text:p><text:bookmark text:name="ref-http.Server" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">response.removeHeader()</text:span></text:h>
<text:p text:style-name="Remarque">Supprime un en-tÃªte de la rÃ©ponse.</text:p><text:bookmark text:name="ref-http.Server" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">response.setHeader()</text:span></text:h>
<text:p text:style-name="Remarque">Affecte une valeur Ã  un en-tÃªte de la rÃ©ponse.</text:p><text:bookmark text:name="ref-http.Server" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">response.write()</text:span></text:h>
<text:p text:style-name="Remarque">Transmet un morceau de donnÃ©es au client.</text:p><text:bookmark text:name="ref-http.Server" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">response.writeHead()</text:span></text:h>
<text:p text:style-name="Remarque">Transmet le code de rÃ©ponse et un ensemble d&#8217;en-tÃªtes au client.</text:p><text:bookmark text:name="ref-http.Server" /><text:h text:style-name="RemarqueTitre">Attribut <text:span text:style-name="CodeDansTexte">response.statusCode</text:span></text:h>
<text:p text:style-name="Remarque">  Contient le code de rÃ©ponse qui sera transmis au client.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> Module http</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">La documentation du module <text:span text:style-name="CodeDansTexte">http</text:span> est disponible sur le site officiel de Node&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://nodejs.org/docs/latest-v10.x/api/http.html" text:visited-style-name="Visited_20_Internet_20_Link">https://nodejs.org/docs/latest-v10.x/api/http.html</text:a></text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-os" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">os : en savoir plus sur les capacitÃ©s de l&#8217;ordinateur</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le module&#160;<text:span text:style-name="CodeDansTexte">os</text:span> donne des informations sur l&#8217;environnement systÃ¨me dans lequel
le script est exÃ©cutÃ©.
Cela permet par exemple de <text:span text:style-name="T7">prendre des dÃ©cisions par rapport aux ressources disponibles</text:span>
(mÃ©moire, CPU, rÃ©seau) et par rapport au systÃ¨me d&#8217;exploitation (Windows, Linux, macOS).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">os/intro.js</text:p><text:p text:style-name="Code">const os = require('os');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {username} = os.userInfo();</text:p><text:p text:style-name="Code">const cpus = os.cpus().length;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(</text:p><text:p text:style-name="Code"><text:s text:c="2"/>`Salut ${username}, cet ordinateur a ${cpus} CPU.` <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">);</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche un message comme <text:span text:style-name="CodeDansTexte">Salut anonymous, cet ordinateur a 4&#160;CPU</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Node a pour vocation de nous abstraire du systÃ¨me d&#8217;exploitation
en faisant en sorte que notre code fonctionne partout de la mÃªme faÃ§on.
Pourtant, des situations nous obligent Ã  prendre en compte certains critÃ¨res
pour dÃ©terminer un choix.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Par exemple, lister les applications installÃ©es sur l&#8217;ordinateur dÃ©pend
du systÃ¨me&#160;; leur emplacement d&#8217;installation est diffÃ©rent sous Linux, Windows
et macOS.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">os/apps.js</text:p><text:p text:style-name="Code">const {type} = require('os');</text:p><text:p text:style-name="Code">const {readdir} = require('fs');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const log = (error, modules) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>return error</text:p><text:p text:style-name="Code"><text:s text:c="4"/>? console.error(error.message)</text:p><text:p text:style-name="Code"><text:s text:c="4"/>: console.log(modules);</text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">switch (type()) {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>case 'Windows_NT': readdir('C:\\Program Files', log); break;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>case 'Linux':<text:s text:c="6"/>readdir('/usr/bin', log);<text:s text:c="10"/>break;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>case 'Darwin':<text:s text:c="5"/>readdir('/Applications', log);<text:s text:c="5"/>break;</text:p><text:p text:style-name="Code">}</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exemple prÃ©cÃ©dent se base sur la valeur retournÃ©e par la fonction <text:span text:style-name="CodeDansTexte">os.type()</text:span>
afin de choisir le rÃ©pertoire Ã  lister.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">On pourrait combiner ce mÃ©canisme avec le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-child_process"  text:visited-style-name="Visited_20_Internet_20_Link">module <text:span text:style-name="CodeDansTexte">child_process</text:span></text:a>,
pour appeler une application systÃ¨me diffÃ©rente et parvenir Ã  un rÃ©sultat similaire.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ã€ l&#8217;inverse, on peut <text:span text:style-name="T7">accÃ©der Ã  une ressource de maniÃ¨re uniforme</text:span>, peu importe
le nom du compte utilisateur ou du type de systÃ¨me d&#8217;exploitation.
Nous allons maintenant lire le contenu du fichier <text:span text:style-name="CodeDansTexte">.npmrc</text:span>,
le fichier de configuration de
l'<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-cli"  text:visited-style-name="Visited_20_Internet_20_Link">exÃ©cutable&#160;npm</text:a>&#160;:
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">os/npmrc.js</text:p><text:p text:style-name="Code">const {homedir} = require('os');</text:p><text:p text:style-name="Code">const {readFile} = require('fs');</text:p><text:p text:style-name="Code">const {join} = require('path');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const file = join(homedir(), '.npmrc');<text:s text:c="5"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">readFile(file, (error, content='') =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>if (error &amp;&amp; error.code !== 'ENOENT') {<text:s text:c="3"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>return console.log(error);</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log(String(content));</text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Construit un chemin sans connaissance prÃ©alable du systÃ¨me d&#8217;exploitation sur lequel tournera le script&#160;: par exemple <text:span text:style-name="CodeDansTexte">C:\Users\anonymous\.npmrc</text:span> pour Windows, <text:span text:style-name="CodeDansTexte">/Users/anonymous/.npmrc</text:span> pour macOS et <text:span text:style-name="CodeDansTexte">/home/anonymous/.npmrc</text:span> pour Linux.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> <text:span text:style-name="CodeDansTexte">ENOENT</text:span> est un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-fs.errors"  text:visited-style-name="Visited_20_Internet_20_Link">code d&#8217;erreur</text:a> indiquant que le fichier n&#8217;existe pas&#160;; on se permet de l&#8217;ignorer et de considÃ©rer que le fichier est vide.
undefined<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">os.arch()</text:span></text:h>
<text:p text:style-name="Remarque">Retourne l&#8217;architecture CPU.
Les valeurs les plus courantes sont gÃ©nÃ©ralement <text:span text:style-name="CodeDansTexte">x64</text:span>, <text:span text:style-name="CodeDansTexte">arm</text:span> et&#160;<text:span text:style-name="CodeDansTexte">arm64</text:span>.
undefined</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">os.cpus()</text:span></text:h>
<text:p text:style-name="Remarque">Retourne un tableau contenant des informations Ã  propos de la ou des CPU.
Entre autres, on retrouve leur modÃ¨le, leur frÃ©quence et
le temps passÃ© en attente ou en action depuis le dÃ©marrage de l&#8217;ordinateur.
undefined</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">os.homedir()</text:span></text:h>
<text:p text:style-name="Remarque">Retourne le chemin vers le rÃ©pertoire utilisateur.
Ã‰quivalent de la variable <text:span text:style-name="CodeDansTexte">$HOME</text:span> sous Unix et <text:span text:style-name="CodeDansTexte">%USERPROFILE%</text:span> ou <text:span text:style-name="CodeDansTexte">%AppData%</text:span>
sous Windows.
undefined</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">os.hostname()</text:span></text:h>
<text:p text:style-name="Remarque">Retourne l&#8217;identifiant rÃ©seau de la machine.
undefined</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">os.networkInterfaces()</text:span></text:h>
<text:p text:style-name="Remarque">Retourne un tableau contenant des informations Ã  propos de la ou des
carte(s) rÃ©seau de l&#8217;ordinateur.
Entre autres, on retrouve l&#8217;adresse&#160;IP (IPv4, IPv6), l&#8217;adresse MAC
et le masque rÃ©seau.
undefined</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">os.platform()</text:span></text:h>
<text:p text:style-name="Remarque">Retourne la nature du systÃ¨me d&#8217;exploitation.
Les valeurs les plus courantes sont gÃ©nÃ©ralement <text:span text:style-name="CodeDansTexte">win32</text:span>, <text:span text:style-name="CodeDansTexte">linux</text:span>, <text:span text:style-name="CodeDansTexte">darwin</text:span>
et <text:span text:style-name="CodeDansTexte">freebsd</text:span>.
undefined</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">os.tmpdir()</text:span></text:h>
<text:p text:style-name="Remarque">Retourne l&#8217;emplacement du rÃ©pertoire temporaire fourni par
le systÃ¨me d&#8217;exploitation.
undefined</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">os.type()</text:span></text:h>
<text:p text:style-name="Remarque">Retourne une forme normalisÃ©e de la nature du systÃ¨me d&#8217;exploitation,
Ã©quivalent Ã  ce que retournerait la commande Unix <text:span text:style-name="CodeDansTexte">uname -s</text:span>.
Les valeurs les plus courantes sont gÃ©nÃ©ralement
<text:span text:style-name="CodeDansTexte">Windows_NT</text:span>, <text:span text:style-name="CodeDansTexte">Linux</text:span>, <text:span text:style-name="CodeDansTexte">Darwin</text:span> et <text:span text:style-name="CodeDansTexte">FreeBSD</text:span>.
undefined</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Attribut <text:span text:style-name="CodeDansTexte">os.constants</text:span></text:h>
<text:p text:style-name="Remarque">Objet contenant la liste des <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-signals"  text:visited-style-name="Visited_20_Internet_20_Link">signaux systÃ¨me</text:a> et des codes d&#8217;erreur.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Attribut <text:span text:style-name="CodeDansTexte">os.EOL</text:span></text:h>
<text:p text:style-name="Remarque">CaractÃ¨re utilisÃ© pour marquer les fins de ligne.
En gÃ©nÃ©ral le caractÃ¨re&#160;<text:span text:style-name="CodeDansTexte">\n</text:span> sous Unix et <text:span text:style-name="CodeDansTexte">\r\n</text:span> sous Windows.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> Module os</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">La documentation du module&#160;<text:span text:style-name="CodeDansTexte">os</text:span> est disponible sur le site officiel de Node&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://nodejs.org/docs/latest-v10.x/api/os.html" text:visited-style-name="Visited_20_Internet_20_Link">https://nodejs.org/docs/latest-v10.x/api/os.html</text:a></text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-child_process" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">child_process : appeler un exÃ©cutable systÃ¨me</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le module <text:span text:style-name="CodeDansTexte">child_process</text:span> exÃ©cute des programmes externes,
leur transmet des donnÃ©es et consulte leurs rÃ©sultats via
les <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process.std"  text:visited-style-name="Visited_20_Internet_20_Link">flux standards</text:a>.
undefined
undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">child_process/intro.js</text:p><text:p text:style-name="Code">const {exec} = require('child_process');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">exec('npm --version', (error, stdout, stderr) =&gt; {<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log(`npm version ${stdout.trim()}`);<text:s text:c="6"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> ExÃ©cute la commande exÃ©cute la fonction de rappel, avec comme arguments la <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process.std"  text:visited-style-name="Visited_20_Internet_20_Link">sortie standard</text:a> et la <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process.std"  text:visited-style-name="Visited_20_Internet_20_Link">sortie erreur</text:a> du processus enfant.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">npm version 6.4.0</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;utilisation du module <text:span text:style-name="CodeDansTexte">child_process</text:span> se justifie quand un programme
externe fournit une fonctionnalitÃ© mais ne s&#8217;interface pas avec Node,
ou encore quand on veut sortir l&#8217;exÃ©cution d&#8217;un script Node du processus courant
pour tirer parti des autres CPU de l&#8217;ordinateur sans ralentir l&#8217;application principale.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La fonction <text:span text:style-name="CodeDansTexte">child_process.exec()</text:span> accepte un deuxiÃ¨me argument optionnel.
<text:span text:style-name="CodeDansTexte">cwd</text:span> (<text:span text:style-name="T4">current working directory</text:span>) en est une des options utiles.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">child_process/ls.js</text:p><text:p text:style-name="Code">const {exec} = require('child_process');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">exec('ls .', {cwd: null}, (error, stdout, stderr) =&gt; {<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log(stdout);</text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> On lance la commande systÃ¨me&#160;<text:span text:style-name="CodeDansTexte">ls</text:span> sans spÃ©cifier le rÃ©pertoire de travail.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">ExÃ©cutons le script pour observer le rÃ©sultat&#160;:</text:p>
<text:p text:style-name="Code">$ node child_process/ls.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le constat est similaire Ã  celui produit avec le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-fs"  text:visited-style-name="Visited_20_Internet_20_Link">module&#160;<text:span text:style-name="CodeDansTexte">fs</text:span></text:a>&#160;:
les fichiers listÃ©s sont ceux du <text:span text:style-name="T4">rÃ©pertoire courant</text:span>,
notre emplacement dans le terminal.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Modifions maintenant la valeur de l&#8217;option&#160;<text:span text:style-name="CodeDansTexte">cwd</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">child_process/ls-root.js</text:p><text:p text:style-name="Code">const {exec} = require('child_process');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">exec('ls .', {cwd: '/'}, (error, stdout, stderr) =&gt; { <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log(stdout);</text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> La valeur de&#160;<text:span text:style-name="CodeDansTexte">cwd</text:span> est rÃ©glÃ©e sur&#160;<text:span text:style-name="CodeDansTexte">/</text:span>, c&#8217;est-Ã -dire le rÃ©pertoire racine du systÃ¨me de fichiers.<text:line-break/></text:p>
<text:p text:style-name="Code">$ node child_process/ls-root.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La liste des fichiers et rÃ©pertoires affichÃ©s est dÃ©sormais diffÃ©rente,
mÃªme si la commande passÃ©e Ã  <text:span text:style-name="CodeDansTexte">child_process.exec()</text:span> est la mÃªme.
<text:span text:style-name="CodeDansTexte">cwd</text:span>&#160;a changÃ© le rÃ©pertoire courant l&#8217;espace d&#8217;une commande.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Performance</text:span> ls&#160;vs. fs.readdir</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
undefined
Si on arrive au mÃªme rÃ©sultat avec <text:span text:style-name="CodeDansTexte">exec('ls')</text:span>, pourquoi utiliser
la fonction <text:span text:style-name="CodeDansTexte">fs.readdir()</text:span> du <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-fs"  text:visited-style-name="Visited_20_Internet_20_Link">module&#160;<text:span text:style-name="CodeDansTexte">fs</text:span></text:a>&#160;?
Cette derniÃ¨re prÃ©sente au moins trois avantages&#160;:</text:p>
<text:p text:style-name="RemarqueNumero">1.<text:tab/>Elle est plus rapide&#160;â€“ Ã  Ã©crire, Ã  exÃ©cuter, Ã  diagnostiquer.</text:p><text:p text:style-name="RemarqueNumero">2.<text:tab/>On Ã©conomise la crÃ©ation d&#8217;un processus systÃ¨me.</text:p><text:p text:style-name="RemarqueNumero">3.<text:tab/>Elle est compatible avec tous les systÃ¨mes d&#8217;exploitation.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="CodeDansTexte">env</text:span>&#160;est une deuxiÃ¨me option Ã  passer Ã  <text:span text:style-name="CodeDansTexte">child_process.exec()</text:span>.
Elle redÃ©finit les <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process.env"  text:visited-style-name="Visited_20_Internet_20_Link">variables d&#8217;environnement</text:a> utilisables
par le processus enfant&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">child_process/ping.js</text:p><text:p text:style-name="Code">const {exec} = require('child_process');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const env = {PING_COUNT: 1, ...process.env};<text:s text:c="4"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">const cmd = 'ping -c $PING_COUNT oncletom.io';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">exec(cmd, {env}, (error, stdout) =&gt; {<text:s text:c="11"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>return error</text:p><text:p text:style-name="Code"><text:s text:c="4"/>? console.error(error)</text:p><text:p text:style-name="Code"><text:s text:c="4"/>: console.log(stdout);</text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> On transmet les variables d&#8217;environnement existantes au processus enfant.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Utilisation de la variable d&#8217;environnement <text:span text:style-name="CodeDansTexte">PING_COUNT</text:span> comme valeur d&#8217;option du programme&#160;<text:span text:style-name="CodeDansTexte">ping</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Si on ne transmettait pas les valeurs de <text:span text:style-name="CodeDansTexte">process.env</text:span> au processus enfant,
la variable d&#8217;environnement <text:span text:style-name="CodeDansTexte">PATH</text:span> ne serait pas dÃ©finie.
undefined
Le processus enfant ne saurait plus oÃ¹ chercher l&#8217;exÃ©cutable&#160;<text:span text:style-name="CodeDansTexte">ping</text:span>.<text:line-break/>On aurait pu appeler le programme <text:span text:style-name="CodeDansTexte">ping</text:span> en utilisant un chemin absolu comme
<text:span text:style-name="CodeDansTexte">/sbin/ping</text:span> mais son emplacement varie selon les systÃ¨mes d&#8217;exploitation.</text:p>
<text:p text:style-name="Code">$ node child_process/ping.js</text:p><text:p text:style-name="Code">PING oncletom.io (185.31.40.11): 56 data bytes</text:p><text:p text:style-name="Code">64 bytes from 185.31.40.11: icmp_seq=0 ttl=56 time=23.763 ms</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">--- oncletom.io ping statistics ---</text:p><text:p text:style-name="Code">1 packets transmitted, 1 packets received, 0.0% packet loss</text:p><text:p text:style-name="Code">round-trip min/avg/max/stddev = 23.763/23.763/23.763/0.000 ms</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">CompatibilitÃ©</text:span> Mon programme ne fonctionne pas sous Windows/Linux/macOS</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Le programme externe peut ne pas exister sur tous les systÃ¨mes d&#8217;exploitation,
ou ne pas s&#8217;appeler avec les mÃªmes arguments, ni avec le mÃªme&#160;nom.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Une des solutions consiste Ã  se reposer sur le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-os"  text:visited-style-name="Visited_20_Internet_20_Link">module&#160;<text:span text:style-name="CodeDansTexte">os</text:span></text:a>
et adapter la commande en fonction du systÃ¨me d&#8217;exploitation.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="CodeDansTexte">child_process.spawn()</text:span> est une autre approche de dÃ©marrage
et de communication avec un processus externe.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">child_process/spawn.js</text:p><text:p text:style-name="Code">const {spawn} = require('child_process');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const subprocess = spawn('cat', ['package.json']);<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">subprocess.stdout.on('data', (data) =&gt; {<text:s text:c="12"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log(String(data));<text:s text:c="24"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> <text:span text:style-name="CodeDansTexte">cat</text:span>&#160;est un programme qui affiche le contenu d&#8217;un fichier&#160;â€“ un peu comme <text:span text:style-name="CodeDansTexte">fs.readFile</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Les donnÃ©es retournÃ©es par la commande externe se lisent depuis les <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process.std"  text:visited-style-name="Visited_20_Internet_20_Link">flux de sortie</text:a>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche le contenu du fichier <text:span text:style-name="CodeDansTexte">package.json</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les arguments et options Ã  transmettre au programme sont passÃ©s dans un tableau.
Dans le programme externe, on y accÃ¨de avec <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process.argv"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">process.argv</text:span></text:a>.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Pour transmettre un volume de donnÃ©es plus important en paramÃ¨tre,
il vaut mieux faire appel Ã  la propriÃ©tÃ© <text:span text:style-name="CodeDansTexte">stdin</text:span>.
C&#8217;est un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-stream"  text:visited-style-name="Visited_20_Internet_20_Link">flux d&#8217;Ã©criture</text:a> dont le fonctionnement est identique
Ã  <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process.std"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">process.stdin</text:span></text:a>.
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">child_process/spawn-stdin.js</text:p><text:p text:style-name="Code">const {spawn} = require('child_process');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const subprocess = spawn('tr', ['0-9a-f', 'a-p']);</text:p><text:p text:style-name="Code">subprocess.stdout.on('data', (data) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log(String(data));<text:s text:c="14"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">subprocess.stdin.write('0123 abcd');<text:s text:c="6"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">subprocess.stdin.end();<text:s text:c="19"/><text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Ã‰crit <text:span text:style-name="CodeDansTexte">0123 abcd</text:span> dans le flux d&#8217;entrÃ©e.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Signale au processus externe qu&#8217;il n&#8217;aura plus de donnÃ©e&#160;â€“ le programme&#160;<text:span text:style-name="CodeDansTexte">tr</text:span> rendra la main dÃ¨s qu&#8217;il nous aura tout transmis.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche <text:span text:style-name="CodeDansTexte">abcd klmn</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">tr</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://fr.wikipedia.org/wiki/Tr_(Unix" text:visited-style-name="Visited_20_Internet_20_Link">https://fr.wikipedia.org/wiki/Tr_(Unix</text:a>)</text:span>)
remplace des plages de caractÃ¨res.
On lui a transmis des caractÃ¨res en entrÃ©e et spÃ©cifiÃ© les plages de traduction
en arguments.
Nous avons utilisÃ© la <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process.std"  text:visited-style-name="Visited_20_Internet_20_Link">sortie standard</text:a> pour lire les rÃ©sultats.
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exemple prÃ©cÃ©dent revient au mÃªme que la commande suivante&#160;:</text:p>
<text:p text:style-name="Code">$ echo -n '0123 abcd' | tr 0-9a-f a-p</text:p><text:p text:style-name="Code">abcd klmn</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans ce cas prÃ©cis, je trouve que l&#8217;instruction en ligne de commande est plus
concise que l&#8217;utilisation d&#8217;un script Node faisant appel Ã  <text:span text:style-name="CodeDansTexte">child_process.spawn()</text:span>.
J&#8217;aurais plutÃ´t tendance Ã  transmettre le rÃ©sultat de cette commande
Ã  l'<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process.std"  text:visited-style-name="Visited_20_Internet_20_Link">entrÃ©e standard</text:a> d&#8217;un script Node.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">child_process.exec()</text:span></text:h>
<text:p text:style-name="Remarque">ExÃ©cute une commande et retourne son rÃ©sultat.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">child_process.spawn()</text:span></text:h>
<text:p text:style-name="Remarque">ExÃ©cute une commande et retourne un objet <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process"  text:visited-style-name="Visited_20_Internet_20_Link">processus</text:a>.
Le script Node et le nouveau processus peuvent communiquer entre eux.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">process.on('message')</text:span></text:h>
<text:p text:style-name="Remarque">Se dÃ©clenche lorsque le processus enfant reÃ§oit un message envoyÃ© par l&#8217;autre script.
undefined</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">process.kill()</text:span></text:h>
<text:p text:style-name="Remarque">Envoie un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-signals"  text:visited-style-name="Visited_20_Internet_20_Link">signal d&#8217;arrÃªt</text:a> au processus enfant.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">process.send()</text:span></text:h>
<text:p text:style-name="Remarque">Envoie un message au processus enfant.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">process.stdin</text:span>, <text:span text:style-name="CodeDansTexte">process.stdout</text:span>, <text:span text:style-name="CodeDansTexte">process.stderr</text:span></text:h>
<text:p text:style-name="Remarque"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process.std"  text:visited-style-name="Visited_20_Internet_20_Link">Flux standards</text:a> du processus enfant.
IdÃ©al pour envoyer et rÃ©cupÃ©rer des donnÃ©es en continu.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> Module child_process</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">La documentation du module <text:span text:style-name="CodeDansTexte">child_process</text:span> est disponible sur le site officiel de Node&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://nodejs.org/docs/latest-v10.x/api/child_process.html" text:visited-style-name="Visited_20_Internet_20_Link">https://nodejs.org/docs/latest-v10.x/api/child_process.html</text:a></text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-process" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">process : en savoir plus sur le processus en cours</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La module <text:span text:style-name="CodeDansTexte">process</text:span> retourne des informations
sur l&#8217;environnement dans lequel le script est exÃ©cutÃ©.
Ã€ l&#8217;instar de <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-console"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">console</text:span></text:a>, la variable <text:span text:style-name="CodeDansTexte">process</text:span>
est globale.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">process/intro.js</text:p><text:p text:style-name="Code">const variables = Object.keys(process.env);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(variables);<text:s text:c="21"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(process.argv);<text:s text:c="18"/><text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche quelque chose comme <text:span text:style-name="CodeDansTexte">['LANG', 'SHELL', 'PATH', 'HOME', 'USER', â€¦]</text:span>&#160;â€“ voir plus bas, les <text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process.env"  text:visited-style-name="Visited_20_Internet_20_Link">variables d&#8217;environnement</text:a></text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">[ '&#8230;&#8203;/v10.9.0/bin/node', '&#8230;&#8203;/chapter-04/examples/process/intro.js' ]</text:span>&#160;â€“ voir plus bas, les <text:span text:style-name="">&#160;<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process.argv"  text:visited-style-name="Visited_20_Internet_20_Link">arguments d&#8217;exÃ©cution</text:a></text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Notre code peut Ãªtre interprÃ©tÃ© par Node
sur plusieurs types de machines
(ordinateur rÃ©cent ou fatiguÃ©, Raspberry&#160;Pi, etc.) et sur diffÃ©rents
systÃ¨mes d&#8217;exploitation (Windows, Linux, macOS, etc.).
Nous avons avec le module <text:span text:style-name="CodeDansTexte">process</text:span> tout le loisir d&#8217;adapter nos scripts
Ã  ces diverses conditions.</text:p>
<text:bookmark text:name="ref-process.env" /><text:p text:style-name="TexteCourant">Les variables d&#8217;environnement sont <text:span text:style-name="T7">dÃ©finies au niveau du systÃ¨me d&#8217;exploitation</text:span>.
Elles contiennent des informations comme le rÃ©pertoire courant, la langue du
systÃ¨me d&#8217;exploitation, l&#8217;utilisateur systÃ¨me courant, le type de terminal,
les emplacements d&#8217;installation des exÃ©cutables, etc.
undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">On retrouve ces variables sous la forme d&#8217;un
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-object"  text:visited-style-name="Visited_20_Internet_20_Link">objet ECMAScript</text:a> nommÃ© <text:span text:style-name="CodeDansTexte">process.env</text:span>&#160;:</text:p>
<text:p text:style-name="Code">$ node -p 'process.env'</text:p><text:p text:style-name="Code">{ ITERM_PROFILE: 'Default',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>LANG: 'en_GB.UTF-8',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>PWD: '/Users/oncletom/workspace/nodebook',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>SHELL: '/bin/zsh',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>TERM_PROGRAM_VERSION: '3.1.5',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>TERM_PROGRAM: 'iTerm.app',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>...</text:p><text:p text:style-name="Code">}</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">En crÃ©ant des variables d&#8217;environnement, nous sommes en mesure de
<text:span text:style-name="T7">transmettre des informations contextuelles</text:span> Ã  nos programmes&#160;:
des chemins d&#8217;accÃ¨s Ã  une base de donnÃ©es, si on est en situation de test
ou de production, l&#8217;emplacement de fichiers nÃ©cessaires au fonctionnement
de notre programme, etc.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Par exemple et par convention, la variable <text:span text:style-name="CodeDansTexte">NODE_ENV</text:span> est utilisÃ©e pour indiquer au programme
s&#8217;il est lancÃ© dans le cadre du dÃ©veloppement, de l&#8217;exÃ©cution des tests
ou s&#8217;il tourne sur le serveur de production.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Variable d&#8217;environnement Ã©phÃ©mÃ¨re</text:h>
<text:p text:style-name="Remarque">undefined
La variable n&#8217;existe que pendant la durÃ©e de vie du programme.
La dÃ©finition <text:span text:style-name="CodeDansTexte">CLÃ‰=valeur</text:span> est placÃ©e sur la mÃªme ligne que le programme
en question.</text:p>
<text:p text:style-name="Code">$ NODE_ENV=production node process/env.js</text:p><text:p text:style-name="Code">mode : production</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Variable d&#8217;environnement permanente</text:h>
<text:p text:style-name="Remarque">undefined
La variable existe pendant la durÃ©e de la session
grÃ¢ce Ã  l&#8217;opÃ©rateur <text:span text:style-name="CodeDansTexte">export</text:span> sous Linux et macOS et
avec l&#8217;opÃ©rateur <text:span text:style-name="CodeDansTexte">set</text:span> sous Windows.<text:line-break/>
La dÃ©finition <text:span text:style-name="CodeDansTexte">export CLÃ‰=valeur</text:span> est placÃ©e sur sa propre ligne.
Elle restera accessible par tout programme jusqu&#8217;Ã  la fin de la session
ou jusqu&#8217;Ã  ce qu&#8217;on efface la variable.</text:p>
<text:p text:style-name="Code">$ export NODE_ENV=production</text:p><text:p text:style-name="Code">$ node process/env.js</text:p><text:p text:style-name="Code">mode : production</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Revenir en arriÃ¨re</text:span> Effacer une variable d&#8217;environnement</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
L&#8217;opÃ©rateur <text:span text:style-name="CodeDansTexte">unset</text:span> dans un terminal efface le contenu
d&#8217;une variable d&#8217;environnement.</text:p>
<text:p text:style-name="RemarqueCode">$ export NODE_ENV=dev</text:p><text:p text:style-name="RemarqueCode">$ echo $NODE_ENV</text:p><text:p text:style-name="RemarqueCode">$ unset NODE_ENV</text:p><text:p text:style-name="RemarqueCode">$ echo $NODE_ENV</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Voici le contenu du fichier <text:span text:style-name="CodeDansTexte">process/env.js</text:span> utilisÃ© dans les exemples prÃ©cÃ©dents&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">process/env.js</text:p><text:p text:style-name="Code">const {NODE_ENV} = process.env;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">if (NODE_ENV === 'dev') {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log('On est en mode dÃ©veloppement.');</text:p><text:p text:style-name="Code">}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log('mode : %s', NODE_ENV);</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">On notera que son comportement s&#8217;adapte Ã  la prÃ©sence et Ã  la valeur
de la variable d&#8217;environnement <text:span text:style-name="CodeDansTexte">NODE_ENV</text:span>.
Elle est accessible dans Node en tant que <text:span text:style-name="CodeDansTexte">process.env.NODE_ENV</text:span>.
undefined</text:p>
<text:p text:style-name="Code">$ NODE_ENV=dev node process/env.js</text:p><text:p text:style-name="Code">On est en mode dÃ©veloppement.</text:p><text:p text:style-name="Code">mode : dev</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous verrons d&#8217;autres mises en situation des variables d&#8217;environnement pour
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-configuration"  text:visited-style-name="Visited_20_Internet_20_Link">configurer une application</text:a>
dans le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-06"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;6</text:a> et pour
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-debug"  text:visited-style-name="Visited_20_Internet_20_Link">dÃ©boguer une application en ligne de commande</text:a>
dans le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-08"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;8</text:a>.</text:p>
<text:bookmark text:name="ref-process.argv" /><text:p text:style-name="TexteCourant">Les arguments d&#8217;exÃ©cution sont des morceaux d&#8217;information transmis
Ã  un script Node.
On les place Ã  droite du nom du fichier&#160;:
undefined</text:p>
<text:p text:style-name="Code">$ node print-first.js salut</text:p><text:p text:style-name="Code">"salut"</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">On utilise les arguments pour affiner le comportement d&#8217;un programme.
Je pense par exemple au numÃ©ro du port sur lequel lancer un serveur web,
une liste de fichiers Ã  traiter ou
encore des fonctionnalitÃ©s Ã  activer ou Ã  dÃ©sactiver.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il faut imaginer les arguments comme des paramÃ¨tres de fonction,
accessibles dans un programme Node dans
le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-array"  text:visited-style-name="Visited_20_Internet_20_Link">tableau</text:a> <text:span text:style-name="CodeDansTexte">process.argv</text:span>&#160;:
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">print-first.js</text:p><text:p text:style-name="Code">const [,,first_arg] = process.argv;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(first_arg);</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les deux premiers Ã©lÃ©ments de <text:span text:style-name="CodeDansTexte">process.argv</text:span> sont rarement utilisÃ©s.
Ils correspondent respectivement Ã  l&#8217;emplacement de l&#8217;exÃ©cutable Node
et Ã  l&#8217;emplacement du script.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Tous les autres arguments sont accessibles Ã  partir de l&#8217;index&#160;2 de
<text:span text:style-name="CodeDansTexte">process.argv</text:span>, dans l&#8217;ordre oÃ¹ ils sont placÃ©s&#160;:</text:p>
<text:p text:style-name="Code">$ node print-first.js salut Ã§a va ?</text:p><text:p text:style-name="Code">"salut"</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le script <text:span text:style-name="CodeDansTexte">print-first.js</text:span> affiche le premier argument.
On en conclut que les arguments sont sÃ©parÃ©s par le caractÃ¨re <text:span text:style-name="">espace</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans le cas oÃ¹ un argument doit contenir un espace, on l&#8217;encadre alors
de guillemets&#160;:</text:p>
<text:p text:style-name="Code">$ node print-first.js "salut Ã§a va ?" "oui et toi ?"</text:p><text:p text:style-name="Code">"salut Ã§a va ?"</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;inconvÃ©nient des arguments est que leur ordre compte
et qu&#8217;il devient difficile de connaÃ®tre leur rÃ´le sans se rÃ©fÃ©rer
au manuel d&#8217;utilisation.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">C&#8217;est lÃ  qu&#8217;interviennent les options.
Comme leur nom l&#8217;indique, ce sont des arguments optionnels.
Elles sont prÃ©fixÃ©es de deux traits d&#8217;union (<text:span text:style-name="CodeDansTexte">--</text:span>).
On leur associe ou non une valeur.</text:p>
<text:p text:style-name="Code">$ node print-text.js "salut Ã§a va ?" --uppercase</text:p><text:p text:style-name="Code">SALUT Ã‡A VA ?</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Quand on n&#8217;associe pas de valeur Ã  une option,
on considÃ¨re qu&#8217;elle Ã©quivaut Ã  un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-boolean"  text:visited-style-name="Visited_20_Internet_20_Link">boolÃ©en</text:a>
de valeur&#160;<text:span text:style-name="CodeDansTexte">true</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">print-text.js</text:p><text:p text:style-name="Code">let [,,text] = process.argv;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">if (process.argv.includes('--uppercase')) { <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>text = text.toLocaleUpperCase();</text:p><text:p text:style-name="Code">}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(text);</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> La condition est positive si l&#8217;on dÃ©tecte <text:span text:style-name="CodeDansTexte">--uppercase</text:span> dans la liste des arguments.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les options se combinent trÃ¨s bien avec les arguments.
Il faut les imaginer comme des interrupteurs.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans d&#8217;autres situations, on a besoin de passer une valeur Ã  une option&#160;:</text:p>
<text:p text:style-name="Code">$ node print-text-limit.js "salut Ã§a va ?" --limit 2</text:p><text:p text:style-name="Code">salut Ã§a</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exemple prÃ©cÃ©dent illustre la cÃ©sure d&#8217;une phrase aprÃ¨s deux&#160;mots
lorsque l&#8217;option <text:span text:style-name="CodeDansTexte">--limit</text:span> est associÃ©e Ã  la valeur&#160;`2`.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">print-text-limit.js</text:p><text:p text:style-name="Code">let [,,text] = process.argv;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const limitIndex = process.argv.indexOf('--limit');<text:s text:c="5"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">if (limitIndex &gt;= 2) {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const limitValue = process.argv[limitIndex + 1];<text:s text:c="6"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>text = text.split(' ').slice(0, limitValue).join(' ');<text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(text);</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> On rÃ©cupÃ¨re l&#8217;index de l&#8217;option <text:span text:style-name="CodeDansTexte">--limit</text:span> dans le tableau <text:span text:style-name="CodeDansTexte">process.argv</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> On rÃ©cupÃ¨re la valeur de l&#8217;Ã©lÃ©ment suivant <text:span text:style-name="CodeDansTexte">--limit</text:span> dans <text:span text:style-name="CodeDansTexte">process.argv</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> La troncature est paramÃ©trÃ©e en fonction de la valeur associÃ©e Ã  <text:span text:style-name="CodeDansTexte">--limit</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Au fond, <text:span text:style-name="T7">les options sont des repÃ¨res pour les utilisateurs</text:span> de nos programmes.
Elles leur permettent de s&#8217;interfacer avec leurs fonctionnalitÃ©s, un peu Ã  la
maniÃ¨re des diffÃ©rents boutons qu&#8217;on retrouve
en faÃ§ade d&#8217;une machine Ã  laver.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exemple suivant est totalement fictif, mais il illustre comment
on s&#8217;interfacerait avec une machine Ã  laver en ligne de commande&#160;:</text:p>
<text:p text:style-name="Code">$ machine-a-laver P-ECO 40 --fast --no-dry --room kitchen</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce qu&#8217;il faut en comprendre, c&#8217;est qu&#8217;on dÃ©marrerait la machine situÃ©e
dans la cuisine avec un programme Ã©conomique <text:span text:style-name="T4">et</text:span> Ã &#160;40Â°C,
en activant l&#8217;option rapide et en dÃ©sactivant l&#8217;option sÃ©chage.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous verrons d&#8217;autres mises en situation pour
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-argv"  text:visited-style-name="Visited_20_Internet_20_Link">passer des paramÃ¨tres Ã  une application en ligne de commande</text:a>
dans le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-08"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;8</text:a>.</text:p>
<text:bookmark text:name="ref-process.std" /><text:p text:style-name="TexteCourant">Chaque processus systÃ¨me est dotÃ© de trois flux de donnÃ©es&#160;:
le flux d&#8217;entrÃ©e (<text:span text:style-name="CodeDansTexte">stdin</text:span>), le flux de sortie (<text:span text:style-name="CodeDansTexte">stdout</text:span>)
et le flux d&#8217;erreur (<text:span text:style-name="CodeDansTexte">stderr</text:span>).
undefined
undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les flux standards peuvent Ãªtre alimentÃ©s pendant la durÃ©e de vie du processus
en utilisant peu de mÃ©moire.
On les utilisera pour passer le rÃ©sultat d&#8217;un autre programme
Ã  notre script Node, pour informer l&#8217;utilisateur de notre programme,
mais aussi pour consigner les erreurs.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Node expose ces flux standards via les variables <text:span text:style-name="CodeDansTexte">process.stdin</text:span> (entrÃ©e),
<text:span text:style-name="CodeDansTexte">process.stdout</text:span> (sortie) et <text:span text:style-name="CodeDansTexte">process.stderr</text:span> (erreur).
Chacune possÃ¨de des mÃ©thodes pour Ã©couter ce qui s&#8217;y passe,
pour y Ã©crire du contenu et pour <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-stream"  text:visited-style-name="Visited_20_Internet_20_Link">rediriger leur&#160;flux</text:a>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">CommenÃ§ons par l&#8217;utilisation de <text:span text:style-name="CodeDansTexte">process.stdout</text:span> pour Ã©crire un message
dans notre terminal&#160;:</text:p>
<text:p text:style-name="Code">$ node process/stdout.js</text:p><text:p text:style-name="Code">un deuxtrois</text:p><text:p text:style-name="Code">quatre</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le code source de <text:span text:style-name="CodeDansTexte">process/stdout.js</text:span> fait appel Ã  la fonction
<text:span text:style-name="CodeDansTexte">process.stdout.write()</text:span> par deux fois.
On notera que le caractÃ¨re&#160;<text:span text:style-name="CodeDansTexte">\n</text:span> symbolise un retour Ã  la ligne
(<text:span text:style-name="CodeDansTexte">\r\n</text:span> sous Windows)&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">process/stdout.js</text:p><text:p text:style-name="Code">process.stdout.write('un deux');</text:p><text:p text:style-name="Code">process.stdout.write('trois\nquatre');</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cela rappelle nos prÃ©cÃ©dentes utilisations de la fonction <text:span text:style-name="CodeDansTexte">console.log()</text:span>,
qui se repose en effet sur <text:span text:style-name="CodeDansTexte">process.stdout</text:span> (voir encadrÃ©).</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Raccourci</text:span> Les fonctions <text:span text:style-name="CodeDansTexte">console.log</text:span> et <text:span text:style-name="CodeDansTexte">console.error</text:span></text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
La fonction d&#8217;affichage <text:span text:style-name="CodeDansTexte">console.log()</text:span> Ã©crit dans le flux de sortie
<text:span text:style-name="CodeDansTexte">process.stdout</text:span>.
Sans surprise, <text:span text:style-name="CodeDansTexte">console.error()</text:span> Ã©crit dans le flux d&#8217;erreur
<text:span text:style-name="CodeDansTexte">process.stderr</text:span>.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Elles ajoutent un retour Ã  la ligne et des options de formatage pour
notre confort.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">On en parle davantage dans la section sur le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-console"  text:visited-style-name="Visited_20_Internet_20_Link">module <text:span text:style-name="CodeDansTexte">console</text:span></text:a>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les flux de sortie et d&#8217;erreur sont manipulables en continu,
Ã  l&#8217;aide d&#8217;utilitaires systÃ¨mes existants (<text:span text:style-name="CodeDansTexte">grep</text:span>, <text:span text:style-name="CodeDansTexte">awk</text:span>, etc.)
ou de programmes spÃ©cifiques (analyse de <text:span text:style-name="T4">logs</text:span>).
On peut ainsi se concentrer sur un programme qui fait juste ce dont on a besoin.
On laisse le travail de spÃ©cialisation Ã  d&#8217;autres programmes.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Filtrons la sortie de l&#8217;exemple prÃ©cÃ©dent sans Ã©crire une ligne de code de plus.
Le programme <text:span text:style-name="CodeDansTexte">grep</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://fr.wikipedia.org/wiki/Grep" text:visited-style-name="Visited_20_Internet_20_Link">https://fr.wikipedia.org/wiki/Grep</text:a></text:span>)
est fourni par dÃ©faut sur les systÃ¨mes Linux et macOS.
Il ne retourne que les lignes qui contiennent le motif
donnÃ© en <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process.argv"  text:visited-style-name="Visited_20_Internet_20_Link">argument</text:a>&#160;:</text:p>
<text:p text:style-name="Code">$ node process/stdout.js | grep 'tre'</text:p><text:p text:style-name="Code">qua<text:span text:style-name="CodeExergue">tre</text:span></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La sortie standard de <text:span text:style-name="CodeDansTexte">process/stdout.js</text:span> est devenue l&#8217;entrÃ©e standard
de <text:span text:style-name="CodeDansTexte">grep</text:span> grÃ¢ce Ã  l&#8217;utilisation du <text:span text:style-name="T4">pipe</text:span>&#160;(<text:span text:style-name="CodeDansTexte">|</text:span>).
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">C&#8217;est le moment idÃ©al pour regarder du cÃ´tÃ© de l&#8217;entrÃ©e standard de Node.
ImplÃ©mentons quelque chose qui transforme un message&#160;:</text:p>
<text:p text:style-name="Code">$ echo "un deuxtrois\nquatre" | node process/stdin-uppercase.js</text:p><text:p text:style-name="Code">UN DEUXTROIS</text:p><text:p text:style-name="Code">QUATRE</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">On aurait aussi pu rÃ©utiliser la sortie de l&#8217;exemple <text:span text:style-name="CodeDansTexte">process/stdout.js</text:span>&#160;:</text:p>
<text:p text:style-name="Code">$ node process/stdout.js | node process/stdin-uppercase.js</text:p><text:p text:style-name="Code">UN DEUXTROIS</text:p><text:p text:style-name="Code">QUATRE</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Voyons comment cela fonctionne&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">process/stdin-uppercase.js</text:p><text:p text:style-name="Code">process.stdin.on('data', (chunk) =&gt; {<text:s text:c="13"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>const text = chunk.toString();<text:s text:c="18"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>process.stdout.write(text.toLocaleUpperCase()); <text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Chaque afflux de donnÃ©es appelle notre fonction en lui fournissant un seul paramÃ¨tre contenant les donnÃ©es en question.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Le paramÃ¨tre est de <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-buffer"  text:visited-style-name="Visited_20_Internet_20_Link">type Buffer</text:a>&#160;â€“ on souhaite le transformer en <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-string"  text:visited-style-name="Visited_20_Internet_20_Link">chaÃ®ne de caractÃ¨res</text:a>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> La chaÃ®ne de caractÃ¨res est transformÃ©e en majuscules et Ã©crite dans le flux de sortie.
undefined
undefined<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Terminons avec la sortie erreur (<text:span text:style-name="CodeDansTexte">process.stderr</text:span>).
undefined
Elle fonctionne de maniÃ¨re identique Ã  la sortie standard (<text:span text:style-name="CodeDansTexte">process.stdout</text:span>).
S&#8217;il n&#8217;y a visuellement aucune diffÃ©rence, la sortie erreur Ã©crit son contenu
dans un canal diffÃ©rent&#160;â€“ un descripteur diffÃ©rent.
On l&#8217;utilise pour <text:span text:style-name="T7">dÃ©boguer des programmes</text:span>, pour <text:span text:style-name="T7">lister des erreurs</text:span> ou des
contenus que l&#8217;on souhaite dissocier de la sortie standard.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exemple suivant affiche un nombre toutes les demi-secondes et l&#8217;Ã©tat
du compteur de nombres tous les cinq affichages&#160;:</text:p>
<text:p text:style-name="Code">$ node process/stdout-long.js</text:p><text:p text:style-name="Code">7</text:p><text:p text:style-name="Code">24</text:p><text:p text:style-name="Code">3</text:p><text:p text:style-name="Code">19</text:p><text:p text:style-name="Code">25</text:p><text:p text:style-name="Code">Compteur = 5</text:p><text:p text:style-name="Code">22</text:p><text:p text:style-name="Code">...</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Rappel</text:span> Interrompre un programme avec&#160;<text:span text:style-name="Menu">[Ctrl+C]</text:span></text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Un programme peut Ãªtre interrompu Ã  tout moment en utilisant la combinaison
de touches&#160;<text:span text:style-name="Menu">[Ctrl+C]</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">process/stdout-long.js</text:p><text:p text:style-name="Code">const random = (limit) =&gt; Math.floor(Math.random() * limit);</text:p><text:p text:style-name="Code">let counter = 0;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">setInterval(() =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>counter++;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>process.stdout.write(`${random(30)}\n`);<text:s text:c="12"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>if (Number.isInteger(counter / 5)) {<text:s text:c="16"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>process.stderr.write(`Compteur = ${counter}\n`);<text:s text:c="2"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">}, 500);</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Ã‰crit un nombre entre&#160;0 et 30&#160;dans la sortie standard.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> On vÃ©rifie si la valeur du compteur est divisible par&#160;5&#160;â€“ c&#8217;est le cas si la division produit un entier au lieu d&#8217;un nombre Ã  virgule.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche <text:span text:style-name="CodeDansTexte">Compteur = 5</text:span> puis <text:span text:style-name="CodeDansTexte">Compteur = 10</text:span> (et ainsi de suite) dans la sortie erreur.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">On pourrait dÃ©cider de n&#8217;afficher que le flux d&#8217;erreur.
Utilisons l&#8217;opÃ©rateur&#160;<text:span text:style-name="CodeDansTexte">&gt;</text:span> pour <text:span text:style-name="T7">rediriger la sortie standard vers un fichier</text:span>&#160;:
undefined</text:p>
<text:p text:style-name="Code">$ node process/stdout-long.js &gt; stdout.txt</text:p><text:p text:style-name="Code">Compteur = 5</text:p><text:p text:style-name="Code">Compteur = 10</text:p><text:p text:style-name="Code">...</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">En ouvrant le fichier <text:span text:style-name="CodeDansTexte">stdout.txt</text:span>, on voit
la liste de nombres gÃ©nÃ©rÃ©e par notre programme.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">En maÃ®trisant les flux standards, on est capable de <text:span text:style-name="T7">crÃ©er des programmes modulaires</text:span>
qui consomment du contenu sans avoir Ã  connaÃ®tre leur provenance.
<text:span text:style-name="T7">Les donnÃ©es circulent</text:span> depuis et vers des programmes externes,
des fichiers ou des sites web distants.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Pour mieux comprendre la logique de flux continu que l&#8217;on vient de dÃ©couvrir,
je vous invite Ã  lire la section liÃ©e au <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-stream"  text:visited-style-name="Visited_20_Internet_20_Link">module <text:span text:style-name="CodeDansTexte">stream</text:span></text:a>.
undefined
On y dÃ©taillera la liste des Ã©vÃ©nements Ã  Ã©couter, ainsi que les diffÃ©rentes
mÃ©thodes d&#8217;Ã©criture, de pause et de lecture.</text:p>
<text:bookmark text:name="ref-process.on" /><text:p text:style-name="TexteCourant">Un processus systÃ¨me reÃ§oit et Ã©met des donnÃ©es, mais il peut aussi
<text:span text:style-name="T7">Ã©couter des Ã©vÃ©nements</text:span> grÃ¢ce Ã  la fonction <text:span text:style-name="CodeDansTexte">process.on</text:span>.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">process/exit.js</text:p><text:p text:style-name="Code">console.log('Le processus dÃ©marre');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">process.on('exit', (code) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log(`Le processus termine avec le code ${code}`);</text:p><text:p text:style-name="Code">});</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cet exemple illustre l&#8217;Ã©vÃ©nement <text:span text:style-name="CodeDansTexte">exit</text:span>, qui est dÃ©clenchÃ© quand le processus se termine.
Ã€ ce titre, un <text:span text:style-name="T7">code de sortie</text:span> est fourni pour signaler l&#8217;Ã©tat dans
lequel le programme se termine.
On parlera davantage du code de sortie et de sa signification
dans la section <text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process.exit"  text:visited-style-name="Visited_20_Internet_20_Link">Mettre fin au processus</text:a></text:span>.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">LanÃ§ons le script prÃ©cÃ©dent&#160;:</text:p>
<text:p text:style-name="Code">$ node process/exit.js</text:p><text:p text:style-name="Code">Le processus dÃ©marre</text:p><text:p text:style-name="Code">Le processus termine avec le code 0</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Tout s&#8217;est passÃ© correctement.
Le code de sortie est alors&#160;<text:span text:style-name="CodeDansTexte">0</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Si le programme venait Ã  se terminer de maniÃ¨re imprÃ©vue, le code serait diffÃ©rent.
L&#8217;exemple suivant provoque volontairement une erreur en faisant
rÃ©fÃ©rence Ã  une variable qui n&#8217;existe pas&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">process/exit-error.js</text:p><text:p text:style-name="Code">process.on('exit', (code) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log(`Le processus termine avec le code ${code}`);</text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(jenexistepas);</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">LanÃ§ons le script&#160;:</text:p>
<text:p text:style-name="Code">$ node process/exit-error.js</text:p><text:p text:style-name="Code">Le processus termine avec le code 1</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:span text:style-name="CodeExergue">ReferenceError</text:span>: jenexistepas is not defined</text:p><text:p text:style-name="Code"><text:s text:c="4"/>at Object.&lt;anonymous&gt; (/.../examples/process/<text:span text:style-name="CodeExergue">exit-error.js</text:span>:<text:span text:style-name="CodeExergue">5</text:span>:13)</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette fois-ci, le code de sortie est&#160;<text:span text:style-name="CodeDansTexte">1</text:span>.
Cela correspond Ã  une erreur qui n&#8217;a pas Ã©tÃ© capturÃ©e.
Le reste du message dÃ©crit pourquoi l&#8217;erreur s&#8217;est manifestÃ©e.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">D&#8217;autres Ã©vÃ©nements liÃ©s au cycle de vie de nos applications sont disponibles&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TableauTitre">Tableau 1. Ã‰vÃ©nements liÃ©s au cycle de vie du processus Node</text:p><table:table table:style-name="Tableau1"><table:table-column />,<table:table-column />,<table:table-column /><table:table-row><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Ã‰vÃ©nement</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>ParamÃ¨tres</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Raison du dÃ©clenchement</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">exit</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">(exitCode)</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Le programme se termine et va rendre la main au systÃ¨me d&#8217;exploitation.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">unhandledRejection</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">(reason, promise)</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Une <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-promise"  text:visited-style-name="Visited_20_Internet_20_Link">promesse</text:a> a Ã©chouÃ©
et n&#8217;a pas Ã©tÃ© capturÃ©e Ã  l&#8217;aide de la mÃ©thode <text:span text:style-name="CodeDansTexte">.catch()</text:span>.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">uncaughtException</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">(error)</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Une erreur s&#8217;est produite et n&#8217;a pas Ã©tÃ© capturÃ©e.
Si rien n&#8217;est fait, le processus va s&#8217;arrÃªter avec un code erreur.<text:line-break/>
<text:span text:style-name="T7">Note</text:span> : il vaut mieux qu&#8217;un programme s&#8217;arrÃªte en cas de problÃ¨me.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">message</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">(message, sourceSocket)</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-child_process"  text:visited-style-name="Visited_20_Internet_20_Link">processus parent</text:a> nous envoie un message.</text:p></table:table-cell></table:table-row></table:table>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-signals" /><text:p text:style-name="TexteCourant">La mÃ©thode <text:span text:style-name="CodeDansTexte">process.on</text:span> est Ã  l&#8217;Ã©coute des signaux systÃ¨me.
Par exemple, la combinaison de touches <text:span text:style-name="Menu">[Ctrl+C]</text:span> met en rÃ©alitÃ©
un signal d&#8217;interruption qui rÃ©pond Ã  l&#8217;identifiant <text:span text:style-name="CodeDansTexte">SIGINT</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Node gÃ¨re ces signaux pour nous, mais on peut aussi se mettre Ã  les Ã©couter
et dÃ©cider de faire autrement que son comportement par dÃ©faut.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Par exemple, affichons l&#8217;heure de l&#8217;arrÃªt du processus avant de rendre la main&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">process/interrupt.js</text:p><text:p text:style-name="Code">const log = (msg) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log(`${new Date().toISOString()} - ${msg}`);</text:p><text:p text:style-name="Code">}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">log('Processus dÃ©marrÃ©');<text:s text:c="21"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">process.on('SIGINT', () =&gt; {<text:s text:c="18"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>log('Processus terminÃ© (manuellement)');</text:p><text:p text:style-name="Code"><text:s text:c="2"/>process.exit(0);<text:s text:c="28"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">setTimeout(() =&gt; {<text:s text:c="28"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>log('Processus terminÃ© (timeout)');</text:p><text:p text:style-name="Code"><text:s text:c="2"/>process.exit(0);</text:p><text:p text:style-name="Code">}, 5000)</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Un premier message s&#8217;affiche au dÃ©marrage du script.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Cette <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-function"  text:visited-style-name="Visited_20_Internet_20_Link">fonction</text:a> se dÃ©clenche lors de la rÃ©ception du <text:span text:style-name="T4">signal d&#8217;interruption</text:span> (<text:span text:style-name="CodeDansTexte">SIGINT</text:span>), lorsque le systÃ¨me d&#8217;exploitation lui relaie notre combinaison de touches <text:span text:style-name="Menu">[Ctrl+C]</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> La fonction <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process.exit"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">process.exit()</text:span></text:a> termine le processus.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Sinon, ce chronomÃ¨tre mettra fin au processus au bout de 5 secondes.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">En pratique le rÃ©sultat ressemble Ã  ceci&#160;:</text:p>
<text:p text:style-name="Code">$ node process/interrupt.js</text:p><text:p text:style-name="Code">2018-03-16T10:58:32.855Z - Processus dÃ©marrÃ©</text:p><text:p text:style-name="Code"><text:span text:style-name="Menu">[Ctrl+C]</text:span></text:p><text:p text:style-name="Code">2018-03-16T10:58:40.000Z - Processus terminÃ© (manuellement)</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">En plus du signal <text:span text:style-name="CodeDansTexte">SIGINT</text:span>, Node nous relaie les signaux suivants&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TableauTitre">Tableau 2. Ã‰vÃ©nements liÃ©s aux signaux systÃ¨mes</text:p><table:table table:style-name="Tableau1"><table:table-column />,<table:table-column /><table:table-row><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Ã‰vÃ©nement</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Raison du dÃ©clenchement</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">SIGINT</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Interruption de la commande en&#160;cours</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">SIGTERM</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Demande au processus de s&#8217;arrÃªter</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">SIGUSR1</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Node reÃ§oit le signal d&#8217;attacher l'<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-inspect"  text:visited-style-name="Visited_20_Internet_20_Link">inspecteur</text:a></text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">SIGHUP</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Le terminal est en train d&#8217;Ãªtre fermÃ©</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">SIGWINCH</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Le terminal a Ã©tÃ© redimensionnÃ©</text:p></table:table-cell></table:table-row></table:table>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="CodeDansTexte">SIGKILL</text:span> est un autre Ã©vÃ©nement important, mais on ne peut pas l&#8217;Ã©couter.
Quand il est Ã©mis, le processus doit Ãªtre arrÃªtÃ© quoiqu&#8217;il arrive.
On l&#8217;utilise justement en dernier recours, quand <text:span text:style-name="CodeDansTexte">SIGINT</text:span>
et <text:span text:style-name="CodeDansTexte">SIGTERM</text:span> ne font pas effet&#160;; par exemple Ã  cause d&#8217;un bogue dans notre code,
ou d&#8217;une ressource qui ne rend pas la main.</text:p>
<text:bookmark text:name="ref-process.exit" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T7">Un processus Node se termine quand il n&#8217;a plus d&#8217;instructions Ã  exÃ©cuter</text:span>.
Ce peut Ãªtre provoquÃ© via
l'<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-signals"  text:visited-style-name="Visited_20_Internet_20_Link">Ã©mission d&#8217;un signal extÃ©rieur</text:a>, mais aussi de l&#8217;intÃ©rieur
par l&#8217;intermÃ©diaire de la fonction <text:span text:style-name="CodeDansTexte">process.exit()</text:span>.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">On utilise cette fonction car le programme a atteint son but.
On le fait aussi lorsqu&#8217;on intercepte une erreur en souhaitant
effectuer un <text:span text:style-name="T7">traitement spÃ©cial avant de mettre fin au processus</text:span>.
Il se peut aussi qu&#8217;il vaille mieux terminer l&#8217;application en cas de perte
d&#8217;accÃ¨s Ã  des ressources distantes (base de donnÃ©es, stockage de fichiers)
au lieu de prÃ©senter une application web instable.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exemple suivant illustre que l&#8217;on souhaite clÃ´turer notre script
si on trouve le bon nombre&#160;:</text:p>
<text:p text:style-name="Code">$ node process/exit-devinette.js</text:p><text:p text:style-name="Code">JEU ! Trouve le nombre auquel je pense :</text:p><text:p text:style-name="Code">10<text:span text:style-name="Menu">[ENTRÃ‰E]</text:span></text:p><text:p text:style-name="Code">Hm hm, essaie encore.</text:p><text:p text:style-name="Code">3<text:span text:style-name="Menu">[ENTRÃ‰E]</text:span></text:p><text:p text:style-name="Code">Tu as trouvÃ©, bravo !</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans cet exemple, on Ã©coute l&#8217;utilisateur de maniÃ¨re indÃ©finie, jusqu&#8217;Ã  ce qu&#8217;il
ou elle trouve le bon nombre.
Lorsque c&#8217;est le cas, on interrompt le programme en transmettant
un code de sortie de rÃ©ussite&#160;: le code <text:span text:style-name="CodeDansTexte">0</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">process/exit-devinette.js</text:p><text:p text:style-name="Code">const secret_number = Number(process.argv[2] || 3); <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log('JEU ! Trouve le nombre auquel je pense :');</text:p><text:p text:style-name="Code">process.stdin.on('data', (chunk) =&gt; {<text:s text:c="15"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>if (parseFloat(chunk) === secret_number) {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>console.log('Tu as trouvÃ©, bravo !');</text:p><text:p text:style-name="Code"><text:s text:c="4"/>process.exit(0);<text:s text:c="32"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code"><text:s text:c="2"/>else {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>console.log('Hm hm, essaie encore.');<text:s text:c="11"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Le nombre secret est&#160;<text:span text:style-name="CodeDansTexte">3</text:span> par dÃ©faut, sauf s&#8217;il est passÃ© <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process.argv"  text:visited-style-name="Visited_20_Internet_20_Link">en argument</text:a> du script.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Cette fonction est invoquÃ©e Ã  chaque saisie suivie de l&#8217;appui sur la touche <text:span text:style-name="Menu">[ENTRÃ‰E]</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Cette ligne met fin au script, aprÃ¨s avoir affichÃ© un message de fÃ©licitations.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Ce message s&#8217;affiche Ã  chaque saisie erronÃ©e, jusqu&#8217;Ã  ce que le nombre secret soit trouvÃ©.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">On pourrait tout Ã  fait imaginer une variante de ce script dans laquelle
on limiterait le nombre de mauvaises rÃ©ponses.
Lorsqu&#8217;on atteindrait cette limite, le programme utiliserait un code de sortie
diffÃ©rent de&#160;<text:span text:style-name="CodeDansTexte">0</text:span>.
Le code&#160;<text:span text:style-name="CodeDansTexte">9</text:span> ferait l&#8217;affaire puisqu&#8217;il indique qu&#8217;un argument invalide a Ã©tÃ©
passÃ©.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">AvancÃ©</text:span> process.abort()</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
Comme avec <text:span text:style-name="CodeDansTexte">process.exit()</text:span>, le programme est terminÃ© immÃ©diatement.
On l&#8217;utilise quand quelque chose d&#8217;inopinÃ© et nÃ©cessitant un dÃ©bogage
avancÃ© se produit.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">La fonction gÃ©nÃ¨re un fichier de dÃ©bogage (<text:span text:style-name="T4">core file</text:span>) qui contient tout le contenu
de la mÃ©moire utilisÃ©e par Node.
undefined
Ce fichier s&#8217;analyse avec des logiciels avancÃ©s comme <text:span text:style-name="CodeDansTexte">mdb_v8</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> Module process</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">La documentation du module <text:span text:style-name="CodeDansTexte">process</text:span> est disponible sur le site officiel de Node&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://nodejs.org/docs/latest-v10.x/api/process.html" text:visited-style-name="Visited_20_Internet_20_Link">https://nodejs.org/docs/latest-v10.x/api/process.html</text:a></text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-stream" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">stream : manipuler des flux de donnÃ©es</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le module <text:span text:style-name="CodeDansTexte">stream</text:span> contient les Ã©lÃ©ments de base pour lire, Ã©crire et
transformer des flux de donnÃ©es rapidement et avec peu de mÃ©moire.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">CrÃ©er ses propres flux est une chose assez compliquÃ©e Ã  rÃ©aliser.
Dans cette section, nous allons nous focaliser sur l&#8217;utilisation des modules
Node qui gÃ©nÃ¨rent de tels&#160;flux.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">stream/intro.js</text:p><text:p text:style-name="Code">const {createReadStream} = require('fs');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">createReadStream(__filename)<text:s text:c="20"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>.on('data', (data) =&gt; {<text:s text:c="23"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>console.log('%d octets lus', data.length);<text:s text:c="2"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> On crÃ©e un flux de lecture qui ouvre le fichier courant (<text:span text:style-name="CodeDansTexte">__filename</text:span>).<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Invoque cette fonction Ã  chaque morceau de donnÃ©es&#160;lu.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche le nombre d&#8217;octets lus dans ce morceau.<text:line-break/></text:p>
<text:p text:style-name="Code">$ node stream/intro.js</text:p><text:p text:style-name="Code">214 octets lus</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T7">Un flux de lecture consomme les donnÃ©es petit Ã  petit</text:span>.
Il correspond Ã  une instance de l&#8217;objet <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-stream.Readable"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">stream.Readable</text:span></text:a>.
undefined
undefined
L&#8217;exemple prÃ©cÃ©dent n&#8217;a affichÃ© qu&#8217;un seul morceau car la taille maximale
par dÃ©faut est d&#8217;environ <text:span text:style-name="CodeDansTexte">16&#160;Ko</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">stream/read.js</text:p><text:p text:style-name="Code">const {createReadStream} = require('fs');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">createReadStream(__filename, {highWaterMark: 100})<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>.on('end', () =&gt; console.log('Lecture terminÃ©e')) <text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>.on('data', (data) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>console.log('%d octets reÃ§us', data.length);</text:p><text:p text:style-name="Code"><text:s text:c="2"/>});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> On spÃ©cifie cette fois qu&#8217;on lit <text:span text:style-name="CodeDansTexte">100&#160;octets</text:span> Ã  la fois.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">Lecture terminÃ©e</text:span> lorsque tous les morceaux ont Ã©tÃ©&#160;lus.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;option <text:span text:style-name="CodeDansTexte">highWaterMark</text:span> adapte le dÃ©bit de lecture.
Cette valeur est exprimÃ©e en octets.
Plus ce nombre est petit, moins Node utilise de mÃ©moire&#160;:</text:p>
<text:p text:style-name="Code">$ node stream/read.js</text:p><text:p text:style-name="Code">100 octets lus</text:p><text:p text:style-name="Code">100 octets lus</text:p><text:p text:style-name="Code">78 octets lus</text:p><text:p text:style-name="Code">Lecture terminÃ©e</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le mÃ©canisme de flux s&#8217;applique Ã©galement Ã  l&#8217;Ã©criture.
undefined
undefined
<text:span text:style-name="T7">Un flux d&#8217;Ã©criture Ã©crit des donnÃ©es petit Ã  petit</text:span>.
Il correspond Ã  une instance de l&#8217;objet <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-stream.Writeable"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">stream.Writeable</text:span></text:a>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exemple suivant illustre une succession d&#8217;Ã©critures dans un mÃªme&#160;flux&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">stream/write.js</text:p><text:p text:style-name="Code">const {createWriteStream, readFile} = require('fs');</text:p><text:p text:style-name="Code">const {join} = require('path');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const dest = join(__dirname, 'debug.txt');</text:p><text:p text:style-name="Code">const stream = createWriteStream(dest);<text:s text:c="5"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">stream.on('finish', () =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>readFile(dest, (error, data) =&gt; {<text:s text:c="9"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>console.log(String(data));</text:p><text:p text:style-name="Code"><text:s text:c="2"/>});</text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">stream.write('Hell');<text:s text:c="23"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">stream.write('o Worl');</text:p><text:p text:style-name="Code">stream.end('d!');<text:s text:c="27"/><text:span text:style-name="PuceCode">3</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> On crÃ©e un flux d&#8217;Ã©criture vers le fichier <text:span text:style-name="CodeDansTexte">stream/debug.txt</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Ã‰crit <text:span text:style-name="CodeDansTexte">Hell</text:span> dans le&#160;flux.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Ã‰crit&#160;<text:span text:style-name="CodeDansTexte">d!</text:span> dans le flux et signale que nous n&#8217;avons plus de donnÃ©es Ã  transmettre.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> L&#8217;utilisation de <text:span text:style-name="CodeDansTexte">stream.end()</text:span> dÃ©clenche l&#8217;Ã©vÃ©nement <text:span text:style-name="CodeDansTexte">finish</text:span>&#160;â€“ nous lisons le contenu du fichier Ã  ce moment&#160;lÃ .<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette Ã©criture par morceaux a pour effet de rÃ©duire la pression mÃ©moire
exercÃ©e par Node sur le systÃ¨me d&#8217;exploitation et pour le reste du programme.
Ce mÃ©canisme est particuliÃ¨rement adaptÃ© lorsque l&#8217;Ã©criture prend du temps
ou implique un certain volume de donnÃ©es.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T7">Les flux de lecture et d&#8217;Ã©criture se combinent</text:span>.
undefined
undefined
Les donnÃ©es lues depuis une source (<text:span text:style-name="CodeDansTexte">Readable</text:span>) sont redirigÃ©es vers
une destination (<text:span text:style-name="CodeDansTexte">Writeable</text:span>) Ã  l&#8217;aide de la fonction <text:span text:style-name="CodeDansTexte">pipe()</text:span>&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">stream/pipe.js</text:p><text:p text:style-name="Code">const {createReadStream, createWriteStream} = require('fs');</text:p><text:p text:style-name="Code">const {join} = require('path');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const filename_copy = join(__dirname, 'copie.js');</text:p><text:p text:style-name="Code">const source = createReadStream(__filename);<text:s text:c="12"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">const dest = createWriteStream(filename_copy);<text:s text:c="10"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">source.pipe(dest)<text:s text:c="39"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>.on('finish', () =&gt; console.log('Copie terminÃ©e !')); <text:span text:style-name="PuceCode">4</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> On crÃ©e un flux de lecture.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> On crÃ©e un flux d&#8217;Ã©criture.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> On redirige le flux de lecture vers celui d&#8217;Ã©criture.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> La redirection retourne le flux d&#8217;Ã©criture, que l&#8217;on Ã©coute pour savoir quand il a terminÃ© d&#8217;Ã©crire sur le disque.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans cet exemple, nous avons pris deux fichiers respectivement comme source de lecture
et destination d&#8217;Ã©criture.
Nous avons assemblÃ© les deux flux avec <text:span text:style-name="CodeDansTexte">pipe()</text:span> puis dÃ©tectÃ© la fin de la copie.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Unix</text:span> OpÃ©rateur pipe&#160;(<text:span text:style-name="CodeDansTexte">|</text:span>)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">La fonction <text:span text:style-name="CodeDansTexte">stream.pipe()</text:span> correspond littÃ©ralement Ã  l&#8217;opÃ©rateur Unix&#160;<text:span text:style-name="CodeDansTexte">|</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Les morceaux de donnÃ©es d&#8217;un premier programme sont transmis en entrÃ©e Ã  un
second programme.
Ici, le mÃ©canisme s&#8217;applique Ã  des fonctions&#160;Node.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;utilisation de <text:span text:style-name="CodeDansTexte">pipe()</text:span> semble superflue pour copier des fichiers.
Ã€ vrai dire, la fonction <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-fs"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">fs.copyFile()</text:span></text:a> fait exactement la mÃªme chose.
undefined
undefined
Toutefois, le mÃ©canisme de redirection proposÃ© par <text:span text:style-name="CodeDansTexte">pipe()</text:span> est modulaire et composable.
On peut par exemple diriger une source de donnÃ©es vers plusieurs flux d&#8217;Ã©criture
en mÃªme temps.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">stream/pipe-multi.js</text:p><text:p text:style-name="Code">const fs = require('fs');</text:p><text:p text:style-name="Code">const {join} = require('path');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const filename_copy = join(__dirname, 'copie.js');</text:p><text:p text:style-name="Code">const read = fs.createReadStream(__filename);</text:p><text:p text:style-name="Code">read.on('end', () =&gt; console.log('Lecture terminÃ©e !'));</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">read.pipe(fs.createWriteStream(filename_copy)); <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">read.pipe(process.stdout);<text:s text:c="22"/><text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Ã‰crit une copie du fichier comme dans l&#8217;exemple <text:span text:style-name="CodeDansTexte">stream/pipe.js</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Redirige le contenu de lecture vers la <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process.std"  text:visited-style-name="Visited_20_Internet_20_Link">sortie standard</text:a> de notre terminal.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette technique agit comme une gare de triage&#160;: nous avons la libertÃ©
d&#8217;agir sur les donnÃ©es avant de les envoyer vers leur flux d&#8217;Ã©criture distinct.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">On peut aussi <text:span text:style-name="T7">transformer les contenus Ã  la volÃ©e</text:span> en utilisant plusieurs
fois la fonction <text:span text:style-name="CodeDansTexte">pipe()</text:span>.
Les donnÃ©es sont passÃ©es Ã  des objets capables de lire et d&#8217;Ã©crire des flux.
C&#8217;est le cas du <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-extras"  text:visited-style-name="Visited_20_Internet_20_Link">module <text:span text:style-name="CodeDansTexte">zlib</text:span></text:a>, responsable de compresser et de
dÃ©compresser des donnÃ©es&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">stream/pipe-transform.js</text:p><text:p text:style-name="Code">const {createReadStream} = require('fs');</text:p><text:p text:style-name="Code">const {createGzip} = require('zlib');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">createReadStream(__filename)</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.pipe(createGzip())<text:s text:c="9"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>.pipe(process.stdout);<text:s text:c="6"/><text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Compresse les donnÃ©es Ã  la volÃ©e.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Les donnÃ©es compressÃ©es sont transmises Ã  la <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process.std"  text:visited-style-name="Visited_20_Internet_20_Link">sortie standard</text:a>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cet exemple devrait afficher le contenu de notre fichier source avec une taille
rÃ©duite&#160;:</text:p>
<text:p text:style-name="Code">$ node stream/pipe-transform.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;affichage semble bizarre et c&#8217;est normal&#160;: ce sont des donnÃ©es compressÃ©es
au format Gzip&#160;â€“ un format de compression libre.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le programme Unix <text:span text:style-name="CodeDansTexte">gzip</text:span> sait dÃ©coder des donnÃ©es compressÃ©es dans ce format.
Il sait aussi les dÃ©coder Ã  la volÃ©e avec un&#160;<text:span text:style-name="T4">pipe</text:span>&#160;:
undefined
undefined</text:p>
<text:p text:style-name="Code">$ node stream/pipe-transform.js | gzip</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous avons vu comment transmettre des flux de donnÃ©es de maniÃ¨re interopÃ©rable
entre un script Node et un programme externe, entre deux programmes externes
et entre deux scripts&#160;Node.</text:p>
<text:bookmark text:name="ref-stream.Readable" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">stream.pipe()</text:span></text:h>
<text:p text:style-name="Remarque">Redirige un flux de lecture vers un flux d&#8217;Ã©criture.</text:p><text:bookmark text:name="ref-stream.Readable" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">stream.on('data')</text:span></text:h>
<text:p text:style-name="Remarque">Se dÃ©clenche lorsqu&#8217;un morceau de donnÃ©es a Ã©tÃ©&#160;lu.</text:p><text:bookmark text:name="ref-stream.Readable" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">stream.on('error')</text:span></text:h>
<text:p text:style-name="Remarque">Se dÃ©clenche lorqu&#8217;une erreur se produit.</text:p><text:bookmark text:name="ref-stream.Readable" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">stream.on('end')</text:span></text:h>
<text:p text:style-name="Remarque">Se dÃ©clenche lorsqu&#8217;il n&#8217;y a plus de donnÃ©es Ã &#160;lire.</text:p><text:bookmark text:name="ref-stream.Readable" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">stream.on('readable')</text:span></text:h>
<text:p text:style-name="Remarque">Se dÃ©clenche lorsque la lecture de donnÃ©es est prÃªte Ã  dÃ©marrer.</text:p>
<text:bookmark text:name="ref-stream.Writeable" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">stream.write()</text:span></text:h>
<text:p text:style-name="Remarque">Ã‰crit des donnÃ©es dans le flux.</text:p><text:bookmark text:name="ref-stream.Writeable" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">stream.end()</text:span></text:h>
<text:p text:style-name="Remarque">Signale que nous n&#8217;avons plus de donnÃ©es Ã  transmettre.</text:p><text:bookmark text:name="ref-stream.Writeable" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">stream.on('drain')</text:span></text:h>
<text:p text:style-name="Remarque">Se dÃ©clenche lorsque la mÃ©moire d&#8217;Ã©criture est vide et prÃªte Ã  accepter
de nouvelles donnÃ©es.</text:p><text:bookmark text:name="ref-stream.Writeable" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">stream.on('error')</text:span></text:h>
<text:p text:style-name="Remarque">Se dÃ©clenche lorsqu&#8217;une erreur se produit.</text:p><text:bookmark text:name="ref-stream.Writeable" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">stream.on('finish')</text:span></text:h>
<text:p text:style-name="Remarque">Se dÃ©clenche Ã  la clÃ´ture du flux d&#8217;Ã©criture.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> Module stream</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">La documentation du module <text:span text:style-name="CodeDansTexte">stream</text:span> est disponible sur le site officiel de Node&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://nodejs.org/docs/latest-v10.x/api/stream.html" text:visited-style-name="Visited_20_Internet_20_Link">https://nodejs.org/docs/latest-v10.x/api/stream.html</text:a></text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-dautres_modules_pour_aller_plus_loin" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">D&#8217;autres modules pour aller plus loin</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Node embarque d&#8217;autres modules que ceux listÃ©s prÃ©cÃ©demment.
Ils nÃ©cessitent des connaissances sur des sujets bas niveau,
plus proches du matÃ©riel et des protocoles rÃ©seau.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:bookmark text:name="ref-cluster" /><text:span text:style-name="CodeDansTexte">cluster</text:span></text:h>
<text:p text:style-name="Remarque">GÃ¨re la distribution d&#8217;une application sur plusieurs CPU d&#8217;un mÃªme ordinateur.
undefined</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:bookmark text:name="ref-crypto" /><text:span text:style-name="CodeDansTexte">crypto</text:span></text:h>
<text:p text:style-name="Remarque">Fonctions cryptographiques pour chiffrer, signer et vÃ©rifier des donnÃ©es.
undefined</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:bookmark text:name="ref-dgram" /><text:span text:style-name="CodeDansTexte">dgram</text:span></text:h>
<text:p text:style-name="Remarque">CrÃ©ation et consommation de ressources&#160;UDP.
undefined</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:bookmark text:name="ref-dns" /><text:span text:style-name="CodeDansTexte">dns</text:span></text:h>
<text:p text:style-name="Remarque">RÃ©solution et lecture d&#8217;enregistrements&#160;DNS.
undefined</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:bookmark text:name="ref-net" /><text:span text:style-name="CodeDansTexte">net</text:span></text:h>
<text:p text:style-name="Remarque">CrÃ©ation et consommation de ressources TCP.
Les modules <text:span text:style-name="CodeDansTexte">http</text:span>, <text:span text:style-name="CodeDansTexte">https</text:span> et <text:span text:style-name="CodeDansTexte">http2</text:span> se basent dessus.
undefined</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:bookmark text:name="ref-readline" /><text:span text:style-name="CodeDansTexte">readline</text:span></text:h>
<text:p text:style-name="Remarque">Manipulation ligne par ligne d&#8217;un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-stream"  text:visited-style-name="Visited_20_Internet_20_Link">flux</text:a>.
Ce module est particuliÃ¨rement utilisÃ© dans des
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-08"  text:visited-style-name="Visited_20_Internet_20_Link">applications en ligne de commande</text:a> (chapitre&#160;8),
pour mettre Ã  jour une barre de progression et animer des Ã©lÃ©ments d&#8217;affichage.
undefined</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:bookmark text:name="ref-tty" /><text:span text:style-name="CodeDansTexte">tty</text:span></text:h>
<text:p text:style-name="Remarque">Gestion d&#8217;interface de terminal en mode texte.
Le module <text:span text:style-name="CodeDansTexte">readline</text:span> se base dessus.
undefined</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:bookmark text:name="ref-v8" /><text:span text:style-name="CodeDansTexte">v8</text:span></text:h>
<text:p text:style-name="Remarque">Lecture et Ã©criture d&#8217;instructions de la machine virtuelle&#160;V8
dans le processus actuel.
undefined
undefined</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:bookmark text:name="ref-vm" /><text:span text:style-name="CodeDansTexte">vm</text:span></text:h>
<text:p text:style-name="Remarque">CrÃ©ation de nouveaux contextes d&#8217;interprÃ©tation de la machine virtuelle&#160;V8.
undefined
undefined</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:bookmark text:name="ref-zlib" /><text:span text:style-name="CodeDansTexte">zlib</text:span></text:h>
<text:p text:style-name="Remarque">Compression et dÃ©compression de donnÃ©es (Gzip, Inflate/Deflate).
Ces formats sont utilisÃ©s pour la compression de requÃªtes&#160;HTTP.
undefined</text:p>
<text:bookmark text:name="ref-modules" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">CrÃ©er ses propres modules Node</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-modules-builtin"  text:visited-style-name="Visited_20_Internet_20_Link">modules de base</text:a> nous fournissent de nombreuses fonctionnalitÃ©s.
Nous pouvons rÃ©utiliser le mÃªme mÃ©canisme pour
<text:span text:style-name="T7">organiser notre code dans plusieurs fichiers</text:span>.
C&#8217;est un mÃ©canisme comparable Ã  ce que l&#8217;on retrouve en Python (<text:span text:style-name="CodeDansTexte">import</text:span>),
PHP (<text:span text:style-name="CodeDansTexte">require</text:span>) et Ruby (<text:span text:style-name="CodeDansTexte">require</text:span> et <text:span text:style-name="CodeDansTexte">require_relative</text:span>).</text:p>
<text:bookmark text:name="ref-modules.require" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Importer et exporter des valeurs</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">modules/enfant.js</text:p><text:p text:style-name="Code">const number = 42;</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le fichier d&#8217;exemple <text:span text:style-name="CodeDansTexte">modules/enfant.js</text:span> contient une variable, <text:span text:style-name="CodeDansTexte">number</text:span>.
Essayons de la rÃ©utiliser dans le fichier <text:span text:style-name="CodeDansTexte">modules/parent.js</text:span>
Ã  l&#8217;aide de la fonction <text:span text:style-name="CodeDansTexte">require()</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">modules/parent.js</text:p><text:p text:style-name="Code">const enfant = require('./enfant.js');<text:s text:c="4"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(enfant.number);<text:s text:c="15"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">console.log(enfant);<text:s text:c="22"/><text:span text:style-name="PuceCode">3</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Contrairement aux <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-modules-builtin"  text:visited-style-name="Visited_20_Internet_20_Link">modules de base</text:a>, on passe un chemin relatif au fichier courant.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Est-ce que cela affichera la valeur de la variable <text:span text:style-name="CodeDansTexte">number</text:span>&#160;?<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Mais au fond, que contient notre variable <text:span text:style-name="CodeDansTexte">enfant</text:span>&#160;?<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">ExÃ©cutons le fichier <text:span text:style-name="CodeDansTexte">modules/parent.js</text:span> avec Node pour en avoir le cÅ“ur&#160;net&#160;:</text:p>
<text:p text:style-name="Code">$ node modules/parent.js</text:p><text:p text:style-name="Code">undefined</text:p><text:p text:style-name="Code">{}</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous pouvons en tirer un apprentissage important&#160;:
on ne peut pas voir ce qu&#8217;il y a dans un module depuis l&#8217;extÃ©rieur.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Choisissons maintenant ce que l&#8217;on souhaite exporter en affectant
la valeur de notre choix Ã  <text:span text:style-name="CodeDansTexte">module.exports</text:span>&#160;:
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">modules/enfant-export.js</text:p><text:p text:style-name="Code">const number = 42;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">module.exports = number;</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Comment cela Ã§a se traduit-il lorsqu&#8217;on l&#8217;appelle avec <text:span text:style-name="CodeDansTexte">require()</text:span>&#160;?</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">modules/parent-export.js</text:p><text:p text:style-name="Code">const enfant = require('./enfant-export.js');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(enfant.number);<text:s text:c="15"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(enfant);<text:s text:c="22"/><text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">undefined</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">42</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="CodeDansTexte">module.exports</text:span> rend visible depuis l&#8217;extÃ©rieur ce qui est exportÃ© par un module.
Par dÃ©faut, <text:span text:style-name="CodeDansTexte">module.exports</text:span> est un objet.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Essayons maintenant d&#8217;exporter plusieurs valeurs en une seule fois.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">modules/enfant-export-multiple.js</text:p><text:p text:style-name="Code">const number = 42;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">module.exports.number = number;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">module.exports.random = (limit = 100) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>return Math.floor(Math.random() * limit)</text:p><text:p text:style-name="Code">};</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous avons crÃ©Ã© deux nouvelles valeurs&#160;: <text:span text:style-name="CodeDansTexte">number</text:span> (un nombre) et
<text:span text:style-name="CodeDansTexte">random()</text:span> (une fonction).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">modules/parent-export-multiple.js</text:p><text:p text:style-name="Code">const enfant = require('./enfant-export-multiple.js');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(enfant.number);<text:s text:c="15"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(enfant.random());<text:s text:c="13"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">module.exports = enfant.random;<text:s text:c="11"/><text:span text:style-name="PuceCode">3</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">42</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche un nombre alÃ©atoire entre&#160;0 et&#160;100.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> RÃ©exporte la fonction <text:span text:style-name="CodeDansTexte">enfant.number</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Raccourci</text:span> Exporter un objet</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
L&#8217;utilisation de la syntaxe d&#8217;objet raccourcie Ã©vite la rÃ©pÃ©tition
du nom des variables lors de l&#8217;export.</text:p>
<text:p text:style-name="RemarqueCode">const number = 42;</text:p><text:p text:style-name="RemarqueCode"></text:p><text:p text:style-name="RemarqueCode">const random = (limit = 100) =&gt; {</text:p><text:p text:style-name="RemarqueCode"><text:s text:c="2"/>return Math.floor(Math.random() * limit);</text:p><text:p text:style-name="RemarqueCode">};</text:p><text:p text:style-name="RemarqueCode"></text:p><text:p text:style-name="RemarqueCode">module.exports = {number, random};<text:s text:c="10"/><text:span text:style-name="PuceCode">1</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Liste des valeurs retournÃ©e par l&#8217;objet <text:span text:style-name="CodeDansTexte">module.exports</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">En rÃ©sumÃ©, <text:span text:style-name="T7">pour Node</text:span>, <text:span text:style-name="T7">tout fichier&#160;<text:span text:style-name="CodeDansTexte">.js</text:span> est un module</text:span>.
Le mÃ©canisme d&#8217;import et d&#8217;export est basÃ© sur des chemins de fichiers.
Si on n&#8217;utilise pas de chemin, Node pense que l&#8217;on fait
rÃ©fÃ©rence Ã  un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-modules-builtin"  text:visited-style-name="Visited_20_Internet_20_Link">module de base</text:a> ou Ã  un
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-modules"  text:visited-style-name="Visited_20_Internet_20_Link">module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span></text:a>
(<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-05"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;5</text:a>).</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Histoire</text:span> Modules CommonJS</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
undefined
Le mÃ©canisme de modules implÃ©mentÃ© dans Node est basÃ© sur la
spÃ©cification <text:span text:style-name="T4">CommonJS</text:span>, Ã  peu de choses prÃ¨s.</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://www.commonjs.org/specs/modules/1.0/" text:visited-style-name="Visited_20_Internet_20_Link">http://www.commonjs.org/specs/modules/1.0/</text:a></text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-require" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Aller plus loin avec <text:span text:style-name="">require()</text:span></text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Lorsqu&#8217;on fait appel Ã  la fonction <text:span text:style-name="CodeDansTexte">require()</text:span>, Node effectue les actions suivantes&#160;:</text:p>
<text:p text:style-name="ListeANumero">1.<text:tab/>RÃ©sout le chemin vers le module en question.</text:p><text:p text:style-name="ListeANumero">2.<text:tab/>Lit du fichier.</text:p><text:p text:style-name="ListeANumero">3.<text:tab/>InterprÃ¨te le code.</text:p><text:p text:style-name="ListeANumero">4.<text:tab/>ExÃ©cute le code.</text:p><text:p text:style-name="ListeANumero">5.<text:tab/>Retourne la valeur de <text:span text:style-name="CodeDansTexte">module.exports</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;utilisation de <text:span text:style-name="CodeDansTexte">require()</text:span> est synchrone et bloquante.
Si l&#8217;exÃ©cution du code dans le module chargÃ© prend du temps
â€“ code lent, accÃ¨s Ã  une ressource distante&#160;â€“ le temps de chargement
du module sera affectÃ©.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="CodeDansTexte">require()</text:span> permet de charger trois types de modules&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Fichiers relatifs au module actuel</text:h>
<text:p text:style-name="Remarque"><text:span text:style-name="CodeDansTexte">require('./module.js')</text:span> cherche le fichier <text:span text:style-name="CodeDansTexte">module.js</text:span> dans le rÃ©pertoire courant.
<text:span text:style-name="CodeDansTexte">require('../module.js')</text:span> cherche <text:span text:style-name="CodeDansTexte">module.js</text:span> dans le rÃ©pertoire parent.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Modules Node de base</text:h>
<text:p text:style-name="Remarque">Ils sont disponibles avec chaque installation de Node.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Modules&#160;<text:span text:style-name="CodeDansTexte">npm</text:span></text:h>
<text:p text:style-name="Remarque">Ils sont disponibles avec une Ã©tape d&#8217;installation supplÃ©mentaire
(<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-05"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre 5</text:a>).
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T7">Node met les modules en cache</text:span>.
Si on inclut deux fois le mÃªme module, le deuxiÃ¨me import ira directement
Ã  la derniÃ¨re Ã©tape de la liste d&#8217;actions.
Cela implique aussi que si le module modifie une de ses variables privÃ©e,
cette modification affectera le deuxiÃ¨me import.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Voici un module illustrant une variable privÃ©e et une variable exportÃ©e&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">modules/increment.js</text:p><text:p text:style-name="Code">let counter = 0;<text:s text:c="22"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const increment = () =&gt; ++counter;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">module.exports = increment;<text:s text:c="11"/><text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Variable privÃ©e.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> <text:span text:style-name="CodeDansTexte">increment</text:span> est rendue publique Ã  cet endroit&#160;â€“ la fonction incrÃ©mente la variable privÃ©e <text:span text:style-name="CodeDansTexte">counter</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous allons importer ce module par deux fois, dans deux variables diffÃ©rentes.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">modules/double-import.js</text:p><text:p text:style-name="Code">const first = require('./increment.js');</text:p><text:p text:style-name="Code">const second = require('./increment.js');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(first());<text:s text:c="3"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(first());<text:s text:c="3"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">console.log(second());<text:s text:c="2"/><text:span text:style-name="PuceCode">3</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">1</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">2</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">1</text:span> ou&#160;<text:span text:style-name="CodeDansTexte">3</text:span>&#160;?<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Quel est le verdict Ã  votre avis&#160;?
Rien ne vaut une vÃ©rification, quitte Ã  remettre en question
notre avis initial&#160;:</text:p>
<text:p text:style-name="Code">$ node modules/double-import.js</text:p><text:p text:style-name="Code">1</text:p><text:p text:style-name="Code">2</text:p><text:p text:style-name="Code">3</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il faut garder cette information en tÃªte lorsqu&#8217;on importe un module.
Ce mÃ©canisme se transforme en atout afin de partager
une variable entre plusieurs modules.
Il est pratique dans le cas d&#8217;un cache de donnÃ©es ou d&#8217;une configuration partagÃ©e.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Enfin, plusieurs <text:span text:style-name="T7">problÃ¨mes</text:span> sont susceptibles d&#8217;apparaÃ®tre lors du chargement d&#8217;un module&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">Le chemin vers le module est erronÃ©&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Le module contient une erreur de syntaxe.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Node lance alors une <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-errors"  text:visited-style-name="Visited_20_Internet_20_Link">exception</text:a> et le programme s&#8217;arrÃªte aussitÃ´t.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> Module <text:span text:style-name="">modules</text:span></text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">L&#8217;intÃ©gralitÃ© des variables, fonctions et classes du module <text:span text:style-name="CodeDansTexte">modules</text:span>
est documentÃ©e sur le site web du projet Node.
La documentation contient des informations Ã  jour et qui ne sont pas
forcÃ©ment listÃ©es dans cet ouvrage.</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://nodejs.org/docs/latest-v10.x/api/modules.html" text:visited-style-name="Visited_20_Internet_20_Link">https://nodejs.org/docs/latest-v10.x/api/modules.html</text:a></text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-esm" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Le futur : les modules ECMAScript</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Pendant que le mÃ©canisme de modules de Node montait en puissance,
les navigateurs web Ã©taient en attente d&#8217;une solution native.
La spÃ©cification des modules ECMAScript a Ã©tÃ© validÃ©e en&#160;2013,
mais les navigateurs ont tardÃ© Ã  en implÃ©menter le mÃ©canisme&#160;:
en&#160;2017 pour la plupart.
C&#8217;est le cas du navigateur web Chrome et de
sa <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-v8"  text:visited-style-name="Visited_20_Internet_20_Link">machine virtuelle&#160;V8</text:a>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Attention</text:span> FonctionnalitÃ© expÃ©rimentale</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Si la syntaxe des modules ECMAScript est standardisÃ©e,
ce n&#8217;est pas encore aussi stable du cÃ´tÃ© de&#160;Node.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Les modules ECMAScript sont suffixÃ©s de l&#8217;extension <text:span text:style-name="CodeDansTexte">.mjs</text:span>
et nÃ©cessitent l&#8217;utilisation de l'<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-options"  text:visited-style-name="Visited_20_Internet_20_Link">option de dÃ©marrage</text:a>
<text:span text:style-name="CodeDansTexte">--experimental-modules</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Reprenons l&#8217;exemple <text:span text:style-name="CodeDansTexte">modules/increment.js</text:span> pour le
transformer en module ECMAScript.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">modules/increment.mjs</text:p><text:p text:style-name="Code">let counter = 0;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">export default () =&gt; ++counter;<text:s text:c="11"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">export const reset = () =&gt; counter = 0;<text:s text:c="3"/><text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Export par dÃ©faut.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Export nommÃ©.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La syntaxe <text:span text:style-name="CodeDansTexte">export</text:span> sert Ã  exporter des variables.
Elle se combine avec <text:span text:style-name="CodeDansTexte">import</text:span>&#160;:
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">modules/ecmascript.mjs</text:p><text:p text:style-name="Code">import increment from './increment.js';<text:s text:c="5"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(increment());</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> On n&#8217;importe ici que la valeur par dÃ©faut.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il ne nous reste maintenant plus qu&#8217;Ã  exÃ©cuter notre script <text:span text:style-name="CodeDansTexte">.mjs</text:span>
pour observer le rÃ©sultat.
On notera l&#8217;utilisation de <text:span text:style-name="CodeDansTexte">--experimental-modules</text:span>&#160;:
undefined</text:p>
<text:p text:style-name="Code">$ node --experimental-modules modules/ecmascript.mjs</text:p><text:p text:style-name="Code">(node:35074) ExperimentalWarning: The ESM module loader is experimental.</text:p><text:p text:style-name="Code">1</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Reprenons cet exemple pour importer plusieurs exports d&#8217;un coup&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">modules/ecmascript-multiple.mjs</text:p><text:p text:style-name="Code">import increment, {reset} from './increment.mjs'; <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">increment();</text:p><text:p text:style-name="Code">console.log(increment());</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">reset();<text:s text:c="42"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">console.log(increment());</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> On importe la valeur par dÃ©faut, ainsi qu&#8217;une valeur nommÃ©e&#160;â€“ c&#8217;est particuliÃ¨rement pratique pour sÃ©lectionner avec finesse ce que l&#8217;on veut utiliser d&#8217;un module.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> La fonction <text:span text:style-name="CodeDansTexte">reset()</text:span> remet le compteur Ã &#160;zÃ©ro.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">On notera au passage qu&#8217;on utilise la
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-object-destructuring"  text:visited-style-name="Visited_20_Internet_20_Link">dÃ©composition d&#8217;objet</text:a>
pour extraire un export nommÃ© depuis un module ECMAScript.</text:p>
<text:p text:style-name="Code">$ node --experimental-modules modules/ecmascript-multiple.mjs</text:p><text:p text:style-name="Code">(node:35074) ExperimentalWarning: The ESM module loader is experimental.</text:p><text:p text:style-name="Code">2</text:p><text:p text:style-name="Code">1</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La fonction <text:span text:style-name="CodeDansTexte">reset()</text:span> a bien remis le compteur Ã  zÃ©ro entre-temps.
Objectif accompli&#160;!</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">RÃ©sumons les diffÃ©rences notables avec le mÃ©canisme de modules&#160;Node&#160;:
undefined
undefined
undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">Tous les appels Ã  <text:span text:style-name="CodeDansTexte">import</text:span> doivent se faire en dÃ©but de fichier.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">On ne peut pas utiliser <text:span text:style-name="CodeDansTexte">import</text:span> de maniÃ¨re dynamique
(dans un <text:span text:style-name="CodeDansTexte">if &#8230;&#8203; else</text:span> par exemple).</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">On peut exporter une variable par dÃ©faut et plusieurs variables nommÃ©es.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Il est possible d&#8217;importer des modules Node depuis un module ECMAScript&#160;â€“
l&#8217;inverse n&#8217;est pas&#160;vrai.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Les fichiers doivent Ãªtre suffixÃ©s par&#160;<text:span text:style-name="CodeDansTexte">.mjs</text:span>.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce dernier point est le plus embÃªtant car il ralentit l&#8217;interopÃ©rabilitÃ©
entre les scripts destinÃ©s au dÃ©veloppement web <text:span text:style-name="T4">front-end</text:span> et les scripts&#160;Node.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;histoire nous dira si les modalitÃ©s s&#8217;assoupliront avec le temps.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">npm</text:span> Module&#160;esm</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-modules"  text:visited-style-name="Visited_20_Internet_20_Link">module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span></text:a>&#160;<text:span text:style-name="CodeDansTexte">esm</text:span>
(<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/esm" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/esm</text:a></text:span>) a pris le parti de dÃ©blayer le chemin
de l&#8217;interopÃ©rabilitÃ©.
Il suffit de le charger avant de dÃ©marrer un script Node,
peu importe son mÃ©canisme de chargement de modules&#160;:
<text:span text:style-name="CodeDansTexte">esm</text:span> rend le chargement des modules totalement transparent.
undefined</text:p>
<text:p text:style-name="RemarqueCode">$ node -r esm modules/ecmascript.js</text:p><text:p text:style-name="RemarqueCode">1</text:p><text:p text:style-name="RemarqueCode">$ node -r esm modules/ecmascript.mjs</text:p><text:p text:style-name="RemarqueCode">1</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Pour en savoir plus sur l&#8217;option&#160;<text:span text:style-name="CodeDansTexte">-r</text:span>, rendez-vous
dans la section <text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-require"  text:visited-style-name="Visited_20_Internet_20_Link">PrÃ©charger un module</text:a></text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> Modules ECMAScript</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">L&#8217;intÃ©gralitÃ© des fonctionnalitÃ©s des modules ECMAScript
est documentÃ©e sur le site web du projet Node.
La documentation contient des informations Ã  jour et qui ne sont pas
forcÃ©ment listÃ©es dans cet ouvrage.</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://nodejs.org/docs/latest-v10.x/api/esm.html" text:visited-style-name="Visited_20_Internet_20_Link">https://nodejs.org/docs/latest-v10.x/api/esm.html</text:a></text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-errors" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">S&#8217;en sortir quand Ã§a ne se passe pas comme&#160;prÃ©vu</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">On fait toutes et tous des erreurs.
Notre code va forcÃ©ment mener Ã  des plantages applicatifs.
La nature des causes varie et affecte notre lecture des messages d&#8217;erreur.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette section a pour intention de nous aider Ã  prendre confiance dans ce qu&#8217;on
voit et de piocher l&#8217;information qui va nous aider Ã  rÃ©soudre le problÃ¨me.</text:p>
<text:bookmark text:name="ref-une_erreur_est_nichÃ©e_dans_notrecode" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Une erreur est nichÃ©e dans notre&#160;code</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il y a deux familles d&#8217;erreurs dans du code ECMAScript&#160;: celles de syntaxe
et celles d&#8217;exÃ©cution.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans tous les cas, Node lance une exception complÃ©tÃ©e d&#8217;une trace d&#8217;erreur.
Le but est de comprendre oÃ¹ l&#8217;interprÃ©teur se prend les pieds dans le tapis
et quel est le chemin parcouru au sein du code pour y parvenir.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">CommenÃ§ons avec une erreur de syntaxe&#160;:</text:p>
<text:p text:style-name="Code">$ node <text:span text:style-name="CodeExergue">syntax-error.js</text:span></text:p><text:p text:style-name="Code">console.log(<text:span text:style-name="CodeExergue">'oups j'</text:span>ai fait une erreur de guillemets);</text:p><text:p text:style-name="Code"><text:s text:c="12"/>^^^^^^^^</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:span text:style-name="CodeExergue">SyntaxError</text:span>: <text:span text:style-name="CodeExergue">missing ) after argument list</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>at new Script (vm.js:74:7)</text:p><text:p text:style-name="Code"><text:s text:c="4"/>at createScript (vm.js:246:10)</text:p><text:p text:style-name="Code"><text:s text:c="4"/>at Object.runInThisContext (vm.js:298:10)</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T7">Une erreur de syntaxe est immÃ©diate</text:span>.
Node la dÃ©tecte lorsqu&#8217;il <text:span text:style-name="T4">parse</text:span> notre code.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans l&#8217;exemple prÃ©cÃ©dent, Node indique qu&#8217;il manque une parenthÃ¨se aprÃ¨s le
deuxiÃ¨me guillemet, car c&#8217;est le symbole que l&#8217;interprÃ©teur attend.
En effet, le guillemet indique une intention incorrecte&#160;: on ne veut pas qu&#8217;il
signifie la fin de la chaÃ®ne, mais qu&#8217;il reprÃ©sente un caractÃ¨re apostrophe dans
la chaÃ®ne.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La correction Ã  entreprendre ne sera pas d&#8217;ajouter une parenthÃ¨se aprÃ¨s le
guillemet mais bien de l&#8217;Ã©chapper en le prÃ©fixant d&#8217;un caractÃ¨re&#160;<text:span text:style-name="CodeDansTexte">\</text:span>.
Node l&#8217;interprÃ©tera alors correctement.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Penchons-nous Ã  prÃ©sent sur les erreurs provoquÃ©es lorsque le code est exÃ©cutÃ©&#160;:
undefined
undefined</text:p>
<text:p text:style-name="Code">$ node process/exit-error.js</text:p><text:p text:style-name="Code">console.log(<text:span text:style-name="CodeExergue">jenexistepas</text:span>);</text:p><text:p text:style-name="Code"><text:s text:c="12"/>^</text:p><text:p text:style-name="Code"><text:span text:style-name="CodeExergue">ReferenceError</text:span>: <text:span text:style-name="CodeExergue">jenexistepas</text:span> <text:span text:style-name="CodeExergue">is not defined</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>at Object.&lt;anonymous&gt; (/.../chapter-04/examples/process/<text:span text:style-name="CodeExergue">exit-error.js</text:span>:<text:span text:style-name="CodeExergue">5</text:span>:13)</text:p><text:p text:style-name="Code"><text:s text:c="4"/>at Module._compile (module.js:643:30)</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le marqueur <text:span text:style-name="CodeDansTexte">+^+</text:span>&#160;indique l&#8217;emplacement oÃ¹ le problÃ¨me est rencontrÃ©.
La ligne en-dessous documente le type d&#8217;erreur (<text:span text:style-name="CodeDansTexte">ReferenceError</text:span>)
en prÃ©cisant ce qui n&#8217;est pas dÃ©fini (la variable <text:span text:style-name="CodeDansTexte">jenexistepas</text:span>).
La notation <text:span text:style-name="CodeDansTexte">exit-error.js:5:13</text:span> indique que l&#8217;origine de l&#8217;erreur
se trouve Ã  la <text:span text:style-name="T4">ligne&#160;5</text:span> du fichier <text:span text:style-name="CodeDansTexte">exit-error.js</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Pour y remÃ©dier, il faut vÃ©rifier si on appelle bien la bonne variable ou la
crÃ©er avec la valeur attendue le cas Ã©chÃ©ant.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les erreurs d&#8217;exÃ©cution sont pernicieuses&#160;; elles sont parfois
provoquÃ©es aprÃ¨s le dÃ©marrage de l&#8217;application.
Dans l&#8217;exemple qui suit, l&#8217;une d&#8217;elles se produit deux secondes aprÃ¨s le
dÃ©marrage du script&#160;:
undefined
undefined</text:p>
<text:p text:style-name="Code">$ node runtime-error.js</text:p><text:p text:style-name="Code">setTimeout(() =&gt; console.log(<text:span text:style-name="CodeExergue">secret.toLocaleUperCase()</text:span>), 2000);</text:p><text:p text:style-name="Code"><text:s text:c="36"/>^</text:p><text:p text:style-name="Code"><text:span text:style-name="CodeExergue">TypeError</text:span>: <text:span text:style-name="CodeExergue">secret.toLocaleUperCase</text:span> <text:span text:style-name="CodeExergue">is not a function</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>at Timeout.setTimeout [as _onTimeout] (/.../chapter-04/examples/runtime-error.js:4:37)</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La notation <text:span text:style-name="CodeDansTexte">runtime-error.js:4:37</text:span> indique que l&#8217;origine de l&#8217;erreur
se trouve Ã  la <text:span text:style-name="T4">ligne&#160;4</text:span> du fichier <text:span text:style-name="CodeDansTexte">runtime-error.js</text:span>, <text:span text:style-name="T4">colonne&#160;37</text:span>.
Le type d&#8217;erreur (<text:span text:style-name="CodeDansTexte">TypeError</text:span>) signifie qu&#8217;on cherche Ã  manipuler une variable
de maniÃ¨re <text:span text:style-name="T7">inattendue par rapport Ã  son type</text:span>.
Le message d&#8217;erreur nous prÃ©cise qu&#8217;on appelle comme une fonction quelque chose
qui ne serait donc pas une fonction.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">En effet, le nom de la fonction est mal orthographiÃ© et <text:span text:style-name="CodeDansTexte">secret.toLocaleUperCase</text:span>
vaut <text:span text:style-name="CodeDansTexte">undefined</text:span>.
L&#8217;erreur sera corrigÃ©e en utilisant <text:span text:style-name="CodeDansTexte">secret.toLocaleUpperCase</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">npm</text:span> Module eslint</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
Le module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>&#160;<text:span text:style-name="CodeDansTexte">eslint</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/eslint" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/eslint</text:a></text:span>)
est un vÃ©rificateur syntaxique.
Son intention est de s&#8217;accorder sur le style d&#8217;Ã©criture et d&#8217;Ã©viter des
effets de bord du langage
qui causent des problÃ¨mes difficiles Ã  dÃ©celer.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">On apprendra Ã  le configurer dans l'<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-eslint"  text:visited-style-name="Visited_20_Internet_20_Link">annexe&#160;A</text:a>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les erreurs affichÃ©es affichent des informations importantes.
Si elles n&#8217;indiquent pas forcÃ©ment le chemin de rÃ©solution Ã©vident,
elles demandent qu&#8217;on cherche Ã  en comprendre la nature.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">npm</text:span> Module pretty-error</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
Le module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>&#160;<text:span text:style-name="CodeDansTexte">pretty-error</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/pretty-error" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/pretty-error</text:a></text:span>)
enjolive l&#8217;affichage des erreurs.
Il suffit de l&#8217;installer, de le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-require"  text:visited-style-name="Visited_20_Internet_20_Link">prÃ©charger</text:a> et
d&#8217;exÃ©cuter un script pour en bÃ©nÃ©ficier.</text:p>
<text:p text:style-name="RemarqueCode">$ node -r pretty-error/start process/exit-error.js</text:p>
<text:bookmark text:name="ref-une_erreur_est_retournÃ©e_dans_une_fonction_de_rappel" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Une erreur est retournÃ©e dans une fonction de rappel</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La fonction de rappel est un des moyens de retourner le rÃ©sultat
d&#8217;une exÃ©cution asynchrone.
Par convention, le premier paramÃ¨tre est une erreur.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce paramÃ¨tre est nul (<text:span text:style-name="CodeDansTexte">null</text:span>) ou indÃ©fini (<text:span text:style-name="CodeDansTexte">undefined</text:span>) lorsqu&#8217;il n&#8217;y a pas eu
d&#8217;erreurs en cours de route.
En revanche, il contient un objet d&#8217;erreur lorsque un problÃ¨me s&#8217;est produit.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">errors/callback.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {readFile} = require('fs');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">readFile('je-n-existe-pas.txt', (error, content) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>if (error) {<text:s text:c="42"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>console.error(error.message);<text:s text:c="23"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>console.error(error);<text:s text:c="31"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>return;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log(String(content));</text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> On vÃ©rifie la prÃ©sence de l&#8217;erreur.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> <text:span text:style-name="CodeDansTexte">error.message</text:span> contient une raison textuelle de l&#8217;erreur.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affichage de l&#8217;objet d&#8217;erreur complet.<text:line-break/></text:p>
<text:p text:style-name="Code">$ node errors/callback.js</text:p><text:p text:style-name="Code"><text:span text:style-name="CodeExergue">ENOENT</text:span>: <text:span text:style-name="CodeExergue">no such file or directory</text:span>, open '<text:span text:style-name="CodeExergue">je-n-existe-pas.txt</text:span>'</text:p><text:p text:style-name="Code">{ Error: ENOENT: no such file or directory, open 'je-n-existe-pas.txt'</text:p><text:p text:style-name="Code"><text:s text:c="2"/>errno: -2,</text:p><text:p text:style-name="Code"><text:s text:c="2"/>code: 'ENOENT',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>syscall: 'open',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>path: 'je-n-existe-pas.txt' }</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;erreur affichÃ©e nous prÃ©cise que le fichier demandÃ© n&#8217;existe pas.
Son code (<text:span text:style-name="CodeDansTexte">ENOENT</text:span>) signifie la mÃªme chose, mais a l&#8217;avantage d&#8217;Ãªtre plus
facile Ã  vÃ©rifier dans une condition.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;objet <text:span text:style-name="CodeDansTexte">error</text:span> donnÃ© en argument de la fonction de rappel est utile
pour vÃ©rifier des dÃ©tails prÃ©cis de l&#8217;erreur et mieux interagir avec
au niveau du code.
Nous y retrouvons le type d&#8217;erreur (<text:span text:style-name="CodeDansTexte">errno</text:span>),
la rÃ©fÃ©rence vers la ressource concernÃ©e (<text:span text:style-name="CodeDansTexte">path</text:span>) et le nom de la fonction
systÃ¨me utilisÃ©e par Node pour accÃ©der Ã  la ressource (<text:span text:style-name="CodeDansTexte">syscall</text:span>).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La valeur et la signification du code d&#8217;erreur varie en fonction
du module Node employÃ© Ã  ce moment-lÃ .
Le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-fs"  text:visited-style-name="Visited_20_Internet_20_Link">module&#160;<text:span text:style-name="CodeDansTexte">fs</text:span></text:a> ne retourne pas les mÃªmes codes
que le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-http"  text:visited-style-name="Visited_20_Internet_20_Link">module&#160;<text:span text:style-name="CodeDansTexte">http</text:span></text:a>.
Les appels Ã  des ressources systÃ¨me retournent
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-errors.system"  text:visited-style-name="Visited_20_Internet_20_Link">une variÃ©tÃ© de codes d&#8217;erreur</text:a>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La dÃ©cision nous appartient de savoir quoi faire quand l&#8217;erreur se produit.
Doit-on arrÃªter le programme avec <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process.exit"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">process.exit()</text:span></text:a>&#160;?
Passe-t-on Ã  la suite en considÃ©rant que ce n&#8217;est pas grave&#160;?
Ou peut-Ãªtre que ce fichier Ã©tait censÃ© exister et qu&#8217;on devrait
informer l&#8217;Ã©quipe de maintenance et
afficher une page d&#8217;erreur cÃ´tÃ© utilisateur.</text:p>
<text:bookmark text:name="ref-une_erreur_est_retournÃ©e_dans_une_promesse" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Une erreur est retournÃ©e dans une promesse</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La gestion d&#8217;erreur des <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-promise"  text:visited-style-name="Visited_20_Internet_20_Link">promesses</text:a>
s&#8217;effectue Ã  l&#8217;aide de la fonction <text:span text:style-name="CodeDansTexte">.catch()</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">errors/promise.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">Promise.resolve('ok')</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.then((message) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>throw new Error('Oops !');<text:s text:c="22"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>})</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.catch((error) =&gt; console.error(error));<text:s text:c="10"/><text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> On gÃ©nÃ¨re une erreur dans notre code.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> L&#8217;objet d&#8217;erreur est transmis Ã  la prochaine occurrence de <text:span text:style-name="CodeDansTexte">.catch()</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le contenu de l&#8217;erreur est accessible dans le seul argument de la fonction
de rappel passÃ©e Ã  <text:span text:style-name="CodeDansTexte">.catch()</text:span>.</text:p>
<text:p text:style-name="Code">$ node errors/promise.js</text:p><text:p text:style-name="Code">Error: <text:span text:style-name="CodeExergue">Oops !</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>at <text:span text:style-name="CodeExergue">Promise.resolve</text:span>.<text:span text:style-name="CodeExergue">then</text:span> (/.../chapter-04/examples/errors/<text:span text:style-name="CodeExergue">promise.js</text:span>:<text:span text:style-name="CodeExergue">5</text:span>:11)</text:p><text:p text:style-name="Code"><text:s text:c="4"/>at process._tickCallback (internal/process/next_tick.js:178:7)</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La trace indique que l&#8217;erreur s&#8217;est produite Ã  la <text:span text:style-name="T4">ligne&#160;5</text:span>,
dans la mÃ©thode <text:span text:style-name="CodeDansTexte">.then()</text:span> suite Ã  l&#8217;utilisation de <text:span text:style-name="CodeDansTexte">Promise.resolve()</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;utilisation multiple de <text:span text:style-name="CodeDansTexte">.catch()</text:span> nous aide Ã  gÃ©rer finement les erreurs&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">errors/promise-chain.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">Promise.reject(new Error('Oops !'))</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.catch((error) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>console.error('Erreur : %s', error.message);<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>return 'Aaah';<text:s text:c="32"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>})</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.then((message) =&gt; console.log(message))<text:s text:c="8"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>.catch((error) =&gt; console.error(error));<text:s text:c="8"/><text:span text:style-name="PuceCode">4</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> On gÃ¨re l&#8217;erreur en la signalant dans le terminal.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> La fonction de rappel a la possibilitÃ© de retourner un rÃ©sultat.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Ce rÃ©sultat est transmis Ã  la prochaine occurrence de <text:span text:style-name="CodeDansTexte">.then()</text:span>.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Dans ce cas, le dernier <text:span text:style-name="CodeDansTexte">.catch()</text:span> n&#8217;affiche rien car nous n&#8217;avons pas rencontrÃ© d&#8217;autre erreur entre-temps.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">errors/promise-no-catch.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">Promise.resolve('ok')</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.then(() =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>throw new Error('Oops !');</text:p><text:p text:style-name="Code"><text:s text:c="2"/>});</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;absence de <text:span text:style-name="CodeDansTexte">.catch()</text:span> provoque un plantage applicatif et le dÃ©lenchement
de l'<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process.on"  text:visited-style-name="Visited_20_Internet_20_Link">Ã©vÃ©nement de processus</text:a> <text:span text:style-name="CodeDansTexte">unhandledRejection</text:span>&#160;:</text:p>
<text:p text:style-name="Code">$ node errors/promise-no-catch.js</text:p><text:p text:style-name="Code">(node:27412) <text:span text:style-name="CodeExergue">UnhandledPromiseRejectionWarning</text:span>: Error: Oops !</text:p><text:p text:style-name="Code"><text:s text:c="4"/>at <text:span text:style-name="CodeExergue">Promise.resolve</text:span>.<text:span text:style-name="CodeExergue">then</text:span> (/.../chapter-04/examples/errors/<text:span text:style-name="CodeExergue">promise-no-catch.js</text:span>:<text:span text:style-name="CodeExergue">5</text:span>:11)</text:p><text:p text:style-name="Code"><text:s text:c="4"/>at process._tickCallback (internal/process/next_tick.js:178:7)</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;affichage de <text:span text:style-name="CodeDansTexte">UnhandledPromiseRejectionWarning</text:span> indique que l&#8217;erreur s&#8217;est
produite mais qu&#8217;aucun <text:span text:style-name="CodeDansTexte">.catch()</text:span> ne l&#8217;a pris en charge.
Nous savons cependant que l&#8217;erreur s&#8217;est produite dans la mÃ©thode <text:span text:style-name="CodeDansTexte">.then()</text:span>
suite Ã  l&#8217;utilisation de <text:span text:style-name="CodeDansTexte">Promise.resolve()</text:span>.
undefined</text:p>
<text:bookmark text:name="ref-une_erreur_est_retournÃ©e_dans_un_Ã©vÃ©nement" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Une erreur est retournÃ©e dans un Ã©vÃ©nement</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Tout Ã©lÃ©ment dotÃ© d&#8217;une mÃ©thode <text:span text:style-name="CodeDansTexte">.on()</text:span> a un Ã©vÃ©nement spÃ©cial&#160;: <text:span text:style-name="CodeDansTexte">.on('error')</text:span>.
Il est appelÃ© Ã  chaque fois qu&#8217;une erreur se produit.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">errors/on-error.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">process.emit('error', new Error('Oops !'));<text:s text:c="13"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">process.on('error', (error) =&gt; console.error(error));<text:s text:c="3"/><text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> On Ã©met un Ã©vÃ©nement <text:span text:style-name="CodeDansTexte">error</text:span> avec un objet <text:span text:style-name="CodeDansTexte">Error</text:span> prÃ©cisant la nature du problÃ¨me.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> L&#8217;objet d&#8217;erreur est transmis Ã  l&#8217;Ã©vÃ©nement <text:span text:style-name="CodeDansTexte">error</text:span>.<text:line-break/></text:p>
<text:p text:style-name="Code">$ node errors/on-error.js</text:p><text:p text:style-name="Code">Error: <text:span text:style-name="CodeExergue">Oops !</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>at Object.<text:span text:style-name="CodeExergue">&amp;lt;anonymous&amp;gt;</text:span> (/.../chapter-04/examples/errors/<text:span text:style-name="CodeExergue">on-error.js</text:span>:<text:span text:style-name="CodeExergue">5</text:span>:23)</text:p><text:p text:style-name="Code"><text:s text:c="4"/>at Module._compile (internal/modules/cjs/loader.js:678:30)</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La trace d&#8217;erreur est similaire Ã  celle des promesses et des fonctions de rappel.
Le message d&#8217;erreur prÃ©cise le problÃ¨me tandis que son origine (fichier, ligne)
nous indiquent quoi regarder pour mieux comprendre la cause.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Si une erreur est Ã©mise et si aucune fonction n&#8217;est Ã  l&#8217;Ã©coute,
l&#8217;Ã©vÃ©nement <text:span text:style-name="CodeDansTexte">uncaughtException</text:span> est produit&#160;:
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">errors/on-error.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">process.emit('error', new Error('Oops !'));</text:p>
<text:p text:style-name="Code">$ node errors/on-error-uncaught.js</text:p><text:p text:style-name="Code">events.js:167</text:p><text:p text:style-name="Code"><text:s text:c="6"/>throw er; // <text:span text:style-name="CodeExergue">Unhandled 'error'</text:span> event</text:p><text:p text:style-name="Code"><text:s text:c="6"/>^</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">Error: Oops !</text:p><text:p text:style-name="Code"><text:s text:c="4"/>at Object.<text:span text:style-name="CodeExergue">&amp;lt;anonymous&amp;gt;</text:span> (/.../chapter-04/examples/errors/<text:span text:style-name="CodeExergue">on-error-uncaught.js</text:span>:<text:span text:style-name="CodeExergue">3</text:span>:23)</text:p><text:p text:style-name="Code"><text:s text:c="4"/>at Module._compile (internal/modules/cjs/loader.js:678:30)</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La section liÃ©e au <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-events"  text:visited-style-name="Visited_20_Internet_20_Link">module <text:span text:style-name="CodeDansTexte">events</text:span></text:a> explique plus en dÃ©tail
la gestion des Ã©vÃ©nements.
undefined
On les retrouve par exemple dans les modules <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-http"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">http</text:span></text:a>, <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-stream"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">stream</text:span></text:a>
et <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">process</text:span></text:a>.</text:p>
<text:bookmark text:name="ref-errors.system" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Une erreur est renvoyÃ©e par le systÃ¨me d&#8217;exploitation</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;accÃ¨s Ã  une ressource distante est plus complexe qu&#8217;il n&#8217;y paraÃ®t
car les erreurs sont de natures variÃ©es et sujettes Ã  interprÃ©tation au cas par cas,
en fonction de notre intention et du contexte d&#8217;exÃ©cution.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les erreurs systÃ¨me indiquent la raison du problÃ¨me.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TableauTitre">Tableau 3. Erreurs couramment rencontrÃ©es</text:p><table:table table:style-name="Tableau1"><table:table-column />,<table:table-column />,<table:table-column /><table:table-row><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Code erreur</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Raison</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Piste de rÃ©solution</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">EACCES</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Permission refusÃ©e : nous n&#8217;avons pas le droit d&#8217;accÃ©der Ã  cette ressource.</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Changer les permissions d&#8217;accÃ¨s sans mettre en pÃ©ril la sÃ©curitÃ©.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">EADDRINUSE</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Adresse dÃ©jÃ  utilisÃ©e : nous tentons de crÃ©er une ressource rÃ©seau alors qu&#8217;une
interface existe dÃ©jÃ  Ã  la mÃªme adresse.</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>VÃ©rifier l&#8217;origine du serveur dÃ©jÃ  en place Ã  cette adresse. Attribuer une autre adresse/port Ã  la ressource rÃ©seau.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">ECONNREFUSED</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>La ressource distante a refusÃ© la connexion.</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>VÃ©rifier si c&#8217;est normal que la ressource distante soit inactive. VÃ©rifier qu&#8217;on se connecte Ã  la bonne ressource.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">ECONNRESET</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>La ressource distante a Ã©tÃ© interrompue en cours de route.</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Retenter la connexion. VÃ©rifier la stabilitÃ© de la connexion rÃ©seau.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">EEXIST</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>La ressource Ã  crÃ©er existe&#160;dÃ©jÃ .</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>C&#8217;est un problÃ¨me seulement si la ressource n&#8217;Ã©tait pas censÃ©e exister au prÃ©alable.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">EMFILE</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Trop de fichiers sont ouverts simultanÃ©ment.</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Les systÃ¨mes d&#8217;exploitation peuvent travailler sur une quantitÃ© finie de fichiers. Peut-Ãªtre que vous avez ouvert trop de fichiers en mÃªme temps. Fermer l&#8217;accÃ¨s aux fichiers ouverts.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">ENOENT</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Ressource inexistante.</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>VÃ©rifier que le chemin d&#8217;accÃ¨s est correct. Inspecter la raison de l&#8217;inexistance de la ressource.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">EPERM</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>L&#8217;opÃ©ration n&#8217;est pas autorisÃ©e.</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Des droits d&#8217;administration sont nÃ©cessaires pour effectuer cette opÃ©ration.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">EPIPE</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>L&#8217;accÃ¨s Ã  la ressource distante a Ã©tÃ© interrompu.</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Retenter l&#8217;opÃ©ration.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">ETIMEDOUT</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>L&#8217;opÃ©ration a Ã©tÃ© annulÃ©e car la ressource distante a mis trop de temps pour aboutir.</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Retenter l&#8217;opÃ©ration. VÃ©rifier la disponibilitÃ© de la ressource distante. S&#8217;assurer que le volume demandÃ© n&#8217;est pas trop important.</text:p></table:table-cell></table:table-row></table:table>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined
undefined
undefined
undefined
undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-le_programme_ne_se_termine_pas" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Le programme ne se termine pas</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il arrive qu&#8217;un programme ne se termine pas contrairement Ã  nos attentes.
Il peut y avoir plusieurs raisons Ã  cela&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">Une ressource distante <text:span text:style-name="T7">met du temps Ã  rÃ©pondre</text:span>&#160;â€“
un <text:span text:style-name="T4">timeout</text:span> dÃ©clenchera une erreur (gÃ©nÃ©ralement sous&#160;30&#160;s).</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Un traitement prend du temps.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Un <text:span text:style-name="T7">Ã©vÃ©nement est en cours d&#8217;Ã©coute</text:span>&#160;â€“ typiquement un serveur web qui attend
des requÃªtes entrantes.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Une erreur n&#8217;a pas Ã©tÃ© capturÃ©e et perturbe les instructions suivantes.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il faudra inspecter le systÃ¨me pour en savoir plus et observer la
consommation mÃ©moire et CPU du processus Node en question.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Peut-Ãªtre qu&#8217;il faudra sonder le programme pour dÃ©celer le point de blocage.
L'<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-inspect"  text:visited-style-name="Visited_20_Internet_20_Link">inspecteur Node</text:a> est un outil particuliÃ¨rement adaptÃ© Ã  cet usage.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">npm</text:span> Module debug</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
Le module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>&#160;<text:span text:style-name="CodeDansTexte">debug</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/debug" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/debug</text:a></text:span>) affiche des
messages dans la console de maniÃ¨re conditionnelle.
Les messages s&#8217;affichent lorsque les variables d&#8217;environnement de notre choix
sont renseignÃ©es au dÃ©marrage de l&#8217;application.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">On apprendra Ã  le configurer dans l'<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-debug"  text:visited-style-name="Visited_20_Internet_20_Link">annexe&#160;A</text:a>.</text:p>
<text:bookmark text:name="ref-deprecation" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Une alerte de dÃ©prÃ©ciation s&#8217;affiche</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un des objectifs de l&#8217;Ã©quipe dÃ©veloppant Node est de maintenir
la stabilitÃ© de la plate-forme.
Certains de leurs choix de conception sont revisitÃ©s en changeant
leur comportement ou en les retirant des modules de&#160;base.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Quand ce changement affecte notre code, une alerte de dÃ©prÃ©ciation s&#8217;affiche.
Par exemple&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">deprecation-warning.js</text:p><text:p text:style-name="Code">const a = new Buffer(10);</text:p>
<text:p text:style-name="Code">$ node deprecation-warning.js</text:p><text:p text:style-name="Code">(node:8130) [DEP0005] DeprecationWarning: Buffer() is deprecated due to security and usability issues. Please use the Buffer.alloc(), Buffer.allocUnsafe(), or Buffer.from() methods instead.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous avons ainsi le temps de modifier notre code pour migrer
vers la nouvelle recommandation petit Ã  petit.</text:p>
<text:bookmark text:name="ref-les_diffÃ©rences_decmascript_entre_node_et_les_navigateursweb" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Les diffÃ©rences d&#8217;ECMAScript entre Node et les navigateurs&#160;web</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Puisqu&#8217;on utilise du code ECMAScript avec Node et avec les navigateurs web,
qu&#8217;est-ce qui les distingue vraiment&#160;?</text:p>
<text:bookmark text:name="ref-labsence_du_dom_et_des_variables_window_et_document" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">L&#8217;absence du DOM et des variables <text:span text:style-name="">window</text:span> et <text:span text:style-name="">document</text:span></text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans Node, il n&#8217;est pas possible de faire appel aux variables <text:span text:style-name="CodeDansTexte">window</text:span>
et <text:span text:style-name="CodeDansTexte">document</text:span> (raccourci pour <text:span text:style-name="CodeDansTexte">window.document</text:span>).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ces variables reprÃ©sentent respectivement la fenÃªtre/onglet et le document
HTML interprÃ©tÃ© par le navigateur web.
Les fonctions <text:span text:style-name="CodeDansTexte">document.querySelector()</text:span> et <text:span text:style-name="CodeDansTexte">document.createElement()</text:span>
relÃ¨vent du DOM (<text:span text:style-name="T4">Document Object Model</text:span>), une reprÃ©sentation JavaScript interactive
du document&#160;HTML.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;Ã©quivalent de <text:span text:style-name="CodeDansTexte">window</text:span> pour Node serait la variable <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">process</text:span></text:a>&#160;:
elle dÃ©crit le processus exÃ©cutant notre code.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> Variables globales</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">La documentation des variables globales est disponible sur le site officiel de Node&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://nodejs.org/docs/latest-v10.x/api/globals.html" text:visited-style-name="Visited_20_Internet_20_Link">https://nodejs.org/docs/latest-v10.x/api/globals.html</text:a></text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-il_ny_a_pas_dinterface_graphique" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Il n&#8217;y a pas d&#8217;interface graphique</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Suite logique du point prÃ©cÃ©dent&#160;: Node n&#8217;a pas d&#8217;interface graphique.
Le code exÃ©cutÃ© n&#8217;affiche rien en tant que tel, Ã  part les messages dirigÃ©s
vers la <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-console"  text:visited-style-name="Visited_20_Internet_20_Link">console</text:a>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L'<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-inspect"  text:visited-style-name="Visited_20_Internet_20_Link">inspecteur Node</text:a> est un moyen de visualiser l&#8217;Ã©tat interne
d&#8217;un script.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">On peut toutefois construire des applications graphiques en ligne de commande
(<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-08"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;8</text:a>).</text:p>
<text:bookmark text:name="ref-le_mÃ©canisme_de_modules" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Le mÃ©canisme de modules</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Pour l&#8217;instant, Node utilise un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-modules"  text:visited-style-name="Visited_20_Internet_20_Link">mÃ©canisme de modules</text:a> (CommonJS)
diffÃ©rent des modules ECMAScript des navigateurs.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La convergence vers les modules ECMAScript est en cours.
Il y a fort Ã  parier qu&#8217;ils seront pris en charge nativement par Node dans une
version ultÃ©rieure.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous verrons au <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-08"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;9</text:a> comment utiliser
les modules Node dans les navigateurs.</text:p>
<text:bookmark text:name="ref-linterfaÃ§age_avec_le_systÃ¨me_dexploitation" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">L&#8217;interfaÃ§age avec le systÃ¨me d&#8217;exploitation</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les fonctions ECMAScript spÃ©cifiques aux navigateurs sont liÃ©es
Ã  la rÃ©cupÃ©ration d&#8217;informations (<text:span text:style-name="CodeDansTexte">AJAX</text:span>, <text:span text:style-name="CodeDansTexte">fetch()</text:span>),
Ã  l&#8217;affichage (Canvas, WebGL, WebVR) ainsi qu&#8217;Ã  la manipulation de
documents&#160;HTML.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les fonctions ECMAScript fournies par les <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-modules-builtin"  text:visited-style-name="Visited_20_Internet_20_Link">modules Node</text:a>
sont liÃ©es Ã  la gestion des ressources dont le systÃ¨me d&#8217;exploitation
se fait l&#8217;interface&#160;: fichiers&#160;(<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-fs"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">fs</text:span></text:a>),
rÃ©seau&#160;(<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-http"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">http</text:span></text:a>, <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-net"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">net</text:span></text:a>, <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-dns"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">dns</text:span></text:a>,
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-dgram"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">dgram</text:span></text:a>), terminal&#160;(<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-tty"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">tty</text:span></text:a>, <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-readline"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">readline</text:span></text:a>)
et processus&#160;(<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">process</text:span></text:a>, <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-child_process"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">child_process</text:span></text:a>).</text:p>
<text:bookmark text:name="ref-node_est_un_processus_systÃ¨me" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Node est un processus systÃ¨me</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le systÃ¨me d&#8217;exploitation crÃ©e un nouveau processus dÃ¨s
qu&#8217;on exÃ©cute le programme <text:span text:style-name="CodeDansTexte">node</text:span>.
Il peut Ãªtre de courte ou de longue durÃ©e, selon qu&#8217;il dure quelques secondes
ou un temps indÃ©fini.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le processus s&#8217;arrÃªte en cas d&#8217;erreur, lorsqu&#8217;il n&#8217;y a plus d&#8217;opÃ©ration
Ã  effectuer ou en cas d&#8217;interruption volontaire.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le code ECMAScript exÃ©cutÃ© dans un navigateur dÃ©passe rarement la durÃ©e
d&#8217;une session utilisateur, de quelques secondes Ã  quelques heures.
En cas de problÃ¨me, un rafraÃ®chissement de la page remet Ã  zÃ©ro son&#160;Ã©tat.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Performances</text:span> Utilisation des&#160;CPU</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Un processus Node est <text:span text:style-name="T4">mono</text:span> CPU.
Tous les autres processus systÃ¨me affectÃ©s Ã  cette mÃªme CPU
se partageront une quantitÃ© finie de puissance.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Par exemple, si un processus Node partage la mÃªme CPU qu&#8217;une base de donnÃ©es
et si une requÃªte gourmande s&#8217;exÃ©cute, la rapiditÃ© de notre application
en sera affectÃ©e.</text:p>
<text:bookmark text:name="ref-options" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Options utiles pour dÃ©marrer&#160;Node</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">node</text:span> accepte plusieurs options afin de personnaliser
son comportement et l&#8217;affichage des rÃ©sultats.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> ExÃ©cutable&#160;node</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">La documentation de l&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">node</text:span> est disponible sur le site officiel&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://nodejs.org/docs/latest-v10.x/api/cli.html" text:visited-style-name="Visited_20_Internet_20_Link">https://nodejs.org/docs/latest-v10.x/api/cli.html</text:a></text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-print-eval" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Afficher le rÃ©sultat d&#8217;une expression, sans&#160;script</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;interprÃ©teur Node sait interprÃ©ter du code qu&#8217;on lui donne
via l&#8217;option&#160;<text:span text:style-name="CodeDansTexte">-p</text:span> (pour <text:span text:style-name="T4">print</text:span>, c&#8217;est-Ã -dire <text:span text:style-name="T4">afficher</text:span>).
Il affiche le rÃ©sultat de l&#8217;expression ou dÃ©taille la <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-errors"  text:visited-style-name="Visited_20_Internet_20_Link">raison de l&#8217;erreur</text:a>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">J&#8217;utilise cette forme d&#8217;interaction pour obtenir un rÃ©sultat rapide,
sans crÃ©er de nouveau fichier, par exemple, pour une opÃ©ration mathÃ©matique&#160;:</text:p>
<text:p text:style-name="Code">$ node -p '2 + 2'</text:p><text:p text:style-name="Code">4</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Toute expression ECMAScript valide est acceptÃ©e&#160;:</text:p>
<text:p text:style-name="Code">$ node -p '"abc".toLocaleUpperCase()'</text:p><text:p text:style-name="Code">ABC</text:p>
<text:bookmark text:name="ref-options-require" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">PrÃ©charger un module</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;option de dÃ©marrage <text:span text:style-name="CodeDansTexte">--require</text:span> charge le module indiquÃ© avant le script&#160;Node.</text:p>
<text:p text:style-name="Code">$ node --require ./print-exit.js url/intro.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans cet exemple, le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-modules"  text:visited-style-name="Visited_20_Internet_20_Link">module <text:span text:style-name="CodeDansTexte">print-exit.js</text:span></text:a> sera chargÃ©
avant <text:span text:style-name="CodeDansTexte">url/intro.js</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">print-exit.js</text:p><text:p text:style-name="Code">process.on('exit', (code) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const {filename} = process.mainModule;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log(`${filename} : arrÃªt avec le code ${code}`);</text:p><text:p text:style-name="Code">});</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le chargement de ce module aura pour effet d&#8217;afficher un message
avec le chemin du fichier chargÃ© et le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process.exit"  text:visited-style-name="Visited_20_Internet_20_Link">code de sortie</text:a>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">On peut appeler l&#8217;option <text:span text:style-name="CodeDansTexte">--require</text:span> plusieurs fois, ou son raccourci&#160;`-r`.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce mÃ©canisme fonctionne trÃ¨s bien avec des
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-05"  text:visited-style-name="Visited_20_Internet_20_Link">modules&#160;<text:span text:style-name="CodeDansTexte">npm</text:span></text:a> conÃ§us pour
rendre nos scripts <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-esm"  text:visited-style-name="Visited_20_Internet_20_Link">compatibles avec les modules ECMAScript</text:a>
ou pour <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-pretty-error"  text:visited-style-name="Visited_20_Internet_20_Link">simplifier les erreurs</text:a> affichÃ©es
lors d&#8217;un plantage applicatif, entre autres.</text:p>
<text:bookmark text:name="ref-inspect" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Inspecter notre code avec Google&#160;Chrome</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Node accepte deux options <text:span text:style-name="CodeDansTexte">--inspect</text:span> et <text:span text:style-name="CodeDansTexte">--inspect-brk</text:span>.
Elles exposent un protocole de dÃ©bogage auquel on peut se connecter
avec le navigateur Chrome.</text:p>
<text:p text:style-name="Code">$ node --inspect-brk print-text.js texte --uppercase</text:p><text:p text:style-name="Code">Debugger listening on ws://127.0.0.1:9229/ddd9bbfd-09ac-4426-a53e-c8abe4fc36da</text:p><text:p text:style-name="Code">For help see https://nodejs.org/en/docs/inspector</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette commande lance un de nos exemples de la section
sur le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process"  text:visited-style-name="Visited_20_Internet_20_Link">module&#160;<text:span text:style-name="CodeDansTexte">process</text:span></text:a>.
L&#8217;option <text:span text:style-name="CodeDansTexte">--inspect-brk</text:span> dÃ©marre l&#8217;inspecteur
et met aussitÃ´t son exÃ©cution en pause.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le logo de Node s&#8217;affiche dans les outils de dÃ©veloppement de Chrome&#160;:</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-04/images/chrome-devtools.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>4-undefined.</text:span> Outils de dÃ©veloppement Google Chrome avec l&#8217;icÃ´ne de l&#8217;inspecteur&#160;Node</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un clic sur le logo Node ouvre une nouvelle fenÃªtre, outillÃ©e pour inspecter
ce qui se passe dans notre script.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-04/images/inspector-paused.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>4-undefined.</text:span> Inspecteur en pause sur la premiÃ¨re ligne de notre script&#160;Node</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Outils de dÃ©veloppement</text:span> Point d&#8217;arrÃªt</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Un point d&#8217;arrÃªt se crÃ©e en cliquant sur le numÃ©ro de ligne souhaitÃ©.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Le dÃ©bogueur se mettra en pause Ã  chaque fois que le chemin d&#8217;exÃ©cution
de l&#8217;interprÃ©teur atteindra cette ligne.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">La valeur des variables ECMAScript courantes s&#8217;affichent au survol de la souris
ou en interagissant avec la console.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-04/images/inspector-breakpoint.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>4-undefined.</text:span> Inspecteur en pause, avec un point d&#8217;arrÃªt marquÃ© sur une des lignes du&#160;script</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">C&#8217;est le moment idÃ©al pour placer un ou plusieurs point(s) d&#8217;arrÃªt.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un clic sur le bouton&#160;<text:span text:style-name="CodeDansTexte">&#9654;</text:span> met alors fin Ã  la pause.
Le script s&#8217;exÃ©cutera jusqu&#8217;Ã  l&#8217;Ã©puisement des instructions
ou jusqu&#8217;au <text:span text:style-name="T4">prochain point d&#8217;arrÃªt</text:span>.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-04/images/inspector-breakpoint-in.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>4-undefined.</text:span> Inspecteur en pause, suite Ã  la rencontre d&#8217;un point d&#8217;arrÃªt</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;option <text:span text:style-name="CodeDansTexte">--inspect</text:span> est adaptÃ©e Ã  des processus de longue durÃ©e,
comme un serveur HTTP.
L&#8217;option <text:span text:style-name="CodeDansTexte">--inspect-brk</text:span> est adaptÃ©e Ã  des processus de courte durÃ©e et qui
se termineraient avant qu&#8217;on ait le temps de jeter un Å“il au contenu.</text:p>
<text:bookmark text:name="ref-options-v8" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Ajuster les options de compatibilitÃ© et de traÃ§abilitÃ© de&#160;V8</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Node repose sur la <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-v8"  text:visited-style-name="Visited_20_Internet_20_Link">machine virtuelle&#160;V8</text:a>
pour interprÃ©ter nos instructions ECMAScript et en expose diffÃ©rentes options
pour affiner son comportement en fonction
de notre environnement.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;intÃ©gralitÃ© des options de configuration de&#160;V8 s&#8217;affiche
avec l&#8217;option <text:span text:style-name="CodeDansTexte">--v8-options</text:span>&#160;:</text:p>
<text:p text:style-name="Code">$ node --v8-options</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il n&#8217;y a pas de meilleure configuration qui conviendrait Ã  chacun de nos usages.
Le mieux reste encore d&#8217;explorer les options possibles, les diffÃ©rents concepts
et d&#8217;ajuster les valeurs offrant le meilleur rapport stabilitÃ©/performances.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">--optimize_for_size</text:span></text:h>
<text:p text:style-name="Remarque">Optimise le fonctionnement interne pour utiliser moins de mÃ©moire,
au dÃ©triment de la vitesse.
IdÃ©al pour l&#8217;exÃ©cution de scripts Node sur des environnements Ã  faible mÃ©moire,
comme les Raspberry&#160;Pi.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">--mem_old_space_limit</text:span></text:h>
<text:p text:style-name="Remarque">DÃ©termine la quantitÃ© de mÃ©moire maximale qu&#8217;un processus Node pourra utiliser.
IdÃ©al pour le confiner sur des environnements Ã  faible mÃ©moire.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">--gc_inverval</text:span></text:h>
<text:p text:style-name="Remarque">DÃ©termine le nombre de cycles entre chaque dÃ©clenchement du ramasse-miettes.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">--expose_gc</text:span></text:h>
<text:p text:style-name="Remarque">Expose les fonctions de manipulation du ramasse-miettes.
IdÃ©al si vous souhaitez contrÃ´ler finement l&#8217;optimisation de la mÃ©moire.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">--stack_trace_limit</text:span></text:h>
<text:p text:style-name="Remarque">Change la limite du nombre de lignes affichÃ©es dans une trace d&#8217;erreur
(10 par dÃ©faut).</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">--trace-deopt</text:span></text:h>
<text:p text:style-name="Remarque">Signale les optimisations invalidÃ©es par&#160;V8.
Les portions de code indiquÃ©es gagneraient Ã  Ãªtre retravaillÃ©es, pour rendre
uniforme le type de variables passÃ©es en arguments par exemple.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">--trace-gc</text:span></text:h>
<text:p text:style-name="Remarque">Signale les moments oÃ¹ le ramasse-miettes se dÃ©clenche.
On peut ainsi mieux en comprendre les raisons.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Notion</text:span> Ramasse-miettes (<text:span text:style-name="T4">garbage collector</text:span>)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Le ramasse-miettes est un mÃ©canisme informatique qui libÃ¨re les objets inutilisÃ©s
de la mÃ©moire.
Il est dÃ©clenchÃ© de maniÃ¨re cyclique par la
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-v8"  text:visited-style-name="Visited_20_Internet_20_Link">machine virtuelle&#160;V8</text:a>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://fr.wikipedia.org/wiki/Ramasse-miettes_(informatique" text:visited-style-name="Visited_20_Internet_20_Link">https://fr.wikipedia.org/wiki/Ramasse-miettes_(informatique</text:a>)</text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les options prÃ©fixÃ©es par <text:span text:style-name="CodeDansTexte">harmony</text:span> activent la prise en charge
de fonctionnalitÃ©s ECMAScript qui ne font pas encore partie du standard.
Elles sont encore au stade expÃ©rimental.</text:p>
<text:bookmark text:name="ref-conclusion_4" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Conclusion</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les modules de base sont un Ã©lÃ©ment diffÃ©renciant entre Node et le langage
ECMAScript.
Ils nous interfacent avec le systÃ¨me d&#8217;exploitation pour naviguer dans les fichiers,
ouvrir des connexions rÃ©seau et tÃ©lÃ©charger des fichiers distants.
<text:span text:style-name="T7">Bien les connaÃ®tre nous aidera au quotidien</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;organisation des modules CommonJS&#160;â€“ voire des modules ECMAScript&#160;â€“ est l&#8217;autre
Ã©lÃ©ment majeur de ce chapitre.
Avec cela, nous rendons notre <text:span text:style-name="T7">code modulaire, rÃ©utilisable et donc testable</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Toutes ces connaissances seront largement rÃ©utilisÃ©es dans les chapitres suivants.
Elles nous aideront Ã  mieux choisir nos modules&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> dans le chapitre&#160;5,
Ã  structurer une application web au chapitre&#160;7, Ã  crÃ©er de belles applications
en ligne de commande au chapitre&#160;8 et mÃªme Ã  partager du code entre Node
et les navigateurs au chapitre&#160;9.</text:p>
<text:bookmark text:name="ref-chapter-05" /><text:p text:style-name="ChapitreNumero">5</text:p><text:h text:style-name="ChapitreTitre" text:outline-level="1">Jouer avec&#160;npm</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Savoir naviguer dans la richesse de l&#8217;Ã©cosystÃ¨me&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> est une force pour
la durabilitÃ© de nos projets.
Ces modules nous aident Ã  faÃ§onner un outillage rÃ©silient et adaptÃ© Ã  chacun
de nos projets.</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">CrÃ©er un fichier <text:span text:style-name="CodeDansTexte">package.json</text:span></text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Installer un module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span></text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Outiller un projet avec les scripts&#160;<text:span text:style-name="CodeDansTexte">npm</text:span></text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Anatomie du fichier <text:span text:style-name="CodeDansTexte">package.json</text:span></text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Quelques commandes pour aller plus loin</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Questions et mystÃ¨res autour de&#160;<text:span text:style-name="CodeDansTexte">npm</text:span></text:p>
</text:list-item></text:list>
<text:p text:style-name="ChapitreIntroduction"><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce chapitre va nous permettre d&#8217;y voir plus clair du cÃ´tÃ© des <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-modules"  text:visited-style-name="Visited_20_Internet_20_Link">modules <text:span text:style-name="CodeDansTexte">npm</text:span></text:a>.
Nous apprendrons comment identifier des modules de confiance, les installer et
les mettre Ã  jour sans casser nos projets.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous nous tournerons ensuite du cÃ´tÃ© des <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-scripts"  text:visited-style-name="Visited_20_Internet_20_Link">scripts&#160;<text:span text:style-name="CodeDansTexte">npm</text:span></text:a> pour crÃ©er
un outillage sur mesure et de qualitÃ©.
GrÃ¢ce Ã  eux, nous serons en mesure d&#8217;automatiser les tÃ¢ches rÃ©pÃ©titives Ã  notre
rythme.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Enfin, nous dÃ©couvrirons des commandes moins connues de&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>.
Elles pourrons nous faciliter la vie ou nous dÃ©bloquer quand Ã§a ne va pas.</text:p></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Remarque</text:span> Versions de Node et npm</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Le contenu de ce chapitre utilise les versions <text:span text:style-name="T7">Node&#160;v10</text:span>
et <text:span text:style-name="T7">npm&#160;v6</text:span>.
Ce sont les versions stables recommandÃ©es en&#160;2019.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le mot <text:span text:style-name="T4">npm</text:span> correspond Ã  trois concepts diffÃ©rents que nous aborderons
tout au long de ce chapitre&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">l'<text:span text:style-name="T7">exÃ©cutable</text:span> <text:span text:style-name="CodeDansTexte">npm</text:span>&#160;â€“ un programme Ã©crit en ECMAScript&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">le <text:span text:style-name="T7">registre</text:span> <text:span text:style-name="CodeDansTexte">npm</text:span>&#160;â€“ une plate-forme de distribution de modules&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">un <text:span text:style-name="T7">module</text:span> <text:span text:style-name="CodeDansTexte">npm</text:span>&#160;â€“ en gÃ©nÃ©ral installÃ© depuis le registre et utilisable
avec les fonctions <text:span text:style-name="CodeDansTexte">require()</text:span> et <text:span text:style-name="CodeDansTexte">import</text:span>.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Je prÃ©ciserai toujours si l&#8217;utilisation de <text:span text:style-name="CodeDansTexte">npm</text:span> fait rÃ©fÃ©rence
Ã  l'<text:span text:style-name="T4">exÃ©cutable</text:span>, au <text:span text:style-name="T4">registre</text:span> ou Ã  un <text:span text:style-name="T4">module</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">npm</text:span> est installÃ© par dÃ©faut avec Node.
VÃ©rifions la version installÃ©e en ouvrant un terminal
et en Ã©crivant la commande suivante&#160;:</text:p>
<text:p text:style-name="Code">$ npm --version</text:p><text:p text:style-name="Code">6.4.0</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Si un message s&#8217;affiche en indiquant que <text:span text:style-name="CodeDansTexte">npm</text:span> n&#8217;est pas un programme reconnu,
veuillez vous rÃ©fÃ©rer au <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-../chapter-02/index.adoc"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;2</text:a> et
vÃ©rifier que Node v10 est bien installÃ©.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Pratique</text:span> Jouer avec les exemples dans un terminal</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Les exemples titrÃ©s d&#8217;un nom de fichier peuvent Ãªtre installÃ©s sur votre ordinateur.
ExÃ©cutez-les dans un terminal et amusez-vous Ã  les modifier en parallÃ¨le de
votre lecture pour voir ce qui change.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Installation des exemples via le module npm <text:span text:style-name="CodeDansTexte">nodebook</text:span></text:p><text:p text:style-name="RemarqueCode">$ npm install --global nodebook</text:p><text:p text:style-name="RemarqueCode">$ nodebook install chapter-05</text:p><text:p text:style-name="RemarqueCode">$ cd $(nodebook dir chapter-05)</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">La commande suivante devrait afficher un rÃ©sultat qui confirme que vous Ãªtes
au bon endroit&#160;:</text:p>
<text:p text:style-name="RemarqueCode">$ node hello.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Suivez Ã  nouveau les instructions d&#8217;installation pour rÃ©tablir les exemples
dans leur Ã©tat initial.</text:p>
<text:bookmark text:name="ref-cli" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">CrÃ©er un fichier <text:span text:style-name="">package.json</text:span></text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La prÃ©sence d&#8217;un fichier <text:span text:style-name="CodeDansTexte">package.json</text:span> devient nÃ©cessaire dÃ¨s qu&#8217;un projet
inclut un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-modules"  text:visited-style-name="Visited_20_Internet_20_Link">module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span></text:a> ou a vocation Ã  Ãªtre publiÃ© pour Ãªtre repris
dans un autre projet&#160;â€“ que ce soit dans un cadre professionnel ou personnel.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le fichier <text:span text:style-name="CodeDansTexte">package.json</text:span> est la clÃ© de voÃ»te servant Ã  reproduire l&#8217;installation
du projet et crÃ©er un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-scripts"  text:visited-style-name="Visited_20_Internet_20_Link">outillage autonome</text:a>.
La commande <text:span text:style-name="CodeDansTexte">npm init</text:span> gÃ©nÃ¨re un tel fichier.
undefined
L&#8217;utilisation de l&#8217;option <text:span text:style-name="CodeDansTexte">--yes</text:span> va plus vite car elle nous Ã©vite
de rÃ©pondre aux questions&#160;:</text:p>
<text:p text:style-name="Code">$ npm init --yes</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Si aucun fichier <text:span text:style-name="CodeDansTexte">package.json</text:span> n&#8217;existe dans le rÃ©pertoire courant,
il sera crÃ©Ã© avec des valeurs par dÃ©faut&#160;â€“ le nom du module correspondra
au nom du rÃ©pertoire courant.
Si ce fichier existait dÃ©jÃ , il sera alors prÃ©servÃ© et son contenu sera affichÃ©&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">package.json</text:p><text:p text:style-name="Code">{</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"name": "nodebook.chapter-05",</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"private": true,</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"version": "1.0.0",</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"main": "./examples/index.js",</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"description": "",</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"scripts": {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"lint": "eslint ./examples",</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"print-args": "node examples/print-args.js",</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"start": "micro examples/app.js",</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"test": "mocha examples/tests.js",</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"pretest": "npm run lint"</text:p><text:p text:style-name="Code"><text:s text:c="2"/>},</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"engines": {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"node": "^10.0.0"</text:p><text:p text:style-name="Code"><text:s text:c="2"/>},</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"author": "Thomas Parisot (https://oncletom.io)",</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"license": "MIT",</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"bugs": {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"url": "https://github.com/oncletom/nodebook/issues"</text:p><text:p text:style-name="Code"><text:s text:c="2"/>},</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"homepage": "https://github.com/oncletom/nodebook",</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"dependencies": {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"cowsay": "^1.3.1",</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"lodash": "^4.17.11",</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"micro": "^9.3.3"</text:p><text:p text:style-name="Code"><text:s text:c="2"/>},</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"devDependencies": {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"eslint": "^5.9.0",</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"mocha": "^5.2.0"</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">}</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous reviendrons sur la structure du fichier.
En attendant, focalisons-nous sur les opÃ©rations courantes comme
l&#8217;installation de modules.</text:p>
<text:bookmark text:name="ref-modules" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Installer des modules&#160;npm</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le mÃ©canisme des modules est documentÃ© dans
le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-modules"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;4</text:a>.
Les fonctions <text:span text:style-name="CodeDansTexte">require()</text:span> et <text:span text:style-name="CodeDansTexte">import</text:span> chargent nos propres modules mais aussi
les modules de base, installÃ©s avec Node.
Les modules <text:span text:style-name="CodeDansTexte">npm</text:span> sont <text:span text:style-name="T7">complÃ©mentaires et tÃ©lÃ©chargeables</text:span> Ã  l&#8217;aide
de l&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">npm</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette section va nous aider Ã  comprendre ce qui se passe pendant les phases
d&#8217;installation, de mise Ã  jour et de dÃ©sinstallation des modules <text:span text:style-name="CodeDansTexte">npm</text:span>.</text:p>
<text:bookmark text:name="ref-depuis_le_registre_npm" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Depuis le registre npm</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le registre&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com</text:a></text:span>) est l&#8217;hÃ©bergement principal
des modules ECMAScript, pour Node et le front-end.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La commande <text:span text:style-name="CodeDansTexte">npm install</text:span> s&#8217;utilise directement quand nous connaissons dÃ©jÃ 
le nom d&#8217;un module Ã  installer,
par exemple  <text:span text:style-name="T4">cowsay</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/cowsay" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/cowsay</text:a></text:span>)&#160;:
undefined</text:p>
<text:p text:style-name="Code">$ npm install cowsay</text:p><text:p text:style-name="Code">+ cowsay@1.3.1</text:p><text:p text:style-name="Code">added 10 packages from 3 contributors in 1.667s</text:p><text:p text:style-name="Code">found 0 vulnerabilities</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le module est installÃ© et prÃªt Ã  Ãªtre inclus dans un script.
Nous constatons aussi que le champ <text:span text:style-name="CodeDansTexte">dependencies</text:span> est apparu
dans le fichier <text:span text:style-name="CodeDansTexte">package.json</text:span>&#160;:
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">package.json</text:p><text:p text:style-name="Code">{</text:p><text:p text:style-name="Code"><text:s text:c="2"/>...</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"dependencies": {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"cowsay": "^1.3.1"</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">}</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">npm</text:span> tient les comptes des modules installÃ©s Ã  notre demande.
Cela nous sera utile pour <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-install"  text:visited-style-name="Visited_20_Internet_20_Link">installer les modules sur un autre ordinateur</text:a>.
Nous reviendrons plus tard sur la notation des versions
â€“ on en reparlera sous le nom de <text:span text:style-name="T4">versions sÃ©mantiques</text:span> (<text:span text:style-name="T4">Semantic Versionning</text:span>).
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">cow.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {say} = require('cowsay');</text:p><text:p text:style-name="Code">const message = say({ text: 'Bonjour !' });</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(message);</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;inclusion d&#8217;un module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> est identique
Ã  celle d&#8217;un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-modules-builtin"  text:visited-style-name="Visited_20_Internet_20_Link">module de&#160;base</text:a>.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Regardons le rÃ©sultat sans plus tarder&#160;:</text:p>
<text:p text:style-name="Code">$ node cow.js</text:p><text:p text:style-name="Code">___________</text:p><text:p text:style-name="Code">&lt; Bonjour ! &gt;</text:p><text:p text:style-name="Code">-----------</text:p><text:p text:style-name="Code"><text:s text:c="7"/>\<text:s text:c="3"/>^__^</text:p><text:p text:style-name="Code"><text:s text:c="8"/>\<text:s text:c="2"/>(oo)\_______</text:p><text:p text:style-name="Code"><text:s text:c="11"/>(__)\<text:s text:c="7"/>)\/\</text:p><text:p text:style-name="Code"><text:s text:c="15"/>||----w |</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> nous a permis d&#8217;utiliser du code sans avoir Ã  le
crÃ©er, alors qu&#8217;il n&#8217;Ã©tait pas fourni par la plate-forme Node.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Maintenant que nous savons installer un module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>, nous pouvons en chercher
d&#8217;autres et comprendre comment les utiliser.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Question</text:span> OÃ¹ sont stockÃ©s les modules&#160;npm ?</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
Les modules <text:span text:style-name="CodeDansTexte">npm</text:span> et leurs dÃ©pendances sont stockÃ©s dans un rÃ©pertoire
<text:span text:style-name="CodeDansTexte">node_modules</text:span>, situÃ© au mÃªme niveau que le fichier <text:span text:style-name="CodeDansTexte">package.json</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Sous le capot</text:span> Ce que fait l&#8217;exÃ©cutable&#160;npm pendant l&#8217;installation</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
undefined
L&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">npm</text:span> effectue un bon nombre d&#8217;actions lorsqu&#8217;on valide la
commande <text:span text:style-name="CodeDansTexte">npm install cowsay</text:span>&#160;:</text:p>
<text:p text:style-name="RemarqueNumero">1.<text:tab/>Il interroge le registre <text:span text:style-name="URL">npmjs.com</text:span> pour obtenir des informations sur le module demandÃ©.</text:p><text:p text:style-name="RemarqueNumero">2.<text:tab/>Il dÃ©termine que <text:span text:style-name="CodeDansTexte">1.3.1</text:span> est la version la plus rÃ©cente.</text:p><text:p text:style-name="RemarqueNumero">3.<text:tab/>Il tÃ©lÃ©charge une archive compressÃ©e (<text:span text:style-name="CodeDansTexte">.tar.gz</text:span>) qui contient tous les fichiers de la version <text:span text:style-name="CodeDansTexte">1.3.1</text:span>.</text:p><text:p text:style-name="RemarqueNumero">4.<text:tab/>L&#8217;archive est dÃ©compressÃ©e dans le rÃ©pertoire <text:span text:style-name="CodeDansTexte">node_modules</text:span>.</text:p><text:p text:style-name="RemarqueNumero">5.<text:tab/>Les dÃ©pendances sont elles aussi tÃ©lÃ©chargÃ©es puis dÃ©compressÃ©es dans le rÃ©pertoire <text:span text:style-name="CodeDansTexte">node_modules</text:span>.</text:p><text:p text:style-name="RemarqueNumero">6.<text:tab/>Le module <text:span text:style-name="CodeDansTexte">cowsay</text:span> est inscrit dans le fichier <text:span text:style-name="CodeDansTexte">package.json</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Remarque</text:span> DÃ©pendances de dÃ©veloppement</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
Il existe une variante de la commande pour distinguer les dÃ©pendances
spÃ©cifiques Ã  l&#8217;outillage du projet.
Rendez-vous dans la section <text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-install.dev"  text:visited-style-name="Visited_20_Internet_20_Link">DÃ©pendances de dÃ©veloppement</text:a></text:span>
pour en savoir plus.</text:p>
<text:bookmark text:name="ref-registry" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Trouver son bonheur dans le registre&#160;npm</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le registre <text:span text:style-name="CodeDansTexte">npm</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com</text:a></text:span>) fourmille de modules
â€“ de simples fonctions, des bibliothÃ¨ques ou des frameworks complets.
Ils couvrent un spectre d&#8217;usages trÃ¨s larges&#160;: accÃ¨s aux bases de donnÃ©es,
frameworks web, outils <text:span text:style-name="T4">front-end</text:span>, utilitaires de test,
compression de donnÃ©es, paiement bancaire, des frameworks mobiles, etc.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cherchons une bibliothÃ¨que pour nous connecter Ã  une base de donnÃ©es MySQL ou MariaDB.
Tapez <text:span text:style-name="">mysql</text:span> dans le champ de recherche du registre&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> ou saisissez
directement l&#8217;URL menant aux rÃ©sultats de cette recherche
(<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/search?q=mysql" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/search?q=mysql</text:a></text:span>)&#160;:</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-05/images/npm-registry-search.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>5-undefined.</text:span> Extrait des rÃ©sultats d&#8217;une recherche de modules&#160;npm avec le mot-clÃ© <text:span text:style-name="">mysql</text:span></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les rÃ©sultats sont triÃ©s par pertinence&#160;â€“ un mÃ©lange entre popularitÃ©,
qualitÃ© et maintenance des projets.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Je trouve qu&#8217;il est difficile de dÃ©cider uniquement en regardant la liste.
J&#8217;ai tendance Ã  ouvrir un onglet par module pour en lire la documentation.
Prenons le cas du module <text:span text:style-name="T4">mysql2</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/mysql2" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/mysql2</text:a></text:span>) justement&#160;:</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-05/images/npm-package-mysql2.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>5-undefined.</text:span> Extrait de la page consacrÃ©e au module&#160;npm&#160;mysql2</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Plusieurs Ã©lÃ©ments de cette page tendent Ã  me rassurer
et m&#8217;aident Ã  juger de la robustesse de ce module&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">les badges colorÃ©s qui affichent le statut d&#8217;exÃ©cution des tests&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">une introduction de <text:span text:style-name="T7">documentation claire et concise</text:span>&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">un <text:span text:style-name="T7">nombre de tÃ©lÃ©chargements</text:span> en progrÃ¨s rÃ©guliers&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">l&#8217;utilisation avec des <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-promise"  text:visited-style-name="Visited_20_Internet_20_Link">promesses</text:a>&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">le nombre important de modules dÃ©pendants&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="T7">je reconnais une personne</text:span> qui contribue du code de qualitÃ©&#160;â€“ Rebecca&#160;Turner (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/~iarna" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/~iarna</text:a></text:span>).</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">J&#8217;ai un doute quand je lis <text:span text:style-name="Menu">108&#160;issues</text:span> et <text:span text:style-name="Menu">13&#160;pull&#160;requests</text:span>.
Dans ce cas-lÃ , je me dis que les personnes qui maintiennent le projet ne sont
pas forcÃ©ment trÃ¨s rÃ©actives.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cependant, il y a suffisamment d&#8217;indicateurs au vert pour l&#8217;installer avec
<text:span text:style-name="CodeDansTexte">npm install mysql2</text:span> puis l&#8217;essayer dans un script.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le module <text:span text:style-name="T4">mysql-libmysqlclient</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/mysql-libmysqlclient" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/mysql-libmysqlclient</text:a></text:span>)
ne me fait pas du tout le mÃªme effet.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-05/images/npm-package-mysql-libmysqlclient.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>5-undefined.</text:span> Extrait de la page consacrÃ©e au module&#160;npm&#160;mysql-libmysqlclient</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La page du module ne met pas d&#8217;exemple simple Ã  comprendre et fait rÃ©fÃ©rence
Ã  des versions de Node antÃ©diluviennes.
Rien n&#8217;indique qu&#8217;il ne peut pas fonctionner avec Node&#160;v10,
mais la prÃ©sence du mot <text:span text:style-name="Menu">binding</text:span> m&#8217;Ã©voque que l&#8217;installation du module
compile un programme Ã©crit dans un autre langage
â€“ en l&#8217;occurrence, <text:span text:style-name="T4">libmysqlclient</text:span>.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Point positif&#160;: il n&#8217;y a que <text:span text:style-name="Menu">14&#160;issues</text:span> GitHub.
C&#8217;est peu, mais l&#8217;une d&#8217;entre elles est intitulÃ©e
<text:span text:style-name="Menu">Does not work with any modern version of Node.js</text:span>.
Cela confirme mes doutes&#160;; c&#8217;est suffisant pour que je passe mon chemin.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">En continuant plus loin dans la liste des rÃ©sultats de recherche,
je suis tombÃ© sur le module nommÃ© <text:span text:style-name="T4">falchion</text:span>.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-05/images/npm-package-falchion.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>5-undefined.</text:span> Extrait de la page consacrÃ©e au module&#160;npm&#160;falchion</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il n&#8217;y a qu&#8217;une seule version du module, qui date de quatre annÃ©es
avec une documentation qui tient sur une ligne.
Il y a trÃ¨s peu de chances que nous puissions en faire quelque chose.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Voici au final ce que j&#8217;estime Ãªtre le plus important pour me faire
une idÃ©e d&#8217;un module et dÃ©cider de l&#8217;installer ou&#160;non&#160;:
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">PrÃ©sence d&#8217;une <text:span text:style-name="T7">documentation</text:span>&#160;â€“ je peux me faire une idÃ©e des fonctionnalitÃ©s
et de la complexitÃ© d&#8217;utilisation du module.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Des badges d'<text:span text:style-name="T7">intÃ©gration continue</text:span>&#160;â€“ je sais ainsi qu&#8217;il y a des tests
unitaires qui sont exÃ©cutÃ©s automatiquement avant que le module soit publiÃ©.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Le nombre de <text:span text:style-name="T7">tÃ©lÃ©chargements</text:span>&#160;â€“ je sais si d&#8217;autres personnes s&#8217;en servent
en espÃ©rant qu&#8217;ils remontent les problÃ¨mes rencontrÃ©s.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Le nombre de <text:span text:style-name="T7">versions</text:span>&#160;â€“ cela me donne une idÃ©e de la maturitÃ© du projet
et de la rÃ©activitÃ© aux demandes de la communautÃ©.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce sont des <text:span text:style-name="T7">critÃ¨res subjectifs</text:span>.
Un module est parfois populaire par anciennetÃ© alors qu&#8217;il existe des alternatives,
plus lÃ©gÃ¨res ou plus simples d&#8217;utilisation.
C&#8217;est le cas du module <text:span text:style-name="T4">moment.js</text:span>, plus populaire que <text:span text:style-name="T4">date-fns</text:span>&#160;â€“ que je prÃ©fÃ¨re.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il y a aussi des modules dans lesquels j&#8217;ai une confiance quasi-aveugle.
Ils sont publiÃ©s par les personnes prÃ©sentes dans cette liste non&#160;exhaustive&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TableauTitre">Tableau 4. Personnes ayant Ã©crit des modules npm Ã  suivre</text:p><table:table table:style-name="Tableau1"><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/~dougwilson" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/~dougwilson</text:a></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://github.com/jdalton" text:visited-style-name="Visited_20_Internet_20_Link">https://github.com/jdalton</text:a></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/~sindresorhus" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/~sindresorhus</text:a></text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/~feross" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/~feross</text:a></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://github.com/jshttp" text:visited-style-name="Visited_20_Internet_20_Link">https://github.com/jshttp</text:a></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/~substack" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/~substack</text:a></text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/~fgribreau" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/~fgribreau</text:a></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/~mbostock" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/~mbostock</text:a></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/~zkat" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/~zkat</text:a></text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/~iarna" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/~iarna</text:a></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://github.com/nodejitsu" text:visited-style-name="Visited_20_Internet_20_Link">https://github.com/nodejitsu</text:a></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p></text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/~isaacs" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/~isaacs</text:a></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/~rwaldron" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/~rwaldron</text:a></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p></text:p></table:table-cell></table:table-row></table:table>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Pratique</text:span> SÃ©lection de modules npm</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">J&#8217;ai compilÃ© une liste de modules utiles pour mieux dÃ©marrer
dans vos projets.
Vous la trouverez en <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-appendix-a"  text:visited-style-name="Visited_20_Internet_20_Link">annexe&#160;A</text:a>.</text:p>
<text:bookmark text:name="ref-uninstall" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">DÃ©sinstaller un module</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;utilisation de la commande <text:span text:style-name="CodeDansTexte">npm uninstall</text:span> supprime en toute sÃ©curitÃ©
un module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> et les fichiers qu&#8217;il a installÃ©s.
La commande le retire ensuite de la liste des dÃ©pendances
du fichier <text:span text:style-name="CodeDansTexte">package.json</text:span>.</text:p>
<text:p text:style-name="Code">$ npm uninstall cowsay</text:p><text:p text:style-name="Code">removed 10 packages in 1.963s</text:p><text:p text:style-name="Code">found 0 vulnerabilities</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le module <text:span text:style-name="T4">cowsay</text:span> n&#8217;est plus installÃ©.
Que se passe-t-il si nous exÃ©cutons Ã  nouveau un l&#8217;exemple <text:span text:style-name="CodeDansTexte">cow.js</text:span>&#160;?</text:p>
<text:p text:style-name="Code">$ node cow.js</text:p><text:p text:style-name="Code">internal/modules/cjs/loader.js:596</text:p><text:p text:style-name="Code"><text:s text:c="4"/>throw err;</text:p><text:p text:style-name="Code"><text:s text:c="4"/>^</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">Error: Cannot find module 'cowsay'</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le chargement du module a Ã©chouÃ© car Node n&#8217;arrive pas Ã  le trouver
â€“ et c&#8217;est normal.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous devons relancer la commande <text:span text:style-name="CodeDansTexte">npm install cowsay</text:span>
pour que le script fonctionne Ã  nouveau.</text:p>
<text:bookmark text:name="ref-install" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Depuis un fichier <text:span text:style-name="">package.json</text:span></text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Jusqu&#8217;Ã  prÃ©sent, nous avons installÃ© des modules en les ajoutant un par&#160;un.
La procÃ©dure est lÃ©gÃ¨rement diffÃ©rente quand nous installons le projet de zÃ©ro
ou quand le fichier <text:span text:style-name="CodeDansTexte">package.json</text:span> a Ã©tÃ© mis Ã  jour par unÂ·e collÃ¨gue, par exemple.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exemple suivant illustre la remise Ã  zÃ©ro des modules
utilisÃ©s en exemple de ce chapitre&#160;:</text:p>
<text:p text:style-name="Code">$ cd $(nodebook dir {chapter-id} --root)</text:p><text:p text:style-name="Code">$ rm -rf node_modules</text:p><text:p text:style-name="Code">$ npm install</text:p><text:p text:style-name="Code">added 164 packages from 583 contributors in 4.781s</text:p><text:p text:style-name="Code">found 0 vulnerabilities</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous nous sommes positionnÃ©s dans un rÃ©pertoire qui contient
un fichier <text:span text:style-name="CodeDansTexte">package.json</text:span> puis nous avons supprimÃ© tout ce qui aurait pu
Ãªtre installÃ©.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La commande <text:span text:style-name="CodeDansTexte">npm install</text:span> s&#8217;utilise de maniÃ¨re systÃ©matique quand
nous rÃ©cupÃ©rons du code avec Git pour la premiÃ¨re fois (<text:span text:style-name="CodeDansTexte">git clone</text:span>)
ou aprÃ¨s une mise Ã  jour, par exemple avec <text:span text:style-name="CodeDansTexte">git pull</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">npm</text:span> vÃ©rifie que la correspondance est bien respectÃ©e
entre ce qui est installÃ© dans le rÃ©pertoire <text:span text:style-name="CodeDansTexte">node_modules</text:span> et
les modules listÃ©s dans le fichier <text:span text:style-name="CodeDansTexte">package.json</text:span>.
La commande <text:span text:style-name="CodeDansTexte">npm install</text:span> installe, met Ã  jour et retire les modules nÃ©cessaires.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Pratique</text:span> npm&#160;clean-install (npm ci)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
La commande <text:span text:style-name="CodeDansTexte">npm clean-install</text:span> rÃ©installe un projet de zÃ©ro de maniÃ¨re prÃ©dictible.
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-ci"  text:visited-style-name="Visited_20_Internet_20_Link">Nous y reviendrons plus loin</text:a>.</text:p>
<text:bookmark text:name="ref-install.version" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">SpÃ©cifier une version</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Par dÃ©faut, l&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">npm</text:span> installe la derniÃ¨re version d&#8217;un module.
Nous avons la libertÃ© d&#8217;en installer d&#8217;autres qui sont antÃ©rieures.
C&#8217;est pratique quand des modules arrÃªtent de prendre en charge
des navigateurs web ou des versions de Node alors que nous les utilisons encore.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous allons nous servir du module <text:span text:style-name="T4">lodash</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/lodash" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/lodash</text:a></text:span>)
pour illustrer nos allÃ©es et venues entre diffÃ©rentes versions.
Ã€ l&#8217;heure oÃ¹ j&#8217;Ã©cris ces lignes, sa version la plus rÃ©cente est la <text:span text:style-name="CodeDansTexte">4.17.11</text:span>.
C&#8217;est ce que rapporte le rÃ©sultat de la commande <text:span text:style-name="CodeDansTexte">npm install lodash</text:span>&#160;:</text:p>
<text:p text:style-name="Code">$ npm install lodash</text:p><text:p text:style-name="Code">+ lodash@4.17.11</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;utilisation du caractÃ¨re <text:span text:style-name="CodeDansTexte">@</text:span> conjointement Ã  un numÃ©ro de version prÃ©cise
la version Ã  installer&#160;:</text:p>
<text:p text:style-name="Code">$ npm install lodash@3.0.0</text:p><text:p text:style-name="Code">+ lodash@3.0.0</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous avons installÃ© une version prÃ©cise, mais il y a sÃ»rement des mises Ã  jour
qui ont suivi pour corriger des bogues.
Le problÃ¨me est que, Ã  ce stade, nous ne connaissons pas le numÃ©ro de version
Ã  spÃ©cifier.
IdÃ©alement, je prÃ©fÃ©rerais installer la version la plus rÃ©cente de la sÃ©rie&#160;3.
Il se trouve que l&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">npm</text:span> sait le faire pour nous et sans effort&#160;:</text:p>
<text:p text:style-name="Code">$ npm install lodash@3</text:p><text:p text:style-name="Code">+ lodash@<text:span text:style-name="CodeExergue">3.10.1</text:span></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous pouvons faire la mÃªme chose avec les versions les plus rÃ©centes de
la sÃ©rie&#160;3 et de la sÃ©rie&#160;2.2&#160;:</text:p>
<text:p text:style-name="Code">$ npm install lodash@3</text:p><text:p text:style-name="Code">+ lodash@3.10.1</text:p><text:p text:style-name="Code">$ npm install lodash@2.2</text:p><text:p text:style-name="Code">+ lodash@2.2.1</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Pratique</text:span> ConnaÃ®tre toutes les versions d&#8217;un module</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
La <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-view"  text:visited-style-name="Visited_20_Internet_20_Link">commande <text:span text:style-name="CodeDansTexte">npm view</text:span></text:a> affiche les informations d&#8217;un module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>
directement depuis notre terminal.
Elle affiche toutes les versions publiÃ©es avec l&#8217;argument <text:span text:style-name="CodeDansTexte">versions</text:span>&#160;:</text:p>
<text:p text:style-name="RemarqueCode">$ npm view lodash <text:span text:style-name="CodeExergue">versions</text:span></text:p><text:p text:style-name="RemarqueCode">[ '0.1.0',</text:p><text:p text:style-name="RemarqueCode"><text:s text:c="2"/>'0.2.0',</text:p><text:p text:style-name="RemarqueCode"><text:s text:c="2"/>...</text:p><text:p text:style-name="RemarqueCode"><text:s text:c="2"/>'1.0.0',</text:p><text:p text:style-name="RemarqueCode"><text:s text:c="2"/>'1.0.1',</text:p><text:p text:style-name="RemarqueCode"><text:s text:c="2"/>'1.0.2',</text:p><text:p text:style-name="RemarqueCode"><text:s text:c="2"/>... ]</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Revenons Ã  la version la plus rÃ©cente en rÃ©utilisant la
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-install"  text:visited-style-name="Visited_20_Internet_20_Link">commande d&#8217;installation</text:a> abordÃ©e auparavant&#160;:
undefined</text:p>
<text:p text:style-name="Code">$ npm install lodash</text:p><text:p text:style-name="Code">+ lodash@2.4.2</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Quelque chose d&#8217;inattendu s&#8217;est produit&#160;: la version la plus rÃ©cente
de la sÃ©rie&#160;2 a Ã©tÃ© installÃ©e au lieu de la version&#160;4.17.11.
Nous trouverons un Ã©lÃ©ment de rÃ©ponse dans le fichier <text:span text:style-name="CodeDansTexte">package.json</text:span>&#160;:
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">package.json</text:p><text:p text:style-name="Code">{</text:p><text:p text:style-name="Code"><text:s text:c="2"/>...</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"dependencies": {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"cowsay": "^1.3.1",</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"lodash": "<text:span text:style-name="CodeExergue">^2.4.2</text:span>"</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">}</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">npm</text:span> respecte la version indiquÃ©e dans le fichier <text:span text:style-name="CodeDansTexte">package.json</text:span>
si aucune autre n&#8217;est prÃ©cisÃ©e dans la commande.
Si la dÃ©pendance n&#8217;est pas listÃ©e, alors l&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">npm</text:span> installe la version
la plus rÃ©cente.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;Ã©tiquette <text:span text:style-name="CodeDansTexte">latest</text:span> explicite notre envie d&#8217;installer la version
la plus rÃ©cente et sans tenir compte du fichier <text:span text:style-name="CodeDansTexte">package.json</text:span>&#160;:
undefined</text:p>
<text:p text:style-name="Code">$ npm install lodash@<text:span text:style-name="CodeExergue">latest</text:span></text:p><text:p text:style-name="Code">+ lodash@4.17.11</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous sommes dÃ©sormais en mesure de choisir entre diffÃ©rentes versions
d&#8217;un module et de maniÃ¨re plus ou moins&#160;fine.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous prendrons le temps d&#8217;explorer le mÃ©canisme de numÃ©rotation des versions
dans la section suivante afin de mieux comprendre ce qui est renseignÃ©
dans le fichier <text:span text:style-name="CodeDansTexte">package.json</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Pratique</text:span> ConnaÃ®tre les Ã©tiquettes d&#8217;un module</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
La <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-view"  text:visited-style-name="Visited_20_Internet_20_Link">commande <text:span text:style-name="CodeDansTexte">npm view</text:span></text:a> va Ã  nouveau nous aider.
Elle affiche toutes les versions publiÃ©es avec l&#8217;argument <text:span text:style-name="CodeDansTexte">dist-tags</text:span>&#160;:</text:p>
<text:p text:style-name="RemarqueCode">$ npm view lodash dist-tags</text:p><text:p text:style-name="RemarqueCode">{ <text:span text:style-name="CodeExergue">latest</text:span>: '4.17.11' }</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Ce mÃ©canisme d&#8217;Ã©tiquette sert de raccourci pour associer un numÃ©ro de version
(qui change) Ã  un intitulÃ© (qui reste dans le temps).</text:p>
<text:bookmark text:name="ref-semver" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Comprendre les numÃ©ros de versions (Semantic Versioning)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les numÃ©ros de versions ont Ã©tÃ© utilisÃ©s de deux maniÃ¨res dans les
sections prÃ©cÃ©dentes&#160;: avec l&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">npm</text:span> et en observant la liste
de dÃ©pendances dans le fichier <text:span text:style-name="CodeDansTexte">package.json</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">npm</text:span> dÃ©coupe un numÃ©ro de version en trois parties&#160;:
<text:span text:style-name="T4">majeure</text:span>, <text:span text:style-name="T4">mineure</text:span> et <text:span text:style-name="T4">patch</text:span>.
Pour le numÃ©ro de version <text:span text:style-name="CodeDansTexte">1.2.3</text:span>, <text:span text:style-name="CodeDansTexte">1</text:span> indique la version majeure,
<text:span text:style-name="CodeDansTexte">2</text:span> la version mineure et <text:span text:style-name="CodeDansTexte">3</text:span> la version <text:span text:style-name="T4">patch</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Si nous devions mettre Ã  jour <text:span text:style-name="CodeDansTexte">lodash@2.2.0</text:span>&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">Vers <text:span text:style-name="CodeDansTexte">lodash@2.2.1</text:span>&#160;: mise Ã  jour patch&#160;â€“ des bogues sont corrigÃ©s.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Vers <text:span text:style-name="CodeDansTexte">lodash@2.4.2</text:span>&#160;: mise Ã  jour mineure&#160;â€“ des fonctionnalitÃ©s sont ajoutÃ©es,
corrigÃ©es ou modifiÃ©es sans affecter notre code.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Vers <text:span text:style-name="CodeDansTexte">lodash@4.17.11</text:span>&#160;: mise Ã  jour majeure&#160;â€“ des fonctionnalitÃ©s sont
modifiÃ©es, remaniÃ©es ou supprimÃ©es et peuvent casser notre code qui repose dessus.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Une mise Ã  jour majeure demande de lire attentivement la documentation du module
pour comprendre le volume de travail Ã  fournir avant de monter en version.
La mise Ã  jour mineure peut occasionnellement demander du travail selon
l&#8217;interprÃ©tation des dÃ©veloppeurs de modules <text:span text:style-name="CodeDansTexte">npm</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TableauTitre">Tableau 5. DiffÃ©rentes maniÃ¨res d&#8217;exprimer des versions</text:p><table:table table:style-name="Tableau1"><table:table-column />,<table:table-column />,<table:table-column />,<table:table-column /><table:table-row><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Symbole</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Version</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>ReprÃ©sentation alternative</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>ReprÃ©sentation Ã©tendue</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">1.0.0</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>-</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>-</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">^</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">^1.0.0</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">1.x.x</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">&gt;=1.0.0 &lt;2.0.0</text:span></text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">~</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">~1.0.0</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">1.0.x</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">&gt;=1.0.0 &lt;1.1.0</text:span></text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">*</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">*</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">x.x.x</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">&gt;=0.0.1</text:span></text:p></table:table-cell></table:table-row></table:table>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Je ne pense pas qu&#8217;il soit nÃ©cessaire de toujours choisir la derniÃ¨re version majeure.
Les versions <text:span text:style-name="T4">patch</text:span> et mineures sont plus importantes Ã  mes yeux,
car elles contiennent des corrections dont bÃ©nÃ©ficient nos applications.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Pratique</text:span> Calculateur de version</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">L&#8217;outil en ligne <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://semver.npmjs.com" text:visited-style-name="Visited_20_Internet_20_Link">https://semver.npmjs.com</text:a></text:span> sert Ã  tester
la syntaxe des versions sÃ©mantiques avec de vÃ©ritables modules&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>.</text:p>
<text:bookmark text:name="ref-update" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Mises Ã  jour</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous avons appris Ã  installer des modules <text:span text:style-name="CodeDansTexte">npm</text:span> dans les versions de notre choix
et Ã  les rÃ©installer depuis la liste contenue dans le fichier <text:span text:style-name="CodeDansTexte">package.json</text:span>.
Comment savoir s&#8217;il faut les mettre Ã &#160;jour&#160;?</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;utilisation combinÃ©e des commandes <text:span text:style-name="CodeDansTexte">npm outdated</text:span> et <text:span text:style-name="CodeDansTexte">npm update</text:span> va
nous permettre d&#8217;y arriver.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">CommenÃ§ons par installer d&#8217;anciennes versions des modules <text:span text:style-name="T4">lodash</text:span> et <text:span text:style-name="T4">cowsay</text:span>&#160;:</text:p>
<text:p text:style-name="Code">$ npm install lodash@2.0.0 cowsay@1.0.0</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La commande <text:span text:style-name="CodeDansTexte">npm outdated</text:span> affiche les dÃ©pendances qui ne sont pas Ã &#160;jour&#160;:
undefined</text:p>
<text:p text:style-name="Code">$ npm outdated</text:p><text:p text:style-name="Code">Package<text:s text:c="2"/>Current<text:s text:c="2"/>Wanted<text:s text:c="3"/>Latest<text:s text:c="2"/>Location</text:p><text:p text:style-name="Code">cowsay<text:s text:c="5"/>1.0.0<text:s text:c="3"/>1.3.1<text:s text:c="4"/>1.3.1<text:s text:c="2"/>nodebook.chapter-05</text:p><text:p text:style-name="Code">lodash<text:s text:c="5"/>2.0.0<text:s text:c="3"/>2.4.2<text:s text:c="2"/>4.17.11<text:s text:c="2"/>nodebook.chapter-05</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le numÃ©ro de version affichÃ© dans la colonne <text:span text:style-name="CodeDansTexte">Wanted</text:span> est celui qui sera atteint
avec la commande <text:span text:style-name="CodeDansTexte">npm update</text:span>.
undefined</text:p>
<text:p text:style-name="Code">$ npm update</text:p><text:p text:style-name="Code">+ cowsay@1.3.1</text:p><text:p text:style-name="Code">+ lodash@2.4.2</text:p><text:p text:style-name="Code">added 7 packages and updated 3 packages in 2.717s</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Observons ce qui a changÃ© dans les rÃ©sultats de la commande <text:span text:style-name="CodeDansTexte">npm outdated</text:span>&#160;:
undefined</text:p>
<text:p text:style-name="Code">$ npm outdated</text:p><text:p text:style-name="Code">Package<text:s text:c="2"/>Current<text:s text:c="2"/>Wanted<text:s text:c="3"/>Latest<text:s text:c="2"/>Location</text:p><text:p text:style-name="Code">lodash<text:s text:c="5"/>2.4.2<text:s text:c="3"/>2.4.2<text:s text:c="2"/>4.17.11<text:s text:c="2"/>nodebook.chapter-05</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les modules <text:span text:style-name="T4">cowsay</text:span> et <text:span text:style-name="T4">lodash</text:span> ont Ã©tÃ© mis Ã  jour au plus sÃ»r et seul le
deuxiÃ¨me est dÃ©sormais listÃ©&#160;; il peut rester en l&#8217;Ã©tat si nous n&#8217;avons pas le temps
de rendre notre code compatible avec ses changements.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Sinon, une <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-install.version"  text:visited-style-name="Visited_20_Internet_20_Link">installation manuelle</text:a> s&#8217;impose
avec l&#8217;Ã©tiquette <text:span text:style-name="CodeDansTexte">latest</text:span>&#160;:
undefined</text:p>
<text:p text:style-name="Code">$ npm install lodash@latest</text:p><text:p text:style-name="Code">+ lodash@4.17.11</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un dernier appel Ã  <text:span text:style-name="CodeDansTexte">npm outdated</text:span> nous en donne le cÅ“ur&#160;net&#160;:
undefined</text:p>
<text:p text:style-name="Code">$ npm outdated</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Si rien ne s&#8217;affiche, c&#8217;est que tout est bon&#160;: nos modules sont Ã &#160;jour&#160;!</text:p>
<text:bookmark text:name="ref-autres_maniÃ¨res_dinstaller_et_dutiliser_des_modulesnpm" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Autres maniÃ¨res d&#8217;installer et d&#8217;utiliser des modules&#160;npm</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans la section prÃ©cÃ©dente, nous avons vu comment installer des modules
depuis le registre&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>.
Maintenant, nous allons apprendre Ã  les installer depuis des sources
variÃ©es, uniquement Ã  des fins de dÃ©veloppement ou en tant que
commandes exÃ©cutables au niveau du systÃ¨me d&#8217;exploitation.</text:p>
<text:bookmark text:name="ref-install.git" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Depuis GitHub, GitLab ou un dÃ©pÃ´t&#160;Git</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il arrive que l&#8217;auteurÂ·e d&#8217;un module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> corrige un problÃ¨me
sans publier le correctif sur le registre&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>.
Il arrive aussi qu&#8217;un module soit hÃ©bergÃ© de maniÃ¨re publique ou privÃ©e
sur une plate-forme d&#8217;hÃ©bergement Git comme GitLab ou GitHub,
sans passer par le registre&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le module <text:span text:style-name="T4">cowsay</text:span> est publiÃ© sur le registre&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>, mais il est aussi
hÃ©bergÃ© sur GitHub Ã  l&#8217;adresse <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://github.com/piuccio/cowsay" text:visited-style-name="Visited_20_Internet_20_Link">https://github.com/piuccio/cowsay</text:a></text:span>.
Installons-le depuis cette source&#160;:</text:p>
<text:p text:style-name="Code">$ npm install https://github.com/piuccio/cowsay</text:p><text:p text:style-name="Code">+ cowsay@1.3.1</text:p><text:p text:style-name="Code">updated 1 package in 5.866s</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">npm</text:span> vÃ©rifie qu&#8217;un fichier <text:span text:style-name="CodeDansTexte">package.json</text:span> est situÃ© Ã  la racine
du dÃ©pÃ´t.
Dans ce cas de figure, il utilise le programme Git pour obtenir le code source
du module.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Une Ã©criture raccourcie existe pour installer un module depuis un hÃ©bergement
Git populaire, sans avoir Ã  Ã©crire l&#8217;URL en entier&#160;:</text:p>
<text:p text:style-name="Code">$ npm install github:piuccio/cowsay</text:p><text:p text:style-name="Code">+ cowsay@1.3.1</text:p><text:p text:style-name="Code">updated 1 package in 4.513s</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">ConsidÃ©rations</text:span> Performance d&#8217;accÃ¨s Ã &#160;Git</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">L&#8217;installation est plus lente depuis un dÃ©pÃ´t Git que depuis un registre&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>.
L&#8217;exÃ©cutable&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> fait appel Ã  l&#8217;exÃ©cutable&#160;<text:span text:style-name="CodeDansTexte">git</text:span> pour cloner l&#8217;historique
du dÃ©pÃ´t et de ses dÃ©pendances pour extraire la version adÃ©quate
de la copie de travail.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Le temps de tÃ©lÃ©chargement sera proportionnel au nombre de <text:span text:style-name="T4">commits</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">npm</text:span> sait aussi installer des modules avec le protocole
<text:span text:style-name="T4">Secure Shell</text:span> (<text:span text:style-name="T4">SSH</text:span>) dÃ©signÃ© par <text:span text:style-name="CodeDansTexte">git+ssh</text:span>&#160;:</text:p>
<text:p text:style-name="Code">$ npm install git+ssh://git@github.com:piuccio/cowsay.git</text:p><text:p text:style-name="Code">+ cowsay@1.3.1</text:p><text:p text:style-name="Code">updated 1 package in 10.263s</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les clients Git et SSH doivent Ãªtre configurÃ©s au niveau du systÃ¨me pour
Ãªtre en mesure de s&#8217;authentifier sur l&#8217;hÃ´te distant.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">C&#8217;est une solution intÃ©ressante pour automatiser l&#8217;installation de modules privÃ©s.
L&#8217;Ã©tape suivante serait de dÃ©ployer un registre&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> privÃ© ou de souscrire
une option payante sur le registre principal.</text:p>
<text:bookmark text:name="ref-install.dev" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">DÃ©pendances de dÃ©veloppement</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les dÃ©pendances de dÃ©veloppement sont des modules <text:span text:style-name="CodeDansTexte">npm</text:span> utilisÃ©s
pour <text:span text:style-name="T7">exÃ©cuter les tests unitaires</text:span> ou pour <text:span text:style-name="T7">de l&#8217;outillage</text:span> sont aussi des
dÃ©pendances de dÃ©veloppement.
Ce sont des modules que nous n&#8217;appelons pas directement avec les
fonctions <text:span text:style-name="CodeDansTexte">require()</text:span> et <text:span text:style-name="CodeDansTexte">import</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Par exemple, le module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> <text:span text:style-name="T4">mocha</text:span> est utilisÃ© pour structurer et exÃ©cuter
des tests unitaires pour Node et les navigateurs web.
Il est donc logique de l&#8217;installer comme dÃ©pendance de dÃ©veloppement.
L&#8217;option <text:span text:style-name="CodeDansTexte">--save-dev</text:span> signale cette intention Ã  l&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">npm</text:span>&#160;:
undefined</text:p>
<text:p text:style-name="Code">$ npm install --save-dev mocha</text:p><text:p text:style-name="Code">+ mocha@5.2.0</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">npm</text:span> range alors ce module dans une nouvelle section du
fichier <text:span text:style-name="CodeDansTexte">package.json</text:span>&#160;â€“ la section <text:span text:style-name="CodeDansTexte">devDependencies</text:span>&#160;:</text:p>
<text:p text:style-name="Code">{</text:p><text:p text:style-name="Code"><text:s text:c="2"/>...</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"dependencies": {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"cowsay": "^1.3.1",</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"lodash": "^4.17.11"</text:p><text:p text:style-name="Code"><text:s text:c="2"/>},</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"<text:span text:style-name="CodeExergue">devDependencies</text:span>": {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"mocha": "^5.2.0"</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">}</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Optimisation</text:span> Installer seulement les dÃ©pendances de production</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
La <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-install"  text:visited-style-name="Visited_20_Internet_20_Link">commande <text:span text:style-name="CodeDansTexte">npm install</text:span></text:a> accepte l&#8217;option <text:span text:style-name="CodeDansTexte">--production</text:span>.
Elle installe seulement les dÃ©pendances listÃ©es dans la section <text:span text:style-name="CodeDansTexte">dependencies</text:span>&#160;:</text:p>
<text:p text:style-name="RemarqueCode">$ npm install --production</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Le <text:span text:style-name="T7">poids d&#8217;installation est ainsi rÃ©duit</text:span>.
C&#8217;est l&#8217;idÃ©al dans le cas du dÃ©ploiement de
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-lambda"  text:visited-style-name="Visited_20_Internet_20_Link">fonctions Ã©vÃ©nementielles</text:a>
(<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-06"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;6</text:a>).</text:p>
<text:bookmark text:name="ref-install.global" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">ExÃ©cutable systÃ¨me (installation globale)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Certains modules <text:span text:style-name="CodeDansTexte">npm</text:span> s&#8217;installent comme des programmes exÃ©cutables.
Ils s&#8217;appellent ensuite dans un terminal, exactement comme nous le faisions
jusqu&#8217;Ã  prÃ©sent avec l&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">npm</text:span>.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">C&#8217;est le cas du module <text:span text:style-name="T4">serve</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/serve" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/serve</text:a></text:span>), par exemple.
Il dÃ©marre un serveur web en ligne de commande pour tester le rendu
de fichiers HTML sans avoir Ã  configurer de logiciels comme <text:span text:style-name="T4">Apache</text:span> ou <text:span text:style-name="T4">nginx</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;installation est rendue globale&#160;â€“ Ã  l&#8217;Ã©chelle du systÃ¨me d&#8217;exploitation
â€“ avec l&#8217;utilisation de l&#8217;option <text:span text:style-name="CodeDansTexte">--global</text:span>&#160;:</text:p>
<text:p text:style-name="Code">$ npm install <text:span text:style-name="CodeExergue">--global</text:span> serve</text:p><text:p text:style-name="Code">+ serve@10.0.0</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Question</text:span> Comment savoir si un module&#160;npm s&#8217;installe comme un exÃ©cutable systÃ¨me ?</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">En gÃ©nÃ©ral, les modules qui se prÃªtent bien au jeu du <text:span text:style-name="CodeDansTexte">npm install --global</text:span>
sont ceux qui documentent des exemples de commande Ã  exÃ©cuter,
qui se dÃ©crivent comme des outils en ligne de commande ou qui
mentionnent explicitement l&#8217;installation globale.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">serve</text:span> est disponible suite Ã  l&#8217;installation globale&#160;:</text:p>
<text:p text:style-name="Code">$ serve --version</text:p><text:p text:style-name="Code">10.0.0</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> s&#8217;exÃ©cute de maniÃ¨re transparente, sans invoquer Node ni
l&#8217;exÃ©cutable&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>&#160;:</text:p>
<text:p text:style-name="Code">$ serve .</text:p><text:p text:style-name="Code">INFO: Accepting connections at http://localhost:3000</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> L&#8217;option&#160;--help</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Par convention, les modules <text:span text:style-name="CodeDansTexte">npm</text:span> qui s&#8217;utilisent en ligne de commande
sont accompagnÃ©s d&#8217;une documentation.
Ce manuel dÃ©crit des cas d&#8217;usage ainsi que les options Ã  disposition.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Affichage de la documentation du module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> <text:span text:style-name="T4">serve</text:span>
depuis la ligne de commande&#160;:</text:p>
<text:p text:style-name="RemarqueCode">$ serve --help</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un module installÃ© de maniÃ¨re globale se dÃ©sinstalle en passant l&#8217;option
<text:span text:style-name="CodeDansTexte">--global</text:span> Ã  la <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-uninstall"  text:visited-style-name="Visited_20_Internet_20_Link">commande <text:span text:style-name="CodeDansTexte">npm uninstall</text:span></text:a>&#160;:
undefined</text:p>
<text:p text:style-name="Code">$ npm uninstall --global serve</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-08"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;8</text:a> sera l&#8217;occasion d&#8217;entrer plus
en dÃ©tail dans le dÃ©veloppement d&#8217;exÃ©cutables systÃ¨me Ã©crits en ECMAScript.</text:p>
<text:bookmark text:name="ref-scripts" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Outiller un projet avec les scripts&#160;npm</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les scripts&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> sont des outils puissants qui <text:span text:style-name="T7">autonomisent l&#8217;outillage projet</text:span>,
<text:span text:style-name="T7">automatisent des actions</text:span> manuelles et <text:span text:style-name="T7">simplifient des actions</text:span> trop
complexes Ã  mÃ©moriser.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ils sont consignÃ©s dans la section <text:span text:style-name="CodeDansTexte">scripts</text:span> du fichier <text:span text:style-name="CodeDansTexte">package.json</text:span>.
Ils se basent sur des scripts Node et des modules <text:span text:style-name="CodeDansTexte">npm</text:span> pour
lancer des actions quand des fichiers sont modifiÃ©s,
transformer des feuilles de style, exÃ©cuter des tests unitaires ou fonctionnels,
dÃ©ployer le projet, entre autres.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ils permettent de crÃ©er des conventions entre nos projets.
Nous rÃ©utiliserons ainsi les mÃªmes noms et adapterons les commandes
au projet en question.</text:p>
<text:bookmark text:name="ref-start" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">DÃ©marrer l&#8217;application</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le script <text:span text:style-name="CodeDansTexte">npm start</text:span> concerne les projets dont le script principal
tourne en continu&#160;â€“ une application web par exemple.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exemple suivant dÃ©marre un serveur web sans que nous ayons Ã  connaÃ®tre
la commande associÃ©e&#160;:</text:p>
<text:p text:style-name="Code">$ npm start</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">&gt; nodebook.chapter-05@1.0.0 start<text:s text:c="9"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">&gt; micro examples/app.js<text:s text:c="19"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">micro: Accepting connections on port 3000</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> L&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">npm</text:span> affiche le nom du script en cours d&#8217;exÃ©cution<text:line-break/><text:span text:style-name="PuceCode">2</text:span> <text:span text:style-name="CodeDansTexte">micro examples/app.js</text:span> est la commande rÃ©ellement exÃ©cutÃ©e par npm<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous sommes libres de renseigner la valeur du champ <text:span text:style-name="CodeDansTexte">scripts.start</text:span>
du fichier <text:span text:style-name="CodeDansTexte">package.json</text:span> comme bon nous semble&#160;:
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">package.json</text:p><text:p text:style-name="Code">{</text:p><text:p text:style-name="Code"><text:s text:c="2"/>...</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"scripts": {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"start": "micro examples/app.js"</text:p><text:p text:style-name="Code"><text:s text:c="2"/>},</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"dependencies": {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"micro": "^9.3.3"</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">}</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous avons utilisÃ© le module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> <text:span text:style-name="T4">micro</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/micro" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/micro</text:a></text:span>)
pour dÃ©marrer une application web.
Plus exactement, nous avons utilisÃ© l&#8217;exÃ©cutable fourni par ce module.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Pratique</text:span> Les modules exÃ©cutables dans les scripts&#160;npm</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Les <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-install.global"  text:visited-style-name="Visited_20_Internet_20_Link">modules <text:span text:style-name="CodeDansTexte">npm</text:span> exÃ©cutables</text:a> sont disponibles au niveau du
systÃ¨me lorsqu&#8217;ils sont installÃ©s avec l&#8217;option <text:span text:style-name="CodeDansTexte">--global</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Les exÃ©cutables des modules listÃ©s dans <text:span text:style-name="CodeDansTexte">dependencies</text:span> et <text:span text:style-name="CodeDansTexte">devDependencies</text:span>
sont utilisables dans les scripts&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Nous pouvons ainsi contenir tous les exÃ©cutables nÃ©cessaires dans les
dÃ©pendances du projet.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous verrons dans le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-../chapter-06/index.adoc"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;6</text:a> que les
plates-formes de service utilisent aussi la valeur du champ <text:span text:style-name="CodeDansTexte">scripts.start</text:span>
pour dÃ©terminer comment dÃ©marrer notre application.</text:p>
<text:bookmark text:name="ref-test" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">ExÃ©cuter des tests</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le script <text:span text:style-name="CodeDansTexte">npm test</text:span> concerne tous les projets pour lesquels nous avons Ã©crit
des tests qu&#8217;ils soient unitaires ou fonctionnels.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;intention de la commande lancÃ©e par le script&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> est de terminer
en erreur si un des tests n&#8217;aboutit pas au rÃ©sultat escomptÃ©.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exemple suivant lance un test unitaire qui s&#8217;assure de la cohÃ©rence
d&#8217;un des exemples prÃ©cÃ©dents&#160;:</text:p>
<text:p text:style-name="Code">$ npm test</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">&gt; nodebook.chapter-05@1.0.0 test<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">&gt; mocha examples/tests.js<text:s text:c="9"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">app.js</text:p><text:p text:style-name="Code"><text:s text:c="2"/>âœ“ prints a cow as a response</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">1 passing</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> L&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">npm</text:span> affiche le nom du script en cours d&#8217;exÃ©cution.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> <text:span text:style-name="CodeDansTexte">mocha examples/tests.js</text:span> est la commande rÃ©ellement exÃ©cutÃ©e par npm.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette fois-ci, nous avons personnalisÃ© la valeur du champ <text:span text:style-name="CodeDansTexte">scripts.test</text:span>
du fichier <text:span text:style-name="CodeDansTexte">package.json</text:span>&#160;:
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">package.json</text:p><text:p text:style-name="Code">{</text:p><text:p text:style-name="Code"><text:s text:c="2"/>...</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"scripts": {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"test": "mocha examples/tests.js"</text:p><text:p text:style-name="Code"><text:s text:c="2"/>},</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"devDependencies": {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"mocha": "^5.2.0"</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">}</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous avons eu recours au module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> <text:span text:style-name="T4">mocha</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/mocha" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/mocha</text:a></text:span>),
de mÃªme qu&#8217;avec le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-start"  text:visited-style-name="Visited_20_Internet_20_Link">script de dÃ©marrage</text:a>, nous nous sommes basÃ©s
sur l&#8217;exÃ©cutable fourni par le module.
En revanche, nous l&#8217;avons listÃ© dans la <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-install.dev"  text:visited-style-name="Visited_20_Internet_20_Link">section <text:span text:style-name="CodeDansTexte">devDependencies</text:span></text:a>
car il est relatif Ã  l&#8217;outillage du projet.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les services d&#8217;intÃ©gration continue lancent le script <text:span text:style-name="CodeDansTexte">npm test</text:span>
lorsqu&#8217;ils dÃ©tectent qu&#8217;ils ont affaire Ã  un projet Node.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> Scripts dÃ©finis par&#160;npm</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">D&#8217;autres scripts que <text:span text:style-name="CodeDansTexte">test</text:span> et <text:span text:style-name="CodeDansTexte">start</text:span> sont dÃ©finis par l&#8217;exÃ©cutable&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>.
Ils sont tous documentÃ©s sur&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://docs.npmjs.com/misc/scripts" text:visited-style-name="Visited_20_Internet_20_Link">https://docs.npmjs.com/misc/scripts</text:a></text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-run" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">CrÃ©er un script&#160;npm personnalisÃ©</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les scripts&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> personnalisÃ©s sont utiles <text:span text:style-name="T7">lorsque nous souhaitons outiller</text:span>
notre projet sans forcÃ©ment que ce soit en rapport avec le lancement des tests
ou de l&#8217;application.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les scripts personnalisÃ©s se dÃ©marrent avec <text:span text:style-name="CodeDansTexte">npm run</text:span>&#160;:</text:p>
<text:p text:style-name="Code">$ npm <text:span text:style-name="CodeExergue">run</text:span> print-args</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">&gt; nodebook.chapter-05@1.0.0 print-args</text:p><text:p text:style-name="Code">&gt; node examples/print-args.js</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">Rien Ã  signaler.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous avons crÃ©Ã© ce script en configurant la valeur du champ <text:span text:style-name="CodeDansTexte">scripts.print-args</text:span>
du fichier <text:span text:style-name="CodeDansTexte">package.json</text:span>&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">package.json</text:p><text:p text:style-name="Code">{</text:p><text:p text:style-name="Code"><text:s text:c="2"/>...</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"scripts": {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"print-args": "node examples/print-args.js"</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">}</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Pratique</text:span> Lister les scripts disponibles</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">La commande <text:span text:style-name="CodeDansTexte">npm run</text:span> (sans argument) liste tous les scripts&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> du projet.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Avec le temps, j&#8217;ai dÃ©veloppÃ© les conventions suivantes&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="CodeDansTexte">npm run build</text:span>&#160;: construit les artefacts Ã  dÃ©ployer.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="CodeDansTexte">npm run deploy</text:span>&#160;: dÃ©ploie le projet vers l&#8217;hÃ©bergeur.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="CodeDansTexte">npm run lint</text:span>&#160;: applique un vÃ©rificateur syntaxique au code du projet.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="CodeDansTexte">npm run watch</text:span>&#160;: dÃ©marre l&#8217;application et la relance Ã  chaque changement.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Pratique</text:span> Passer des arguments Ã  un script&#160;npm</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
Une option spÃ©ciale nous aide Ã  transmettre des arguments Ã  un script.
Les arguments doivent Ãªtre placÃ©s Ã  droite de l&#8217;option <text:span text:style-name="CodeDansTexte">--</text:span>&#160;:</text:p>
<text:p text:style-name="RemarqueCode">$ npm run print-args un --test=true</text:p><text:p text:style-name="RemarqueCode">['un']</text:p><text:p text:style-name="RemarqueCode">$ npm run print-args ##--## un --test=true</text:p><text:p text:style-name="RemarqueCode">['un', '--test=true']</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un script&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> peut faire appel Ã  d&#8217;autres&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">package.json</text:p><text:p text:style-name="Code">{</text:p><text:p text:style-name="Code"><text:s text:c="2"/>...</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"scripts": {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"lint": "eslint ./examples",</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"test": "npm run lint <text:span text:style-name="CodeExergue">&amp;&amp;</text:span> mocha examples/tests.js"</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">}</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">J&#8217;ai plutÃ´t tendance Ã  dÃ©couper mes scripts de sorte Ã  ce qu&#8217;ils fassent
tous une chose et une seule.
Je peux ainsi les appeler de maniÃ¨re individuelle.
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">package.json</text:p><text:p text:style-name="Code">{</text:p><text:p text:style-name="Code"><text:s text:c="2"/>...</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"scripts": {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"lint": "eslint ./examples",</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"test": "npm run lint &amp;&amp; npm run test:unit",</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"test:unit": "mocha examples/tests.js"</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">}</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La section suivante va nous aider Ã  orchestrer l&#8217;exÃ©cution des scripts
les uns par rapport aux autres.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Pratique</text:span> AccÃ©der aux valeurs du fichier <text:span text:style-name="CodeDansTexte">package.json</text:span></text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
Toutes les sections du fichier <text:span text:style-name="CodeDansTexte">package.json</text:span> sont accessibles depuis
les scripts&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> sous forme de
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process.argv"  text:visited-style-name="Visited_20_Internet_20_Link">variables d&#8217;environnement</text:a>.
Leur nom est prÃ©fixÃ© par <text:span text:style-name="CodeDansTexte">npm_package</text:span> suivi de leur nom <text:span text:style-name="">mis Ã  plat</text:span>.
Ainsi, le champ <text:span text:style-name="CodeDansTexte">version</text:span> est accessible en tant que <text:span text:style-name="CodeDansTexte">$npm_package_version</text:span>
et le champ <text:span text:style-name="CodeDansTexte">config.port</text:span> en tant que <text:span text:style-name="CodeDansTexte">$npm_package_config_port</text:span>&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">package.json</text:p><text:p text:style-name="RemarqueCode">{</text:p><text:p text:style-name="RemarqueCode"><text:s text:c="2"/>...</text:p><text:p text:style-name="RemarqueCode"><text:s text:c="2"/>"<text:span text:style-name="CodeExergue">config</text:span>": {</text:p><text:p text:style-name="RemarqueCode"><text:s text:c="4"/>"<text:span text:style-name="CodeExergue">port</text:span>": "4000"</text:p><text:p text:style-name="RemarqueCode"><text:s text:c="2"/>};</text:p><text:p text:style-name="RemarqueCode"><text:s text:c="2"/>"scripts": {</text:p><text:p text:style-name="RemarqueCode"><text:s text:c="4"/>"start": "node server --port $npm_package_<text:span text:style-name="CodeExergue">config</text:span>_<text:span text:style-name="CodeExergue">port</text:span>",</text:p><text:p text:style-name="RemarqueCode"><text:s text:c="2"/>}</text:p><text:p text:style-name="RemarqueCode">}</text:p>
<text:bookmark text:name="ref-run-pre-post" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">ExÃ©cuter des commandes avant et aprÃ¨s des scripts&#160;npm</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;ordre d&#8217;exÃ©cution des scripts se contrÃ´le en utilisant les prÃ©fixes
<text:span text:style-name="CodeDansTexte">pre</text:span> et <text:span text:style-name="CodeDansTexte">post</text:span>.
Par exemple, les scripts nommÃ©s <text:span text:style-name="CodeDansTexte">pretest</text:span> et <text:span text:style-name="CodeDansTexte">posttest</text:span> seront exÃ©cutÃ©s
respectivement avant et aprÃ¨s le script <text:span text:style-name="CodeDansTexte">test</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">package.json</text:p><text:p text:style-name="Code">{</text:p><text:p text:style-name="Code"><text:s text:c="2"/>...</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"scripts": {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"lint": "eslint ./examples",</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"test": "mocha examples/tests.js",</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"<text:span text:style-name="CodeExergue">pre</text:span>test": "npm run lint"</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">}</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans cet exemple de configuration, l&#8217;exÃ©cution de la commande <text:span text:style-name="CodeDansTexte">npm test</text:span>
lancera d&#8217;abord le script <text:span text:style-name="CodeDansTexte">pretest</text:span>, puis <text:span text:style-name="CodeDansTexte">lint</text:span> puis enfin&#160;<text:span text:style-name="CodeDansTexte">test</text:span>&#160;:
undefined</text:p>
<text:p text:style-name="Code">$ npm test</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">&gt; nodebook.chapter-05@1.0.0 pretest</text:p><text:p text:style-name="Code">&gt; npm run lint</text:p><text:p text:style-name="Code">...</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">&gt; nodebook.chapter-05@1.0.0 lint</text:p><text:p text:style-name="Code">&gt; eslint ./examples</text:p><text:p text:style-name="Code">...</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">&gt; nodebook.chapter-05@1.0.0 test</text:p><text:p text:style-name="Code">&gt; mocha examples/tests.js</text:p><text:p text:style-name="Code">...</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce mÃ©canisme est utile pour s&#8217;intercaler sur des temps particuliers
du cycle de vie d&#8217;un projet&#160;Node.
En voici une sÃ©lection.</text:p>
<text:bookmark text:name="ref-undefined" /><table:table table:style-name="Tableau1"><table:table-column />,<table:table-column />,<table:table-column /><table:table-row><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Script</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Quand ?</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Pourquoi ?</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">pretest</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Avant les tests</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>PrÃ©parer l&#8217;espace de travail</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">posttest</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>AprÃ¨s les tests</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>VÃ©rifier les rÃ¨gles de syntaxe de notre code</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">postinstall</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>AprÃ¨s installation les dÃ©pendances</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>PrÃ©paration significative du projet (tÃ©lÃ©chargements supplÃ©mentaires, etc.)</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">prestart</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Avant de dÃ©marrer l&#8217;application</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>PrÃ©paratifs lÃ©gers</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">prepublishOnly</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Avant de publier le module</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>PrÃ©paration du projet avant de le distribuer (compilation de fichiers, etc.)</text:p></table:table-cell></table:table-row></table:table>
<text:bookmark text:name="ref-run-all" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Automatiser tout l&#8217;outillage projet</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les scripts&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> suffisent Ã  outiller la majoritÃ© des projets.
Cependant ils deviennent difficiles Ã  lire lorsque les
lignes deviennent trop longues.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">npm-run-all</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/npm-run-all" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/npm-run-all</text:a></text:span>) est un
module qui parallÃ©lise leur exÃ©cution et simplifie l&#8217;appel d&#8217;un groupe de scripts.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">package.json</text:p><text:p text:style-name="Code">{</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"scripts": {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"build": "npm-run-all --parallel 'build:*'", <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>"build:front-end": "browserify ...",</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"build:backend": "browserify ...",</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"build:css": "sass ..."</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"devDependencies": {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"npm-run-all": "*"</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">}</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Les trois scripts prÃ©fixÃ©s par <text:span text:style-name="CodeDansTexte">build:</text:span> seront appelÃ©s en parallÃ¨le en exÃ©cutant <text:span text:style-name="CodeDansTexte">npm run build</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il est aussi possible de dÃ©clencher des actions parallÃ¨les aprÃ¨s une premiÃ¨re
action sÃ©quentielle.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">package.json</text:p><text:p text:style-name="Code">{</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"scripts": {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"clean": "rm -rf ./dist",</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"build": "npm-run-all clean --parallel 'build:*'", <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>"build:front-end": "browserify ...",</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"build:backend": "browserify ..."</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"devDependencies": {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"npm-run-all": "*"</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">}</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> <text:span text:style-name="CodeDansTexte">npm-run-all</text:span> exÃ©cute le script <text:span text:style-name="CodeDansTexte">clean</text:span> avant les autres scripts prÃ©fixÃ©s par <text:span text:style-name="CodeDansTexte">build:</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ils vous appartient d&#8217;orchestrer les scripts en les groupant avec un motif de noms
ainsi qu&#8217;en combinant les options <text:span text:style-name="CodeDansTexte">--parallel</text:span> (alias&#160;<text:span text:style-name="CodeDansTexte">-p</text:span>)
et <text:span text:style-name="CodeDansTexte">--sequential</text:span> (alias&#160;<text:span text:style-name="CodeDansTexte">-s</text:span>) pour activer ou dÃ©sactiver
le parallÃ©lisme d&#8217;exÃ©cution.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Remarque</text:span> Pourtant j&#8217;ai entendu parler de Gulp et de Grunt</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">L&#8217;Ã©norme avantage d&#8217;outiller un projet avec la commande <text:span text:style-name="CodeDansTexte">npm run</text:span> et
l&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">npm-run-all</text:span> est que nous utilisons directement les outils
dont nous avons besoin.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Gulp et Grunt introduisent une complexitÃ© d&#8217;apprentissage et des couches
d&#8217;abstraction qui augmentent la fragilitÃ© de l&#8217;outillage et la barriÃ¨re d&#8217;entrÃ©e de nos projets.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">C&#8217;est tant mieux si nous pouvons nous en passer pour faÃ§onner nos propres outils.</text:p>
<text:bookmark text:name="ref-package.json" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Anatomie du fichier <text:span text:style-name="">package.json</text:span></text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le fichier <text:span text:style-name="CodeDansTexte">package.json</text:span> est essentiel pour tirer parti de l&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">npm</text:span>.
Tout projet concernÃ© par l'<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-install"  text:visited-style-name="Visited_20_Internet_20_Link">installation de modules <text:span text:style-name="CodeDansTexte">npm</text:span></text:a> ou par
l'<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-scripts"  text:visited-style-name="Visited_20_Internet_20_Link">outillage des scripts</text:a> va forcÃ©ment avoir ce fichier quelque
part dans son arborescence.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il se dÃ©compose en plusieurs parties&#160;:
les <text:span text:style-name="T7">informations gÃ©nÃ©rales</text:span> qui aident les utilisateurs et utilisatrices
Ã  dÃ©couvrir le module en <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-registry"  text:visited-style-name="Visited_20_Internet_20_Link">effectuant une recherche</text:a>,
les <text:span text:style-name="T7">points d&#8217;entrÃ©e</text:span> pour inclure ou exÃ©cuter le module
et la <text:span text:style-name="T7">configuration projet</text:span> qui affecte le fonctionnement de l&#8217;exÃ©cutable npm.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TableauTitre">Tableau 6. Informations pour faciliter la dÃ©couverte et la comprÃ©hension</text:p><table:table table:style-name="Tableau1"><table:table-column />,<table:table-column />,<table:table-column />,<table:table-column />,<table:table-column /><table:table-row><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Section</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Obligatoire&#160;?</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Type</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Modifiable</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Description</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">version</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2714;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-semver"  text:visited-style-name="Visited_20_Internet_20_Link">Semver</text:a></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Avec <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-version"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">npm version</text:span></text:a></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p></text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">description</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2714;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Texte</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Ã€ la main</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Explique l&#8217;intention du module Ã  une personne qui le dÃ©couvre</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">keywords</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2718;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Tableau de texte</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Ã€ la main</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Facilite sa dÃ©couverte sur <text:span text:style-name="URL">npmjs.com</text:span></text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">homepage</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2714;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Texte&#160;(URL)</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Ã€ la main</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Indique oÃ¹ trouver de la documentation et des exemples d&#8217;utilisation â€“ cela peut Ãªtre l&#8217;adresse du dÃ©pÃ´t GitLab ou GitHub</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">license</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2718;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Texte</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Ã€ la main</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Explicite les conditions de rÃ©utilisation du code dans un autre projet</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">bugs.url</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2718;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Texte&#160;(URL)</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Ã€ la main</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Facilite la remontÃ©e de bogues</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">repository.type</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2718;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Texte</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Ã€ la main</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>En gÃ©nÃ©ral la valeur est <text:span text:style-name="CodeDansTexte">git</text:span></text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">repository.url</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2718;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Texte&#160;(URL)</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Ã€ la main</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Facilite la dÃ©couverte du code source Ã  l&#8217;origine du module</text:p></table:table-cell></table:table-row></table:table>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TableauTitre">Tableau 7. Points d&#8217;entrÃ©e pour utiliser votre module</text:p><table:table table:style-name="Tableau1"><table:table-column />,<table:table-column />,<table:table-column />,<table:table-column />,<table:table-column /><table:table-row><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Section</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Obligatoire&#160;?</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Type</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Modifiable</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Description</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">name</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2714;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Texte</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Ã€ la main</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Correspond au nom Ã  spÃ©cifier aux fonctions <text:span text:style-name="CodeDansTexte">require()</text:span> et <text:span text:style-name="CodeDansTexte">import</text:span>. Un changement de nom obligera Ã  mettre Ã  jour tous les scripts qui appellent ce module</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">main</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2718;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Texte (chemin)</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Ã€ la main</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Script qui sera utilisÃ© lors de l&#8217;appel Ã  <text:span text:style-name="CodeDansTexte">require()</text:span> et <text:span text:style-name="CodeDansTexte">import</text:span> (par dÃ©faut <text:span text:style-name="CodeDansTexte">index.js</text:span>)</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">bin</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2718;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Texte (chemin)</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Ã€ la main</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Script qui sera utilisÃ© comme exÃ©cutable lors de l&#8217;appel <text:span text:style-name="CodeDansTexte">npx &lt;module&gt;</text:span></text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">bin</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2718;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Objet (nom/chemin)</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Ã€ la main</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Idem â€“ forme qui permet de dÃ©clarer plusieurs exÃ©cutables au sein d&#8217;un mÃªme module</text:p></table:table-cell></table:table-row></table:table>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TableauTitre">Tableau 8. Configuration projet pour l&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">npm</text:span></text:p><table:table table:style-name="Tableau1"><table:table-column />,<table:table-column />,<table:table-column />,<table:table-column />,<table:table-column /><table:table-row><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Section</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Obligatoire&#160;?</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Type</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Modifiable</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Description</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">private</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2718;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>BoolÃ©en</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Ã€ la main</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>EmpÃªche la publication accidentelle sur le registre&#160;<text:span text:style-name="CodeDansTexte">npm</text:span></text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">engines</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2718;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Objet (nom/<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-semver"  text:visited-style-name="Visited_20_Internet_20_Link">SemVer</text:a>)</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Ã€ la main</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Certains hÃ©bergeurs utilisent ce champ pour dÃ©terminer la version de Node Ã  utiliser</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">dependencies</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2718;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Objet (nom/<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-semver"  text:visited-style-name="Visited_20_Internet_20_Link">SemVer</text:a>)</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Avec <text:span text:style-name="CodeDansTexte">npm install</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Voir la section <text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-install"  text:visited-style-name="Visited_20_Internet_20_Link">Installer des modules <text:span text:style-name="CodeDansTexte">npm</text:span></text:a></text:span></text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">devDependencies</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2718;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Objet (nom/<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-semver"  text:visited-style-name="Visited_20_Internet_20_Link">SemVer</text:a>)</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Avec <text:span text:style-name="CodeDansTexte">npm install</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Voir la section <text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-install.dev"  text:visited-style-name="Visited_20_Internet_20_Link">DÃ©pendances de dÃ©veloppement</text:a></text:span></text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">scripts</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2718;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Objet (nom/commande)</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Ã€ la main</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Voir la section <text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-scripts"  text:visited-style-name="Visited_20_Internet_20_Link">Scripts&#160;<text:span text:style-name="CodeDansTexte">npm</text:span></text:a></text:span></text:p></table:table-cell></table:table-row></table:table>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> Tout sur le fichier package.json</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
undefined
La page <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://docs.npmjs.com/files/package.json" text:visited-style-name="Visited_20_Internet_20_Link">https://docs.npmjs.com/files/package.json</text:a></text:span> documente
de maniÃ¨re exhaustive les sections du fichier <text:span text:style-name="CodeDansTexte">package.json</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">En la lisant, vous apprendrez l&#8217;existence d&#8217;autres sections qui pourraient
peut-Ãªtre vous intÃ©resser.</text:p>
<text:bookmark text:name="ref-commands" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Quelques commandes pour aller plus&#160;loin</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous venons de voir les commandes les plus utilisÃ©es de l&#8217;exÃ©cutable&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>.
Il en existe d&#8217;autres dont l&#8217;intÃ©rÃªt varie en fonction de vos envies et de
vos pratiques de dÃ©veloppement.
Pas d&#8217;inquiÃ©tude donc si vous ne les utilisez pas toutes&#160;:
j&#8217;en parle pour <text:span text:style-name="T7">Ã©clairer quelques points intÃ©ressants Ã  explorer</text:span>.</text:p>
<text:bookmark text:name="ref-view" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">npm view : voir les informations d&#8217;un module</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La commande <text:span text:style-name="CodeDansTexte">npm view</text:span> donne une vue synthÃ©tique d&#8217;un module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> donnÃ©.
Elle est similaire Ã  celle que nous pourrions trouver sur le registre&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>,
mais condensÃ©e pour l&#8217;affichage dans un terminal.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous y retrouvons des informations fournies par les personnes en charge du module
ainsi que d&#8217;autres, fournies par le registre&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>.</text:p>
<text:p text:style-name="Code">$ npm view nodebook</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">nodebook@0.9.1 | CC-BY-NC-SA-4.0 | deps: 6 | versions: 21</text:p><text:p text:style-name="Code">Node.js â€“ Apprendre par l'exemple</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">keywords: nodejs, book, french, livre, learn, apprendre</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">bin: nodebook</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">dist</text:p><text:p text:style-name="Code">.tarball https://registry.npmjs.org/nodebook/nodebook-0.9.1.tgz</text:p><text:p text:style-name="Code">.shasum: 5ea87e9b85782e23164705a49cb7bd2dc4063775</text:p><text:p text:style-name="Code">.integrity: sha512-...</text:p><text:p text:style-name="Code">.unpackedSize: 15.0 MB</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">dependencies:</text:p><text:p text:style-name="Code">finalhandler: ^1.1.1<text:s text:c="2"/>serve-static: ^1.13.2</text:p><text:p text:style-name="Code">get-port: ^3.2.0<text:s text:c="6"/>update-check: ^1.5.2</text:p><text:p text:style-name="Code">glob: ^7.1.2<text:s text:c="10"/>yargs: ^11.1.0</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">maintainers:</text:p><text:p text:style-name="Code">- oncletom</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">dist-tags:</text:p><text:p text:style-name="Code">latest: 0.9.1</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">published 23 hours ago by oncletom</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">bin</text:span></text:h>
<text:p text:style-name="Remarque">Indique la prÃ©sence d&#8217;un moins un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-install.global"  text:visited-style-name="Visited_20_Internet_20_Link">exÃ©cutable</text:a>.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">dist</text:span></text:h>
<text:p text:style-name="Remarque">Donne des informations Ã  propos du fichier tÃ©lÃ©chargÃ© avec <text:span text:style-name="CodeDansTexte">npm install &lt;module&gt;</text:span>.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">dependencies</text:span></text:h>
<text:p text:style-name="Remarque">Liste les modules additionnels tÃ©lÃ©chargÃ©s lors de l&#8217;installation.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">dist-tags</text:span></text:h>
<text:p text:style-name="Remarque">PrÃ©cise les Ã©tiquettes dÃ©finies par personnes en charge du module,
utiles quand nous souhaitons <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-install.version"  text:visited-style-name="Visited_20_Internet_20_Link">jongler entre ses diffÃ©rentes versions</text:a>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous pouvons aussi zoomer sur une mÃ©tadonnÃ©e.
Par exemple, spÃ©cifions le champ <text:span text:style-name="CodeDansTexte">dependencies</text:span> pour ne lister que les
dÃ©pendances directes&#160;:</text:p>
<text:p text:style-name="Code">$ npm view nodebook dependencies</text:p><text:p text:style-name="Code">{ finalhandler: '^1.1.1',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>'get-port': '^3.2.0',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>glob: '^7.1.2',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>'serve-static': '^1.13.2',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>'update-check': '^1.5.2',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>yargs: '^11.1.0' }</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il est mÃªme possible de zoomer sur un niveau plus fin de mÃ©tadonnÃ©e,
avec une annotation similaire Ã  celle d&#8217;un objet ECMAScript&#160;:</text:p>
<text:p text:style-name="Code">$ npm view nodebook dist.<text:span text:style-name="CodeExergue">unpackedSize</text:span></text:p><text:p text:style-name="Code">14985184</text:p><text:p text:style-name="Code">$ npm view nodebook dist</text:p><text:p text:style-name="Code">{ integrity:</text:p><text:p text:style-name="Code"><text:s text:c="3"/>'sha512-...',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>shasum: '5ea87e9b85782e23164705a49cb7bd2dc4063775',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>tarball:</text:p><text:p text:style-name="Code"><text:s text:c="4"/>'https://registry.npmjs.org/nodebook/nodebook-0.9.1.tgz',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>fileCount: 486,</text:p><text:p text:style-name="Code"><text:s text:c="2"/><text:span text:style-name="CodeExergue">unpackedSize</text:span>: 14985184 }</text:p>
<text:bookmark text:name="ref-npx" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">npx : exÃ©cuter un module sans l&#8217;installer</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L'<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-install.global"  text:visited-style-name="Visited_20_Internet_20_Link">installation globale</text:a> est idÃ©ale pour disposer d&#8217;un module
npm sous forme d&#8217;exÃ©cutable systÃ¨me.
On peut cependant vite arriver Ã  en installer beaucoup sans vraiment penser Ã 
les enlever quand on n&#8217;en a plus besoin.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">npx</text:span> (pour <text:span text:style-name="CodeDansTexte">npm executable</text:span>) s&#8217;installe automatiquement avec npm.
Il agit comme un raccourci&#160;: il va rÃ©cupÃ©rer le module dÃ©sirÃ© et l&#8217;exÃ©cute en
lui passant les arguments souhaitÃ©s.</text:p>
<text:p text:style-name="Code">$ npx cowsay Magique !</text:p><text:p text:style-name="Code">npx: installed 10 in 2.122s</text:p><text:p text:style-name="Code"> ___________</text:p><text:p text:style-name="Code">&lt; Magique ! &gt;</text:p><text:p text:style-name="Code"> -----------</text:p><text:p text:style-name="Code"><text:s text:c="8"/>\<text:s text:c="3"/>^__^</text:p><text:p text:style-name="Code"><text:s text:c="9"/>\<text:s text:c="2"/>(oo)\_______</text:p><text:p text:style-name="Code"><text:s text:c="12"/>(__)\<text:s text:c="7"/>)\/\</text:p><text:p text:style-name="Code"><text:s text:c="16"/>||----w |</text:p><text:p text:style-name="Code"><text:s text:c="16"/>||<text:s text:c="5"/>||</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">C&#8217;est en quelque sorte l&#8217;Ã©quivalent des trois commandes suivantes&#160;:</text:p>
<text:p text:style-name="Code">$ npm install --global cowsay</text:p><text:p text:style-name="Code">$ cowsay Magique !</text:p><text:p text:style-name="Code">$ npm uninstall cowsay</text:p>
<text:bookmark text:name="ref-home" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">npm home : visiter le site web d&#8217;un module</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Vous vous demandez oÃ¹ trouver davantage de documentation Ã  propos d&#8217;un
module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>&#160;?
<text:span text:style-name="CodeDansTexte">npm home</text:span> ouvre un nouvel onglet de navigateur et dirige ce dernier
vers sur le site web du module de votre choix.</text:p>
<text:p text:style-name="Code">$ npm home lodash</text:p><text:p text:style-name="Code">$ npm home micro</text:p>
<text:bookmark text:name="ref-audit" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">npm audit : vÃ©rifier la sÃ©curitÃ© des dÃ©pendances</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La commande <text:span text:style-name="CodeDansTexte">npm audit</text:span> part Ã  la recherche de vulnÃ©rabilitÃ©s connues
dans l&#8217;intÃ©gralitÃ© des dÃ©pendances d&#8217;un projet.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="CodeDansTexte">npm install</text:span> effectue un audit de maniÃ¨re implicite afin de s&#8217;assurer
que notre projet n&#8217;est pas compromis Ã  notre insu.
Les deux derniÃ¨res lignes sont issues de la fonctionnalitÃ© d&#8217;audit de sÃ©curitÃ©&#160;:</text:p>
<text:p text:style-name="Code">$ npm install lodash@3</text:p><text:p text:style-name="Code">+ lodash@3.10.1</text:p><text:p text:style-name="Code">added 1 package from 5 contributors in 1.95s</text:p><text:p text:style-name="Code">found 1 low severity vulnerability</text:p><text:p text:style-name="Code"><text:s text:c="2"/>run `npm audit fix` to fix them, or `npm audit` for details</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un affichage plus dÃ©taillÃ© est prÃ©sentÃ© en exÃ©cutant <text:span text:style-name="CodeDansTexte">npm audit</text:span>&#160;:</text:p>
<text:p text:style-name="Code">$ npm audit</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"># Run<text:s text:c="2"/>npm install lodash@4.17.10<text:s text:c="2"/>to resolve 1 vulnerability</text:p><text:p text:style-name="Code">Recommended action is a potentially breaking change</text:p><text:p text:style-name="Code">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</text:p><text:p text:style-name="Code">â”‚ Low<text:s text:c="11"/>â”‚ Prototype Pollution<text:s text:c="23"/>â”‚</text:p><text:p text:style-name="Code">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</text:p><text:p text:style-name="Code">â”‚ Package<text:s text:c="7"/>â”‚ <text:span text:style-name="CodeExergue">lodash</text:span><text:s text:c="36"/>â”‚</text:p><text:p text:style-name="Code">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</text:p><text:p text:style-name="Code">â”‚ Dependency of â”‚ lodash<text:s text:c="36"/>â”‚</text:p><text:p text:style-name="Code">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</text:p><text:p text:style-name="Code">â”‚ <text:span text:style-name="CodeExergue">Path</text:span><text:s text:c="10"/>â”‚ lodash<text:s text:c="36"/>â”‚</text:p><text:p text:style-name="Code">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</text:p><text:p text:style-name="Code">â”‚ More info<text:s text:c="5"/>â”‚ https://nodesecurity.io/advisories/577<text:s text:c="4"/>â”‚</text:p><text:p text:style-name="Code">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">found 1 low severity vulnerability</text:p><text:p text:style-name="Code"><text:s text:c="2"/>1 vulnerability requires semver-major dependency updates.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Chaque module concernÃ© par une faille connue est listÃ© Ã  l&#8217;Ã©cran (champ <text:span text:style-name="CodeDansTexte">Package</text:span>).
Le champ <text:span text:style-name="CodeDansTexte">Path</text:span> spÃ©cifie l&#8217;arbre de dÃ©pendances qui mÃ¨ne Ã  la vulnÃ©rabilitÃ©
â€“ c&#8217;est utile pour identifier quelle dÃ©pendance directe actualiser.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La commande <text:span text:style-name="CodeDansTexte">npm audit</text:span> prÃ©cise la marche Ã  suivre dÃ¨s qu&#8217;elle le peut.
Ici, elle indique qu&#8217;une <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-semver"  text:visited-style-name="Visited_20_Internet_20_Link">mise Ã  jour majeure</text:a> est
nÃ©cessaire pour se dÃ©barrasser du problÃ¨me.
Cela nÃ©cessitera peut-Ãªtre d&#8217;ajuster le code utilisant cette
dÃ©pendance sous peine de casser notre application.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La commande <text:span text:style-name="CodeDansTexte">npm audit fix</text:span> corrigera toutes les dÃ©pendances pour lesquelles
il est possible de changer la version de maniÃ¨re automatique et sans risque.
Les mises Ã  jour majeures sont toujours manuelles et demandent votre intervention.
undefined</text:p>
<text:bookmark text:name="ref-ci" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">npm clean-install : installer Ã  toute vitesse</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La commande <text:span text:style-name="CodeDansTexte">npm clean-install</text:span> (<text:span text:style-name="CodeDansTexte">npm ci</text:span>) est destinÃ©e Ã  installer les
modules listÃ©s dans le fichier <text:span text:style-name="CodeDansTexte">package.json</text:span>.
Elle vise Ã  s&#8217;exÃ©cuter plus rapidement et dans des environnements
autres que ceux de dÃ©veloppement&#160;: en intÃ©gration continue, en production, etc.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette commande fait une chose de plus que <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-install"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">npm install</text:span></text:a>&#160;:
elle supprime systÃ©matiquement le rÃ©pertoire <text:span text:style-name="CodeDansTexte">node_modules</text:span> pour rendre
chaque installation reproductible Ã  l&#8217;identique.
Elle fait aussi une chose de moins&#160;: elle se contente d&#8217;installer les
modules tels que listÃ©s dans le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-package-lock"  text:visited-style-name="Visited_20_Internet_20_Link">fichier <text:span text:style-name="CodeDansTexte">package-lock.json</text:span></text:a>.
C&#8217;est ce dernier point qui rend cette commande si rapide&#160;â€“ moins de vÃ©rifications,
moins d&#8217;allers-retours, moins de complexitÃ©.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">.travis.yml</text:p><text:p text:style-name="Code">language: node_js</text:p><text:p text:style-name="Code">node_js: v10</text:p><text:p text:style-name="Code">install: npm ci<text:s text:c="3"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">script: npm test</text:p><text:p text:style-name="Code">cache: npm<text:s text:c="8"/><text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Surcharge la commande par dÃ©faut (<text:span text:style-name="CodeDansTexte">npm install</text:span>)<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Les modules <text:span text:style-name="CodeDansTexte">npm</text:span> seront sauvegardÃ©s entre deux jobs&#160;â€“ l&#8217;installation ira plus vite si les modules sont obtenus depuis le cache plutÃ´t que depuis le registre&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Pratique</text:span> Remettre un projet Ã &#160;zÃ©ro</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">La commande <text:span text:style-name="CodeDansTexte">npm clean-install</text:span> est pratique pour remettre un projet Ã  zÃ©ro,
en cas de problÃ¨me d&#8217;installation ou aprÃ¨s avoir bidouillÃ© dans le rÃ©pertoire
<text:span text:style-name="CodeDansTexte">node_modules</text:span> par exemple.</text:p>
<text:bookmark text:name="ref-doctor" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">npm doctor : vÃ©rifier l&#8217;Ã©tat du systÃ¨me</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="CodeDansTexte">npm doctor</text:span> est une commande utilitaire qui vÃ©rifie que npm trouve
tout ce qu&#8217;il lui faut pour bien fonctionner.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">npm</text:span> inspecte le systÃ¨me Ã  la recherche de Git,
teste la connectivitÃ© vers le registre&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> et s&#8217;assure qu&#8217;il a accÃ¨s en Ã©criture
Ã  des rÃ©pertoires essentiels Ã  son bon fonctionnement.</text:p>
<text:p text:style-name="Code">$ npm doctor</text:p><text:p text:style-name="Code">Check<text:s text:c="31"/>Value</text:p><text:p text:style-name="Code">npm ping<text:s text:c="28"/>OK</text:p><text:p text:style-name="Code">npm -v<text:s text:c="30"/>v6.4.0</text:p><text:p text:style-name="Code">node -v<text:s text:c="29"/>v10.0.0</text:p><text:p text:style-name="Code">npm config get registry<text:s text:c="13"/>https://registry.npmjs.org</text:p><text:p text:style-name="Code">which git<text:s text:c="27"/>/usr/local/bin/git</text:p><text:p text:style-name="Code">Perms check on cached files<text:s text:c="9"/>ok</text:p><text:p text:style-name="Code">Perms check on global node_modules<text:s text:c="2"/>ok</text:p><text:p text:style-name="Code">Perms check on local node_modules<text:s text:c="3"/>ok</text:p><text:p text:style-name="Code">Verify cache contents<text:s text:c="15"/>verified 4066 tarballs</text:p>
<text:bookmark text:name="ref-config" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">npm config : changer les rÃ©glages de l&#8217;exÃ©cutable <text:span text:style-name="">npm</text:span></text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La commande <text:span text:style-name="CodeDansTexte">npm config</text:span> affiche et modifie la configuration
de l&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">npm</text:span>.
Elle se dÃ©coupe en plusieurs sous-commandes comme en atteste cette tentative
d&#8217;utilisation&#160;:</text:p>
<text:p text:style-name="Code">$ npm config</text:p><text:p text:style-name="Code">npm ERR! Usage:</text:p><text:p text:style-name="Code">npm ERR! npm config set &lt;key&gt; &lt;value&gt;</text:p><text:p text:style-name="Code">npm ERR! npm config get [&lt;key&gt;]</text:p><text:p text:style-name="Code">npm ERR! npm config delete &lt;key&gt;</text:p><text:p text:style-name="Code">npm ERR! npm config list [--json]</text:p><text:p text:style-name="Code">npm ERR! npm config edit</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La sous-commande <text:span text:style-name="CodeDansTexte">get</text:span> affiche la valeur par dÃ©faut d&#8217;une clÃ© de configuration&#160;:
undefined</text:p>
<text:p text:style-name="Code">$ npm config get loglevel</text:p><text:p text:style-name="Code">notice</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette configuration reflÃ¨te le degrÃ© d&#8217;affichage de l&#8217;exÃ©cutable.
Elle agit comme un curseur pour choisir une vue plus ou moins dÃ©taillÃ©e de
ce qui se trame sous le capot.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Augmentons le taux d&#8217;affichage avec la sous-commande <text:span text:style-name="CodeDansTexte">set</text:span>&#160;:
undefined</text:p>
<text:p text:style-name="Code">$ npm config set loglevel http</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous voyons dÃ©sormais les requÃªtes HTTP lancÃ©es (ici, en rejouant
l&#8217;exemple d'<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-install.global"  text:visited-style-name="Visited_20_Internet_20_Link">installation globale</text:a> du module&#160;<text:span text:style-name="T4">serve</text:span>)&#160;:</text:p>
<text:p text:style-name="Code">$ npm install --global serve</text:p><text:p text:style-name="Code">GET 200 https://registry.npmjs.org/serve 653ms</text:p><text:p text:style-name="Code">GET 304 https://registry.npmjs.org/chalk 271ms (from cache)</text:p><text:p text:style-name="Code">GET 304 https://registry.npmjs.org/arg 274ms (from cache)</text:p><text:p text:style-name="Code">...</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La sous-commande&#160;<text:span text:style-name="CodeDansTexte">ls</text:span> rÃ©capitule tous nos changements de configuration.
Elle affiche tous les rÃ©glages par dÃ©faut en la suffixant de l&#8217;option <text:span text:style-name="CodeDansTexte">--long</text:span>&#160;:
undefined</text:p>
<text:p text:style-name="Code">$ npm config ls</text:p><text:p text:style-name="Code">$ npm config ls --long</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Pratique</text:span> Sauvegarder sa configuration&#160;npm</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
undefined
Chaque appel Ã  <text:span text:style-name="CodeDansTexte">npm config set</text:span> enregistre les changements dans un fichier
de configuration <text:span text:style-name="CodeDansTexte">~/.npmrc</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Il est propre Ã  l&#8217;utilisateur actif de notre ordinateur.
Il vous appartient de le sauvegarder ou d&#8217;en fournir un spÃ©cifique dans le cadre
de votre environnement de production ou d&#8217;intÃ©gration continue.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Pour y voir plus clair, voici une petite sÃ©lection des Ã©lÃ©ments
de configuration que vous pourriez Ãªtre amenÃ©Â·e Ã  modifier sur votre
machine de dÃ©veloppement ou sur votre configuration de production&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TableauTitre">Tableau 9. SÃ©lection d&#8217;Ã©lÃ©ments de configuration de la commande npm</text:p><table:table table:style-name="Tableau1"><table:table-column />,<table:table-column />,<table:table-column /><table:table-row><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>ClÃ©</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Valeur par dÃ©faut</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Remarque</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">access</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">restricted</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Passez Ã  <text:span text:style-name="CodeDansTexte">public</text:span> pour faire en sorte que les modules faisant partie d&#8217;une organisation soient considÃ©rÃ©s comme publics.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">audit</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">true</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Passez Ã  <text:span text:style-name="CodeDansTexte">false</text:span> pour dÃ©sactiver l&#8217;audit automatique Ã  chaque installation de module (voir <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-audit"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">npm audit</text:span></text:a>).</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">cache</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">~/.npm</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Modifiez le chemin pour que le cache des modules <text:span text:style-name="CodeDansTexte">npm</text:span> soit gÃ©rÃ© ailleurs.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">color</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">true</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Passez Ã  <text:span text:style-name="CodeDansTexte">false</text:span> pour dÃ©sactiver l&#8217;utilisation des couleurs de&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">depth</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">Infinity</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Le nombre utilisÃ© limitera la profondeur d&#8217;affichage des commandes <text:span text:style-name="CodeDansTexte">npm ls</text:span>, <text:span text:style-name="CodeDansTexte">npm outdated</text:span>, etc.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">git</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">git</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Nom de l&#8217;exÃ©cutable ou chemin d&#8217;accÃ¨s de l&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">git</text:span>.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">https-proxy</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Adresse du proxy HTTPS â€“ remplace alors la variable d&#8217;environnement <text:span text:style-name="CodeDansTexte">HTTPS_PROXY</text:span>.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">loglevel</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">notice</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Change le taux d&#8217;affichage des messages â€“ <text:span text:style-name="CodeDansTexte">silent</text:span>, <text:span text:style-name="CodeDansTexte">error</text:span>, <text:span text:style-name="CodeDansTexte">warn</text:span> diminueront ce taux tandis que <text:span text:style-name="CodeDansTexte">http</text:span>, <text:span text:style-name="CodeDansTexte">timing</text:span>, <text:span text:style-name="CodeDansTexte">info</text:span>, <text:span text:style-name="CodeDansTexte">verbose</text:span> ou <text:span text:style-name="CodeDansTexte">silly</text:span> augmenteront le niveau de dÃ©tail.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">offline</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">false</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Passez Ã  <text:span text:style-name="CodeDansTexte">true</text:span> pour que l&#8217;installation des modules <text:span text:style-name="CodeDansTexte">npm</text:span> se fasse sans transiter par le rÃ©seau.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">progress</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">true</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Passez Ã  <text:span text:style-name="CodeDansTexte">false</text:span> pour dÃ©sactiver l&#8217;affichage de la barre de progression.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">proxy</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">true</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Adresse du proxy HTTP â€“ remplace alors la variable d&#8217;environnement <text:span text:style-name="CodeDansTexte">HTTP_PROXY</text:span>.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">registry</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://registry.npmjs.org/" text:visited-style-name="Visited_20_Internet_20_Link">https://registry.npmjs.org/</text:a></text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Changez cette valeur par celle de votre registre privÃ© ou auto-hÃ©bergÃ©.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">send-metrics</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">false</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Passez Ã  <text:span text:style-name="CodeDansTexte">true</text:span> pour envoyer des statistiques d&#8217;utilisation Ã  l&#8217;Ã©quipe de&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">tmp</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">$TMPDIR</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Changez cette valeur pour utiliser un autre rÃ©pertoire temporaire.</text:p></table:table-cell></table:table-row></table:table>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> Tout sur npm&#160;config</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">La page <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://docs.npmjs.com/misc/config#config-settings" text:visited-style-name="Visited_20_Internet_20_Link">https://docs.npmjs.com/misc/config#config-settings</text:a></text:span> documente
de maniÃ¨re exhaustive toutes les clÃ©s de configuration et leur effet sur
l&#8217;exÃ©cutable&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>.</text:p>
<text:bookmark text:name="ref-publish" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">npm publish : publier un module&#160;npm</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous savons comment <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-install"  text:visited-style-name="Visited_20_Internet_20_Link">installer des modules</text:a> depuis le registre,
mais nous n&#8217;avons pas encore vu comment contribuer nous-mÃªme Ã  cet Ã©cosystÃ¨me.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;option <text:span text:style-name="CodeDansTexte">--dry-run</text:span> est peut-Ãªtre la premiÃ¨re Ã  utiliser avec cette commande,
puisqu&#8217;elle fait comme si nous voulions publier le module, mais
sans aller jusqu&#8217;Ã  tÃ©lÃ©verser le code sur le registre&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>.
Je la recommande pour voir de nos propres yeux ce qui serait transmis
et rectifier un problÃ¨me avant qu&#8217;il ne se produise&#160;â€“ vous n&#8217;avez pas envie
de mettre en ligne un fichier qui contient un mot de passe n&#8217;est-ce pas&#160;?</text:p>
<text:p text:style-name="Code">$ npm publish --dry-run</text:p><text:p text:style-name="Code">npm notice</text:p><text:p text:style-name="Code">npm notice ðŸ“¦<text:s text:c="2"/>nodebook.chapter-05@1.0.0</text:p><text:p text:style-name="Code">npm notice === Tarball Contents ===</text:p><text:p text:style-name="Code">npm notice 754B<text:s text:c="4"/>package.json</text:p><text:p text:style-name="Code">npm notice 59B<text:s text:c="5"/>.eslintrc.yaml</text:p><text:p text:style-name="Code">npm notice 59.3kB<text:s text:c="2"/>index.adoc</text:p><text:p text:style-name="Code">npm notice 133B<text:s text:c="4"/>examples/app.js</text:p><text:p text:style-name="Code">npm notice 115B<text:s text:c="4"/>examples/cow.js</text:p><text:p text:style-name="Code">npm notice 65B<text:s text:c="5"/>examples/hello.js</text:p><text:p text:style-name="Code">npm notice 138B<text:s text:c="4"/>examples/print-args.js</text:p><text:p text:style-name="Code">npm notice 223B<text:s text:c="4"/>examples/tests.js</text:p><text:p text:style-name="Code">npm notice 46.3kB<text:s text:c="2"/>images/module-content.png</text:p><text:p text:style-name="Code">npm notice 75.6kB<text:s text:c="2"/>images/npm-package-falchion.png</text:p><text:p text:style-name="Code">npm notice 219.5kB images/npm-package-mysql-libmysqlclient.png</text:p><text:p text:style-name="Code">npm notice 170.2kB images/npm-package-mysql2.png</text:p><text:p text:style-name="Code">npm notice 172.7kB images/npm-registry-search.png</text:p><text:p text:style-name="Code">npm notice === Tarball Details ===</text:p><text:p text:style-name="Code">npm notice name:<text:s text:c="10"/>nodebook.chapter-05</text:p><text:p text:style-name="Code">npm notice version:<text:s text:c="7"/>1.0.0</text:p><text:p text:style-name="Code">npm notice package size:<text:s text:c="2"/>656.8 kB</text:p><text:p text:style-name="Code">npm notice unpacked size: 745.1 kB</text:p><text:p text:style-name="Code">npm notice shasum:<text:s text:c="8"/>7f2887b8840124cf8d0c2fa72e8d61cd739</text:p><text:p text:style-name="Code">npm notice integrity:<text:s text:c="5"/>sha512-a6yvb8WO[...]yUeLy2jg/viXQ==</text:p><text:p text:style-name="Code">npm notice total files:<text:s text:c="3"/>13</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Configuration</text:span> EmpÃªcher un module d&#8217;Ãªtre publiÃ©</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
La section de configuration <text:span text:style-name="CodeDansTexte">private</text:span> est Ã  ajouter dans le fichier <text:span text:style-name="CodeDansTexte">package.json</text:span>
d&#8217;un module pour empÃªcher toute publication involontaire.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">package.json</text:p><text:p text:style-name="RemarqueCode">{</text:p><text:p text:style-name="RemarqueCode"><text:s text:c="2"/>"name": "...",</text:p><text:p text:style-name="RemarqueCode"><text:s text:c="2"/>"private": true</text:p><text:p text:style-name="RemarqueCode">}</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La publication d&#8217;un module implique que vous ayez configurÃ© les sections
<text:span text:style-name="CodeDansTexte">main</text:span> ou <text:span text:style-name="CodeDansTexte">bin</text:span> du fichier <text:span text:style-name="CodeDansTexte">package.json</text:span> pour respectivement indiquer
quel fichier charger avec <text:span text:style-name="CodeDansTexte">require('&lt;module&gt;')</text:span> ou exÃ©cuter avec <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-npx"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">npx &lt;module&gt;</text:span></text:a>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La publication d&#8217;un module nÃ©cessite de se crÃ©er un compte sur le registre
<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com</text:a></text:span>.
undefined
Si c&#8217;est la premiÃ¨re fois, l&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">npm</text:span> vous
demandera alors de vous identifier&#160;â€“ le module sera ensuite publiÃ© en votre nom.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">IdÃ©alement, je recommande de ne pas publier de module Ã  la main mais de
<text:span text:style-name="T7">prÃ©fÃ©rer l&#8217;utilisation d&#8217;un service d&#8217;intÃ©gration continue</text:span> comme
<text:span text:style-name="T4">Travis&#160;CI</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://travis-ci.com" text:visited-style-name="Visited_20_Internet_20_Link">https://travis-ci.com</text:a></text:span>).
La configuration d&#8217;un tel service permet de publier <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-version"  text:visited-style-name="Visited_20_Internet_20_Link">une nouvelle version</text:a>
seulement si les tests passent au&#160;vert.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Pratique</text:span> Ignorer des fichiers Ã  publier</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
L&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">npm</text:span> ignore par dÃ©faut les mÃªmes fichiers que Git.
Il honore la prÃ©sence des fichiers <text:span text:style-name="CodeDansTexte">.gitignore</text:span> et exclut les fichiers
et rÃ©pertoires concernÃ©s de la publication.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Le fichier <text:span text:style-name="CodeDansTexte">.npmignore</text:span> remplace <text:span text:style-name="CodeDansTexte">.gitignore</text:span> dans le cas
oÃ¹ votre besoin de fichiers Ã  versionner est diffÃ©rent de celui de fichiers
Ã  publier sur le registre&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">.npmignore</text:p><text:p text:style-name="RemarqueCode">.DS_Store<text:s text:c="7"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="RemarqueCode">node_modules<text:s text:c="4"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="RemarqueCode"></text:p><text:p text:style-name="RemarqueCode">src/*.html<text:s text:c="6"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="RemarqueCode">!src/index.html <text:span text:style-name="PuceCode">4</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Ignore un fichier nommÃ© <text:span text:style-name="CodeDansTexte">.DS_Store</text:span>&#160;â€“ courant sous macOS.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Ignore le rÃ©pertoire <text:span text:style-name="CodeDansTexte">node_modules</text:span> et tout ce qu&#8217;il contient.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Ignore tous les fichiers <text:span text:style-name="CodeDansTexte">.html</text:span> contenus dans le rÃ©pertoire&#160;<text:span text:style-name="CodeDansTexte">src</text:span>.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Ã€ l&#8217;exception du fichier <text:span text:style-name="CodeDansTexte">index.html</text:span> contenu dans le rÃ©pertoire&#160;<text:span text:style-name="CodeDansTexte">src</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-version" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">npm version : dÃ©terminer une nouvelle version sans se tromper</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous ne pouvons pas <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-publish"  text:visited-style-name="Visited_20_Internet_20_Link">publier</text:a> deux fois une mÃªme version d&#8217;un
module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>.
Nous devons donc a&#160;minima modifier la valeur de la section <text:span text:style-name="CodeDansTexte">version</text:span>
dans le fichier <text:span text:style-name="CodeDansTexte">package.json</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La commande <text:span text:style-name="CodeDansTexte">npm version</text:span> automatise le calcul du prochain numÃ©ro de version,
reflÃ¨te ce dernier dans le champ <text:span text:style-name="CodeDansTexte">version</text:span> du fichier <text:span text:style-name="CodeDansTexte">package.json</text:span>
et procÃ¨de Ã  un <text:span text:style-name="CodeDansTexte">commit</text:span> Git, Ã©tiquetÃ© avec cette nouvelle version.
Je trouve cette maniÃ¨re Ã©lÃ©gante, notamment en complÃ©ment de la
publication automatique par le biais d&#8217;un service d&#8217;intÃ©gration continue.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La commande <text:span text:style-name="CodeDansTexte">npm version</text:span> se complÃ¨te forcÃ©ment d&#8217;un argument pour
indiquer la <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-semver"  text:visited-style-name="Visited_20_Internet_20_Link">granularitÃ© de version sÃ©mantique</text:a> concernÃ©e.
Ainsi, si nous voulons mettre Ã  jour un module actuellement en version&#160;<text:span text:style-name="CodeDansTexte">1.0.0</text:span>&#160;:
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="CodeDansTexte">npm version patch</text:span> la changera en&#160;<text:span text:style-name="CodeDansTexte">1.0.1</text:span>.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="CodeDansTexte">npm version minor</text:span> la changera en&#160;<text:span text:style-name="CodeDansTexte">1.1.0</text:span>.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="CodeDansTexte">npm version major</text:span> la changera en&#160;<text:span text:style-name="CodeDansTexte">2.0.0</text:span>.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette montÃ©e en version se complÃ¨te optionnellement de <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-scripts"  text:visited-style-name="Visited_20_Internet_20_Link">scripts&#160;<text:span text:style-name="CodeDansTexte">npm</text:span></text:a>
pour automatiser d&#8217;autres actions lors d&#8217;une montÃ©e en version&#160;:
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">preversion</text:span></text:h>
<text:p text:style-name="Remarque">Le nouveau numÃ©ro de version n&#8217;a pas encore Ã©tÃ© appliquÃ©.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">version</text:span></text:h>
<text:p text:style-name="Remarque">Le nouveau numÃ©ro de version est appliquÃ©&#160;â€“ vous pouvez encore ajouter de nouveaux fichiers au <text:span text:style-name="CodeDansTexte">commit</text:span>&#160;Git.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">postversion</text:span></text:h>
<text:p text:style-name="Remarque">Le nouveau numÃ©ro de version est appliquÃ© et un <text:span text:style-name="CodeDansTexte">commit</text:span> a Ã©tÃ© ajoutÃ© Ã  l&#8217;historique&#160;Git.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">AvancÃ©</text:span> DÃ©terminer la version depuis&#160;Git</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
Peut-Ãªtre que vous gÃ©rez vous-mÃªme le numÃ©ro de version en l&#8217;attribuant
directement avec un <text:span text:style-name="CodeDansTexte">tag</text:span>&#160;Git&#160;(<text:span text:style-name="CodeDansTexte">git tag</text:span>).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Dans ce cas, la commande <text:span text:style-name="CodeDansTexte">npm version from-git</text:span> reporte le numÃ©ro de version
du dernier <text:span text:style-name="CodeDansTexte">tag</text:span>&#160;Git dans le fichier <text:span text:style-name="CodeDansTexte">package.json</text:span>.</text:p>
<text:bookmark text:name="ref-questions" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Questions et mystÃ¨res autour de&#160;npm</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">npm</text:span> et le registre du mÃªme nom ont accompagnÃ© Node quasiment
depuis le dÃ©but.
Il paraÃ®t simple de prime abord et je pense que c&#8217;est normal de se sentir
surprisÂ·e par ses rÃ©sultats.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Passons en revue des critiques ou questionnements que j&#8217;entends rÃ©guliÃ¨rement
afin d&#8217;y voir plus&#160;clair.</text:p>
<text:bookmark text:name="ref-npm.update" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Quand mettre Ã  jour l&#8217;exÃ©cutable&#160;npm ?</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">De nouvelles versions de l&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">npm</text:span> sont rÃ©guliÃ¨rement publiÃ©es.
Un message s&#8217;affiche dans notre terminal lorsque nous l&#8217;utilisons et qu&#8217;il
dÃ©tecte qu&#8217;une version plus rÃ©cente est disponible.</text:p>
<text:p text:style-name="Code">â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®</text:p><text:p text:style-name="Code">â”‚<text:s text:c="37"/>â”‚</text:p><text:p text:style-name="Code">â”‚<text:s text:c="3"/>Update available 6.0.0 â†’ 6.4.0<text:s text:c="2"/>â”‚</text:p><text:p text:style-name="Code">â”‚<text:s text:c="5"/>Run npm i -g npm to update<text:s text:c="6"/>â”‚</text:p><text:p text:style-name="Code">â”‚<text:s text:c="37"/>â”‚</text:p><text:p text:style-name="Code">â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le module qui contient l&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">npm</text:span> suit le principe des
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-semver"  text:visited-style-name="Visited_20_Internet_20_Link">versions sÃ©mantiques</text:a>.
Ainsi, la mise Ã  jour sera sans effort si le numÃ©ro majeur reste le mÃªme.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">J&#8217;ai tendance Ã  regarder du cÃ´tÃ© de <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://github.com/npm/npm/releases" text:visited-style-name="Visited_20_Internet_20_Link">https://github.com/npm/npm/releases</text:a></text:span>
pour lire tous les <text:span text:style-name="T4">Breaking Changes</text:span> et comprendre en quoi la mise Ã  jour
majeure m&#8217;affecte.</text:p>
<text:bookmark text:name="ref-package-lock" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Je ne vois pas l&#8217;intÃ©rÃªt du fichier package-lock.json</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le fichier <text:span text:style-name="CodeDansTexte">package-lock.json</text:span> est crÃ©Ã© automatiquement par l&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">npm</text:span>
dÃ¨s que vous ajoutez votre premiÃ¨re dÃ©pendance Ã  un projet.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Jetons un Å“il Ã  son contenu pour tenter d&#8217;en cerner les contours&#160;:</text:p>
<text:p text:style-name="Code">{</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"name": "nodebook.chapter-05",</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"version": "1.0.0",</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"lockfileVersion": 1,</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"requires": true,</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"dependencies": {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"acorn": {</text:p><text:p text:style-name="Code"><text:s text:c="6"/>"version": "5.6.1",</text:p><text:p text:style-name="Code"><text:s text:c="6"/>"resolved":</text:p><text:p text:style-name="Code"><text:s text:c="8"/>"https://registry.npmjs.org/acorn/-/acorn-5.6.1.tgz",</text:p><text:p text:style-name="Code"><text:s text:c="6"/>"integrity": "sha512-...",</text:p><text:p text:style-name="Code"><text:s text:c="6"/>"dev": true</text:p><text:p text:style-name="Code"><text:s text:c="4"/>},</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"cowsay": {</text:p><text:p text:style-name="Code"><text:s text:c="6"/>"version": "1.3.1",</text:p><text:p text:style-name="Code"><text:s text:c="6"/>"resolved":</text:p><text:p text:style-name="Code"><text:s text:c="8"/>"https://registry.npmjs.org/cowsay/-/cowsay-1.3.1.tgz",</text:p><text:p text:style-name="Code"><text:s text:c="6"/>"integrity": "sha512-...",</text:p><text:p text:style-name="Code"><text:s text:c="6"/>"requires": {</text:p><text:p text:style-name="Code"><text:s text:c="8"/>"get-stdin": "^5.0.1",</text:p><text:p text:style-name="Code"><text:s text:c="8"/>"optimist": "~0.6.1",</text:p><text:p text:style-name="Code"><text:s text:c="8"/>"string-width": "~2.1.1",</text:p><text:p text:style-name="Code"><text:s text:c="8"/>"strip-eof": "^1.0.0"</text:p><text:p text:style-name="Code"><text:s text:c="6"/>}</text:p><text:p text:style-name="Code"><text:s text:c="4"/>},</text:p><text:p text:style-name="Code"><text:s text:c="4"/>...</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">}</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il ressemble beaucoup au fichier <text:span text:style-name="CodeDansTexte">package.json</text:span>.
On notera qu&#8217;il contient exclusivement des donnÃ©es liÃ©es aux dÃ©pendances,
ainsi qu&#8217;Ã  <text:span text:style-name="T7">toutes les dÃ©pendances des dÃ©pendances</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Si le fichier <text:span text:style-name="CodeDansTexte">package.json</text:span> contient une <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-semver"  text:visited-style-name="Visited_20_Internet_20_Link">version sÃ©mantique</text:a>,
<text:span text:style-name="CodeDansTexte">package-lock.json</text:span> <text:span text:style-name="T7">contient la version exacte</text:span> de chaque dÃ©pendance ainsi
que deux autres types d&#8217;informations&#160;: l&#8217;URL de tÃ©lÃ©chargement et une signature
qui sert Ã  vÃ©rifier si le fichier tÃ©lÃ©chargÃ© est le bon (intÃ©gritÃ©).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La reprÃ©sentation complÃ¨te de l&#8217;arbre de dÃ©pendances dans le fichier <text:span text:style-name="CodeDansTexte">package-lock.json</text:span>
traduit deux intentions&#160;:
rendre l&#8217;installation des dÃ©pendances possibles en se basant uniquement sur
ce fichier et accÃ©lÃ©rer le processus d&#8217;installation.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7">Avantages</text:h><text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce">Le projet s&#8217;installe encore plus rapidement grÃ¢ce Ã  la commande <text:span text:style-name="CodeDansTexte">npm ci</text:span>.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="RemarquePuce">Nous pouvons reproduire la mÃªme installation sur plusieurs ordinateurs.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="RemarquePuce">La commande <text:span text:style-name="CodeDansTexte">npm install</text:span> installe plus rapidement en prÃ©sence d&#8217;un fichier <text:span text:style-name="CodeDansTexte">package-lock.json</text:span>.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7">InconvÃ©nients</text:h><text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce">Nous devons vÃ©rifier manuellement s&#8217;il y a des <text:span text:style-name="T4">patchs</text:span> avec <text:span text:style-name="CodeDansTexte">npm outdated</text:span> et <text:span text:style-name="CodeDansTexte">npm update</text:span>.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="RemarquePuce">C&#8217;est une chose de plus Ã  apprendre mÃªme si on n&#8217;a pas l&#8217;intention de l&#8217;utiliser.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-bower" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">npm c&#8217;est pour le back-end et bower pour le front-end</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">bower</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://bower.io" text:visited-style-name="Visited_20_Internet_20_Link">https://bower.io</text:a></text:span>) est un gestionnaire de modules
spÃ©cialisÃ© dans le dÃ©veloppement <text:span text:style-name="T4">front-end</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Je pense qu&#8217;il Ã©tait utile Ã  une Ã©poque oÃ¹ l&#8217;outillage <text:span text:style-name="T4">front-end</text:span> disponible
dans Node Ã©tait encore confidentiel.
Je pense aussi que cette Ã©poque est rÃ©volue, au sens oÃ¹ l&#8217;outillage dÃ©diÃ© Ã 
Node et aux navigateurs web tend Ã  se confondre.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">En apprenant ECMAScript, Node et <text:span text:style-name="CodeDansTexte">npm</text:span>, nous gagnons non seulement un outillage
disponible immÃ©diatement, mais aussi la capacitÃ© Ã  crÃ©er le nÃ´tre.
Pour en savoir plus sur comment dÃ©velopper pour le <text:span text:style-name="T4">front-end</text:span> comme on dÃ©veloppe
pour Node, je vous invite Ã  lire le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-09"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;9</text:a>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7">Avantages</text:h><text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce">On peut installer un projet sans qu&#8217;il possÃ¨de un fichier <text:span text:style-name="CodeDansTexte">package.json</text:span>.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="RemarquePuce">On n&#8217;a pas nÃ©cessairement besoin de s&#8217;outiller pour utiliser les modules&#160;Bower.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7">InconvÃ©nients</text:h><text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce">Si on utilise dÃ©jÃ  un fichier <text:span text:style-name="CodeDansTexte">package.json</text:span> pour d&#8217;autres besoins, autant l&#8217;utiliser pour les dÃ©pendances <text:span text:style-name="T4">front-end</text:span>&#160;; donc autant utiliser&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="RemarquePuce">Le dÃ©veloppement de&#160;Bower stagne depuis 2015 et je pense que le projet sera arrÃªtÃ© tÃ´t ou&#160;tard.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-est_ce_que_je_dois_versionner_le_rÃ©pertoire_node_modules" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Est-ce que je dois versionner le rÃ©pertoire node_modules ?</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le contenu du rÃ©pertoire <text:span text:style-name="CodeDansTexte">node_modules</text:span> se recrÃ©e automatiquement
en utilisant l&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">npm</text:span>, que ce soit avec <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-install"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">npm install</text:span></text:a> ou
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-update"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">npm update</text:span></text:a>.
Mieux vaut versionner les fichiers <text:span text:style-name="CodeDansTexte">package.json</text:span> et
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-package-lock"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">package-lock.json</text:span></text:a> pour Ãªtre certainÂ·e
de les recrÃ©er comme il&#160;faut.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le rÃ©pertoire <text:span text:style-name="CodeDansTexte">node_modules</text:span> n&#8217;a donc pas besoin d&#8217;Ãªtre versionnÃ©.
Je vous encourage Ã  <text:span text:style-name="T7">ajouter <text:span text:style-name="CodeDansTexte">node_modules</text:span> dans le fichier <text:span text:style-name="CodeDansTexte">.gitignore</text:span></text:span>.
Ce fichier texte se situe en gÃ©nÃ©ral Ã  la racine de votre projet.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7">Avantages</text:h><text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce">Je n&#8217;en vois pas.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7">InconvÃ©nients</text:h><text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce">C&#8217;est difficile Ã  versionner avec Git en cas de conflit.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="RemarquePuce">Ã‡a va exploser si deux personnes utilisent des systÃ¨mes d&#8217;exploitation diffÃ©rents&#160;â€“ certaines dÃ©pendances gÃ©nÃ¨rent des fichiers en fonction du systÃ¨me.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="RemarquePuce">Ã‡a va exploser s&#8217;il manque un module quelque part&#160;â€“ et ce sera plus un problÃ¨me Ã  rÃ©gler que de <text:span text:style-name="T4">ne pas</text:span> versionner ce rÃ©pertoire.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-yarn" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Il paraÃ®t que Yarn, c&#8217;est mieux</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;application <text:span text:style-name="T4">Yarn</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://yarnpkg.com" text:visited-style-name="Visited_20_Internet_20_Link">https://yarnpkg.com</text:a></text:span>) veut Ãªtre une alternative
Ã  l&#8217;exÃ©cutable&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>.
Le programme vise une installation rapide, hors-ligne et sÃ©curisÃ©e.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">npm rattrape rÃ©guliÃ¨rement les fonctionnalitÃ©s qui <text:span text:style-name="">donnent de l&#8217;avance</text:span> Ã  <text:span text:style-name="T4">Yarn</text:span>.
Le choix tient donc plutÃ´t du goÃ»t ou de l&#8217;idÃ©ologie.
Essayez donc <text:span text:style-name="T4">Yarn</text:span> et gardez-le pour les bonnes raisons&#160;â€“ les vÃ´tres.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7">Avantages</text:h><text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce">Le mode <text:span text:style-name="T4">workspace</text:span> permet de lier plusieurs projets entre eux de maniÃ¨re dÃ©clarative.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7">InconvÃ©nients</text:h><text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce">Il faudra quand mÃªme savoir comment fonctionne npm pour les projets qui n&#8217;utilisent pas&#160;<text:span text:style-name="T4">Yarn</text:span>.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-all-your-base-are-belong-to-us" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">npm&#160;est lent, il installe la moitiÃ© d&#8217;Internet Ã  chaque&#160;fois</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">npm</text:span> passe le plus clair de son temps Ã  faire des allers-retours
vers le registre&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> en utilisant votre connexion Internet.
Il tÃ©lÃ©chargera un module seulement s&#8217;il ne l&#8217;a pas dÃ©jÃ  tÃ©lÃ©chargÃ© sur un autre projet.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;Ã©quipe de dÃ©veloppement de l&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">npm</text:span> travaille Ã  amÃ©liorer
ses performances et sa qualitÃ© d&#8217;utilisation.
Cette Ã©quipe n&#8217;a pas d&#8217;influence sur les choix faits par les personnes en charge
des modules.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le temps de tÃ©lÃ©chargement d&#8217;un module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> dÃ©pend de deux choses&#160;:
du <text:span text:style-name="T7">nombre de dÃ©pendances</text:span> Ã  installer et de leur <text:span text:style-name="T7">poids</text:span>, lequel correspond Ã 
la somme des poids des scripts et des ressources additionnelles (images, documentation).
Dans les deux cas, <text:span text:style-name="T7">plus il y en&#160;a, plus l&#8217;installation prendra du temps</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Par exemple, le seul ajout de <text:span text:style-name="T4">webpack&#160;4</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/webpack" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/webpack</text:a></text:span>)
augmente le coÃ»t de tÃ©lÃ©chargement de 14&#160;Mo lors de <text:span text:style-name="CodeDansTexte">npm install</text:span>.
Ce n&#8217;est pas rien et ce n&#8217;est certainement pas la faute de l&#8217;exÃ©cutable&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le service en ligne <text:span text:style-name="T4">Package Phobia</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://packagephobia.now.sh" text:visited-style-name="Visited_20_Internet_20_Link">https://packagephobia.now.sh</text:a></text:span>)
garde un historique du poids des modules <text:span text:style-name="CodeDansTexte">npm</text:span>.
Celui de <text:span text:style-name="T4">webpack</text:span> se trouve sur
<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://packagephobia.now.sh/result?p=webpack" text:visited-style-name="Visited_20_Internet_20_Link">https://packagephobia.now.sh/result?p=webpack</text:a></text:span>.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-05/images/module-content.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>5-undefined.</text:span> CoÃ»t d&#8217;installation du module&#160;npm&#160;webpack (en foncÃ©) et de ses dÃ©pendances (en clair)</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Pratique</text:span> ConnaÃ®tre le coÃ»t des dÃ©pendances de son projet</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
undefined
Le module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> <text:span text:style-name="T4">cost-of-modules</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/cost-of-modules" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/cost-of-modules</text:a></text:span>)
calcule la quantitÃ© et le poids des dÃ©pendances listÃ©es
dans un fichier <text:span text:style-name="CodeDansTexte">package.json</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">C&#8217;est pratique pour identifier quel module remplacer par un autre, plus lÃ©ger et
plus rapide Ã  installer.</text:p>
<text:p text:style-name="RemarqueCode">$ npx cost-of-modules<text:s text:c="15"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="RemarqueCode">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”</text:p><text:p text:style-name="RemarqueCode">â”‚ name<text:s text:c="6"/>â”‚ children<text:s text:c="4"/>â”‚ size<text:s text:c="2"/>â”‚</text:p><text:p text:style-name="RemarqueCode">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤</text:p><text:p text:style-name="RemarqueCode">â”‚ lodash<text:s text:c="4"/>â”‚ 0<text:s text:c="11"/>â”‚ 1.34M â”‚</text:p><text:p text:style-name="RemarqueCode">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤</text:p><text:p text:style-name="RemarqueCode">â”‚ micro<text:s text:c="5"/>â”‚ 19<text:s text:c="10"/>â”‚ 0.67M â”‚</text:p><text:p text:style-name="RemarqueCode">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤</text:p><text:p text:style-name="RemarqueCode">â”‚ cowsay<text:s text:c="4"/>â”‚ 9<text:s text:c="11"/>â”‚ 0.22M â”‚</text:p><text:p text:style-name="RemarqueCode">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤</text:p><text:p text:style-name="RemarqueCode">â”‚ 3 modules â”‚ 28 children â”‚ 2.22M â”‚</text:p><text:p text:style-name="RemarqueCode">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> La <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-npx"  text:visited-style-name="Visited_20_Internet_20_Link">commande <text:span text:style-name="CodeDansTexte">npx</text:span></text:a> est un raccourci pour exÃ©cuter des modules <text:span text:style-name="CodeDansTexte">npm</text:span> sans les installer.<text:line-break/></text:p>
<text:bookmark text:name="ref-errors" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Que signifient les erreurs affichÃ©es pendant npm install ?</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">npm</text:span> est gÃ©nÃ©reux en messages pendant l&#8217;installation
de modules.
C&#8217;est parfois difficile Ã  lire, notamment pour comprendre la raison du message
et la solution Ã  apporter.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Si <text:span text:style-name="CodeDansTexte">npm WARN</text:span> s&#8217;affiche, ce n&#8217;est pas une erreur mais un message
Ã  caractÃ¨re informatif.<text:line-break/>Si <text:span text:style-name="CodeDansTexte">npm ERR</text:span> dÃ©bute la ligne, il y a un problÃ¨me sur lequel nous
avons une action immÃ©diate Ã  mener.</text:p>
<text:bookmark text:name="ref-error-deprecated" /><text:h text:style-name="TitreNiveau3" text:outline-level="4">Module dÃ©prÃ©ciÃ©</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un module est dÃ©prÃ©ciÃ© quand il n&#8217;est plus maintenu,
s&#8217;il est dÃ©veloppÃ© sous un nouveau nom ou si nous sommes encouragÃ©Â·eÂ·s Ã 
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-install.version"  text:visited-style-name="Visited_20_Internet_20_Link">faire une mise Ã  jour majeure</text:a>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un module dÃ©prÃ©ciÃ© ne nous regarde pas sauf s&#8217;il est listÃ© dans le champ
<text:span text:style-name="CodeDansTexte">dependencies</text:span> ou <text:span text:style-name="CodeDansTexte">devDependencies</text:span> d&#8217;un fichier <text:span text:style-name="CodeDansTexte">package.json</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">Exemple d&#8217;encouragements Ã  utiliser un autre module</text:p><text:p text:style-name="Code">npm WARN deprecated babel-preset-es2017@6.24.1:</text:p><text:p text:style-name="Code"><text:s text:c="2"/>Thanks for using Babel: <text:span text:style-name="CodeExergue">we recommend using babel-preset-env</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>now: please read babeljs.io/env to update!</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">npm WARN deprecated babel-preset-babili@0.0.10: babili has</text:p><text:p text:style-name="Code"><text:s text:c="2"/>been <text:span text:style-name="CodeExergue">renamed to babel-minify</text:span>.</text:p><text:p text:style-name="Code"><text:s text:c="2"/>Please update to babel-preset-minify</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">Exemple de module qui n&#8217;est plus maintenu</text:p><text:p text:style-name="Code">npm WARN deprecated nomnom@1.6.2: <text:span text:style-name="CodeExergue">Package no longer supported</text:span>.</text:p><text:p text:style-name="Code"><text:s text:c="2"/>Contact support@npmjs.com for more info.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un module qui n&#8217;est plus maintenu ne recevra probablement plus de mises Ã  jour.
Il vaut mieux dans ce cas en trouver un autre qui fait plus ou moins la mÃªme chose.</text:p>
<text:bookmark text:name="ref-error-skipping" /><text:h text:style-name="TitreNiveau3" text:outline-level="4">ProblÃ¨me avec une dÃ©pendance optionnelle</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Certains modules effectuent une opÃ©ration de compilation&#160;: une partie de leur
code source est Ã©crit dans un autre langage que l&#8217;ECMAScript et ils
font en sorte de crÃ©er un pont avec&#160;Node.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il arrive que l&#8217;opÃ©ration de compilation n&#8217;aboutisse pas pour diverses raisons
â€“ logiciel manquant, incompatibilitÃ© avec le systÃ¨me d&#8217;exploitation
ou avec l&#8217;architecture CPU.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le fait de voir Ã©crit <text:span text:style-name="CodeDansTexte">SKIPPING</text:span> et <text:span text:style-name="CodeDansTexte">OPTIONAL</text:span> me laisse penser
que ce n&#8217;est pas grave si l&#8217;opÃ©ration ne se passe pas comme prÃ©vu.</text:p>
<text:p text:style-name="Code">npm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@1.1.3</text:p><text:p text:style-name="Code">npm WARN notsup SKIPPING OPTIONAL DEPENDENCY:</text:p><text:p text:style-name="Code"><text:s text:c="2"/>Unsupported platform for fsevents@1.1.3:</text:p><text:p text:style-name="Code"><text:s text:c="2"/>wanted {"os":"darwin","arch":"any"}</text:p><text:p text:style-name="Code"><text:s text:c="2"/>(current: {"os":"win32","arch":"x64"})</text:p>
<text:bookmark text:name="ref-error-404" /><text:h text:style-name="TitreNiveau3" text:outline-level="4">Module introuvable</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le module que vous cherchez Ã  installer n&#8217;existe pas.
Il s&#8217;agit peut-Ãªtre d&#8217;une erreur de frappe ou alors le module a Ã©tÃ© retirÃ©
de la circulation.</text:p>
<text:p text:style-name="Code">$ npm i aria-roless</text:p><text:p text:style-name="Code">npm ERR! code E404</text:p><text:p text:style-name="Code">npm ERR! 404 Not Found: aria-roless@latest</text:p>
<text:bookmark text:name="ref-error-crlf" /><text:h text:style-name="TitreNiveau3" text:outline-level="4">CaractÃ¨re de fin de ligne sous Windows</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les anciennes versions de&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> avaient du mal Ã  concilier les caractÃ¨res de fin
de ligne sous Windows (<text:span text:style-name="CodeDansTexte">\r\n</text:span>), diffÃ©rents des autres systÃ¨mes (<text:span text:style-name="CodeDansTexte">\n</text:span>).</text:p>
<text:p text:style-name="Code">npm error Expected linebreaks to be 'LF' but</text:p><text:p text:style-name="Code"><text:s text:c="2"/>found 'CRLF' linebreak-style</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-npm.update"  text:visited-style-name="Visited_20_Internet_20_Link">Mettez&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> Ã  jour</text:a> vers une version plus rÃ©cente pour
rÃ©gler le problÃ¨me.</text:p>
<text:bookmark text:name="ref-error-pkg" /><text:h text:style-name="TitreNiveau3" text:outline-level="4">Fichier package.json incomplet</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les messages suivants s&#8217;affichent quand les champs <text:span text:style-name="CodeDansTexte">description</text:span> et
<text:span text:style-name="CodeDansTexte">repository</text:span> manquent Ã  l&#8217;appel de notre fichier <text:span text:style-name="CodeDansTexte">package.json</text:span>.</text:p>
<text:p text:style-name="Code">npm WARN tmp@1.0.0 No description</text:p><text:p text:style-name="Code">npm WARN tmp@1.0.0 No repository field.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">RÃ©fÃ©rez-vous Ã  la section <text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-package.json"  text:visited-style-name="Visited_20_Internet_20_Link">Anatomie du fichier <text:span text:style-name="CodeDansTexte">package.json</text:span></text:a></text:span>
pour savoir comment remplir ces champs manquants.</text:p>
<text:bookmark text:name="ref-error-peer-dependency" /><text:h text:style-name="TitreNiveau3" text:outline-level="4">DÃ©pendance complÃ©mentaire Ã  installer</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Certains modules nÃ©cessitent des modules complÃ©mentaires pour fonctionner.
Toutefois ces derniers sont Ã  installer manuellement.
C&#8217;est la signification du message d&#8217;erreur suivant&#160;:</text:p>
<text:p text:style-name="Code">npm WARN <text:span text:style-name="CodeExergue">react-power-picture</text:span>@1.0.0 <text:span text:style-name="CodeExergue">requires</text:span> a peer of</text:p><text:p text:style-name="Code"><text:s text:c="2"/><text:span text:style-name="CodeExergue">react</text:span>@^15.0.0-0 || ^16.0.0-0 but none is installed.</text:p><text:p text:style-name="Code"><text:s text:c="2"/>You must install peer dependencies yourself.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cet exemple indique que nous avons installÃ© le module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>
<text:span text:style-name="T4">react-power-picture</text:span> et que le module complÃ©mentaire <text:span text:style-name="T4">react</text:span>
est nÃ©cessaire mais que nous ne l&#8217;avons pas installÃ©.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Si vous pensez que c&#8217;est une erreur ou une incomprÃ©hension, dÃ©sinstallez
le module et cherchez une alternative.
Cela se produit gÃ©nÃ©ralement quand on ne s&#8217;aperÃ§oit pas qu&#8217;un module est dÃ©diÃ©
Ã  un certain framework&#160;â€“ qu&#8217;on ne veut pas utiliser.</text:p>
<text:bookmark text:name="ref-conclusion_5" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Conclusion</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">npm</text:span> est un outil qui va bien au-delÃ  de la simple installation
de modules&#160;: il va jusqu&#8217;Ã  <text:span text:style-name="T7">crÃ©er un outillage autonome</text:span> pour chacun de nos projets.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous avons appris Ã  <text:span text:style-name="T7">jongler entre les diffÃ©rentes versions d&#8217;un module</text:span>
pour comprendre la notion de <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-semver"  text:visited-style-name="Visited_20_Internet_20_Link">version sÃ©mantique</text:a> et son effet
sur les commandes d&#8217;installation et de mise Ã &#160;jour.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous avons vu que les <text:span text:style-name="T7">scripts&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> reprÃ©sentent un outillage Ã  portÃ©e de main</text:span>.
Ils nous facilitent la vie en plus d&#8217;Ãªtre partagÃ©s avec
les personnes impliquÃ©es dans un mÃªme projet.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Avec le langage ECMAScript (<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-03"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;3</text:a>),
l&#8217;environnement Node (<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-04"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;4</text:a>)
et maintenant&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>, nous avons des fondations solides pour
dÃ©ployer du code (<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-06"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;6</text:a>) et crÃ©er toutes
sortes d&#8217;applications ECMAScript.</text:p>
<text:bookmark text:name="ref-chapter-06" /><text:p text:style-name="ChapitreNumero">6</text:p><text:h text:style-name="ChapitreTitre" text:outline-level="1">DÃ©ployer notre&#160;code</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">En dÃ©ployant une application Node, nous amÃ©liorerons la
qualitÃ© de notre code en gommant les derniers bogues et en automatisant
la dÃ©tection des erreurs et des failles de sÃ©curitÃ©.</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">DÃ©ployer une application Node</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Choisir son hÃ©bergement</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">AmÃ©liorer la portabilitÃ©</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">DÃ©marrer automatiquement nos applications</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Ã€ quoi penser aprÃ¨s la mise en ligne&#160;?</text:p>
</text:list-item></text:list>
<text:p text:style-name="ChapitreIntroduction"><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce chapitre nous permettra d&#8217;y voir plus clair du cÃ´tÃ© de l&#8217;hÃ©bergement
et de la mise en ligne d&#8217;une application Node.
Nous pourrons choisir ce qui nous paraÃ®t le plus abordable,
que Ã§a soit en termes d&#8217;argent ou de complexitÃ© d&#8217;utilisation.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous mettrons en Å“uvre les
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process.env"  text:visited-style-name="Visited_20_Internet_20_Link">variables d&#8217;environnement</text:a>
du chapitre 4 pour que nos applications en ligne
fonctionnent de la mÃªme maniÃ¨re que sur notre ordinateur.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Enfin, nous verrons diffÃ©rents types de service pour Ãªtre tenuÂ·e informÃ©Â·e
des erreurs applicatives et des failles de sÃ©curitÃ©, sans effort.</text:p></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Remarque</text:span> Versions de Node et npm</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Le contenu de ce chapitre utilise les versions <text:span text:style-name="T7">Node&#160;v10</text:span>
et <text:span text:style-name="T7">npm&#160;v6</text:span>.
Ce sont les versions stables recommandÃ©es en&#160;2019.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Pratique</text:span> Jouer avec les exemples dans un terminal</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Les exemples titrÃ©s d&#8217;un nom de fichier peuvent Ãªtre installÃ©s sur votre ordinateur.
ExÃ©cutez-les dans un terminal et amusez-vous Ã  les modifier en parallÃ¨le de
votre lecture pour voir ce qui change.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Installation des exemples via le module npm <text:span text:style-name="CodeDansTexte">nodebook</text:span></text:p><text:p text:style-name="RemarqueCode">$ npm install --global nodebook</text:p><text:p text:style-name="RemarqueCode">$ nodebook install chapter-06</text:p><text:p text:style-name="RemarqueCode">$ cd $(nodebook dir chapter-06)</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">La commande suivante devrait afficher un rÃ©sultat qui confirme que vous Ãªtes
au bon endroit&#160;:</text:p>
<text:p text:style-name="RemarqueCode">$ node hello.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Suivez Ã  nouveau les instructions d&#8217;installation pour rÃ©tablir les exemples
dans leur Ã©tat initial.</text:p>
<text:bookmark text:name="ref-deploy" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">DÃ©ployer une application&#160;Node</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le choix de la technique de dÃ©ploiement dÃ©pend de plusieurs facteurs qui
renvoient Ã  eux-mÃªmes&#160;: l&#8217;hÃ©bergement peut dÃ©pendre du dÃ©ploiement et vice-versa.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Je vous propose de partir balayer les diffÃ©rentes techniques de dÃ©ploiement
avec des exemples et de voir quelles seraient les raisons d&#8217;opter pour l&#8217;une
ou l&#8217;autre d&#8217;entre&#160;elles.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le choix est subjectif et vous appartient, en fonction de votre aisance
Ã  vous en emparer.
C&#8217;est un sujet qui prend du temps avant d&#8217;Ãªtre maÃ®trisÃ©, donc n&#8217;hÃ©sitez pas
Ã  vous y reprendre Ã  plusieurs&#160;fois.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TableauTitre">Tableau 10. Quelles techniques de dÃ©ploiement utiliser avec quel type d&#8217;hÃ©bergement ?</text:p><table:table table:style-name="Tableau1"><table:table-column />,<table:table-column />,<table:table-column />,<table:table-column />,<table:table-column /><table:table-row><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p></text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-hosting.paas"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="T4">PaaS</text:span></text:a></text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-hosting.shared"  text:visited-style-name="Visited_20_Internet_20_Link">MutualisÃ©</text:a></text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-hosting.cloud"  text:visited-style-name="Visited_20_Internet_20_Link">Cloud</text:a></text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-hosting.lambda"  text:visited-style-name="Visited_20_Internet_20_Link">Lambda</text:a></text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy.notebook"  text:visited-style-name="Visited_20_Internet_20_Link">Notebook&#160;web</text:a></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2718;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2718;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2718;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2718;</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy.sftp"  text:visited-style-name="Visited_20_Internet_20_Link">SSH/SFTP</text:a></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2718;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2714;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2248;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2718;</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy.github"  text:visited-style-name="Visited_20_Internet_20_Link">Import GitHub</text:a></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2714;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2718;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2718;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2718;</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy.cli"  text:visited-style-name="Visited_20_Internet_20_Link">CLI</text:a></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2714;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2718;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2714;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2714;</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy.git"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">git push</text:span></text:a></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2714;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2718;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2714;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2718;</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy.clone"  text:visited-style-name="Visited_20_Internet_20_Link">SSH +&#160;<text:span text:style-name="CodeDansTexte">git pull</text:span></text:a></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2714;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2714;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2714;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2718;</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy.recipe"  text:visited-style-name="Visited_20_Internet_20_Link">Recette</text:a></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2714;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2714;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2714;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2714;</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy.docker"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">docker push</text:span></text:a></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2714;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2718;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2714;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2718;</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy.ci"  text:visited-style-name="Visited_20_Internet_20_Link">IntÃ©gration continue</text:a></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2714;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2714;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2714;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2714;</text:p></table:table-cell></table:table-row></table:table>
<text:bookmark text:name="ref-deploy.notebook" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">En codant dans un navigateur&#160;web</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le moyen le plus rapide d&#8217;exÃ©cuter un programme Node sans avoir Ã  se prÃ©occuper
du dÃ©ploiement est d&#8217;utiliser un service en ligne et de modifier le code
avec un navigateur&#160;web.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Je recommande <text:span text:style-name="T4">RunKit</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://runkit.com" text:visited-style-name="Visited_20_Internet_20_Link">https://runkit.com</text:a></text:span>) pour crÃ©er rapidement
du code qui tient dans un seul fichier, sans installer Node sur sa machine.
Le code est exÃ©cutÃ© sur les serveurs de RunKit, le rÃ©sultat s&#8217;affiche chez nous.
Les <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-modules"  text:visited-style-name="Visited_20_Internet_20_Link">modules <text:span text:style-name="CodeDansTexte">npm</text:span></text:a>
(<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-05"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;5</text:a>) sont installÃ©s automatiquement dans
leur version la plus rÃ©cente.
undefined</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-06/images/runkit-notebook.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>6-undefined.</text:span> Exemple de notebook RunKit dans le navigateur Firefox</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">RunKit propose aussi un modÃ¨le de <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-lambda"  text:visited-style-name="Visited_20_Internet_20_Link">fonction Ã©phÃ©mÃ¨re</text:a> dont le
rÃ©sultat devient accessible depuis une URL dÃ©diÃ©e.
undefined
Essayez de copier/coller le code suivant dans un nouveau notebook en vous
rendant sur <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://runkit.com/new" text:visited-style-name="Visited_20_Internet_20_Link">https://runkit.com/new</text:a></text:span>&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">runkit-endpoint.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const pokemon = require('pokemon-random-name'); <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">exports.endpoint = (request, response) =&gt; {<text:s text:c="5"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.end(pokemon());</text:p><text:p text:style-name="Code">};</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Le module npm <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/pokemon-random-name" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/pokemon-random-name</text:a></text:span> exporte une fonction qui retourne un nom alÃ©atoire de PokÃ©mon.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> <text:span text:style-name="CodeDansTexte">exports.endpoint</text:span> est spÃ©cifique Ã  RunKit et accepte une fonction identique Ã  l&#8217;Ã©vÃ©nement <text:span text:style-name="CodeDansTexte">server.on('request')</text:span> du <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-http"  text:visited-style-name="Visited_20_Internet_20_Link">module <text:span text:style-name="CodeDansTexte">http</text:span></text:a> (<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-04"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;4</text:a>).<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Une fois sauvegardÃ© puis cliquÃ© sur le lien <text:span text:style-name="Menu">endpoint</text:span>,
un nouvel onglet s&#8217;ouvre et affiche un nom alÃ©atoire de PokÃ©mon.
C&#8217;est la valeur de retour passÃ©e Ã  la rÃ©ponse, comme on l&#8217;aurait fait
avec le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-http"  text:visited-style-name="Visited_20_Internet_20_Link">module&#160;<text:span text:style-name="CodeDansTexte">http</text:span></text:a> ou dans une
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-07"  text:visited-style-name="Visited_20_Internet_20_Link">application web</text:a> (<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-07"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;7</text:a>).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le service en ligne <text:span text:style-name="T4">Glitch</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://glitch.com" text:visited-style-name="Visited_20_Internet_20_Link">https://glitch.com</text:a></text:span>) va plus loin
en dÃ©veloppant, hÃ©bergeant et partageant des applications complÃ¨tes.
undefined
undefined
Le service redÃ©ploie notre application Ã  chaque changement.
Le fichier <text:span text:style-name="CodeDansTexte">.env</text:span> stocke les
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process.env"  text:visited-style-name="Visited_20_Internet_20_Link">variables d&#8217;environnement</text:a> de maniÃ¨re
sÃ©curisÃ©e&#160;â€“ personne d&#8217;autre que nous n&#8217;y a accÃ¨s.
undefined
undefined</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-06/images/glitch-app.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>6-undefined.</text:span> Exemple d&#8217;application Node sur glitch.com</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Pratique</text:span> Console&#160;web</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
Glitch nous offre mÃªme une console web&#160;: un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-../chapter-04/index.adoc"  text:visited-style-name="Visited_20_Internet_20_Link">terminal</text:a>
entiÃ¨rement fonctionnel, depuis un navigateur&#160;!</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">C&#8217;est parfait pour <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-08"  text:visited-style-name="Visited_20_Internet_20_Link">coder un outil en ligne de commande</text:a>
(<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-08"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;8</text:a>) en travaillant depuis plusieurs
ordinateurs sans avoir Ã  tout rÃ©installer Ã  chaque&#160;fois.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Pratique</text:span> Remixez les exemples de cet ouvrage</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Vous pouvez crÃ©er votre premier projet sur Glitch.
Remixez cet ouvrage en vous rendant sur
<text:span text:style-name="URL">https://glitch.com/edit/#!/remix/nodebook</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Le contenu et les exemples seront copiÃ©s dans un nouveau projet,
exÃ©cutable et modifiable selon vos envies.</text:p>
<text:bookmark text:name="ref-deploy.sftp" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">En transfÃ©rant des fichiers via&#160;SSH</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">TransfÃ©rer des fichiers est idÃ©al pour dÃ©buter et lorsqu&#8217;on n&#8217;utilise pas Git
pour versionner son&#160;code.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les services d&#8217;hÃ©bergement mutualisÃ©, virtualisÃ© ou dÃ©diÃ© accordent
un accÃ¨s Ã  votre espace en ligne par le biais de
SSH (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://fr.wikipedia.org/wiki/Secure_Shell" text:visited-style-name="Visited_20_Internet_20_Link">https://fr.wikipedia.org/wiki/Secure_Shell</text:a></text:span>).
Ce protocole crÃ©e une connexion sÃ©curisÃ©e&#160;: les commandes saisies dans votre
terminal font effet sur la machine sur laquelle vous Ãªtes connectÃ©Â·e.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Des logiciels comme <text:span text:style-name="T4">FileZilla Client</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://filezilla-project.org/" text:visited-style-name="Visited_20_Internet_20_Link">https://filezilla-project.org/</text:a></text:span>)
servent d&#8217;interfaces graphiques pour transfÃ©rer des fichiers vers une machine distante.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les codes d&#8217;accÃ¨s SSH se trouvent en gÃ©nÃ©ral dans la section <text:span text:style-name="Menu">Aide</text:span>
ou <text:span text:style-name="Menu">Guides</text:span> de votre hÃ©bergeur.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-06/images/filezilla-file-transfer.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>6-undefined.</text:span> Exemple de connexion Ã  un serveur SSH distant avec FileZilla Client sous macOS</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Windows</text:span> WinSCP</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque"><text:span text:style-name="T4">WinSCP</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://winscp.net" text:visited-style-name="Visited_20_Internet_20_Link">https://winscp.net</text:a></text:span>) est une alternative libre Ã 
FileZilla pour Windows.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">AvancÃ©</text:span> scp et rsync</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
undefined
Notre terminal peut aussi servir Ã  transfÃ©rer des fichiers.
Deux programmes se basent sur SSH et sont installÃ©s par dÃ©faut sur la plupart
des ordinateurs Linux et macOS&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="CodeDansTexte">scp</text:span> pour envoyer des fichiers de machine Ã  machine&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="CodeDansTexte">rsync</text:span> pour n&#8217;envoyer que les fichiers qui ont Ã©tÃ© modifiÃ©s ou supprimÃ©s.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-deploy.github" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">En important du code depuis GitHub</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Importer du code depuis GitHub est la maniÃ¨re la plus simple de transfÃ©rer
tous les fichiers versionnÃ©s sans Ãªtre familier avec&#160;Git.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La plate-forme de <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy.notebook"  text:visited-style-name="Visited_20_Internet_20_Link">programmation en ligne</text:a> Glitch
offre une option pour importer n&#8217;importe quel projet GitHub&#160;â€“ Ã  partir du moment
oÃ¹ le dÃ©pÃ´t est public.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-06/images/glitch-github-import.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>6-undefined.</text:span> Bouton d&#8217;import d&#8217;un dÃ©pÃ´t GitHub sur glitch.com</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un clic sur le bouton <text:span text:style-name="CodeDansTexte">Import from GitHub</text:span> ouvre une invite de saisie
destinÃ©e Ã  mentionner le nom du dÃ©pÃ´t GitHub concernÃ©.
Le projet en cours sera entiÃ¨rement remplacÃ© par le contenu du dÃ©pÃ´t distant.
C&#8217;est pratique pour rÃ©cupÃ©rer des exercices ou pour apprendre en travaillant
sur du code Ã©crit par quelqu&#8217;un d&#8217;autre.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Pratique</text:span> Importer les exemples de cet ouvrage</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">RÃ©cupÃ©rez tout le contenu et les exemples de cet ouvrage
en recopiant <text:span text:style-name="CodeDansTexte">oncletom/nodebook</text:span> dans l&#8217;invite de saisie.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-paas"  text:visited-style-name="Visited_20_Internet_20_Link">plate-forme de services</text:a> <text:span text:style-name="T4">Heroku</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://heroku.com" text:visited-style-name="Visited_20_Internet_20_Link">https://heroku.com</text:a></text:span>)
pousse l&#8217;import GitHub un peu plus loin.
undefined
undefined
Sa fonctionnalitÃ© dÃ©ploie l&#8217;application Ã  chaque nouveau commit.
L&#8217;application redÃ©marre ensuite automatiquement pour prendre les changements en compte.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-06/images/heroku-github-import.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>6-undefined.</text:span> ParamÃ©trage de dÃ©ploiement automatisÃ© depuis un dÃ©pÃ´t GitHub sur heroku.com</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Une option nous permet de dÃ©ployer une nouvelle version de l&#8217;application
Ã  la suite d&#8217;une <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy.ci"  text:visited-style-name="Visited_20_Internet_20_Link">intÃ©gration continue rÃ©ussie</text:a>.
Nous rÃ©duisons ainsi les risques de dÃ©ployer une version dÃ©fectueuse.</text:p>
<text:bookmark text:name="ref-deploy.cli" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Avec l&#8217;outil en ligne de commande de l&#8217;hÃ©bergeur</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;outil en ligne de commande d&#8217;un hÃ©bergeur permet de gÃ©rer les dÃ©ploiements
et d&#8217;autres aspects de l&#8217;hÃ©bergement en mÃªme temps.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-paas"  text:visited-style-name="Visited_20_Internet_20_Link">plate-forme de services</text:a> <text:span text:style-name="T4">now</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://zeit.co/now" text:visited-style-name="Visited_20_Internet_20_Link">https://zeit.co/now</text:a></text:span>)
est un exemple de simplicitÃ© Ã  ce niveau.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">Installation et configuration de l&#8217;outil&#160;now</text:p><text:p text:style-name="Code">$ npm install -g now</text:p><text:p text:style-name="Code">$ now login</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans un terminal, dÃ©placez-vous vers le rÃ©pertoire de l&#8217;application Ã  dÃ©ployer.
Il suffit de taper&#160;<text:span text:style-name="CodeDansTexte">now</text:span> pour transfÃ©rer les fichiers.
Les dÃ©pendances s&#8217;installent et le dÃ©ploiement est accessible quelques secondes
plus tard&#160;:</text:p>
<text:p text:style-name="Code">$ now</text:p><text:p text:style-name="Code">Deploying ~/workspace/dtc-innovation/food-coops-dashboards</text:p><text:p text:style-name="Code">&gt; Using Node.js 9.10.1 (requested: `&gt;=8.0.0`)</text:p><text:p text:style-name="Code">&gt; https://food-coops-dashboards-okgwzegyus.now.sh</text:p><text:p text:style-name="Code">&gt; Synced 1 file (169.84KB) [11s]</text:p><text:p text:style-name="Code">&gt; Building...</text:p><text:p text:style-name="Code">&gt; â–² npm install</text:p><text:p text:style-name="Code">&gt; âœ“ Using "package-lock.json"</text:p><text:p text:style-name="Code">&gt; â§— Installing 9 main dependencies...</text:p><text:p text:style-name="Code">&gt; â–² npm install</text:p><text:p text:style-name="Code">&gt; added 389 packages in 8.609s</text:p><text:p text:style-name="Code">&gt; â–² Snapshotting deployment</text:p><text:p text:style-name="Code">&gt; Build completed</text:p><text:p text:style-name="Code">&gt; Verifying instantiation in bru1</text:p><text:p text:style-name="Code">&gt; âœ” Scaled 1 instance in bru1 [31s]</text:p><text:p text:style-name="Code">&gt; Success! Deployment ready</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">En optant pour l&#8217;offre payante, nous pouvons aussi gÃ©rer les noms de domaine et
sous-domaines en leur attribuant l&#8217;URL du dÃ©ploiement&#160;:</text:p>
<text:p text:style-name="Code">$ now alias food-coops-dashboards-okgwzegyus.now.sh my-domain.com</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Pratique</text:span> Application de bureau</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Le client en ligne de commande existe en version graphique.
Un glisser/dÃ©poser de fichiers suffit Ã  lancer un dÃ©ploiement.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Il se tÃ©lÃ©charge sur <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://zeit.co/download" text:visited-style-name="Visited_20_Internet_20_Link">https://zeit.co/download</text:a></text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;outil de la <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-paas"  text:visited-style-name="Visited_20_Internet_20_Link">plate-forme de services</text:a> <text:span text:style-name="T4">Heroku</text:span> suit une approche
lÃ©gÃ¨rement diffÃ©rente.
undefined
undefined
Il nous informe de l&#8217;Ã©tat de nos applications et en augmente ou diminue
la quantitÃ© de ressources allouÃ©e Ã  leur fonctionnement.
Il simplifie la configuration de&#160;Git et
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy.git"  text:visited-style-name="Visited_20_Internet_20_Link">dÃ©lÃ¨gue le dÃ©ploiement</text:a> Ã  ce dernier.
L&#8217;outil se tÃ©lÃ©charge sur
<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://devcenter.heroku.com/articles/heroku-cli" text:visited-style-name="Visited_20_Internet_20_Link">https://devcenter.heroku.com/articles/heroku-cli</text:a></text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">Configuration de l&#8217;outil <text:span text:style-name="CodeDansTexte">heroku</text:span></text:p><text:p text:style-name="Code">$ heroku login</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La commande <text:span text:style-name="CodeDansTexte">heroku apps:create</text:span> crÃ©e une nouvelle application chez <text:span text:style-name="T4">Heroku</text:span>.
On peut faire la mÃªme chose dans un navigateur web en nous rendant sur
<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://dashboard.heroku.com/new-app" text:visited-style-name="Visited_20_Internet_20_Link">https://dashboard.heroku.com/new-app</text:a></text:span>.
La commande <text:span text:style-name="CodeDansTexte">heroku git:remote</text:span> associe notre copie locale Git Ã  cette application&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">Configuration de notre dÃ©pÃ´t Git pour en faire une application Heroku</text:p><text:p text:style-name="Code">$ heroku apps:create --region eu</text:p><text:p text:style-name="Code">Creating app... done, â¬¢ <text:span text:style-name="CodeExergue">polar-taiga-61296</text:span>, region is eu</text:p><text:p text:style-name="Code">https://polar-taiga-61296.herokuapp.com/</text:p><text:p text:style-name="Code">https://git.heroku.com/polar-taiga-61296.git</text:p><text:p text:style-name="Code">$ heroku git:remote --app <text:span text:style-name="CodeExergue">polar-taiga-61296</text:span></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il ne nous reste plus qu&#8217;Ã  <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy.git"  text:visited-style-name="Visited_20_Internet_20_Link">pousser notre code avec&#160;Git</text:a>
pour terminer la mise en ligne.</text:p>
<text:bookmark text:name="ref-deploy.git" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">En faisant git&#160;push depuis sa machine</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le dÃ©ploiement d&#8217;une branche Git est le moyen le plus facile d&#8217;automatiser
tous les aspects d&#8217;un dÃ©ploiement.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette mÃ©thode est privilÃ©giÃ©e par les <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-paas"  text:visited-style-name="Visited_20_Internet_20_Link">plates-formes de services</text:a>
comme <text:span text:style-name="T4">Heroku</text:span>, <text:span text:style-name="T4">now</text:span> et <text:span text:style-name="T4">Clever Cloud</text:span>.
Chaque projet d&#8217;application est accessible via un dÃ©pÃ´t Git distant
(<text:span text:style-name="T4">remote</text:span>)&#160;: un dÃ©pÃ´t est utilisÃ© pour versionner notre code (GitHub par exemple)
tandis qu&#8217;un autre sert pour rÃ©ceptionner le code Ã  dÃ©ployer.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exemple suivant part du principe que notre terminal est positionnÃ© dans un
rÃ©pertoire qui est un projet Git contenant au moins un <text:span text:style-name="T4">commit</text:span>.
Vous avez dÃ©jÃ  configurÃ© le dÃ©pÃ´t distant Ã  l&#8217;aide de
l'<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy.cli"  text:visited-style-name="Visited_20_Internet_20_Link">outil de dÃ©ploiement</text:a> <text:span text:style-name="T4">Heroku</text:span> (<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy.cli"  text:visited-style-name="Visited_20_Internet_20_Link">section prÃ©cÃ©dente</text:a>).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous pouvons vÃ©rifier si le dÃ©pÃ´t est bien configurÃ© Ã  l&#8217;aide de la
commande <text:span text:style-name="CodeDansTexte">git remote</text:span>&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">Liste des dÃ©pÃ´ts distants d&#8217;un projet Git configurÃ© pour Heroku</text:p><text:p text:style-name="Code">$ git remote -v</text:p><text:p text:style-name="Code"><text:span text:style-name="CodeExergue">heroku</text:span>	https://git.heroku.com/mon-application.git (fetch)</text:p><text:p text:style-name="Code"><text:span text:style-name="CodeExergue">heroku</text:span>	https://git.heroku.com/mon-application.git (push)</text:p><text:p text:style-name="Code">origin	git@github.com:mon-compte/mon-application.git (fetch)</text:p><text:p text:style-name="Code">origin	git@github.com:mon-compte/mon-application.git (push)</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La commande <text:span text:style-name="CodeDansTexte">heroku git:remote</text:span> crÃ©e un <text:span text:style-name="T4">remote</text:span> nommÃ©
<text:span text:style-name="CodeDansTexte">heroku</text:span>.
undefined
undefined
Heroku redÃ©ploie notre application dÃ¨s qu&#8217;on lui envoie du code avec
<text:span text:style-name="CodeDansTexte">git push heroku</text:span>&#160;:</text:p>
<text:p text:style-name="Code">$ git push heroku</text:p><text:p text:style-name="Code">&gt; Counting objects: 4, done.</text:p><text:p text:style-name="Code">&gt; Delta compression using up to 4 threads.</text:p><text:p text:style-name="Code">&gt; Compressing objects: 100% (4/4), done.</text:p><text:p text:style-name="Code">&gt; Writing objects: 100% (4/4), 17.77 KiB | 5.92 MiB/s, done.</text:p><text:p text:style-name="Code">&gt; Total 4 (delta 2), reused 0 (delta 0)</text:p><text:p text:style-name="Code">&gt; remote: Compressing source files... done.</text:p><text:p text:style-name="Code">&gt; remote: Building source:</text:p><text:p text:style-name="Code">&gt; remote:</text:p><text:p text:style-name="Code">&gt; remote: -----&gt; Node.js app detected</text:p><text:p text:style-name="Code">&gt; remote:</text:p><text:p text:style-name="Code">&gt; remote: -----&gt; Creating runtime environment</text:p><text:p text:style-name="Code">&gt; ...</text:p><text:p text:style-name="Code">&gt; remote: -----&gt; Launching...</text:p><text:p text:style-name="Code">&gt; remote:<text:s text:c="8"/>Released v30<text:s text:c="21"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">&gt; remote:<text:s text:c="8"/>https://mon-application.herokuapp.com/ deployed</text:p><text:p text:style-name="Code">&gt; remote:</text:p><text:p text:style-name="Code">&gt; remote: Verifying deploy... done.</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> C&#8217;est le trentiÃ¨me dÃ©ploiement&#160;â€“ on peut revenir Ã  une version antÃ©rieure si nÃ©cessaire.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;URL de l&#8217;application est rappelÃ©e dans les <text:span text:style-name="T4">logs</text:span> du dÃ©ploiement.
En cas d&#8217;erreur, la version prÃ©cÃ©dente de l&#8217;application reste en ligne.
Nous avons ainsi le temps de corriger le problÃ¨me sans interruption de service.</text:p>
<text:bookmark text:name="ref-deploy.clone" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">En faisant git&#160;pull lors d&#8217;une session&#160;SSH</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La rÃ©cupÃ©ration du code source Ã  distance avec Git et SSH est une maniÃ¨re de dÃ©ployer
similaire Ã  la mise Ã  jour et au dÃ©marrage d&#8217;une application sur notre ordinateur.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette technique s&#8217;applique si notre application est placÃ©e sur un
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-hosting.shared"  text:visited-style-name="Visited_20_Internet_20_Link">hÃ©bergement mutualisÃ©</text:a>,
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-hosting.vm"  text:visited-style-name="Visited_20_Internet_20_Link">dÃ©diÃ© ou virtualisÃ©</text:a> ou une <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-hosting.cloud"  text:visited-style-name="Visited_20_Internet_20_Link">offre cloud</text:a>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exemple suivant illustre l&#8217;initialisation d&#8217;un projet via la connexion
SSH Ã  un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-hosting.shared"  text:visited-style-name="Visited_20_Internet_20_Link">hÃ©bergement mutualisÃ©</text:a> chez alwaysdata.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">PremiÃ¨re rÃ©cupÃ©ration d&#8217;un dÃ©pÃ´t Git lors d&#8217;une session&#160;SSH</text:p><text:p text:style-name="Code">$ ssh moncompte@ssh-moncompte.alwaysdata.net</text:p><text:p text:style-name="Code">$$ git clone https://github.com/moncompte/monprojet .</text:p><text:p text:style-name="Code">$$ npm install</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous avons clonÃ© un projet comme nous aurions pu le faire si nous installions
notre projet depuis zÃ©ro sur notre ordinateur.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans le cas d&#8217;une mise Ã  jour, nous rÃ©cupÃ©rons les changements depuis le dÃ©pÃ´t
distant avec <text:span text:style-name="CodeDansTexte">git pull</text:span>.
<text:span text:style-name="CodeDansTexte">npm install</text:span> met Ã  jour les dÃ©pendances s&#8217;il y a des diffÃ©rences entre
le contenu du fichier <text:span text:style-name="CodeDansTexte">package.json</text:span> et les modules dÃ©jÃ  installÃ©s
(<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-05"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;5</text:a>).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">Mise Ã  jour d&#8217;une application lors d&#8217;une session&#160;SSH</text:p><text:p text:style-name="Code">$ ssh moncompte@ssh-moncompte.alwaysdata.net</text:p><text:p text:style-name="Code">$$ git pull</text:p><text:p text:style-name="Code">$$ npm install</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans le cas d&#8217;alwaysdata, l&#8217;application se redÃ©marre depuis
l'<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-hosting.shared"  text:visited-style-name="Visited_20_Internet_20_Link">interface d&#8217;administration</text:a>.
Dans les autres cas, redÃ©marrez l&#8217;application selon le procÃ©dÃ© choisi aprÃ¨s
avoir lu la section <text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-startup"  text:visited-style-name="Visited_20_Internet_20_Link">DÃ©marrer automatiquement nos applications</text:a></text:span>.</text:p>
<text:bookmark text:name="ref-deploy.recipe" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Avec une recette de dÃ©ploiement (Ansible, Chef, etc.)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La recette de dÃ©ploiement est la maniÃ¨re la plus complÃ¨te de partager et
d&#8217;automatiser un dÃ©ploiement complexe.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette mÃ©thode se place dans la continuitÃ© de
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy.clone"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">git pull</text:span> lors d&#8217;une session SSH</text:a>&#160;: nous orchestrons les
actions nÃ©cessaires au dÃ©ploiement en les listant dans un
fichier de configuration, en choisissant dans quel ordre les dÃ©clencher
et sur quel(s) serveur(s).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous retrouvons Puppet (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://puppet.com" text:visited-style-name="Visited_20_Internet_20_Link">https://puppet.com</text:a></text:span>),
Chef (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://www.chef.io" text:visited-style-name="Visited_20_Internet_20_Link">https://www.chef.io</text:a></text:span>) et Ansible (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://ansible.com" text:visited-style-name="Visited_20_Internet_20_Link">https://ansible.com</text:a></text:span>)
parmi les outils les plus utilisÃ©s et les mieux documentÃ©s.
Ils ont des philosophies de configuration et d&#8217;exÃ©cution diffÃ©rentes
â€“ l&#8217;idÃ©al est encore d&#8217;essayer d&#8217;Ã©crire une premiÃ¨re recette avec chacun d&#8217;entre
eux pour voir celui qui vous semble le plus naturel Ã  utiliser.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ma prÃ©fÃ©rence va vers Ansible car le logiciel s&#8217;installe facilement
sur macOS et Linux, se configure avec une syntaxe que je connais dÃ©jÃ  (YAML)
et je trouve ses messages d&#8217;erreurs informatifs.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exemple suivant illustre le dÃ©ploiement de l&#8217;application Node <text:span text:style-name="T4">Slackin</text:span>
(<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://github.com/rauchg/slackin" text:visited-style-name="Visited_20_Internet_20_Link">https://github.com/rauchg/slackin</text:a></text:span>) sur
l'<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-hosting.shared"  text:visited-style-name="Visited_20_Internet_20_Link">hÃ©bergement mutualisÃ©</text:a> alwaysdata&#160;:</text:p>
<text:p text:style-name="Code">$ ansible-playbook<text:s text:c="2"/>-i ansible/inventory.yaml ansible/playbook.yaml</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">PLAY [webservers] *******************************</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">TASK [Gathering Facts] **************************</text:p><text:p text:style-name="Code">ok: [ssh-moncompte.alwaysdata.net]</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">TASK [code source via git] **********************</text:p><text:p text:style-name="Code">ok: [ssh-moncompte.alwaysdata.net]</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">TASK [mise Ã  jour des modules `npm`] **************</text:p><text:p text:style-name="Code">ok: [ssh-moncompte.alwaysdata.net]</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">PLAY RECAP **************************************</text:p><text:p text:style-name="Code">ssh-moncompte.alwaysdata.net : ok=3</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La commande prÃ©cÃ©dente a eu pour effet de crÃ©er des connexions SSH avec les
machines listÃ©es dans le fichier <text:span text:style-name="CodeDansTexte">inventory.yaml</text:span> puis de jouer les actions
listÃ©es dans le fichier <text:span text:style-name="CodeDansTexte">playbook.yaml</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7">Inventaire</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque"><text:span text:style-name="T7">Liste de serveurs connus</text:span> sur lesquels effectuer des dÃ©ploiements.
En les catÃ©gorisant (par type, par emplacement), on contrÃ´le finement
les actions Ã  dÃ©clencher&#160;; par exemple, uniquement les serveurs web de production,
les bases de donnÃ©es de test, l&#8217;API de la rÃ©gion Europe.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7">Playbook</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque"><text:span text:style-name="T7">Liste des actions possibles</text:span> en fonction des types de serveurs.
Ces actions peuvent Ãªtre rejouÃ©es Ã  l&#8217;infini et de maniÃ¨re prÃ©dictible.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le <text:span text:style-name="T4">playbook</text:span> suivant illustre deux tÃ¢ches appliquÃ©es uniquement sur
les serveurs Ã©tiquetÃ©s dans notre inventaire en tant que <text:span text:style-name="CodeDansTexte">webservers</text:span>&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">ansible/playbook.yaml</text:p><text:p text:style-name="Code">---</text:p><text:p text:style-name="Code">- hosts: webservers</text:p><text:p text:style-name="Code"><text:s text:c="2"/>tasks:</text:p><text:p text:style-name="Code"><text:s text:c="4"/>- name: code source via git</text:p><text:p text:style-name="Code"><text:s text:c="6"/>git:<text:s text:c="44"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="8"/>repo: "https://github.com/rauchg/slackin.git" <text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="8"/>dest: "{{ ansible_env.HOME }}"</text:p><text:p text:style-name="Code"><text:s text:c="8"/>clone: yes<text:s text:c="36"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="8"/>update: yes<text:s text:c="35"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>- name: mise Ã  jour des modules npm</text:p><text:p text:style-name="Code"><text:s text:c="6"/>npm:<text:s text:c="44"/><text:span text:style-name="PuceCode">5</text:span></text:p><text:p text:style-name="Code"><text:s text:c="8"/>state: present<text:s text:c="32"/><text:span text:style-name="PuceCode">6</text:span></text:p><text:p text:style-name="Code"><text:s text:c="8"/>path: "{{ ansible_env.HOME }}"</text:p><text:p text:style-name="Code"><text:s text:c="8"/>production: true<text:s text:c="30"/><text:span text:style-name="PuceCode">7</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Actions Git&#160;â€“ <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://docs.ansible.com/ansible/2.5/modules/git_module" text:visited-style-name="Visited_20_Internet_20_Link">https://docs.ansible.com/ansible/2.5/modules/git_module</text:a></text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Adresse du dÃ©pÃ´t Git Ã  rÃ©cupÃ©rer.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Indique de cloner le dÃ©pÃ´t s&#8217;il n&#8217;est pas dÃ©jÃ  prÃ©sent.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Indique de rÃ©cupÃ©rer les <text:span text:style-name="T4">commit</text:span> du dÃ©pÃ´t en faisant <text:span text:style-name="CodeDansTexte">git pull</text:span>.<text:line-break/><text:span text:style-name="PuceCode">5</text:span> Actions npm&#160;â€“ <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://docs.ansible.com/ansible/2.5/modules/npm_module" text:visited-style-name="Visited_20_Internet_20_Link">https://docs.ansible.com/ansible/2.5/modules/npm_module</text:a></text:span>.<text:line-break/><text:span text:style-name="PuceCode">6</text:span> Indique d&#8217;installer les dÃ©pendances <text:span text:style-name="CodeDansTexte">npm</text:span> avec <text:span text:style-name="CodeDansTexte">npm install</text:span>.<text:line-break/><text:span text:style-name="PuceCode">7</text:span> Indique de lancer la mise Ã  jour des modules <text:span text:style-name="CodeDansTexte">npm</text:span> avec l&#8217;option <text:span text:style-name="CodeDansTexte">--production</text:span>&#160;â€“ c&#8217;est-Ã -dire sans les dÃ©pendances listÃ©es dans le champ <text:span text:style-name="CodeDansTexte">devDependencies</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les tÃ¢ches sont rÃ©plicables sur les serveurs listÃ©s dans un fichier d&#8217;inventaire.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">ansible/inventory.yaml</text:p><text:p text:style-name="Code">webservers:</text:p><text:p text:style-name="Code"><text:s text:c="2"/>hosts:</text:p><text:p text:style-name="Code"><text:s text:c="4"/>ssh-moncompte.alwaysdata.net</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous dÃ©ployons sur un seul serveur dans ce cas de figure,
mais nous pourrions tout Ã  fait dÃ©ployer une mÃªme application avec la mÃªme
configuration sur une dizaine de serveurs (application Ã  fort trafic)
ou chez plusieurs centaines de clients.
Dans tous les cas, l&#8217;application serait dans un Ã©tat cohÃ©rent sur toutes les
machines, avec peu de chances d&#8217;oublier une opÃ©ration et une plus grande facilitÃ©
Ã  revenir en arriÃ¨re.</text:p>
<text:bookmark text:name="ref-deploy.docker" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">En publiant une image Docker</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Une image Docker est un moyen fiable de reproduire le mÃªme environnement
applicatif et ses dÃ©pendances sur plusieurs systÃ¨mes d&#8217;exploitation
(Windows, Linux, macOS).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un des objectifs de Node est de faire fonctionner un mÃªme script
sur tout systÃ¨me d&#8217;exploitation compatible.
Docker (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://www.docker.com" text:visited-style-name="Visited_20_Internet_20_Link">https://www.docker.com</text:a></text:span>) pousse cette compatibilitÃ© plus
loin en empaquetant tout ce qui est nÃ©cessaire au bon fonctionnement
de l&#8217;application (dÃ©pendances, logiciels systÃ¨me).
Le mÃ©canisme d&#8217;exÃ©cution aide Ã  la fois Ã  orchestrer plusieurs conteneurs entre
eux&#160;â€“ y&#160;compris bases de donnÃ©es et moteurs de recherche&#160;â€“
et Ã  revenir dans l&#8217;Ã©tat applicatif initial.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le fichier suivant est un exemple fonctionnel d&#8217;image Docker.
Son intention est de crÃ©er un environnement Node&#160;v10
pour une <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-07"  text:visited-style-name="Visited_20_Internet_20_Link">application web</text:a> (chapitre&#160;7)
qui comporte une <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-05"  text:visited-style-name="Visited_20_Internet_20_Link">dÃ©pendance&#160;<text:span text:style-name="CodeDansTexte">npm</text:span></text:a> (chapitre&#160;5)&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">Dockerfile</text:p><text:p text:style-name="Code">FROM node:10-alpine</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">WORKDIR /app</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">COPY ./app.js ./app.js</text:p><text:p text:style-name="Code">COPY ./package.json ./package.json</text:p><text:p text:style-name="Code">RUN npm install --production</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">EXPOSE 4000</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">CMD ["npm", "start"]</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous choisissons l&#8217;environnement Node (<text:span text:style-name="CodeDansTexte">FROM</text:span>), avant de procÃ©der Ã  la copie
des fichiers applicatifs vers l&#8217;image (<text:span text:style-name="CodeDansTexte">COPY</text:span>).
Suite Ã  cela, nous installons aussi les dÃ©pendances de l&#8217;application et spÃ©cifions
quelle commande effectuer lorsque l&#8217;image Docker est lancÃ©e&#160;(<text:span text:style-name="CodeDansTexte">CMD</text:span>).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;image se construit et on dÃ©marre le conteneur sur notre ordinateur comme suit&#160;:</text:p>
<text:p text:style-name="Code">$ docker build -t nodebook/demo .</text:p><text:p text:style-name="Code">$ docker run -ti --rm -p 4000:4000 nodebook/demo</text:p><text:p text:style-name="Code">$ curl -L http://localhost:4000</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous avons dÃ©jÃ  parlÃ© de l'<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy.cli"  text:visited-style-name="Visited_20_Internet_20_Link">outil en ligne de commande</text:a>
du service <text:span text:style-name="CodeDansTexte">now</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://zeit.co/now" text:visited-style-name="Visited_20_Internet_20_Link">https://zeit.co/now</text:a></text:span>) dans la section du mÃªme nom.
undefined
Il est aussi capable de dÃ©ployer un conteneur Docker en se basant sur un fichier
<text:span text:style-name="CodeDansTexte">Dockerfile</text:span> en ajoutant l&#8217;option <text:span text:style-name="CodeDansTexte">--docker</text:span>&#160;:</text:p>
<text:p text:style-name="Code">$ now <text:span text:style-name="CodeExergue">--docker</text:span> --public</text:p><text:p text:style-name="Code">&gt; Deploying ~/.../examples under oncletom</text:p><text:p text:style-name="Code">&gt; https://examples-zlssezfiej.now.sh [in clipboard] (bru1) [7s]</text:p><text:p text:style-name="Code">&gt; Synced 1 file (156B) [7s]</text:p><text:p text:style-name="Code">&gt; Buildingâ€¦</text:p><text:p text:style-name="Code">&gt; â–² docker build</text:p><text:p text:style-name="Code">&gt; Sending build context to Docker daemon 17.92 kBkB</text:p><text:p text:style-name="Code">&gt; â–² Storing image</text:p><text:p text:style-name="Code">&gt; Build completed</text:p><text:p text:style-name="Code">&gt; Verifying instantiation in bru1</text:p><text:p text:style-name="Code">&gt; âœ” Scaled 1 instance in bru1 [18s]</text:p><text:p text:style-name="Code">&gt; Success! Deployment ready</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Une autre solution consiste Ã  publier notre image sur <text:span text:style-name="T4">Docker&#160;Hub</text:span>
(<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://hub.docker.com" text:visited-style-name="Visited_20_Internet_20_Link">https://hub.docker.com</text:a></text:span>), la plate-forme officielle de partage
d&#8217;images Docker, qui dispose d&#8217;une fonctionnalitÃ© de construction automatique
connectÃ©e Ã  GitHub.
Docker&#160;Hub construit l&#8217;image Ã  chaque nouveau <text:span text:style-name="T4">commit</text:span>,
puis la met Ã  disposition.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-06/images/docker-automated-build.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>6-undefined.</text:span> CrÃ©ation d&#8217;un build automatisÃ© Ã  partir d&#8217;un dÃ©pÃ´t GitHub</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il ne reste alors plus qu&#8217;Ã  la collecter sur un ordinateur avec la commande
<text:span text:style-name="CodeDansTexte">docker pull</text:span>&#160;â€“ que ce soit sur notre machine, chez notre hÃ©bergeur
ou par le biais du <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy.ci"  text:visited-style-name="Visited_20_Internet_20_Link">service d&#8217;intÃ©gration continue</text:a>.
Cette faÃ§on de procÃ©der garantit l&#8217;exÃ©cution de ce mÃªme environnement applicatif,
partout.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">AvancÃ©</text:span> Amazon Elastic Container Registry</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
undefined
Le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-hosting.cloud"  text:visited-style-name="Visited_20_Internet_20_Link">fournisseur cloud</text:a> Amazon Web Services intÃ¨gre
un registre privÃ© d&#8217;images Docker pour chaque compte client.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque"><text:span text:style-name="T4">Elastic Container Registry</text:span> (ECR, <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://aws.amazon.com/ecr/" text:visited-style-name="Visited_20_Internet_20_Link">https://aws.amazon.com/ecr/</text:a></text:span>)
se connecte Ã  d&#8217;autres services comme <text:span text:style-name="T4">Amazon CodeDeploy</text:span> pour dÃ©clencher
des mises Ã  jour d&#8217;infrastructure Ã  chaque nouvelle image Docker.</text:p>
<text:bookmark text:name="ref-deploy.ci" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">En paramÃ©trant un logiciel d&#8217;intÃ©gration continue</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;utilisation d&#8217;un logiciel d&#8217;intÃ©gration continue est la maniÃ¨re la plus
flexible d&#8217;automatiser tout type de dÃ©ploiement.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;intÃ©gration continue vise Ã  vÃ©rifier si des rÃ©gressions se sont glissÃ©es
dans notre code.
L&#8217;idÃ©e est de livrer rÃ©guliÃ¨rement du code pour dÃ©tecter les erreurs au plus tÃ´t.<text:line-break/>Les services d&#8217;intÃ©gration continue automatisent cette pratique.
Ils s&#8217;intÃ¨grent avec d&#8217;autres services pour prÃ©visualiser les branches,
compiler la documentation mais aussi pour dÃ©ployer des artefacts sur d&#8217;autres
plates-formes&#160;: <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-publish"  text:visited-style-name="Visited_20_Internet_20_Link">registre&#160;<text:span text:style-name="CodeDansTexte">npm</text:span></text:a>,
GitHub Pages, Heroku ou mÃªme <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-hosting.lambda"  text:visited-style-name="Visited_20_Internet_20_Link">Amazon Lambda</text:a>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le logiciel Jenkins (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://jenkins.io" text:visited-style-name="Visited_20_Internet_20_Link">https://jenkins.io</text:a></text:span>) s&#8217;installe sur notre propre
infrastructure tandis que des services en ligne comme
Circle&#160;CI (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://circleci.com" text:visited-style-name="Visited_20_Internet_20_Link">https://circleci.com</text:a></text:span>), Travis&#160;CI (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://travis-ci.com" text:visited-style-name="Visited_20_Internet_20_Link">https://travis-ci.com</text:a></text:span>)
et CodeShip (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://codeship.com" text:visited-style-name="Visited_20_Internet_20_Link">https://codeship.com</text:a></text:span>) mettent Ã  disposition leur
infrastructure gratuitement pour les projets <text:span text:style-name="T4">open&#160;source</text:span>.
GitLab (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://www.gitlab.com" text:visited-style-name="Visited_20_Internet_20_Link">https://www.gitlab.com</text:a></text:span>) combine l&#8217;hÃ©bergement de dÃ©pÃ´ts Git
et l&#8217;intÃ©gration continue.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Windows</text:span> Service AppVeyor</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">J&#8217;utilise AppVeyor (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://appveyor.com" text:visited-style-name="Visited_20_Internet_20_Link">https://appveyor.com</text:a></text:span>) en complÃ©ment d&#8217;un autre
service d&#8217;intÃ©gration continue quand il s&#8217;agit de tester
la <text:span text:style-name="T7">compatibilitÃ© du code avec Windows</text:span>
â€“ ce qui est le cas des exemples de cet ouvrage.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">J&#8217;ai une prÃ©fÃ©rence pour GitLab lorsque le projet y est hÃ©bergÃ©.
Le reste du temps, j&#8217;utilise Travis&#160;CI car j&#8217;aime la clartÃ© du fichier de configuration,
l&#8217;exhaustivitÃ© de la documentation et la qualitÃ© des Ã©changes avec le service
d&#8217;assistance technique.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le fichier suivant est un exemple de configuration pour Travis&#160;CI.
Il se place Ã  la racine d&#8217;un projet Ã  tester et s&#8217;Ã©crit avec la syntaxe&#160;YAML&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">.travis.yml</text:p><text:p text:style-name="Code">language: node_js</text:p><text:p text:style-name="Code">node_js: v10</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">script: npm test</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">deploy:</text:p><text:p text:style-name="Code"><text:s text:c="2"/>provider: npm</text:p><text:p text:style-name="Code"><text:s text:c="2"/>on:</text:p><text:p text:style-name="Code"><text:s text:c="4"/>tags: true</text:p><text:p text:style-name="Code"><text:s text:c="2"/>email: "$NPM_EMAIL"</text:p><text:p text:style-name="Code"><text:s text:c="2"/>api-key: "$NPM_TOKEN"</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cet exemple est structurÃ© en trois parties&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="T7">configuration de l&#8217;environnement</text:span>&#160;â€“ en l&#8217;occurrence Node&#160;v10&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="T7">commande de test</text:span>&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="T7">configuration du dÃ©ploiement</text:span> en cas de succÃ¨s.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ici, le but est <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-publish"  text:visited-style-name="Visited_20_Internet_20_Link">dÃ©ployer le code sur le registre&#160;<text:span text:style-name="CodeDansTexte">npm</text:span></text:a>
quand les tests passent lors de la crÃ©ation d&#8217;un tag Git.
Les variables d&#8217;environnement <text:span text:style-name="CodeDansTexte">$NPM_EMAIL</text:span> et <text:span text:style-name="CodeDansTexte">$NPM_TOKEN</text:span> se rÃ¨glent de
maniÃ¨re sÃ©curisÃ©e sur l&#8217;Ã©cran de configuration du projet.
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> .travis.yml</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Une documentation adaptÃ©e aux projets Node est disponible Ã  l&#8217;adresse suivante&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://docs.travis-ci.com/user/languages/javascript-with-nodejs/" text:visited-style-name="Visited_20_Internet_20_Link">https://docs.travis-ci.com/user/languages/javascript-with-nodejs/</text:a></text:span></text:p>
</text:list-item></text:list>
<text:p text:style-name="RemarqueFigureNumero">(chapter-06/images/travisci-secrets.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>6-undefined.</text:span> Ã‰cran de configuration des variables d&#8217;environnement sÃ©curisÃ©es.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exemple suivant illustre l&#8217;utilisation de
l'<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy.cli"  text:visited-style-name="Visited_20_Internet_20_Link">outil en ligne de commande</text:a>&#160;<text:span text:style-name="CodeDansTexte">now</text:span> dÃ¨s qu&#8217;un nouveau
<text:span text:style-name="T4">commit</text:span> est poussÃ© sur la branche <text:span text:style-name="CodeDansTexte">master</text:span> et que les tests passent au vert&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">.travis.yml</text:p><text:p text:style-name="Code">language: node_js</text:p><text:p text:style-name="Code">node_js: v10</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">before_deploy: npm install --global now</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">deploy:</text:p><text:p text:style-name="Code"><text:s text:c="2"/>provider: script</text:p><text:p text:style-name="Code"><text:s text:c="2"/>script: now --token $NOW_TOKEN</text:p><text:p text:style-name="Code"><text:s text:c="2"/>on:</text:p><text:p text:style-name="Code"><text:s text:c="4"/>branch: master</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les informations d&#8217;exÃ©cution des tests sont consignÃ©es au mÃªme titre que le statut
du dÃ©ploiement.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-06/images/travisci-build.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>6-undefined.</text:span> Ã‰cran illustrant le dÃ©ploiement automatique d&#8217;une application Node avec la commande&#160;now.</text:p>
<text:bookmark text:name="ref-hosting" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Choisir son hÃ©bergement</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous allons nous intÃ©resser aux diffÃ©rentes possibilitÃ©s d&#8217;hÃ©bergement
d&#8217;applications&#160;Node.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">CÃ´tÃ© tarifs, il en existe des gratuites sous certaines conditions,
d&#8217;autres se paient Ã  l&#8217;heure et d&#8217;autres Ã  l&#8217;annÃ©e.
Certaines offres sont figÃ©es, d&#8217;autres permettent d&#8217;ajouter des machines,
voire de changer la puissance en cours de route.</text:p>
<text:bookmark text:name="ref-hosting.paas" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Plate-forme de services (Platform as a Service, PaaS)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les plates-formes de services <text:span text:style-name="T7">automatisent la configuration et le dÃ©ploiement</text:span>
de nos applications Node, mais Ã©galement Ruby, Python et PHP, entre autres.
Elles se spÃ©cialisent dans des dÃ©ploiements rapides, une allocation des
ressources flexible, Ã  la demande et en un&#160;clic.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">C&#8217;est le <text:span text:style-name="T7">moyen le plus facile de dÃ©ployer une application Node</text:span>, surtout si
on utilise dÃ©jÃ  Git pour versionner son code.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Leur philosophie est de <text:span text:style-name="T7">tout penser en termes de ressources modulaires</text:span>.
On paie pour une certaine capacitÃ© de CPU et de RAM, Ã  la minute ou Ã  l&#8217;heure.
Ces capacitÃ©s s&#8217;augmentent ou se rÃ©duisent en quelques clics et sans changer
une seule ligne de code dans notre application.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Une application se dÃ©ploie avec un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy.cli"  text:visited-style-name="Visited_20_Internet_20_Link">outil en ligne de commande</text:a> ou
avec <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy.git"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">git push</text:span></text:a>.
Et nous pouvons l&#8217;automatiser avec une <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy.recipe"  text:visited-style-name="Visited_20_Internet_20_Link">recette de dÃ©ploiement</text:a>
et de l'<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy.ci"  text:visited-style-name="Visited_20_Internet_20_Link">intÃ©gration continue</text:a>.
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TableauTitre">Tableau 11. SÃ©lection de fournisseurs PaaS</text:p><table:table table:style-name="Tableau1"><table:table-column />,<table:table-column />,<table:table-column />,<table:table-column />,<table:table-column /><table:table-row><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Service</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>DÃ©ploiement</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Add-ons</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>GratuitÃ©</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Tarif</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://zeit.co" text:visited-style-name="Visited_20_Internet_20_Link">https://zeit.co</text:a></text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>cli</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2718;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>3&#160;apps</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>15&#160;$/mois/10 apps</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://clever-cloud.com" text:visited-style-name="Visited_20_Internet_20_Link">https://clever-cloud.com</text:a></text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Git</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2714;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>crÃ©dit&#160;20&#160;â‚¬</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>5&#160;â‚¬/mois/app</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://gandi.net/hosting/simple" text:visited-style-name="Visited_20_Internet_20_Link">https://gandi.net/hosting/simple</text:a></text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>cli/git/SSH</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2714;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>10&#160;jours</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>5&#160;â‚¬/mois/app</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://scalingo.com" text:visited-style-name="Visited_20_Internet_20_Link">https://scalingo.com</text:a></text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Git/GitHub</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2714;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>30&#160;jours</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>7&#160;â‚¬/mois/app</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://heroku.com" text:visited-style-name="Visited_20_Internet_20_Link">https://heroku.com</text:a></text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>cli/Git/GitHub/Dropbox</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2714;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>1&#160;000&#160;heures/mois</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>7&#160;$/mois/app</text:p></table:table-cell></table:table-row></table:table>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La startup californienne Zeit (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://zeit.co" text:visited-style-name="Visited_20_Internet_20_Link">https://zeit.co</text:a></text:span>) Ã©dite le service
<text:span text:style-name="T4">now</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://zeit.co/now" text:visited-style-name="Visited_20_Internet_20_Link">https://zeit.co/now</text:a></text:span>), qui est focalisÃ© sur l&#8217;hÃ©bergement de
sites statiques, d&#8217;applications Node et de conteneurs Docker.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Sa particularitÃ© est de crÃ©er une <text:span text:style-name="T7">nouvelle instance d&#8217;application par dÃ©ploiement</text:span>.
On ne modifie donc jamais un dÃ©ploiement dÃ©jÃ  existant.
On parle alors de <text:span text:style-name="T7">dÃ©ploiement immuable</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">C&#8217;est un service que j&#8217;apprÃ©cie pour sa simplicitÃ©.
C&#8217;est probablement le plus pratique Ã  utiliser pour dÃ©ployer votre premiÃ¨re application,
si vous n&#8217;utilisez pas Git ou si l&#8217;application n&#8217;utilise pas de base de donnÃ©es.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">Heroku</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://heroku.com" text:visited-style-name="Visited_20_Internet_20_Link">https://heroku.com</text:a></text:span>) est une autre alternative plus complÃ¨te,
toujours pour dÃ©marrer en douceur et sans sortir la carte bleue.
undefined
undefined
Des modules optionnels couvrent nos besoins en bases de donnÃ©es comme
MySQL, MariaDB, Redis ou PostgreSQL.
D&#8217;autres services gÃ¨rent l&#8217;envoi de courriels,
l&#8217;indexation de contenus, le monitoring, les logs, etc.
En majoritÃ©, ils offrent un petit espace de stockage gratuit pour tester le produit.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-06/images/heroku-addons.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>6-undefined.</text:span> Ensemble de ressources complÃ©mentaires Ã  une application Node hÃ©bergÃ©e sur Heroku</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">S&#8217;il est facile de dÃ©ployer sur ces infrastructures et de gÃ©rer les ressources
allouÃ©es Ã  nos applications, Ã  l&#8217;inverse la facture peut vite devenir salÃ©e
Ã  mesure qu&#8217;on augmente leur puissance.
Ce coÃ»t est tout relatif&#160;: il est sÃ»rement infÃ©rieur Ã  celui de notre temps
passÃ© Ã  gÃ©rer les machines si on devait tout faire Ã  la&#160;main.</text:p>
<text:bookmark text:name="ref-hosting.shared" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">HÃ©bergement mutualisÃ©</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les hÃ©bergements mutualisÃ©s ont l&#8217;avantage d&#8217;Ãªtre <text:span text:style-name="T7">bon marchÃ© et sans entretien</text:span>.
Cette formule est un excellent compromis prix/services.
Elle demande un peu plus d&#8217;efforts que les <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-hosting.paas"  text:visited-style-name="Visited_20_Internet_20_Link">plates-formes de services</text:a>
car tout le travail d&#8217;automatisation repose sur nos Ã©paules, si on le souhaite.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce modÃ¨le est adaptÃ© pour l&#8217;hÃ©bergement de fichiers statiques ou des sites web
construits avec des langages de scripts comme Python ou PHP.
Rares sont ceux qui ont adaptÃ© leur fonctionnement au modÃ¨le applicatif de&#160;Node.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Alwaysdata (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://alwaysdata.com" text:visited-style-name="Visited_20_Internet_20_Link">https://alwaysdata.com</text:a></text:span>) fait exception Ã  la rÃ¨gle.
Ce service d&#8217;hÃ©bergement indÃ©pendant dispose d&#8217;une formule gratuite avec 100&#160;Mo
d&#8217;espace disque pour dÃ©marrer.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy"  text:visited-style-name="Visited_20_Internet_20_Link">dÃ©ploiement</text:a> de nos applications se fait via
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy.sftp"  text:visited-style-name="Visited_20_Internet_20_Link">SSH ou SFTP</text:a>, en <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy.clone"  text:visited-style-name="Visited_20_Internet_20_Link">utilisant Git</text:a>,
avec un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy.ci"  text:visited-style-name="Visited_20_Internet_20_Link">service d&#8217;intÃ©gration continue</text:a> ou bien en
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy.recipe"  text:visited-style-name="Visited_20_Internet_20_Link">utilisant une recette</text:a>.
undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;interface d&#8217;administration rÃ©fÃ©rence une section <text:span text:style-name="T7">Sites</text:span> dans la barre de
navigation, qui liste les diffÃ©rents sites de notre compte.
Si vous venez juste de crÃ©er le vÃ´tre, un site a automatiquement Ã©tÃ© gÃ©nÃ©rÃ©.
Son URL est dÃ©terminÃ©e Ã  partir du <text:span text:style-name="T7">nom d&#8217;utilisateur</text:span> que vous avez choisi
lors de la phase d&#8217;inscription.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un clic sur le bouton <text:span text:style-name="CodeDansTexte">Modifier</text:span> nous aidera Ã  changer ses rÃ©glages&#160;:</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-06/images/alwaysdata-site-list.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>6-undefined.</text:span> Liste de nos sites configurÃ©s chez alwaysdata</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le nouvel Ã©cran mentionne les adresses auxquelles le site rÃ©pond.
En basculant vers un compte payant, on a la possibilitÃ© d&#8217;affecter un ou
plusieurs domaine(s) ou sous-domaine(s) Ã  ce mÃªme&#160;site.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-06/images/alwaysdata-site-informations.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>6-undefined.</text:span> Ã‰cran de configuration d&#8217;un site chez alwaysdata.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les rÃ©glages liÃ©s Ã  Node se trouvent sous les adresses.
Le <text:span text:style-name="Menu">type</text:span> de site doit Ãªtre changÃ© en <text:span text:style-name="CodeDansTexte">Node.js</text:span> pour afficher
les champs de configuration qui nous intÃ©ressent.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La <text:span text:style-name="Menu">commande</text:span> se configure de la mÃªme maniÃ¨re
que l'<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-script"  text:visited-style-name="Visited_20_Internet_20_Link">exÃ©cution d&#8217;un script Node</text:a>
(<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-04"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;4</text:a>).
On peut aussi faire appel au
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-start"  text:visited-style-name="Visited_20_Internet_20_Link">script <text:span text:style-name="CodeDansTexte">npm start</text:span></text:a> comme vu
au <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-05"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;5</text:a>&#160;:</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-06/images/alwaysdata-site-configuration.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>6-undefined.</text:span> Ã‰cran de configuration de Node.js pour un site chez alwaysdata.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La commande complÃ¨te devrait apparaÃ®tre dans la section <text:span text:style-name="Menu">Processus</text:span>
une fois la configuration sauvegardÃ©e.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-06/images/alwaysdata-process-list.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>6-undefined.</text:span> Liste des processus liÃ©s Ã  nos sites chez alwaysdata</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">En cas de doute, un bouton <text:span text:style-name="CodeDansTexte">RedÃ©marrer</text:span> est affichÃ© Ã  cÃ´tÃ© du bouton
<text:span text:style-name="CodeDansTexte">Modifier</text:span> dans la liste des sites.
L&#8217;application sera alors interrompue et relancÃ©e.
Cette opÃ©ration est nÃ©cessaire pour que l&#8217;application prenne en compte
les changements aprÃ¨s une mise Ã  jour ou un plantage.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Configuration</text:span> Une application Node par&#160;site</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Alwaysdata nous permet d&#8217;associer un seul processus Ã  un seul&#160;site.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Pour rendre une application Node accessible sur Internet, il faudra
crÃ©er un nouveau site et lui associer un autre nom de domaine,
ou un sous-domaine.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Aide</text:span> Forum d&#8217;entraide</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">L&#8217;Ã©quipe et la communautÃ© alwaysdata (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://forum.alwaysdata.com" text:visited-style-name="Visited_20_Internet_20_Link">https://forum.alwaysdata.com</text:a></text:span>) sont
sympathiques et Ã  l&#8217;Ã©coute.
C&#8217;est un endroit idÃ©al pour chercher des informations et poser des questions
pour mieux comprendre ce qui empÃªche votre application de fonctionner
sur leurs services.</text:p>
<text:bookmark text:name="ref-hosting.cloud" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Serveur virtualisÃ©, dÃ©diÃ© ou&#160;cloud</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La location d&#8217;un serveur dÃ©diÃ© revient Ã  payer pour un ordinateur complet,
son entretien physique et son placement dans un <text:span text:style-name="T4">datacenter</text:span>&#160;â€“ un immense
parc Ã  ordinateurs connectÃ© Ã  un rÃ©seau haute&#160;capacitÃ©.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les <text:span text:style-name="T4">Virtual Private Servers</text:span> (<text:span text:style-name="T4">VPS</text:span>) sont des machines virtuelles
(<text:span text:style-name="T4">Virtual Machine</text:span>,&#160;<text:span text:style-name="T4">VM</text:span>)&#160;: les ressources d&#8217;un serveur dÃ©diÃ© sont
rÃ©parties en plusieurs unitÃ©s indÃ©pendantes les unes des autres, les&#160;VM.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les offres cloud sont une version <text:span text:style-name="">Ã©lastique</text:span> des&#160;VM&#160;: la puissance de calcul,
la bande&#160;passante et la mÃ©moire allouÃ©es sont ajustables sans avoir Ã 
changer de machine, sans avoir Ã  tout rÃ©installer.
Ces ressources sont considÃ©rÃ©es comme Ã©tant <text:span text:style-name="">Ã &#160;la demande</text:span>&#160;: elles s&#8217;obtiennent
en quelques secondes et peuvent Ãªtre mises en pause, rÃ©duites, augmentÃ©es ou
supprimÃ©es Ã  tout moment.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Leur modÃ¨le de facturation s&#8217;adapte Ã  la souplesse d&#8217;allocation des ressources&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">au mois&#160;: VPS, serveur virtualisÃ©, serveur dÃ©diÃ©&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Ã  l&#8217;heure&#160;: serveur cloud&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Ã  la (milli)seconde&#160;: <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-hosting.lambda"  text:visited-style-name="Visited_20_Internet_20_Link">fonction Ã©vÃ©nementielle</text:a>.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les modes de dÃ©ploiement adaptÃ©s sont <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy.clone"  text:visited-style-name="Visited_20_Internet_20_Link">Git</text:a>
pour obtenir le code, l'<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy.docker"  text:visited-style-name="Visited_20_Internet_20_Link">orchestration d&#8217;applications avec Docker</text:a>
en combinaison avec des <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy.recipe"  text:visited-style-name="Visited_20_Internet_20_Link">recettes de dÃ©ploiement</text:a> et
l'<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy.ci"  text:visited-style-name="Visited_20_Internet_20_Link">intÃ©gration continue</text:a>.
undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;offre de serveurs virtualisÃ©s et dÃ©diÃ©s (VPS, VM) est adaptÃ©e Ã  des
besoins constants et pour hÃ©berger plusieurs applications sur une mÃªme machine
â€“ Ã  coÃ»t constant.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TableauTitre">Tableau 12. SÃ©lection de fournisseurs de serveur virtualisÃ© et dÃ©diÃ©</text:p><table:table table:style-name="Tableau1"><table:table-column />,<table:table-column />,<table:table-column />,<table:table-column />,<table:table-column /><table:table-row><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Service</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>DÃ©ploiement</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Add-ons</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Tarif horaire</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Tarif mensuel</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://ovh.com/fr/vps/" text:visited-style-name="Visited_20_Internet_20_Link">https://ovh.com/fr/vps/</text:a></text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>SSH</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2714;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>-</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>4&#160;â‚¬/VM</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://online.net/fr/serveur-dedie" text:visited-style-name="Visited_20_Internet_20_Link">https://online.net/fr/serveur-dedie</text:a></text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>SSH, CLI, API</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2714;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>-</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>14,5&#160;â‚¬/serveur</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://alwaysdata.com/fr/pricing/#vps" text:visited-style-name="Visited_20_Internet_20_Link">https://alwaysdata.com/fr/pricing/#vps</text:a></text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>SSH, API</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2714;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>-</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>149&#160;â‚¬/VM</text:p></table:table-cell></table:table-row></table:table>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;offre cloud est plus intÃ©ressante si vos besoins sont
singuliÃ¨rement fluctuants&#160;â€“ par exemple lorsqu&#8217;il y a besoin de doubler la CPU
pendant deux heures, Ã  heure fixe ou en fonction de la charge, mais aussi quand il
s&#8217;agit d&#8217;ajouter dix serveurs d&#8217;un coup pour traiter un calcul gourmand.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TableauTitre">Tableau 13. SÃ©lection de fournisseurs de serveur cloud</text:p><table:table table:style-name="Tableau1"><table:table-column />,<table:table-column />,<table:table-column />,<table:table-column />,<table:table-column /><table:table-row><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Service</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>DÃ©ploiement</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Add-ons</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Tarif horaire</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Tarif mensuel</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://scaleway.com" text:visited-style-name="Visited_20_Internet_20_Link">https://scaleway.com</text:a></text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>CLI, SSH, API</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2718;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>0,004&#160;â‚¬</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>2,30&#160;â‚¬/VM</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://linode.com" text:visited-style-name="Visited_20_Internet_20_Link">https://linode.com</text:a></text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>CLI, Git, API, Web</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2714;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>0,0075&#160;$</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>5,00&#160;$/VM</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://gandi.net/hosting/iaas" text:visited-style-name="Visited_20_Internet_20_Link">https://gandi.net/hosting/iaas</text:a></text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>CLI, Git</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2718;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>0,0081&#160;â‚¬</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>6,00&#160;â‚¬/VM</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://ovh.com/fr/public-cloud/" text:visited-style-name="Visited_20_Internet_20_Link">https://ovh.com/fr/public-cloud/</text:a></text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>SSH, API, Web</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2714;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>0,062&#160;â‚¬</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>26,00&#160;â‚¬/VM</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://digitalocean.com" text:visited-style-name="Visited_20_Internet_20_Link">https://digitalocean.com</text:a></text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>CLI, API</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2718;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>0,007&#160;$</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>5,00&#160;$/VM</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://aws.amazon.com/fr/ec2/" text:visited-style-name="Visited_20_Internet_20_Link">https://aws.amazon.com/fr/ec2/</text:a></text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>CLI, API, SSH, Web</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>&#x2714;</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>0,0132&#160;$</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>9,67&#160;$/VM</text:p></table:table-cell></table:table-row></table:table>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">AvancÃ©</text:span> HashiCorp Terraform</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Le logiciel <text:span text:style-name="T4">Terraform</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://terraform.io/" text:visited-style-name="Visited_20_Internet_20_Link">https://terraform.io/</text:a></text:span>) a pour intention
de documenter une infrastructure (serveurs, DNS, stockage, etc.) sous forme
d&#8217;un fichier de configuration&#160;â€“ versionnable avec&#160;Git.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">C&#8217;est un outil idÃ©al pour automatiser le dÃ©ploiement d&#8217;une infrastructure de zÃ©ro,
mais aussi pour la faire Ã©voluer d&#8217;une version Ã  une autre.
Nous pouvons ainsi crÃ©er une architecture combinant plusieurs fournisseurs
sans gÃ©rer la complexitÃ© et la non-interopÃ©rabilitÃ© de leurs&#160;API.</text:p>
<text:bookmark text:name="ref-hosting.lambda" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Fonction Ã©vÃ©nementielle (Serverless, Lambda)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La fonction Ã©vÃ©nementielle est l&#8217;Ã©volution ultime des offres cloud.
Au lieu de payer une machine ou une VM Ã  l&#8217;heure,
<text:span text:style-name="T7">nous payons pour exÃ©cuter du code Ã  la milliseconde</text:span>.
Ce code se dÃ©clenche en rÃ©action Ã  un Ã©vÃ©nement se produisant ailleurs
sur l&#8217;infrastructure&#160;: une requÃªte HTTP entrante, un nouveau fichier ou encore
un appel de l&#8217;API de l&#8217;hÃ©bergeur.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">C&#8217;est le moyen le plus Ã©conomique pour
<text:span text:style-name="T7">exÃ©cuter du code Ã  tout instant sans payer le temps d&#8217;inactivitÃ© d&#8217;une machine</text:span>.
On pourrait comparer ce modÃ¨le Ã  celui de la tÃ©lÃ©phonie mobile lorsqu&#8217;on a Ã  choisir
entre un forfait (coÃ»t fixe mÃªme si on ne consomme pas tout) et un paiement Ã  la carte
(coÃ»t dÃ©pendant de la consommation).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les applications destinÃ©es Ã  Ãªtre exÃ©cutÃ©es comme fonctions Ã©vÃ©nementielles
ont une architecture un peu diffÃ©rente.
Au lieu de dÃ©marrer un serveur web basÃ© sur le
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-http"  text:visited-style-name="Visited_20_Internet_20_Link">module <text:span text:style-name="CodeDansTexte">http</text:span></text:a>, nous exposons
une <text:span text:style-name="T7">fonction qui retourne un rÃ©sultat de maniÃ¨re asynchrone</text:span>&#160;:
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">webtask.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const getPokemonName = require('pokemon-random-name');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">module.exports = (context, send) =&gt; {<text:s text:c="5"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>return send(null, getPokemonName());</text:p><text:p text:style-name="Code">};</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Le paramÃ¨tre <text:span text:style-name="CodeDansTexte">context</text:span> contient des informations Ã  propos de la requÃªte entrante&#160;â€“ paramÃ¨tres, corps du message, etc.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce code est trÃ¨s similaire Ã  ce que nous pourrions Ã©crire lors de l&#8217;Ã©vÃ©nement
<text:span text:style-name="CodeDansTexte">server.on('request')</text:span> du <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-http"  text:visited-style-name="Visited_20_Internet_20_Link">module&#160;<text:span text:style-name="CodeDansTexte">http</text:span></text:a>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Voyons cela en contexte dans l&#8217;interface web du service Webtask
(<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://webtask.io/make" text:visited-style-name="Visited_20_Internet_20_Link">https://webtask.io/make</text:a></text:span>)&#160;:</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-06/images/webtask-make.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>6-undefined.</text:span> Exemple de fonction Ã©vÃ©nementielle et de son historique d&#8217;exÃ©cutions avec le service Webtask</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un nom de PokÃ©mon est affichÃ© lorsque nous accÃ©dons Ã  l&#8217;URL indiquÃ©e en bas
de l&#8217;Ã©cran.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TableauTitre">Tableau 14. SÃ©lection de fournisseurs</text:p><table:table table:style-name="Tableau1"><table:table-column />,<table:table-column />,<table:table-column />,<table:table-column /><table:table-row><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Service</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>DÃ©ploiement</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>GratuitÃ©</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Tarif des requÃªtes</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://aws.amazon.com/lambda" text:visited-style-name="Visited_20_Internet_20_Link">https://aws.amazon.com/lambda</text:a></text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Web, CLI, API</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>1&#160;M&#160;requÃªtes/mois</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>0,2&#160;$/million</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://webtask.io" text:visited-style-name="Visited_20_Internet_20_Link">https://webtask.io</text:a></text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Web, GitHub, CLI, API</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>1&#160;requÃªte/seconde</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>sur devis</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://cloud.google.com/functions/" text:visited-style-name="Visited_20_Internet_20_Link">https://cloud.google.com/functions/</text:a></text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Web, GitHub, CLI, API</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>2&#160;M&#160;equÃªtes/mois</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>0,4&#160;$/million</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://zeit.co/now" text:visited-style-name="Visited_20_Internet_20_Link">https://zeit.co/now</text:a></text:span> + <text:span text:style-name="CodeDansTexte">micro</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>CLI, API</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>3&#160;apps</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>15&#160;$/mois</text:p></table:table-cell></table:table-row></table:table>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Chaque fournisseur de fonction Ã©vÃ©nementielle a sa propre vision des paramÃ¨tres
qui nous sont donnÃ©s, mais leurs fonctionnements restent trÃ¨s proches.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Je trouve que Webtask est le service avec la plus faible courbe d&#8217;apprentissage.
Son interface y est pour beaucoup.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le service <text:span text:style-name="T4">now</text:span> est intÃ©ressant Ã  plus d&#8217;un titre.
undefined
undefined
Il dÃ©ploie un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy.cli"  text:visited-style-name="Visited_20_Internet_20_Link">outil en ligne de commande minimaliste</text:a>,
y compris des <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy.docker"  text:visited-style-name="Visited_20_Internet_20_Link">conteneurs Docker</text:a>.
Il se transforme en fonction Ã©vÃ©nementielle avec l&#8217;aide du
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-modules"  text:visited-style-name="Visited_20_Internet_20_Link">module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span></text:a>
<text:span text:style-name="T4">micro</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/micro" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/micro</text:a></text:span>).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le service Amazon Lambda reprÃ©sente une marche d&#8217;apprentissage un peu plus importante.
C&#8217;est un service important de par l&#8217;outillage et la documentation disponibles
Ã  son sujet.
Le service est complet, surtout une fois couplÃ© avec le service
<text:span text:style-name="T4">Amazon API Gateway</text:span>.
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">AvancÃ©</text:span> Amazon API Gateway</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Les Lambda d&#8217;Amazon ne sont pas accessibles depuis Internet par dÃ©faut.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Pour ce faire, il faut les relier au service  et associer
chaque route Ã  une Lambda.
Le service se charge de transformer le rÃ©sultat
â€“ une chaÃ®ne de caractÃ¨res, un tableau ou un objet ECMAScript&#160;â€“
en une rÃ©ponse&#160;HTTP.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">DÃ©finition</text:span> Serverless</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
Ce type d&#8217;infrastructure a Ã©tÃ© nommÃ© <text:span text:style-name="T4">serverless</text:span> suite Ã  une organisation
du marchÃ© pour proposer des alternatives aux Lambda d&#8217;Amazon.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Quand on entend le mot <text:span text:style-name="T4">serverless</text:span>&#160;â€“ littÃ©ralement, sans serveur&#160;â€“ il faut comprendre
<text:span text:style-name="">sans serveur Ã  gÃ©rer soi-mÃªme</text:span>.
L&#8217;hÃ©bergeur dispose quand mÃªme de machines pour exÃ©cuter le code.
Leurs ressources sont mutualisÃ©es au maximum.</text:p>
<text:bookmark text:name="ref-amÃ©liorer_la_portabilitÃ©_applicative" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">AmÃ©liorer la portabilitÃ© applicative</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le fonctionnement d&#8217;une application Node risque d&#8217;Ãªtre affectÃ© suite Ã  son
dÃ©ploiement en ligne.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette section a pour but de mettre en lumiÃ¨re des
<text:span text:style-name="T7">points importants qui contribuent Ã  la portabilitÃ© de l&#8217;application</text:span>
â€“ c&#8217;est-Ã -dire son bon fonctionnement une fois installÃ©e autre part
que sur un ordinateur de dÃ©veloppement, indÃ©pendamment du service
d&#8217;hÃ©bergement retenu.</text:p>
<text:bookmark text:name="ref-node.version" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Utiliser la bonne version de&#160;Node</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-hosting.paas"  text:visited-style-name="Visited_20_Internet_20_Link">plates-formes de services</text:a> et certains
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy.ci"  text:visited-style-name="Visited_20_Internet_20_Link">services d&#8217;intÃ©gration continue</text:a> utilisent deux mÃ©canismes
pour dÃ©terminer notre prÃ©fÃ©rence quant Ã  la version de Node Ã  utiliser&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">le fichier <text:span text:style-name="CodeDansTexte">.nvmrc</text:span>&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">la valeur <text:span text:style-name="CodeDansTexte">engines.node</text:span> du fichier <text:span text:style-name="CodeDansTexte">package.json</text:span>.
undefined
undefined</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans les deux cas, cela revient Ã  prÃ©ciser la version de Node
pour chacun de nos projets.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Conseil</text:span> Une version de Node par application</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Je trouve qu&#8217;il est plus facile d&#8217;adapter la version de Node au cas par cas
au lieu de m&#8217;imposer une seule version pour tout le code que j&#8217;Ã©cris.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">C&#8217;est trÃ¨s utile quand je reprends le code aprÃ¨s plusieurs mois d&#8217;inactivitÃ©.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Si vous avez dÃ©cidÃ© d&#8217;utiliser <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-nvm"  text:visited-style-name="Visited_20_Internet_20_Link">nvm</text:a>
(<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-02"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;2</text:a>) ou si vous utilisez un service
compatible, sachez que cet outil sait s&#8217;adapter Ã  la version
de Node prÃ©cisÃ©e dans le fichier <text:span text:style-name="CodeDansTexte">.nvmrc</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un fichier <text:span text:style-name="CodeDansTexte">.nvmrc</text:span> ressemble Ã  ceci&#160;:
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">.nvmrc</text:p><text:p text:style-name="Code">v10</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Avec cette valeur, cela revient au mÃªme de faire
<text:span text:style-name="CodeDansTexte">nvm install v10</text:span> et <text:span text:style-name="CodeDansTexte">nvm install</text:span>.
undefined
La commande <text:span text:style-name="CodeDansTexte">nvm use</text:span> lit Ã©galement la version contenue dans <text:span text:style-name="CodeDansTexte">.nvmrc</text:span>
et bascule automatiquement vers celle-ci&#160;:</text:p>
<text:p text:style-name="Code">$ nvm install</text:p><text:p text:style-name="Code">$ nvm use</text:p><text:p text:style-name="Code">$ node --version</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-hosting.paas"  text:visited-style-name="Visited_20_Internet_20_Link">plates-formes de services</text:a> qui ne se basent pas sur <text:span text:style-name="CodeDansTexte">nvm</text:span>
regardent en gÃ©nÃ©ral dans le fichier <text:span text:style-name="CodeDansTexte">package.json</text:span>&#160;:</text:p>
<text:p text:style-name="Code">{</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"name": "my-app",</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"engines": {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"node": "10.x.x"</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">}</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette notation signifie <text:span text:style-name="">la version la plus rÃ©cente de Node v10</text:span>.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Enfin, la derniÃ¨re version de Node est utilisÃ©e si cette information
ne peut pas Ãªtre dÃ©terminÃ©e avec les deux mÃ©canismes prÃ©cÃ©demment citÃ©s.</text:p>
<text:bookmark text:name="ref-port" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">L&#8217;application tourne mais elle est injoignable</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il est nÃ©cessaire de renseigner un <text:span text:style-name="T4">port</text:span> lorsqu&#8217;on dÃ©marre un serveur
avec le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-http"  text:visited-style-name="Visited_20_Internet_20_Link">module <text:span text:style-name="CodeDansTexte">http</text:span></text:a>
(cf. <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-04"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;4</text:a>).
Pourtant, nous allons faire face Ã  un <text:span text:style-name="">problÃ¨me</text:span> si le code suivant est dÃ©ployÃ©
sur une <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-hosting.paas"  text:visited-style-name="Visited_20_Internet_20_Link">plate-forme de services</text:a>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">server-port.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const server = require('http').createServer();</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">server.listen(8000, () =&gt; console.log('localhost:8000'));</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le dÃ©ploiement est considÃ©rÃ© comme rÃ©ussi, mais l&#8217;application est injoignable.
En effet, les plates-formes de services choisissent ce port pour nous
et l&#8217;associent Ã  l&#8217;URL de notre application
â€“ <text:span text:style-name="URL">monapplication.heroku.com</text:span> par exemple.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le port est exposÃ© au travers d&#8217;une
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process.env"  text:visited-style-name="Visited_20_Internet_20_Link">variable d&#8217;environnement</text:a>
(<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-04"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;4</text:a>).
Par convention, c&#8217;est la variable <text:span text:style-name="CodeDansTexte">PORT</text:span> qui est utilisÃ©e.
undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous n&#8217;avons qu&#8217;Ã  adapter le script prÃ©cÃ©dent de cette maniÃ¨re&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">server-port-dynamic.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const server = require('http').createServer();</text:p><text:p text:style-name="Code">const {PORT=8000} = process.env;<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">server.listen(PORT, () =&gt; console.log(`localhost:${PORT}`));</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Extrait la valeur de la variable d&#8217;environnement <text:span text:style-name="CodeDansTexte">process.env.PORT</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La variable d&#8217;environnement <text:span text:style-name="CodeDansTexte">PORT</text:span> sera utilisÃ©e si elle existe et, sinon,
le port <text:span text:style-name="CodeDansTexte">8000</text:span> sera la valeur par dÃ©faut&#160;:</text:p>
<text:p text:style-name="Code">$ node server-port-dynamic.js<text:s text:c="13"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">$ <text:span text:style-name="CodeExergue">PORT=4000</text:span> node server-port-dynamic.js<text:s text:c="3"/><text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">localhost:8000</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">localhost:4000</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">C&#8217;est un premier pas pour s&#8217;affranchir des
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-configuration"  text:visited-style-name="Visited_20_Internet_20_Link">Ã©lÃ©ments de configuration Ã©crits en dur</text:a>.</text:p>
<text:bookmark text:name="ref-configuration" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">S&#8217;affranchir des chemins et configurations Ã©crits <text:span text:style-name="">en dur</text:span></text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-port"  text:visited-style-name="Visited_20_Internet_20_Link">configuration du port</text:a> de l&#8217;application n&#8217;est pas le seul
Ã©lÃ©ment contextuel Ã  changer entre notre ordinateur et un autre
â€“ que ce soit celui d&#8217;une personne contribuant au projet,
au <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy.ci"  text:visited-style-name="Visited_20_Internet_20_Link">service d&#8217;intÃ©gration continue</text:a> ou au serveur d&#8217;hÃ©bergement.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process.env"  text:visited-style-name="Visited_20_Internet_20_Link">variables d&#8217;environnement</text:a>
sont Ã  privilÃ©gier pour configurer nos applications avec souplesse.
Elles s&#8217;appliquent aux&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="T7">URL</text:span> d&#8217;accÃ¨s aux bases de donnÃ©es, Ã  des API distantes&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="T7">clÃ©s d&#8217;API</text:span> pour utiliser des services externes&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="T7">rÃ©glages</text:span> influenÃ§ant le comportement de l&#8217;application&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="T7">chemins d&#8217;accÃ¨s</text:span> vers des fichiers ou rÃ©pertoires (stockage, cache)&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="T7">environnements d&#8217;exÃ©cution</text:span> (dÃ©veloppement, test, production).</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;accÃ¨s Ã  une base de donnÃ©es est un parfait exemple.
Les nom d&#8217;utilisateur, mot de passe et adresse du serveur
peuvent d&#8217;ailleurs se combiner en une seule variable composÃ©e sous forme&#160;d&#8217;URL.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Par exemple, si vous avez connaissance des identifiants et de l&#8217;adresse d&#8217;une
base de donnÃ©es MySQL ou MariaDB, composez l&#8217;URL de configuration comme suit&#160;:</text:p>
<text:p text:style-name="Code">$ MYSQL_URL=mysql://user:password@server/database \</text:p><text:p text:style-name="Code"><text:s text:c="2"/>node sql-connect.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">sql-connect.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const mysql = require('mysql2/promise');</text:p><text:p text:style-name="Code">const url = process.env.MYSQL_URL;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">mysql.createConnection(url).then((connection) =&gt; {<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log('Connexion rÃ©ussie :-)');<text:s text:c="13"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>connection.end();<text:s text:c="33"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Connexion Ã  la base de donnÃ©es en utilisant la variable d&#8217;environnement <text:span text:style-name="CodeDansTexte">MYSQL_URL</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">Connexion rÃ©ussie&#160;:-)</text:span> en cas de succÃ¨s de connexion Ã  la base de donnÃ©es.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> ClÃ´ture de la connexion&#160;â€“ sinon, le script ne se terminerait pas sans avoir recours Ã &#160;<text:span text:style-name="Menu">[Ctrl+C]</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le script d&#8217;exemple devrait avoir affichÃ© la liste des tables contenues
dans cette base de donnÃ©es ou un message d&#8217;erreur le cas Ã©chÃ©ant.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La documentation du <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-modules"  text:visited-style-name="Visited_20_Internet_20_Link">module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span></text:a>
<text:span text:style-name="T4">mysql2</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://npmjs.com/mysql2" text:visited-style-name="Visited_20_Internet_20_Link">http://npmjs.com/mysql2</text:a></text:span>) dÃ©taille les diffÃ©rentes fonctions
utilisables pour interagir avec les bases de donnÃ©es compatibles.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Raccourci</text:span> CrÃ©er une base de donnÃ©es MySQL avec Docker</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
undefined
Docker est un outil utile pour crÃ©er une base de donnÃ©es en
une ligne de commande et ce, sans avoir Ã  installer MySQL sur notre ordinateur.</text:p>
<text:p text:style-name="RemarqueCode">$ docker run -ti --rm -e MYSQL_ROOT_PASSWORD=demo \</text:p><text:p text:style-name="RemarqueCode"><text:s text:c="2"/>-p 3306:3306 mysql:5</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Vous pourrez ainsi utiliser l&#8217;URL <text:span text:style-name="CodeDansTexte">mysql://root:demo@localhost/mysql</text:span>
comme variable d&#8217;environnement <text:span text:style-name="CodeDansTexte">MYSQL_URL</text:span> avec
le script d&#8217;exemple <text:span text:style-name="CodeDansTexte">sql-connect.js</text:span></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Certaines variables d&#8217;environnement sont tellement spÃ©cifiques Ã  chaque usage
qu&#8217;elles doivent Ãªtre obligatoirement configurÃ©es&#160;â€“ identifiants, URL de la
base de donnÃ©es, etc.
Je trouve pratique de proposer une valeur par dÃ©faut pour les autres&#160;â€“ le port
de l&#8217;application ou d&#8217;autres Ã©lÃ©ments plus <text:span text:style-name="">esthÃ©tiques</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Enfin, j&#8217;ai aussi pris l&#8217;habitude de documenter les variables d&#8217;environnement
dans le fichier <text:span text:style-name="CodeDansTexte">README.md</text:span> Ã  la racine de chaque projet.
Nous pouvons ainsi avoir une vue d&#8217;ensemble de la complexitÃ© de configuration
en un rapide coup d&#8217;Å“il&#160;â€“ et cela nous Ã©vite de fouiller dans le code applicatif.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Optimisation</text:span> NODE_ENV=production</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
Certains <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-modules"  text:visited-style-name="Visited_20_Internet_20_Link">modules&#160;<text:span text:style-name="CodeDansTexte">npm</text:span></text:a> comme <text:span text:style-name="T4">Express</text:span>
(<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/express" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/express</text:a></text:span>) lisent la valeur de <text:span text:style-name="CodeDansTexte">process.env.NODE_ENV</text:span>.
Ils s&#8217;en servent pour procÃ©der Ã  des optimisations et masquer des informations
sensibles dans un contexte de production
â€“ l&#8217;environnement qui fait face Ã  nos utilisateurs.</text:p>
<text:p text:style-name="RemarqueCode">$ NODE_ENV=production node app.js</text:p>
<text:bookmark text:name="ref-data-persistence" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Faire persister les fichiers en dehors de notre application</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les fichiers Ã©crits par notre application devraient Ãªtre sauvegardÃ©s en dehors
de son arborescence de fichiers.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Prenons cet exemple d&#8217;arborescence&#160;:</text:p>
<text:p text:style-name="Code">â””â”€â”€ app</text:p><text:p text:style-name="Code"><text:s text:c="4"/>â”œâ”€â”€ images</text:p><text:p text:style-name="Code"><text:s text:c="4"/>â””â”€â”€ uploads</text:p><text:p text:style-name="Code"><text:s text:c="8"/>â””â”€â”€ images</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les images sont stockÃ©es Ã  deux endroits&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="CodeDansTexte">app/images</text:span>&#160;: images statiques affichÃ©es par notre application web&#160;â€“ on les versionne avec&#160;Git&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="CodeDansTexte">app/uploads/images</text:span>&#160;: fichiers enregistrÃ©s sur le disque par l&#8217;intermÃ©diaire
de notre application&#160;â€“ on ne les versionne pas avec&#160;Git.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un inconvÃ©nient se prÃ©sente Ã  nous&#160;: tout est perdu si nous supprimons
le rÃ©pertoire <text:span text:style-name="CodeDansTexte">app</text:span> pour rÃ©installer l&#8217;application de zÃ©ro.
Je conseille donc d'<text:span text:style-name="T7">Ã©crire tout nouveau fichier dans un rÃ©pertoire indÃ©pendant</text:span>.
L&#8217;arborescence se transformerait comme suit&#160;:</text:p>
<text:p text:style-name="Code">â”œâ”€â”€ app</text:p><text:p text:style-name="Code">â”‚<text:s text:c="3"/>â””â”€â”€ images</text:p><text:p text:style-name="Code">â””â”€â”€ uploads</text:p><text:p text:style-name="Code"><text:s text:c="4"/>â””â”€â”€ images</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Rappel</text:span> Configurer le chemin avec une variable d&#8217;environnement</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Le chemin d&#8217;accÃ¨s devient flexible dÃ¨s lors que nous le rendons configurable
avec une variable d&#8217;environnement.</text:p>
<text:p text:style-name="RemarqueCode">$ UPLOAD_DIR=/uploads npm start</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette prÃ©caution s&#8217;avÃ¨re encore plus utile
dÃ¨s lors que nous utilisons une <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-hosting.paas"  text:visited-style-name="Visited_20_Internet_20_Link">plate-forme de services</text:a>
ou lorsque nous dÃ©marrons une nouvelle <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-hosting.cloud"  text:visited-style-name="Visited_20_Internet_20_Link">machine virtuelle</text:a>.
undefined
undefined
<text:span text:style-name="T7">Chaque nouveau dÃ©ploiement remet le systÃ¨me de fichiers Ã &#160;zÃ©ro</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Une solution complÃ©mentaire s&#8217;offre Ã  nous lorsqu&#8217;il devient compliquÃ©
de partager un mÃªme stockage de fichiers entre plusieurs machines ou&#160;VM&#160;:
c&#8217;est le <text:span text:style-name="T7">stockage d&#8217;objets</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le stockage d&#8217;objets est une solution de stockage Ã©lastique oÃ¹ la facturation
est basÃ©e sur la quantitÃ© des donnÃ©es stockÃ©es et tÃ©lÃ©chargÃ©es.
Nous accÃ©dons aux ressources stockÃ©es et Ã  leur contenu avec des requÃªtes HTTP.
Les fichiers sont ainsi disponibles Ã  tout moment, sans limite et
pour tous nos contextes applicatifs.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Histoire</text:span> Amazon&#160;S3</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
undefined
Amazon S3 est le premier service Ã  avoir rendu populaire le stockage d&#8217;objets
en 2006.
C&#8217;Ã©tait la premiÃ¨re fois que nous pouvions stocker des fichiers de maniÃ¨re infinie,
sans limitation de taille.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Son interface d&#8217;accÃ¨s est mÃªme devenue un standard <text:span text:style-name="T4">de&#160;facto</text:span>&#160;: il est
utilisÃ© par la plupart des concurrents afin de pouvoir passer d&#8217;un fournisseur
Ã  un autre sans avoir Ã  changer grand-chose Ã  ses applications.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TableauTitre">Tableau 15. Services de stockage d&#8217;objets compatibles avec l&#8217;API Amazon&#160;S3</text:p><table:table table:style-name="Tableau1"><table:table-column />,<table:table-column />,<table:table-column /><table:table-row><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Service</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Emplacement(s) du stockage</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Tarif mensuel</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://aws.amazon.com/s3/" text:visited-style-name="Visited_20_Internet_20_Link">https://aws.amazon.com/s3/</text:a></text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Paris, Europe, Monde</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>0,024&#160;$/Go</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://ovh.com/fr/public-cloud/storage/" text:visited-style-name="Visited_20_Internet_20_Link">https://ovh.com/fr/public-cloud/storage/</text:a></text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>France</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>0,01&#160;â‚¬/Go</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://cloud.google.com/storage/" text:visited-style-name="Visited_20_Internet_20_Link">https://cloud.google.com/storage/</text:a></text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Europe, Monde</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>0,026&#160;$/Go</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://minio.io" text:visited-style-name="Visited_20_Internet_20_Link">https://minio.io</text:a></text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Flexible</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>-</text:p></table:table-cell></table:table-row></table:table>
<text:bookmark text:name="ref-database-migration" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Versionner les schÃ©mas de base de donnÃ©es</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le contenu et la structure d&#8217;une application risquent de changer selon qu&#8217;elle tourne
sur notre ordinateur ou sur notre hÃ©bergement.
Nous pourrions reporter les changements de structure Ã  la main mais c&#8217;est
source d&#8217;erreurs&#160;: difficile Ã  reproduire et difficile Ã  intÃ©grer dans le
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy"  text:visited-style-name="Visited_20_Internet_20_Link">processus de dÃ©ploiement</text:a>.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;idÃ©al est de synchroniser la structure de nos bases de donnÃ©es.
Ou plutÃ´t, l&#8217;idÃ©al est de <text:span text:style-name="T7">reproduire les changements de structure</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exemple suivant illustre la crÃ©ation d&#8217;un nouveau champ.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">db-migration-step.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">module.exports = {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>up (database) {<text:s text:c="34"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>return database.addColumn('fromages', 'aoc', { <text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="6"/>type: 'boolean',<text:s text:c="29"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="6"/>defaultValue: false,</text:p><text:p text:style-name="Code"><text:s text:c="4"/>});</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">}</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Fonction exÃ©cutÃ©e lors de la migration.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Nous ajoutons un champ <text:span text:style-name="CodeDansTexte">aoc</text:span> dans la table <text:span text:style-name="CodeDansTexte">fromages</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Ce champ est de type <text:span text:style-name="T4">boolÃ©en</text:span> avec <text:span text:style-name="CodeDansTexte">false</text:span> comme valeur par dÃ©faut.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce fichier reprÃ©sente une <text:span text:style-name="T4">Ã©tape de migration</text:span>.
L&#8217;idÃ©e est de crÃ©er une nouvelle Ã©tape pour chaque changement de structure
et de les jouer au prochain dÃ©ploiement.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cet exemple de migration se base sur le module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> <text:span text:style-name="T4">db-migrate</text:span>
(<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/db-migrate" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/db-migrate</text:a></text:span>).
Il se connecte Ã  la base de donnÃ©es de notre choix, charge la liste des
migrations et exÃ©cute celles qui n&#8217;ont pas encore Ã©tÃ© jouÃ©es.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les migrations ne s&#8217;utilisent pas que pour changer la structure de la base de donnÃ©es,
mais aussi pour <text:span text:style-name="T7">la crÃ©er</text:span>&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">db-migration-init.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">module.exports = {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>up (database) {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>return database.createTable('fromages', { <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="6"/>columns: {</text:p><text:p text:style-name="Code"><text:s text:c="8"/>id: {<text:s text:c="33"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="10"/>type: 'int',</text:p><text:p text:style-name="Code"><text:s text:c="10"/>primaryKey: true,</text:p><text:p text:style-name="Code"><text:s text:c="10"/>autoIncrement: true</text:p><text:p text:style-name="Code"><text:s text:c="8"/>},</text:p><text:p text:style-name="Code"><text:s text:c="8"/>name: {<text:s text:c="31"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="10"/>type: 'string'</text:p><text:p text:style-name="Code"><text:s text:c="8"/>}</text:p><text:p text:style-name="Code"><text:s text:c="6"/>}</text:p><text:p text:style-name="Code"><text:s text:c="4"/>});</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">}</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> CrÃ©ation d&#8217;une nouvelle table <text:span text:style-name="CodeDansTexte">fromages</text:span> avec deux colonnes.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> La premiÃ¨re colonne se nomme <text:span text:style-name="CodeDansTexte">id</text:span>&#160;â€“ elle est numÃ©rique et s&#8217;auto-incrÃ©mente Ã  chaque nouvel enregistrement.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> La seconde colonne se nomme <text:span text:style-name="CodeDansTexte">name</text:span>&#160;â€“ c&#8217;est une chaÃ®ne de caractÃ¨res.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Si nous mettons ces deux exemples bout Ã  bout, nous sommes alors en mesure
de crÃ©er une table puis d&#8217;y appliquer un changement en ajoutant une nouvelle
colonne.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ainsi, nous sommes en mesure de rÃ©pliquer les changements de structures sur d&#8217;autres ordinateurs
et <text:span text:style-name="T7">reproduire l&#8217;Ã©volution du schÃ©ma de la base de donnÃ©es en partant de zÃ©ro</text:span>.
Nous avons rejouÃ© toutes les migrations sur notre outil d&#8217;intÃ©gration
continue pour nous assurer de leur robustesse et revenir en arriÃ¨re si nÃ©cessaire.</text:p>
<text:bookmark text:name="ref-startup" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">DÃ©marrer automatiquement une application</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Jusqu&#8217;Ã  prÃ©sent, nous avons dÃ©marrÃ© les scripts de cet ouvrage
avec l&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">node</text:span> ou avec la commande <text:span text:style-name="CodeDansTexte">npm start</text:span>.
C&#8217;est un processus manuel qui nÃ©cessite de conserver un onglet ouvert
dans notre terminal pour maintenir l&#8217;application en fonctionnement.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette section explore des mÃ©canismes pour <text:span text:style-name="T7">dÃ©tacher le processus du terminal</text:span>
et pour <text:span text:style-name="T7">lancer l&#8217;application au dÃ©marrage ou redÃ©marrage d&#8217;un ordinateur</text:span>.</text:p>
<text:bookmark text:name="ref-lhÃ©bergeur_sen_occupe_Ã _notre_place" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">L&#8217;hÃ©bergeur s&#8217;en occupe Ã  notre place</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-hosting.paas"  text:visited-style-name="Visited_20_Internet_20_Link">plates-formes de service</text:a> automatisent le dÃ©marrage de
l&#8217;application.
Elles exÃ©cutent la <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-start"  text:visited-style-name="Visited_20_Internet_20_Link">commande <text:span text:style-name="CodeDansTexte">npm start</text:span></text:a>
dÃ¨s que le dÃ©ploiement est terminÃ©.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">C&#8217;est tout.</text:p>
<text:bookmark text:name="ref-process-manager" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Avec un gestionnaire de processus</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un gestionnaire de processus a deux utilitÃ©s&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="T7">dÃ©tacher un processus</text:span> de notre terminal&#160;â€“ si on le ferme, l&#8217;application tourne toujours&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="T7">gÃ©rer plusieurs processus par application</text:span>&#160;â€“ un frontal web et l&#8217;admin par exemple.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">pm2</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://pm2.keymetrics.io" text:visited-style-name="Visited_20_Internet_20_Link">https://pm2.keymetrics.io</text:a></text:span>) est un gestionnaire de processus
disponible en tant que <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-modules"  text:visited-style-name="Visited_20_Internet_20_Link">module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span></text:a>
(<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/pm2" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/pm2</text:a></text:span>).
undefined
Il fonctionne sous Linux, Windows et macOS.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La commande suivante dÃ©marre un script et le place aussitÃ´t en tÃ¢che de fond&#160;:</text:p>
<text:p text:style-name="Code">$ pm2 start app.js</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-06/images/pm2-start.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>6-undefined.</text:span> Exemple de dÃ©marrage et d&#8217;affichage de l&#8217;Ã©tat d&#8217;une application Node avec pm2</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette mÃªme application s&#8217;arrÃªte avec la commande <text:span text:style-name="CodeDansTexte">pm2 stop</text:span> et
se relance pour prendre en compte des changements de code avec <text:span text:style-name="CodeDansTexte">pm2 restart</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les gestionnaires de processus facilitent l&#8217;intÃ©gration
d&#8217;une application en tant que <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-system-service"  text:visited-style-name="Visited_20_Internet_20_Link">service systÃ¨me</text:a>
(section suivante).
C&#8217;est mon choix de prÃ©dilection pour ne pas avoir Ã  apprendre un nouveau
fichier de configuration.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La commande suivante nous guide dans la configuration de notre systÃ¨me
d&#8217;exploitation&#160;:</text:p>
<text:p text:style-name="Code">$ pm2 startup</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Celle-ci sauvegarde les applications dÃ©marrÃ©es avec le gestionnaire de processus.
Elles seront restaurÃ©es au prochain redÃ©marrage de l&#8217;ordinateur&#160;:</text:p>
<text:p text:style-name="Code">$ pm2 save</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">On peut aussi revenir en arriÃ¨re et dÃ©cider de dÃ©sactiver le dÃ©marrage
automatique de nos applications&#160;:</text:p>
<text:p text:style-name="Code">$ pm2 unstartup</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Windows</text:span> Configurer&#160;pm2</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">La commande <text:span text:style-name="CodeDansTexte">pm2 startup</text:span> pose problÃ¨me sous Windows.
Je recommande d&#8217;utiliser le module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> <text:span text:style-name="T4">pm2-windows-service</text:span>
(<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://www.npmjs.com/package/pm2-windows-service" text:visited-style-name="Visited_20_Internet_20_Link">https://www.npmjs.com/package/pm2-windows-service</text:a></text:span>) pour simplifier
cette procÃ©dure.</text:p>
<text:bookmark text:name="ref-system-service" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">En crÃ©ant un service systÃ¨me</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Tous les systÃ¨mes d&#8217;exploitation ont un mÃ©canisme pour
dÃ©marrer des applications en fonction de certains critÃ¨res&#160;:
quand le rÃ©seau ou une connexion Internet est disponible,
lorsqu&#8217;une session utilisateur s&#8217;est ouverte
ou mÃªme quand un autre logiciel est actif.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Systemd, Upstart et launchd sont des gestionnaires de services systÃ¨me parmi d&#8217;autres.
Ils se configurent avec des fichiers Ã©crits dans des formats diffÃ©rents.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Voici un exemple de fichier de configuration pour <text:span text:style-name="T4">systemd</text:span>
(<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://doc.ubuntu-fr.org/systemd" text:visited-style-name="Visited_20_Internet_20_Link">https://doc.ubuntu-fr.org/systemd</text:a></text:span>).
C&#8217;est le gestionnaire de services des distributions Linux Ubuntu, Debian, Fedora et CentOS.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">systemd/nodebook.d/app.conf</text:p><text:p text:style-name="Code">[Unit]</text:p><text:p text:style-name="Code">Description="Application Node.js"</text:p><text:p text:style-name="Code">After=NetworkManager.service<text:s text:c="12"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">[Service]</text:p><text:p text:style-name="Code">Restart=on-failure<text:s text:c="22"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">DefaultStartLimitBurst=5</text:p><text:p text:style-name="Code">StartLimitIntervalSec=120</text:p><text:p text:style-name="Code">User=nobody<text:s text:c="29"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">Environment="NODE_ENV=production"</text:p><text:p text:style-name="Code">WorkingDirectory=/usr/local/node-app<text:s text:c="4"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code">ExecStart=/usr/bin/npm start<text:s text:c="12"/><text:span text:style-name="PuceCode">5</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> L&#8217;application dÃ©marrera dÃ¨s que l&#8217;interface rÃ©seau sera opÃ©rationnelle.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> L&#8217;application sera relancÃ©e en cas de plantage&#160;â€“ maximum 5 fois dans un dÃ©lai de 120 secondes.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Le processus sera dÃ©marrÃ© au nom de l&#8217;utilisateur systÃ¨me <text:span text:style-name="CodeDansTexte">nobody</text:span>.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> C&#8217;est comme si nous nous placions dans <text:span text:style-name="CodeDansTexte">/usr/local/node-app</text:span> avant de lancer l&#8217;application&#160;â€“ c&#8217;est la valeur qu&#8217;on retrouve avec <text:span text:style-name="CodeDansTexte">process.cwd()</text:span>.<text:line-break/><text:span text:style-name="PuceCode">5</text:span> Commande Ã  exÃ©cuter pour dÃ©marrer l&#8217;application.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le service associÃ© au fichier de configuration prÃ©cÃ©dent peut Ãªtre dÃ©marrÃ©
manuellement comme suit&#160;:</text:p>
<text:p text:style-name="Code"># Cf. /etc/systemd/<text:span text:style-name="CodeExergue">nodebook</text:span>.d/app.conf</text:p><text:p text:style-name="Code">$ sudo systemctl start <text:span text:style-name="CodeExergue">nodebook</text:span>.service</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les commandes <text:span text:style-name="CodeDansTexte">systemctl stop</text:span> et <text:span text:style-name="CodeDansTexte">systemctl restart</text:span>
arrÃªtent et relancent un service.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans tous les cas, le service sera lancÃ© automatiquement au prochain
dÃ©marrage du systÃ¨me d&#8217;exploitation.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Alternative</text:span> Et&#160;pour Windows ?</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Le gestionnaire de services Windows est compliquÃ© Ã  utiliser.
Je recommande le module npm <text:span text:style-name="T4">node-windows</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/node-windows" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/node-windows</text:a></text:span>).</text:p>
<text:bookmark text:name="ref-application-manager" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Avec un serveur d&#8217;applications&#160;web</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un serveur d&#8217;applications web est un logiciel informatique
qui a deux objectifs&#160;: <text:span text:style-name="T7">Ãªtre toujours disponible</text:span>
et <text:span text:style-name="T7">rÃ©partir le trafic HTTP</text:span> vers des fichiers et des applications web.
C&#8217;est une sorte de parapluie optimisÃ© et rÃ©sistant qui se met au-devant
de nos applications.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Question</text:span> Pourquoi utiliser un serveur d&#8217;applications ?</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Les serveurs d&#8217;applications sont excellents pour gÃ©rer la charge des requÃªtes,
se protÃ©ger de failles de sÃ©curitÃ© HTTP et Ãªtre performants dans le
traitement des fichiers statiques.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Leur capacitÃ© Ã  redÃ©marrer une application Node en cas de plantage ou de
nouveau dÃ©ploiement nous enlÃ¨ve une Ã©pine du pied.
Certains ont mÃªme des facultÃ©s de <text:span text:style-name="T4">rÃ©partition de charge</text:span> (<text:span text:style-name="T4">load balancing</text:span>)&#160;:
plusieurs instances de la mÃªme application tournent alors en parallÃ¨le
â€“ une par CPU.
Le trafic est rÃ©parti vers l&#8217;instance qui a le plus de CPU disponible.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T7">Phusion Passenger</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://phusionpassenger.com/" text:visited-style-name="Visited_20_Internet_20_Link">https://phusionpassenger.com/</text:a></text:span>) est un
serveur d&#8217;applications web open source, lÃ©ger et performant.
undefined
Il est compatible avec des applications Ruby, Node et Python.
Il s&#8217;installe de maniÃ¨re autonome ou en complÃ©ment des serveurs nginx
(<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://nginx.org" text:visited-style-name="Visited_20_Internet_20_Link">https://nginx.org</text:a></text:span>) et Apache&#160;httpd (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://httpd.apache.org" text:visited-style-name="Visited_20_Internet_20_Link">https://httpd.apache.org</text:a></text:span>).
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Regardons ensemble Ã  quoi ressemble un fichier de configuration nginx
minimaliste&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">nginx/static.conf</text:p><text:p text:style-name="Code">server {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>listen 80 default_server;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>server_name _;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>root /var/www;<text:s text:c="7"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">}</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> RÃ©pertoire racine oÃ¹ nginx va chercher les fichiers.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Si nginx est lancÃ© sur notre ordinateur avec ce fichier de configuration
et si le fichier <text:span text:style-name="CodeDansTexte">image.jpg</text:span> est placÃ© dans le rÃ©pertoire <text:span text:style-name="CodeDansTexte">/var/www</text:span>,
alors nous pourrons y accÃ©der dans un navigateur web
sur <text:span text:style-name="CodeDansTexte"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://localhost/image.jpg" text:visited-style-name="Visited_20_Internet_20_Link">http://localhost/image.jpg</text:a></text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Transformons maintenant ce fichier de configuration
aprÃ¨s avoir installÃ© le module <text:span text:style-name="T4">Phusion Passenger</text:span> pour <text:span text:style-name="T4">nginx</text:span>
(<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://phusionpassenger.com/library/install/nginx/" text:visited-style-name="Visited_20_Internet_20_Link">https://phusionpassenger.com/library/install/nginx/</text:a></text:span>)&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">nginx/phusionwebapp.conf</text:p><text:p text:style-name="Code">server {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>listen 80 default_server;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>server_name _;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>root /var/www;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>passenger_enabled on;<text:s text:c="29"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>passenger_app_type node;<text:s text:c="26"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>passenger_app_root /var/apps/my-app;<text:s text:c="14"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>passenger_startup_file app.js;<text:s text:c="20"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>passenger_document_root /var/apps/my-app/public;<text:s text:c="2"/><text:span text:style-name="PuceCode">5</text:span></text:p><text:p text:style-name="Code">}</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Activation du module <text:span text:style-name="T4">Phusion Passenger</text:span> pour <text:span text:style-name="T4">nginx</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Nous indiquons Ã  <text:span text:style-name="T4">Phusion Passenger</text:span> qu&#8217;il s&#8217;agit d&#8217;une application Node.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> L&#8217;application se trouve dans le rÃ©pertoire <text:span text:style-name="CodeDansTexte">/var/apps/my-app</text:span>.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Le script Ã  dÃ©marrer est <text:span text:style-name="CodeDansTexte">app.js</text:span>&#160;â€“ c&#8217;est-Ã -dire <text:span text:style-name="CodeDansTexte">/var/apps/my-app/app.js</text:span>.<text:line-break/><text:span text:style-name="PuceCode">5</text:span> Emplacement oÃ¹ <text:span text:style-name="T4">Phusion Passenger</text:span> ira chercher les fichiers statiques.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">Phusion Passenger</text:span> dÃ©marre l&#8217;application Node pour nous.
Il la maintient en vie en cas de plantage.
Son comportement se configure finement Ã  l&#8217;aide de directives dont la liste
intÃ©grale se trouve sur
<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://phusionpassenger.com/library/config/nginx/reference/" text:visited-style-name="Visited_20_Internet_20_Link">http://phusionpassenger.com/library/config/nginx/reference/</text:a></text:span>.</text:p>
<text:bookmark text:name="ref-monitoring" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Ã€ quoi penser aprÃ¨s la mise en ligne ?</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">De la programmation au dÃ©ploiement, nous sommes toujours en mesure
de savoir quand quelque chose ne va pas&#160;: les <text:span text:style-name="T7">erreurs se produisent sous nos&#160;yeux</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les problÃ¨mes commencent Ã  <text:span text:style-name="T7">Ã©chapper Ã  notre attention dÃ¨s la mise en ligne</text:span>.
Regardons ensemble ce que nous pouvons faire pour intervenir au bon moment.</text:p>
<text:bookmark text:name="ref-uptime" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">L&#8217;application a plantÃ©</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Que se passe-t-il lorsqu&#8217;une application plante en plein milieu du week-end&#160;?
<text:span text:style-name="T4">Rien</text:span>.
Nous n&#8217;en savons rien tant que nous n&#8217;allons pas sur l&#8217;application en question.
L&#8217;action la plus simple Ã  mettre en Å“uvre est de <text:span text:style-name="T7">recevoir une alerte</text:span>
par courriel ou par&#160;SMS.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">Pingdom</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://www.pingdom.com/free" text:visited-style-name="Visited_20_Internet_20_Link">https://www.pingdom.com/free</text:a></text:span>) rÃ©pond exactement Ã  ce besoin.
Il est gratuit pour un site web et payant au-delÃ .</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-06/images/pingdom-uptime.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>6-undefined.</text:span> Ã‰cran de configuration des alertes de sites web avec Pingdom.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">Uptime Robot</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://uptimerobot.com" text:visited-style-name="Visited_20_Internet_20_Link">https://uptimerobot.com</text:a></text:span>) est un service similaire.
Il offre en plus un flux RSS d&#8217;alertes et une intÃ©gration avec Slack.</text:p>
<text:bookmark text:name="ref-exceptions" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">S&#8217;informer des erreurs applicatives</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Lorsque nous prenons connaissance d&#8217;un plantage applicatif, comment dÃ©terminer
ce qui l&#8217;a causÃ©&#160;?</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-06/images/heroku-app-error.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>6-undefined.</text:span> Ã‰cran affichÃ© par Heroku lorsque l&#8217;application a plantÃ© et ne rÃ©pond&#160;plus.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">S&#8217;il s&#8217;agit d&#8217;une application personnelle ou sans enjeu,
nous pouvons nous contenter de reproduire le problÃ¨me localement.
Dans le cas d&#8217;une application professionnelle,
nous aurons besoin de plus de prÃ©cisions, rapidement.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">Sentry</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://sentry.io" text:visited-style-name="Visited_20_Internet_20_Link">https://sentry.io</text:a></text:span>) est un service en ligne qui s&#8217;intÃ¨gre
dans notre code comme une sonde.
Une fois placÃ©e, la sonde transmet les erreurs vers la plate-forme <text:span text:style-name="T4">Sentry</text:span>.
Cette derniÃ¨re affiche les erreurs connues sous forme de tableau de bord&#160;â€“
leur nature, combien de fois elles se rÃ©pÃ¨tent.
Elle nous envoie Ã©galement une notification par courriel avec une indication
de sÃ©vÃ©ritÃ©, pour que nous puissions rÃ©agir plus ou moins rapidement.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-06/images/sentry-error.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>6-undefined.</text:span> Ã‰cran d&#8217;affichage d&#8217;une erreur analysÃ©e par&#160;Sentry.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;inclusion d&#8217;une sonde basique revient Ã  insÃ©rer deux lignes dans notre code&#160;:
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">sentry.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const sentry = require('raven');<text:s text:c="18"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">sentry.config(process.env.SENTRY_DSN).install();<text:s text:c="2"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const express = require('express');</text:p><text:p text:style-name="Code">const app = express();</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">test;<text:s text:c="45"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">app.get('/', (request, response) =&gt; response.send('OK!'));</text:p><text:p text:style-name="Code">app.listen(process.env.PORT || 4000);</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> <text:span text:style-name="T4">raven</text:span> est le nom du module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> Ã©ditÃ© par <text:span text:style-name="T4">Sentry</text:span> pour collecter les erreurs.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Configuration du client <text:span text:style-name="T4">Sentry</text:span>&#160;â€“ il collectera et enverra les erreurs auprÃ¨s de la plate-forme.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Cette ligne est la source de notre erreur&#160;â€“ la variable n&#8217;est pas dÃ©finie.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">Sentry</text:span> nous communique une clÃ© d&#8217;API pour chaque projet Ã  instrumenter.
Quand vous obtenez la vÃ´tre, modifiez la ligne de commande suivante afin
de provoquer l&#8217;erreur, de recevoir le courriel d&#8217;alerte et de la visualiser
en dÃ©tail sur le tableau de bord&#160;:
undefined</text:p>
<text:p text:style-name="Code">$ SENTRY_DSN=https://0c...@sentry.io/1201870 node sentry.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> Configurer Sentry</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Un guide complet (en anglais) documente comment aller plus loin
dans l&#8217;utilisation de <text:span text:style-name="T4">Sentry</text:span>&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://docs.sentry.io/clients/node/" text:visited-style-name="Visited_20_Internet_20_Link">https://docs.sentry.io/clients/node/</text:a></text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le service <text:span text:style-name="T4">New&#160;Relic</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://newrelic.com/nodejs" text:visited-style-name="Visited_20_Internet_20_Link">https://newrelic.com/nodejs</text:a></text:span>)
est une alternative Ã  <text:span text:style-name="T4">Sentry</text:span>.
Il mesure Ã©galement les performances et les sources de ralentissement.
Il s&#8217;installe gratuitement et en quelques clics sur la
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-hosting.paas"  text:visited-style-name="Visited_20_Internet_20_Link">plate-forme de services</text:a> Heroku.
Il devient payant Ã  partir d&#8217;un certain volume de requÃªtes.</text:p>
<text:bookmark text:name="ref-security.node" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Notre version de Node fait l&#8217;objet d&#8217;une faille de sÃ©curitÃ©</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Certaines versions de Node sortent pour apporter de nouvelles fonctionnalitÃ©s
ou pour corriger des bogues.
D&#8217;autres sont publiÃ©es pour corriger des failles de sÃ©curitÃ©.
Ces <text:span text:style-name="T7">failles sont critiques pour nos applications</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Lorsqu&#8217;une faille est exploitÃ©e, la personne Ã  l&#8217;origine de l&#8217;attaque
peut ralentir, faire planter ou extraire des informations confidentielles
de notre application.
En cas de faille critique, l&#8217;attaquantÂ·e risque aussi de gagner un accÃ¨s
Ã  l&#8217;ordinateur et aux bases de donnÃ©es hÃ©bergeant l&#8217;application.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Solution&#160;: <text:span text:style-name="T7">redÃ©ployer nos applications</text:span> avec une version de Node plus rÃ©cente.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Je vous encourage Ã  recevoir des alertes par courriel ou en
vous abonnant au fil&#160;RSS pour Ãªtre prevenuÂ·e au bon moment.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7">Courriel</text:h><text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://groups.google.com/group/nodejs-sec" text:visited-style-name="Visited_20_Internet_20_Link">https://groups.google.com/group/nodejs-sec</text:a></text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7">Fil&#160;RSS</text:h><text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://nodejs.org/en/feed/vulnerability.xml" text:visited-style-name="Visited_20_Internet_20_Link">https://nodejs.org/en/feed/vulnerability.xml</text:a></text:span></text:p>
</text:list-item></text:list>
<text:p text:style-name="RemarqueFigureNumero">(chapter-06/images/node-security-bulletin.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>6-undefined.</text:span> Exemple d&#8217;alerte de sÃ©curitÃ© envoyÃ©e par courriel</text:p>
<text:bookmark text:name="ref-security.npm" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Un des modules&#160;npm fait l&#8217;objet d&#8217;une faille de sÃ©curitÃ©</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les modules&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> aussi risquent d&#8217;Ãªtre affectÃ©s par des failles de sÃ©curitÃ©.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les consÃ©quences de leur exploitation sont similaires Ã  celles des failles de Node&#160;:
les personnes Ã  l&#8217;origine des attaques peuvent saturer le serveur et
paralyser l&#8217;application.
Elles sont aussi en mesure de subtiliser des informations confidentielles
stockÃ©es en base de donnÃ©es ou saisies par les usagers.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">Snyk</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://snyk.io" text:visited-style-name="Visited_20_Internet_20_Link">https://snyk.io</text:a></text:span>) est un service de sÃ©curitÃ© gratuit pour les
projets open source.
Il scanne les vulnÃ©rabilitÃ©s de nos dÃ©pendances et sous-dÃ©pendances
Il nous alerte sur la sÃ©vÃ©ritÃ© des failles dÃ©celÃ©es dans nos projets.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ces failles sont classÃ©es en trois niveaux&#160;: dangereuses, modÃ©rÃ©es et superficielles.
Mieux vaut mettre Ã  jour les dÃ©pendances affectÃ©es par une faille dangereuse
le plus rapidement possible.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce n&#8217;est pas grave si nous ne mettons pas Ã  jour un vieux module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>.
En revanche, cela peut avoir un impact nÃ©gatif si cette vieille version est
affectÃ©e par une faille.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La capture d&#8217;Ã©cran suivante illustre une vulnÃ©rabilitÃ© dÃ©celÃ©e dans le
module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> <text:span text:style-name="T4">restify</text:span> dans sa version&#160;4.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-06/images/snyk-dashboard.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>6-undefined.</text:span> Tableau de bord des dÃ©pendances vulnÃ©rables avec&#160;Snyk</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-06/images/snyk-vulnerability.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>6-undefined.</text:span> Affichage d&#8217;une vulnÃ©rabilitÃ© et d&#8217;un chemin de rÃ©solution avec&#160;Snyk</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La correction du problÃ¨me implique de passer Ã  la version&#160;5.
Cette action nous demandera sÃ»rement d&#8217;adapter notre code car nous changeons
de version majeure.
Ces migrations sont souvent documentÃ©es par les auteurs des modules.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Pratique</text:span> IntÃ©grations&#160;npm, Heroku, etc.</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Snyk s&#8217;intÃ¨gre Ã  d&#8217;autres services que GitHub&#160;: GitLab, Heroku, BitBucket, etc.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Les applications au code source privÃ© peuvent Ãªtre vÃ©rifiÃ©es gratuitement
avec l&#8217;API de Snyk ou son application en ligne de commandes.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7">Base de donnÃ©es</text:h><text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://snyk.io/vuln/?type=npm" text:visited-style-name="Visited_20_Internet_20_Link">https://snyk.io/vuln/?type=npm</text:a></text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7">Fil&#160;RSS</text:h><text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://snyk.io/vuln/feed.xml?type=npm" text:visited-style-name="Visited_20_Internet_20_Link">https://snyk.io/vuln/feed.xml?type=npm</text:a></text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous avons parlÃ© de la commande <text:span text:style-name="CodeDansTexte">npm audit</text:span> dans
le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-audit"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;5</text:a>.
undefined
undefined
Elle dispose d&#8217;une option pour mettre Ã  jour automatiquement
les dÃ©pendances dangereuses&#160;: <text:span text:style-name="CodeDansTexte">npm audit fix</text:span>.</text:p>
<text:p text:style-name="Code">$ npm audit fix</text:p><text:p text:style-name="Code">&gt; fixed 20 of 21 vulnerabilities in 1867 scanned packages</text:p><text:p text:style-name="Code">&gt;<text:s text:c="3"/>1 vulnerability required manual review and could not be updated</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Rester Ã  l&#8217;Ã©coute des vulnÃ©rabilitÃ©s en combinaison de l&#8217;utilisation
de Snyk ou de <text:span text:style-name="CodeDansTexte">npm audit fix</text:span> suffit Ã  prendre des mesures de correction
efficaces sans avoir Ã  trop s&#8217;y connaÃ®tre.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La lecture des rapports de vulnÃ©rabilitÃ© est un bon moyen de comprendre
comment ces exploits fonctionnent et comment penser nos applications
pour Ã©viter d&#8217;exposer une surface d&#8217;attaque minimale.</text:p>
<text:bookmark text:name="ref-conclusion_6" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Conclusion</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous avons dÃ©sormais <text:span text:style-name="T7">toutes les clÃ©s pour partager notre code</text:span> et le
rÃ©sultat de son exÃ©cution de maniÃ¨re publique.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous avons appris Ã  <text:span text:style-name="T7">choisir un hÃ©bergement et un mode de dÃ©ploiement</text:span>
adaptÃ© Ã  notre temps disponible ainsi qu&#8217;Ã  nos envies.
Nous sommes en mesure d&#8217;aller vite ou de prendre le temps de configurer
une machine pour des besoins trÃ¨s prÃ©cis.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La <text:span text:style-name="T7">configuration d&#8217;une application</text:span> avec des variables d&#8217;environnement
est une des clÃ©s pour automatiser le dÃ©ploiement.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L'<text:span text:style-name="T7">automatisation du dÃ©marrage</text:span> d&#8217;une application demande d&#8217;investir du temps
pour Ãªtre Ã  l&#8217;aise.
Ce temps est utile car le principe s&#8217;applique Ã  d&#8217;autres langages
et ouvre la porte de la maÃ®trise de l&#8217;hÃ©bergement applicatif,
quand les <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-hosting.paas"  text:visited-style-name="Visited_20_Internet_20_Link">plates-formes de service</text:a> commencent Ã  nous
coÃ»ter trop&#160;cher.</text:p>
<text:bookmark text:name="ref-chapter-07" /><text:p text:style-name="ChapitreNumero">7</text:p><text:h text:style-name="ChapitreTitre" text:outline-level="1">CrÃ©er une application&#160;web</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous allons apprendre Ã  composer et Ã  tester une application web crÃ©Ã©e de toutes
piÃ¨ces ou avec l&#8217;aide du framework Express.</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">Composer son application web</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Organiser une application avec le framework Express</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Vers un code rÃ©utilisable et testable</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Pour aller plus loin</text:p>
</text:list-item></text:list>
<text:p text:style-name="ChapitreIntroduction"><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le modÃ¨le d&#8217;application web de Node se rapproche de celui de Ruby et diffÃ¨re
de l&#8217;univers PHP.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous allons mieux comprendre le mÃ©canisme de requÃªte et de rÃ©ponse HTTP en
crÃ©ant une application web module par module, fonctionnalitÃ© par fonctionnalitÃ©.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans un second temps, nous organiserons notre code avec le framework Express.
Nous verrons en quoi notre application gagne en clartÃ©, comment gÃ©nÃ©rer du HTML
de faÃ§on dynamique avec des informations issues d&#8217;une base de donnÃ©es.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous consoliderons notre savoir en organisant notre code de sorte Ã  le
rendre plus rÃ©silient et testable&#160;â€“ chose que nous apprendrons Ã  faire pas Ã  pas.</text:p></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Remarque</text:span> Versions de Node et npm</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Le contenu de ce chapitre utilise les versions <text:span text:style-name="T7">Node&#160;v10</text:span>
et <text:span text:style-name="T7">npm&#160;v6</text:span>.
Ce sont les versions stables recommandÃ©es en&#160;2019.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Une application web est une <text:span text:style-name="T7">construction applicative qui est Ã  l&#8217;Ã©coute</text:span>
de connexions rÃ©seau initiÃ©es par un client&#160;â€“ un navigateur, un automate, etc.
Elle est structurÃ©e autour de la lecture d&#8217;une requÃªte entrante (lecture)
et de l&#8217;Ã©mission d&#8217;une rÃ©ponse sortante (Ã©criture).
Chaque <text:span text:style-name="T7">requÃªte porte en elle une intention</text:span> (un chemin d&#8217;accÃ¨s, une prÃ©fÃ©rence
de format, des Ã©lÃ©ments d&#8217;identification) et implique une rÃ©ponse en retour
(des donnÃ©es et des Ã©lÃ©ments pour les contextualiser).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;ingÃ©nierie d&#8217;une application web consiste Ã  comprendre les requÃªtes entrantes
et Ã  construire une rÃ©ponse appropriÃ©e Ã  chaque fois, le plus rapidement possible.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce chapitre s&#8217;inscrit dans la continuitÃ© de la dÃ©couverte du
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-http"  text:visited-style-name="Visited_20_Internet_20_Link">module <text:span text:style-name="CodeDansTexte">http</text:span></text:a>
(<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-04"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;4</text:a>).
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> En-tÃªtes&#160;HTTP</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
undefined
undefined
Ce chapitre fait souvent rÃ©fÃ©rence Ã  des en-tÃªtes HTTP.
La documentation <text:span text:style-name="T4">MDN&#160;web&#160;docs</text:span>
les liste tous, avec le dÃ©tail de leurs valeurs possibles&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://developer.mozilla.org/fr/docs/Web/HTTP/Headers" text:visited-style-name="Visited_20_Internet_20_Link">https://developer.mozilla.org/fr/docs/Web/HTTP/Headers</text:a></text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">C&#8217;est un onglet intÃ©ressant Ã  ouvrir en parallÃ¨le de cette lecture
â€“ je l&#8217;ai ouvert en permanence pour Ã©crire ce chapitre.</text:p>
<text:bookmark text:name="ref-webapp" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Composer son application&#160;web</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans cette premiÃ¨re section, nous allons nous focaliser sur la construction
d&#8217;une application web avec une approche modulaire.
Nous partirons du concept de requÃªte et de rÃ©ponse.
Petit Ã  petit, nous allons greffer des modules pour comprendre et
donner du sens Ã  leurs contenus respectifs.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le <text:span text:style-name="T4">protocole HTTP</text:span> est le dialecte informatique utilisÃ© et compris pour exprimer
les requÃªtes (Ã©mises par un client) et les rÃ©ponses (Ã©mises par un serveur).
undefined
Les navigateurs web sont des clients tandis que notre application Node est un serveur.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le logiciel <text:span text:style-name="T4">curl</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://curl.haxx.se" text:visited-style-name="Visited_20_Internet_20_Link">https://curl.haxx.se</text:a></text:span>) est un client en ligne de commandes.
Il est souvent installÃ© par dÃ©faut sur les distributions Linux, sur macOS et
Ã  partir de Windows&#160;7&#160;â€“ via le terminal <text:span text:style-name="T4">PowerShell</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Utilisons <text:span text:style-name="T4">curl</text:span> pour observer le contenu d&#8217;une requÃªte et de sa rÃ©ponse.
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">Exemple de requÃªte HTTP vers le site <text:span text:style-name="URL">perdu.com</text:span></text:p><text:p text:style-name="Code">$ curl -v http://perdu.com<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">GET / HTTP/1.1<text:s text:c="14"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">Host: perdu.com<text:s text:c="13"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">User-Agent: curl/7.54.0</text:p><text:p text:style-name="Code">Accept: */*</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> ExÃ©cution de la requÃªte.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Expression de la mÃ©thode, du chemin d&#8217;accÃ¨s demandÃ© et du protocole de discussion employÃ©&#160;â€“ ici, HTTP dans sa version&#160;<text:span text:style-name="CodeDansTexte">1.1</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> En-tÃªte de requÃªte.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un en-tÃªte est exprimÃ© sous la forme <text:span text:style-name="CodeDansTexte">ClÃ©: Valeur</text:span>.
undefined
Chacun prÃ©cise un Ã©lÃ©ment de contexte.
Certains influencent plus que d&#8217;autres la rÃ©ponse du serveur, si
celui-ci les comprend.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Voyons maintenant la rÃ©ponse&#160;:
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">Exemple de rÃ©ponse HTTP transmise en retour</text:p><text:p text:style-name="Code">HTTP/1.1 200 OK<text:s text:c="39"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">Date: Thu, 28 Jun 2018 19:02:27 GMT<text:s text:c="19"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">Server: Apache</text:p><text:p text:style-name="Code">Last-Modified: Thu, 02 Jun 2016 06:01:08 GMT</text:p><text:p text:style-name="Code">ETag: "cc-5344555136fe9"</text:p><text:p text:style-name="Code">Accept-Ranges: bytes</text:p><text:p text:style-name="Code">Content-Length: 204</text:p><text:p text:style-name="Code">Vary: Accept-Encoding</text:p><text:p text:style-name="Code">Content-Type: text/html<text:s text:c="31"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">&amp;lt;html&gt;&amp;lt;head&gt;&amp;lt;title&gt;Vous Etes Perdu ?&amp;lt;/title&gt; â€¦&amp;lt;/html&gt; <text:span text:style-name="PuceCode">4</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Expression du statut de la rÃ©ponse avec un code numÃ©rique et une version intelligible.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> En-tÃªte de rÃ©ponse.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> En-tÃªte de rÃ©ponse&#160;â€“ celle-ci indique au client comment interprÃ©ter le corps du message.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Corps du message.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La rÃ©ponse dispose elle aussi d&#8217;en-tÃªtes.
Cette fois, ils guident le client dans son interprÃ©tation du rÃ©sultat.
Le corps du message est sÃ©parÃ© par une ligne vide.
C&#8217;est la partie visible de la rÃ©ponse dans un navigateur web, le contenu
qui s&#8217;affiche sous nos&#160;yeux.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans la prochaine section, nous visualiserons ces mÃªmes informations
Ã  partir d&#8217;un serveur HTTP que nous allons crÃ©er par nous-mÃªme.
Nous retracerons plus en dÃ©tail l&#8217;odyssÃ©e d&#8217;une requÃªte HTTP dans la section
<text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-http"  text:visited-style-name="Visited_20_Internet_20_Link">Comprendre le modÃ¨le HTTP</text:a></text:span>, en fin de chapitre.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Pratique</text:span> Jouer avec les exemples dans un terminal</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Les exemples titrÃ©s d&#8217;un nom de fichier peuvent Ãªtre installÃ©s sur votre ordinateur.
ExÃ©cutez-les dans un terminal et amusez-vous Ã  les modifier en parallÃ¨le de
votre lecture pour voir ce qui change.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Installation des exemples via le module npm <text:span text:style-name="CodeDansTexte">nodebook</text:span></text:p><text:p text:style-name="RemarqueCode">$ npm install --global nodebook</text:p><text:p text:style-name="RemarqueCode">$ nodebook install chapter-07</text:p><text:p text:style-name="RemarqueCode">$ cd $(nodebook dir chapter-07)</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">La commande suivante devrait afficher un rÃ©sultat qui confirme que vous Ãªtes
au bon endroit&#160;:</text:p>
<text:p text:style-name="RemarqueCode">$ node hello.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Suivez Ã  nouveau les instructions d&#8217;installation pour rÃ©tablir les exemples
dans leur Ã©tat initial.</text:p>
<text:bookmark text:name="ref-server" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">DÃ©marrer un serveur&#160;HTTP</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous l&#8217;avons dit&#160;: une requÃªte HTTP envoyÃ©e vers un hÃ´te reÃ§oit une rÃ©ponse.
Cet hÃ´te doit au prÃ©alable avoir installÃ© et dÃ©marrÃ© un serveur HTTP qui
Ã©coute ces demandes.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le script d&#8217;exemple <text:span text:style-name="CodeDansTexte">server/start.js</text:span> rÃ©pond Ã  ce besoin.
Une fois dÃ©marrÃ©, il est joignable Ã  l&#8217;adresse <text:span text:style-name="CodeDansTexte"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://localhost:4000" text:visited-style-name="Visited_20_Internet_20_Link">http://localhost:4000</text:a></text:span>.
Il affichera alors les en-tÃªtes des requÃªtes et de leurs rÃ©ponses&#160;:
undefined</text:p>
<text:p text:style-name="Code">$ node server/start.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">server/start.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {createServer} = require('http');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const server = createServer();</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">server.on('request', (request, response) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.setHeader('Content-Type', 'text/html');<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.end('&lt;h1&gt;Hello World&lt;/h1&gt;');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log(request.headers);<text:s text:c="21"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log(response.getHeaders());<text:s text:c="15"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">server.listen(4000);</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Comme nous retournons du HTML au client, nous explicitons le type de contenu de la rÃ©ponse.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche les en-tÃªtes de la requÃªte reÃ§ue par le serveur&#160;â€“ le contenu varie selon le client utilisÃ©.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche les en-tÃªtes de la rÃ©ponse&#160;â€“ en l&#8217;occurrence <text:span text:style-name="CodeDansTexte">{ 'content-type': 'text/html' }</text:span>.
undefined<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous avons composÃ© les fondations minimales pour crÃ©er une application web
en mesure d&#8217;accepter des requÃªtes et de rÃ©pondre quelque chose
d&#8217;arbitraire certes mais comprÃ©hensible par un navigateur web.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T7">Pourquoi avoir dÃ©marrÃ© le serveur sur le port&#160;4000</text:span> dans l&#8217;exemple prÃ©cÃ©dent&#160;?
undefined
undefined
C&#8217;est un choix arbitraire de ma part&#160;: nous pouvons dÃ©marrer un serveur HTTP
sur n&#8217;importe quel port tant qu&#8217;il est libre et supÃ©rieur ou Ã©gal Ã &#160;1000.
Quand on cherche Ã  se connecter Ã  une adresse comme <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://localhost" text:visited-style-name="Visited_20_Internet_20_Link">http://localhost</text:a></text:span> (HTTP)
et <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://localhost" text:visited-style-name="Visited_20_Internet_20_Link">https://localhost</text:a></text:span> (HTTPS), la valeur du port vaut implicitement 80
et&#160;443, respectivement.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> <text:span text:style-name="T4">get-port</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/get-port" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/get-port</text:a></text:span>) retourne
un numÃ©ro de port parmi ceux disponibles sur le systÃ¨me d&#8217;exploitation.
undefined</text:p>
<text:p text:style-name="Code">$ node server/port.js</text:p><text:p text:style-name="Code">http://localhost:51765</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">server/port.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {createServer} = require('http');</text:p><text:p text:style-name="Code">const getPort = require('get-port');</text:p><text:p text:style-name="Code">const server = createServer();</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">getPort({ port: 4000 }).then(port =&gt; {<text:s text:c="6"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log(`http://localhost:${port}`);<text:s text:c="2"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>server.listen(port);<text:s text:c="22"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Exprime une prÃ©fÃ©rence pour retourner le port 4000 s&#8217;il est disponible.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://localhost:4000" text:visited-style-name="Visited_20_Internet_20_Link">http://localhost:4000</text:a></text:span> si le port est disponible&#160;; sinon, un autre nombre.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Le serveur se met Ã  l&#8217;Ã©coute sur ce port.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Pour vous en rendre compte, dÃ©marrez le script <text:span text:style-name="CodeDansTexte">server/start.js</text:span> pour utiliser
le port 4000 et dÃ©marrez ensuite <text:span text:style-name="CodeDansTexte">server/port.js</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Performance</text:span> Programme de longue durÃ©e</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Une application web est un programme qui tourne en continu, pendant des heures
et des journÃ©es entiÃ¨res.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Chaque requÃªte entrante occupe 1&#160;Ko de mÃ©moire&#160;â€“ davantage si nous
recevons des donnÃ©es de formulaire ou une piÃ¨ce&#160;jointe.
Une application web peut en recevoir plusieurs centaines Ã  plusieurs milliers
par seconde, selon la popularitÃ© du service.</text:p>
<text:bookmark text:name="ref-path" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">RÃ©pondre Ã  un chemin (routing)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous avons vu qu&#8217;une URL est un identifiant qui se dÃ©compose en plusieurs
parties grÃ¢ce au <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-url"  text:visited-style-name="Visited_20_Internet_20_Link">module <text:span text:style-name="CodeDansTexte">url</text:span></text:a>
(<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-04"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;4</text:a>).
undefined
Une d&#8217;elles est le <text:span text:style-name="T4">chemin d&#8217;accÃ¨s</text:span> Ã  une ressource.<text:line-break/>Par exemple, le chemin de l&#8217;URL <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://localhost:4000/coucou" text:visited-style-name="Visited_20_Internet_20_Link">http://localhost:4000/coucou</text:a></text:span> est <text:span text:style-name="CodeDansTexte">/coucou</text:span>.</text:p>
<text:p text:style-name="Code">$ node path/request-url.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">path/request-url.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {createServer} = require('http');</text:p><text:p text:style-name="Code">const server = createServer().listen(4000);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">server.on('request', (request, response) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>if (request.url === '/') {<text:s text:c="24"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>response.end('&lt;a href="/hello"&gt;clique-moi&lt;/a&gt;');</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code"><text:s text:c="2"/>else if (request.url === '/coucou') {<text:s text:c="13"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>response.end('&lt;a href="/"&gt;coucou !&lt;/a&gt;');</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche un message spÃ©cifique au chemin&#160;<text:span text:style-name="CodeDansTexte">/</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche un autre message spÃ©cifique au chemin <text:span text:style-name="CodeDansTexte">/coucou</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les deux seules ressources mises Ã  disposition sur <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://localhost:4000" text:visited-style-name="Visited_20_Internet_20_Link">http://localhost:4000</text:a></text:span>
sont accessibles avec les chemins&#160;<text:span text:style-name="CodeDansTexte">/</text:span> et <text:span text:style-name="CodeDansTexte">/coucou</text:span>.
Aucun autre chemin n&#8217;aboutira.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">C&#8217;est d&#8217;ailleurs un problÃ¨me puisque, en rÃ©alitÃ©, nous n&#8217;envoyons pas de rÃ©ponse
pour un chemin inconnu.
Et c&#8217;est Ã  nous de gÃ©rer ce cas de figure&#160;:</text:p>
<text:p text:style-name="Code">$ node path/404.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">path/404.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {createServer} = require('http');</text:p><text:p text:style-name="Code">const server = createServer().listen(4000);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">server.on('request', (request, response) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>if (request.url === '/') {<text:s text:c="24"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>response.end('&lt;a href="/hello"&gt;clique-moi&lt;/a&gt;');</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code"><text:s text:c="2"/>else {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>response.statusCode = 404;<text:s text:c="22"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>response.end('&lt;h1&gt;Page introuvable&lt;/h1&gt;');<text:s text:c="6"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Seul le chemin&#160;<text:span text:style-name="CodeDansTexte">/</text:span> est disponible dans l&#8217;application.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Le code HTTP de la rÃ©ponse est rÃ©glÃ© sur&#160;<text:span text:style-name="CodeDansTexte">404</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Une requÃªte vers une page introuvable peut quand mÃªme recevoir du contenu.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La prise en compte d&#8217;une ressource inconnue de notre application fait Ã©merger
un nouveau concept&#160;: le <text:span text:style-name="T4">statut de la rÃ©ponse</text:span>.
undefined
undefined
undefined
Ce statut est un code numÃ©rique qui donne des indications sur la ressource retournÃ©e.
Dans ce cas de figure, le statut&#160;<text:span text:style-name="CodeDansTexte">404</text:span> de la rÃ©ponse indique au client de
ne pas considÃ©rer le contenu comme celui qui Ã©tait demandÃ©.<text:line-break/>Par dÃ©faut et sauf mention contraire, le statut est&#160;<text:span text:style-name="CodeDansTexte">200</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TableauTitre">Tableau 16. Principaux codes HTTP et leur signification</text:p><table:table table:style-name="Tableau1"><table:table-column />,<table:table-column />,<table:table-column /><table:table-row><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Code</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Raison</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Explication</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">200</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">OK</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>La ressource demandÃ©e est retournÃ©e en rÃ©ponse.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">301</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">Moved Permanently</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>La ressource demandÃ©e a Ã©tÃ© dÃ©placÃ©e.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">304</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">Not Modified</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>La ressource n&#8217;a pas Ã©tÃ© modifiÃ©e depuis la derniÃ¨re&#160;fois.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">400</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">Bad Request</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>La requÃªte est incomplÃ¨te ou incomprÃ©hensible par le serveur.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">401</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">Unauthorized</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>La ressource n&#8217;est accessible que sur preuve d&#8217;identification.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">403</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">Forbidden</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>L&#8217;accÃ¨s Ã  la ressource est interdit.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">404</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">Not Found</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>La ressource n&#8217;existe&#160;pas.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">500</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">Internal Server Error</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Le serveur distant est en erreur.</text:p></table:table-cell></table:table-row></table:table>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les statuts HTTP sont importants dans la crÃ©ation d&#8217;applications web.
Leur code permet de vÃ©rifier que le client et le serveur se sont bien compris.<text:line-break/>Si une page d&#8217;erreur est affichÃ©e avec un statut&#160;<text:span text:style-name="CodeDansTexte">200</text:span>, le client sera dans
l&#8217;impossibilitÃ© de deviner qu&#8217;il ne s&#8217;agit pas du contenu attendu.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TableauTitre">Tableau 17. D&#8217;autres codes HTTP utiles Ã  connaÃ®tre</text:p><table:table table:style-name="Tableau1"><table:table-column />,<table:table-column />,<table:table-column /><table:table-row><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Code</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Raison</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Explication</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">201</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">Created</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>La ressource demandÃ©e a Ã©tÃ© crÃ©Ã©e.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">202</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">Accepted</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>La demande a Ã©tÃ© acceptÃ©e et la ressource sera disponible ultÃ©rieurement.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">204</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">No Content</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>La ressource demandÃ©e n&#8217;a pas de contenu.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">302</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">Found</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>La ressource demandÃ©e est temporairement disponible Ã  une autre adresse.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">503</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">Service Unavailable</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Le serveur distant rÃ©pond qu&#8217;il n&#8217;est pas disponible pour l&#8217;instant.</text:p></table:table-cell></table:table-row></table:table>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Une application web devient vite compliquÃ©e Ã  gÃ©rer si nous devons lister
tous les chemins possibles.
C&#8217;est Ã  ce moment qu&#8217;entre en jeu le <text:span text:style-name="T4">routing</text:span>, une technique pour dÃ©crire
des chemins d&#8217;accÃ¨s au lieu de s&#8217;embourber dans une longue liste de <text:span text:style-name="CodeDansTexte">if &#8230;&#8203; else</text:span>.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous utilisons le module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> <text:span text:style-name="T4">find-my-way</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/find-my-way" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/find-my-way</text:a></text:span>)
pour transformer l&#8217;exemple <text:span text:style-name="CodeDansTexte">path/request-url.js</text:span>
en quelque chose de plus modulaire&#160;:
undefined
undefined</text:p>
<text:p text:style-name="Code">$ node path/routes.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">path/routes.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {createServer} = require('http');</text:p><text:p text:style-name="Code">const router = require('find-my-way')();<text:s text:c="16"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">router.get('/', (request, response) =&gt; {<text:s text:c="16"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.end('&lt;a href="/coucou"&gt;clique-moi&lt;/a&gt;');</text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">router.get('/coucou', (request, response) =&gt; {<text:s text:c="10"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.end('&lt;a href="/"&gt;retour&lt;/a&gt;');</text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const server = createServer().listen(4000)</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.on('request', (req, res) =&gt; router.lookup(req, res));<text:span text:style-name="PuceCode">4</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> CrÃ©ation de la table de routage.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> DÃ©finition de la rÃ©ponse du chemin d&#8217;accÃ¨s&#160;<text:span text:style-name="CodeDansTexte">/</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> DÃ©finition de la rÃ©ponse du chemin d&#8217;accÃ¨s <text:span text:style-name="CodeDansTexte">/coucou</text:span>.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> IntÃ©gration du routeur aux requÃªtes entrantes du serveur&#160;HTTP.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les routeurs commencent Ã  vraiment nous faire gagner du temps
lorsqu&#8217;il s&#8217;agit d&#8217;extraire des informations utiles depuis le chemin et
de les gÃ©rer dynamiquement&#160;:</text:p>
<text:p text:style-name="Code">$ node path/route-params.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">path/route-params.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {createServer} = require('http');</text:p><text:p text:style-name="Code">const router = require('find-my-way')();</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">router.get('/hello/:word', (req, response, params) =&gt; { <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.end(`&lt;p&gt;hello ${params.word}&lt;/p&gt;`);<text:s text:c="10"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const server = createServer().listen(4000)</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.on('request', (req, res) =&gt; router.lookup(req, res));</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> CrÃ©ation d&#8217;une route paramÃ©trÃ©e&#160;â€“ le symbole <text:span text:style-name="CodeDansTexte">:word</text:span> est accessible dans le troisiÃ¨me argument, en tant que <text:span text:style-name="CodeDansTexte">params.word</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche une phrase composÃ©e avec le paramÃ¨tre de notre route.
undefined<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dirigez-vous vers <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://localhost:4000/hello/word" text:visited-style-name="Visited_20_Internet_20_Link">http://localhost:4000/hello/word</text:a></text:span> pour voir le rÃ©sultat s&#8217;afficher.
Changez le dernier segment du chemin pour observer le changement.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce mÃ©canisme est utile pour relier un identifiant Ã  un enregistrement prÃ©cis
en base de donnÃ©es, par exemple.
Il se complÃ¨te avec les <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-argument"  text:visited-style-name="Visited_20_Internet_20_Link">arguments d&#8217;URL</text:a> pour vÃ©hiculer des
Ã©lÃ©ments optionnels&#160;â€“ nous y reviendrons plus loin.
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">SÃ©curitÃ©</text:span> Filtrer les donnÃ©es entrantes</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
C&#8217;est le moment de rappeler que <text:span text:style-name="T7">toute information saisie par l&#8217;utilisateur</text:span>
doit Ãªtre filtrÃ©e et nettoyÃ©e avant d&#8217;Ãªtre utilisÃ©e.
L&#8217;exemple <text:span text:style-name="CodeDansTexte">path/route-params.js</text:span> n&#8217;est pas sÃ©curisÃ©&#160;; vous vous en rendrez
compte en visitant <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://localhost:4000/hello/&lt;script&gt;alert(h4ck)&lt;%2Fscript&gt;" text:visited-style-name="Visited_20_Internet_20_Link">http://localhost:4000/hello/&lt;script&gt;alert(h4ck)&lt;%2Fscript&gt;</text:a></text:span>.<text:line-break/>Ce type de failles s&#8217;exploite pour faire fuiter des donnÃ©es confidentielles.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Nous verrons tous ces aspects plus en dÃ©tail dans la section
<text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-security"  text:visited-style-name="Visited_20_Internet_20_Link">ProtÃ©ger l&#8217;application</text:a></text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Enfin, les routeurs contextualisent les actions Ã  effectuer vis-Ã -vis d&#8217;une
ressource grÃ¢ce au <text:span text:style-name="T4">verbe HTTP</text:span>.
undefined
Ce dernier communique une intention&#160;â€“ rÃ©cupÃ©ration, mise Ã  jour, suppression.
Le routeur organise notre code pour dÃ©clencher une action adaptÃ©e
Ã  la mÃ©thode employÃ©e&#160;:</text:p>
<text:p text:style-name="Code">$ node path/method.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">path/method.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {createServer} = require('http');</text:p><text:p text:style-name="Code">const router = require('find-my-way')();</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">router.get('/', (request, response) =&gt; {<text:s text:c="10"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.end('Bienvenue');</text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">router.head('/', (request, response) =&gt; {<text:s text:c="9"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.writeHead(200, {<text:s text:c="23"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>'X-Jobs': 'https://jobs.humancoders.com'<text:s text:c="6"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>});</text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.end('Invisible');<text:s text:c="22"/><text:span text:style-name="PuceCode">5</text:span></text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const server = createServer().listen(4000)</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.on('request', (req, res) =&gt; router.lookup(req, res));</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> DÃ©finition du chemin d&#8217;accÃ¨s&#160;<text:span text:style-name="CodeDansTexte">/</text:span>&#160;â€“ verbe <text:span text:style-name="CodeDansTexte">GET</text:span> (rÃ©cupÃ©ration).<text:line-break/><text:span text:style-name="PuceCode">2</text:span> DÃ©finition du chemin d&#8217;accÃ¨s&#160;<text:span text:style-name="CodeDansTexte">/</text:span>&#160;â€“ verbe <text:span text:style-name="CodeDansTexte">HEAD</text:span> cette fois.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> La mÃ©thode <text:span text:style-name="CodeDansTexte">response.writeHead</text:span> est un moyen de dÃ©finir le statut en mÃªme temps que les en-tÃªtes de rÃ©ponse.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> DÃ©finition d&#8217;un en-tÃªte personnalisÃ©&#160;â€“ le prÃ©fixe <text:span text:style-name="CodeDansTexte">X-</text:span> indique qu&#8217;il n&#8217;est pas liÃ© au standard&#160;HTTP.<text:line-break/><text:span text:style-name="PuceCode">5</text:span> Ã‰criture du corps du message&#160;â€“ nous verrons qu&#8217;il est ignorÃ© et n&#8217;est pas transmis au client.
undefined
undefined
undefined<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les navigateurs web affichent seulement notre route <text:span text:style-name="CodeDansTexte">GET</text:span> car c&#8217;est
leur fonctionnement par dÃ©faut.
Ils comprennent le verbe <text:span text:style-name="CodeDansTexte">POST</text:span> pour <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-upload"  text:visited-style-name="Visited_20_Internet_20_Link">tÃ©lÃ©verser des fichiers</text:a> ou
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-post"  text:visited-style-name="Visited_20_Internet_20_Link">transmettre des formulaires</text:a>.<text:line-break/>undefined
undefined
Tournons-nous Ã  nouveau vers le programme <text:span text:style-name="CodeDansTexte">curl</text:span> pour observer les diffÃ©rences
entre les rÃ©ponses nos deux verbes HTTP <text:span text:style-name="CodeDansTexte">GET</text:span> et&#160;<text:span text:style-name="CodeDansTexte">HEAD</text:span>&#160;:</text:p>
<text:p text:style-name="Code">$ curl http://localhost:4000</text:p><text:p text:style-name="Code">Bienvenue</text:p><text:p text:style-name="Code">$ curl <text:span text:style-name="CodeExergue">--head</text:span> http://localhost:4000</text:p><text:p text:style-name="Code">HTTP/1.1 200 OK</text:p><text:p text:style-name="Code"><text:span text:style-name="CodeExergue">X-Jobs: https://jobs.humancoders.com</text:span></text:p><text:p text:style-name="Code">Date: Sun, 01 Jul 2018 15:43:56 GMT</text:p><text:p text:style-name="Code">Connection: keep-alive</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;utilisation de <text:span text:style-name="CodeDansTexte">HEAD</text:span> renvoie uniquement les en-tÃªtes de rÃ©ponse et nous
Ã©conomise la <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-templating"  text:visited-style-name="Visited_20_Internet_20_Link">gÃ©nÃ©ration d&#8217;un gabarit</text:a>.
D&#8217;un point de vue client, le verbe <text:span text:style-name="CodeDansTexte">HEAD</text:span> aide Ã  inspecter des ressources
sans avoir Ã  tÃ©lÃ©charger le contenu&#160;â€“ ce sont autant de kilo ou mÃ©gaoctets
Ã©conomisÃ©s.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TableauTitre">Tableau 18. Principaux verbes HTTP et leur utilisation</text:p><table:table table:style-name="Tableau1"><table:table-column />,<table:table-column /><table:table-row><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Verbe</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Description</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">GET</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>RÃ©cupÃ©ration d&#8217;une ressource.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">HEAD</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>RÃ©cupÃ©ration d&#8217;une ressource â€“ seulement les en-tÃªtes.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">POST</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>CrÃ©ation d&#8217;une ressource.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">PUT</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Mise Ã  jour d&#8217;une ressource.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">PATCH</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Mise Ã  jour partielle d&#8217;une ressource.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">DELETE</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Demande de suppression d&#8217;une ressource.</text:p></table:table-cell></table:table-row></table:table>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La responsabilitÃ© de comprendre ces verbes revient Ã  notre application.
C&#8217;est donc Ã  nous de leur associer une action pour les prendre en charge.</text:p>
<text:bookmark text:name="ref-static" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">RÃ©pondre avec des fichiers statiques</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-path"  text:visited-style-name="Visited_20_Internet_20_Link">chemins d&#8217;accÃ¨s</text:a> s&#8217;associent aussi Ã  des fichiers statiques.
Ainsi, Ã  une URL correspond un fichier placÃ© sur notre disque dur.
J&#8217;ai placÃ© trois fichiers de diffÃ©rentes natures (texte, image, PDF) pour
illustrer les exemples de cette section.</text:p>
<text:p text:style-name="Code">$ tree -a static/files</text:p><text:p text:style-name="Code">static/files</text:p><text:p text:style-name="Code">â”œâ”€â”€ .eslintrc.yaml</text:p><text:p text:style-name="Code">â”œâ”€â”€ doc.pdf</text:p><text:p text:style-name="Code">â””â”€â”€ screenshot.jpg</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous allons commencer par mettre Ã  disposition un seul fichier, quel que soit
le chemin demandÃ©&#160;:</text:p>
<text:p text:style-name="Code">$ node static/stream.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">static/stream.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {createServer} = require('http');</text:p><text:p text:style-name="Code">const {createReadStream} = require('fs');</text:p><text:p text:style-name="Code">const {join} = require('path');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const server = createServer().listen(4000);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">server.on('request', (requet, response) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const filepath = join(__dirname, 'files', 'doc.pdf'); <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>createReadStream(filepath).pipe(response);<text:s text:c="12"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Nous constituons un chemin d&#8217;accÃ¨s avec <text:span text:style-name="CodeDansTexte">path.join()</text:span> (<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-path"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;4</text:a>, module&#160;<text:span text:style-name="CodeDansTexte">path</text:span>).<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Nous crÃ©ons un flux de lecture vers ce fichier (<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-stream"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;4</text:a>, module <text:span text:style-name="CodeDansTexte">stream</text:span>) et nous le redirigeons vers la rÃ©ponse.
undefined
undefined
undefined
undefined<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce que cet exemple nous apprend,
c&#8217;est que l'<text:span text:style-name="T7">objet de rÃ©ponse est aussi un flux d&#8217;Ã©criture</text:span>.
undefined
Peu importe le volume du fichier, l&#8217;envoi se rÃ©gulera en fonction de la capacitÃ©
de tÃ©lÃ©chargement du client et en consommant le minimum de mÃ©moire possible.
La lecture sera interrompue si le client annule le tÃ©lÃ©chargement.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous pouvons Ã  prÃ©sent Ã©tendre ce savoir nouvellement acquis en
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-path"  text:visited-style-name="Visited_20_Internet_20_Link">routant un chemin d&#8217;accÃ¨s</text:a> vers le rÃ©pertoire qui contient nos fichiers.
undefined</text:p>
<text:p text:style-name="Code">$ node static/routes.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">static/routes.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {createServer} = require('http');</text:p><text:p text:style-name="Code">const {createReadStream} = require('fs');</text:p><text:p text:style-name="Code">const {join} = require('path');</text:p><text:p text:style-name="Code">const router = require('find-my-way')();</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const staticFiles = (request, response, params) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const filename = join(__dirname, 'files', params.file);<text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>createReadStream(filename).pipe(response);</text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">router.get('/files/:file', staticFiles);<text:s text:c="17"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">router.head('/files/:file', staticFiles);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const server = createServer().listen(4000)</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.on('request', (req, res) =&gt; router.lookup(req, res));</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> CreÌation d&#8217;une route parameÌtreÌe qui reÌpond avec la fonction&#160;<text:span text:style-name="CodeDansTexte">staticFiles</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Composition dynamique du chemin d&#8217;acceÌ€s au fichier.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Si nous accÃ©dons Ã  <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://localhost:4000/files/doc.pdf" text:visited-style-name="Visited_20_Internet_20_Link">http://localhost:4000/files/doc.pdf</text:a></text:span> et <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://localhost:4000/files/screenshot.jpg" text:visited-style-name="Visited_20_Internet_20_Link">http://localhost:4000/files/screenshot.jpg</text:a></text:span>,
nous verrons les deux documents s&#8217;afficher dans notre navigateur.
Il reste cependant un problÃ¨me&#160;: l&#8217;accÃ¨s Ã  un chemin inconnu fait planter l&#8217;application.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous constatons que notre approche est un peu trop naÃ¯ve en regardant les en-tÃªtes
de rÃ©ponse d&#8217;un peu plus&#160;prÃ¨s&#160;:</text:p>
<text:p text:style-name="Code">$ curl --head 'http://localhost:4000/files/doc.pdf' <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">HTTP/1.1 200 OK</text:p><text:p text:style-name="Code">Date: Mon, 02 Jul 2018 15:47:33 GMT</text:p><text:p text:style-name="Code">Connection: keep-alive</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> C&#8217;est pour exÃ©cuter cette commande que j&#8217;ai ajoutÃ© l&#8217;Ã©coute de la mÃ©thode&#160;<text:span text:style-name="CodeDansTexte">HEAD</text:span>.
undefined
En fait, nous gagnerions Ã  documenter la ressource en transmettant
des en-tÃªtes supplÃ©mentaires.
La question est&#160;: lesquels&#160;?<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">SÃ©curitÃ©</text:span> Filtrer les donnÃ©es entrantes</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
<text:span text:style-name="T7">Toute information saisie par l&#8217;utilisateur</text:span> doit Ãªtre filtrÃ©e et nettoyÃ©e avant
d&#8217;Ãªtre utilisÃ©e.
L&#8217;exemple <text:span text:style-name="CodeDansTexte">static/routes.js</text:span> n&#8217;est pas sÃ©curisÃ©&#160;; vous vous rendrez
compte en visitant <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://localhost:4000/files/..%2F..%2Fhello.js" text:visited-style-name="Visited_20_Internet_20_Link">http://localhost:4000/files/..%2F..%2Fhello.js</text:a></text:span> que ce chemin
permet de remonter jusqu&#8217;Ã  un fichier situÃ© hors du rÃ©pertoire <text:span text:style-name="CodeDansTexte">static/files</text:span>.<text:line-break/>Ce type de faille s&#8217;exploite pour accÃ©der aux donnÃ©es confidentielles de notre
systÃ¨me d&#8217;exploitation.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Nous verrons tous ces aspects plus en dÃ©tail dans la section
<text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-security"  text:visited-style-name="Visited_20_Internet_20_Link">ProtÃ©ger l&#8217;application</text:a></text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous allons nous baser sur le module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> <text:span text:style-name="T4">send</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/send" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/send</text:a></text:span>)
pour amÃ©liorer l&#8217;exemple prÃ©cÃ©dent et constater par nous-mÃªme quels
en-tÃªtes sont utiles.
undefined</text:p>
<text:p text:style-name="Code">$ node static/send.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">static/send.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {createServer} = require('http');</text:p><text:p text:style-name="Code">const {join} = require('path');</text:p><text:p text:style-name="Code">const send = require('send');</text:p><text:p text:style-name="Code">const router = require('find-my-way')();</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const staticFiles = (request, response, params) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const pathname = params['*'];<text:s text:c="15"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>const filename = join(__dirname, 'files', pathname);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>send(request, filename).pipe(response);<text:s text:c="5"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">router.get('/files/*', staticFiles);<text:s text:c="10"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">router.head('/files/*', staticFiles);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const server = createServer().listen(4000)</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.on('request', (req, res) =&gt; router.lookup(req, res));</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> En utilisant la syntaxe&#160;<text:span text:style-name="CodeDansTexte">*</text:span>, le routeur accepte une arborescence de chemins&#160;â€“ <text:span text:style-name="CodeDansTexte">doc.pdf</text:span> tout comme <text:span text:style-name="CodeDansTexte">un/long/chemin.pdf</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> L&#8217;arborescence se rÃ©cupÃ¨re avec un paramÃ¨tre du mÃªme&#160;nom&#160;â€“&#160;<text:span text:style-name="CodeDansTexte">*</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Le module <text:span text:style-name="T4">send</text:span> prend en charge la suite de la transmission.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous n&#8217;avons pas apportÃ© de grands bouleversements, si ce n&#8217;est que les
fichiers inexistants ne font plus planter l&#8217;application
et que les en-tÃªtes de rÃ©ponses sont plus fournis qu&#8217;avant&#160;:</text:p>
<text:p text:style-name="Code">$ curl --head 'http://localhost:4000/files/doc.pdf'</text:p><text:p text:style-name="Code">HTTP/1.1 200 OK</text:p><text:p text:style-name="Code">Accept-Ranges: bytes</text:p><text:p text:style-name="Code">Cache-Control: public, max-age=0</text:p><text:p text:style-name="Code">Last-Modified: Tue, 12 Jun 2018 08:02:40 GMT</text:p><text:p text:style-name="Code">ETag: W/"10c5d-163f304b0d2"</text:p><text:p text:style-name="Code">Content-Type: application/pdf</text:p><text:p text:style-name="Code">Content-Length: 68701</text:p><text:p text:style-name="Code">Date: Mon, 02 Jul 2018 15:52:18 GMT</text:p><text:p text:style-name="Code">Connection: keep-alive</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Parmi les en-tÃªtes les plus importants, nous trouvons <text:span text:style-name="CodeDansTexte">Content-Type</text:span>,
<text:span text:style-name="CodeDansTexte">Content-Length</text:span> et <text:span text:style-name="CodeDansTexte">Last-Modified</text:span>.
undefined
undefined
undefined
Ils aident le client Ã  interprÃ©ter ou reprÃ©senter le contenu de maniÃ¨re optimale,
Ã  informer de la taille du contenu (utile Ã  l&#8217;animation de la barre de
tÃ©lÃ©chargement du navigateur web) et Ã  distinguer l&#8217;anciennetÃ© du fichier.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TableauTitre">Tableau 19. En-tÃªtes de rÃ©ponse utiles pour transmettre des fichiers</text:p><table:table table:style-name="Tableau1"><table:table-column />,<table:table-column /><table:table-row><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>En-tÃªte</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>UtilitÃ©</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">Content-Type</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Explicite la nature du contenu mis Ã  disposition.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">Content-Disposition</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Indique si le contenu doit Ãªtre affichÃ© dans le client ou tÃ©lÃ©chargÃ© sous un nom particulier.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">Cache-Control</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Active ou dÃ©sactive la mise en cache de ce fichier par le client.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">Last-Modified</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Indique la date de derniÃ¨re modification du contenu.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">Content-Length</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Indique la longueur (en octets) du contenu.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">Content-Encoding</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Indique le mode de compression utilisÃ© pour transmettre les donnÃ©es.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">Accept-Ranges</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Indique la possibilitÃ© ou non de reprendre un tÃ©lÃ©chargement ou d&#8217;en choisir un segment avec l&#8217;en-tÃªte de requÃªte <text:span text:style-name="CodeDansTexte">Range</text:span>.</text:p></table:table-cell></table:table-row></table:table>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Performance</text:span> Utiliser Apache ou nginx en production</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
undefined
undefined
Si Node s&#8217;en sort bien pour envoyer des fichiers vers le client,
les serveurs web Apache et nginx sont encore plus performants Ã  ce niveau.
C&#8217;est quelque chose Ã  considÃ©rer si votre application sert principalement
des fichiers statiques.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Lisez le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-06"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;6</text:a> pour apprendre Ã 
configurer Node derriÃ¨re un autre serveur&#160;web.</text:p>
<text:bookmark text:name="ref-arguments" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">RÃ©agir aux arguments&#160;d&#8217;URL</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les arguments d&#8217;une URL servent Ã  <text:span text:style-name="T7">affiner le contexte d&#8217;affichage</text:span> d&#8217;une
ressource donnÃ©e.
Ces options servent par exemple Ã  paginer du contenu ou spÃ©cifier une dimension,
un filtre d&#8217;affichage ou encore une expression de recherche.
En clair, elles servent Ã  influencer la reprÃ©sentation d&#8217;une ressource
ou information.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Par dÃ©faut, les arguments sont reprÃ©sentÃ©s de maniÃ¨re textuelle avec
le chemin d&#8217;accÃ¨s, dans l&#8217;attribut <text:span text:style-name="CodeDansTexte">request.url</text:span>&#160;:</text:p>
<text:p text:style-name="Code">$ node arguments/intro.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">arguments/intro.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {createServer} = require('http');</text:p><text:p text:style-name="Code">const server = createServer().listen(4000);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">server.on('request', (request, response) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.end(request.url);<text:s text:c="6"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> La page demandÃ©e affiche l&#8217;attribut de requÃªte <text:span text:style-name="CodeDansTexte">url</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous voyons s&#8217;afficher <text:span text:style-name="CodeDansTexte">/test?cle=valeur&amp;option</text:span> en nous rendant Ã  l&#8217;adresse
<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://localhost:4000/test?cle=valeur&amp;option" text:visited-style-name="Visited_20_Internet_20_Link">http://localhost:4000/test?cle=valeur&amp;option</text:a></text:span>.
Ce n&#8217;est pas utilisable en l&#8217;Ã©tat.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-url"  text:visited-style-name="Visited_20_Internet_20_Link">module <text:span text:style-name="CodeDansTexte">url</text:span></text:a>
(<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-04"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;4</text:a>) entre en jeu.
En plus de dÃ©structurer une URL entiÃ¨re, il sait aussi dÃ©composer les options
et les transformer en un objet utilisable cÃ´tÃ©&#160;Node&#160;:
undefined</text:p>
<text:p text:style-name="Code">$ node arguments/parse.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">arguments/parse.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {createServer} = require('http');</text:p><text:p text:style-name="Code">const {parse} = require('url');</text:p><text:p text:style-name="Code">const server = createServer().listen(4000);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">server.on('request', (request, response) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const {search, query} = parse(request.url, true); <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.write(`${search}\n\n`);<text:s text:c="18"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.write(JSON.stringify(query));<text:s text:c="12"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.end();</text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Le deuxiÃ¨me argument de la fonction <text:span text:style-name="CodeDansTexte">url.parse()</text:span> dÃ©compose les arguments, disponibles dans l&#8217;attribut <text:span text:style-name="CodeDansTexte">query</text:span> de l&#8217;objet retournÃ©.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> L&#8217;attribut <text:span text:style-name="CodeDansTexte">search</text:span> correspond aux arguments, sous forme textuelle.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> L&#8217;attribut <text:span text:style-name="CodeDansTexte">query</text:span> est un objet&#160;â€“ ici, transformÃ© pour Ãªtre affichÃ© dans la page sous forme de texte.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette fois, nous voyons s&#8217;afficher <text:span text:style-name="CodeDansTexte">{"cle": "valeur", "option": ""}</text:span> dans notre
navigateur lorsque nous nous rendons sur <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://localhost:4000/test?cle=valeur&amp;option" text:visited-style-name="Visited_20_Internet_20_Link">http://localhost:4000/test?cle=valeur&amp;option</text:a></text:span>.
C&#8217;est tout ce qu&#8217;il nous fallait pour l&#8217;utiliser dans notre application.</text:p>
<text:p text:style-name="Code">$ node arguments/format.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">arguments/format.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {createServer} = require('http');</text:p><text:p text:style-name="Code">const {parse} = require('url');</text:p><text:p text:style-name="Code">const {format} = require('date-fns');</text:p><text:p text:style-name="Code">const server = createServer().listen(4000);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">server.on('request', (request, response) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const {query} = parse(request.url, true);</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const text = format(new Date(), 'YYYY-MM-DD');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>if (query.format === 'svg') {<text:s text:c="21"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>response.setHeader('Content-Type', 'text/html');<text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>response.end(`&lt;svg viewBox="0 0 200 100"&gt;</text:p><text:p text:style-name="Code"><text:s text:c="6"/>&lt;text x="0" y="50"&gt;${text}&lt;/text&gt;</text:p><text:p text:style-name="Code"><text:s text:c="4"/>&lt;/svg&gt;`);</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code"><text:s text:c="2"/>else {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>response.end(text);<text:s text:c="29"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Nous rentrons dans ce bloc en prÃ©sence de l&#8217;argument d&#8217;URL <text:span text:style-name="CodeDansTexte">format=svg</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> L&#8217;en-tÃªte <text:span text:style-name="CodeDansTexte">Content-Type</text:span> fait que le contenu est interprÃ©tÃ© (et affichÃ©) comme du HTML&#160;â€“ en retirant cette ligne, le document sera alors tÃ©lÃ©chargÃ©.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Sinon, le reste du temps, nous affichons la date telle quelle, en tant que texte.
undefined
Les deux URL <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://localhost:4000/date?format=svg" text:visited-style-name="Visited_20_Internet_20_Link">http://localhost:4000/date?format=svg</text:a></text:span> et <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://localhost:4000/date" text:visited-style-name="Visited_20_Internet_20_Link">http://localhost:4000/date</text:a></text:span> font
rÃ©fÃ©rence Ã  une mÃªme ressource, mais l&#8217;affichage s&#8217;adapte au contexte.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TableauTitre">Tableau 20. Exemples d&#8217;arguments et leurs reprÃ©sentations en structure ECMAScript</text:p><table:table table:style-name="Tableau1"><table:table-column />,<table:table-column /><table:table-row><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Argument</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>ReprÃ©sentation</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">?cle=valeur</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">{cle: "valeur"}</text:span></text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">?cle</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">{cle: ""}</text:span></text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">?cle[]=1&amp;cle[]=2</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">{cle: [1,2]}</text:span></text:p></table:table-cell></table:table-row></table:table>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Performance</text:span> Module npm parseurl</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
Si vous Ãªtes Ã  la recherche de performance, le module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> <text:span text:style-name="T4">parseurl</text:span>
(<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/parseurl" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/parseurl</text:a></text:span>) retourne les mÃªmes rÃ©sultats
tout en Ã©tant jusqu&#8217;Ã  10&#160;fois plus rapide que le module natif de&#160;Node.</text:p>
<text:bookmark text:name="ref-post" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Recevoir des donnÃ©es de formulaire&#160;(POST)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Lorsque nous ne prÃ©cisons pas la mÃ©thode employÃ©e, les outils et logiciels
utilisent par dÃ©faut la mÃ©thode&#160;<text:span text:style-name="CodeDansTexte">GET</text:span>.
Elle est associÃ©e Ã  une rÃ©cupÃ©ration de donnÃ©es sans transmettre autre chose
que des en-tÃªtes et un chemin d&#8217;accÃ¨s.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il y a des cas oÃ¹ nous avons besoin d&#8217;envoyer des donnÃ©es, pour les stocker
ou pour demander Ã  crÃ©er un enregistrement.
Dans ce cas, nous utilisons la mÃ©thode <text:span text:style-name="CodeDansTexte">POST</text:span> et nous transmettons les informations
d&#8217;une maniÃ¨re diffÃ©rente.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le serveur suivant affichera deux choses Ã  chaque requÃªte reÃ§ue&#160;: l&#8217;en-tÃªte
<text:span text:style-name="CodeDansTexte">Content-Type</text:span> et le corps du message transmis par la requÃªte.</text:p>
<text:p text:style-name="Code">$ node post/server.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La commande <text:span text:style-name="CodeDansTexte">curl</text:span> rÃ¨gle le nom et la valeur d&#8217;un champ de formulaire
avec l&#8217;option&#160;<text:span text:style-name="CodeDansTexte">-d</text:span>.
undefined
Nous pouvons ainsi transmettre des donnÃ©es avec la mÃ©thode <text:span text:style-name="CodeDansTexte">POST</text:span> Ã  notre
serveur&#160;:</text:p>
<text:p text:style-name="Code">$ curl -XPOST -d 'fromage=cabÃ©cou' -d 'remember_me=1' \</text:p><text:p text:style-name="Code"><text:s text:c="2"/>http://localhost:4000</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">C&#8217;est vraiment l&#8217;Ã©quivalent d&#8217;un classique formulaire&#160;HTML.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-07/images/send-data.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>7-undefined.</text:span> ReprÃ©sentation d&#8217;un formulaire HTML qui envoie les mÃªmes informations que la commande <text:span text:style-name="CodeDansTexte">curl</text:span> prÃ©cÃ©dente</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">post/index.html</text:p><text:p text:style-name="Code">&lt;meta charset="utf-8"&gt;</text:p><text:p text:style-name="Code">&lt;form action="http://localhost:4000" method="POST"&gt; <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">&lt;label&gt;fromage=</text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;input name="fromage" type="text" value="cabÃ©cou"&gt;</text:p><text:p text:style-name="Code">&lt;/label&gt;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">&lt;label&gt;remember_me=</text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;input name="remember_me" type="checkbox" value="1" checked&gt;</text:p><text:p text:style-name="Code">&lt;/label&gt;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">&lt;button type="submit"&gt;Transmettre&lt;/button&gt;</text:p><text:p text:style-name="Code">&lt;/form&gt;</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Nous retrouvons l&#8217;indication de la mÃ©thode&#160;<text:span text:style-name="CodeDansTexte">POST</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Lorsque la page HTML est ouverte dans un navigateur et qu&#8217;on appuie sur le bouton
<text:span text:style-name="CodeDansTexte">Transmettre</text:span>, les mÃªmes informations qu&#8217;avec la commande <text:span text:style-name="CodeDansTexte">curl</text:span> s&#8217;affichent.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il se trouve que Node aussi sait envoyer des informations de formulaire
avec le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-http"  text:visited-style-name="Visited_20_Internet_20_Link">module <text:span text:style-name="CodeDansTexte">http</text:span></text:a>
(<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-04"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;4</text:a>).
undefined</text:p>
<text:p text:style-name="Code">$ node post/send.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">post/send.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {stringify} = require('querystring');</text:p><text:p text:style-name="Code">const {request} = require('http');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const data = { fromage: 'cabÃ©cou', 'remember_me': 1 }; <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const options = {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>hostname: 'localhost',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>port: 4000,</text:p><text:p text:style-name="Code"><text:s text:c="2"/>method: 'POST',<text:s text:c="38"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>headers: {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>'Content-Type': 'application/x-www-form-urlencoded'<text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">request(options).end(stringify(data));<text:s text:c="17"/><text:span text:style-name="PuceCode">4</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> CrÃ©ation de la structure des donnÃ©es Ã  transmettre.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Indication de la mÃ©thode&#160;<text:span text:style-name="CodeDansTexte">POST</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Cet en-tÃªte caractÃ©rise la maniÃ¨re d&#8217;organiser les donnÃ©es de formulaire&#160;â€“ personnellement, je n&#8217;arrive jamais Ã  retenir cette valeur et je la copie/colle toujours depuis Stack Overflow ou une documentation technique.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Les donnÃ©es sont sÃ©rialisÃ©es sous forme d&#8217;une chaÃ®ne de caractÃ¨res, identique Ã  ce que ferait un navigateur avec les donnÃ©es d&#8217;un formulaire.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous retrouvons l&#8217;en-tÃªte <text:span text:style-name="CodeDansTexte">Content-Type</text:span> dans l&#8217;affichage du script <text:span text:style-name="CodeDansTexte">post/server.js</text:span>.
Le contenu du message envoyÃ© ressemble beaucoup Ã  des arguments d&#8217;URL
encodÃ©s avec <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-encode-uri"  text:visited-style-name="Visited_20_Internet_20_Link">encodeURIComponent()</text:a>.
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">Extrait d&#8217;affichage d&#8217;un message reÃ§u par <text:span text:style-name="CodeDansTexte">post/server.js</text:span></text:p><text:p text:style-name="Code">application/x-www-form-urlencoded</text:p><text:p text:style-name="Code">fromage=cab%C3%A9cou&amp;remember_me=1</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Comme dans les sections prÃ©cÃ©dentes, nous devons <text:span text:style-name="T4">dÃ©coder</text:span> une chaÃ®ne de
caractÃ¨res pour en extraire sa signification et en faire quelque chose
en ECMAScript.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous pourrions utiliser la fonction <text:span text:style-name="CodeDansTexte">parse()</text:span> du module Node <text:span text:style-name="CodeDansTexte">querystring</text:span>
pour dÃ©coder le contenu de cette chaÃ®ne, mais nous allons plutÃ´t faire appel
au module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> <text:span text:style-name="T4">co-body</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/co-body" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/co-body</text:a></text:span>).
undefined
Ce module dÃ©code plusieurs types de requÃªtes <text:span text:style-name="CodeDansTexte">POST</text:span>, illustrÃ©s dans d&#8217;autres
exemples de cette mÃªme section.
undefined</text:p>
<text:p text:style-name="Code">$ node post/server-parse.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">post/server-parse.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {createServer} = require('http');</text:p><text:p text:style-name="Code">const parse = require('co-body');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const onRequest = (request, response) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>parse(request)<text:s text:c="36"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>.then(body =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="6"/>console.log(request.headers['content-type']);</text:p><text:p text:style-name="Code"><text:s text:c="6"/>console.log(body);<text:s text:c="28"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>})</text:p><text:p text:style-name="Code"><text:s text:c="4"/>.catch(error =&gt; console.error(error.message))<text:s text:c="3"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>.finally(() =&gt; response.end());</text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">createServer(onRequest).listen(4000);</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Le module <text:span text:style-name="T4">co-body</text:span> transforme une requÃªte HTTP en un objet utilisable dans&#160;Node.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Le contenu de la variable ressemblera Ã  quelque chose comme <text:span text:style-name="CodeDansTexte">{fromage: 'cabÃ©cou', remember_me: '1'}</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Une erreur s&#8217;affichera en cas de problÃ¨me pour dÃ©coder le corps de la requÃªte entrante.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il nous suffit d&#8217;exÃ©cuter Ã  nouveau le script <text:span text:style-name="CodeDansTexte">post/send.js</text:span> pour observer
la diffÃ©rence et constater que nous pouvons dÃ©sormais interprÃ©ter les donnÃ©es
d&#8217;un formulaire.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le fichier <text:span text:style-name="CodeDansTexte">post/send.js</text:span> se simplifie si on utilise le module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> <text:span text:style-name="T4">superagent</text:span>
(<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/superagent" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/superagent</text:a></text:span>).
undefined
Je le trouve simple d&#8217;utilisation et il fonctionne avec des promesses,
des formulaires et les <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-upload"  text:visited-style-name="Visited_20_Internet_20_Link">tÃ©lÃ©versements de fichiers</text:a>.
undefined
undefined</text:p>
<text:p text:style-name="Code">$ node post/send-data.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">post/send-data.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {post} = require('superagent');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">post('http://localhost:4000')<text:s text:c="17"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>.send('fromage=cabÃ©cou')<text:s text:c="20"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>.send('remember_me=1')</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.catch(error =&gt; console.log(error.message));</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> URL de la ressource vers laquelle poster les informations.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> La dÃ©finition d&#8217;un champ de formulaire s&#8217;effectue Ã  l&#8217;aide de la mÃ©thode <text:span text:style-name="CodeDansTexte">send()</text:span> et d&#8217;une valeur ayant la forme d&#8217;une chaÃ®ne de caractÃ¨res.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ã€ ce stade-lÃ , nous avons fait le nÃ©cessaire pour interprÃ©ter le contenu d&#8217;un
formulaire sans piÃ¨ce&#160;jointe.
Notre serveur est mÃªme prÃªt Ã  recevoir des donnÃ©es transmises en dehors d&#8217;un
formulaire, au format&#160;JSON&#160;:
undefined</text:p>
<text:p text:style-name="Code">$ node post/send-json.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">post/send-json.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {post} = require('superagent');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">post('http://localhost:4000')</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.send({<text:s text:c="25"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>fromage: 'cabÃ©cou',</text:p><text:p text:style-name="Code"><text:s text:c="4"/>remember_me: 1</text:p><text:p text:style-name="Code"><text:s text:c="2"/>})</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.catch(error =&gt; console.log(error.message));</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> L&#8217;utilisation d&#8217;un objet ECMAScript suffit au module <text:span text:style-name="T4">superagent</text:span> pour transmettre les donnÃ©es au format&#160;JSON.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous constatons que la valeur de l&#8217;en-tÃªte <text:span text:style-name="CodeDansTexte">Content-Type</text:span> change pour devenir
<text:span text:style-name="CodeDansTexte">application/json</text:span>.
undefined
LÃ  aussi, le module <text:span text:style-name="T4">co-body</text:span> nous est utile, car il s&#8217;adapte au type des donnÃ©es
entrantes et les dÃ©code de maniÃ¨re transparente.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il existe un dernier type d&#8217;encodage de donnÃ©es que nous pouvons nous
attendre Ã  recevoir.
Ce sont les formulaires dits <text:span text:style-name="T4">multipart</text:span>.
undefined
undefined</text:p>
<text:p text:style-name="Code">$ node post/send-multipart.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">post/send-multipart.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {post} = require('superagent')</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">post('http://localhost:4000')</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.field('fromage', 'cabÃ©cou')<text:s text:c="16"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>.field('remember_me', 1)</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.catch(error =&gt; console.log(error.message));</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Le module <text:span text:style-name="T4">superagent</text:span> utilise la mÃ©thode <text:span text:style-name="CodeDansTexte">field()</text:span> pour dÃ©finir la valeur d&#8217;un champ <text:span text:style-name="T4">multipart</text:span>.
undefined<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le serveur va pourtant afficher une erreur du type&#160;:</text:p>
<text:p text:style-name="Code">Unsupported content-type: multipart/form-data;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>boundary=--------------------------070345340228095473881249</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce type d&#8217;encodage de donnÃ©es est plus complexe Ã  gÃ©rer.
Il va nous falloir passer Ã  une autre stratÃ©gie, incontournable
pour gÃ©rer le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-upload"  text:visited-style-name="Visited_20_Internet_20_Link">tÃ©lÃ©versement de fichiers</text:a>.</text:p>
<text:bookmark text:name="ref-upload" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">TÃ©lÃ©verser des fichiers</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le tÃ©lÃ©versement de fichier implique un peu plus de travail qu&#8217;un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-post"  text:visited-style-name="Visited_20_Internet_20_Link">simple formulaire</text:a>
car la structure des donnÃ©es envoyÃ©es diffÃ¨re mais aussi, surtout,
parce que la rÃ©ception et la gestion des fichiers demandent encore plus
d&#8217;attention.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Voyons par nous-mÃªme Ã  quoi ressemble une requÃªte qui contient une piÃ¨ce&#160;jointe.</text:p>
<text:p text:style-name="Code">$ node upload/server.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">upload/server.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {createServer} = require('http');</text:p><text:p text:style-name="Code">const getStream = require('get-stream');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const onRequest = (request, response) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>getStream(request).then(body =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>console.log(request.headers['content-type']);</text:p><text:p text:style-name="Code"><text:s text:c="4"/>console.log(body);</text:p><text:p text:style-name="Code"><text:s text:c="4"/>response.end();</text:p><text:p text:style-name="Code"><text:s text:c="2"/>});</text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">createServer(onRequest).listen(4000);</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce serveur affiche le contenu d&#8217;une requÃªte entrante.
La requÃªte suivante illustre le tÃ©lÃ©versement d&#8217;un fichier avec le programme <text:span text:style-name="CodeDansTexte">curl</text:span>.
undefined
Notez que, cette fois-ci, nous utilisons l&#8217;option&#160;<text:span text:style-name="CodeDansTexte">-F</text:span> et que la valeur
est prÃ©fixÃ©e avec le caractÃ¨re&#160;<text:span text:style-name="CodeDansTexte">@</text:span>, suivi du chemin d&#8217;accÃ¨s au fichier en question.</text:p>
<text:p text:style-name="Code">$ curl -XPOST -F 'hello=<text:span text:style-name="CodeExergue">@upload/hello.txt</text:span>' \</text:p><text:p text:style-name="Code"><text:s text:c="4"/>http://localhost:4000</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette commande est Ã©quivalente Ã  l&#8217;envoi du formulaire HTML suivant&#160;:</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-07/images/send-file.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>7-undefined.</text:span> ReprÃ©sentation d&#8217;un formulaire HTML qui tÃ©lÃ©verse un fichier</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">upload/index.html</text:p><text:p text:style-name="Code">&lt;meta charset="utf-8"&gt;</text:p><text:p text:style-name="Code">&lt;form action="http://localhost:4000" method="POST"</text:p><text:p text:style-name="Code"><text:s text:c="2"/>enctype="multipart/form-data"&gt;<text:s text:c="4"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">&lt;label&gt;hello=</text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;input name="hello" type="file"&gt;<text:s text:c="2"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">&lt;/label&gt;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">&lt;button type="submit"&gt;Transmettre&lt;/button&gt;</text:p><text:p text:style-name="Code">&lt;/form&gt;</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Nous retrouvons l&#8217;encodage <text:span text:style-name="CodeDansTexte">multipart/form-data</text:span> dans l&#8217;attribut <text:span text:style-name="CodeDansTexte">enctype</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Un fichier se tÃ©lÃ©verse avec un champ de type <text:span text:style-name="CodeDansTexte">file</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La structure du corps de message d&#8217;une requÃªte <text:span text:style-name="CodeDansTexte">multipart/form-data</text:span> envoyÃ©e
avec la commande <text:span text:style-name="CodeDansTexte">curl</text:span> ou un formulaire HTML ressemble ce qui suit&#160;:</text:p>
<text:p text:style-name="Code">multipart/form-data; boundary=-----1acfa07ebbd71d3c <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">-----1acfa07ebbd71d3c<text:s text:c="31"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">Content-Disposition: form-data; name="hello";</text:p><text:p text:style-name="Code"><text:s text:c="2"/>filename="hello.txt"<text:s text:c="30"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">Content-Type: text/plain<text:s text:c="28"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">Hello World</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">-----1acfa07ebbd71d3c----<text:s text:c="27"/><text:span text:style-name="PuceCode">5</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Contenu de l&#8217;en-tÃªte <text:span text:style-name="CodeDansTexte">Content-Type</text:span>&#160;â€“ l&#8217;attribut <text:span text:style-name="CodeDansTexte">boundary</text:span> prÃ©cise le motif de dÃ©limitation des diffÃ©rents champs.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Ouverture des informations du premier champ.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Les attributs <text:span text:style-name="CodeDansTexte">name</text:span> et <text:span text:style-name="CodeDansTexte">filename</text:span> dÃ©finissent respectivement le nom du champ de formulaire et celui du fichier en question.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> L&#8217;attribut <text:span text:style-name="CodeDansTexte">Content-Type</text:span> concerne le fichier et aide Ã  comprendre comment interprÃ©ter son contenu&#160;â€“ ici, du texte brut.<text:line-break/><text:span text:style-name="PuceCode">5</text:span> Fermeture des informations du premier champ.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Pratique</text:span> Courriels et piÃ¨ces&#160;jointes</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
Les courriels utilisent aussi l&#8217;encodage <text:span text:style-name="CodeDansTexte">multipart/form-data</text:span> pour joindre
des fichiers Ã  un message.
Si vous savez encoder ou dÃ©coder des fichiers pour le&#160;Web, vous savez scripter
l&#8217;ajout de piÃ¨ces&#160;jointes pour les courriels.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il nous faudrait Ã©crire davantage que 20&#160;lignes de code si nous devions
nous-mÃªme interprÃ©ter un contenu de requÃªte qui contient des piÃ¨ces&#160;jointes.
C&#8217;est suffisamment compliquÃ© Ã  programmer de maniÃ¨re robuste pour que le module
<text:span text:style-name="T4">co-body</text:span> vu dans la <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-post"  text:visited-style-name="Visited_20_Internet_20_Link">section prÃ©cÃ©dente</text:a> ne s&#8217;en charge pas et recommande
le module <text:span text:style-name="T4">formidable</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/formidable" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/formidable</text:a></text:span>).
undefined
C&#8217;est exactement ce que nous allons faire pour outiller un nouveau serveur.</text:p>
<text:p text:style-name="Code">$ node upload/server-parse.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">upload/server-parse.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {createServer} = require('http');</text:p><text:p text:style-name="Code">const formidable = require('formidable');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const onRequest = (request, response) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const form = new formidable.IncomingForm();</text:p><text:p text:style-name="Code"><text:s text:c="2"/>form.parse(request, (error, fields, files) =&gt; { <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>const testFile = files.hello;<text:s text:c="17"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="4"/>console.log(testFile.type);<text:s text:c="19"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>console.log(testFile.name);<text:s text:c="19"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>console.log(testFile.size);<text:s text:c="19"/><text:span text:style-name="PuceCode">5</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>console.log(testFile.path);<text:s text:c="19"/><text:span text:style-name="PuceCode">6</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>response.end();</text:p><text:p text:style-name="Code"><text:s text:c="2"/>});</text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">createServer(onRequest).listen(4000);</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Le module <text:span text:style-name="T4">formidable</text:span> diffÃ©rencie les donnÃ©es et les fichiers.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Nous accÃ©dons aux informations d&#8217;un fichier au travers d&#8217;une clÃ©, identique Ã  celle de son champ <text:span text:style-name="CodeDansTexte">name</text:span> dans le formulaire.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche <text:span text:style-name="CodeDansTexte">text/plain</text:span>&#160;â€“ la valeur du <text:span text:style-name="CodeDansTexte">Content-Type</text:span> du fichier.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Affiche <text:span text:style-name="CodeDansTexte">hello.txt</text:span>&#160;â€“ c&#8217;est le nom du fichier tel qu&#8217;il Ã©tait nommÃ© sur le poste client.<text:line-break/><text:span text:style-name="PuceCode">5</text:span> Affiche&#160;<text:span text:style-name="CodeDansTexte">12</text:span>&#160;â€“ c&#8217;est le poids total du fichier.<text:line-break/><text:span text:style-name="PuceCode">6</text:span> Affiche un chemin d&#8217;accÃ¨s vers l&#8217;emplacement de stockage temporaire du fichier tÃ©lÃ©versÃ©.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous sommes en mesure de recevoir des piÃ¨ces&#160;jointes depuis un formulaire.
Le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-fs"  text:visited-style-name="Visited_20_Internet_20_Link">module&#160;<text:span text:style-name="CodeDansTexte">fs</text:span></text:a> (<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-04"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;4</text:a>)
propose le nÃ©cessaire pour dÃ©placer le fichier ailleurs sur le systÃ¨me ou
pour en lire le contenu et le stocker ailleurs&#160;â€“ sur un service de stockage distant
(Amazon&#160;S3, par exemple).
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">SÃ©curitÃ©</text:span> Un fichier texte n&#8217;a de texte que le nom</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
Comme pour toute donnÃ©e transmise par un utilisateur ou une utilisatrice,
nous devons rester vigilantÂ·e sur le contenu des fichiers pour
Ã©viter des attaques mal intentionnÃ©es.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Un fichier texte qui contient du JavaScript pourrait Ãªtre exÃ©cutÃ© comme un
script sur le poste client et ainsi servir Ã  subtiliser des donnÃ©es privÃ©es
ou aider quelqu&#8217;un Ã  usurper une identitÃ© sur le service.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Je recommande deux approches Ã  appliquer avant mÃªme de faire quoi que ce soit
avec une piÃ¨ce&#160;jointe fraÃ®chement tÃ©lÃ©versÃ©e&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">S&#8217;il s&#8217;agit d&#8217;un <text:span text:style-name="T7">fichier texte</text:span>&#160;: filtrer le contenu du fichier en retirant
tout ce qui ressemble Ã  du code arbitraire et filtrer le contenu Ã  l&#8217;affichage
pour retirer tout balisage HTML (voir section <text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-security"  text:visited-style-name="Visited_20_Internet_20_Link">ProtÃ©ger son application</text:a></text:span>).</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">S&#8217;il s&#8217;agit d&#8217;un <text:span text:style-name="T7">fichier binaire</text:span> (image, vidÃ©o, PDF)&#160;: utiliser un antivirus
en ligne de commande pour scanner le contenu&#160;â€“ <text:span text:style-name="T4">ClamAV</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://www.clamav.net" text:visited-style-name="Visited_20_Internet_20_Link">https://www.clamav.net</text:a></text:span>)
est un excellent antivirus open source.
undefined</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ces opÃ©rations risquent de prendre du temps&#160;â€“ de quelques secondes Ã  plusieurs
minutes dans le cas de fichiers volumineux.
Au lieu de faire attendre l&#8217;utilisateur devant son Ã©cran, je recommande
de faire appel Ã  un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-job-queue"  text:visited-style-name="Visited_20_Internet_20_Link">mÃ©canisme de file d&#8217;attente</text:a> pour traiter
l&#8217;effort indÃ©pendamment, en fonction des capacitÃ©s de calcul disponibles.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Enfin, quand vous avez fini d&#8217;utiliser la piÃ¨ce&#160;jointe&#160;â€“ ou si vous ne l&#8217;utilisez pas&#160;â€“
pensez aussi Ã  la <text:span text:style-name="T7">supprimer du rÃ©pertoire temporaire</text:span>.
Le disque dur du serveur pourrait manquer d&#8217;espace si plusieurs fichiers volumineux
Ã©taient dÃ©posÃ©s en peu de temps.</text:p>
<text:bookmark text:name="ref-cookies" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Garder un lien avec les cookies</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un cookie est une information partagÃ©e entre un client et un serveur pour
une durÃ©e limitÃ©e dans le temps.
Le client transmet les cookies au serveur afin que ce dernier contextualise
la demande&#160;â€“ un identifiant utilisateur, des prÃ©fÃ©rences ou autre.
Un cookie crÃ©Ã© par le domaine <text:span text:style-name="CodeDansTexte">example.com</text:span> est envoyÃ© seulement lors d&#8217;une
visite Ã  <text:span text:style-name="CodeDansTexte">example.com</text:span>&#160;â€“ sous-domaines inclus.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce mÃ©canisme est aujourd&#8217;hui tristement cÃ©lÃ¨bre pour son dÃ©tournement
par les industries de la publicitÃ©, du marketing et de la revente de donnÃ©es.</text:p>
<text:p text:style-name="Code">$ node cookies/set-cookie.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">cookies/set-cookie.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {createServer} = require('http');</text:p><text:p text:style-name="Code">const server = createServer().listen(4000);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">server.on('request', (request, response) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.setHeader('Set-Cookie', 'compteur=1'); <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.end();</text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> L&#8217;en-tÃªte de rÃ©ponse <text:span text:style-name="CodeDansTexte">Set-Cookie</text:span> crÃ©e/modifie la valeur d&#8217;un cookie chez le client&#160;â€“ ici, le cookie <text:span text:style-name="CodeDansTexte">compteur</text:span> est crÃ©Ã© avec la valeur&#160;<text:span text:style-name="CodeDansTexte">1</text:span>.
undefined<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous pouvons observer la crÃ©ation du cookie en nous rendant sur <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://localhost:4000" text:visited-style-name="Visited_20_Internet_20_Link">http://localhost:4000</text:a></text:span>
avec un navigateur, puis en ouvrant les outils de dÃ©veloppement.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-07/images/cookies-browser.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>7-undefined.</text:span> Visualisation des cookies avec les outils de dÃ©veloppement du navigateur Firefox</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les cookies sont transmis du client au serveur <text:span text:style-name="T7">Ã  chaque requÃªte</text:span>.</text:p>
<text:p text:style-name="Code">$ node cookies/read.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">cookies/read.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {createServer} = require('http');</text:p><text:p text:style-name="Code">const server = createServer().listen(4000);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">server.on('request', (request, response) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const cookie = request.headers.cookie;<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.end(`Contenu : ${cookie}`);<text:s text:c="4"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Les cookies se lisent en inspectant l&#8217;en-tÃªte de requÃªte <text:span text:style-name="CodeDansTexte">Cookie</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">Contenu&#160;: compteur=1</text:span>.
intexterm:[HTTP, en-tÃªte, Cookie]
intexterm:[application web, cookie]<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous avons rÃ©cupÃ©rÃ© la valeur de l&#8217;en-tÃªte contenant le cookie.
Nous devons faire un effort supplÃ©mentaire pour transformer cette valeur textuelle
en une structure ECMAScript qui fait sens pour notre application.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous allons nous aider pour cela du module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> <text:span text:style-name="T4">cookie</text:span>
(<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/cookie" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/cookie</text:a></text:span>).
undefined
Il sait interprÃ©ter le contenu d&#8217;un en-tÃªte HTTP et il sait Ã©galement faire
l&#8217;inverse, transformer une structure ECMAScript vers du texte utilisable
dans l&#8217;en-tÃªte de rÃ©ponse <text:span text:style-name="CodeDansTexte">Set-Cookie</text:span>.
undefined</text:p>
<text:p text:style-name="Code">$ node cookies/parse.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">cookies/parse.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {createServer} = require('http');</text:p><text:p text:style-name="Code">const {parse} = require('cookie');</text:p><text:p text:style-name="Code">const server = createServer().listen(4000);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">server.on('request', (request, response) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const cookies = parse(request.headers.cookie);<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.end(JSON.stringify(cookies));<text:s text:c="10"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Nous passons l&#8217;intÃ©gralitÃ© de l&#8217;en-tÃªte de requÃªte <text:span text:style-name="CodeDansTexte">Cookie</text:span> Ã  la fonction <text:span text:style-name="CodeDansTexte">cookie.parse</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">{"compteur":"1"}</text:span>.
undefined
undefined<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La mÃ©thode <text:span text:style-name="CodeDansTexte">response.setHeader()</text:span> accepte un tableau pour crÃ©er plusieurs
cookies en mÃªme temps&#160;:
undefined</text:p>
<text:p text:style-name="Code">$ node cookies/set-multiple.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">cookies/set-multiple.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {createServer} = require('http');</text:p><text:p text:style-name="Code">const {parse, serialize} = require('cookie');</text:p><text:p text:style-name="Code">const server = createServer().listen(4000);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">server.on('request', (request, response) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const {compteur} = parse(request.headers.cookie);</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const compteur2 = Number(compteur) + 1;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.setHeader('Set-Cookie', [<text:s text:c="20"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>'language=fr; Max-Age: 9000000',<text:s text:c="20"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>'is_admin=1; Path=/admin; HttpOnly',<text:s text:c="16"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>serialize('compteur', compteur2, {httpOnly: true}), <text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>//`compteur=${compteur2}; HttpOnly`<text:s text:c="17"/><text:span text:style-name="PuceCode">5</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>]);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.end();</text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Nous crÃ©ons plusieurs cookies en passant un tableau de valeurs Ã  la mÃ©thode <text:span text:style-name="CodeDansTexte">response.setHeader()</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> CrÃ©e un cookie dont la durÃ©e est limitÃ©e Ã  9&#160;millions de secondes (~104&#160;jours).<text:line-break/><text:span text:style-name="PuceCode">3</text:span> CrÃ©e un cookie visible pour le chemin d&#8217;accÃ¨s <text:span text:style-name="CodeDansTexte">/path</text:span> (et les sous-chemins)&#160;â€“ la deuxiÃ¨me directive empÃªche les scripts clients d&#8217;en lire ou modifier la valeur.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> L&#8217;utilisation de <text:span text:style-name="CodeDansTexte">cookie.serialize()</text:span> est une autre maniÃ¨re de crÃ©er des cookies en construisant un objet ECMAScript au lieu d&#8217;une chaÃ®ne de caractÃ¨res.<text:line-break/><text:span text:style-name="PuceCode">5</text:span> La ligne prÃ©cÃ©dente Ã©quivaut Ã  l&#8217;Ã©criture de cette ligne.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cet exemple est aussi l&#8217;occasion de complÃ©ter les cookies avec
des directives, qui modifient leur durÃ©e de vie et leur visibilitÃ©.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cela s&#8217;observe en lanÃ§ant Ã  nouveau le script <text:span text:style-name="CodeDansTexte">cookies/parse.js</text:span>&#160;:</text:p>
<text:p text:style-name="Code">$ node cookies/parse.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;accÃ¨s Ã  <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://localhost:4000" text:visited-style-name="Visited_20_Internet_20_Link">http://localhost:4000</text:a></text:span> affiche quelque chose comme <text:span text:style-name="CodeDansTexte">{"compteur":"1","language":"fr"}</text:span>
tandis que <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://localhost:4000/admin" text:visited-style-name="Visited_20_Internet_20_Link">http://localhost:4000/admin</text:a></text:span> affiche un cookie supplÃ©mentaire&#160;â€“
<text:span text:style-name="CodeDansTexte">{"is_admin":"1","compteur":"1","language":"fr"}</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TableauTitre">Tableau 21. Directives complÃ©mentaires Ã  la valeur d&#8217;un cookie</text:p><table:table table:style-name="Tableau1"><table:table-column />,<table:table-column /><table:table-row><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Directive</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Explication</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">Max-Age</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">DurÃ©e de vie du cookie en secondes.<text:line-break/>Si le nombre est infÃ©rieur ou Ã©gal Ã  zÃ©ro, le cookie est supprimÃ©.<text:line-break/>Si cette valeur n&#8217;est pas prÃ©cisÃ©e, le cookie est supprimÃ© Ã  la fin de la session.</text:p></text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">Domain</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">SpÃ©cifie le domaine ou les sous-domaines applicables au cookie.</text:p></text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">Path</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Contraint le cookie Ã  ce rÃ©pertoire et tous ses sous-rÃ©pertoires.</text:p></text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">Secure</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le cookie est envoyÃ© seulement si le document est demandÃ© via&#160;HTTPS.</text:p></text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">HttpOnly</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le cookie ne peut pas Ãªtre lu ou modifiÃ© cÃ´tÃ© client, via la variable <text:span text:style-name="CodeDansTexte">document.cookie</text:span>.</text:p></text:p></table:table-cell></table:table-row></table:table>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous savons maintenant garder le lien avec nos utilisateurs.
Nous utiliserons d&#8217;ailleurs les cookies pour <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-sessions"  text:visited-style-name="Visited_20_Internet_20_Link">maintenir une session</text:a>
avec un framework&#160;web.
undefined</text:p>
<text:bookmark text:name="ref-templating" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Structurer l&#8217;affichage avec les gabarits de prÃ©sentation</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les gabarits de prÃ©sentation (ou <text:span text:style-name="T4">templates</text:span>) rÃ©pondent Ã  deux problÃ¨mes&#160;:
sÃ©parer le code applicatif (le fond) de la prÃ©sentation (la forme) et aussi
structurer la complexitÃ© visuelle avec des composants rÃ©utilisables.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous allons nous pencher sur le module <text:span text:style-name="T4">nunjucks</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/nunjucks" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/nunjucks</text:a></text:span>).
undefined
Je l&#8217;apprÃ©cie pour son Ã©lÃ©gance et pour son caractÃ¨re extensible.
Il existe d'<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-templating-engines"  text:visited-style-name="Visited_20_Internet_20_Link">autres modules de prÃ©sentation</text:a> bien sÃ»r
et je vous invite Ã  choisir celui qui vous parle le plus,
quitte Ã  en changer par la suite.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">J&#8217;attends plusieurs choses d&#8217;un systÃ¨me de gabarits&#160;: itÃ©rer facilement
sur des collections (tableaux, objets), appliquer des filtres, inclure des
portions de prÃ©sentation et imbriquer ma page dans un modÃ¨le de prÃ©sentation
â€“ une sorte de dÃ©coration qui contient des choses que je veux garder hors du gabarit
(comme le menu principal ou les balises <text:span text:style-name="CodeDansTexte">&lt;meta&gt;</text:span>).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans la suite de cette section, nous allons crÃ©er une prÃ©sentation Ã  partir
d&#8217;une liste de modules&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> contenue dans un fichier&#160;JSON.
L&#8217;image suivante illustre trÃ¨s bien ce que nous cherchons Ã  atteindre.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-07/images/template.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>7-undefined.</text:span> Exemple de prÃ©sentation qui met en scÃ¨ne des donnÃ©es dynamiques et des composants&#160;HTML</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">templating/server.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {createServer} = require('http');</text:p><text:p text:style-name="Code">const {dependencies} = require('./package.json');</text:p><text:p text:style-name="Code">const njk = require('nunjucks').configure(__dirname);<text:s text:c="3"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const onRequest = (request, response) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const html = njk.render('list.njk', {<text:s text:c="17"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>title: 'Liste des dÃ©pendances',</text:p><text:p text:style-name="Code"><text:s text:c="4"/>dependencies</text:p><text:p text:style-name="Code"><text:s text:c="2"/>});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.end(html);<text:s text:c="35"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">createServer(onRequest).listen(4000);</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Nous configurons le module <text:span text:style-name="T4">nunjucks</text:span> pour qu&#8217;il cherche les gabarits dans le mÃªme rÃ©pertoire que le script de l&#8217;application.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> La mÃ©thode <text:span text:style-name="CodeDansTexte">render()</text:span> prend le contenu du fichier <text:span text:style-name="CodeDansTexte">list.njk</text:span> ainsi que les variables passÃ©es en argument pour compiler du&#160;HTML.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Ce HTML est envoyÃ© en rÃ©ponse pour Ãªtre interprÃ©tÃ© par un navigateur&#160;web.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans cet exemple, nous rÃ©pondons la mÃªme chose, peu importe le chemin demandÃ©
au serveur.
Nous pourrions tout Ã  fait ajouter un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-path"  text:visited-style-name="Visited_20_Internet_20_Link">routeur</text:a> afin de rÃ©pondre avec
un gabarit diffÃ©rent pour chacune des routes.
Nous verrons aussi dans la section <text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-express"  text:visited-style-name="Visited_20_Internet_20_Link">Organiser une application</text:a></text:span>
qu&#8217;un des buts des <text:span text:style-name="T4">frameworks</text:span> est d&#8217;apporter ce genre de cohÃ©rence.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">CÃ´tÃ© serveur, nous prenons une structure qui ne change pas (le gabarit)
et nous la combinons avec une structure qui change (les donnÃ©es) pour gÃ©nÃ©rer
un rendu HTML adaptÃ© au client Ã  l&#8217;origine de la requÃªte.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">templating/list.njk</text:p><text:p text:style-name="Code">{% extends "layout.njk" %}<text:s text:c="22"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">{% block content %}<text:s text:c="29"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">&lt;p&gt;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>Il y a {{ dependencies | length }} modules<text:s text:c="4"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>dans le fichier &lt;code&gt;package.json&lt;/code&gt;.</text:p><text:p text:style-name="Code">&lt;/p&gt;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">&lt;ul&gt;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>{% for pkg,version in dependencies %}<text:s text:c="9"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;li&gt;&lt;code&gt;{{ pkg }}@{{ version }}&lt;/code&gt;&lt;/li&gt; <text:span text:style-name="PuceCode">5</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>{% endfor %}</text:p><text:p text:style-name="Code">&lt;/ul&gt;</text:p><text:p text:style-name="Code">{% endblock %}</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Nous indiquons Ã  <text:span text:style-name="T4">nunjuck</text:span> d&#8217;envelopper ce gabarit avec la structure dÃ©crite dans <text:span text:style-name="CodeDansTexte">layout.njk</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> DÃ©but de la dÃ©claration d&#8217;un bloc nommÃ© <text:span text:style-name="CodeDansTexte">content</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> L&#8217;objet <text:span text:style-name="CodeDansTexte">dependencies</text:span> (qui est passÃ© en paramÃ¨tre au gabarit) est affichÃ© aprÃ¨s avoir Ã©tÃ© filtrÃ© avec la fonction native <text:span text:style-name="T4">nunjucks</text:span> <text:span text:style-name="CodeDansTexte">length</text:span>.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> La boucle&#160;<text:span text:style-name="CodeDansTexte">for</text:span> rÃ©pÃ¨te le bloc de gabarit pour chaque Ã©lÃ©ment de la collection&#160;â€“ Ã  la maniÃ¨re des mÃ©thodes <text:span text:style-name="CodeDansTexte">map()</text:span> et <text:span text:style-name="CodeDansTexte">forEach</text:span> des <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-array"  text:visited-style-name="Visited_20_Internet_20_Link">tableaux ECMAScript</text:a>.<text:line-break/><text:span text:style-name="PuceCode">5</text:span> Les valeurs de&#160;<text:span text:style-name="CodeDansTexte">pkg</text:span> et de <text:span text:style-name="CodeDansTexte">version</text:span> changent Ã  chaque itÃ©ration.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le gabarit se concentre sur la <text:span text:style-name="T7">transformation de donnÃ©es</text:span>.
Il faut au prÃ©alable avoir rÃ©uni et structurÃ© les donnÃ©es nÃ©cessaires Ã  l&#8217;affichage.
Nous avons la possibilitÃ© de fragmenter notre code de sorte que chaque
gabarit contienne uniquement ce qui dÃ©pend de sa responsabilitÃ©.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous retrouvons ces principes de fonctionnement dans d&#8217;autres langages, Ã  quelques
variations&#160;prÃ¨s.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">{%&#160;&#8230;&#8203;&#160;%}</text:span></text:h>
<text:p text:style-name="Remarque">Expression <text:span text:style-name="T4">nunjucks</text:span> qui marque le dÃ©but ou la fin d&#8217;un bloc.
Ce dernier contient une expression dont le contenu est affichÃ©, inclus ou rÃ©pÃ©tÃ©
selon certaines conditions.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">{{&#160;variable&#160;}}</text:span></text:h>
<text:p text:style-name="Remarque">Affichage de la valeur d&#8217;une variable sous forme d&#8217;une chaÃ®ne de caractÃ¨res.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">{{&#160;variable&#160;|&#160;filtre&#160;}}</text:span></text:h>
<text:p text:style-name="Remarque">Affichage de la valeur d&#8217;une variable aprÃ¨s application d&#8217;un filtre de transformation.
Ce dernier n&#8217;est autre qu&#8217;une fonction ECMAScript intÃ©grÃ©e au mÃ©canisme de <text:span text:style-name="T4">nunjucks</text:span>.
Nous pouvons accumuler les filtres pour transformer la valeur jusqu&#8217;Ã  obtenir
le rÃ©sultat attendu.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">IntÃ©ressons-nous maintenant au gabarit parent, <text:span text:style-name="CodeDansTexte">layout.njk</text:span>&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">templating/layout.njk</text:p><text:p text:style-name="Code">&lt;!DOCTYPE html&gt;</text:p><text:p text:style-name="Code">&lt;html lang="fr"&gt;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;meta charset="utf-8"&gt;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;head&gt;</text:p><text:p text:style-name="Code"><text:s text:c="4"/>&lt;title&gt;{{ title }}&lt;/title&gt;<text:s text:c="8"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;/head&gt;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;body&gt;</text:p><text:p text:style-name="Code"><text:s text:c="4"/>&lt;h1&gt;{{ title }}&lt;/h1&gt;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="4"/>{% block content %}{% endblock %} <text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;/body&gt;</text:p><text:p text:style-name="Code">&lt;/html&gt;</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> La variable <text:span text:style-name="CodeDansTexte">title</text:span> est un argument passÃ© au gabarit dans <text:span text:style-name="CodeDansTexte">templating/server.js</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Le bloc <text:span text:style-name="CodeDansTexte">content</text:span> dÃ©fini dans le fichier <text:span text:style-name="CodeDansTexte">list.njk</text:span> est injectÃ© Ã  cet endroit du gabarit.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce gabarit sert de <text:span text:style-name="">dÃ©coration</text:span>, en englobant puis injectant son contenu de
maniÃ¨re prÃ©cise et contrÃ´lÃ©e.
Nous sommes en mesure de hiÃ©rarchiser l&#8217;organisation de la prÃ©sentation et de
choisir comment imbriquer les gabarits entre eux.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> Gabarit et API</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">La documentation complÃ¨te des fonctions de gabarit se trouve sur
<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://mozilla.github.io/nunjucks/templating.html" text:visited-style-name="Visited_20_Internet_20_Link">https://mozilla.github.io/nunjucks/templating.html</text:a></text:span>.
La section <text:span text:style-name="Menu">API</text:span> vous aidera Ã  ajuster son intÃ©gration Ã 
votre application&#160;Node.</text:p>
<text:bookmark text:name="ref-templating-engines" /><text:p text:style-name="TableauTitre">Tableau 22. SÃ©lection de moteurs de gabarits et dans quelle situation les utiliser</text:p><table:table table:style-name="Tableau1"><table:table-column />,<table:table-column />,<table:table-column /><table:table-row><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Module</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Adresse</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Pourquoi l&#8217;utiliser ?</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>ejs</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/ejs" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/ejs</text:a></text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Pour Ã©crire ses gabarits avec ECMAScript.</text:p></text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>handlebars</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/handlebars" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/handlebars</text:a></text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Performant, Ã©prouvÃ© et large catalogue de filtres prÃªts Ã  l&#8217;emploi.</text:p></text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>nunjucks</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/nunjucks" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/nunjucks</text:a></text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">MÃ©canisme Ã©lÃ©gant de blocs, de filtres et d&#8217;hÃ©ritage de gabarit.</text:p></text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>pug</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/pug" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/pug</text:a></text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ã‰criture trÃ¨s concise des balises avec un systÃ¨me d&#8217;indentation.</text:p></text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>react</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/react" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/react</text:a></text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Pour rÃ©utiliser les mÃªmes composants que le <text:span text:style-name="T4">front-end</text:span>.</text:p></text:p></table:table-cell></table:table-row></table:table>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined
undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous dÃ©taillons des <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-templating"  text:visited-style-name="Visited_20_Internet_20_Link">exemples de rendu de gabarit</text:a>
en <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-appendix-a"  text:visited-style-name="Visited_20_Internet_20_Link">annexe&#160;A</text:a>.</text:p>
<text:bookmark text:name="ref-dev" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Pendant le dÃ©veloppement : relancer le serveur automatiquement</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Vous avez modifiÃ© un des exemples de ce chapitre pendant qu&#8217;il Ã©tait en
cours d&#8217;exÃ©cution et vous avez remarquÃ© que rÃ©sultat ne changeait pas&#160;?</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">C&#8217;est normal&#160;: la version du code utilisÃ©e par Node est celle qui a Ã©tÃ© Ã©valuÃ©e
au lancement du script.
Les <text:span text:style-name="T7">changements sont pris en compte manuellement, Ã  la prochaine exÃ©cution</text:span>,
c&#8217;est-Ã -dire aprÃ¨s avoir stoppÃ© et lancÃ© Ã  nouveau le script.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> exÃ©cutable <text:span text:style-name="T4">nodemon</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/nodemon" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/nodemon</text:a></text:span>)
relance automatiquement une commande dÃ¨s qu&#8217;il dÃ©tecte un changement
dans le rÃ©pertoire courant.
undefined</text:p>
<text:p text:style-name="Code">$ nodemon cookies/parse.js</text:p><text:p text:style-name="Code"># au lieu de "node cookies/parse.js"</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La commande prÃ©cÃ©dente relance <text:span text:style-name="CodeDansTexte">cookies/parse.js</text:span> si ce fichier change,
si un fichier dans le rÃ©pertoire <text:span text:style-name="CodeDansTexte">cookies/</text:span> Ã©volue, mais aussi si un fichier
dans les rÃ©pertoires voisins au rÃ©pertoire <text:span text:style-name="CodeDansTexte">cookies/</text:span> est modifiÃ©.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;option <text:span text:style-name="CodeDansTexte">--watch</text:span> restreint ou Ã©largit le champ d&#8217;observation.
La commande suivante relance le serveur seulement si un fichier JavaScript
est modifiÃ© dans le rÃ©pertoire <text:span text:style-name="CodeDansTexte">cookies/</text:span>&#160;:</text:p>
<text:p text:style-name="Code">$ nodemon --watch cookies cookies/parse.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;option <text:span text:style-name="CodeDansTexte">--ext</text:span> filtre les fichiers observÃ©s en fonction de leur type.
La commande suivante relance le serveur si un fichier JavaScript, CSS ou HTML
est modifiÃ© dans le rÃ©pertoire courant&#160;:</text:p>
<text:p text:style-name="Code">$ nodemon --ext js,css,html cookies/parse.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Question</text:span> Installation globale ou installation locale ?</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
undefined
Vous n&#8217;Ãªtes pas sÃ»rÂ·e de la meilleure maniÃ¨re d&#8217;installer et d&#8217;utiliser
le module <text:span text:style-name="T4">nodemon</text:span>&#160;?
Je vous invite Ã  relire la section
<text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-install.global"  text:visited-style-name="Visited_20_Internet_20_Link">ExÃ©cutable systÃ¨me</text:a></text:span>
du <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-05"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;5</text:a> consacrÃ© Ã &#160;<text:span text:style-name="CodeDansTexte">npm</text:span>.</text:p>
<text:bookmark text:name="ref-express" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Organiser une application avec le framework Express</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La section prÃ©cÃ©dente a dÃ©taillÃ© un ensemble de fonctionnalitÃ©s individuelles
qui permettent Ã  la fois de mieux comprendre comment fonctionne HTTP, mais aussi
comment constituer des briques d&#8217;une application web avec&#160;Node.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les <text:span text:style-name="T4">frameworks applicatifs web</text:span> sont des outils qui proposent de crÃ©er une
cohÃ©rence dans l&#8217;organisation de ces fonctionnalitÃ©s, de sorte que nos
efforts se concentrent plus sur l&#8217;Ã©criture du code et moins sur la crÃ©ation du cadre.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans cette section, je vous propose d&#8217;appliquer ces connaissances au framework
<text:span text:style-name="T4">Express</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/express" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/express</text:a></text:span>).
C&#8217;est un outil flexible et bien documentÃ©, un choix de prÃ©dilection pour commencer.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Vous pouvez vous en tenir Ã  ce framework ou bien Ã©voluer ou complÃ©ter son utilisation
avec <text:span text:style-name="T4">fastify</text:span> (plus rÃ©cent et plus rapide), <text:span text:style-name="T4">restify</text:span> (orientÃ© <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-api"  text:visited-style-name="Visited_20_Internet_20_Link">API&#160;REST</text:a>),
<text:span text:style-name="T4">koa</text:span> (asynchrone et plus rapide) ou encore <text:span text:style-name="T4">hapi</text:span> (plus structurÃ© et plus complexe).
undefined
undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">J&#8217;ai une prÃ©fÃ©rence pour les outils qui ne font pas trop de choix Ã  notre place,
bien documentÃ©s et, si possible, qui travaillent autour du
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-http"  text:visited-style-name="Visited_20_Internet_20_Link">module&#160;<text:span text:style-name="CodeDansTexte">http</text:span></text:a>&#160;â€“ cela conserve une certaine
clartÃ© autour des concepts que nous manipulons.
undefined</text:p>
<text:bookmark text:name="ref-setup" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Configuration du framework</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La configuration initiale d'<text:span text:style-name="T4">Express</text:span> dÃ©finit un serveur&#160;HTTP&#160;â€“ Ã  la maniÃ¨re
de ce que nous faisions avec <text:span text:style-name="CodeDansTexte">http.createServer()</text:span>&#160;â€“ et retourne
un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-paths"  text:visited-style-name="Visited_20_Internet_20_Link">routeur</text:a> pour attacher des comportements Ã  des chemins d&#8217;accÃ¨s.
undefined</text:p>
<text:p text:style-name="Code">$ node framework/setup.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">framework/setup.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const app = require('express')();<text:s text:c="17"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">app.get('/', (request, response) =&gt; {<text:s text:c="13"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.send('&lt;a href="/login"&gt;connexion&lt;/a&gt;');<text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">app.get('/login', (request, response) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.send('&lt;p&gt;En travaux&lt;/p&gt;');</text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">app.listen(4000);<text:s text:c="33"/><text:span text:style-name="PuceCode">4</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> CrÃ©ation de l&#8217;application Express.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> DÃ©claration d&#8217;une <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-paths"  text:visited-style-name="Visited_20_Internet_20_Link">route</text:a> pour la page d&#8217;accueil.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> La mÃ©thode <text:span text:style-name="CodeDansTexte">response.send()</text:span> est un raccourci qui combine et configure <text:span text:style-name="CodeDansTexte">response.write()</text:span>, <text:span text:style-name="CodeDansTexte">response.statusCode</text:span> et de <text:span text:style-name="CodeDansTexte">response.end()</text:span>.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Branchement du serveur HTTP sur l&#8217;interface rÃ©seau du systÃ¨me d&#8217;exploitation.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">C&#8217;est vraiment trÃ¨s proche de ce que nous avons dÃ©jÃ  appris
Ã  faire dans les sections <text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-server"  text:visited-style-name="Visited_20_Internet_20_Link">DÃ©marrer un serveur HTTP</text:a></text:span> et
<text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-paths"  text:visited-style-name="Visited_20_Internet_20_Link">RÃ©pondre Ã  un chemin</text:a></text:span>.
undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> Quelles mÃ©thodes et pour quoi faire ?</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
undefined
La documentation d&#8217;Express est le meilleur endroit pour savoir quoi faire
avec les diffÃ©rents objets du module.
Sa lecture vous aidera Ã  mieux suivre cette section car vous comprendrez
d&#8217;oÃ¹ sortent les mÃ©thodes utilisÃ©es.</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="T7">Express</text:span>&#160;: <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://expressjs.com/fr/4x/api.html#express" text:visited-style-name="Visited_20_Internet_20_Link">https://expressjs.com/fr/4x/api.html#express</text:a></text:span></text:p>
</text:list-item><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="T7">Application</text:span>&#160;: <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://expressjs.com/fr/4x/api.html#app" text:visited-style-name="Visited_20_Internet_20_Link">https://expressjs.com/fr/4x/api.html#app</text:a></text:span></text:p>
</text:list-item><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="T7">RequÃªte</text:span>&#160;: <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://expressjs.com/fr/4x/api.html#req" text:visited-style-name="Visited_20_Internet_20_Link">https://expressjs.com/fr/4x/api.html#req</text:a></text:span></text:p>
</text:list-item><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="T7">RÃ©ponse</text:span>&#160;: <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://expressjs.com/fr/4x/api.html#res" text:visited-style-name="Visited_20_Internet_20_Link">https://expressjs.com/fr/4x/api.html#res</text:a></text:span></text:p>
</text:list-item><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="T7">Routeur</text:span>&#160;: <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://expressjs.com/fr/4x/api.html#routeur" text:visited-style-name="Visited_20_Internet_20_Link">https://expressjs.com/fr/4x/api.html#routeur</text:a></text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-middleware" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Greffer des extensions (middlewares)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un des premiers Ã©lÃ©ments diffÃ©renciant est le <text:span text:style-name="T7">branchement d&#8217;extensions</text:span>.
Une fois configurÃ©es, ces extensions s&#8217;appliquent Ã  chaque requÃªte entrante.
Elles ajoutent des capacitÃ©s de comprÃ©hension de la requÃªte
(<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-post"  text:visited-style-name="Visited_20_Internet_20_Link">parser des donnÃ©es de formulaire</text:a> par exemple), de modifier la rÃ©ponse
ou de <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-views"  text:visited-style-name="Visited_20_Internet_20_Link">connecter des gabarits de prÃ©sentation</text:a>.
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Chaque couche de transformation est appelÃ©e un middleware&#160;â€“ une fonction
intermÃ©diaire entre la requÃªte et la rÃ©ponse.</text:p>
<text:p text:style-name="Code">$ node framework/middleware.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">framework/middleware.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const app = require('express')();</text:p><text:p text:style-name="Code">const {random} = require('pokemon');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">app.use((request, response, next) =&gt; {<text:s text:c="12"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.locals.pokemon = random();<text:s text:c="13"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>next();<text:s text:c="41"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">app.get('/', (request, response) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const {pokemon} = response.locals;<text:s text:c="14"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.send(`PokÃ©mon alÃ©atoire : ${pokemon}`);<text:span text:style-name="PuceCode">5</text:span></text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">app.listen(4000);</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Un middleware se branche avec la mÃ©thode <text:span text:style-name="CodeDansTexte">app.use()</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> L&#8217;objet <text:span text:style-name="CodeDansTexte">response.locals</text:span> passe des donnÃ©es jusqu&#8217;Ã  la route&#160;â€“ qui sont effacÃ©es une fois la rÃ©ponse envoyÃ©e.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> La fonction <text:span text:style-name="CodeDansTexte">next()</text:span> passe la main au prochain middleware.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Nous rÃ©cupÃ©rons l&#8217;objet <text:span text:style-name="CodeDansTexte">response.locals.pokemon</text:span> crÃ©Ã© par notre middleware.<text:line-break/><text:span text:style-name="PuceCode">5</text:span> Affichage d&#8217;un message similaire Ã  <text:span text:style-name="CodeDansTexte">PokÃ©mon alÃ©atoire&#160;: Patrat</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un middleware n&#8217;est pas trÃ¨s diffÃ©rent d&#8217;une route&#160;: c&#8217;est une fonction
qui a accÃ¨s Ã  la requÃªte et Ã  la rÃ©ponse HTTP.
Elle n&#8217;est pas forcÃ©ment affectÃ©e Ã  une mÃ©thode HTTP (<text:span text:style-name="CodeDansTexte">app.get()</text:span>, <text:span text:style-name="CodeDansTexte">app.post()</text:span>)
ni Ã  un chemin d&#8217;accÃ¨s.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans l&#8217;exemple suivant, nous allons connecter plusieurs middlewares grÃ¢ce
aux modules&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> <text:span text:style-name="T4">helmet</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/helmet" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/helmet</text:a></text:span>) et <text:span text:style-name="T4">serve-static</text:span>
(<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/serve-static" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/serve-static</text:a></text:span>).
undefined
undefined
undefined
undefined
Ce dernier est une version embarquÃ©e de <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-static"  text:visited-style-name="Visited_20_Internet_20_Link">serve</text:a> par le module <text:span text:style-name="T4">Express</text:span>.</text:p>
<text:p text:style-name="Code">$ node framework/middleware-multi.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">framework/middleware-multi.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const express = require('express');</text:p><text:p text:style-name="Code">const helmet = require('helmet');</text:p><text:p text:style-name="Code">const {join} = require('path');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const app = express();</text:p><text:p text:style-name="Code">const filepath = join(__dirname, '..', 'static', 'files');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">app.use('/files', express.static(filepath));<text:s text:c="10"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">app.use(helmet());<text:s text:c="36"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">app.get('/', (request, response) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.send('&lt;img src="/files/screenshot.jpg"&gt;'); <text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">app.listen(4000);</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Nous branchons le middleware utilisÃ© dans la section <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-static"  text:visited-style-name="Visited_20_Internet_20_Link">rÃ©pondre avec des fichiers statiques</text:a> sur l&#8217;URL <text:span text:style-name="CodeDansTexte">{serveUrl}/files</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Nous branchons les middlewares de <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-security"  text:visited-style-name="Visited_20_Internet_20_Link">sÃ©curitÃ©</text:a> Ã  notre application.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> La racine de l&#8217;application affiche une image contenue dans un autre rÃ©pertoire.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le mÃ©canisme de middlewares est minimaliste, et pourtant, il nous permet de
brancher des modules dont le seul prÃ©-requis est de comprendre les objets
de requÃªte et de rÃ©ponse HTTP.
<text:span text:style-name="T7">Les middlewares relient tous les concepts</text:span> Ã©voquÃ©s dans la section
<text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-webapp"  text:visited-style-name="Visited_20_Internet_20_Link">Composer son application&#160;web</text:a></text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">Extraits des en-tÃªtes d&#8217;une rÃ©ponse HTTP une fois le module helmet configurÃ©</text:p><text:p text:style-name="Code">$ curl --head http://localhost:4000</text:p><text:p text:style-name="Code">HTTP/1.1 200 OK</text:p><text:p text:style-name="Code">X-DNS-Prefetch-Control: off</text:p><text:p text:style-name="Code">X-Frame-Options: SAMEORIGIN</text:p><text:p text:style-name="Code">Strict-Transport-Security: max-age=15552000; includeSubDomains</text:p><text:p text:style-name="Code">X-Download-Options: noopen</text:p><text:p text:style-name="Code">X-Content-Type-Options: nosniff</text:p><text:p text:style-name="Code">X-XSS-Protection: 1; mode=block</text:p><text:p text:style-name="Code">Content-Type: text/html; charset=utf-8</text:p><text:p text:style-name="Code">Content-Length: 33</text:p><text:p text:style-name="Code">ETag: W/"21-tmPtjMCysQ8MzbRDY67vN+isCos"</text:p><text:p text:style-name="Code">Date: Sun, 15 Jul 2018 17:12:48 GMT</text:p><text:p text:style-name="Code">Connection: keep-alive</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le module <text:span text:style-name="T4">helmet</text:span> agit seulement sur les en-tÃªtes de rÃ©ponse.
Nous verrons dans la section <text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-security"  text:visited-style-name="Visited_20_Internet_20_Link">ProtÃ©ger nos applications</text:a></text:span> quels
en-tÃªtes sont essentiels Ã  la sÃ©curitÃ© et pourquoi.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Enfin, notons une mÃ©thode alternative pour appliquer un middleware&#160;: au niveau
d&#8217;une route, au lieu de toutes les routes&#160;â€“ avec <text:span text:style-name="CodeDansTexte">app.use()</text:span>.
Pour cela, nous allons transformer l&#8217;exemple <text:span text:style-name="CodeDansTexte">framework/middleware.js</text:span> et
l&#8217;appliquer Ã  une seule route&#160;:</text:p>
<text:p text:style-name="Code">$ node framework/middleware-function.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">framework/middleware-function.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const app = require('express')();</text:p><text:p text:style-name="Code">const {random} = require('pokemon');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const pokÃ©Middleware = (request, response, next) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.locals.pokemon = random();</text:p><text:p text:style-name="Code"><text:s text:c="2"/>next();</text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const affichePokÃ© = (request, response) =&gt; {<text:s text:c="8"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>const {pokemon} = response.locals;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.send(`PokÃ©mon alÃ©atoire : ${pokemon}`);</text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">app.get('/', pokÃ©Middleware, affichePokÃ©);<text:s text:c="10"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">app.get('/rondoudou', affichePokÃ©);<text:s text:c="17"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">app.listen(4000);</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Nous avons factorisÃ© la route dans une fonction afin de la rendre rÃ©utilisable.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> La route&#160;<text:span text:style-name="CodeDansTexte">/</text:span> reÃ§oit d&#8217;abord le middleware, puis la fonction d&#8217;affichage.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> La route <text:span text:style-name="CodeDansTexte">/rondoudou</text:span> reÃ§oit uniquement la fonction d&#8217;affichage.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous verrons que, mÃªme si la fonction d&#8217;affichage est identique, les routes
<text:span text:style-name="CodeDansTexte"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://localhost:4000/" text:visited-style-name="Visited_20_Internet_20_Link">http://localhost:4000/</text:a></text:span> et <text:span text:style-name="CodeDansTexte"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://localhost:4000/rondoudou" text:visited-style-name="Visited_20_Internet_20_Link">http://localhost:4000/rondoudou</text:a></text:span> produisent des rÃ©sultats diffÃ©rents.
Cette derniÃ¨re n&#8217;ayant pas reÃ§u le middleware <text:span text:style-name="CodeDansTexte">pokÃ©Middleware</text:span>, sa variable
<text:span text:style-name="CodeDansTexte">response.locals.pokemon</text:span> n&#8217;a pas Ã©tÃ© dÃ©finie et elle vaut donc <text:span text:style-name="CodeDansTexte">undefined</text:span>.</text:p>
<text:bookmark text:name="ref-views" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Brancher les gabarits de prÃ©sentation</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La configuration des gabarits de prÃ©sentation n&#8217;est pas trÃ¨s diffÃ©rente
de ce que nous avons vu dans la section <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-templating"  text:visited-style-name="Visited_20_Internet_20_Link">qui leur est consacrÃ©e</text:a>.</text:p>
<text:p text:style-name="Code">$ node framework/templating.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">framework/templating.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const app = require('express')();</text:p><text:p text:style-name="Code">const njk = require('nunjucks').configure(__dirname);<text:s text:c="3"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">njk.express(app);<text:s text:c="39"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">app.get('/', (request, response) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.render('index.njk', { message: 'Coucou !' });<text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">app.listen(4000);</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Configuration de <text:span text:style-name="T4">nunjucks</text:span>, comme dans la section <text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-templating"  text:visited-style-name="Visited_20_Internet_20_Link">structurer l&#8217;affichage avec les gabarits de prÃ©sentation</text:a></text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Utilisation de la mÃ©thode <text:span text:style-name="CodeDansTexte">express()</text:span> pour laisser Ã  <text:span text:style-name="T4">nunjucks</text:span> le travail de configuration d&#8217;Express.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Nous appelons la mÃ©thode <text:span text:style-name="CodeDansTexte">response.render()</text:span> au lieu de <text:span text:style-name="CodeDansTexte">response.send()</text:span>&#160;â€“ elle charge le gabarit donnÃ© et lui passe un objet dont chaque clÃ© devient une variable.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous avons de la chance car <text:span text:style-name="T4">nunjucks</text:span> prend en charge toute la configuration
d'<text:span text:style-name="T4">Express</text:span> pour nous.
undefined
La seule diffÃ©rence avec les prÃ©cÃ©dents exemples est l&#8217;utilisation de la
mÃ©thode <text:span text:style-name="CodeDansTexte">response.render()</text:span>.
Le premier effet que cela me fait est une sensation de lÃ©gÃ¨retÃ©&#160;â€“ nous avons
le strict minimum Ã  gÃ©rer pour que cela fonctionne.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">En comparaison, voici comment <text:span text:style-name="T4">Express</text:span> se configure Ã  la main&#160;:</text:p>
<text:p text:style-name="Code">$ node framework/templating-manual.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">framework/templating-manual.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const app = require('express')();</text:p><text:p text:style-name="Code">const njk = require('nunjucks');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">app.set('views', __dirname);<text:s text:c="18"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">app.engine('njk', (file, options, next) =&gt; {<text:s text:c="2"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>const html = njk.render(file, options);<text:s text:c="5"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>next(null, html);<text:s text:c="27"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">app.get('/', (request, response) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.render('index.njk', { message: 'Coucou !' });</text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">app.listen(4000);</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> On indique Ã  <text:span text:style-name="T4">Express</text:span> de contextualiser le rÃ©pertoire racine oÃ¹ se trouvent les gabarits.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> DÃ©claration de la fonction de rendu pour les fichiers&#160;<text:span text:style-name="CodeDansTexte">.njk</text:span>&#160;â€“ elle est lancÃ©e Ã  chaque fois que <text:span text:style-name="CodeDansTexte">response.render()</text:span> est appelÃ©e avec un fichier&#160;<text:span text:style-name="CodeDansTexte">.njk</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Rendu du fichier passÃ© en paramÃ¨tre.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Le HTML gÃ©nÃ©rÃ© est passÃ© Ã  la fonction de rappel <text:span text:style-name="CodeDansTexte">next()</text:span>&#160;â€“ le premier argument est utilisÃ© pour transmettre une erreur, le second le rÃ©sultat en cas de succÃ¨s.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette mÃ©thode demande davantage de travail.
Elle implique aussi d&#8217;Ãªtre suffisamment familierÂ·Ã¨re avec <text:span text:style-name="T4">Express</text:span> pour en
venir Ã  crÃ©er cette fonction de rendu.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Au final, nous pourrions utiliser diffÃ©rents moteurs de gabarits si le besoin
se faisait ressentir, pour les exploiter Ã  leur(s) avantage(s).
Leur intÃ©gration demande un effort minimum et retire tous les aspects de
prÃ©sentation de la configuration du routeur.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Pratique</text:span> Un module pour les prÃ©senter tous</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
Le module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> <text:span text:style-name="T4">consolidate</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/consolidate" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/consolidate</text:a></text:span>)
gomme les diffÃ©rences de configuration pour plusieurs dizaines de moteurs
de gabarit.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Il vous sera utile si vous peinez Ã  configurer <text:span text:style-name="T4">Express</text:span> avec votre
moteur de gabarits favori.</text:p>
<text:bookmark text:name="ref-frontend" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">IntÃ©grer les ressources front-end (CSS, images, JavaScript)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La gestion des ressources <text:span text:style-name="T4">front-end</text:span> ne demande pas Ã  changer nos habitudes.
Les fichiers CSS, JavaScript et les images sont des fichiers statiques
Ã  mettre Ã  disposition via un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-middleware"  text:visited-style-name="Visited_20_Internet_20_Link">middleware</text:a>.</text:p>
<text:p text:style-name="Code">$ node framework/assets.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">framework/assets.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const express = require('express');</text:p><text:p text:style-name="Code">const app = express();</text:p><text:p text:style-name="Code">const {join} = require('path');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const files_dir = join(__dirname, '..', 'static', 'files');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">app.use('/static', express.static(files_dir));<text:s text:c="10"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">app.get('/', (request, response) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.write('&lt;img src="/static/screenshot.jpg"&gt;'); <text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.end();</text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">app.listen(4000);</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> La mÃ©thode <text:span text:style-name="CodeDansTexte">express.static()</text:span> configure le module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> <text:span text:style-name="T4">send</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affichage d&#8217;une image dont la source <text:span text:style-name="CodeDansTexte">screenshot.jpg</text:span> est Ã  la racine du rÃ©pertoire virtuel <text:span text:style-name="CodeDansTexte">/static</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">J&#8217;ai tendance Ã  exposer les fichiers statiques depuis un rÃ©pertoire virtuel dÃ©diÃ©
â€“ ici, <text:span text:style-name="CodeDansTexte">/static</text:span>.
Cela rend <text:span text:style-name="T7">plus clairement identifiables</text:span> et Ã©vite toute ambiguÃ¯tÃ© avec les
autres routes de l&#8217;application.
Cela a aussi l&#8217;avantage de dissocier les fichiers sources (Sass, Less, etc.)
des fichiers compilÃ©s.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-05"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;5</text:a>, j&#8217;explique comment
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-run-all"  text:visited-style-name="Visited_20_Internet_20_Link">automatiser l&#8217;outillage projet</text:a>.
undefined
undefined
Ces connaissances s&#8217;appliquent dans notre cas de figure, sans distinction.<text:line-break/>L&#8217;extrait suivant de fichier <text:span text:style-name="CodeDansTexte">package.json</text:span> illustre l&#8217;organisation
des scripts pour dÃ©marrer le site en temps normal, pour gÃ©nÃ©rer les fichiers
compilÃ©s et pour le faire en continu dans un contexte de dÃ©veloppement.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">package.json</text:p><text:p text:style-name="Code">{</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"...": "...",</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"scripts": {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"build": "npm-run-all 'build:*'",</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"build:css": "node-sass ./assets --output ./assets",</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"start": "node assets.js",</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"...": "...",</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"dev": "npm-run-all 'watch:*'",</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"watch:server": "nodemon assets.js",</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"watch:css": "npm run build:css -- --watch --source-map"</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">}</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La premiÃ¨re partie est dÃ©diÃ©e aux scripts dits <text:span text:style-name="">de production</text:span>&#160;:
<text:span text:style-name="CodeDansTexte">npm run build</text:span> gÃ©nÃ¨re les fichiers utiles quand le serveur tourne,
aprÃ¨s avoir lancÃ© <text:span text:style-name="CodeDansTexte">npm start</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La seconde partie lance le serveur de dÃ©veloppement et la construction
des fichiers Sass en continu avec l&#8217;option <text:span text:style-name="CodeDansTexte">--watch</text:span>.
L&#8217;option <text:span text:style-name="CodeDansTexte">--source-map</text:span> s&#8217;utilisent dans un contexte de dÃ©veloppement pour
associer les lignes du fichier compilÃ© aux fichiers sources.
Les doubles tirets&#160;(<text:span text:style-name="CodeDansTexte">--</text:span>) nous permettent de rÃ©utiliser le script
<text:span text:style-name="CodeDansTexte">build:css</text:span> en lui passant deux options supplÃ©mentaires.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le middleware statique s&#8217;utilise aussi avec des fichiers.</text:p>
<text:p text:style-name="Code">$ node framework/assets-file.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">framework/assets-file.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const express = require('express');</text:p><text:p text:style-name="Code">const app = express();</text:p><text:p text:style-name="Code">const {join} = require('path');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const files_dir = join(__dirname, '..', 'static', 'files');</text:p><text:p text:style-name="Code">const image_path = join(files_dir, 'screenshot.jpg');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">app.use('/wikipedia.jpg', express.static(image_path));<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">app.get('/', (request, response) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.write('&lt;img src="/wikipedia.jpg"&gt;');<text:s text:c="9"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.end();</text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">app.listen(4000);</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Nous dÃ©finissions le fichier statique <text:span text:style-name="CodeDansTexte">/wikipedia.jpg</text:span> alors qu&#8217;il Ã©tait initialement nommÃ© <text:span text:style-name="CodeDansTexte">screenshot.jpg</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Ce chemin d&#8217;accÃ¨s affiche bien l&#8217;image attendue.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette technique est utilisable pour exposer un seul fichier au lieu d&#8217;un rÃ©pertoire entier.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Enfin, le module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> <text:span text:style-name="T4">express-minify</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/express-minify" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/express-minify</text:a></text:span>)
est Ã  considÃ©rer pour profiter d&#8217;une mise en place rapide ou
pour prototyper quelque chose en attendant de mettre en place un outillage
plus robuste.</text:p>
<text:p text:style-name="Code">$ node framework/minify.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">framework/minify.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const express = require('express');</text:p><text:p text:style-name="Code">const app = express();</text:p><text:p text:style-name="Code">const minify = require('express-minify');</text:p><text:p text:style-name="Code">const {join} = require('path');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">express.static.mime.define({ 'text/x-scss': ['scss'] });<text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">app.use(minify());<text:s text:c="38"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">app.use('/static', express.static(join(__dirname, 'assets')));</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">app.get('/', (request, response) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.write(</text:p><text:p text:style-name="Code"><text:s text:c="4"/>'&lt;link rel="stylesheet" href="/static/main.scss"&gt;'<text:s text:c="2"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>);</text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.end('&lt;p&gt;Coucou !&lt;/p&gt;');</text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">app.listen(4000);</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Le module <text:span text:style-name="T4">express-minify</text:span> transforme les fichiers Sass si leur en-tÃªte de rÃ©ponse <text:span text:style-name="CodeDansTexte">Content-Type</text:span> vaut <text:span text:style-name="CodeDansTexte">text/x-scss</text:span>&#160;â€“ cette ligne affecte cet en-tÃªte aux fichiers dont l&#8217;extension est&#160;<text:span text:style-name="CodeDansTexte">.scss</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Ajout du module comme <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-middleware"  text:visited-style-name="Visited_20_Internet_20_Link">middleware</text:a>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Le fichier <text:span text:style-name="CodeDansTexte">main.scss</text:span> sera converti en&#160;CSS.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Si ce module permet de dÃ©marrer plus vite, sans avoir Ã  se familiariser
avec les scripts&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> ni mÃªme avec la commande <text:span text:style-name="CodeDansTexte">node-sass</text:span>,
je lui vois deux inconvÃ©nients majeurs&#160;: les <text:span text:style-name="T7">erreurs sont difficiles Ã  dÃ©celer</text:span>
et elles risquent de se produire au cas oÃ¹ notre machine de dÃ©veloppement est
significativement diffÃ©rente du serveur de production (compilateur,
installation manquÃ©e).
Cela reprÃ©sente aussi un <text:span text:style-name="T7">gÃ¢chis de ressources</text:span> dans la mesure oÃ¹ ces fichiers
ne changent plus une fois mis en ligne&#160;; cela ne justifie pas d&#8217;ajouter
du temps de compilation Ã  la volÃ©e.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">En clair, c&#8217;est pratique pour dÃ©panner et pour dÃ©marrer.</text:p>
<text:bookmark text:name="ref-database" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Brancher une base de donnÃ©es</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;utilisation d&#8217;une base de donnÃ©es sert Ã  mÃ©moriser des informations entre
deux redÃ©marrages de notre application&#160;â€“ sinon, ce qui est en mÃ©moire
applicative disparaÃ®t.
Je vous recommande de lire la section <text:span text:style-name=""></text:span> pour Ã©clairer votre choix.</text:p>
<text:p text:style-name="Code">$ node framework/database.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">framework/database.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const app = require('express')();</text:p><text:p text:style-name="Code">const sqlite = require('sqlite');</text:p><text:p text:style-name="Code">const {join} = require('path');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">sqlite.open(join(__dirname, 'db.sqlite')).then(db =&gt; {<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>app.get('/', (req, res) =&gt; res.redirect('book/1'));</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>app.get('/book/:id', (request, response) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>const {id} = request.params;</text:p><text:p text:style-name="Code"><text:s text:c="4"/>db.get('SELECT * from books WHERE id = ?', id)<text:s text:c="6"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="6"/>.then(record =&gt; {<text:s text:c="33"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="8"/>record</text:p><text:p text:style-name="Code"><text:s text:c="10"/>? response.send(record)<text:s text:c="23"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code"><text:s text:c="10"/>: response.status(404).send('Livre inconnu');</text:p><text:p text:style-name="Code"><text:s text:c="6"/>});</text:p><text:p text:style-name="Code"><text:s text:c="2"/>});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>app.listen(4000);</text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> La connexion Ã  la base de donnÃ©es est asynchrone&#160;â€“ l&#8217;objet&#160;<text:span text:style-name="CodeDansTexte">db</text:span> qui permet d&#8217;exÃ©cuter des requÃªtes est renvoyÃ© par la promesse.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> ExÃ©cution d&#8217;une requÃªte avec un paramÃ¨tre issu du <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-path"  text:visited-style-name="Visited_20_Internet_20_Link">routage</text:a>&#160;â€“ le champ&#160;<text:span text:style-name="CodeDansTexte">:id</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Le rÃ©sultat est fourni lors de la rÃ©solution de la promesse&#160;â€“ il vaut <text:span text:style-name="CodeDansTexte">undefined</text:span> si aucun enregistrement n&#8217;a Ã©tÃ© trouvÃ©.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Affichage de l&#8217;enregistrement cÃ´tÃ© client (sans mise en forme aucune).<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;intÃ©gration d&#8217;une base de donnÃ©es se fait en deux temps&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">D&#8217;abord, on ouvre une connexion asynchrone.
Les connexions HTTP sont acceptÃ©es seulement si la connexion Ã  la base rÃ©ussit.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">La rÃ©ponse est renvoyÃ©e aprÃ¨s avoir fait un aller-retour vers la base
afin d&#8217;en extraire un ou plusieurs rÃ©sultat(s).</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">SÃ©curitÃ©</text:span> SystÃ©matiser les emplacements de paramÃ¨tre</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
L&#8217;utilisation des <text:span text:style-name="T4">emplacements de paramÃ¨tre</text:span> dans les requÃªtes SQL avec
le caractÃ¨re&#160;<text:span text:style-name="CodeDansTexte">?</text:span> renforce la sÃ©curitÃ© de notre application.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">La valeur est filtrÃ©e pour Ã©viter de dÃ©jouer le moteur de base de donnÃ©es en
le faisant planter ou en exposant davantage d&#8217;informations que prÃ©vues.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous verrons dans la section <text:span text:style-name=""></text:span> qu&#8217;un des enjeux est de rendre
le fichier de dÃ©marrage le plus fin possible.</text:p>
<text:bookmark text:name="ref-sessions" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Sessions utilisateurs</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous avons appris Ã  mÃ©moriser des donnÃ©es et Ã  les partager avec un serveur
grÃ¢ce au mÃ©canisme des <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-cookies"  text:visited-style-name="Visited_20_Internet_20_Link">cookies</text:a>.
Les sessions utilisateur centralisent cette mÃ©moire du cÃ´tÃ© du serveur.
Elles se basent sur un <text:span text:style-name="T7">cookie de session</text:span> pour garder un lien.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les sessions sont destinÃ©es Ã  <text:span text:style-name="T7">stocker des donnÃ©es temporaires</text:span>, liÃ©es Ã  une
personne.
Un utilisateur peut avoir plusieurs sessions&#160;â€“ une par appareil par exemple.
Chaque session est propre Ã  son environnement immÃ©diat.
Elles sont pratiques pour mÃ©moriser des informations liÃ©es Ã  un Ã©tat
(connectÃ©Â·e, dÃ©connectÃ©Â·e, date de derniÃ¨re activitÃ©).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Tout stockage qui serait permanent relÃ¨ve des <text:span text:style-name="T4">prÃ©fÃ©rences utilisateur</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;extension <text:span text:style-name="T4">express-session</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/express-session" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/express-session</text:a></text:span>)
se charge de ce travail pour nous.
undefined
undefined
Il ajoute un Ã©lÃ©ment <text:span text:style-name="CodeDansTexte">request.session</text:span> qu&#8217;il mÃ©morise et rÃ©cupÃ¨re Ã  partir
d&#8217;un identifiant de session difficile Ã  deviner.</text:p>
<text:p text:style-name="Code">$ node framework/session.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">framework/session.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const app = require('express')();</text:p><text:p text:style-name="Code">const session = require('express-session');</text:p><text:p text:style-name="Code">const {random} = require('pokemon');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">app.use(session({ secret: 'fromage' }));<text:s text:c="15"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">app.get('/', (req, res) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>req.session.pokemon = random();<text:s text:c="22"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>res.redirect('my-pokemon');</text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">app.get('/my-pokemon', (request, response) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const {pokemon} = request.session;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.send(`Mon PokÃ©mon en session : ${pokemon}`);<text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">app.listen(4000);</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Configuration du middleware avec un secret qui rend moins prÃ©visible le nom du <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-cookies"  text:visited-style-name="Visited_20_Internet_20_Link">cookie</text:a>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> CrÃ©ation d&#8217;une donnÃ©e de session nommÃ©e <text:span text:style-name="CodeDansTexte">pokemon</text:span>, de valeur alÃ©atoire.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche un message similaire Ã  <text:span text:style-name="CodeDansTexte">Mon PokÃ©mon en session&#160;: Pikachu</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La mÃªme valeur s&#8217;affiche si vous ouvrez un nouvel onglet dans le mÃªme navigateur
et en vous rendant sur <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://localhost:4000/my-pokemon" text:visited-style-name="Visited_20_Internet_20_Link">http://localhost:4000/my-pokemon</text:a></text:span>.
Le serveur fait le lien entre votre identifiant de session (stockÃ© en cookie)
et les valeurs associÃ©es (stockÃ©es en mÃ©moire, pour l&#8217;instant) grÃ¢ce Ã  un identifiant
unique stockÃ© dans le cookie de session.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le middleware de session retrouve les informations associÃ©es Ã  cet identifiant
depuis l&#8217;espace de stockage des donnÃ©es de sessions.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">Extrait des en-tÃªtes de rÃ©ponse Ã  l&#8217;origine de la crÃ©ation du cookie de session</text:p><text:p text:style-name="Code">$ curl -i -L http://localhost:4000</text:p><text:p text:style-name="Code">HTTP/1.1 302 Found</text:p><text:p text:style-name="Code">Location: my-pokemon</text:p><text:p text:style-name="Code">Content-Type: text/plain; charset=utf-8</text:p><text:p text:style-name="Code">Content-Length: 32</text:p><text:p text:style-name="Code"><text:span text:style-name="CodeExergue">set-cookie</text:span>: connect.sid=s%3AWfP...SRr5Q; Path=/; HttpOnly</text:p><text:p text:style-name="Code">Date: Tue, 17 Jul 2018 09:46:15 GMT</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le seul inconvÃ©nient Ã  notre exemple est que, si nous stoppons puis relanÃ§ons
le serveur, la page <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://localhost:4000/my-pokemon" text:visited-style-name="Visited_20_Internet_20_Link">http://localhost:4000/my-pokemon</text:a></text:span> affiche
<text:span text:style-name="CodeDansTexte">undefined</text:span> comme nom de PokÃ©mon.
C&#8217;est normal&#160;: le stockage par dÃ©faut Ã©tant en mÃ©moire, les donnÃ©es de session
sont dÃ©truites dÃ¨s que le processus Node s&#8217;interrompt.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Fort heureusement pour nous, ces donnÃ©es se stockent avec la
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-database-choice"  text:visited-style-name="Visited_20_Internet_20_Link">base de donnÃ©es de notre choix</text:a>.
Nous allons utiliser le moteur de base de donnÃ©es <text:span text:style-name="T4">SQLite</text:span>
Ã  l&#8217;aide du module <text:span text:style-name="T4">connect-sqlite3</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/connect-sqlite3" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/connect-sqlite3</text:a></text:span>)
pour illustrer la persistance des donnÃ©es de session.
undefined
undefined</text:p>
<text:p text:style-name="Code">$ node framework/session-database.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">framework/session-database.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const app = require('express')();</text:p><text:p text:style-name="Code">const session = require('express-session');</text:p><text:p text:style-name="Code">const SQLiteStore = require('connect-sqlite3')(session);<text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">const {random} = require('pokemon');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">app.use(session({</text:p><text:p text:style-name="Code"><text:s text:c="2"/>secret: 'fromage',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>store: new SQLiteStore('./sessions')<text:s text:c="18"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">}));</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">app.get('/', (req, res) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>req.session.pokemon = random();<text:s text:c="23"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>res.redirect('my-pokemon');</text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">app.get('/my-pokemon', (request, response) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const {pokemon} = request.session;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.send(`Mon PokÃ©mon en session : ${pokemon}`);</text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">app.listen(4000);</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Branchement du module de stockage au gestionnaire de sessions d'<text:span text:style-name="T4">Express</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Configuration du connecteur de stockage et de l&#8217;emplacement du fichier qui contient les donnÃ©es des sessions.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> L&#8217;Ã©criture et la lecture des donnÃ©es de session est inchangÃ©e.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette fois, si nous stoppons le serveur puis le relanÃ§ons, le gestionnaire de
sessions affiche le nom de PokÃ©mon associÃ© Ã  notre identifiant.
La persistance a fonctionnÃ©&#160;!</text:p>
<text:bookmark text:name="ref-logs" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Tracer les actions&#160;(logs)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Consigner les actions (<text:span text:style-name="T4">logging</text:span> en anglais) est une pratique courante
en informatique pour crÃ©er une mÃ©moire de l&#8217;activitÃ© d&#8217;une application.
Ces consignes aident Ã  garder des traces de choses invisibles en surface,
d&#8217;Ã©vÃ©nements sensibles ou critiques (envoi de mot de passe, crÃ©ation de compte)
afin de dÃ©tecter des anomalies de frÃ©quence.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">C&#8217;est un endroit idÃ©al pour rÃ©pertorier les erreurs avec des indications qui
aideraient Ã  reproduire le problÃ¨me.
D&#8217;ailleurs, l&#8217;usage est de tenir un journal d&#8217;erreurs sÃ©parÃ© du journal des
Ã©vÃ©nements afin de retrouver plus facilement ces premiÃ¨res.
J&#8217;ai tendance Ã  prÃ©fÃ©rer l&#8217;installation d&#8217;une sonde (section
<text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-exceptions"  text:visited-style-name="Visited_20_Internet_20_Link">S&#8217;informer des erreurs applicatives</text:a></text:span>
du <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-06"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;6</text:a>).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">C&#8217;est <text:span text:style-name="T7">Ã  nous de choisir la granularitÃ© des informations</text:span> enregistrÃ©es.
Nous sommes responsables de l&#8217;anonymat de ces informations et de ne
rendre personnel que l&#8217;identifiant (numÃ©rique ou gÃ©nÃ©rÃ©)
pour rattacher des informations Ã  un utilisateur si c&#8217;est nÃ©cessaire
â€“ dans le cas de transaction bancaire ou de renvoi de mot de passe par exemple.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Attention</text:span> Rotation de&#160;logs</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Consigner des informations est bien jusqu&#8217;au moment oÃ¹ l&#8217;historique finit
par saturer le disque dur de la machine qui hÃ©berge l&#8217;application.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Sous Linux, le logiciel <text:span text:style-name="T4">logrotate</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://doc.ubuntu-fr.org/logrotate" text:visited-style-name="Visited_20_Internet_20_Link">https://doc.ubuntu-fr.org/logrotate</text:a></text:span>)
est souvent installÃ© par dÃ©faut.
Il indique au systÃ¨me quand tronquer le fichier d&#8217;historique&#160;â€“
tous les X&#160;mÃ©gaoctets, tous les X&#160;jours.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les modules&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> pour consigner nos actions fonctionnent comme des
<text:span text:style-name="CodeDansTexte">console.log()</text:span> finement configurables&#160;: <text:span text:style-name="T4">winston</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/winston" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/winston</text:a></text:span>),
<text:span text:style-name="T4">morgan</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/morgan" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/morgan</text:a></text:span>) et <text:span text:style-name="T4">bunyan</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/bunyan" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/bunyan</text:a></text:span>)
sont Ã  essayer, pour voir celui qui vous convient le mieux.
undefined
undefined
undefined
undefined</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-07/images/heroku-logs.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>7-undefined.</text:span> Extrait de logs retournÃ©s par une application hÃ©bergÃ©e chez Heroku</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les journaux de sortie se connectent Ã  des logiciels comme <text:span text:style-name="T4">rsyslog</text:span>
(<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://rsyslog.com" text:visited-style-name="Visited_20_Internet_20_Link">https://rsyslog.com</text:a></text:span>) ou Ã  des services en ligne comme
<text:span text:style-name="T4">Papertrail</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://papertrailapp.com" text:visited-style-name="Visited_20_Internet_20_Link">https://papertrailapp.com</text:a></text:span>), <text:span text:style-name="T4">Logstash</text:span>
(<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://elastic.co/products/logstash" text:visited-style-name="Visited_20_Internet_20_Link">https://elastic.co/products/logstash</text:a></text:span>) et <text:span text:style-name="T4">AWS&#160;CloudWatch</text:span>
(<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://aws.amazon.com/cloudwatch" text:visited-style-name="Visited_20_Internet_20_Link">https://aws.amazon.com/cloudwatch</text:a></text:span>).
Elles vous aident&#160;â€“ ou vous demandent de travailler davantage&#160;â€“ pour visualiser,
orchestrer et dÃ©clencher des actions quand des valeurs spÃ©cifiques sont rencontrÃ©es
dans les journaux.</text:p>
<text:bookmark text:name="ref-modularity" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Vers un code rÃ©utilisable et testable</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;intention de cette section est de consolider les diffÃ©rents concepts
Ã©voquÃ©s au cours de ce chapitre.
Nous avons composÃ© pas Ã  pas une application web jusqu&#8217;Ã  l&#8217;organiser avec
le framework <text:span text:style-name="T4">Express</text:span>.
Maintenant, nous allons rÃ©organiser les composants pour amÃ©liorer la
maintenance et la robustesse aux changements de nos applications&#160;web.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Notre but&#160;?
<text:span text:style-name="T7">Diminuer la taille du script de lancement</text:span>, rendre les composants indÃ©pendants
et prÃ©parer au mieux les donnÃ©es passÃ©es Ã  nos gabarits pour faciliter
l&#8217;Ã©criture de tests et favoriser l&#8217;automatisation du dÃ©ploiement.</text:p>
<text:bookmark text:name="ref-modulariser_le_code_des_routes" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Modulariser le code des routes</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le dÃ©fi de lisibilitÃ© et de maintenance augmente au fur et Ã  mesure que
le volume de code augmente.
C&#8217;est particuliÃ¨rement vrai quand le nombre de lignes dÃ©passe un seuil
psychologique dans un mÃªme fichier&#160;â€“ je commence Ã  saturer au-delÃ  de 100&#160;lignes,
par exemple.
Ce phÃ©nomÃ¨ne se renforce quand plusieurs concepts s&#8217;entrecroisent visuellement.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La modularisation des routes et de notre application web va nous rendre la vie
plus confortable.
Nous ouvrons la porte Ã  l&#8217;Ã©criture de <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-tests.unit"  text:visited-style-name="Visited_20_Internet_20_Link">tests unitaires</text:a>, Ã  un
dÃ©placement plus aisÃ© du code et Ã  une quasi-disparition des variables globales.
Nous en profitons pour rendre nos intentions explicites, ce Ã  quoi nous obligent
les rÃ©flexions de nommage de fichiers et de fonctions.
undefined
undefined</text:p>
<text:p text:style-name="Code">$ node modularity/01/server.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">modularity/01/server.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const app = require('express')();</text:p><text:p text:style-name="Code">const dbPromise = require('./src/database.js'); <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">const routes = require('./src/routes.js');<text:s text:c="6"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">dbPromise.then(() =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>app.get('/books/:id', routes.books);<text:s text:c="10"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>app.listen(4000);</text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Nous dÃ©plaÃ§ons la configuration de et la connexion Ã  la base de donnÃ©es dans son propre module.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Nous dÃ©plaÃ§ons aussi le code des routes.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Au premier coup d&#8217;Å“il, la route est une association de chemin et d&#8217;une fonction.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous crÃ©ons des modules qui retournent des fonctions ou des objets.
Nous connectons ensuite ces fonctions aux chemins d&#8217;accÃ¨s du routeur.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Profitons du mÃ©canisme de promesses pour que tout autre module
puisse rÃ©agir Ã  l&#8217;aboutissement de la connexion&#160;:
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">modularity/01/src/database.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const sqlite = require('sqlite');</text:p><text:p text:style-name="Code">const {join} = require('path');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const db_dir = join(</text:p><text:p text:style-name="Code"><text:s text:c="2"/>__dirname, '..', '..', '..', 'framework'<text:s text:c="14"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">module.exports = sqlite.open(join(db_dir, 'db.sqlite'));<text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Nous rÃ©utilisons la base de donnÃ©es d&#8217;un exemple prÃ©cÃ©dent.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> La fonction <text:span text:style-name="CodeDansTexte">sqlite.open()</text:span> retourne une promesse rÃ©solue lorsque la connexion Ã  la base est Ã©tablie.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Notons que nous exploitons le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-require"  text:visited-style-name="Visited_20_Internet_20_Link">mÃ©canisme de cache</text:a>
des modules Node dans cette derniÃ¨re ligne.
Chaque appel au fichier <text:span text:style-name="CodeDansTexte">database.js</text:span> retourne la mÃªme promesse.
Nous crÃ©ons ainsi une seule connexion Ã  la base de donnÃ©es mÃªme si nous chargeons
plusieurs fois ce module.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Je trouve agrÃ©able de regrouper ce genre de lignes de code dans un mÃªme fichier.
Les dÃ©pendances aux modules Node et&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> deviennent vraiment claires.
Je suis moins dÃ©rangÃ© par l&#8217;organisation visuelle du code&#160;â€“ elle aurait ralenti
ma lecture du fichier <text:span text:style-name="CodeDansTexte">server.js</text:span> autrement.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">modularity/01/src/routes.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">module.exports.books = require('./routes/books.js');</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le fichier de routes a vocation Ã  rÃ©exporter les fonctions de routage.
Je trouve que cette organisation sous forme de catalogue fait Ã©normÃ©ment
gagner en lisibilitÃ© lors de l&#8217;intÃ©gration avec le routeur.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le dernier morceau est la route elle-mÃªme&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">modularity/01/src/routes/books.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const dbPromise = require('../database.js');<text:s text:c="10"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">module.exports = (request, response) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const {id} = request.params;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>dbPromise.then(db =&gt; {<text:s text:c="30"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>db.get('SELECT * from books WHERE id = ?', id)</text:p><text:p text:style-name="Code"><text:s text:c="6"/>.then(record =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="8"/>if (!record) {</text:p><text:p text:style-name="Code"><text:s text:c="10"/>return response.status(404).send('Livre inconnu');</text:p><text:p text:style-name="Code"><text:s text:c="8"/>}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="8"/>response.send(record);</text:p><text:p text:style-name="Code"><text:s text:c="6"/>});</text:p><text:p text:style-name="Code"><text:s text:c="2"/>});</text:p><text:p text:style-name="Code">};</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> RÃ©cupÃ©ration de la promesse de connexion Ã  la base de donnÃ©es&#160;â€“ dÃ©jÃ  prÃ©-configurÃ©e.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> De fait, l&#8217;exÃ©cution d&#8217;une requÃªte dÃ©pend de la rÃ©solution de la connexion.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le code de la route est quasi inchangÃ© mais on voit Ã  quel point elle prenait
de la place dans le code d&#8217;origine.
Ce dÃ©placement rÃ©vÃ¨le le positionnement du point d&#8217;attention et quels fichiers
sont amenÃ©s Ã  changer au quotidien.
Peu importe l&#8217;organisation du vÃ´tre, ce qui compte c&#8217;est que cette organisation
vous convienne, qu&#8217;elle soit communicable aux personnes qui utilisent ce code
et que nous puissions en suivre le fil logique.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Je vois toutefois apparaÃ®tre une zone d&#8217;ombre&#160;: je ne suis pas satisfait
de la connexion Ã  la base de donnÃ©es.
C&#8217;est la rÃ©solution de la promesse dans la route qui me fait dire Ã§a&#160;; elle ne
semble pas Ã  sa place.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Faisons une nouvelle itÃ©ration pour ajuster ce code et tendre vers quelque
chose d&#8217;un peu plus explicite.</text:p>
<text:p text:style-name="Code">$ node modularity/02/server.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">modularity/02/server.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const app = require('express')();</text:p><text:p text:style-name="Code">const {dbPromise, routes} = require('./configure'); <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">dbPromise.then((db) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>app.get('/books/:id', routes.books(db));<text:s text:c="10"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>app.listen(4000);</text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Nous regroupons les Ã©lÃ©ments de configuration de l&#8217;application.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Nous passons les dÃ©pendances du module en argument&#160;â€“ ici, l&#8217;objet de base de donnÃ©es.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La grande diffÃ©rence ici est l&#8217;invocation d&#8217;une fonction pour dÃ©finir la route.
C&#8217;est le moyen le plus propre pour transmettre une variable en enlevant la
dÃ©pendance au module <text:span text:style-name="CodeDansTexte">database.js</text:span> dans le script <text:span text:style-name="CodeDansTexte">books.js</text:span>&#160;:
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">modularity/02/src/routes/books.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">module.exports = (db) =&gt; {<text:s text:c="26"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>return (request, response) =&gt; {<text:s text:c="19"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>const {id} = request.params;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="4"/>db.get('SELECT * from books WHERE id = ?', id)</text:p><text:p text:style-name="Code"><text:s text:c="6"/>.then(record =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="8"/>if (!record) {</text:p><text:p text:style-name="Code"><text:s text:c="10"/>return response.status(404).send('Livre inconnu');</text:p><text:p text:style-name="Code"><text:s text:c="8"/>}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="8"/>response.send(record);</text:p><text:p text:style-name="Code"><text:s text:c="6"/>});</text:p><text:p text:style-name="Code"><text:s text:c="2"/>};</text:p><text:p text:style-name="Code">};</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Cette fois, nous exportons une fonction qui accepte un objet de base de donnÃ©es en argument.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Le code exÃ©cutÃ© par le routeur est la fonction qui est retournÃ©e&#160;ici.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;appel Ã  la fonction <text:span text:style-name="CodeDansTexte">require()</text:span> a disparu.
La rÃ©solution de la promesse aussi.
Notre module est autonome tant qu&#8217;il reÃ§oit un objet de base de donnÃ©es en
paramÃ¨tres.
Cela le rend nettement plus lisible&#160;â€“ le code est dÃ©sormais uniquement liÃ©
Ã  la rÃ©ception d&#8217;une requÃªte HTTP et Ã  l&#8217;Ã©tablissement d&#8217;une rÃ©ponse.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">modularity/02/configure.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const dbPromise = require('./src/database.js');</text:p><text:p text:style-name="Code">const routes = require('./src/routes.js');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">module.exports = {dbPromise, routes};<text:s text:c="5"/><text:span text:style-name="PuceCode">1</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Nous utilisons la syntaxe raccourcie de crÃ©ation d&#8217;objets pour les exporter en une seule&#160;fois.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous retrouvons le mÃªme mÃ©canisme que celui rencontrÃ© dans le fichier <text:span text:style-name="CodeDansTexte">routes.js</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Au final, le motif qui Ã©merge est celui de
l'<text:span text:style-name="T7">encapsulation de code dans des fonctions paramÃ©trables</text:span>.
Les paramÃ¨tres sont les seuls points d&#8217;entrÃ©e.
Les arguments font office de contrat et les fichiers font office de regroupement
logique&#160;â€“ de fonctions et d&#8217;objets.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous avons allÃ©gÃ© le fichier <text:span text:style-name="CodeDansTexte">server.js</text:span> et rendu lisibles les points importants
de l&#8217;application&#160;: la connexion Ã  la base de donnÃ©es, le rendu d&#8217;une route
et la configuration de l&#8217;application.
Ce travail va nous permettre de tester petit Ã  petit les diffÃ©rents Ã©lÃ©ments
de l&#8217;application web, par ordre de criticitÃ©.</text:p>
<text:bookmark text:name="ref-tests.unit" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Un code testable est un code indÃ©pendant du framework</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;Ã©criture de tests unitaires est influencÃ©e par et influence l&#8217;organisation
de notre code en unitÃ©s rÃ©utilisables.
Ils accroissent la qualitÃ©, la confiance et la prÃ©dictibilitÃ© d&#8217;une Ã©ventuelle
mise en ligne.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette section se dÃ©roule dans la continuitÃ© de la prÃ©cÃ©dente.
Nous allons prÃ©parer et mettre en place pas Ã  pas un environnement de test
pour vÃ©rifier les intentions de notre&#160;code.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les tests unitaires sont destinÃ©s Ã  couvrir les diffÃ©rents cas de figure
des entrÃ©es et des sorties de nos fonctions.
Nous testons leurs rÃ©actions aux arguments pour vÃ©rifier que nous obtenons
le rÃ©sultat attendu.
Je teste en prioritÃ© le code critique, partagÃ© (en tant que bibliothÃ¨que) et
qui est au plus proche de l&#8217;interface utilisateur.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">De quoi a-t-on besoin pour tester <text:span text:style-name="CodeDansTexte">routes/books.js</text:span>&#160;?
La fonction qui est exportÃ©e par le module dÃ©pend d&#8217;une connexion Ã©tablie
Ã  une base de donnÃ©es et de deux objets&#160;â€“ la requÃªte entrante et la rÃ©ponse sortante.
Nous avons aussi besoin d&#8217;Ã©crire des <text:span text:style-name="T4">assertions</text:span> et, dans un premier temps, nous
allons utiliser le module dÃ©diÃ© de&#160;Node.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">testing/tests/initial.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const assert = require('assert').strict;</text:p><text:p text:style-name="Code">const configRoute = require('../src/routes/books.js');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">assert.deepEqual(typeof configRoute, 'function'); <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">/*</text:p><text:p text:style-name="Code">const db = require('../src/database.js');<text:s text:c="9"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">const route = configRoute(db);</text:p><text:p text:style-name="Code">assert.deepEqual(route(request, response));</text:p><text:p text:style-name="Code">*/</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> C&#8217;est notre premiÃ¨re assertion&#160;â€“ l&#8217;Ã©lÃ©ment retournÃ© par <text:span text:style-name="CodeDansTexte">routes/books.js</text:span> est une fonction.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> En commentaire&#160;: comment allons-nous nous connecter Ã  la base de donnÃ©es&#160;?<text:line-break/></text:p>
<text:p text:style-name="Code">$ node testing/tests/initial.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le script n&#8217;affiche rien de particulier.
C&#8217;est normal, parce que le test s&#8217;est bien passÃ©.
Une assertion lance une erreur si elle constate un rÃ©sultat diffÃ©rent de l&#8217;attente.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous avons toutefois testÃ© une Ã©vidence, que le module retourne une fonction.
Ce qui serait plus rÃ©vÃ©lateur serait de tester l&#8217;invocation de cette fonction
pour vÃ©rifier qu&#8217;elle produit un rÃ©sultat prÃ©dictible.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Modifions notre fichier de test pour Ã©tablir une connexion Ã  la base de donnÃ©es.
Nous avons une contrainte toutefois&#160;: nous devons utiliser une base dont
l&#8217;emplacement est diffÃ©rent de notre environnement de dÃ©veloppement.
Le raisonnement est de pouvoir la recrÃ©er et la dÃ©truire sans craindre
de gÃ©nÃ©rer des effets secondaires, y compris si nous exÃ©cutons les tests
sur le serveur de production.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Pour ce faire, commenÃ§ons par simplifier le fichier <text:span text:style-name="CodeDansTexte">src/database.js</text:span> en
supprimant tout chemin d&#8217;accÃ¨s Ã©crit en&#160;dur&#160;:
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">testing/src/database.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const sqlite = require('sqlite');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const connect = (db_path) =&gt; sqlite.open(db_path);<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">module.exports = connect;<text:s text:c="27"/><text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Le module n&#8217;a plus d&#8217;opinion sur l&#8217;emplacement de la base de donnÃ©es.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Le module exporte dÃ©sormais une fonction Ã  paramÃ©trer lors de son exÃ©cution.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cela ouvre la voie pour nous connecter Ã  une base de donnÃ©es diffÃ©rente
dans notre script de tests.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">testing/tests/with-db.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const assert = require('assert').strict;</text:p><text:p text:style-name="Code">const configRoute = require('../src/routes/books.js');</text:p><text:p text:style-name="Code">const database = require('../src/database.js');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">// assert.deepEqual(typeof configRoute, 'function');<text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">database(':memory:').then(db =&gt; {<text:s text:c="19"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>const route = configRoute(db);<text:s text:c="20"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>assert.deepEqual(typeof route, 'function');<text:s text:c="7"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>/*</text:p><text:p text:style-name="Code"><text:s text:c="2"/>assert.deepEqual(route(request, response));<text:s text:c="7"/><text:span text:style-name="PuceCode">5</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>*/</text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Nous pouvons nous passer de ce test puisque nous allons tester l&#8217;exÃ©cution de la fonction.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> La valeur <text:span text:style-name="CodeDansTexte">:memory:</text:span> est une valeur spÃ©ciale de chemin d&#8217;accÃ¨s pour <text:span text:style-name="T4">SQLite</text:span>&#160;â€“ la base est crÃ©Ã©e en mÃ©moire et disparaÃ®t Ã  la fin de l&#8217;exÃ©cution du script.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Configuration de la route&#160;â€“ comme nous le faisons dans le fichier <text:span text:style-name="CodeDansTexte">configure.js</text:span>.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> La route configurÃ©e retourne bien une fonction, mais cela ne suffit pas Ã  affirmer que son fonctionnement correspond Ã  nos attentes.<text:line-break/><text:span text:style-name="PuceCode">5</text:span> En commentaire&#160;: comment tester le rÃ©sultat de la route <text:span text:style-name="T4">Express</text:span>&#160;?<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">RÃ©sultat&#160;: la connexion Ã  la base de donnÃ©es rÃ©ussit et nous sommes en mesure
de la transmettre Ã  la fonction de paramÃ©trage de la route.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le chemin d&#8217;accÃ¨s Ã©tait exprimÃ© de la maniÃ¨re suivante&#160;: <text:span text:style-name="CodeDansTexte">/books/:id</text:span>.
Autrement dit, la requÃªte Ã  la base de donnÃ©es dÃ©pend d&#8217;un objet <text:span text:style-name="CodeDansTexte">request.params</text:span>
dont la clÃ©&#160;<text:span text:style-name="CodeDansTexte">id</text:span> vaut&#160;<text:span text:style-name="CodeDansTexte">1</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">C&#8217;est ce que nous allons passer Ã  la fonction <text:span text:style-name="CodeDansTexte">route</text:span>.
Mais qu&#8217;en est-il de la rÃ©ponse&#160;? Doit-on rÃ©Ã©crire un objet qui reproduit
l&#8217;objet <text:span text:style-name="CodeDansTexte">response</text:span> d'<text:span text:style-name="T4">Express</text:span>&#160;?
Je dÃ©conseille cette option car elle nous oblige Ã  Ã©crire du code, faillible,
et donc Ã  introduire des biais dans nos propres tests.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les <text:span text:style-name="T4">bibliothÃ¨ques d&#8217;interception</text:span> Ã©vitent ce cas de figure.
Elles se greffent Ã  du code existant pour observer ses rÃ©actions, voire pour les
remplacer temporairement, le temps des tests.
J&#8217;ai l&#8217;habitude d&#8217;utiliser le module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> <text:span text:style-name="T4">sinon.js</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/sinon" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/sinon</text:a></text:span>,
<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://sinonjs.org/" text:visited-style-name="Visited_20_Internet_20_Link">https://sinonjs.org/</text:a></text:span>).
undefined
Il propose tout le nÃ©cessaire, est bien documentÃ© et fonctionne aussi bien
cÃ´tÃ© Node que cÃ´tÃ© navigateurs&#160;web.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">testing/tests/with-sinon.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const assert = require('assert').strict;</text:p><text:p text:style-name="Code">const configRoute = require('../src/routes/books.js');</text:p><text:p text:style-name="Code">const database = require('../src/database.js');</text:p><text:p text:style-name="Code">const sinon = require('sinon');</text:p><text:p text:style-name="Code">const {response} = require('express');<text:s text:c="12"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">database(':memory:').then(db =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const route = configRoute(db);</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const sendFake = sinon.stub(response, 'send');<text:s text:c="2"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>return route({params: {id: 1}}, response).then(() =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>assert.ok(sendFake.called);<text:s text:c="19"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>})</text:p><text:p text:style-name="Code">})</text:p><text:p text:style-name="Code">.catch(error =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.error(error.message);</text:p><text:p text:style-name="Code"><text:s text:c="2"/>process.exit(1);</text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Nous rÃ©cupÃ©rons l&#8217;objet de rÃ©ponse d'<text:span text:style-name="T4">Express</text:span>&#160;â€“ je l&#8217;ai dÃ©couvert en fouillant dans les objets exportÃ©s par le module.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Nous neutralisons la fonction <text:span text:style-name="CodeDansTexte">response.send()</text:span> avec un <text:span text:style-name="T4">stub</text:span> pour observer les donnÃ©es qui lui sont donnÃ©es en argument.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> La propriÃ©tÃ© <text:span text:style-name="CodeDansTexte">called</text:span> d&#8217;un <text:span text:style-name="T4">stub</text:span> ou d&#8217;un espion passe Ã  <text:span text:style-name="CodeDansTexte">true</text:span> si elle a Ã©tÃ© appelÃ©e.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">C&#8217;est une chance que le module <text:span text:style-name="T4">Express</text:span> expose directement un objet de rÃ©ponse
sans avoir Ã  attendre qu&#8217;une vraie requÃªte HTTP atteigne notre serveur web.
Le <text:span text:style-name="T4">stub</text:span> neutralise son action&#160;â€“ nous nous contentons d&#8217;observer
comment la fonction est appelÃ©e.
L&#8217;enjeu est de constater que la connexion Ã  la base de donnÃ©es se passe bien,
que la requÃªte retourne bien la ligne attendue et que ses valeurs soient
bien transmises en rÃ©ponse.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Malheureusement pour nous&#160;: la base en mÃ©moire n&#8217;a aucune donnÃ©e.
Le test Ã©choue donc.
Notre nouvel objectif est de maintenir l&#8217;intention du test et de lui ajouter
les donnÃ©es nÃ©cessaires Ã  son exÃ©cution.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Glossaire</text:span> Espions, stubs et mocks</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Les espions, <text:span text:style-name="T4">stubs</text:span> et <text:span text:style-name="T4">mocks</text:span> couvrent trois aspects complÃ©mentaires.
Les <text:span text:style-name="T7">espions enregistrent les appels</text:span> Ã  des attributs et Ã  des fonctions
â€“ le nombre de fois, quels arguments, quels rÃ©sultats.
Les <text:span text:style-name="T7"><text:span text:style-name="T4">stubs</text:span> interceptent les appels</text:span> Ã  des fonctions&#160;â€“ vous pouvez mÃªme dÃ©finir
les valeurs de retours ou de rappel en fonction des paramÃ¨tres d&#8217;appel.
Les <text:span text:style-name="T7"><text:span text:style-name="T4">mocks</text:span> interceptent les rÃ©sultats</text:span>&#160;â€“ je n&#8217;en parle pas car notre
exemple ne s&#8217;y prÃªte&#160;pas.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">C&#8217;est la raison d&#8217;Ãªtre des fichiers dits de <text:span text:style-name="T4">fixtures</text:span>.
Ces donnÃ©es peuplent une base de donnÃ©es d&#8217;enregistrements suffisamment
rÃ©alistes pour illustrer les diffÃ©rents cas de figure de notre application.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">testing/tests/fixtures.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">module.exports = async (db) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>await db.run(`CREATE TABLE books</text:p><text:p text:style-name="Code"><text:s text:c="2"/>(id INTEGER PRIMARY KEY, title VARCHAR, isbn VARCHAR);`);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>await db.run(`INSERT INTO books (title, isbn) VALUES</text:p><text:p text:style-name="Code"><text:s text:c="2"/>("Design Systems", "978-3945749586"),</text:p><text:p text:style-name="Code"><text:s text:c="2"/>("Sass pour les web designers", "977-2212141474"),</text:p><text:p text:style-name="Code"><text:s text:c="2"/>("Node.js", "978-2212139938");`);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>return db;</text:p><text:p text:style-name="Code">}</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce cas est particuliÃ¨rement adaptÃ© Ã  la syntaxe
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-async-await"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">async</text:span>/<text:span text:style-name="CodeDansTexte">await</text:span></text:a>.
undefined
undefined
undefined
Ces promesses sont sÃ©quentielles et la syntaxe linÃ©arise leur lecture.
Le mÃªme exemple sans <text:span text:style-name="CodeDansTexte">async</text:span>/<text:span text:style-name="CodeDansTexte">await</text:span> et juste avec les promesses est moins
digeste Ã &#160;lire.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il ne nous reste plus qu&#8217;Ã  appeler cette fonction de gÃ©nÃ©ration de donnÃ©es
depuis notre script de tests&#160;:
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">testing/tests/with-sinon-data.js</text:p><text:p text:style-name="Code">// ...</text:p><text:p text:style-name="Code">const loadFixtures = require('./fixtures.js');<text:s text:c="6"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">database(':memory:')</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.then(db =&gt; loadFixtures(db))<text:s text:c="21"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>.then(db =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>const route = configRoute(db);</text:p><text:p text:style-name="Code"><text:s text:c="4"/>const sendFake = sinon.stub(response, 'send');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="4"/>route({params: {id: 1}}, response).then(() =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="6"/>assert.ok(sendFake.calledWith(sinon.match({<text:s text:c="3"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="8"/>'title': 'Design Systems'<text:s text:c="19"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code"><text:s text:c="6"/>})));</text:p><text:p text:style-name="Code"><text:s text:c="4"/>})</text:p><text:p text:style-name="Code"><text:s text:c="2"/>});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Chargement du module qui contient les requÃªtes SQL nÃ©cessaires Ã  l&#8217;initialisation de la table et des donnÃ©es.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Les donnÃ©es sont chargÃ©es aprÃ¨s la connexion Ã  la base et avant l&#8217;exÃ©cution des tests.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Nous remplaÃ§ons l&#8217;appel Ã  <text:span text:style-name="CodeDansTexte">sendFake.called()</text:span> par <text:span text:style-name="CodeDansTexte">sendFake.calledWith()</text:span> pour affirmer plus explicitement le rÃ©sultat attendu.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Le module sinon propose un ensemble de fonctions de vÃ©rification (les <text:span text:style-name="T4">matchers</text:span>)&#160;â€“ ici, nous vÃ©rifions que <text:span text:style-name="CodeDansTexte">response.send()</text:span> est appelÃ©e avec un objet, qui contient au moins une clÃ© <text:span text:style-name="CodeDansTexte">title</text:span> dont la valeur est <text:span text:style-name="CodeDansTexte">Design Systems</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le test est concluant&#160;!
Et nous n&#8217;avons plus de doute que la fonction <text:span text:style-name="CodeDansTexte">response.send()</text:span>
est bien appelÃ©e avec la valeur issue de la base de donnÃ©es.
Le module <text:span text:style-name="T4">sinon</text:span> a Ã©tÃ© d&#8217;une grande aide pour intercepter l&#8217;exÃ©cution de cette
fonction et pour nous faciliter son introspection, aprÃ¨s&#160;coup.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Pour Ãªtre exhaustifs, il nous faudrait maintenant tester le deuxiÃ¨me cas de figure,
celui oÃ¹ le paramÃ¨tre&#160;<text:span text:style-name="CodeDansTexte">id</text:span> de l&#8217;URL fait rÃ©fÃ©rence Ã  un enregistrement qui
n&#8217;existe pas en base de donnÃ©es pour gÃ©nÃ©rer une erreur&#160;404.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">testing/tests/with-sinon-full.js</text:p><text:p text:style-name="Code">// ...</text:p><text:p text:style-name="Code">database(':memory:')</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.then(db =&gt; loadFixtures(db))</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.then(db =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>const route = configRoute(db);</text:p><text:p text:style-name="Code"><text:s text:c="4"/>const sendFake = sinon.stub(response, 'send');</text:p><text:p text:style-name="Code"><text:s text:c="4"/>const statusSpy = sinon.spy(response, 'status');<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="4"/>route({params: {id: 1}}, response).then(() =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="6"/>assert.ok(sendFake.called);</text:p><text:p text:style-name="Code"><text:s text:c="4"/>});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="4"/>route({params: {id: 4}}, response).then(() =&gt; {<text:s text:c="3"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="6"/>assert.ok(statusSpy.calledWith(404));<text:s text:c="11"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="6"/>assert.ok(sendFake.calledWith('Livre inconnu'));<text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>});</text:p><text:p text:style-name="Code"><text:s text:c="2"/>});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> CrÃ©ation d&#8217;un espion sur la mÃ©thode <text:span text:style-name="CodeDansTexte">response.status()</text:span> du module <text:span text:style-name="T4">Express</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> CrÃ©ation d&#8217;un deuxiÃ¨me cas de test, pour couvrir l&#8217;appel Ã  un enregistrement inconnu en base de donnÃ©es.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> La mÃ©thode <text:span text:style-name="CodeDansTexte">calledWith()</text:span> dÃ©termine si une fonction est appelÃ©e avec cette exacte valeur.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Cette mÃ©thode s&#8217;applique aussi aux <text:span text:style-name="T4">stubs</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans ce cas, nous avons eu recours Ã  un <text:span text:style-name="T4">espion</text:span> pour observer la mÃ©thode
<text:span text:style-name="CodeDansTexte">response.status()</text:span> d&#8217;Express.
Nous avons procÃ©dÃ© ainsi car nous n&#8217;avions pas Ã  neutraliser son fonctionnement
mais seulement Ã  observer la valeur de son argument.
Le fait qu&#8217;il soit de&#160;<text:span text:style-name="CodeDansTexte">404</text:span> prouve que la branche de code Ã  l&#8217;intÃ©rieur de la
condition&#160;<text:span text:style-name="CodeDansTexte">if</text:span> a bien Ã©tÃ© visitÃ©e.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Je constate un problÃ¨me dans cette Ã©criture cependant.
L&#8217;espion et le <text:span text:style-name="T4">stub</text:span> sont crÃ©Ã©s une seule fois et partagÃ©s entre chaque test.
Cette pratique entraÃ®nera des effets de bord si nous ne prÃªtons pas attention
au dÃ©roulÃ© des tests.
Ils devraient Ãªtre remis Ã  zÃ©ro entre chaque&#160;test.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les <text:span text:style-name="T4">suites de tests</text:span> sont des outils qui renforcent la cohÃ©rence
et la structure, notamment pour automatiser l&#8217;exÃ©cution d&#8217;actions avant et aprÃ¨s
des tests.
J&#8217;utilise le module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> <text:span text:style-name="T4">mocha</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/mocha" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/mocha</text:a></text:span>,
<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://mochajs.org" text:visited-style-name="Visited_20_Internet_20_Link">https://mochajs.org</text:a></text:span>), par habitude, parce qu&#8217;il ne demande aucune
configuration et parce qu&#8217;il fait le travail Ã  la fois cÃ´tÃ© Node et cÃ´tÃ©
navigateurs.
undefined
undefined</text:p>
<text:p text:style-name="Code">$ ../node_modules/.bin/mocha testing/tests/with-mocha.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">testing/tests/with-mocha.js (modules)</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const assert = require('assert').strict;</text:p><text:p text:style-name="Code">const configRoute = require('../src/routes/books.js');</text:p><text:p text:style-name="Code">const database = require('../src/database.js');</text:p><text:p text:style-name="Code">const sinon = require('sinon');</text:p><text:p text:style-name="Code">const {response} = require('express');</text:p><text:p text:style-name="Code">const loadFixtures = require('./fixtures.js');</text:p><text:p text:style-name="Code">const {describe, before, afterEach} = require('mocha'); <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">const {it:test} = require('mocha');<text:s text:c="21"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">// ...</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Import des fonctions qui dÃ©crivent respectivement la suite de tests, l&#8217;exÃ©cution de code avant le dÃ©marrage de la suite et l&#8217;exÃ©cution de code aprÃ¨s chaque&#160;test.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Import de la fonction de&#160;test.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Notre script de test comporte dÃ©sormais ce qu&#8217;on appelle une <text:span text:style-name="T4">suite de tests</text:span>,
c&#8217;est-Ã -dire, un <text:span text:style-name="T7">ensemble de tests qui expriment nos attentes</text:span> vis-Ã -vis
d&#8217;une fonctionnalitÃ©&#160;â€“ ici, une route d&#8217;application&#160;web.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">testing/tests/with-mocha.js (configuration)</text:p><text:p text:style-name="Code">// ... (modules)</text:p><text:p text:style-name="Code">describe('routes/books.js', () =&gt; {<text:s text:c="19"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>let db, route;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>before(async () =&gt; {<text:s text:c="32"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>db = await database(':memory:');</text:p><text:p text:style-name="Code"><text:s text:c="4"/>await loadFixtures(db);</text:p><text:p text:style-name="Code"><text:s text:c="4"/>route = configRoute(db);</text:p><text:p text:style-name="Code"><text:s text:c="2"/>});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>afterEach(() =&gt; sinon.restore());<text:s text:c="19"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>// ...</text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> DÃ©claration de la suite de tests&#160;â€“ sa valeur reflÃ¨te gÃ©nÃ©ralement le sujet des tests.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Avant le dÃ©marrage des tests, nous crÃ©ons la base de donnÃ©es et configurons la route.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> AprÃ¨s chaque test, nous remettons Ã  zÃ©ro l&#8217;Ã©tat de <text:span text:style-name="T4">sinon</text:span>&#160;â€“ nos tests n&#8217;ont plus la possibilitÃ© de se parasiter entre&#160;eux.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce dÃ©coupage a le mÃ©rite de clarifier les diffÃ©rents temps de nos tests,
Ã  savoir la prÃ©paration de l&#8217;environnement d&#8217;exÃ©cution, le nettoyage puis
l&#8217;exÃ©cution des&#160;tests.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">testing/tests/with-mocha.js (tests)</text:p><text:p text:style-name="Code">// ... (modules)</text:p><text:p text:style-name="Code">describe('routes/books.js', () =&gt; {<text:s text:c="19"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>// ... (configuration)</text:p><text:p text:style-name="Code"><text:s text:c="2"/>test('statut 200', () =&gt; {<text:s text:c="26"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>const sendFake = sinon.stub(response, 'send');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="4"/>return route({params: {id: 1}}, response).then(() =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="6"/>assert.ok(sendFake.calledWith(sinon.match({</text:p><text:p text:style-name="Code"><text:s text:c="8"/>'title': 'Design Systems'</text:p><text:p text:style-name="Code"><text:s text:c="6"/>})));</text:p><text:p text:style-name="Code"><text:s text:c="4"/>});</text:p><text:p text:style-name="Code"><text:s text:c="2"/>});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>test('statut 404', () =&gt; {<text:s text:c="26"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>const sendFake = sinon.stub(response, 'send');</text:p><text:p text:style-name="Code"><text:s text:c="4"/>const statusSpy = sinon.spy(response, 'status');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="4"/>return route({params: {id: 4}}, response).then(() =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="6"/>assert.ok(statusSpy.calledWith(404));</text:p><text:p text:style-name="Code"><text:s text:c="6"/>assert.ok(sendFake.calledWith('Livre inconnu'));</text:p><text:p text:style-name="Code"><text:s text:c="4"/>});</text:p><text:p text:style-name="Code"><text:s text:c="2"/>});</text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> La suite compte deux tests.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Premier test&#160;: se termine quand la promesse retournÃ©e par la fonction <text:span text:style-name="CodeDansTexte">route()</text:span> est rÃ©solue.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> DeuxiÃ¨me test&#160;: cette fois, l&#8217;espion et le stub ne sont pas affectÃ©s par le prÃ©cÃ©dent&#160;test.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La suite de tests ne cherche pas Ã  savoir comment nous testons notre code.
Son objectif est de capturer les messages d&#8217;erreur des assertions qui Ã©chouent
et de nous les communiquer en contexte.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-07/images/tests-ok.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>7-undefined.</text:span> Exemple d&#8217;une suite de tests mocha qui se termine avec succÃ¨s</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">RÃ©flexion</text:span> Ã‰criture optimiste</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Nous avons l&#8217;habitude d&#8217;Ã©crire des tests de maniÃ¨re optimiste.
Ce biais naturel fait que nous ne testons pas les cas
dont nous n&#8217;avons pas encore connaissance.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Trouver les cas de figure qui font Ã©chouer notre code est un vrai travail
de rÃ©flexion.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;approche <text:span text:style-name="T4">Test Driven Development</text:span> (<text:span text:style-name="T4">TDD</text:span>) est pilotÃ©e par les tests.
Dans ce contexte, nous Ã©crivons les tests avant mÃªme d&#8217;avoir Ã©crit notre code.
Cela nous force Ã  rÃ©flÃ©chir Ã  l&#8217;intention et Ã  concevoir
le code de maniÃ¨re Ã  ce qu&#8217;il soit testable.
Qu&#8217;on adopte ou non cette mÃ©thode, nous gagnons en qualitÃ© en faisant Ã©chouer
les tests, juste pour nous assurer que ce n&#8217;est pas un bogue (oui Ã§a arrive)
quand ils indiquent que tout est correct.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-07/images/tests-ko.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>7-undefined.</text:span> Exemple d&#8217;une suite de tests mocha dont un test Ã©choue</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Maintenant que nos tests sont Ã©crits, nous sommes en mesure de
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deployment"  text:visited-style-name="Visited_20_Internet_20_Link">dÃ©ployer notre application</text:a> automatiquement, seulement
si leur exÃ©cution est rÃ©ussie.</text:p>
<text:bookmark text:name="ref-deployment" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">DÃ©ployer automatiquement</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette section continue Ã  ajouter de l&#8217;automatisation
dans notre maniÃ¨re de fonctionner.
Elle n&#8217;est donc pas spÃ©cifique aux <text:span text:style-name="T4">frameworks</text:span> et est tout Ã  fait valide
si vous vous constituez votre propre application, brique par brique.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le dÃ©ploiement automatique sert principalement Ã  <text:span text:style-name="T7">rÃ©vÃ©ler les points de friction</text:span>.
Si nous manquons de confiance dans le dÃ©ploiement, c&#8217;est probablement qu&#8217;il
y a des nÅ“uds Ã  dÃ©mÃªler.
L&#8217;automatisation du dÃ©ploiement et la facilitÃ© de sa rÃ©pÃ©tabilitÃ© nous aident
Ã  gommer ces frictions petit Ã  petit.
La pression de la mise en production se transforme en incitation au changement.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La frÃ©quence des dÃ©ploiements <text:span text:style-name="T7">rÃ©vÃ¨le les points de congestion</text:span>.
Tout ce qui est trop lent Ã  notre goÃ»t est un appel Ã  gommer cette lenteur,
Ã  trouver une autre approche pour finalement observer le rÃ©sultat du dÃ©ploiement
plus rapidement.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;enjeu des livraisons automatisÃ©es est double&#160;: d&#8217;abord,
<text:span text:style-name="T7">faciliter le transport du code vers le serveur de production</text:span>
(en cas de bogue, le temps passÃ© concerne seulement la rÃ©solution du problÃ¨me et non
la livraison elle-mÃªme) et servir de <text:span text:style-name="T7">documentation du processus de livraison</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous abordons plus en dÃ©tail les diffÃ©rents mÃ©canismes techniques
dans le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-06"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;6</text:a>, que ce soit <text:span text:style-name="">Ã  la main</text:span>,
avec des recettes de dÃ©ploiement ou par le biais de notre service d&#8217;hÃ©bergement.</text:p>
<text:bookmark text:name="ref-advanced" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Pour aller plus loin</text:h><text:bookmark text:name="ref-advanced.server" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Pourquoi lancer un serveur ?</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il y a des environnements oÃ¹ des logiciels comme Apache et Nginx intÃ¨grent
notre langage de programmation avec des modules&#160;: par exemple, PHP avec le <text:span text:style-name="CodeDansTexte">mod_php</text:span>
ou Perl avec le <text:span text:style-name="CodeDansTexte">mod_cgi</text:span>.
Les requÃªtes entrantes sont dirigÃ©es vers un script que le module interprÃ¨te
et qui retourne une rÃ©ponse, dynamiquement.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le <text:span text:style-name="T7">script PHP est interprÃ©tÃ© Ã  chaque requÃªte</text:span> et toute cette reprÃ©sentation
est dÃ©truite une fois la rÃ©ponse envoyÃ©e (mÃ©moire, valeurs des variables, configuration).
Il faut recourir Ã  un ensemble de modules additionnels pour optimiser ce gÃ¢chis
de ressources informatiques&#160;: cache d&#8217;interprÃ©tation, cache applicatif, cache de configuration.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">DÃ©marrer un serveur HTTP dans le langage de notre application nous Ã©loigne de
ce modÃ¨le coÃ»teux et nous rapproche d&#8217;un fonctionnement plus performant, organisÃ©
autour des trois piliers suivants&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="T7">Node et Apache/Nginx fonctionnent ensemble</text:span>&#160;â€“ ils se relaient les requÃªtes
et les rÃ©ponses car ils parlent le mÃªme protocole.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="T7">Le serveur Node est <text:span text:style-name="">prÃ©chauffÃ©</text:span></text:span>&#160;â€“ une requÃªte entrante trouve une application
dÃ©jÃ  opÃ©rationnelle, dÃ©jÃ  configurÃ©e, dÃ©jÃ  connectÃ©e Ã  une base de donnÃ©es
et prÃªte Ã  rÃ©pondre.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="T7">Le code exÃ©cutÃ© est spÃ©cifique Ã  la requÃªte</text:span>&#160;â€“ l&#8217;application reÃ§oit chaque
requÃªte de maniÃ¨re indÃ©pendante en ayant le minimum d&#8217;effort Ã  faire pour
gÃ©nÃ©rer une rÃ©ponse.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Autrement dit, ce modÃ¨le rÃ©duit le temps de parcours entre une requÃªte entrante
et une rÃ©ponse sortante.
Cela a un effet significatif sur le temps d&#8217;apparition de l&#8217;icÃ´ne de chargement
cÃ´tÃ© client.</text:p>
<text:bookmark text:name="ref-http" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Comprendre le modÃ¨le&#160;HTTP</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Deux Ã©lÃ©ments ressortent du modÃ¨le de fonctionnement du protocole HTTP&#160;:
<text:span text:style-name="T7">tout est du texte</text:span> (en-tÃªtes et contenu) et <text:span text:style-name="T7">chaque requÃªte est indÃ©pendante</text:span>.
Cela revient Ã  dire que chaque requÃªte emporte son contexte avec elle, toutes les
informations nÃ©cessaires Ã  sa comprÃ©hension.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Que se passe-t-il lorsque notre navigateur web ou le programme <text:span text:style-name="CodeDansTexte">curl</text:span>
demande Ã  accÃ©der Ã  <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://example.com" text:visited-style-name="Visited_20_Internet_20_Link">http://example.com</text:a></text:span>&#160;?
undefined
undefined
undefined
undefined</text:p>
<text:p text:style-name="ListeANumero">1.<text:tab/><text:span text:style-name="T7">RÃ©solution de DNS</text:span>&#160;: un des annuaires DNS est interrogÃ© pour savoir quelle
adresse&#160;IP est associÃ©e au nom de domaine.</text:p><text:p text:style-name="ListeANumero">2.<text:tab/><text:span text:style-name="T7">Ã‰tablissement de la connexion</text:span>&#160;: le client (nous) ouvre une connexion rÃ©seau
avec le serveur pour Ã©changer des donnÃ©es.</text:p><text:p text:style-name="ListeANumero">3.<text:tab/><text:span text:style-name="T7">Envoi de la requÃªte HTTP</text:span>&#160;: la requÃªte contient des informations au format
texte (mÃ©thode, en-tÃªtes, parfois un corps de message) pour que le serveur
s&#8217;adapte au mieux Ã  notre demande.</text:p><text:p text:style-name="ListeANumero">4.<text:tab/><text:span text:style-name="T7">RÃ©ception de la requÃªte</text:span>&#160;: le serveur interprÃ¨te la demande
(est-ce qu&#8217;il la comprend&#160;?), cherche la ressource associÃ©e au chemin demandÃ©.</text:p><text:p text:style-name="ListeANumero">5.<text:tab/><text:span text:style-name="T7">Envoi de la rÃ©ponse</text:span>&#160;: le serveur rÃ©pond avec des donnÃ©es au format texte
(statut, en-tÃªtes, corps de message).</text:p><text:p text:style-name="ListeANumero">6.<text:tab/><text:span text:style-name="T7">InterprÃ©tation de la rÃ©ponse</text:span>&#160;: l&#8217;en-tÃªte <text:span text:style-name="CodeDansTexte">Content-Type</text:span> aide le client Ã  dÃ©terminer
comment afficher les informations - XML, HTML, JSON, CSS, vidÃ©o etc&#160;â€“ et si
le document contient d&#8217;autres ressources Ã  aller rÃ©cupÃ©rer.
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans le cas du programme <text:span text:style-name="CodeDansTexte">curl</text:span>, la rÃ©ponse est affichÃ©e telle quelle, en texte.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Avec un navigateur en revanche, le HTML est interprÃ©tÃ©.
Le navigateur demande les ressources listÃ©es dans les diffÃ©rentes balises
(<text:span text:style-name="CodeDansTexte">img</text:span>, <text:span text:style-name="CodeDansTexte">video</text:span>, <text:span text:style-name="CodeDansTexte">audio</text:span>)&#160;; l&#8217;indicateur de chargement
s&#8217;arrÃªte quand toutes les ressources ont Ã©tÃ© demandÃ©es et tÃ©lÃ©chargÃ©es.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-07/images/http-waterfall.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>7-undefined.</text:span> Cascade de requÃªtes HTTP suite Ã  l&#8217;interprÃ©tation d&#8217;un document HTML par un navigateur</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le nombre de requÃªtes et la taille des ressources affectent donc la vitesse de
chargement d&#8217;une page.
Plus il y en a, plus le client doit en demander et plus le serveur multiplie le
nombre de rÃ©ponses.
Le temps de tÃ©lÃ©chargement augmente.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Technique</text:span> Les WebViews sur mobile</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Les WebViews sont des composants proposÃ©s par les systÃ¨mes d&#8217;exploitation
pour embarquer du contenu HTML dans une application native.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Elles fonctionnent comme des navigateurs, sans les boutons de navigation.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> <text:span text:style-name="T4">jshttp</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://github.com/jshttp" text:visited-style-name="Visited_20_Internet_20_Link">https://github.com/jshttp</text:a></text:span>) affiche les en-tÃªtes
de rÃ©ponse comme le programme <text:span text:style-name="CodeDansTexte">curl</text:span> le ferait et dÃ©taille le parcours rÃ©seau,
de la rÃ©solution du nom de domaine jusqu&#8217;au temps passÃ© Ã  nÃ©gocier une transaction
sÃ©curisÃ©e.
undefined
Nous comprenons ainsi mieux des temps qui sont rendus invisibles et sur lesquels nous
pouvons faire des efforts&#160;â€“ rÃ©duire les temps de transfert ou le temps de rÃ©ponse
de notre application par exemple.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-07/images/httpstat.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>7-undefined.</text:span> En-tÃªtes de rÃ©ponse et durÃ©e des diffÃ©rentes Ã©tapes de l&#8217;exÃ©cution d&#8217;une requÃªte&#160;HTTP</text:p>
<text:bookmark text:name="ref-database-choice" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Quel(s) moteur(s) de base(s) de donnÃ©es choisir ?</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Quand je codais en PHP, nous parlions beaucoup de la pile technique <text:span text:style-name="T4">LAMP</text:span>
(Linux, Apache, MySQL et&#160;PHP).
C&#8217;Ã©tait la combinaison <text:span text:style-name="T4">de&#160;facto</text:span> des diffÃ©rents projets.
MySQL Ã©tait la base de donnÃ©es de choix tandis que les Pythonistes et Rubyistes
se focalisaient plutÃ´t sur PostgreSQL.
undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">J&#8217;ai croisÃ© beaucoup de dÃ©veloppeurs et dÃ©veloppeuses qui se lanÃ§aient dans
les bases de donnÃ©es dites <text:span text:style-name="">documents</text:span> comme MongoDB
<text:span text:style-name="">parce que les donnÃ©es sont stockÃ©es en&#160;JSON et donc c&#8217;est un choix logique pour Node</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Je suis fortement en dÃ©saccord avec cette derniÃ¨re affirmation et je pense que la bonne
base de donnÃ©es est celle qui tient la route par rapport Ã  Node.
Le <text:span text:style-name="T7">dÃ©bit de donnÃ©es</text:span> entre Node et la base compte davantage, ainsi que
la <text:span text:style-name="T7">rapiditÃ© de la base Ã  exÃ©cuter une requÃªte</text:span> et retourner des rÃ©sultats
(certaines gÃ¨rent mieux que d&#8217;autres la concurrence d&#8217;accÃ¨s ou les critÃ¨res
de filtrage).
Le troisiÃ¨me critÃ¨re est subjectif&#160;: c&#8217;est le <text:span text:style-name="T7">confort d&#8217;utilisation</text:span>&#160;;
PostgreSQL est peut-Ãªtre plus rapide pour un cas d&#8217;usage prÃ©cis, mais si vous
Ãªtes plus Ã  l&#8217;aise avec MariaDB ou MySQL, commencez avec la base qui vous parle
le plus&#160;â€“ ou expÃ©rimentez et rÃ©servez-vous le droit de changer d&#8217;avis aprÃ¨s
avoir jouÃ© avec un nombre reprÃ©sentatif de donnÃ©es.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Je choisis une base de donnÃ©es en fonction de plusieurs critÃ¨res&#160;:
la rapiditÃ© de lecture, l&#8217;intÃ©gritÃ© des donnÃ©es, la volumÃ©trie acceptÃ©e avant
de devoir distribuer les donnÃ©es sur plusieurs machines et enfin,
des fonctionnalitÃ©s spÃ©ciales (recherche gÃ©ographique, type de champ particulier
comme le champ&#160;JSON de PostgreSQL).
undefined
undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Stockage fichier</text:h>
<text:p text:style-name="Remarque">Nous pourrions tout Ã  fait dÃ©cider d&#8217;utiliser un fichier&#160;JSON ou CSV pour
lire et Ã©crire des donnÃ©es.
C&#8217;est facile Ã  mettre en Å“uvre, mais c&#8217;est la solution la plus lente Ã  tout
point de vue&#160;: recherche comme Ã©criture.
undefined</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Stockage en mÃ©moire</text:h>
<text:p text:style-name="Remarque">Redis et Memcached sont des gestionnaires trÃ¨s rapides en lecture et en Ã©criture.
C&#8217;est idÃ©al pour accÃ©der frÃ©quemment aux donnÃ©es et les modifier, avant
de les sauvegarder sur un stockage moins rapide mais plus sÃ»r.
Ils sont gÃ©nÃ©ralement dits <text:span text:style-name="">clÃ©/valeur</text:span> car nous cherchons un identifiant
donnÃ© pour rÃ©cupÃ©rer un, voire plusieurs champ(s) associÃ©(s).
undefined
undefined</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Stockage sur disque</text:h>
<text:p text:style-name="Remarque">MySQL, MSSQL, PostgreSQL et MongoDB stockent leurs donnÃ©es sur disque,
dans des fichiers optimisÃ©s pour la recherche d&#8217;informations&#160;â€“ les <text:span text:style-name="T4">index</text:span>.
Ces moteurs sont souvent rapides en lecture et plus lents en Ã©criture&#160;â€“ selon
le type de disque dur utilisÃ© pour le stockage.
Certains sont contraints par des schÃ©mas (bases&#160;SQL) tandis que d&#8217;autres
ont une structure libre (MongoDB).<text:line-break/>
En pratique, nous typons ou structurons les donnÃ©es d&#8217;une maniÃ¨re ou d&#8217;une autre,
a&#160;minima pour les manipuler de maniÃ¨re cohÃ©rente dans notre code.
Certaines bases SQL ont un type de champ&#160;JSON, en structure libre.
undefined
undefined
undefined
undefined
undefined</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Stockage sur un service en ligne</text:h>
<text:p text:style-name="Remarque">Firebase, DynamoDB, Parse et Kinto sont des gestionnaires de bases de donnÃ©es
accessibles comme des services, avec des requÃªtes HTTP.
Les services d&#8217;hÃ©bergement gÃ¨rent la distribution des donnÃ©es et leur sauvegarde.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">J&#8217;utilise souvent SQLite pour prototyper quelque chose de rapide sur ma machine.
Je passe ensuite Ã  MySQL ou PostsgreSQL selon le projet&#160;â€“ je me sens autonome sur
le premier pour l&#8217;installation tandis que je prÃ©fÃ¨re un service qui gÃ¨re tout de
bout en bout avec le second.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Je peux Ãªtre amenÃ© Ã  indexer les donnÃ©es dans une base Elasticsearch
ou Algolia pour leur donner une autre structure, spÃ©cialement optimisÃ©e pour
la recherche&#160;: une lecture trÃ¨s rapide sur des critÃ¨res variables.
Je le fais si un des aspects principaux du projet est de prÃ©server des performances
Ã©levÃ©es, qui ne soient pas ralenties par l&#8217;activitÃ© d&#8217;une base&#160;SQL.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Je complÃ¨te en gÃ©nÃ©ral avec Redis pour gÃ©rer les <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-job-queues"  text:visited-style-name="Visited_20_Internet_20_Link">files d&#8217;attente</text:a>,
des donnÃ©es intermÃ©diaires que je considÃ¨re comme <text:span text:style-name="">jetables</text:span>.
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">S&#8217;il est plus simple de tout gÃ©rer avec un seul support de stockage, utiliser
<text:span text:style-name="T7">plusieurs gestionnaires de bases de donnÃ©es</text:span> dans une mÃªme application est quelque chose de tout
Ã  fait encouragÃ© pour profiter de leurs caractÃ©ristiques.</text:p>
<text:bookmark text:name="ref-security" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">ProtÃ©ger nos applications</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il faut prendre des mesures de prÃ©caution dÃ¨s lors que nous utilisons des
donnÃ©es saisies par un utilisateur, c&#8217;est-Ã -dire
<text:span text:style-name="T7">toute variable dont la valeur provient de l&#8217;extÃ©rieur</text:span>.
Je pense Ã  des donnÃ©es de formulaire, des paramÃ¨tres d&#8217;URL, des chemins d&#8217;accÃ¨s,
des fichiers tÃ©lÃ©versÃ©s mais aussi des scripts qui sont injectÃ©s dans la page,
volontairement ou via un logiciel vÃ©rolÃ© installÃ© sur leur ordinateur.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/helmet" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/helmet</text:a></text:span></text:h>
<text:p text:style-name="Remarque">DÃ©joue les injections de scripts et d&#8217;iframes non&#160;sollicitÃ©es.
undefined</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/safe-regex" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/safe-regex</text:a></text:span></text:h>
<text:p text:style-name="Remarque">Filtre une expression rÃ©guliÃ¨re fournie ou composÃ©e avec une valeur fournie par un utilisateur.
Cela Ã©vite certains bogues qui surchargent la CPU ou qui dÃ©jouent les motifs des expressions.
undefined</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/dompurify" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/dompurify</text:a></text:span>, <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/xss" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/xss</text:a></text:span></text:h>
<text:p text:style-name="Remarque">Nettoie le HTML d&#8217;attributs et de balises non&#160;sollicitÃ©s.
Les injections de scripts et les Ã©vÃ©nements malintentionnÃ©s de clics sont supprimÃ©s.
undefined
undefined
undefined</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/sql-escape-string" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/sql-escape-string</text:a></text:span></text:h>
<text:p text:style-name="Remarque">Nettoie une saisie utilisateur de tout caractÃ¨re qui pourrait dÃ©jouer nos attentes
au sein d&#8217;une requÃªte&#160;SQL.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Outre les donnÃ©es arbitraires, il faut toujours s&#8217;assurer des <text:span text:style-name="T7">permissions</text:span>.
L&#8217;utilisateur a-t-il vraiment le droit d&#8217;Ãªtre lÃ  ou il est&#160;?
Le volume du fichier tÃ©lÃ©versÃ© est-il vraiment cohÃ©rent&#160;?</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;utilisation du <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-strict"  text:visited-style-name="Visited_20_Internet_20_Link">mode strict</text:a> a l&#8217;avantage
de nous protÃ©ger de l&#8217;exploitation d&#8217;anciennes bizarreries d&#8217;ECMAScript.
Ce qui doit planter plante au lieu d&#8217;Ãªtre passÃ© sous silence.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Parfois, mÃªme les caractÃ¨res autorisÃ©s suffisent Ã  dÃ©jouer notre attention.
C&#8217;est le cas si une variable est utilisÃ©e pour composer un chemin avec
<text:span text:style-name="CodeDansTexte">path.resolve()</text:span> ou <text:span text:style-name="CodeDansTexte">path.join()</text:span> par exemple.
undefined
undefined
undefined
La saisie utilisateur crÃ©e un chemin de traverse qui permet d&#8217;aller exploiter
des donnÃ©es ailleurs sur l&#8217;ordinateur.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">path-traversal.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {resolve} = require('path');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const base_dir = __dirname;</text:p><text:p text:style-name="Code">const bad_user_input = '/etc/passwd';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const resolved = resolve(base_dir, bad_user_input);</text:p><text:p text:style-name="Code">console.log(resolved);<text:s text:c="18"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">if (resolved.indexOf(base_dir) !== 0) { <text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.error(`${resolved} doit commencer par ${base_dir}`);</text:p><text:p text:style-name="Code">}</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">/etc/passwd</text:span>&#160;â€“ notre chemin de base a Ã©tÃ© complÃ¨tement remplacÃ©.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">/.../chapter-07/examples</text:span>&#160;â€“ notre chemin de base a Ã©tÃ© complÃ¨tement remplacÃ©.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un moyen solide de vÃ©rifier que nous n&#8217;avons pas Ã©tÃ© dÃ©routÃ©Â·e en dehors
d&#8217;un rÃ©pertoire racine&#160;â€“ ici, <text:span text:style-name="CodeDansTexte">base_dir</text:span>&#160;â€“ est de vÃ©rifier que le chemin final
dÃ©bute bien par le chemin du rÃ©pertoire racine.
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TableauTitre">Tableau 23. En-tÃªtes de rÃ©ponse qui ont un impact sur la sÃ©curitÃ© de navigation</text:p><table:table table:style-name="Tableau1"><table:table-column />,<table:table-column /><table:table-row><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>En-tÃªte</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Description</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">X-DNS-Prefetch-Control</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Avec la valeur <text:span text:style-name="CodeDansTexte">off</text:span>, le navigateur ne va pas proactivement chercher les informations DNS des ressources contenues dans la page. Nos informations de navigation ne sont pas divulguÃ©es Ã  notre&#160;insu.</text:p></text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">X-Frame-Options</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Avec la valeur <text:span text:style-name="CodeDansTexte">SAMEORIGIN</text:span>, le navigateur autorise la crÃ©ation d'<text:span text:style-name="CodeDansTexte">&lt;iframe&gt;</text:span> seulement depuis le mÃªme domaine â€“ les <text:span text:style-name="CodeDansTexte">&lt;iframe&gt;</text:span> tierces sont bloquÃ©es.</text:p></text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">Strict-Transport-Security</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Lorsque l&#8217;option est activÃ©e, le navigateur accÃ¨de par dÃ©faut Ã  ce site en HTTPS au lieu de&#160;HTTP.</text:p></text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">X-Download-Options</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Avec la valeur <text:span text:style-name="CodeDansTexte">noopen</text:span>, Internet Explorer tÃ©lÃ©charge un fichier au lieu de tenter de l&#8217;ouvrir dans le navigateur â€“ cela risque d&#8217;Ãªtre exploitÃ© pour pirater le navigateur par des fichiers malintentionnÃ©s.</text:p></text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">X-Content-Type-Options</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Avec la valeur <text:span text:style-name="CodeDansTexte">nosniff</text:span>, les navigateurs bloquent les scripts et les styles qui n&#8217;ont respectivement pas l&#8217;en-tÃªte <text:span text:style-name="CodeDansTexte">Content-Type</text:span> Ã  <text:span text:style-name="CodeDansTexte">application/javascript</text:span> et <text:span text:style-name="CodeDansTexte">text/css</text:span>.</text:p></text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">X-XSS-Protection</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Avec la valeur <text:span text:style-name="CodeDansTexte">1; mode=block</text:span>, les navigateurs interrompent le chargement d&#8217;une page s&#8217;ils dÃ©tectent une exploitation malintentionnÃ©e de chargement de donnÃ©es ou de fichier.</text:p></text:p></table:table-cell></table:table-row></table:table>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Guide</text:span> Open Web Application Security Project (OWASP)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
undefined
L&#8217;organisme <text:span text:style-name="T4">Open Web Application Security Project</text:span> (<text:span text:style-name="T4">OWASP</text:span>) recueille et
diffuse nombre de critÃ¨res de sÃ©curitÃ© Ã  connaÃ®tre et vÃ©rifier pour dÃ©jouer
au mieux les attaques.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Il met Ã  disposition un guide spÃ©cialisÃ© pour Node Ã  l&#8217;adresse suivante&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://nodegoat.herokuapp.com/tutorial" text:visited-style-name="Visited_20_Internet_20_Link">https://nodegoat.herokuapp.com/tutorial</text:a></text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-lambda" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Une application minimaliste avec les Lambda</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le principe d&#8217;une application web est d&#8217;afficher un rÃ©sultat Ã  partir d&#8217;un
chemin d&#8217;accÃ¨s et de rester allumÃ©e en permanence, sauf exception.
Les <text:span text:style-name="T4">Lambda</text:span> sont une approche minimaliste d&#8217;application web&#160;: il n&#8217;y a qu&#8217;une
seule route, c&#8217;est <text:span text:style-name="T7">une seule fonction qui retourne un rÃ©sultat</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;application s&#8217;endort quand elle ne reÃ§oit pas de trafic dans un laps de temps donnÃ©.
Elle est <text:span text:style-name="">rÃ©veillÃ©e</text:span> quand du trafic arrive.
La facturation se fait Ã  l&#8217;Ã©chelle de la seconde et au nombre de requÃªtes entrantes.
Nous en parlons un peu plus en dÃ©tails dans le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-06"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;6</text:a>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce mÃ©canisme s&#8217;adapte Ã  des rÃ©sultats en rÃ©action Ã  un Ã©vÃ©nement&#160;: <text:span text:style-name="T4">webhook</text:span>,
notification, erreur, etc.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> <text:span text:style-name="T4">micro</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/micro" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/micro</text:a></text:span>) est un serveur minimaliste
qui rÃ©pond Ã  ce principe de micro-application, prÃªte Ã  Ãªtre mise en pause Ã 
tout instant.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">micro.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const micro = require('micro');</text:p><text:p text:style-name="Code">const {random} = require('pokemon');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const server = micro((req, res) =&gt; random()); <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">server.listen(4000);<text:s text:c="26"/><text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Nous avons accÃ¨s Ã  la requÃªte et Ã  la rÃ©ponse, mais nous avons aussi la libertÃ© de renvoyer un rÃ©sultat Ã  la fonction de rappel.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Ã€ la maniÃ¨re d&#8217;une <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-server"  text:visited-style-name="Visited_20_Internet_20_Link">application classique</text:a>, nous la dÃ©marrons sur le port HTTP de notre choix.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un service comme <text:span text:style-name="T4">AWS&#160;Lambda</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://aws.amazon.com/lambda" text:visited-style-name="Visited_20_Internet_20_Link">https://aws.amazon.com/lambda</text:a></text:span>) pousse
le concept encore plus loin.
undefined
La fonction rÃ©agit Ã  un Ã©vÃ©nement interne (notification SQS, quelque chose liÃ©
Ã  notre infrastructure, dÃ©ploiement) ou Ã  un Ã©vÃ©nement externe (via l&#8217;API
ou un autre service ouvert vers l&#8217;extÃ©rieur).
Elle n&#8217;est pas forcÃ©ment exposÃ©e sur le&#160;Web.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">lambda.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const lambda = require('apex.js');</text:p><text:p text:style-name="Code">const {random} = require('pokemon');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">module.exports = lambda(event =&gt; random()); <text:span text:style-name="PuceCode">1</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> C&#8217;est tout ce qu&#8217;il faut pour qu&#8217;une <text:span text:style-name="T4">Lambda</text:span> retourne un rÃ©sultat utilisable pour l&#8217;appelant.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;adaptabilitÃ© de ce mÃ©canisme permet de crÃ©er une API complÃ¨te en agrÃ©geant
plusieurs <text:span text:style-name="T4">Lambda</text:span> derriÃ¨re un <text:span text:style-name="T4">portail d&#8217;API</text:span> comme <text:span text:style-name="T4">AWS&#160;API Gateway</text:span>
(<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://aws.amazon.com/api-gateway" text:visited-style-name="Visited_20_Internet_20_Link">https://aws.amazon.com/api-gateway</text:a></text:span>).
Ã€ une API et une ressource (chemin et mÃ©thode HTTP) est associÃ©e une ressource
AWS, dont les <text:span text:style-name="T4">Lambda</text:span> font partie.</text:p>
<text:bookmark text:name="ref-conclusion_7" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Conclusion</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous avons vu qu&#8217;une <text:span text:style-name="T7">application web est bÃ¢tie autour du protocole HTTP</text:span>.
Elle passe son temps Ã  interprÃ©ter le texte des requÃªtes entrantes et Ã  produire
des rÃ©ponses, elles aussi au format texte.
Ces donnÃ©es de sortie sont aussi bien issues des fichiers placÃ©s sur notre disque
que des pages HTML assemblÃ©es dynamiquement depuis une base de donnÃ©es.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les frameworks structurent notre pensÃ©e et automatisent l&#8217;application de
vÃ©rifications et de transformations pour toutes les requÃªtes entrantes.
Une fois le concept maÃ®trisÃ©, il devient plus facile d&#8217;en essayer de nouveaux
et d&#8217;utiliser celui qui nous plaÃ®t le plus.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous avons aussi constatÃ© qu&#8217;une <text:span text:style-name="T7">approche modulaire permet d&#8217;interchanger des modules</text:span>
entre eux, mais aussi qu&#8217;elle amÃ¨ne naturellement Ã  une structure adaptÃ©e aux
frameworks et Ã  l&#8217;Ã©criture de tests, indispensables pour amÃ©liorer la
confiance dans notre code et pour en automatiser les dÃ©ploiements.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le protocole HTTP est une pierre angulaire du Web tel que nous l&#8217;utilisons.
Le pratiquer avec Node est un bon moyen de le comprendre par la pratique.</text:p>
<text:bookmark text:name="ref-chapter-08" /><text:p text:style-name="ChapitreNumero">8</text:p><text:h text:style-name="ChapitreTitre" text:outline-level="1">CrÃ©er un outil en ligne de commande</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">CrÃ©er un outil en ligne de commande est un savoir utile pour forger ses
propres outils, automatiser des actions et mieux s&#8217;intÃ©grer au
systÃ¨me d&#8217;exploitation.</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">CrÃ©er un script exÃ©cutable.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Du script au programme interactif.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Vers un code rÃ©utilisable et testable.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Utilisation dâ€™un framework dâ€™application en ligne de commandes.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">GÃ©rer les chemins d&#8217;accÃ¨s et les flux de donnÃ©es.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Rendre le programme indÃ©pendant de&#160;Node.</text:p>
</text:list-item></text:list>
<text:p text:style-name="ChapitreIntroduction"><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce chapitre est une invitation Ã  crÃ©er des applications au plus proche des
systÃ¨mes d&#8217;exploitation, lÃ  oÃ¹ Node excelle.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous apprendrons Ã  passer d&#8217;un script Node ordinaire Ã  un script qui
s&#8217;exÃ©cute comme un programme de notre systÃ¨me d&#8217;exploitation.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous complÃ©terons ce programme en amÃ©liorant son expÃ©rience utilisateur
mais aussi en le rendant robuste grÃ¢ce aux tests et Ã  l&#8217;Ã©criture d&#8217;une
documentation minimaliste, gÃ©nÃ©rÃ©e automatiquement.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Enfin, nous verrons aussi comment aller plus loin en organisation son code
comme dans une vÃ©ritable application, avec une comprÃ©hension plus poussÃ©e
des chemins d&#8217;accÃ¨s et des traitements en continu sur des flux de donnÃ©es.</text:p></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Remarque</text:span> Versions de Node et npm</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Le contenu de ce chapitre utilise les versions <text:span text:style-name="T7">Node&#160;v10</text:span>
et <text:span text:style-name="T7">npm&#160;v6</text:span>.
Ce sont les versions stables recommandÃ©es en&#160;2019.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un script en ligne de commande revient souvent Ã  une installation globale
d&#8217;un module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> (<text:span text:style-name="CodeDansTexte">npm install --global &lt;module&gt;</text:span>).
undefined
undefined
Il prend aussi bien la forme d&#8217;un petit outil que d&#8217;une application complÃ¨te.
Dans tous les cas, le terminal est l&#8217;interface d&#8217;affichage.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Node est particuliÃ¨rement adaptÃ© Ã  la crÃ©ation d&#8217;outils en ligne de commande
grÃ¢ce Ã  son modÃ¨le de gestion mÃ©moire et son processus unique.
Il doit toutefois partager la mÃ©moire et les ressources de la machine avec
les autres programmes&#160;â€“ Ã  nous de faire le choix de la frugalitÃ©.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ces codes nous servent Ã  outiller nos projets, Ã  crÃ©er des programmes autonomes,
des interfaces visuelles dans un terminal et Ã  automatiser ce qui doit l&#8217;Ãªtre.
Leur distribution sur le registre&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>
(<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-05"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;5</text:a>) en facilite l&#8217;accÃ¨s et le partage,
surtout si vous les avez bien <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-tests"  text:visited-style-name="Visited_20_Internet_20_Link">testÃ©s et documentÃ©s</text:a>.</text:p>
<text:bookmark text:name="ref-start" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">CrÃ©er un script exÃ©cutable</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La premiÃ¨re Ã©tape est de rendre exÃ©cutable votre script Node.
Le systÃ¨me d&#8217;exploitation ne le percevra plus comme un simple fichier texte,
mais bel et bien comme un programme, au mÃªme titre que l&#8217;exÃ©cutable&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous allons apprendre ce cheminement ensemble, jusqu&#8217;Ã  rendre notre
code distribuable sous forme d&#8217;un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-modules"  text:visited-style-name="Visited_20_Internet_20_Link">module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span></text:a>
(<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-05"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;5</text:a>).</text:p>
<text:bookmark text:name="ref-script" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Au dÃ©part, un simple script&#160;Node</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce dont nous avons besoin pour dÃ©marrer, c&#8217;est d&#8217;un script Node que nous
pouvons appeler depuis notre terminal.
Nous allons placer l&#8217;exemple suivant dans le rÃ©pertoire <text:span text:style-name="CodeDansTexte">bin</text:span>
(pour <text:span text:style-name="T4">binary</text:span> en anglais, c&#8217;est-Ã -dire <text:span text:style-name="T4">exÃ©cutable</text:span>).
Cela n&#8217;a pas d&#8217;incidence technique, mais c&#8217;est une pratique courante au sein
de la communautÃ© Node pour repÃ©rer plus facilement les exÃ©cutables
sans ambiguÃ¯tÃ©.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">bin/time.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const date = new Date();<text:s text:c="20"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">const hour = date.getHours();</text:p><text:p text:style-name="Code">const minutes = date.getMinutes();</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(`Il est ${hour}h${minutes}.`);</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> CrÃ©e un objet qui reprÃ©sente la <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-date"  text:visited-style-name="Visited_20_Internet_20_Link">date</text:a> courante (<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-03"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;3</text:a>).<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Pratique</text:span> Jouer avec les exemples dans un terminal</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Les exemples titrÃ©s d&#8217;un nom de fichier peuvent Ãªtre installÃ©s sur votre ordinateur.
ExÃ©cutez-les dans un terminal et amusez-vous Ã  les modifier en parallÃ¨le de
votre lecture pour voir ce qui change.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Installation des exemples via le module npm <text:span text:style-name="CodeDansTexte">nodebook</text:span></text:p><text:p text:style-name="RemarqueCode">$ npm install --global nodebook</text:p><text:p text:style-name="RemarqueCode">$ nodebook install chapter-08</text:p><text:p text:style-name="RemarqueCode">$ cd $(nodebook dir chapter-08)</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">La commande suivante devrait afficher un rÃ©sultat qui confirme que vous Ãªtes
au bon endroit&#160;:</text:p>
<text:p text:style-name="RemarqueCode">$ node hello.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Suivez Ã  nouveau les instructions d&#8217;installation pour rÃ©tablir les exemples
dans leur Ã©tat initial.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exÃ©cution du script avec Node retourne la date et l&#8217;heure courante&#160;â€“ selon
l&#8217;horloge de l&#8217;ordinateur qui exÃ©cute le&#160;code.</text:p>
<text:p text:style-name="Code">$ node bin/time.js</text:p><text:p text:style-name="Code">Il est 13h42.</text:p>
<text:bookmark text:name="ref-permissions" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Modifier les permissions du&#160;script</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les systÃ¨mes d&#8217;exploitation modernes distinguent les fichiers ordinaires
des fichiers exÃ©cutables.
L&#8217;appel Ã  un fichier exÃ©cutable se fait sans avoir Ã  connaÃ®tre quoi que ce soit
d&#8217;autre que son emplacement.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Essayons d&#8217;exÃ©cuter le script prÃ©cÃ©dent pour nous en rendre compte.
Pour ce faire, nous allons l&#8217;invoquer seulement avec son chemin
â€“ ici, son chemin relatif&#160;:
undefined</text:p>
<text:p text:style-name="Code">$ ./bin/time.js</text:p><text:p text:style-name="Code">sh: permission denied: ./bin/time.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le systÃ¨me refuse de l&#8217;exÃ©cuter car les permissions du fichier ne sont pas
adÃ©quates.
Comme nous ne les connaissons pas, utilisons la commande&#160;<text:span text:style-name="CodeDansTexte">ls</text:span> ainsi que
l&#8217;option&#160;<text:span text:style-name="CodeDansTexte">-l</text:span> pour afficher ses informations dÃ©taillÃ©es&#160;:</text:p>
<text:p text:style-name="Code">$ ls -l bin/time.js</text:p><text:p text:style-name="Code"><text:span text:style-name="CodeExergue">-rw-r--r--</text:span> oncletom<text:s text:c="2"/>staff<text:s text:c="2"/>175 Jun 14 13:47 bin/time.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cet affichage dÃ©taille les permissions du fichier, l&#8217;utilisateur et le groupe
propriÃ©taire, son poids et enfin la date de derniÃ¨re modification.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">DÃ©chiffrer</text:span> Lire les permissions Unix</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
undefined
Le premier caractÃ¨re spÃ©cifie le type (fichier, rÃ©pertoire, lien symbolique) et
ensuite, ce sont des blocs de trois caractÃ¨res qui dÃ©crivent les permissions de
l&#8217;utilisateur propriÃ©taire, du groupe propriÃ©taire et du reste des utilisateurs
du systÃ¨me d&#8217;exploitation.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Chaque bloc affiche <text:span text:style-name="CodeDansTexte">r</text:span>&#160;s&#8217;il est lisible, <text:span text:style-name="CodeDansTexte">w</text:span>&#160;s&#8217;il est modifiable et
<text:span text:style-name="CodeDansTexte">x</text:span>&#160;s&#8217;il est exÃ©cutable&#160;â€“ c&#8217;est ce dernier qui nous intÃ©resse.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous allons rendre le fichier exÃ©cutable&#160;(<text:span text:style-name="CodeDansTexte">+x</text:span>) pour notre utilisateur&#160;(<text:span text:style-name="CodeDansTexte">u</text:span>)
grÃ¢ce Ã  la commande&#160;<text:span text:style-name="CodeDansTexte">chmod</text:span>.
Je prÃ©fÃ¨re utiliser cette notation car elle Ã©vite des effets de bord&#160;:</text:p>
<text:p text:style-name="Code">$ chmod u+x bin/time.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;utilisation renouvelÃ©e de la commande&#160;<text:span text:style-name="CodeDansTexte">ls</text:span> confirme que la
permission <text:span text:style-name="T4">exÃ©cutable</text:span> du fichier a Ã©tÃ© attribuÃ©e Ã  l&#8217;utilisateur propriÃ©taire
du fichier&#160;:
undefined</text:p>
<text:p text:style-name="Code">$ ls -l bin/time.js</text:p><text:p text:style-name="Code">-rwxr--r-- oncletom<text:s text:c="2"/>staff<text:s text:c="2"/>175 Jun 14 13:47 bin/time.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous sommes accueillis avec un nouveau message d&#8217;erreur lorsque nous
tentons d&#8217;exÃ©cuter le fichier <text:span text:style-name="CodeDansTexte">bin/time.js</text:span>&#160;:</text:p>
<text:p text:style-name="Code">$ ./bin/time.js</text:p><text:p text:style-name="Code">./bin/time.js: line 1: use strict: command not found</text:p><text:p text:style-name="Code">./bin/time.js: line 3: syntax error near unexpected token `('</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La bonne nouvelle, c&#8217;est que le fichier est exÃ©cutable.
NÃ©anmoins, il semblerait que le systÃ¨me d&#8217;exploitation ait du mal
Ã  l&#8217;interprÃ©ter.</text:p>
<text:bookmark text:name="ref-shebang" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">PrÃ©ciser le contexte d&#8217;exÃ©cution (shebang)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Donner les permissions d&#8217;exÃ©cution Ã  un fichier ne suffit donc pas.
Nous avons perdu un Ã©lÃ©ment contextuel en supprimant l&#8217;appel Ã  <text:span text:style-name="CodeDansTexte">node</text:span>
dans l&#8217;exÃ©cution du script.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">InteropÃ©rabilitÃ©</text:span> Un fonctionnement diffÃ©rent sous Windows</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Ce mÃ©canisme n&#8217;est pas compris par le systÃ¨me d&#8217;exploitation Windows.
Ce dernier utilise une surcouche qui serait trop longue Ã  expliquer dans
cet ouvrage.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Je recommande cependant de conserver le contexte d&#8217;exÃ©cution sous Windows
car l&#8217;exÃ©cutable&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> gÃ¨re l&#8217;interopÃ©rabilitÃ© pour nous.
Nous verrons comment dans la <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-package.json"  text:visited-style-name="Visited_20_Internet_20_Link">section suivante</text:a>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le caractÃ¨re&#160;<text:span text:style-name="CodeDansTexte">+<text:span text:style-name="CodeExergue">+</text:span> placÃ© en dÃ©but de ligne d&#8217;un script systÃ¨me signale une ligne
placÃ©e en commentaire.
C&#8217;est l&#8217;Ã©quivalent de&#160;<text:span text:style-name="CodeDansTexte">+//+</text:span> en ECMAScript.
Il existe un cas spÃ©cial&#160;: lorsque le caractÃ¨re&#160;<text:span text:style-name="CodeDansTexte">+</text:span>+</text:span> est suivi d&#8217;un&#160;<text:span text:style-name="CodeDansTexte">!</text:span>
<text:span text:style-name="T4">et</text:span> lorsqu&#8217;il s&#8217;agit de la premiÃ¨re ligne d&#8217;un fichier.
Le contenu du commentaire est alors utilisÃ© par le systÃ¨me d&#8217;exploitation
pour dÃ©terminer quel programme utiliser pour interprÃ©ter le script.
C&#8217;est ce qu&#8217;on appelle <text:span text:style-name="T4">shebang</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Modifions le script de la section prÃ©cÃ©dente pour ajouter le <text:span text:style-name="T4">shebang</text:span>&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">bin/time-sh.js</text:p><text:p text:style-name="Code">#!/usr/bin/env node<text:s text:c="3"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const date = new Date();</text:p><text:p text:style-name="Code">...</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Le programme <text:span text:style-name="CodeDansTexte">/usr/bin/env</text:span> est exÃ©cutÃ© avec un argument,&#160;<text:span text:style-name="CodeDansTexte">node</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le programme <text:span text:style-name="CodeDansTexte">/usr/bin/env</text:span> crÃ©e un nouvel environnement d&#8217;exÃ©cution
et le reste du script est passÃ© au programme rÃ©fÃ©rencÃ© en argument&#160;â€“ ici,&#160;<text:span text:style-name="CodeDansTexte">node</text:span>.
Ce nouvel environnement dure le temps de l&#8217;exÃ©cution du script.</text:p>
<text:p text:style-name="Code">$ ./bin/time-sh.js</text:p><text:p text:style-name="Code">Il est 13h42.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le dernier effort Ã  faire pour distribuer ce script exÃ©cutable de maniÃ¨re
interopÃ©rable est de le lier Ã  un
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-package.json"  text:visited-style-name="Visited_20_Internet_20_Link">module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span></text:a>.</text:p>
<text:bookmark text:name="ref-package.json" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Faire le lien avec un module&#160;npm</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous avons vu dans le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-05"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;5</text:a>
que Node utilisait la valeur <text:span text:style-name="CodeDansTexte">main</text:span> du fichier <text:span text:style-name="CodeDansTexte">package.json</text:span> pour dÃ©terminer
quel script inclure en faisant <text:span text:style-name="CodeDansTexte">require('&lt;module&gt;')</text:span> ou <text:span text:style-name="CodeDansTexte">import &lt;module&gt; from '&lt;module&gt;'</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le champ <text:span text:style-name="CodeDansTexte">bin</text:span> est une transposition de <text:span text:style-name="CodeDansTexte">main</text:span> pour associer un script
exÃ©cutable Ã  notre module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">package.json</text:p><text:p text:style-name="Code">{</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"name": "nodebook.chapter-08",</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"bin": "examples/bin/time-sh.js",</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"...": "..."</text:p><text:p text:style-name="Code">}</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le moyen le plus simple pour tester l&#8217;intÃ©gration de l&#8217;exÃ©cutable
avec notre systÃ¨me d&#8217;exploitation est de
l'<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-install.global"  text:visited-style-name="Visited_20_Internet_20_Link">installer globalement</text:a>.
L&#8217;exÃ©cutable&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> sait aussi installer un module Ã  partir
d&#8217;un chemin vers un rÃ©pertoire contenant un fichier <text:span text:style-name="CodeDansTexte">package.json</text:span>&#160;:
undefined</text:p>
<text:p text:style-name="Code">$ npm install --global .</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Par dÃ©faut, l&#8217;exÃ©cutable est disponible sous le nom du module en question,
dÃ©clarÃ© dans le champ <text:span text:style-name="CodeDansTexte">name</text:span> du fichier <text:span text:style-name="CodeDansTexte">package.json</text:span>&#160;:</text:p>
<text:p text:style-name="Code">$ nodebook.chapter-08</text:p><text:p text:style-name="Code">Il est 13h42.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Pratique</text:span> Un autre nom ou plusieurs exÃ©cutables</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
undefined
Le champ&#160;<text:span text:style-name="CodeDansTexte">bin</text:span> s&#8217;Ã©crit sous forme d&#8217;un objet si vous souhaitez utiliser
un autre nom que celui du module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>.
La clÃ© correspond au nom de l&#8217;exÃ©cutable tel qu&#8217;il sera utilisable sur le
systÃ¨me, tandis que la valeur contient le chemin d&#8217;accÃ¨s au script exÃ©cutable.
Plusieurs exÃ©cutables sont alors installÃ©s si nous renseignons plusieurs
clÃ©s et valeurs.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">package.json</text:p><text:p text:style-name="RemarqueCode">{</text:p><text:p text:style-name="RemarqueCode"><text:s text:c="2"/>"name": "nodebook.chapter-08",</text:p><text:p text:style-name="RemarqueCode"><text:s text:c="2"/>"bin": {</text:p><text:p text:style-name="RemarqueCode"><text:s text:c="4"/>"<text:span text:style-name="CodeExergue">quelle-heure-est-il</text:span>": "examples/bin/time-sh.js"</text:p><text:p text:style-name="RemarqueCode"><text:s text:c="2"/>}</text:p><text:p text:style-name="RemarqueCode">}</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">L&#8217;installation de l&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">examples/bin/time-sh.js</text:span> se fera sous le nom <text:span text:style-name="CodeDansTexte">quelle-heure-est-il</text:span>.</text:p>
<text:bookmark text:name="ref-interactive" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Du script au programme interactif</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous avons appris Ã  transformer un script Node ordinaire en un script
exÃ©cutable et prÃªt Ã  <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-publish"  text:visited-style-name="Visited_20_Internet_20_Link">publier sur un registre&#160;<text:span text:style-name="CodeDansTexte">npm</text:span></text:a>
(<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-05"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;5</text:a>).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette section se focalise sur l&#8217;enrichissement d&#8217;un tel script pour en faire
une application plus complÃ¨te, interactive et robuste, de quoi se constituer
un outillage sur mesure, partageable avec le reste de notre Ã©quipe et de
l&#8217;Ã©cosystÃ¨me de modules <text:span text:style-name="CodeDansTexte">npm</text:span>.</text:p>
<text:bookmark text:name="ref-args" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Utiliser des arguments et des options</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous avons vu comment rÃ©cupÃ©rer les arguments d&#8217;un script Node
en dÃ©couvrant le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process"  text:visited-style-name="Visited_20_Internet_20_Link">module <text:span text:style-name="CodeDansTexte">process</text:span></text:a>
au <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-04"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;4</text:a>.
Pour rappel, la variable <text:span text:style-name="CodeDansTexte">process.argv</text:span> est un tableau qui contient tous
les arguments passÃ©s au script principal&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">options/intro.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const args = process.argv.slice(2);</text:p><text:p text:style-name="Code">console.log(args);</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cela donne le rÃ©sultat suivant quand nous lanÃ§ons ce script dans un terminal&#160;:</text:p>
<text:p text:style-name="Code">$ node options/intro.js --country FR --fast</text:p><text:p text:style-name="Code">[ '--country', 'FR', '--fast' ]</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce tableau est un peu <text:span text:style-name="">lÃ©ger</text:span> car il se contente de retourner les arguments,
sans comprÃ©hension de la logique recherchÃ©e.
C&#8217;est Ã  nous de dire que&#160;<text:span text:style-name="CodeDansTexte">FR</text:span> est une valeur associÃ©e Ã  <text:span text:style-name="CodeDansTexte">--country</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans le contexte des outils en ligne de commandes,
les arguments et les options sont des paramÃ¨tres qui sont interprÃ©tÃ©s
par le programme pour contextualiser son action.
Ils fonctionnent un peu comme des arguments de
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-function"  text:visited-style-name="Visited_20_Internet_20_Link">fonction</text:a> et des paramÃ¨tres&#160;d&#8217;URL.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;enjeu des arguments et des options est de les
<text:span text:style-name="T7">transformer en une structure de donnÃ©es</text:span> afin de les passer en tant
que paramÃ¨tres d&#8217;une fonction.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TableauTitre">Tableau 24. ReprÃ©sentation des arguments et des options dans un outil en ligne de commandes, une fonction et une&#160;URL</text:p><table:table table:style-name="Tableau1"><table:table-column />,<table:table-column />,<table:table-column /><table:table-row><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p></text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Options</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Arguments</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Fonction</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">prog({country: 'FR', 'fast': true})</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">prog('FR', 'fast')</text:span></text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Ligne de commande</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">prog --country FR --fast</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">prog FR fast</text:span></text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>URL</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">prog/?country=FR&amp;fast=true</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">prog/FR/fast</text:span></text:p></table:table-cell></table:table-row></table:table>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous allons utiliser le module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> <text:span text:style-name="T4">minimist</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/minimist" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/minimist</text:a></text:span>)
dans les exemples suivants.
undefined
Il prend en charge la complexitÃ© de l&#8217;interprÃ©tation de <text:span text:style-name="CodeDansTexte">process.argv</text:span> et je
le trouve robuste, bien testÃ© et minimaliste.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Histoire</text:span> Au commencement Ã©tait getopt</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
<text:span text:style-name="CodeDansTexte">getopt</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://linux.die.net/man/3/getopt" text:visited-style-name="Visited_20_Internet_20_Link">https://linux.die.net/man/3/getopt</text:a></text:span>) est le programme Linux
qui sert Ã  l&#8217;analyse des arguments et des options.
Les modules&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> se calquent sur son modÃ¨le de fonctionnement.</text:p>
<text:bookmark text:name="ref-args.options" /><text:p text:style-name="TexteCourant">CommenÃ§ons par les <text:span text:style-name="T7">options</text:span> et voyons ce que <text:span text:style-name="T4">minimist</text:span> affiche&#160;:
undefined</text:p>
<text:p text:style-name="Code">$ node options/parse.js --country FR --fast</text:p><text:p text:style-name="Code">{ _: [], country: 'FR', fast: true }<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> La valeur&#160;<text:span text:style-name="CodeDansTexte">_</text:span> contient les <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-args.arguments"  text:visited-style-name="Visited_20_Internet_20_Link">arguments</text:a> d&#8217;exÃ©cution&#160;â€“ nous y reviendrons.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les options sont adaptÃ©es pour <text:span text:style-name="T7">nommer des paramÃ¨tres facultatifs</text:span> dont
l&#8217;ordre n&#8217;a pas d&#8217;importance, sous forme d&#8217;un <text:span text:style-name="">interrupteur</text:span> dans le cas
d&#8217;un boolÃ©en ou d&#8217;une valeur&#160;â€“ nombre ou chaÃ®ne de caractÃ¨res, peu importe.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">options/parse.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const parse = require('minimist');</text:p><text:p text:style-name="Code">const args = parse(process.argv.slice(2));</text:p><text:p text:style-name="Code">console.log(args);</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les options s&#8217;Ã©crivent sous une <text:span text:style-name="T7">forme raccourcie</text:span> (<text:span text:style-name="T4">alias</text:span>).
Un alias rÃ©duit l&#8217;encombrement visuel et est signalÃ© avec un seul tiret
(au lieu de deux pour leur forme complÃ¨te)&#160;:
undefined</text:p>
<text:p text:style-name="Code">$ node options/alias.js <text:span text:style-name="CodeExergue">-c</text:span> FR</text:p><text:p text:style-name="Code">{ _: [], c: 'FR', country: 'FR' }</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">options/alias.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const parse = require('minimist');</text:p><text:p text:style-name="Code">const alias = { 'c': 'country' }; <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const args = parse(process.argv.slice(2), { alias });</text:p><text:p text:style-name="Code">console.log(args);<text:s text:c="16"/><text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> DÃ©finition de l&#8217;option&#160;<text:span text:style-name="CodeDansTexte">-c</text:span> en tant qu&#8217;alias de <text:span text:style-name="CodeDansTexte">--country</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> L&#8217;affichage reprÃ©sente Ã  la fois la valeur de l&#8217;option et celle de l&#8217;alias.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La lecture est rendue plus difficile pour celui ou celle qui n&#8217;a pas consultÃ©
le manuel d&#8217;utilisation en dÃ©tail&#160;â€“ ce qui est souvent le cas, surtout
pour des personnes qui dÃ©couvrent un nouveau logiciel.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">J&#8217;ai tendance Ã  utiliser les alias pour les options principales ou importantes.
Je privilÃ©gie la forme longue dans les exemples et dans la documentation,
afin d&#8217;augmenter les chances de comprÃ©hension.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les <text:span text:style-name="T7">valeurs par dÃ©faut</text:span> simplifient le paramÃ©trage en rendant certaines
valeurs implicites&#160;:
undefined</text:p>
<text:p text:style-name="Code">$ node options/defaults.js --fast</text:p><text:p text:style-name="Code">{ _: [], country: 'FR', fast: true } <text:span text:style-name="PuceCode">1</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> La clÃ© <text:span text:style-name="CodeDansTexte">country</text:span> affiche une valeur alors que nous ne l&#8217;avons pas spÃ©cifiÃ©e dans la commande.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;enjeu rÃ©side donc dans l&#8217;utilisation des valeurs Ã  bon escient, pour
que le programme fasse ce qui est attendu d&#8217;un point de vue utilisateur.
Le paramÃ©trage est similaire Ã  celui des <text:span text:style-name="T4">alias</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">options/defaults.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const parse = require('minimist');</text:p><text:p text:style-name="Code">const options = {defaults: {country: 'FR'}};<text:s text:c="6"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const args = parse(process.argv.slice(2), options);</text:p><text:p text:style-name="Code">console.log(args);</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> L&#8217;option <text:span text:style-name="CodeDansTexte">--country</text:span> aura&#160;<text:span text:style-name="CodeDansTexte">FR</text:span> comme valeur par dÃ©faut.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un autre concept utile est celui des <text:span text:style-name="T7">types</text:span>.
Nous dÃ©finissons explicitement nos attentes sur ce que telle ou telle option
est censÃ©e recevoir&#160;:
undefined</text:p>
<text:p text:style-name="Code">$ node options/types.js --country --fast furious<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">{ _: [ 'furious' ], fast: true, country: '' }</text:p><text:p text:style-name="Code">$ node options/types.js --country FR</text:p><text:p text:style-name="Code">{ _: [], fast: false, country: 'FR' }<text:s text:c="13"/><text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Omission de la valeur de <text:span text:style-name="CodeDansTexte">--option</text:span> et tentative d&#8217;affectation de valeur Ã  l&#8217;option boolÃ©enne <text:span text:style-name="CodeDansTexte">--fast</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Une option vaut implicitement <text:span text:style-name="CodeDansTexte">false</text:span> par dÃ©faut quand elle est typÃ©e comme boolÃ©enne.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exemple prÃ©cÃ©dent renforce nos attentes&#160;: l&#8217;option <text:span text:style-name="CodeDansTexte">--country</text:span> sans valeur
ne sera pas comprise comme un boolÃ©en et, au contraire, l&#8217;option boolÃ©enne <text:span text:style-name="CodeDansTexte">--fast</text:span>
n&#8217;accepte pas de valeur&#160;â€“ cette derniÃ¨re est interprÃ©tÃ©e
comme un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-args.arguments"  text:visited-style-name="Visited_20_Internet_20_Link">argument</text:a>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">options/types.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const argv = process.argv.slice(2);</text:p><text:p text:style-name="Code">const parse = require('minimist');</text:p><text:p text:style-name="Code">const string = ['country'];</text:p><text:p text:style-name="Code">const boolean = ['fast'];</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(parse(argv, { string, boolean }));</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">--country FR</text:span>, <text:span text:style-name="CodeDansTexte">-c FR</text:span></text:h>
<text:p text:style-name="Remarque">Un nombre ou une chaÃ®ne de caractÃ¨res.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">--country FR UK</text:span>, <text:span text:style-name="CodeDansTexte">--country FR --country UK</text:span></text:h>
<text:p text:style-name="Remarque">Un ou plusieurs nombre(s) ou chaÃ®ne(s) de caractÃ¨res.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">--fast</text:span>, <text:span text:style-name="CodeDansTexte">--no-fast</text:span>, <text:span text:style-name="CodeDansTexte">-f</text:span></text:h>
<text:p text:style-name="Remarque">Un boolÃ©en dont la valeur vaut <text:span text:style-name="CodeDansTexte">true</text:span>.
La valeur vaut <text:span text:style-name="CodeDansTexte">false</text:span> quand l&#8217;option dÃ©bute avec&#160;<text:span text:style-name="CodeDansTexte">no-</text:span>.
C&#8217;est utile quand nous avons besoin d&#8217;activer ou de dÃ©sactiver quelque chose.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">--verbose --verbose</text:span>, <text:span text:style-name="CodeDansTexte">-vv</text:span></text:h>
<text:p text:style-name="Remarque">Certaines bibliothÃ¨ques utilisent la rÃ©pÃ©tition d&#8217;un boolÃ©en comme un compteur.
Dans ce cas, la notation <text:span text:style-name="CodeDansTexte">--verbose --verbose</text:span> correspond Ã  la valeur <text:span text:style-name="CodeDansTexte">{verbose: 2}</text:span>.
C&#8217;est utile pour gÃ©rer la gradation d&#8217;une option comme la loquacitÃ© de l&#8217;affichage
des <text:span text:style-name="T4">logs</text:span>.</text:p>
<text:bookmark text:name="ref-args.arguments" /><text:p text:style-name="TexteCourant">undefined
Les arguments sont adaptÃ©s Ã  des situations oÃ¹ <text:span text:style-name="T7">des valeurs sont obligatoires</text:span>,
n&#8217;ont pas besoin d&#8217;Ãªtre nommÃ©es et pour en accepter un nombre arbitraire.
Si les valeurs ne correspondent pas Ã  une liste, le positionnement des arguments
est important car il dÃ©termine leur identification.
Les arguments se prÃªtent particuliÃ¨rement bien Ã  exprimer
une liste de fichiers ou d&#8217;identifiants.</text:p>
<text:p text:style-name="Code">$ node options/parse.js Europe/London</text:p><text:p text:style-name="Code">{ _: [ 'Europe/London' ] }</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le paramÃ¨tre passÃ© en argument est l&#8217;expression d&#8217;un fuseau horaire
selon l&#8217;organisme de standardisation <text:span text:style-name="T4">IANA</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://www.iana.org/time-zones" text:visited-style-name="Visited_20_Internet_20_Link">https://www.iana.org/time-zones</text:a></text:span>).
Une liste de fuseaux se trouve sur <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://time.is/time_zones" text:visited-style-name="Visited_20_Internet_20_Link">https://time.is/time_zones</text:a></text:span>.
L&#8217;idÃ©e est d&#8217;afficher l&#8217;heure courante selon le fuseau horaire donnÃ© en argument.
C&#8217;est un paramÃ¨tre obligatoire qu&#8217;il n&#8217;est pas nÃ©cessaire de nommer&#160;:</text:p>
<text:p text:style-name="Code">$ node options/timezone.js Europe/London</text:p><text:p text:style-name="Code">22:29</text:p><text:p text:style-name="Code">$ node options/timezone.js America/New_York</text:p><text:p text:style-name="Code">17:29</text:p><text:p text:style-name="Code">$ node options/timezone.js Indian/Antananarivo<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">17/6/2018, 00:36</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Fuseau horaire de l&#8217;Ã®le de Madagascar.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous pouvons travailler avec les fuseaux horaires sans module additionnel,
grÃ¢ce Ã  la fonctionnalitÃ© de
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-intl.datetimeformat"  text:visited-style-name="Visited_20_Internet_20_Link">formatage internationalisÃ©</text:a>
(<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-03"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;3</text:a>)&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">options/timezone.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const parse = require('minimist');</text:p><text:p text:style-name="Code">const args = parse(process.argv.slice(2));</text:p><text:p text:style-name="Code">const [timezone] = args._;<text:s text:c="26"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">if (!timezone) {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>throw Error('Merci d\'indiquer un fuseau horaire :-)');</text:p><text:p text:style-name="Code">}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const options = {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>timeZone: timezone,</text:p><text:p text:style-name="Code"><text:s text:c="2"/>hour: 'numeric', minute: 'numeric', hour12: false <text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const text = new Date().toLocaleDateString('fr-FR', options);</text:p><text:p text:style-name="Code">console.log(text);<text:s text:c="34"/><text:span text:style-name="PuceCode">3</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Nous affectons Ã  <text:span text:style-name="CodeDansTexte">timezone</text:span> la premiÃ¨re valeur du tableau d&#8217;arguments.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Configuration des prÃ©fÃ©rences d&#8217;affichage de l&#8217;heure.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Utilisation de la mÃ©thode <text:span text:style-name="CodeDansTexte">toLocaleDateString()</text:span> avec nos options pour afficher la date courante.
undefined<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cet exemple se transformerait de la maniÃ¨re suivante si nous souhaitions
Ã©tendre l&#8217;affichage de l&#8217;heure Ã  autant de fuseaux horaires que voulus&#160;:</text:p>
<text:p text:style-name="Code">$ node options/timezones.js Europe/London America/New_York</text:p><text:p text:style-name="Code">Europe/London : 22:29</text:p><text:p text:style-name="Code">America/New_York : 17:29</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">options/timezones.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const parse = require('minimist');</text:p><text:p text:style-name="Code">const args = parse(process.argv.slice(2));</text:p><text:p text:style-name="Code">const timezones = args._;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const output = timezones.map(timeZone =&gt; {<text:s text:c="14"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>const date = new Date().toLocaleDateString('fr-FR', {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>timeZone,</text:p><text:p text:style-name="Code"><text:s text:c="4"/>hour: 'numeric', minute: 'numeric', hour12: false</text:p><text:p text:style-name="Code"><text:s text:c="2"/>});</text:p><text:p text:style-name="Code"><text:s text:c="2"/>return `${timeZone} : ${date}`;<text:s text:c="23"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(output.join('\n'));<text:s text:c="25"/><text:span text:style-name="PuceCode">3</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Nous constituons un nouveau tableau en itÃ©rant sur chacun des arguments.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Valeur de retour utilisÃ©e dans le nouveau tableau <text:span text:style-name="CodeDansTexte">output</text:span> (<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-array"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;3</text:a>).<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Le tableau est joint pour constituer une chaÃ®ne de caractÃ¨res sur plusieurs lignes.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce script accepte un nombre indÃ©fini d&#8217;arguments et son temps d&#8217;exÃ©cution
dÃ©pendra de la longueur de cette liste.
Elle n&#8217;a d&#8217;ailleurs pas forcÃ©ment Ã  Ãªtre connue Ã  l&#8217;avance et les valeurs
s&#8217;obtiennent dynamiquement, en les listant depuis un fichier, par exemple&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">options/zones.txt</text:p><text:p text:style-name="Code">Europe/London</text:p><text:p text:style-name="Code">America/New_York</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le contenu du fichier s&#8217;obtient d&#8217;une traite en bash avec l&#8217;utilisation combinÃ©e
de capture de valeur (<text:span text:style-name="CodeDansTexte">$(&#160;)</text:span>) et de l&#8217;opÃ©rateur de redirection&#160;<text:span text:style-name="CodeDansTexte">&lt;</text:span>&#160;:</text:p>
<text:p text:style-name="Code">$ node options/timezones.js $(&lt; options/zones.txt)</text:p><text:p text:style-name="Code">Europe/London : 22:29</text:p><text:p text:style-name="Code">America/New_York : 17:29</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">C&#8217;est minimal, mais le fichier doit Ãªtre lu
dans son intÃ©gralitÃ© et copiÃ© entiÃ¨rement dans la mÃ©moire de Node avant d&#8217;en
faire quelque chose.
Une approche plus Ã©conomique est d&#8217;utiliser les
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-stream"  text:visited-style-name="Visited_20_Internet_20_Link">flux de donnÃ©es</text:a> (<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-04"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;4</text:a>.
Nous y reviendrons <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-streaming"  text:visited-style-name="Visited_20_Internet_20_Link">plus loin</text:a>.
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">prog [argument1, â€¦]</text:span></text:h>
<text:p text:style-name="Remarque">L&#8217;ordre de placement Ã©tant important, les arguments facultatifs doivent
Ãªtre placÃ©s Ã  droite des arguments obligatoires.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre"><text:span text:style-name="CodeDansTexte">prog sous-commande [argument1, â€¦]</text:span></text:h>
<text:p text:style-name="Remarque">C&#8217;est un cas particulier pour dÃ©couper un programme complet en plusieurs
domaines d&#8217;action.
Le premier argument est alors utilisÃ© comme identifiant d&#8217;action,
avec ses propres arguments et options.</text:p>
<text:bookmark text:name="ref-args.subcommand" /><text:p text:style-name="TexteCourant">undefined
L&#8217;utilisation des sous-commandes est la bienvenue pour organiser des actions
de maniÃ¨re indÃ©pendante, lÃ  oÃ¹ les choses deviendraient implicites et chaotiques
avec les options.
C&#8217;est l&#8217;Ã©quivalent d&#8217;une <text:span text:style-name="T4">route</text:span> dans une
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-07"  text:visited-style-name="Visited_20_Internet_20_Link">application web</text:a> (<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-07"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;7</text:a>).
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les commandes suivantes illustrent la gÃ©nÃ©ration de rÃ©sultats alÃ©atoires.
Leur nature varie en fonction de la sous-commande employÃ©e&#160;;</text:p>
<text:p text:style-name="Code">$ node options/random.js number</text:p><text:p text:style-name="Code">51151</text:p><text:p text:style-name="Code">$ node options/random.js words 2</text:p><text:p text:style-name="Code">streamline THX</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous associons une fonction diffÃ©rente Ã  chaque sous-commande pour
renforcer cette notion d&#8217;actions indÃ©pendantes mais qui partagent
les options et arguments du script.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">options/random.js</text:p><text:p text:style-name="Code">const {random} = require('faker/locale/fr');</text:p><text:p text:style-name="Code">const args = require('minimist')(process.argv.slice(2));</text:p><text:p text:style-name="Code">const [action, ...actionArgs] = args._;<text:s text:c="15"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const number = () =&gt; random.number();<text:s text:c="17"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">const words = (count=5) =&gt; random.words(count);<text:s text:c="7"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">const log = (result) =&gt; console.log(result);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">if (action === 'words')<text:s text:c="2"/>log(words(...actionArgs));<text:s text:c="3"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code">if (action === 'number') log(number());</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> L&#8217;action est le premier argument&#160;; le reste est accumulÃ© dans le tableau <text:span text:style-name="CodeDansTexte">actionArgs</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Fonction qui retourne un nombre alÃ©atoire.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Fonction qui retourne un nombre dÃ©fini de mots&#160;â€“ 5&#160;par dÃ©faut.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Chaque argument qui suit la sous-commande correspondra ainsi Ã  un argument de la fonction <text:span text:style-name="CodeDansTexte">words</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L'<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-05"  text:visited-style-name="Visited_20_Internet_20_Link">exÃ©cutable&#160;<text:span text:style-name="CodeDansTexte">npm</text:span></text:a> est un exemple d&#8217;application
qui repose sur des sous-commandes pour dÃ©terminer quelle action exÃ©cuter
â€“ installer un module, lancer une recherche ou encore initialiser un projet, entre autres.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Des applications en ligne de commande plus complexes soulÃ¨vent de nouveaux
besoins pour Ã©viter les effets de bord et pour faciliter la modularitÃ© de
notre code&#160;: la <text:span text:style-name="T7">validation</text:span> des paramÃ¨tres, une gestion plus fine des
sous-commandes, ainsi que la <text:span text:style-name="T7">gÃ©nÃ©ration automatique de la documentation</text:span>.
Nous y reviendrons dans la section <text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-application"  text:visited-style-name="Visited_20_Internet_20_Link">Utilisation d&#8217;un framework</text:a></text:span>.</text:p>
<text:bookmark text:name="ref-colours" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">AmÃ©liorer la lisibilitÃ© grÃ¢ce aux couleurs</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les couleurs vont nous aider Ã  faire ressortir, diffÃ©rencier et distinguer
des Ã©lÃ©ments au sein d&#8217;une interface monochrome.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-08/images/cli-colors.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>8-undefined.</text:span> Exemple d&#8217;utilisation de couleurs (ici, en niveaux de gris) dans un terminal</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;alternance de texte colorÃ© et monochrome a Ã©tÃ© crÃ©Ã©e Ã  partir du
script suivant&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">colors/ansi.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log('\x1B[31mHello\x1B[0m World');</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Par dÃ©faut, tout caractÃ¨re envoyÃ© vers la console est affichÃ©.
Un mÃ©canisme de <text:span text:style-name="T7">commandes</text:span> s&#8217;active en envoyant un caractÃ¨re invisible
suivi d&#8217;une sÃ©rie de symboles.
Ces commandes changent la couleur du texte, sa couleur de fond, l&#8217;emphase,
le soulignement et mÃªme la position du curseur.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">ANSI</text:span> Structure d&#8217;une commande d&#8217;Ã©chappement</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
undefined
undefined
Le caractÃ¨re d'<text:span text:style-name="T4">Ã©chappement</text:span> est un caractÃ¨re invisible, ici reprÃ©sentÃ©
en hexadÃ©cimal par&#160;<text:span text:style-name="CodeDansTexte">\x1B</text:span>.
Il existe sur nos claviers d&#8217;ordinateur&#160;: c&#8217;est la fameuse touche
<text:span text:style-name="Menu">[ECHAP]</text:span> ou <text:span text:style-name="Menu">[ESC]</text:span>&#160;!<text:line-break/>Une commande suit le caractÃ¨re&#160;<text:span text:style-name="CodeDansTexte">[</text:span> jusqu&#8217;au caractÃ¨re&#160;<text:span text:style-name="CodeDansTexte">m</text:span>.
Les commandes composÃ©es utilisent le caractÃ¨re&#160;<text:span text:style-name="CodeDansTexte">;</text:span> comme sÃ©parateur.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Pour rÃ©sumer, une commande a la forme <text:span text:style-name="CodeDansTexte">&lt;ECHAP&gt;[&lt;commande&gt;m</text:span> ou
<text:span text:style-name="CodeDansTexte">&lt;ECHAP&gt;[&lt;commande;commande;&#8230;&#8203;&gt;m</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Pour en savoir plus Ã  propos de cette syntaxe, je vous recommande la lecture de
la page WikipÃ©dia suivante&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://en.wikipedia.org/wiki/ANSI_escape_code" text:visited-style-name="Visited_20_Internet_20_Link">https://en.wikipedia.org/wiki/ANSI_escape_code</text:a></text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les huit couleurs principales et les huit couleurs vives s&#8217;affichent dans
Ã  peu prÃ¨s tous les terminaux.
Cela vaut aussi pour leur utilisation en couleur de&#160;fond.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-08/images/cli-colors-all.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>8-undefined.</text:span> Affichage des huit couleurs principales et des huit couleurs&#160;vives (ici, en niveaux de gris)</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">colors/all.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const colors = [30, 31, 32, 33, 34, 35, 36, 37];</text:p><text:p text:style-name="Code">const brightColors = [90, 91, 92, 93, 94, 95, 96, 97];</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">[...colors, ...brightColors].forEach(code =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const color = `\x1B[${code}m`;<text:s text:c="12"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>const bgColor = `\x1B[30;${code + 10}m`;<text:s text:c="2"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>const reset = '\x1B[0m';<text:s text:c="18"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log(`${color}Hello ${bgColor}World${reset}`);</text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Couleur d&#8217;affichage du texte.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Couleur de fond du texte tandis que les caractÃ¨res sont en noir (<text:span text:style-name="CodeDansTexte">30</text:span>).<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Remise Ã  zÃ©ro de tous les styles.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">CompatibilitÃ©</text:span> Combien de couleurs dans mon terminal ?</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Les terminaux proposent un nombre limitÃ© de couleurs, au moins&#160;8, en majoritÃ©&#160;256
et parfois plusieurs millions selon le logiciel utilisÃ©.
Le programme Linux et macOS <text:span text:style-name="CodeDansTexte">tput</text:span> fournit des informations Ã  propos
du terminal, dont le nombre de couleurs&#160;:</text:p>
<text:p text:style-name="RemarqueCode">$ tput colors</text:p><text:p text:style-name="RemarqueCode">256</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un autre type de commande sÃ©lectionne dans une palette de 256&#160;couleurs
mais aussi dans la <text:span text:style-name="T4">palette&#160;RGB</text:span> (<text:span text:style-name="T4">Red Green Blue</text:span>, <text:span text:style-name="T4">Rouge Vert Bleu</text:span>).
Ces commandes dÃ©butent par <text:span text:style-name="CodeDansTexte">[38;5</text:span> et <text:span text:style-name="CodeDansTexte">[38;2</text:span>, respectivement&#160;:
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">colors/palette.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log('\x1B[38;5;213mHello\x1B[0m World');<text:s text:c="6"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log('\x1B[38;2;255;69;0mHello\x1B[0m World'); <text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Utilisation de la palette 8&#160;bits (256&#160;couleurs) - <text:span text:style-name="CodeDansTexte">213</text:span>&#160;est un rose clair.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Utilisation de la palette RGB (millions de couleurs)&#160;â€“ <text:span text:style-name="CodeDansTexte">255,69,0</text:span> correspond au orange.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> <text:span text:style-name="T4">chalk</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/chalk" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/chalk</text:a></text:span>) facilite l&#8217;utilisation
des codes ANSI en leur donnant des libellÃ©s mÃ©morisables, en gÃ©rant
la compatibilitÃ© du nombre des couleurs supportÃ©es par le terminal voire
en dÃ©sactivant les couleurs si nÃ©cessaire.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">colors/chalk.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {magentaBright, green, bgRed} = require('chalk');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(`${magentaBright('Hello')} World`); <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(`${green.italic('Hello')} World`);<text:s text:c="2"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">console.log(`${bgRed('Hello')} World`);<text:s text:c="9"/><text:span text:style-name="PuceCode">3</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Utilisation de la couleur vive magenta.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Utilisation de la couleur verte et de l&#8217;italique.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Utilisation de la couleur de fond rouge.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le module s&#8217;utilise aussi comme modÃ¨le avec les guillemets obliques,
ce qui augmente encore plus la clartÃ© d&#8217;affichage.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">colors/chalk-literal.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const chalk = require('chalk');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(chalk`{magentaBright Hello} World`);</text:p><text:p text:style-name="Code">console.log(chalk`{green.italic Hello} World`);</text:p><text:p text:style-name="Code">console.log(chalk`{bgRed Hello} World`);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(chalk`{rgb(255,69,0) Hello} World`);</text:p>
<text:bookmark text:name="ref-prompt" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Demander une sÃ©rie d&#8217;informations</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les programmes interactifs demandent des informations de maniÃ¨re
guidÃ©e Ã  la personne utilisant l&#8217;exÃ©cutable,
en plus des <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-arguments"  text:visited-style-name="Visited_20_Internet_20_Link">arguments et options</text:a>.
Poser une sÃ©rie de questions est une maniÃ¨re d&#8217;accompagner une personne
dans une dÃ©cision, d&#8217;exposer des choix dynamiques et de rÃ©duire les erreurs
dans la crÃ©ation de fichiers, par exemple.</text:p>
<text:p text:style-name="Code">$ node prompt/intro.js</text:p><text:p text:style-name="Code">Quel est ton nom ? Thomas</text:p><text:p text:style-name="Code">Coucou Thomas !</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le module <text:span text:style-name="CodeDansTexte">readline</text:span> proposÃ© par Node est peu connu.
Il sert Ã  transformer les <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-process.std"  text:visited-style-name="Visited_20_Internet_20_Link">flux d&#8217;entrÃ©e et de sortie</text:a>
(<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-04"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;4</text:a>.
undefined
undefined
Le systÃ¨me de curseur sait mettre en pause, revenir en arriÃ¨re et effacer tout
ou une partie d&#8217;une ligne, entre autres.
Ce module sait aussi poser des questions&#160;(!)&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">prompt/intro.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const readline = require('readline');</text:p><text:p text:style-name="Code">const rl = readline.createInterface({<text:s text:c="13"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>input: process.stdin,</text:p><text:p text:style-name="Code"><text:s text:c="2"/>output: process.stdout</text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">rl.question('Quel est ton nom ? ', (answer) =&gt; {<text:s text:c="2"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log(`Coucou ${answer} !`);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>rl.close();<text:s text:c="37"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> CrÃ©ation de l&#8217;interface qui s&#8217;intercale entre les flux d&#8217;entrÃ©e et de sortie&#160;â€“ ici, l&#8217;entrÃ©e et la sortie standard.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> La fonction de rappel est invoquÃ©e dÃ¨s que l&#8217;utilisateur a saisi sa rÃ©ponse.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> La mÃ©thode <text:span text:style-name="CodeDansTexte">close()</text:span> stoppe l&#8217;interface et rend la main au script&#160;â€“ sans cet appel le script tournerait indÃ©finiment.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous allons utiliser le module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> <text:span text:style-name="T4">inquirer</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/inquirer" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/inquirer</text:a></text:span>)
dans la suite de cette section.
undefined
undefined
Il se base sur <text:span text:style-name="CodeDansTexte">readline</text:span> et <text:span text:style-name="T7">simplifie grandement l&#8217;interactivitÃ©</text:span>&#160;:
question, liste Ã  choix unique navigable au clavier, boÃ®te Ã  cocher,
confirmation, validation de rÃ©ponse et exÃ©cution conditionnelle, si telle ou
telle question contient les valeurs qui nous intÃ©ressent, par exemple.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exemple prÃ©cÃ©dent peut Ãªtre rÃ©Ã©crit de la sorte&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">prompt/question.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {prompt} = require('inquirer');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const questions = [</text:p><text:p text:style-name="Code"><text:s text:c="2"/>{ name: 'name', message : 'Quel est ton nom ?' }, <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">];</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">prompt(questions).then(answers =&gt; {<text:s text:c="17"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log(`Coucou ${answers.name} !`);<text:s text:c="10"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> La question est crÃ©Ã©e avec l&#8217;identifiant <text:span text:style-name="CodeDansTexte">name</text:span>&#160;â€“ cela facilite l&#8217;utilisation des rÃ©ponses.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Les rÃ©sultats sont retournÃ©s dans une <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-promise"  text:visited-style-name="Visited_20_Internet_20_Link">promesse</text:a>&#160;â€“ c&#8217;est plus Ã©lÃ©gant et pratique Ã  gÃ©rer qu&#8217;une fonction de rappel.
undefined<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Les valeurs des rÃ©ponses s&#8217;obtiennent grÃ¢ce Ã  leurs identifiants.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce n&#8217;est pas beaucoup plus compliquÃ© de poser plusieurs questions et de les
personnaliser avec les rÃ©ponses aux prÃ©cÃ©dentes questions&#160;:</text:p>
<text:p text:style-name="Code">$ node prompt/questions.js</text:p><text:p text:style-name="Code">? Quel est ton nom ? Thomas</text:p><text:p text:style-name="Code">? Quel Ã¢ge as-tu Thomas ? 35</text:p><text:p text:style-name="Code">Thomas, tu as 35 ans.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">prompt/questions.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {prompt} = require('inquirer');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const questions = [</text:p><text:p text:style-name="Code"><text:s text:c="2"/>{ name: 'name', message : 'Quel est ton nom ?' },</text:p><text:p text:style-name="Code"><text:s text:c="2"/>{ name: 'age', message: (answers) =&gt; {<text:s text:c="12"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>return `Quel Ã¢ge as-tu ${answers.name} ?`;<text:s text:c="6"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>}}</text:p><text:p text:style-name="Code">];</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">prompt(questions).then(answers =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log(`${answers.name}, tu as ${answers.age} ans.`);</text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> La valeur de <text:span text:style-name="CodeDansTexte">message</text:span> peut Ãªtre une fonction Ã  laquelle est passÃ©e l&#8217;intÃ©gralitÃ© des rÃ©ponses aux questions prÃ©cÃ©dentes.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> La valeur d&#8217;une rÃ©ponse s&#8217;obtient au travers de son identifiant.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans cet exemple, rien ne nous empÃªchait de saisir autre chose qu&#8217;un nombre
dans la question de l&#8217;Ã¢ge.
C&#8217;est gÃªnant, mais cela se rÃ©sout Ã  l&#8217;aide de la propriÃ©tÃ© de configuration <text:span text:style-name="CodeDansTexte">validate</text:span>.</text:p>
<text:p text:style-name="Code">$ node prompt/validate.js</text:p><text:p text:style-name="Code">? Devine le nombre secret (entre 1 et 100): trois</text:p><text:p text:style-name="Code">&gt;&gt; Ce n'est pas un nombre</text:p><text:p text:style-name="Code">? Devine le nombre secret (entre 1 et 100): 10</text:p><text:p text:style-name="Code">&gt;&gt; C'est plus petit.</text:p><text:p text:style-name="Code">? Devine le nombre secret (entre 1 et 100): 5</text:p><text:p text:style-name="Code">Bravo, la rÃ©ponse est 5 !</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette fonction est appelÃ©e Ã  chaque tentative de rÃ©ponse.
La question est inlassablement posÃ©e tant que la fonction <text:span text:style-name="CodeDansTexte">validate</text:span> retourne
autre chose que le boolÃ©en <text:span text:style-name="CodeDansTexte">true</text:span>&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">prompt/validate.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {prompt} = require('inquirer');</text:p><text:p text:style-name="Code">const secret_number = Math.floor(Math.random() * 100);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const questions = [</text:p><text:p text:style-name="Code"><text:s text:c="2"/>{ name: 'Devine le nombre secret (entre 1 et 100)',</text:p><text:p text:style-name="Code"><text:s text:c="4"/>validate: (input, answers) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="6"/>if (Number.isNaN(parseInt(input))) {<text:s text:c="4"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="8"/>return 'Ce n\'est pas un nombre';<text:s text:c="5"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="6"/>}</text:p><text:p text:style-name="Code"><text:s text:c="6"/>if (input &gt; secret_number) {</text:p><text:p text:style-name="Code"><text:s text:c="8"/>return 'C\'est plus petit.';</text:p><text:p text:style-name="Code"><text:s text:c="6"/>}</text:p><text:p text:style-name="Code"><text:s text:c="6"/>if (input &lt; secret_number) {</text:p><text:p text:style-name="Code"><text:s text:c="8"/>return 'C\'est plus grand.';</text:p><text:p text:style-name="Code"><text:s text:c="6"/>}</text:p><text:p text:style-name="Code"><text:s text:c="6"/>return true;<text:s text:c="28"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>}}</text:p><text:p text:style-name="Code">];</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">prompt(questions).then(answers =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log(`Bravo, la rÃ©ponse est ${secret_number} !`);</text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Nous nous assurons que la valeur saisie est assimilÃ©e Ã  un nombre.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Sinon, nous retournons un texte utilisÃ© comme message d&#8217;erreur.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Cette condition remplie, le module passera Ã  la question suivante.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Enfin, deux modes de liste sont proposÃ©s par le module <text:span text:style-name="T4">inquirer</text:span>&#160;: <text:span text:style-name="CodeDansTexte">list</text:span>
et <text:span text:style-name="CodeDansTexte">checkbox</text:span>.
undefined
Dans le premier cas, nous naviguons au clavier pour sÃ©lectionner une seule rÃ©ponse.
Dans le deuxiÃ¨me, nous naviguons au clavier et sÃ©lectionnons les choix
Ã  l&#8217;aide de la touche <text:span text:style-name="CodeDansTexte">Espace</text:span>&#160;:</text:p>
<text:p text:style-name="Code">$ node prompt/list.js</text:p><text:p text:style-name="Code">? Tu fais quoi lundi ?</text:p><text:p text:style-name="Code"><text:s text:c="2"/>Je quitte mon job</text:p><text:p text:style-name="Code">â¯ Je pars en vacances</text:p><text:p text:style-name="Code"><text:s text:c="2"/>J'apprends Node.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">prompt/list.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {prompt} = require('inquirer');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">prompt([</text:p><text:p text:style-name="Code"><text:s text:c="2"/>{ name: 'type',</text:p><text:p text:style-name="Code"><text:s text:c="4"/>type: 'list',<text:s text:c="21"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>message : 'Tu fais quoi lundi ?',</text:p><text:p text:style-name="Code"><text:s text:c="4"/>choices: [<text:s text:c="24"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="6"/>'Je quitte mon job',</text:p><text:p text:style-name="Code"><text:s text:c="6"/>'Je pars en vacances',</text:p><text:p text:style-name="Code"><text:s text:c="6"/>'J\'apprends Node.js'</text:p><text:p text:style-name="Code"><text:s text:c="4"/>]</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">]);</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Le champ <text:span text:style-name="CodeDansTexte">type</text:span> sert Ã  expliciter la nature de la question&#160;â€“ l&#8217;interface utilisateur s&#8217;adapte.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Le champ <text:span text:style-name="CodeDansTexte">choices</text:span> contient la liste des choix proposÃ©s Ã  l&#8217;Ã©cran.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le potentiel de combinaison de ces Ã©lÃ©ments est vraiment intÃ©ressant.
Nous pourrions crÃ©er des quiz, des interfaces de recherche ou faciliter
la crÃ©ation de fichiers de configuration sans avoir Ã  mettre les mains dans le
cambouis.
Les choix mis Ã  disposition dans l&#8217;interface se crÃ©ent aussi dynamiquement,
Ã  partir de donnÃ©es obtenues depuis une ressource distante&#160;â€“
ils n&#8217;est pas nÃ©cessaire de les Ã©crire en dur dans le code.</text:p>
<text:bookmark text:name="ref-progress" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Informer de la progression</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Je trouve que <text:span text:style-name="T7">transmettre un feedback est un Ã©lÃ©ment diffÃ©renciant</text:span> dans la
conception d&#8217;une application&#160;â€“ qu&#8217;elle soit utilisÃ©e sur le Web ou dans un
terminal.
Informer de la progression est un des moyens d&#8217;y parvenir.
La progression concerne aussi bien l&#8217;indication du <text:span text:style-name="T7">franchissement d&#8217;Ã©tapes</text:span>
que celle de <text:span text:style-name="T7">pourcentage d&#8217;accomplissement</text:span> d&#8217;une tÃ¢che.</text:p>
<text:p text:style-name="Code">$ node progress/intro.js</text:p><text:p text:style-name="Code">(â€¢Â·Â·) Un-deux-trois</text:p><text:p text:style-name="Code">(â€¢â€¢Â·) Un-deux-trois</text:p><text:p text:style-name="Code">(â€¢â€¢â€¢) Un-deux-trois â˜€ï¸</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette approche est une premiÃ¨re tentative d&#8217;indiquer une progression Ã  travers
deux mÃ©canismes&#160;: le passage du vide au plein en utilisant un caractÃ¨re qui
vÃ©hicule ce changement et l&#8217;utilisation d&#8217;un signal visuel pour informer de
l&#8217;accomplissement de la tÃ¢che.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">progress/intro.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">let counter = 0;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const display = (count) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const progress = 'â€¢'.repeat(count).padEnd(3, 'Â·');<text:s text:c="2"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>const sun = count === 3 ? 'â˜€ï¸' : '';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log(`(${progress}) Un-deux-trois ${sun}`);<text:s text:c="2"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">setInterval(() =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>counter++;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>display(counter);<text:s text:c="19"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>if (counter === 3) process.exit(0);</text:p><text:p text:style-name="Code">}, 1000);</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Cette fonction affiche la progression toutes les secondes.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> La mÃ©thode <text:span text:style-name="CodeDansTexte">padEnd()</text:span> (<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-03"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;3</text:a>) complÃ¨te la barre de progression jusqu&#8217;Ã  atteindre le nombre souhaitÃ© de points.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Le message de progression est paramÃ©trÃ© pour afficher les Ã©lÃ©ments nÃ©cessaires&#160;â€“ l&#8217;Ã©moji <text:span text:style-name="">soleil</text:span> s&#8217;affiche quand le compteur atteint&#160;<text:span text:style-name="CodeDansTexte">3</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Performance</text:span> La vitesse est toute relative</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Une action qui est instantanÃ©e sur notre ordinateur peut durer
plusieurs secondes sur un autre, du fait de ressources moindres ou d&#8217;un accÃ¨s
rÃ©seau moins favorable par exemple.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La seule chose qu&#8217;il manque Ã  mon goÃ»t est d&#8217;avoir un rÃ©el sens de progression,
c&#8217;est-Ã -dire une actualisation du contenu qui informe de l&#8217;avancement.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous avons parlÃ© des commandes ANSI pour <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-colors"  text:visited-style-name="Visited_20_Internet_20_Link">changer les couleurs</text:a>.
undefined
undefined
Il se trouve que certaines de ces commandes contrÃ´lent aussi la <text:span text:style-name="T7">position du curseur</text:span>.
Ainsi, au lieu d&#8217;Ã©crire Ã  la suite, nous pouvons revenir en arriÃ¨re et mÃªme
effacer le contenu d&#8217;une ligne.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-08/images/cli-dots.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>8-undefined.</text:span> Pendant et aprÃ¨s la progression d&#8217;un script&#160;Node</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il n&#8217;y a pas beaucoup de code Ã  changer dans l&#8217;exemple prÃ©cÃ©dent pour y parvenir.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">progress/dots.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">let counter = 0;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const display = (count) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const dots = 'â€¢'.repeat(count).padEnd(3, 'Â·');</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const sun = count === 3 ? 'â˜€ï¸' : '';</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const cmd = counter !== 1 ? '\x1B[1F' : '';<text:s text:c="11"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log(`${cmd}(${dots}) Un-deux-trois ${sun}`);<text:s text:c="2"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">setInterval(() =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>counter++;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>display(counter);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>if (counter === 3) process.exit(0);</text:p><text:p text:style-name="Code">}, 1000);</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> La sÃ©quence d&#8217;Ã©chappement&#160;<text:span text:style-name="CodeDansTexte">\x1B</text:span> suivie de la commande&#160;<text:span text:style-name="CodeDansTexte">1F</text:span> dÃ©place le curseur d&#8217;une ligne vers le haut.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Cette sÃ©quence est ajoutÃ©e en dÃ©but de ligne remonter d&#8217;une ligne avant d&#8217;Ã©crire la suite des caractÃ¨res.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TableauTitre">Tableau 25. Liste de commandes ANSI pour dÃ©placer le curseur</text:p><table:table table:style-name="Tableau1"><table:table-column />,<table:table-column /><table:table-row><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Commande</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Effet</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">&lt;n&gt;E</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Descend le curseur de <text:span text:style-name="CodeDansTexte">&lt;n&gt;</text:span>&#160;lignes.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">&lt;n&gt;F</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Remonte le curseur de <text:span text:style-name="CodeDansTexte">&lt;n&gt;</text:span>&#160;lignes.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">&lt;n&gt;K</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Efface le contenu de la ligne, jusqu&#8217;Ã  la fin si <text:span text:style-name="CodeDansTexte">&lt;n&gt;</text:span>&#160;vaut&#160;<text:span text:style-name="CodeDansTexte">0</text:span>, jusqu&#8217;au dÃ©but si <text:span text:style-name="CodeDansTexte">&lt;n&gt;</text:span>&#160;vaut&#160;<text:span text:style-name="CodeDansTexte">1</text:span>, entiÃ¨rement si <text:span text:style-name="CodeDansTexte">&lt;n&gt;</text:span>&#160;vaut&#160;<text:span text:style-name="CodeDansTexte">2</text:span>.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">&lt;n&gt;A</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>DÃ©place le curseur de <text:span text:style-name="CodeDansTexte">&lt;n&gt;</text:span>&#160;cases vers le haut.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">&lt;n&gt;B</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>DÃ©place le curseur de <text:span text:style-name="CodeDansTexte">&lt;n&gt;</text:span>&#160;cases vers le bas.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">&lt;n&gt;C</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>DÃ©place le curseur de <text:span text:style-name="CodeDansTexte">&lt;n&gt;</text:span>&#160;cases vers la droite.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">&lt;n&gt;D</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>DÃ©place le curseur de <text:span text:style-name="CodeDansTexte">&lt;n&gt;</text:span>&#160;cases vers la gauche.</text:p></table:table-cell></table:table-row></table:table>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ã€ partir de lÃ , nous sommes libres d&#8217;Ã©crire nos propres barres de progression,
des indicateurs d&#8217;activitÃ© et de ne garder Ã  l&#8217;Ã©cran que les informations
reflÃ©tant l&#8217;Ã©tat actuel de l&#8217;application.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Deux modules <text:span text:style-name="CodeDansTexte">npm</text:span> simplifient la vie quand on n&#8217;apprÃ©cie pas trop les commandes ANSI&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="T4">ansi-escapes</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/ansi-escapes" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/ansi-escapes</text:a></text:span>) est l&#8217;Ã©quivalent
de <text:span text:style-name="T4">chalk</text:span> mais pour dÃ©placer le curseur.
undefined
L&#8217;utilisation de mÃ©thodes nommÃ©es remplace celle des commandes&#160;ANSI.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="T4">progress-string</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/progress-string" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/progress-string</text:a></text:span>) met
Ã  disposition une base pour afficher des barres de progression
avec un minimum d&#8217;options.
undefined</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Terminons cette section avec l&#8217;utilisation d&#8217;un indicateur d&#8217;activitÃ©
et une information de rÃ©ussite ou non de notre action.
Nous nous aidons du module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> <text:span text:style-name="T4">ora</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/ora" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/ora</text:a></text:span>).
undefined
undefined
Il est rapide Ã  configurer et propose une palette intÃ©ressante d&#8217;animations.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-08/images/cli-spinner.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>8-undefined.</text:span> Pendant et aprÃ¨s la progression avec le module&#160;ora</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous nous retrouvons Ã  enlever encore quelques lignes par rapport aux
exemples prÃ©cÃ©dents&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">progress/spinner.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const ora = require('ora');</text:p><text:p text:style-name="Code">let counter = 0;</text:p><text:p text:style-name="Code">const progress = ora().start('Un-deux-troisâ€¦'); <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">setInterval(() =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>counter++;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>if (counter === 3) {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>progress.succeed('Un-deux-troisâ€¦ Soleil !');<text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>process.exit(0);</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">}, 1000);</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> CrÃ©e et affiche un indicateur de progression animÃ©.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Nous indiquons que la tÃ¢che est terminÃ©e&#160;â€“ l&#8217;animation est remplacÃ©e par une marque de succÃ¨s.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous pouvons aussi tirer parti du fonctionnement du module <text:span text:style-name="T4">ora</text:span> en reproduisant
l&#8217;animation et en personnalisant le symbole de rÃ©ussite.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-08/images/cli-spinner-custom.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>8-undefined.</text:span> Pendant et&#160;aprÃ¨s l&#8217;indicateur de progression personnalisÃ© avec le module&#160;ora</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">progress/spinner-custom.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const ora = require('ora');</text:p><text:p text:style-name="Code">const progress = ora({</text:p><text:p text:style-name="Code"><text:s text:c="2"/>color: 'yellow',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>spinner: {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>frames: ['Â·Â·Â·', 'â€¢Â·Â·', 'â€¢â€¢Â·', 'â€¢â€¢â€¢'], <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>interval: 1000<text:s text:c="24"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">progress.start('Un-deux-troisâ€¦');</text:p><text:p text:style-name="Code">setTimeout(() =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>progress.stopAndPersist({ symbol: 'â˜€ï¸', text: 'Soleil !' });</text:p><text:p text:style-name="Code"><text:s text:c="2"/>process.exit(0);</text:p><text:p text:style-name="Code">}, 4000);</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> CrÃ©ation d&#8217;une sÃ©rie d&#8217;Ã©lÃ©ments d&#8217;animation.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Nous passons d&#8217;un index Ã  l&#8217;autre Ã  la vitesse exprimÃ©e en millisecondes.<text:line-break/></text:p>
<text:bookmark text:name="ref-tables" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Afficher des informations sous forme de tableau</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;affichage d&#8217;informations sous forme de tableau est idÃ©al pour
le <text:span text:style-name="T7">confort de lecture de listes</text:span>.
Notre lecture gagne en qualitÃ© quand notre vision s&#8217;attend
Ã  retrouver une structure prÃ©dictible.</text:p>
<text:p text:style-name="Code">$ node table.js</text:p><text:p text:style-name="Code">â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¤â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—</text:p><text:p text:style-name="Code">â•‘ Titre<text:s text:c="23"/>â”‚ ISBN<text:s text:c="11"/>â•‘</text:p><text:p text:style-name="Code">â•Ÿâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¢</text:p><text:p text:style-name="Code">â•‘ Node.js<text:s text:c="21"/>â”‚ 978-2212139938 â•‘</text:p><text:p text:style-name="Code">â•Ÿâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¢</text:p><text:p text:style-name="Code">â•‘ Sass pour les web designers â”‚ 978-2212141474 â•‘</text:p><text:p text:style-name="Code">â•Ÿâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¢</text:p><text:p text:style-name="Code">â•‘ Design Systems<text:s text:c="14"/>â”‚ 978-3945749586 â•‘</text:p><text:p text:style-name="Code">â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•§â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cet exemple est gÃ©nÃ©rÃ© Ã  l&#8217;aide du module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> <text:span text:style-name="T4">table</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/table" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/table</text:a></text:span>).
undefined
Il s&#8217;utilise sans configuration pour dÃ©marrer.
Il a la capacitÃ© de tronquer et limiter la largeur des colonnes, mais aussi
de gÃ©rer l&#8217;alignement des contenus dans les cellules.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">table.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {table} = require('table');</text:p><text:p text:style-name="Code">const {bold, green:g} = require('chalk');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const data = [</text:p><text:p text:style-name="Code"><text:s text:c="2"/>[bold('Titre'), bold('ISBN')],<text:s text:c="6"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>[g('Node.js'), '978-2212139938'],<text:s text:c="3"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>[g('Sass pour les web designers'), '978-2212141474'],</text:p><text:p text:style-name="Code"><text:s text:c="2"/>[g('Design Systems'), '978-3945749586'],</text:p><text:p text:style-name="Code">];</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(table(data));<text:s text:c="13"/><text:span text:style-name="PuceCode">3</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> L&#8217;en-tÃªte du tableau se distingue grÃ¢ce Ã  un style diffÃ©rent&#160;â€“ du texte en gras.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Chaque ligne du tableau est elle-mÃªme un tableau, Ã  deux colonnes dans ce cas de figure.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> L&#8217;affichage se fait sur un simple appel de fonction&#160;â€“ <text:span text:style-name="T4">table</text:span> calcule la largeur des colonnes pour&#160;nous.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Pratique</text:span> Utilisation des couleurs</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
La lecture de la section <text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-colors"  text:visited-style-name="Visited_20_Internet_20_Link">amÃ©liorer la lisibilitÃ© grÃ¢ce aux couleurs</text:a></text:span>
vous aidera Ã  amÃ©liorer la lisibilitÃ© de vos tableaux.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il est Ã  noter que le module <text:span text:style-name="T4">table</text:span> expose aussi une interface en flux, pour ajouter
des lignes au fur et Ã  mesure&#160;â€“ par exemple en cas de lecture continue
ou sur un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-streaming"  text:visited-style-name="Visited_20_Internet_20_Link">fichier volumineux</text:a>.</text:p>
<text:bookmark text:name="ref-update" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Inviter Ã  mettre Ã  jour le module</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;inconvÃ©nient d'<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-install.global"  text:visited-style-name="Visited_20_Internet_20_Link">installer un module exÃ©cutable</text:a>,
c&#8217;est la difficultÃ© de savoir si une mise Ã  jour intÃ©ressante a Ã©tÃ© publiÃ©e
(probablement parce que je ne pense pas Ã  lancer la commande <text:span text:style-name="CodeDansTexte">npm outdated --global</text:span>).
Il existe toutefois des moyens de signaler aux personnes qui utilisent votre
exÃ©cutable qu&#8217;une version plus rÃ©cente existe.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">J&#8217;aime l&#8217;approche minimaliste du module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> <text:span text:style-name="T4">update-check</text:span>
(<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/update-check" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/update-check</text:a></text:span>).
undefined
Il compare le numÃ©ro de version passÃ© en paramÃ¨tre avec celui de la derniÃ¨re
version de ce mÃªme module, sur le registre&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>.</text:p>
<text:p text:style-name="Code">$ node update/intro.js</text:p><text:p text:style-name="Code">{ latest: '0.10.0', fromCache: false }</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans cet exemple, <text:span text:style-name="T4">update-check</text:span> interroge le registre&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>
pour dÃ©terminer la version la plus rÃ©cente de <text:span text:style-name="T4">nodebook</text:span>.
undefined
S&#8217;il estime que la version installÃ©e localement est plus
ancienne, il retourne un objet avec le numÃ©ro de version Ã  installer.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">update/intro.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const check = require('update-check');</text:p><text:p text:style-name="Code">const pkg = { name: 'nodebook', version: '0.8.0' }; <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">check(pkg)<text:s text:c="30"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>.then(update =&gt; console.log(update)); <text:span text:style-name="PuceCode">3</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Les champs <text:span text:style-name="CodeDansTexte">name</text:span> et <text:span text:style-name="CodeDansTexte">version</text:span> suffisent Ã  accomplir la comparaison.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> DÃ©marrage de la comparaison.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Un objet est retournÃ© en cas de version plus rÃ©cente&#160;; sinon, c&#8217;est la valeur&#160;<text:span text:style-name="CodeDansTexte">null</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">En temps normal, c&#8217;est-Ã -dire dans le cas d&#8217;un module dont nous sommes Ã  l&#8217;origine
et que nous publions sur le registre&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>, nous aurions tendance
Ã  utiliser le contenu du fichier <text:span text:style-name="CodeDansTexte">package.json</text:span> en argument de la fonction <text:span text:style-name="CodeDansTexte">check</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Maintenant, nous pouvons prÃ©senter une information
plus digeste et actionnable Ã  la personne qui utilise notre module&#160;:
undefined</text:p>
<text:p text:style-name="Code">$ node update/cli.js</text:p><text:p text:style-name="Code">nodebook@0.10.0 est dispo</text:p><text:p text:style-name="Code">Tape 'npm install --global nodebook'</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">update/cli.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const parse = require('minimist');</text:p><text:p text:style-name="Code">const check = require('update-check');</text:p><text:p text:style-name="Code">const pkg = { name: 'nodebook', version: '0.8.0' };</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const logError = ({message}) =&gt; console.error(message);</text:p><text:p text:style-name="Code">const checkUpdate = (update) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>if (update) {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>const {name} = pkg;</text:p><text:p text:style-name="Code"><text:s text:c="4"/>console.log(`${name}@${update.latest} est dispo`);</text:p><text:p text:style-name="Code"><text:s text:c="4"/>console.log(`Tape 'npm install -g ${pkg.name}'`);</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">check(pkg)</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.then(checkUpdate, logError)<text:s text:c="6"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>.then(() =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>const args = parse(process.argv.slice(2));</text:p><text:p text:style-name="Code"><text:s text:c="4"/>// ...<text:s text:c="26"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Nous vÃ©rifions et affichons la mise Ã  jour si nÃ©cessaire&#160;; nous gÃ©rons aussi une erreur (par exemple, rÃ©seau indisponible ou registre&#160;HS).<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Nous gÃ©rons ensuite le code de notre exÃ©cutable&#160;â€“ <text:span text:style-name="T4">parsing</text:span> des arguments, gestion des actions, etc.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les utilisatrices et utilisateurs sont informÃ©s de la disponibilitÃ© d&#8217;une mise
Ã  jour dÃ¨s qu&#8217;elles se servenrt du module exÃ©cutable en question.
La dÃ©cision d&#8217;actualiser leur appartient toutefois.</text:p>
<text:bookmark text:name="ref-tests" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Vers un code rÃ©utilisable et testable</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous avons appris comment transformer un script Node en un programme paramÃ©trable,
clair et agrÃ©able Ã  utiliser.
Cette section a pour but de renforcer la robustesse de notre code.
Nous allons tout d&#8217;abord sÃ©parer ce qui est rÃ©utilisable de l&#8217;interface en ligne
de commande pour progressivement tester notre code, puis l&#8217;exÃ©cutable lui-mÃªme.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Notre progression va s&#8217;effectuer en transformant l&#8217;exemple <text:span text:style-name="CodeDansTexte">options/timezone.js</text:span>
de la section <text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-args"  text:visited-style-name="Visited_20_Internet_20_Link">Utiliser des arguments et des options</text:a></text:span>.
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">options/timezone.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const parse = require('minimist');</text:p><text:p text:style-name="Code">const args = parse(process.argv.slice(2));</text:p><text:p text:style-name="Code">const [timezone] = args._;<text:s text:c="26"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">if (!timezone) {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>throw Error('Merci d\'indiquer un fuseau horaire :-)');</text:p><text:p text:style-name="Code">}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const options = {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>timeZone: timezone,</text:p><text:p text:style-name="Code"><text:s text:c="2"/>hour: 'numeric', minute: 'numeric', hour12: false <text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const text = new Date().toLocaleDateString('fr-FR', options);</text:p><text:p text:style-name="Code">console.log(text);<text:s text:c="34"/><text:span text:style-name="PuceCode">3</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Nous affectons aÌ€ <text:span text:style-name="CodeDansTexte">timezone</text:span> la premieÌ€re valeur du tableau dâ€™arguments.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Configuration des prÃ©fÃ©rences d&#8217;affichage de l&#8217;heure.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Utilisation de la mÃ©thode <text:span text:style-name="CodeDansTexte">toLocaleDateString()</text:span> avec nos options pour afficher la date courante.<text:line-break/></text:p>
<text:bookmark text:name="ref-interface" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Modulariser le code du fichier exÃ©cutable</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un programme qui accepte beaucoup d&#8217;options devient de plus en plus
compliquÃ© Ã  maintenir car il est difficile de tester tous les cas
de figure Ã  la main.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un programme exÃ©cutable robuste est un script qui contient le moins possible de code
spÃ©cifique Ã  la gestion de la ligne de commandes.
Pour ce faire, nous allons sÃ©parer la logique d&#8217;exÃ©cution en la plaÃ§ant dans une
fonction, dans un autre module.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">testing/01/cli.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const getTime = require('./lib.js');</text:p><text:p text:style-name="Code">const args = require('minimist')(process.argv.slice(2));</text:p><text:p text:style-name="Code">const [timezone] = args._;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(getTime(timezone));<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Tout le code a Ã©tÃ© modularisÃ© sous forme d&#8217;une seule fonction.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous avons opÃ©rÃ© un changement&#160;: l&#8217;utilisation de <text:span text:style-name="CodeDansTexte">console.log()</text:span> pour l&#8217;affichage
des rÃ©sultats revient du cÃ´tÃ© de l&#8217;exÃ©cutable.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Notre code est portable s&#8217;il retourne un rÃ©sultat et en laissant la
responsabilitÃ© de l&#8217;affichage au code le plus proche de l&#8217;utilisateur
â€“ c&#8217;est le cas ici avec la fonction <text:span text:style-name="CodeDansTexte">getTime()</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">testing/01/lib.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">module.exports = (timezone) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>if (!timezone) {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>throw Error('Merci d\'indiquer un fuseau horaire :-)');</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>const options = {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>timeZone: timezone,</text:p><text:p text:style-name="Code"><text:s text:c="4"/>hour: 'numeric', minute: 'numeric', hour12: false</text:p><text:p text:style-name="Code"><text:s text:c="2"/>};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>return new Date().toLocaleDateString('fr-FR', options);</text:p><text:p text:style-name="Code">}</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette Ã©criture facilite l&#8217;Ã©criture de tests.
Justement, parlons-en.</text:p>
<text:bookmark text:name="ref-tests.interface" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Tester le code partagÃ©</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;Ã©criture de tests nous aide Ã  dÃ©couvrir qu&#8217;une modification produit un rÃ©sultat
diffÃ©rent de celui attendu.
Les tests documentent aussi les cas Ã  la marge de notre code.
En gÃ©nÃ©ral, dÃ¨s qu&#8217;il y a un <text:span text:style-name="CodeDansTexte">if &#8230;&#8203; else</text:span>, cela implique d&#8217;Ã©crire au moins une
nouvelle assertion.
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Glossaire</text:span> Test et assertion</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Une assertion est l&#8217;expression d&#8217;une attente quant au fonctionnement de notre code.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Un test s&#8217;applique Ã  une fonction et utilise une Ã  plusieurs assertion(s) pour
couvrir le spectre de ses fonctionnalitÃ©s.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Pour des besoins simples, j&#8217;utilise le module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> <text:span text:style-name="T4">tape</text:span>
(<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/tape" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/tape</text:a></text:span>).
undefined
Il gÃ¨re l&#8217;exÃ©cution des tests et il fournit quelques mÃ©thodes pour exprimer
nos attentes&#160;â€“ les assertions.
undefined</text:p>
<text:p text:style-name="Code">$ node testing/01/lib.test.js</text:p><text:p text:style-name="Code">TAP version 13</text:p><text:p text:style-name="Code"># getTime</text:p><text:p text:style-name="Code">ok 1 should be truthy</text:p><text:p text:style-name="Code">ok 2 should throw</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">1..2</text:p><text:p text:style-name="Code"># tests 2</text:p><text:p text:style-name="Code"># pass<text:s text:c="2"/>2</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"># ok</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans ce cas prÃ©cis, j&#8217;ai Ã©crit deux assertions qui illustrent les diffÃ©rents
cas de figure reprÃ©sentÃ©s dans le fichier <text:span text:style-name="CodeDansTexte">01/lib.js</text:span>
â€“ quand l&#8217;erreur est provoquÃ©e et quand le rÃ©sultat est retournÃ©&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">testing/01/lib.test.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const test = require('tape');</text:p><text:p text:style-name="Code">const getTime = require('./lib.js');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">test('getTime', t =&gt; {<text:s text:c="26"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>t.plan(2);<text:s text:c="36"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>t.ok(getTime('Europe/Paris'));<text:s text:c="16"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>t.throws(() =&gt; getTime(), /fuseau horaire/);<text:s text:c="2"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> CrÃ©ation d&#8217;un test&#160;â€“ le paramÃ¨tre&#160;<text:span text:style-name="CodeDansTexte">t</text:span> contient les mÃ©thodes d&#8217;assertion.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> La mÃ©thode <text:span text:style-name="CodeDansTexte">t.plan()</text:span> spÃ©cifie le nombre d&#8217;assertions attendues&#160;â€“ si ce nombre n&#8217;est pas atteint, <text:span text:style-name="T4">tape</text:span> considÃ¨re qu&#8217;il y a un problÃ¨me.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Assertion qui teste que la fonction <text:span text:style-name="CodeDansTexte">getTime()</text:span> retourne bien un rÃ©sultat.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Assertion qui teste que la fonction <text:span text:style-name="CodeDansTexte">getTime()</text:span> provoque une erreur si aucun argument n&#8217;est passÃ©.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous sommes parÃ©s Ã  toute Ã©ventualitÃ©, mais en y rÃ©flÃ©chissant, le module <text:span text:style-name="CodeDansTexte">cli.js</text:span>
ne gÃ¨re pas vraiment le cas oÃ¹ aucun argument n&#8217;est transmis.</text:p>
<text:p text:style-name="Code">$ node testing/01/cli.js</text:p><text:p text:style-name="Code">/â€¦/chapter-08/examples/testing/01/lib.js:5</text:p><text:p text:style-name="Code"><text:s text:c="4"/>throw Error('Merci d\'indiquer un fuseau horaire :-)');</text:p><text:p text:style-name="Code"><text:s text:c="4"/>^</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">Error: Merci d'indiquer un fuseau horaire :-)</text:p><text:p text:style-name="Code"><text:s text:c="4"/>at module.exports (/â€¦/examples/testing/01/lib.js:5:11)</text:p><text:p text:style-name="Code"><text:s text:c="4"/>at Object.&lt;anonymous&gt; (/â€¦/examples/testing/01/cli.js:7:13)</text:p><text:p text:style-name="Code"><text:s text:c="4"/>at Module._compile (internal/modules/cjs/loader.js:702:30)</text:p><text:p text:style-name="Code"><text:s text:c="4"/>at Object.Module._extensions..js (â€¦/cjs/loader.js:713:10)</text:p><text:p text:style-name="Code"><text:s text:c="4"/>â€¦</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Je trouve peu Ã©lÃ©gant d&#8217;Ãªtre accueilliÂ·e avec une trace d&#8217;erreur comme celle-ci.
L&#8217;erreur mÃ©riterait d&#8217;Ãªtre prÃ©sentÃ©e en contexte, celui de notre utilisation
et non celui des rouages internes de&#160;Node.</text:p>
<text:bookmark text:name="ref-display" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">PrÃ©senter les messages en contexte</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La prÃ©sentation des messages de rÃ©ussite et d&#8217;erreur nÃ©cessite d&#8217;Ãªtre Ã  l&#8217;Ã©coute
des signaux envoyÃ©s par notre code afin de le restituer de maniÃ¨re adaptÃ©e.</text:p>
<text:p text:style-name="Code">$ node testing/02/cli.js</text:p><text:p text:style-name="Code">Merci d'indiquer un fuseau horaire :-)</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Afin de parvenir Ã  ce rÃ©sultat, j&#8217;ai optÃ© pour l&#8217;utilisation de
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-promise"  text:visited-style-name="Visited_20_Internet_20_Link">promesse</text:a> (<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-03"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;3</text:a>).
undefined
Je trouve cette mÃ©thode plus Ã©lÃ©gante car nous gÃ©rons le rÃ©sultat et le message
d&#8217;erreur d&#8217;une maniÃ¨re visuellement similaire, mais sÃ©parÃ©e.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">testing/02/cli.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const getTime = require('./lib.js');</text:p><text:p text:style-name="Code">const args = require('minimist')(process.argv.slice(2));</text:p><text:p text:style-name="Code">const [timezone] = args._;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">getTime(timezone)</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.then(time =&gt; console.log(time))<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>.catch(error =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>console.error(error.message);<text:s text:c="3"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>process.exit(1);<text:s text:c="16"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Le rÃ©sultat est affichÃ© en cas de succÃ¨s.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> En cas d&#8217;erreur produite dans la fonction <text:span text:style-name="CodeDansTexte">getTime()</text:span>, nous affichons le message en question.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Nous arrÃªtons le programme avec un code d&#8217;erreur pour la signaler au niveau du systÃ¨me d&#8217;exploitation.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce changement n&#8217;implique pas de bouleversement dans notre code.
L&#8217;appel Ã  <text:span text:style-name="CodeDansTexte">throw</text:span> est remplacÃ© par <text:span text:style-name="CodeDansTexte">reject()</text:span> et le <text:span text:style-name="CodeDansTexte">return</text:span> se transforme en <text:span text:style-name="CodeDansTexte">resolve()</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">testing/02/lib.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">module.exports = (timezone) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>return new Promise((resolve, reject) =&gt; { <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>if (!timezone) {</text:p><text:p text:style-name="Code"><text:s text:c="6"/>reject(Error('Merci d\'indiquer un fuseau horaire :-)'));</text:p><text:p text:style-name="Code"><text:s text:c="4"/>}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="4"/>const options = {</text:p><text:p text:style-name="Code"><text:s text:c="6"/>timeZone: timezone,</text:p><text:p text:style-name="Code"><text:s text:c="6"/>hour: 'numeric', minute: 'numeric', hour12: false</text:p><text:p text:style-name="Code"><text:s text:c="4"/>};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="4"/>resolve(new Date().toLocaleDateString('fr-FR', options));</text:p><text:p text:style-name="Code"><text:s text:c="2"/>});</text:p><text:p text:style-name="Code">}</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Nous englobons le contenu entier de la fonction dans une promesse&#160;â€“ en cas de problÃ¨me Ã  un endroit imprÃ©vu, il sera remontÃ© et pris en charge de la mÃªme maniÃ¨re que notre rejet explicite.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous n&#8217;avons plus Ã  modifier le fichier <text:span text:style-name="CodeDansTexte">cli.js</text:span> pour gÃ©rer de nouveaux messages
d&#8217;erreur.
Nous pourrions mieux gÃ©rer certains cas de figure, par exemple quand
un fuseau horaire inconnu est spÃ©cifiÃ©.</text:p>
<text:p text:style-name="Code">$ node testing/02/cli.js Brexit/London</text:p><text:p text:style-name="Code">Unsupported time zone specified Brexit/London</text:p>
<text:bookmark text:name="ref-tests.cli" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Tester l&#8217;exÃ©cutable</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Tester l&#8217;exÃ©cutable est un moyen de vÃ©rifier que les cÃ¢blages entre notre
exÃ©cutable et notre mode Node sont bien faits.
L&#8217;idÃ©e n&#8217;est pas de tester Ã  nouveau les mÃªmes aspects du code, mais bel et
bien de nous assurer que les conditions d&#8217;utilisation du programme sont remplies.</text:p>
<text:p text:style-name="Code">$ node testing/02/cli.test.js</text:p><text:p text:style-name="Code">TAP version 13</text:p><text:p text:style-name="Code"># cli w/o arg</text:p><text:p text:style-name="Code">ok 1 exit code matched</text:p><text:p text:style-name="Code"># cli w/ arg</text:p><text:p text:style-name="Code">ok 2 matched /\d{2}:\d{2}/</text:p><text:p text:style-name="Code">ok 3 exit code matched</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">1..3</text:p><text:p text:style-name="Code"># tests 3</text:p><text:p text:style-name="Code"># pass<text:s text:c="2"/>3</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"># ok</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous avons Ã  nouveau recours au module <text:span text:style-name="T4">tape</text:span>.
Cette fois-ci, nous l&#8217;accompagnons d&#8217;un autre module,
<text:span text:style-name="T4">tape-spawn</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/tape-spawn" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/tape-spawn</text:a></text:span>).
undefined
undefined
Ce dernier intÃ¨gre Ã  <text:span text:style-name="T4">tape</text:span> le test de processus externes.
En l&#8217;occurrence ici, cela concerne nos exÃ©cutables en ligne de commandes.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">testing/02/cli.test.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const test = require('tape');</text:p><text:p text:style-name="Code">const spawn = require('tape-spawn');</text:p><text:p text:style-name="Code">const opts = {cwd: __dirname};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">test('cli w/o arg', t =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const proc = spawn(t, './cli.js', opts);<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>proc.exitCode(1);<text:s text:c="25"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>proc.end();</text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">test('cli w/ arg', t =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const proc = spawn(t, './cli.js Europe/Paris', opts);</text:p><text:p text:style-name="Code"><text:s text:c="2"/>proc.exitCode(0);</text:p><text:p text:style-name="Code"><text:s text:c="2"/>proc.stdout.match(/\d{2}:\d{2}/);<text:s text:c="9"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>proc.end();</text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Nous dÃ©marrons un nouveau processus&#160;â€“ ici, nous spÃ©cifions que le chemin d&#8217;accÃ¨s est relatif au rÃ©pertoire du script de tests.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Nous testons le code de sortie du programme&#160;â€“ c&#8217;est cohÃ©rent avec l&#8217;invocation de <text:span text:style-name="CodeDansTexte">process.exit(1)</text:span> dans <text:span text:style-name="CodeDansTexte">cli.js</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> En cas de rÃ©ussite, nous avons bien une heure qui s&#8217;affiche dans la sortie standard.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;utilisation conjointe des tests unitaires et de ceux de l&#8217;exÃ©cutable
nous permet de gagner en confiance dans la robustesse de notre code,
de dÃ©celer de nouveaux cas Ã  la marge et de nous rendre compte de certaines
incohÃ©rences d&#8217;interface utilisateur.</text:p>
<text:bookmark text:name="ref-doc" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Documenter notre programme</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La documentation d&#8217;un logiciel est aussi importante que son code.
C&#8217;est le premier Ã©lÃ©ment qui donne une idÃ©e de la simplicitÃ© ou de
la complexitÃ© d&#8217;utilisation d&#8217;un logiciel, de ce qu&#8217;il est possible de faire avec
et des concepts qui s&#8217;y rapportent.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le premier endroit oÃ¹ documenter son application est dans l&#8217;exÃ©cutable lui-mÃªme,
avec l&#8217;option <text:span text:style-name="CodeDansTexte">--help</text:span>&#160;â€“ ou son raccourci&#160;<text:span text:style-name="CodeDansTexte">-h</text:span>.
C&#8217;est une convention pour afficher une aide synthÃ©tique, rapide d&#8217;accÃ¨s
et facile Ã  comprendre.</text:p>
<text:p text:style-name="Code">$ node application/intro.js --help</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">Options:</text:p><text:p text:style-name="Code"><text:s text:c="2"/>--help<text:s text:c="5"/>Affiche de l'aide<text:s text:c="13"/>[boolÃ©en]</text:p><text:p text:style-name="Code"><text:s text:c="2"/>--version<text:s text:c="2"/>Affiche le numÃ©ro de version<text:s text:c="2"/>[boolÃ©en]</text:p><text:p text:style-name="Code"><text:s text:c="2"/>--utc, -u<text:s text:c="32"/>[boolÃ©en]</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;aide proposÃ©e ici est minimale et n&#8217;indique que trop peu l&#8217;intention du programme.
Nous n&#8217;avons aucune idÃ©e de l&#8217;effet de telle ou telle option,
du rÃ©sultat qui va se produire ou encore des valeurs acceptÃ©es par le programme.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Une aide qui me rassure et m&#8217;informe ressemble plutÃ´t Ã  ce qui suit&#160;:</text:p>
<text:p text:style-name="Code">$ node help/time.js --help</text:p><text:p text:style-name="Code">Affiche l'heure courante d'ici ou d'ailleurs.</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">Commandes:</text:p><text:p text:style-name="Code"><text:s text:c="2"/>time.js timezones<text:s text:c="2"/>Affiche les fuseaux horaires IANA.</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">Options:</text:p><text:p text:style-name="Code"><text:s text:c="2"/>--version<text:s text:c="3"/>Affiche le numÃ©ro de version<text:s text:c="12"/>[boolÃ©en]</text:p><text:p text:style-name="Code"><text:s text:c="2"/>--utc<text:s text:c="7"/>Utilise le fuseau horaire universel.<text:s text:c="4"/>[boolÃ©en]</text:p><text:p text:style-name="Code"><text:s text:c="2"/>--timezone<text:s text:c="2"/>PrÃ©cise le fuseau horaire au format IANA.</text:p><text:p text:style-name="Code"><text:s text:c="2"/>--help<text:s text:c="6"/>Affiche de l'aide<text:s text:c="23"/>[boolÃ©en]</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">Exemples:</text:p><text:p text:style-name="Code"><text:s text:c="2"/>time.js --utc<text:s text:c="20"/>Heure universelle.</text:p><text:p text:style-name="Code"><text:s text:c="2"/>time.js --timezone=Europe/Lisbon Heure de Lisbonne.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Elle vÃ©hicule l'<text:span text:style-name="T7">intention du programme</text:span>, des exemples qui prÃ©cisent un concept
que je ne connais pas (fuseau horaire IANA) et j&#8217;y dÃ©couvre mÃªme
l&#8217;existence d&#8217;une commande qui liste ces fameux fuseaux horaires.
Au premier coup d&#8217;Å“il, je ne dÃ©cÃ¨le pas d&#8217;impasse et j&#8217;y vois plutÃ´t une
invitation Ã  essayer sans apprÃ©hension.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette aide a Ã©tÃ© gÃ©nÃ©rÃ©e automatiquement en utilisant le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-application"  text:visited-style-name="Visited_20_Internet_20_Link">framework</text:a>
<text:span text:style-name="T4">yargs</text:span>&#160;â€“ nous en parlerons dans la section suivante.
undefined
Ses mÃ©thodes <text:span text:style-name="CodeDansTexte">.usage()</text:span> et <text:span text:style-name="CodeDansTexte">.example()</text:span> ainsi que la propriÃ©tÃ© <text:span text:style-name="CodeDansTexte">description</text:span> de chaque
option suffisent Ã  constituer un affichage clair et informatif.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">help/time.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const args = require('yargs')</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.usage('Affiche l\'heure courante d\'ici ou d\'ailleurs.')</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.example('$0 --utc', 'Heure universelle.')<text:s text:c="12"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>.example('$0 --timezone=Europe/Lisbon', 'Heure de Lisbonne.')</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.command('timezones', 'Affiche les fuseaux horaires IANA.')</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.option('utc', {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>type: 'boolean',<text:s text:c="36"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>description: 'Utilise le fuseau horaire universel.' <text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>})</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.option('timezone', {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>description: 'PrÃ©cise le fuseau horaire au format IANA.'</text:p><text:p text:style-name="Code"><text:s text:c="2"/>})</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.locale('fr')</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.argv;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(args);</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Documente un exemple d&#8217;utilisation et une description qui prÃ©cisent l&#8217;intention.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Le type de l&#8217;option est rendu explicite lors de l&#8217;affichage de la documentation.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> La description prÃ©cise l&#8217;intention de l&#8217;option pour mieux comprendre son effet si elle est activÃ©e.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Alternative</text:span> module&#160;npm help-version</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
undefined
Le module <text:span text:style-name="T4">help-version</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/help-version" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/help-version</text:a></text:span>) gÃ¨re l&#8217;appel
Ã  l&#8217;option <text:span text:style-name="CodeDansTexte">--help</text:span> et il est indÃ©pendant de tout autre module.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Le seul risque est d&#8217;avoir une documentation qui est dÃ©synchronisÃ©e du
fonctionnement du programme.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un autre lieu courant pour documenter un projet est le <text:span text:style-name="CodeDansTexte">README</text:span>.
undefined
undefined
C&#8217;est un fichier texte souvent affichÃ© en premier sur la page d&#8217;accueil
d&#8217;un projet logiciel.
Sa mise en forme s&#8217;amÃ©liore avec l&#8217;utilisation d&#8217;une syntaxe de balisage lÃ©ger
comme <text:span text:style-name="T4">Markdown</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce type de fichier est trÃ¨s largement suffisant pour documenter un projet.
C&#8217;est l&#8217;Ã©quivalent de l&#8217;option <text:span text:style-name="CodeDansTexte">--help</text:span>, Ã  l&#8217;Ã©chelle de l&#8217;application&#160;â€“
son intention gÃ©nÃ©rale, sa compatibilitÃ© de version avec Node, comment l&#8217;installer,
oÃ¹ poser des questions et peut-Ãªtre mÃªme davantage d&#8217;exemples pour mieux comprendre
ce qui ne tiendrait pas dans l&#8217;option <text:span text:style-name="CodeDansTexte">--help</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Je trouve que le <text:span text:style-name="CodeDansTexte">README</text:span> est un excellent endroit pour reporter
l&#8217;affichage de la commande <text:span text:style-name="CodeDansTexte">--help</text:span>.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-08/images/documentation-readme.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>8-undefined.</text:span> PrÃ©sentation de la documentation d&#8217;un exÃ©cutable dans un&#160;README</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nul besoin de faire compliquÃ© pour vÃ©hiculer autant d&#8217;informations essentielles
avec un minimum d&#8217;efforts.
DÃ©marrer un projet en Ã©crivant cette documentation est un excellent moyen pour
travailler Ã  la clarification de ses idÃ©es et pour commencer Ã  imaginer la
forme que va prendre l'<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-tests"  text:visited-style-name="Visited_20_Internet_20_Link">Ã©criture des&#160;tests</text:a>.</text:p>
<text:bookmark text:name="ref-advanced" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Pour aller plus loin</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans les prÃ©cÃ©dentes sections, nous avons vu des composantes essentielles
pour crÃ©er un programme exÃ©cutable clair et fonctionnel.
Cette derniÃ¨re section va se focaliser sur des concepts qui structurent,
simplifient et rapprochent un exÃ©cutable en ligne de commande d&#8217;une application
web ou <text:span text:style-name="T4">front-end</text:span>.</text:p>
<text:bookmark text:name="ref-application" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Utilisation d&#8217;un framework d&#8217;application en ligne de commande</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Une application en ligne de commande dont le nombre de lignes de code augmente
devient de <text:span text:style-name="T7">plus en plus complexe Ã  maintenir</text:span>.
Potentiellement, l&#8217;expÃ©rience d&#8217;utilisation se dÃ©grade aussi.
Il faut continuer Ã  <text:span text:style-name="T7">prendre soin de la cohÃ©rence des arguments</text:span>, des options et
de valider que ce sont les valeurs attendues.
Cette complexitÃ© appelle aussi Ã  afficher une aide Ã  la demande ou de maniÃ¨re
contextuelle, par exemple au niveau de la sous-commande.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Des modules&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> comme <text:span text:style-name="T4">yargs</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/yargs" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/yargs</text:a></text:span>) aident Ã 
structurer la crÃ©ation d&#8217;applications en ligne de commande en intÃ©grant
la majoritÃ© des fonctionnalitÃ©s vues dans la section
<text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-interactive"  text:visited-style-name="Visited_20_Internet_20_Link">Du script au programme interactif</text:a></text:span>.
La gÃ©nÃ©ration de l&#8217;aide, le <text:span text:style-name="T4">parsing</text:span> d&#8217;arguments et d&#8217;options et leur validation
sont connectÃ©s ensemble, de maniÃ¨re transparente.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce genre de module est intÃ©ressant Ã  utiliser quand l&#8217;assemblage d&#8217;autres
modules indÃ©pendants rend le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-interface"  text:visited-style-name="Visited_20_Internet_20_Link">programme trop fragile</text:a> et
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-tests"  text:visited-style-name="Visited_20_Internet_20_Link">trop compliquÃ© Ã  tester</text:a>.</text:p>
<text:p text:style-name="Code">$ node application/intro.js --help</text:p><text:p text:style-name="Code">Options:</text:p><text:p text:style-name="Code"><text:s text:c="2"/>--version<text:s text:c="2"/>Affiche le numÃ©ro de version<text:s text:c="6"/>[boolÃ©en]</text:p><text:p text:style-name="Code"><text:s text:c="2"/>--utc, -u<text:s text:c="36"/>[boolÃ©en]</text:p><text:p text:style-name="Code"><text:s text:c="2"/>--help<text:s text:c="5"/>Affiche de l'aide<text:s text:c="17"/>[boolÃ©en]</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La commande d&#8217;aide est gÃ©nÃ©rÃ©e automatiquement Ã  partir de la
dÃ©finition d&#8217;arguments et d&#8217;options.</text:p>
<text:p text:style-name="Code">$ node application/intro.js</text:p><text:p text:style-name="Code">{ _: [],</text:p><text:p text:style-name="Code"><text:s text:c="2"/>version: false,</text:p><text:p text:style-name="Code"><text:s text:c="2"/>utc: false,</text:p><text:p text:style-name="Code"><text:s text:c="2"/>u: false,</text:p><text:p text:style-name="Code"><text:s text:c="2"/>help: false,</text:p><text:p text:style-name="Code"><text:s text:c="2"/>'$0': 'application/intro.js' }</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">application/intro.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const yargs = require('yargs');</text:p><text:p text:style-name="Code">const args = yargs</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.option('utc', {<text:s text:c="4"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>alias: 'u',</text:p><text:p text:style-name="Code"><text:s text:c="4"/>type: 'boolean',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>})</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.locale('fr')<text:s text:c="7"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>.argv;<text:s text:c="14"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(args);</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> CrÃ©ation de l&#8217;option <text:span text:style-name="CodeDansTexte">--utc</text:span> avec l&#8217;alias&#160;<text:span text:style-name="CodeDansTexte">-u</text:span>, de type boolÃ©en.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Les messages gÃ©nÃ©rÃ©s par l&#8217;application seront en franÃ§ais&#160;â€“ sans cette option, la langue s&#8217;adapte Ã  celle du systÃ¨me d&#8217;exploitation.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Applique les rÃ¨gles prÃ©cÃ©dentes aux Ã©lÃ©ments contenus dans <text:span text:style-name="CodeDansTexte">process.argv</text:span> et retourne un rÃ©sultat sous forme d&#8217;objet.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le mÃ©canisme de coercition dÃ©finit la rÃ¨gle de transformation d&#8217;une option
vers une autre reprÃ©sentation, plus pratique Ã  utiliser.
C&#8217;est le cas des dates par exemple&#160;: nous les recevons sous forme de chaÃ®ne de
caractÃ¨res alors qu&#8217;il serait plus facile de travailler avec des
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-date"  text:visited-style-name="Visited_20_Internet_20_Link">objets&#160;<text:span text:style-name="CodeDansTexte">Date</text:span></text:a>
(<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-03"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;3</text:a>).
undefined
undefined</text:p>
<text:p text:style-name="Code">$ node application/coerce.js --help</text:p><text:p text:style-name="Code">Options:</text:p><text:p text:style-name="Code"><text:s text:c="2"/>--help<text:s text:c="5"/>Affiche de l'aide<text:s text:c="15"/>[boolÃ©en]</text:p><text:p text:style-name="Code"><text:s text:c="2"/>--version<text:s text:c="2"/>Affiche le numÃ©ro de version<text:s text:c="4"/>[boolÃ©en]</text:p><text:p text:style-name="Code"><text:s text:c="2"/>--date<text:s text:c="15"/>[chaÃ®ne de caractÃ¨re] [dÃ©faut: now]</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Par dÃ©faut, la date est calÃ©e sur l&#8217;instant prÃ©sent&#160;:</text:p>
<text:p text:style-name="Code">$ node application/coerce.js</text:p><text:p text:style-name="Code">2018-06-21T08:41:23.091Z</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Une date peut mÃªme Ãªtre incomplÃ¨te&#160;:</text:p>
<text:p text:style-name="Code">$ node application/coerce.js --date 2018-03-24</text:p><text:p text:style-name="Code">2018-03-24T00:00:00.000Z</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">application/coerce.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const yargs = require('yargs');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const args = yargs</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.locale('fr')</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.option('date', {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>type: 'string',</text:p><text:p text:style-name="Code"><text:s text:c="4"/>default: new Date(),<text:s text:c="14"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>defaultDescription: 'now',<text:s text:c="8"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>coerce: input =&gt; new Date(input)<text:s text:c="2"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>})</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.argv;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(args.date.toISOString())</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> La valeur par dÃ©faut de l&#8217;option <text:span text:style-name="CodeDansTexte">--date</text:span> est un objet <text:span text:style-name="CodeDansTexte">Date</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Ce rÃ©glage personnalise l&#8217;affichage de la valeur par dÃ©faut dans la zone d&#8217;aide&#160;â€“ sans cela, la date complÃ¨te serait affichÃ©e, ce qui est peu Ã©lÃ©gant et moins informatif.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Cette fonction s&#8217;assure que toute valeur passÃ©e en option est transformÃ©e en objet&#160;<text:span text:style-name="CodeDansTexte">Date</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Voici un autre exemple du mÃ©canisme de coercition, cette fois-ci appliquÃ©
Ã  un chemin d&#8217;accÃ¨s de fichier&#160;:</text:p>
<text:p text:style-name="Code">$ node application/coerce-file.js --json-file ../package.json</text:p><text:p text:style-name="Code">{ name: 'nodebook.chapter-08',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>version: '1.0.0',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>...</text:p><text:p text:style-name="Code">}</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le chemin d&#8217;accÃ¨s passÃ© en option est interceptÃ© par une fonction.
Elle le reÃ§oit en argument et a la responsabilitÃ© d&#8217;en lire
le contenu et de le transformer en objet ECMAScript grÃ¢ce Ã  la fonction
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-json"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">JSON.parse()</text:span></text:a>
(<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-03"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;3</text:a>).
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">application/coerce-file.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const yargs = require('yargs');</text:p><text:p text:style-name="Code">const {readFileSync} = require('fs');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const parseJSON = (path) =&gt; JSON.parse(readFileSync(path));</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const args = yargs</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.locale('fr')</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.option('json-file', {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>type: 'string',</text:p><text:p text:style-name="Code"><text:s text:c="4"/>coerce: parseJSON,<text:s text:c="8"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>})</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.argv;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(args.jsonFile);<text:s text:c="3"/><text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Notre fonction <text:span text:style-name="CodeDansTexte">parseJSON()</text:span> assure la transformation de l&#8217;argument <text:span text:style-name="CodeDansTexte">--json-file</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> C&#8217;est bien le contenu du fichier qui s&#8217;affiche et non la valeur passÃ©e au programme.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Performance</text:span> Lire et Ã©crire des fichiers</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
undefined
undefined
La lecture de fichiers dont la taille dÃ©passe quelques centaines de kilo-octets
devient problÃ©matique sur des machines avec peu de ressources,
si vous souhaitez obtenir des rÃ©sultats le plus tÃ´t possible et si
vous avez d&#8217;autres impÃ©ratifs de performance.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Je vous invite Ã  lire la section <text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-streaming"  text:visited-style-name="Visited_20_Internet_20_Link">Utiliser les flux de donnÃ©es</text:a></text:span>
pour en savoir plus.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette pratique renforce une approche applicative modulaire.
L'<text:span text:style-name="T7">interface absorbe</text:span> les spÃ©cificitÃ©s de la ligne de commandes.
L'<text:span text:style-name="T7">application rÃ©agit aux paramÃ¨tres</text:span> sans avoir Ã  se prÃ©occuper du contexte,
que ce soit sur le Web ou dans un terminal.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les frameworks d&#8217;application en ligne de commande facilitent
l&#8217;organisation et la dÃ©finition de <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-args.subcommand"  text:visited-style-name="Visited_20_Internet_20_Link">sous-commandes</text:a>.
undefined</text:p>
<text:p text:style-name="Code">$ node application/random.js --help</text:p><text:p text:style-name="Code">random.js [command]</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">Commandes:</text:p><text:p text:style-name="Code"><text:s text:c="2"/>random.js words [count]<text:s text:c="2"/>Des mots</text:p><text:p text:style-name="Code"><text:s text:c="2"/>random.js number<text:s text:c="9"/>Un nombre</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">Options:</text:p><text:p text:style-name="Code"><text:s text:c="2"/>--help<text:s text:c="5"/>Affiche de l'aide<text:s text:c="16"/>[boolÃ©en]</text:p><text:p text:style-name="Code"><text:s text:c="2"/>--version<text:s text:c="2"/>Affiche le numÃ©ro de version<text:s text:c="5"/>[boolÃ©en]</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">C&#8217;est l&#8217;occasion d&#8217;adapter l&#8217;exemple utilisÃ© dans la section
<text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-args.subcommand"  text:visited-style-name="Visited_20_Internet_20_Link">Utiliser des arguments et des options</text:a></text:span>.
undefined
undefined
L&#8217;intention est de modifier le moins possible le code initial.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">application/random.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {random} = require('faker/locale/fr');</text:p><text:p text:style-name="Code">const yargs = require('yargs');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const number = () =&gt; random.number();</text:p><text:p text:style-name="Code">const words = (count=5) =&gt; random.words(count);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">yargs</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.locale('fr')</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.command('words [count]', 'Des mots', {}, (args) =&gt; { <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>console.log(words(args.count));<text:s text:c="21"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>})</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.command('number', 'Un nombre', {}, () =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>console.log(number());</text:p><text:p text:style-name="Code"><text:s text:c="2"/>})</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.argv;</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> La commande <text:span text:style-name="CodeDansTexte">words</text:span> accepte un argument optionnel <text:span text:style-name="CodeDansTexte">count</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Cette fonction est dÃ©clenchÃ©e quand la commande <text:span text:style-name="CodeDansTexte">words</text:span> est exÃ©cutÃ©e.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Je trouve qu&#8217;il est plus facile d&#8217;exÃ©cuter une fonction avec les bons arguments
en utilisant ce mÃ©canisme de sous-commandes.
Nous n&#8217;avons mÃªme pas eu Ã  modifier la signature des fonctions <text:span text:style-name="CodeDansTexte">words</text:span> et <text:span text:style-name="CodeDansTexte">number</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Syntaxe</text:span> Annotation des arguments dans une commande</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
Certains frameworks comme <text:span text:style-name="T4">yargs</text:span> interprÃ¨tent la commande que nous dÃ©clarons.
Lorsque c&#8217;est le cas, les arguments sont rangÃ©s dans un objet d&#8217;arguments nommÃ©s.
Les frameworks gÃ¨rent plusieurs cas de figure qui ont chacun leur notation.</text:p>
<text:bookmark text:name="ref-undefined" /><table:table table:style-name="Tableau1"><table:table-column />,<table:table-column />,<table:table-column /><table:table-row><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Syntaxe</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Type d&#8217;argument</text:p></table:table-cell><table:table-cell table:style-name="TableauTitreColonne" office:value-type="string"><text:p>Explication</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">cmd [arg1]</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Optionnel</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>L&#8217;argument <text:span text:style-name="CodeDansTexte">arg1</text:span> n&#8217;est pas obligatoire.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">cmd &lt;arg1&gt;</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Obligatoire</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>L&#8217;argument <text:span text:style-name="CodeDansTexte">arg1</text:span> est obligatoire.</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>`cmd &lt;arg1</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>arg2&gt;`</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Alias</text:p></table:table-cell></table:table-row><table:table-row><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>L&#8217;argument est obligatoire et accepte deux informations diffÃ©rentes â€“ un identifiant ou une adresse courriel par exemple.</text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p><text:span text:style-name="CodeDansTexte">cmd [&#8230;&#8203;args]</text:span></text:p></table:table-cell><table:table-cell table:style-name="TableauCorps" office:value-type="string"><text:p>Tableau</text:p></table:table-cell></table:table-row></table:table>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un rÃ©sultat identique s&#8217;obtient en organisant les sous-commandes dans des fichiers
individuels et en indiquant Ã  <text:span text:style-name="T4">yargs</text:span> dans quel rÃ©pertoire les charger.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">application/random-dir.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const yargs = require('yargs');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">yargs</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.locale('fr')</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.commandDir('./commands') <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>.argv;</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> DÃ©claration du rÃ©pertoire dans lequel nous avons rangÃ© les sous-commandes.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous ne dÃ©clarons plus les commandes sous forme d&#8217;un appel de fonction mais
en retournant un module Node.
Chacune de ses clÃ©s configure un aspect de la commande&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">application/commands/words.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {random} = require('faker/locale/fr');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">module.exports = {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>command: 'words [count]',<text:s text:c="22"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>desc: 'GÃ©nÃ¨re des mots',<text:s text:c="23"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>handler: (args) =&gt; {<text:s text:c="27"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>console.log(random.words(args.count || 5));</text:p><text:p text:style-name="Code"><text:s text:c="2"/>},</text:p><text:p text:style-name="Code">};</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Arguments acceptÃ©s par la commande.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Description de la commande.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Fonction dÃ©clenchÃ©e lorsque la commande est exÃ©cutÃ©e.<text:line-break/></text:p>
<text:bookmark text:name="ref-files" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">StratÃ©gies pour gÃ©rer les chemins d&#8217;accÃ¨s</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">undefined
undefined
undefined</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il y a des cas oÃ¹ passer des chemins d&#8217;accÃ¨s Ã  des fichiers en <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-args"  text:visited-style-name="Visited_20_Internet_20_Link">arguments</text:a>
d&#8217;un exÃ©cutable ne suffit pas.
C&#8217;est le cas notamment quand on ne connaÃ®t pas la liste exacte des fichiers ou
lorsqu&#8217;elle est susceptible de changer.</text:p>
<text:p text:style-name="Code">$ node files/intro.js ../package.json \</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"$(nodebook dir chapter-08 --root)/package-lock.json"</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">[ 'â€¦/chapter-08/package.json',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>'â€¦/chapter-08/package-lock.json' ]</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cet exemple illustre l&#8217;utilisation d&#8217;un chemin relatif et d&#8217;un
chemin absolu, tous deux normalisÃ©s en chemins absolus.
En procÃ©dant ainsi, nous rendons notre code indÃ©pendant de son
contexte d&#8217;exÃ©cution&#160;â€“ ici, notre emplacement au sein du systÃ¨me de fichiers.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">files/intro.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {resolve} = require('path');</text:p><text:p text:style-name="Code">const files = process.argv.slice(2);<text:s text:c="10"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const resolveFile = (file) =&gt; resolve(file);<text:s text:c="2"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(files.map(resolveFile));<text:s text:c="10"/><text:span text:style-name="PuceCode">3</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> La liste des fichiers correspond Ã  tous les arguments du script.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Chaque chemin d&#8217;accÃ¨s est transformÃ© en chemin absolu.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> La liste homogÃ©nÃ©isÃ©e est affichÃ©e Ã  l&#8217;Ã©cran.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">RepÃ¨re</text:span> Chemin relatif, absolu ou __dirname ?</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">undefined
undefined
undefined
Les fichiers passÃ©s en argument peuvent Ãªtre un mÃ©lange de chemins absolus
et de chemins relatifs, qui se normalisent avec la fonction <text:span text:style-name="CodeDansTexte">path.resolve()</text:span>.
undefined
undefined
La base Ã  considÃ©rer est le <text:span text:style-name="T4">rÃ©pertoire courant</text:span>, lÃ  oÃ¹ le programme est exÃ©cutÃ©,
c&#8217;est-Ã -dire la valeur de <text:span text:style-name="CodeDansTexte">process.cwd()</text:span>
(<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-path"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;4</text:a>).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque"><text:span text:style-name="CodeDansTexte">__dirname</text:span> est une base Ã  utiliser lorsqu&#8217;un chemin est relatif au code source.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La saisie des chemins se simplifie en utilisant deux mÃ©canismes&#160;: l'<text:span text:style-name="T4">expansion</text:span>
et le <text:span text:style-name="T4">globbing</text:span>.
Le module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> <text:span text:style-name="T4">glob</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/glob" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/glob</text:a></text:span>) fait trÃ¨s bien ce travail,
mais nous allons nous baser sur <text:span text:style-name="T4">globby</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/globby" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/globby</text:a></text:span>) Ã  la place.
undefined
undefined
Il gÃ¨re les <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-promise"  text:visited-style-name="Visited_20_Internet_20_Link">promesses</text:a> et je le trouve
plus simple d&#8217;utilisation.</text:p>
<text:p text:style-name="Code">$ node files/glob.js '../package-*.json'</text:p><text:p text:style-name="Code">['â€¦/chapter-08/package.json', 'â€¦/package-lock.json']</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans cet exemple, nous partons Ã  la recherche de tous les fichiers prÃ©fixÃ©s
par <text:span text:style-name="CodeDansTexte">package-</text:span> et terminÃ©s par <text:span text:style-name="CodeDansTexte">.json</text:span>.
Cette intention est exprimÃ©e par un seul argument qui contient le caractÃ¨re
de <text:span text:style-name="T4">globbing</text:span>&#160;(<text:span text:style-name="CodeDansTexte">*</text:span>).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">files/glob.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const glob = require('globby');</text:p><text:p text:style-name="Code">const {resolve} = require('path');</text:p><text:p text:style-name="Code">const patterns = process.argv.slice(2);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const resolveFiles = (files) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>return files.map(file =&gt; resolve(file));</text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">glob(patterns)<text:s text:c="32"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>.then(files =&gt; resolveFiles(files))<text:s text:c="9"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>.then(files =&gt; console.log(files));<text:s text:c="9"/><text:span text:style-name="PuceCode">3</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Le module <text:span text:style-name="T4">globby</text:span> accepte un ou plusieurs motif(s)&#160;â€“ ici nous n&#8217;en utilisons qu&#8217;un.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Nous transformons les fichiers identifiÃ©s en chemins absolus.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Pour ensuite les afficher dans le terminal.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;expansion est caractÃ©risÃ©e par l&#8217;utilisation des accolades.
Les valeurs sont sÃ©parÃ©es par des virgules, qui signifient <text:span text:style-name="T4">ou</text:span>.
Les deux syntaxes se combinent ici pour rÃ©cupÃ©rer les fichiers suffixÃ©s par
<text:span text:style-name="CodeDansTexte">.adoc</text:span> ou par&#160;<text:span text:style-name="CodeDansTexte">.html</text:span>&#160;:</text:p>
<text:p text:style-name="Code">$ node files/glob.js '../*.{adoc,html}'</text:p><text:p text:style-name="Code">['â€¦/chapter-08/index.adoc']</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Enfin, l&#8217;utilisation de la double-Ã©toile&#160;(<text:span text:style-name="CodeDansTexte">**</text:span>) signifie <text:span text:style-name="T4">dans tous les rÃ©pertoires</text:span>.
Nous rÃ©cupÃ©rons ainsi tous les fichiers&#160;<text:span text:style-name="CodeDansTexte">.js</text:span> contenus dans ce rÃ©pertoire
et les sous-rÃ©pertoires&#160;:</text:p>
<text:p text:style-name="Code">$ node files/glob.js '**/*.js'</text:p><text:p text:style-name="Code">['â€¦/chapter-08/examples/hello.js', â€¦]</text:p>
<text:bookmark text:name="ref-streaming" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Utiliser les flux de donnÃ©es (stdin, stdout et stderr)</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette section complÃ¨te notre dÃ©couverte du
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-stream"  text:visited-style-name="Visited_20_Internet_20_Link">module <text:span text:style-name="CodeDansTexte">stream</text:span></text:a>
(<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-04"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;4</text:a>).
Mon intention est de vous aiguiller dans la conception d&#8217;applications
en ligne de commande qui acceptent des flux de donnÃ©es, en entrÃ©e
comme en sortie.
La ligne de commande se prÃªte tout particuliÃ¨rement au <text:span text:style-name="T4">streaming</text:span> et
nos applications gagnent Ã  fonctionner longtemps en consommant le
moins de ressources possibles.</text:p>
<text:p text:style-name="Code">$ cat blah.txt</text:p><text:p text:style-name="Code">blah blah</text:p><text:p text:style-name="Code">$ cat blah.txt | node streaming/intro.js</text:p><text:p text:style-name="Code">BLAH BLAH</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">streaming/intro.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const getStdin = require('get-stdin');<text:s text:c="16"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const uppercase = (text) =&gt; text.toLocaleUpperCase();</text:p><text:p text:style-name="Code">const log = (text) =&gt; process.stdout.write(text);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">getStdin().then(uppercase).then(log);<text:s text:c="17"/><text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Le module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> <text:span text:style-name="T4">get-stdin</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/get-stdin" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/get-stdin</text:a></text:span>) est pratique pour un flux d&#8217;entrÃ©e Ã  petit volume.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Il retourne une promesse quand il a terminÃ© de lire le flux d&#8217;entrÃ©e.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">J&#8217;aime bien proposer une alternative Ã  l&#8217;entrÃ©e standard, en utilisant
les <text:span text:style-name="T7">arguments lorsqu&#8217;il y a un nombre indÃ©fini d&#8217;Ã©lÃ©ments</text:span> Ã  lire.
Je trouve que cette proposition Ã©vite de renoncer Ã  un outil
dans un contexte oÃ¹ il est impossible de configurer un flux d&#8217;entrÃ©e.</text:p>
<text:p text:style-name="Code">$ cat blah.txt | node streaming/intro-fallback.js</text:p><text:p text:style-name="Code">BLAH BLAH</text:p><text:p text:style-name="Code">$ node streaming/intro-fallback.js $(&lt; blah.txt)</text:p><text:p text:style-name="Code">BLAH BLAH</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La stratÃ©gie consiste Ã  utiliser l&#8217;entrÃ©e standard quand on dÃ©tecte une absence
d&#8217;arguments et, sinon, d&#8217;utiliser ces derniers.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">streaming/intro-fallback.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const getStdin = require('get-stdin');</text:p><text:p text:style-name="Code">const input = process.argv.slice(2);<text:s text:c="6"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const uppercase = (text) =&gt; text.toLocaleUpperCase();</text:p><text:p text:style-name="Code">const log = (text) =&gt; process.stdout.write(text);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">if (input.length === 0) {<text:s text:c="17"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>getStdin().then(uppercase).then(log);</text:p><text:p text:style-name="Code">}</text:p><text:p text:style-name="Code">else {<text:s text:c="36"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>Promise.resolve(input.join(' ')).then(uppercase).then(log);</text:p><text:p text:style-name="Code">}</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Nous rÃ©cupÃ©rons les arguments du script.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Chaque mot (sÃ©parÃ© par un espace) est considÃ©rÃ© comme un argument&#160;â€“ s&#8217;il n&#8217;y en a pas, nous pouvons utiliser l&#8217;entrÃ©e standard.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Sinon nous rassemblons les mots en une seule chaÃ®ne de caractÃ¨res.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Notons au passage l&#8217;utilisation de <text:span text:style-name="CodeDansTexte">Promise.resolve()</text:span>
(<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-promise"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;3</text:a>) pour transformer deux
sources de donnÃ©es de maniÃ¨re identique.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-args.options"  text:visited-style-name="Visited_20_Internet_20_Link">options</text:a> sont adaptÃ©es pour <text:span text:style-name="T7">indiquer l&#8217;emplacement d&#8217;une ressource</text:span>.
La mÃ©thode <text:span text:style-name="CodeDansTexte">fs.createReadStream</text:span> (<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-fs"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;4</text:a>)
lit les donnÃ©es d&#8217;une ressource de la mÃªme maniÃ¨re que nous consommons
l&#8217;entrÃ©e standard.</text:p>
<text:p text:style-name="Code">$ node streaming/input.js --input blah.txt</text:p><text:p text:style-name="Code">BLAH BLAH</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">streaming/input.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const minimist = require('minimist');</text:p><text:p text:style-name="Code">const getStream = require('get-stream');<text:s text:c="4"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">const {createReadStream} = require('fs');</text:p><text:p text:style-name="Code">const {input=''} = minimist(process.argv.slice(2));</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const uppercase = (text) =&gt; text.toLocaleUpperCase();</text:p><text:p text:style-name="Code">const log = (text) =&gt; process.stdout.write(text);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">if (input) {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>getStream(createReadStream(input))<text:s text:c="8"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>.then(uppercase).then(log);</text:p><text:p text:style-name="Code">}</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Le module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> <text:span text:style-name="T4">get-stream</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/get-stream" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/get-stream</text:a></text:span>) est similaire Ã  <text:span text:style-name="T4">get-stdin</text:span> et fonctionne avec tout flux de lecture.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Il rÃ©sout une promesse dÃ¨s qu&#8217;il a terminÃ© de consommer le flux de lecture.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">LÃ  aussi, je trouve intÃ©ressant de proposer une approche double, en acceptant
un chemin de fichier en option et son contenu via l&#8217;entrÃ©e standard&#160;:</text:p>
<text:p text:style-name="Code">$ node streaming/input-fallback.js --input blah.txt</text:p><text:p text:style-name="Code">BLAH BLAH</text:p><text:p text:style-name="Code">$ cat blah.txt | node streaming/input-fallback.js</text:p><text:p text:style-name="Code">BLAH BLAH</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">streaming/input-fallback.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const minimist = require('minimist');</text:p><text:p text:style-name="Code">const through = require('through2');</text:p><text:p text:style-name="Code">const {createReadStream} = require('fs');</text:p><text:p text:style-name="Code">const {input=''} = minimist(process.argv.slice(2));</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const uppercase = (text) =&gt; text.toLocaleUpperCase();</text:p><text:p text:style-name="Code">const transform = through(function(data) {<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>this.push(uppercase(String(data)));<text:s text:c="7"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">if (!input.length) {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>process.stdin.pipe(transform)<text:s text:c="13"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>.pipe(process.stdout);</text:p><text:p text:style-name="Code">}</text:p><text:p text:style-name="Code">else {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>createReadStream(input).pipe(transform)</text:p><text:p text:style-name="Code"><text:s text:c="4"/>.pipe(process.stdout);</text:p><text:p text:style-name="Code">}</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Le module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> <text:span text:style-name="T4">through2</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/through2" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/through2</text:a></text:span>) s&#8217;intÃ¨gre Ã  un flux en exÃ©cutant une fonction Ã  chaque arrivÃ©e de donnÃ©es.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Nous transformons la chaÃ®ne de caractÃ¨res entrante dans le flux de sortie.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Ce flux de sortie est lui-mÃªme redirigÃ© vers la sortie standard du programme.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce qui est intÃ©ressant avec cette approche est qu&#8217;elle nous apprend
Ã  intervenir nous-mÃªme sur un flux sans avoir Ã  en connaÃ®tre les tenants et aboutissant.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Alternative</text:span> SpÃ©cifier l&#8217;entrÃ©e ou la sortie standard en tant qu&#8217;option</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Certains programmes Linux utilisent le caractÃ¨re&#160;<text:span text:style-name="CodeDansTexte">-</text:span> pour symboliser l&#8217;entrÃ©e
ou la sortie standard, selon l&#8217;intention de l&#8217;option.</text:p>
<text:p text:style-name="RemarqueCode">$ cat blah.txt | node streaming/input-fallback.js --input ##-##</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Cette notation est utile quand vous voulez rendre l&#8217;entrÃ©e standard
optionnelle et explicite.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le prÃ©cÃ©dent exemple nous permet aussi de nous libÃ©rer des modules
<text:span text:style-name="T4">get-stdin</text:span> et <text:span text:style-name="T4">get-stream</text:span>.
Ces derniers obligent quand mÃªme Ã  <text:span text:style-name="T4">charger tout le contenu</text:span> du flux entrant
en mÃ©moire.
En travaillant directement sur les flux avec le module <text:span text:style-name="T4">through2</text:span>,
les transformations sont faites en temps rÃ©el, au fur et Ã  mesure oÃ¹ les donnÃ©es
sont lues, bloc par&#160;bloc.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous sommes dÃ©sormais en mesure de travailler avec des fichiers au mÃªme
titre qu&#8217;avec l&#8217;entrÃ©e et la sortie standards.</text:p>
<text:p text:style-name="Code">$ cat blah.txt | node streaming/pipe-in.js</text:p><text:p text:style-name="Code">BLAH BLAH</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">streaming/pipe-in.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const minimist = require('minimist');</text:p><text:p text:style-name="Code">const through = require('through2');</text:p><text:p text:style-name="Code">const {createReadStream:read} = require('fs');</text:p><text:p text:style-name="Code">const {i:input} = minimist(process.argv.slice(2));</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const source = input ? read(input) : process.stdin;<text:s text:c="3"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">const uppercase = (text) =&gt; text.toLocaleUpperCase();</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const transform = through(function(data) {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>this.push(uppercase(String(data)));</text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">source.pipe(transform).pipe(process.stdout);<text:s text:c="10"/><text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> La source de donnÃ©es provient soit du flux de lecture de fichier, soit de l&#8217;entrÃ©e standard.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Le travail sur le contenu est ainsi factorisÃ©, avec un fonctionnement identique peu importe la source de donnÃ©es.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;utilisation d&#8217;un mÃªme concept pour lire et pour Ã©crire des donnÃ©es
simplifie notre code tout en offrant des performances optimales.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il ne reste plus grand-chose Ã  faire pour appliquer cet effort Ã  la sortie du
programme, pour Ã©crire en continu dans un fichier ou bien vers la sortie standard.</text:p>
<text:p text:style-name="Code">$ node streaming/pipe-out.js -i blah.txt</text:p><text:p text:style-name="Code">BLAH BLAH</text:p><text:p text:style-name="Code">$ node streaming/pipe-out.js -i blah.txt -o debug.txt</text:p><text:p text:style-name="Code">$ cat blah.txt | node streaming/pipe-out.js -o debug.txt</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">streaming/pipe-out.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const minimist = require('minimist');</text:p><text:p text:style-name="Code">const through = require('through2');</text:p><text:p text:style-name="Code">const {createReadStream:read} = require('fs');</text:p><text:p text:style-name="Code">const {createWriteStream:write} = require('fs');</text:p><text:p text:style-name="Code">const {i:input,o:output} = minimist(process.argv.slice(2));</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const source = input ? read(input) : process.stdin;</text:p><text:p text:style-name="Code">const dest = output ? write(output) : process.stdout; <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">const uppercase = (text) =&gt; text.toLocaleUpperCase();</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const transform = through(function(data) {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>this.push(uppercase(String(data)));</text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">source.pipe(transform).pipe(dest);<text:s text:c="20"/><text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> La destination des donnÃ©es est choisie par un mÃ©canisme similaire Ã  celui pour la source de donnÃ©es.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Le processus de traitement est dÃ©sormais indiffÃ©rent Ã  la source et Ã  la destination des donnÃ©es.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">En quelques exemples, nous sommes passÃ©Â·eÂ·s d&#8217;une utilisation potentiellement
Ã©nergivore Ã  un traitement en continu, plus doux pour les ressources systÃ¨me
et intÃ©grable Ã  tous les outils en ligne de commande qui lisent depuis
l&#8217;entrÃ©e standard ou Ã©crivent vers la sortie standard.</text:p>
<text:bookmark text:name="ref-autocomplete" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Activer l&#8217;autocomplÃ©tion des commandes</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Faire en sorte que les options possibles s&#8217;affichent Ã  l&#8217;Ã©cran sur une simple
pression de la touche <text:span text:style-name="Menu">[Tab]</text:span> est la cerise sur le gÃ¢teau&#160;!
Cette technique facilite la dÃ©couverte d&#8217;une application par tÃ¢tonnement.
Elle accÃ©lÃ¨re et rÃ©duit le risque d&#8217;erreurs durant la saisie des commandes.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">CompatibilitÃ©</text:span> Incertitudes de fonctionnement sous Windows</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Cette section n&#8217;a pas Ã©tÃ© testÃ©e avec les systÃ¨mes d&#8217;exploitation Windows.
Les commandes rÃ©fÃ©rencÃ©es ci-aprÃ¨s ne fonctionnent peut-Ãªtre pas
sous ses systÃ¨mes.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">PrÃ©requis pour installer les exÃ©cutables de ce chapitre</text:p><text:p text:style-name="Code">$ npm install --global $(nodebook dir chapter-08 --root)</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le mÃ©canisme d&#8217;autocomplÃ©tion est fourni par l&#8217;environnement d&#8217;exÃ©cution
de notre terminal, le <text:span text:style-name="T4">shell</text:span>.
Sous Linux et macOS, il s&#8217;agit de <text:span text:style-name="T4">bash</text:span>, de <text:span text:style-name="T4">zsh</text:span> ou plus rarement, de <text:span text:style-name="T4">fish</text:span>.
Il <text:span text:style-name="">suffit</text:span> donc d&#8217;interconnecter notre programme exÃ©cutable pour qu&#8217;il fournisse
les rÃ©sultats de complÃ©tion au mÃ©canisme de notre <text:span text:style-name="T4">shell</text:span>.</text:p>
<text:p text:style-name="Code">$ eval $(nodebook.ch08.autocomplete --completion) <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">$ nodebook.ch08.autocomplete <text:span text:style-name="Menu">[Tab]</text:span></text:p><text:p text:style-name="Code">--help coucou</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> L&#8217;option <text:span text:style-name="CodeDansTexte">--completion</text:span> est une option spÃ©ciale comprise par le module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> utilisÃ© dans cet exemple.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le mÃ©canisme de complÃ©tion est fourni par le module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> <text:span text:style-name="T4">omelette</text:span>
(<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/omelette" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/omelette</text:a></text:span>).
Il est totalement indÃ©pendant de notre outillage d'<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-args"  text:visited-style-name="Visited_20_Internet_20_Link">arguments et d&#8217;options</text:a>.
Je le trouve lÃ©ger et rapide Ã  prendre en main.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">autocomplete/intro.js</text:p><text:p text:style-name="Code">#!/usr/bin/env node</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const omelette = require('omelette');</text:p><text:p text:style-name="Code">const args = process.argv.slice(2);</text:p><text:p text:style-name="Code">const options = ['--help','coucou'];<text:s text:c="20"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">omelette`nodebook.ch08.autocomplete ${options}`.init(); <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(args);<text:s text:c="38"/><text:span text:style-name="PuceCode">3</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> DÃ©claration du nom de programme et des options et arguments Ã  suggÃ©rer.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Ces deux options et arguments sont utilisÃ©s pour la complÃ©tion du programme.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Cette partie est atteinte seulement quand le programme est exÃ©cutÃ©.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;autocomplÃ©tion peut aller jusqu&#8217;Ã  suggÃ©rer les valeurs associÃ©es aux options
et arguments de notre programme.</text:p>
<text:p text:style-name="Code">$ eval $(nodebook.ch08.omelette --completion)</text:p><text:p text:style-name="Code">$ nodebook.ch08.omelette <text:span text:style-name="Menu">[Tab]</text:span></text:p><text:p text:style-name="Code">--timezone now</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">$ nodebook.ch08.omelette --timezone<text:span text:style-name="Menu">[Tab]</text:span><text:span text:style-name="Menu">[Tab]</text:span></text:p><text:p text:style-name="Code">Africa/Abidjan<text:s text:c="18"/>Asia/Almaty</text:p><text:p text:style-name="Code">Africa/Accra<text:s text:c="20"/>Asia/Amman</text:p><text:p text:style-name="Code">Africa/Addis_Ababa<text:s text:c="14"/>Asia/Anadyr</text:p><text:p text:style-name="Code">â€¦</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Pour cela, le module <text:span text:style-name="T4">omelette</text:span> accepte un arbre de dÃ©clarations afin de
comprendre quoi suggÃ©rer en fonction de ce qui a Ã©tÃ© prÃ©cÃ©demment saisi&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">autocomplete/omelette.js</text:p><text:p text:style-name="Code">#!/usr/bin/env node</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const omelette = require('omelette');</text:p><text:p text:style-name="Code">const args = require('minimist')(process.argv.slice(2));</text:p><text:p text:style-name="Code">const timezones = require('tz-ids');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">omelette('nodebook.ch08.omelette')</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.tree({<text:s text:c="21"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>'--timezone': timezones,<text:s text:c="2"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>'now': []</text:p><text:p text:style-name="Code"><text:s text:c="2"/>})</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.init();</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(args.timezone);</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> L&#8217;arbre est un objet ECMAScript.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> L&#8217;option <text:span text:style-name="CodeDansTexte">--timezone</text:span> suggÃ¨re la liste complÃ¨te des fuseaux horaires.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">C&#8217;est trÃ¨s pratique quand on ne sait pas par oÃ¹ commencer et quand on ne
connaÃ®t pas la liste exhaustive des propositions.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous avons parlÃ© du module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> <text:span text:style-name="T4">yargs</text:span> dans la section sur
l'<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-application"  text:visited-style-name="Visited_20_Internet_20_Link">utilisation d&#8217;un framework</text:a>.
Il embarque un module d&#8217;autocomplÃ©tion.
Si vous utilisez dÃ©jÃ  ce module, l&#8217;autocomplÃ©tion revient Ã  ajouter une ligne
de code Ã  notre programme.
Elle est un peu plus basique et demande plus de travail pour
arriver Ã  la qualitÃ© des rÃ©sultats du module <text:span text:style-name="T4">omelette</text:span>.</text:p>
<text:p text:style-name="Code">$ eval $(nodebook.ch08.yargs completion)</text:p><text:p text:style-name="Code">$ nodebook.ch08.yargs -<text:span text:style-name="Menu">[Tab]</text:span></text:p><text:p text:style-name="Code">--help<text:s text:c="6"/>--timezone<text:s text:c="2"/>--version</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">autocomplete/yargs.js</text:p><text:p text:style-name="Code">#!/usr/bin/env node</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">require('yargs')</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.option('timezone', {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>type: 'string',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>})</text:p><text:p text:style-name="Code"><text:s text:c="2"/>.completion()<text:s text:c="11"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>.argv;</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Cette mÃ©thode ajoute la comprÃ©hension de l&#8217;argument <text:span text:style-name="CodeDansTexte">completion</text:span> pour s&#8217;intÃ©grer avec le <text:span text:style-name="T4">shell</text:span> de notre systÃ¨me d&#8217;exploitation.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Pratique</text:span> Rendre l&#8217;autocomplÃ©tion permanente</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Les commandes <text:span text:style-name="CodeDansTexte">eval $(&#8230;&#8203;)</text:span> des prÃ©cÃ©dents exemples sont Ã  consigner
dans le fichier de configuration de votre shell,
c&#8217;est-Ã -dire dans le fichier <text:span text:style-name="CodeDansTexte">~/.bashrc</text:span> pour <text:span text:style-name="T4">bash</text:span>, <text:span text:style-name="CodeDansTexte">~/.zshrc</text:span> pour <text:span text:style-name="T4">zsh</text:span>
et <text:span text:style-name="CodeDansTexte">~/.config/fish/config.fish</text:span> pour&#160;<text:span text:style-name="T4">fish</text:span>.</text:p>
<text:bookmark text:name="ref-packaging" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Rendre le programme indÃ©pendant de&#160;Node</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nos programmes exÃ©cutables souffrent d&#8217;un dÃ©faut&#160;: ils imposent
l&#8217;installation prÃ©alable de Node pour fonctionner.
Ce n&#8217;est pas grave pour une machine de devÃ©loppement ou sur une machine
de production car nous sommes Ã  mÃªme de contrÃ´ler l&#8217;environnement d&#8217;exÃ©cution.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La premiÃ¨re solution consiste Ã  empaqueter notre application avec le module
npm <text:span text:style-name="T4">pkg</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/pkg" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/pkg</text:a></text:span>).
Cet exÃ©cutable embarque notre code, les dÃ©pendances npm du projet
et la version de Node de notre choix sous la forme d&#8217;un unique fichier exÃ©cutable.</text:p>
<text:p text:style-name="Code">$ npm install --global pkg</text:p><text:p text:style-name="Code">$ pkg --targets latest-linux,latest-macos,latest-win ..</text:p><text:p text:style-name="Code">$ ./nodebook</text:p><text:p text:style-name="Code">Il est 22h49.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans ce cas, nous avons empaquetÃ© une mÃªme application Ã  la fois pour les
systÃ¨mes d&#8217;exploitation Windows, Linux et macOS.
Nous pourrions faire de mÃªme pour des ordinateurs lÃ©gers de type Raspberry&#160;Pi.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Une solution alternative consiste Ã  utiliser le logiciel <text:span text:style-name="T4">Docker</text:span>
(<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://docker.com/community-edition" text:visited-style-name="Visited_20_Internet_20_Link">https://docker.com/community-edition</text:a></text:span>).
Ce systÃ¨me crÃ©e une base d&#8217;environnement rÃ©utilisable (le conteneur) Ã  partir
d&#8217;une recette d&#8217;installation (l&#8217;image).
Une mÃªme image applicative se rÃ©plique Ã  l&#8217;infini, sans avoir
connaissance de notre systÃ¨me d&#8217;exploitation.</text:p>
<text:p text:style-name="Code">$ docker build -t nodebook/chapter-08 ..</text:p><text:p text:style-name="Code">$ docker run -ti --rm nodebook/chapter-08</text:p><text:p text:style-name="Code">Bienvenue dans le chapitre 8 ðŸ˜Š</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Une image se construit depuis un fichier <text:span text:style-name="CodeDansTexte">Dockerfile</text:span> avec la commande <text:span text:style-name="CodeDansTexte">docker build</text:span>.
Elle s&#8217;exÃ©cute sous forme d&#8217;un conteneur jetable avec la commande <text:span text:style-name="CodeDansTexte">docker run</text:span>.
La recette d&#8217;installation est une suite d&#8217;instructions jouÃ©es les unes Ã  la suite
des autres&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">Dockerfile</text:p><text:p text:style-name="Code">FROM node:alpine</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">WORKDIR /nodebook</text:p><text:p text:style-name="Code">ADD ./package.json ./package-lock.json ./</text:p><text:p text:style-name="Code">RUN npm ci</text:p><text:p text:style-name="Code">ADD ./examples ./examples</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">CMD ["node", "examples/hello.js"]</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Je recommande de doubler le fichier <text:span text:style-name="CodeDansTexte">Dockerfile</text:span> d&#8217;un fichier <text:span text:style-name="CodeDansTexte">.dockerignore</text:span>.
Il suit les mÃªmes rÃ¨gles de fonctionnement qu&#8217;un fichier <text:span text:style-name="CodeDansTexte">.gitignore</text:span>.
Il exclut une liste dÃ©finie de fichiers du contexte d&#8217;exÃ©cution et d&#8217;une possible
copie vers l&#8217;image Docker.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">.dockerignore</text:p><text:p text:style-name="Code">node_modules</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Une fois construite, une image se distribue sous forme de fichier transfÃ©rable,
sur le registre public <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://hub.docker.com" text:visited-style-name="Visited_20_Internet_20_Link">https://hub.docker.com</text:a></text:span> ou sur tout autre
registre privÃ©&#160;â€“ dont ceux fournis par certains
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy.docker"  text:visited-style-name="Visited_20_Internet_20_Link">hÃ©bergeurs cloud</text:a>
(<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-06"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;6</text:a>).</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Alternative</text:span> Windows sous Docker</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Microsoft met Ã  disposition des images de Windows Server pour Docker Ã  l&#8217;adresse suivante&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://hub.docker.com/r/microsoft/windowsservercore/" text:visited-style-name="Visited_20_Internet_20_Link">https://hub.docker.com/r/microsoft/windowsservercore/</text:a></text:span>.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Nous pouvons tester une application Node dans un environnement Windows
sans quitter notre systÃ¨me d&#8217;exploitation Linux ou macOS.</text:p>
<text:bookmark text:name="ref-conclusion_8" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Conclusion</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;Ã©criture d&#8217;un exÃ©cutable en ligne de commande est un
<text:span text:style-name="T7">exercice proche de celui d&#8217;une application web</text:span> Ã©crite avec&#160;Node.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous avons vu que l&#8217;enjeu majeur tient dans la <text:span text:style-name="T7">modularisation du code applicatif</text:span>
et dans la <text:span text:style-name="T7">crÃ©ation d&#8217;une interface cohÃ©rente</text:span>, informative et documentÃ©e.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-args"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="T7">Les options et les arguments</text:span></text:a> sont essentiels Ã  maÃ®triser et
Ã  <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-doc"  text:visited-style-name="Visited_20_Internet_20_Link">documenter</text:a> car ils servent de pierre angulaire pour crÃ©er un pont
avec les utilisateurs.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ils deviennent encore plus puissants une fois combinÃ©s avec
la <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-files"  text:visited-style-name="Visited_20_Internet_20_Link">gestion des chemins d&#8217;accÃ¨s</text:a> ainsi qu&#8217;avec
les <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-streaming"  text:visited-style-name="Visited_20_Internet_20_Link">flux d&#8217;entrÃ©e et de sortie</text:a>.</text:p>
<text:bookmark text:name="ref-chapter-09" /><text:p text:style-name="ChapitreNumero">9</text:p><text:h text:style-name="ChapitreTitre" text:outline-level="1">CrÃ©er une application front-end</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Node et l&#8217;Ã©cosystÃ¨me&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> sont devenus des acteurs majeurs de l&#8217;outillage
web <text:span text:style-name="T4">front-end</text:span> alors profitons-en pour partager du code entre client et serveur.</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">Polyfills et compatibilitÃ© ECMAScript</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Importer des modules&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> pour le&#160;Web</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">CrÃ©er du code modulaire, avec ou sans framework</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Ã‰changes de donnÃ©es en temps&#160;rÃ©el</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Outillage utile au quotidien</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Tester son code et la compatibilitÃ© avec les navigateurs web</text:p>
</text:list-item></text:list>
<text:p text:style-name="ChapitreIntroduction"><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Avant l&#8217;apparition de Node, rare Ã©tait l&#8217;outillage n&#8217;imposant pas une ou
plusieurs plates-formes de dÃ©veloppement&#160;: <text:span text:style-name="T4">YUICompressor</text:span> et <text:span text:style-name="T4">Google Closure Compiler</text:span>
demandaient Java, <text:span text:style-name="T4">sprockets</text:span> demandait Ruby et <text:span text:style-name="T4">pngquant</text:span> reposait sur des
dÃ©pendances systÃ¨me comme <text:span text:style-name="T4">libpng</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;existence de Node et du registre <text:span text:style-name="CodeDansTexte">npm</text:span> a favorisÃ© le dÃ©veloppement d&#8217;un
Ã©cosystÃ¨me orientÃ© <text:span text:style-name="T4">front-end</text:span> plus simple Ã  apprÃ©hender.
Cela s&#8217;Ã©tend de la dÃ©couverte au tÃ©lÃ©chargement des bibliothÃ¨ques tierces ainsi
qu&#8217;Ã  la compilation, l&#8217;optimisation et l&#8217;exÃ©cution des tests des applications
web cÃ´tÃ© client.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T7">Cet Ã©cosystÃ¨me rend l&#8217;Ã©criture de code moderne normale</text:span>&#160;; un code anticipant
les futurs standards d&#8217;ECMAScript et <text:span text:style-name="T4">HTML5</text:span>, sur les navigateurs actuels et anciens.</text:p></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Remarque</text:span> Versions de Node et npm</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Le contenu de ce chapitre utilise les versions <text:span text:style-name="T7">Node&#160;v10</text:span>
et <text:span text:style-name="T7">npm&#160;v6</text:span>.
Ce sont les versions stables recommandÃ©es en&#160;2019.</text:p>
<text:bookmark text:name="ref-quel_rapport_entre_node_et_les_navigateursweb" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Quel rapport entre Node et les navigateurs&#160;web ?</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce chapitre peut sembler confus au premier abord.
Si Node s&#8217;exÃ©cute au niveau du systÃ¨me d&#8217;exploitation&#160;â€“ <text:span text:style-name="">cÃ´tÃ© serveur</text:span>&#160;â€“,
en quoi est-il liÃ© au dÃ©veloppement <text:span text:style-name="T4">front-end</text:span>&#160;â€“ <text:span text:style-name="">cÃ´tÃ© client</text:span>&#160;?
Est-ce parce que du code Ã©crit pour Node peut aussi fonctionner dans un navigateur&#160;web&#160;?
Quid de l&#8217;utilisation de <text:span text:style-name="CodeDansTexte">require('fs')</text:span> pour accÃ©der au systÃ¨me de fichiers&#160;?</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La rÃ©ponse courte est&#160;: nous n&#8217;exÃ©cutons pas Node dans un navigateur.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Et voici la rÃ©ponse longue&#160;: <text:span text:style-name="T7">Node est utilisÃ© pour assembler du code</text:span>, le <text:span text:style-name="T4">transformer</text:span>
et le rendre fonctionnel dans une paire de balises <text:span text:style-name="CodeDansTexte">&lt;script&gt;&lt;/script&gt;</text:span>.
Ce code peut aussi aussi bien Ãªtre fourni par des bibliothÃ¨ques tierces
installÃ©es via&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> (<text:span text:style-name="T4">jQuery</text:span>, <text:span text:style-name="T4">React</text:span> ou <text:span text:style-name="T4">d3</text:span> par exemple) que par de
l&#8217;outillage (optimiseurs, suite de tests, orchestration de tÃ¢ches) ou encore
par le code rÃ©utilisable de notre propre application&#160;web.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il faut Ã©galement bien comprendre qu&#8217;il y a plusieurs <text:span text:style-name="">problÃ¨mes</text:span> cachÃ©s sous
une mÃªme question&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">Les navigateurs et Node utilisent diffÃ©rentes machines virtuelles JavaScript,
implÃ©mentant ECMAScript de faÃ§on plus ou moins complÃ¨te.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Ils n&#8217;ont pas accÃ¨s aux mÃªmes APIs&#160;â€“ Node accÃ¨de Ã  <text:span text:style-name="CodeDansTexte">fs</text:span> et <text:span text:style-name="CodeDansTexte">http</text:span> tandis que
les navigateurs ont <text:span text:style-name="CodeDansTexte">File</text:span> et <text:span text:style-name="CodeDansTexte">fetch</text:span>/<text:span text:style-name="CodeDansTexte">XmlHttpRequest</text:span>.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Ils ne gÃ¨rent pas le chargement de modules de la mÃªme maniÃ¨re
(voir la section <text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-managing-dependencies"  text:visited-style-name="Visited_20_Internet_20_Link">DÃ©pendences de dÃ©veloppement</text:a></text:span>).</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">L&#8217;implÃ©mentation mÃªme d&#8217;ECMAScript diffÃ¨re selon les versions de Node
employÃ©es&#160;â€“ un navigateur moderne et Node&#160;v10 comprennent
l&#8217;objet natif <text:span text:style-name="CodeDansTexte">Promise</text:span>, mais pas Node&#160;0.12.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce processus n&#8217;est <text:span text:style-name="T4">pas magique</text:span> et nous verrons graduellement au cours des
prochaines sections comment tout ceci fonctionne.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Pratique</text:span> Jouer avec les exemples dans un terminal</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Les exemples titrÃ©s d&#8217;un nom de fichier peuvent Ãªtre installÃ©s sur votre ordinateur.
ExÃ©cutez-les dans un terminal et amusez-vous Ã  les modifier en parallÃ¨le de
votre lecture pour voir ce qui change.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Installation des exemples via le module npm <text:span text:style-name="CodeDansTexte">nodebook</text:span></text:p><text:p text:style-name="RemarqueCode">$ npm install --global nodebook</text:p><text:p text:style-name="RemarqueCode">$ nodebook install chapter-09</text:p><text:p text:style-name="RemarqueCode">$ cd $(nodebook dir chapter-09)</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">La commande suivante devrait afficher un rÃ©sultat qui confirme que vous Ãªtes
au bon endroit&#160;:</text:p>
<text:p text:style-name="RemarqueCode">$ node hello.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Suivez Ã  nouveau les instructions d&#8217;installation pour rÃ©tablir les exemples
dans leur Ã©tat initial.</text:p>
<text:bookmark text:name="ref-Ã©crire_dÃ¨s_Ã _prÃ©sent_le_code_dufutur" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Ã‰crire dÃ¨s Ã  prÃ©sent le code du&#160;futur</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Transformer du code ECMAScript a pendant longtemps Ã©tÃ© chose pÃ©nible.
Je pense par exemple Ã  de la minification de code (pour rÃ©duire les temps de
transfert sur les antiques lignes ADSL&#160;128&#160;K) ou Ã  de la conversion automatique
de code ECMAScript&#160;3 en ECMAScript&#160;5.
Cela nÃ©cessitait systÃ©matiquement l&#8217;utilisation d&#8217;un autre environnement
qu&#8217;ECMAScript lui-mÃªme: Rhino nÃ©cessitait Java, Spidermonkey nÃ©cessitait&#160;C&#43;&#43;
et Trident nÃ©cessitait un environnement Windows en plus de&#160;C&#43;&#43;.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">esprima</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/esprima" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/esprima</text:a></text:span>) chamboule les rÃ¨gles du jeu en
dÃ©cembre 2011&#160;: ce parseur ECMAScript&#160;â€“ lui-mÃªme Ã©crit en ECMAScript&#160;â€“
exporte une comprÃ©hension de code sous forme d&#8217;arbre syntaxique abstrait
(<text:span text:style-name="T4">Abstract Syntax Tree</text:span>, <text:span text:style-name="T4">AST</text:span>).
Cet arbre est lui-mÃªme analysable par de nouveaux outils&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">les <text:span text:style-name="T4">source maps</text:span> pour associer le code transformÃ© au code d&#8217;origine,
notamment dans les outils de dÃ©veloppement des navigateurs&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">des minifieurs plus efficaces et ayant connaissance des portions de code exÃ©cutÃ©es&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">des analyseurs de code pour informer le dÃ©veloppeur d&#8217;erreurs de syntaxe,
de non-respect de styles de dÃ©veloppement, etc.&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">des convertisseurs de code pour passer d&#8217;ECMAScript vers CoffeeScript,
de modules CommonJS vers des modules ECMAScript, etc.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Lien</text:span> Annonce d&#8217;esprima</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Aryia&#160;Hidayat prÃ©sente esprima dans ce billet de blog&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://ariya.io/2011/12/introducing-esprima" text:visited-style-name="Visited_20_Internet_20_Link">https://ariya.io/2011/12/introducing-esprima</text:a></text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Il y prÃ©sente notamment des comparatifs de performances d&#8217;exÃ©cution sur
diffÃ©rentes machines virtuelles ECMAScript et face Ã  d&#8217;autres parseurs.</text:p>
<text:bookmark text:name="ref-la_fin_de_lapproche_par_le_dÃ©nominateur_commun" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">La fin de l&#8217;approche par le dÃ©nominateur commun</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Qui n&#8217;a pas dÃ©jÃ  entamÃ© un projet en posant la question Ã  un client, en regardant
les statistiques de trafic ou en se posant une question Ã  soi-mÃªme&#160;: quelles
sont les versions de navigateurs avec lesquelles notre site ou application web
doit Ãªtre compatible&#160;?</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La version de navigateur la plus ancienne ou la moins conforme aux standards
Ã©tait celle qui donnait le&#160;<text:span text:style-name="T4">la</text:span>.
Cela voulait dire se priver de techniques modernes, standardisÃ©es ou en cours
de standardisation.
Cela signifiait des <text:span text:style-name="T4">hacks</text:span> dans ses CSS, dans son code ECMAScript et dans
ses ressources graphiques.</text:p>
<text:bookmark text:name="ref-transpilation" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Ã‰crire au plus proche des standards</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Fort heureusement, l&#8217;arrivÃ©e d'<text:span text:style-name="T4">esprima</text:span> change la donne et permet d&#8217;Ã©crire un
code proche des standards qui rÃ©siste au temps.
Son existence facilite l'<text:span text:style-name="T7">Ã©mergence d&#8217;outils automatisant les transformations de code</text:span>
pour satisfaire nos besoins spÃ©cifiques.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il y a plusieurs Ã©lÃ©ments Ã  prendre en compte concernant la standardisation
de nouvelles versions d&#8217;ECMAScript et les Ã©volutions de sa syntaxe&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">La cadence de standardisation a Ã©tÃ© revue pour devenir prÃ©dictible&#160;â€“ une
volontÃ© d&#8217;une fois par&#160;an.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Les fonctionnalitÃ©s et Ã©lÃ©ments de syntaxe sont implÃ©mentÃ©s un par un, Ã  des
vitesses diffÃ©rentes par les diffÃ©rents navigateurs.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Deux tiers de navigateurs fonctionnent sur des rythmes de mise Ã  jour en cycle court
(de six Ã  neuf semaines)&#160;â€“ le tiers restant est cadencÃ© Ã  une seule mise Ã 
jour par&#160;an.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il vaut mieux <text:span text:style-name="T7">parier sur les standards comme stratÃ©gie Ã  long terme</text:span> si on tient
compte du temps de dÃ©veloppement et du temps de maintenance d&#8217;une base de&#160;code.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Question</text:span> Standards, quels standards ?</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Plusieurs organismes prennent part Ã  la standardisation de langages et
d&#8217;API lorsque l&#8217;on touche aux navigateurs&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce">HTML&#160;: <text:span text:style-name="T4">WHATWG</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://html.spec.whatwg.org" text:visited-style-name="Visited_20_Internet_20_Link">https://html.spec.whatwg.org</text:a></text:span>)&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="RemarquePuce">API&#160;DOM&#160;: <text:span text:style-name="T4">WHATWG</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://dom.spec.whatwg.org" text:visited-style-name="Visited_20_Internet_20_Link">https://dom.spec.whatwg.org</text:a></text:span>)&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="RemarquePuce">CSS&#160;: <text:span text:style-name="T4">W3C</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://www.w3.org/standards/techs/css" text:visited-style-name="Visited_20_Internet_20_Link">https://www.w3.org/standards/techs/css</text:a></text:span>)&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="RemarquePuce">ECMAScript&#160;: <text:span text:style-name="T4">TC39</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://github.com/tc39" text:visited-style-name="Visited_20_Internet_20_Link">https://github.com/tc39</text:a></text:span>)&#160;;</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Lorsque nous Ã©crivons du code, nous pouvons rencontrer trois cas de figure&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">Ã©lÃ©ment de syntaxe non&#160;implÃ©mentÃ©&#160;: transformer le code pour l&#8217;adapter aux
navigateurs cibles&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Ã©lÃ©ment de syntaxe partiellement implÃ©mentÃ©&#160;: utiliser l&#8217;implÃ©mentation native
des navigateurs et, Ã  dÃ©faut, transformer le code pour l&#8217;adapter aux autres navigateurs&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Ã©lÃ©ment de syntaxe totalement implÃ©mentÃ©&#160;: utiliser l&#8217;implÃ©mentation native des navigateurs.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il arrive que certains Ã©lÃ©ments de syntaxe soient abandonnÃ©s pendant le
processus de standardisation&#160;â€“ ou que leur implÃ©mentation change beaucoup
(on pensera Ã  <text:span text:style-name="CodeDansTexte">Object.observe()</text:span>).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La question qui nous taraude est&#160;: comment transformer le code pour satisfaire
Ã  la fois les navigateurs compatibles et les autres&#160;?
<text:span text:style-name="T4">Babel</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://babeljs.io" text:visited-style-name="Visited_20_Internet_20_Link">https://babeljs.io</text:a></text:span>) est un outil de choix  pour parvenir Ã  ses
fins d&#8217;Ã©crire du code rÃ©sistant au(x standards du) temps.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce module convertit de maniÃ¨re sÃ©lective toute syntaxe ECMAScript&#160;2015/2016/etc.
vers de l&#8217;ECMAScript&#160;5, comprÃ©hensible par les navigateurs modernes.
L&#8217;intÃ©rÃªt de sa sÃ©lectivitÃ© fait que l&#8217;on peut progressivement arrÃªter de
convertir les Ã©lÃ©ments de syntaxe couverts par 100&#160;% des navigateurs.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Histoire</text:span> Traceur</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque"><text:span text:style-name="T4">Traceur</text:span> est un des premiers transpilateurs ECMAScript&#160;2015 vers
ECMAScript&#160;5 Ã  avoir Ã©mergÃ© dans l&#8217;Ã©cosystÃ¨me&#160;Node.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">GrÃ¢ce Ã  lui, il a Ã©tÃ© possible d&#8217;Ã©crire des modules en ECMAScript&#160;2015
bien avant que la spÃ©cification ne soit entiÃ¨rement terminÃ©e et donc on a pu
anticiper son apprentissage tout en mettant le langage Ã  l&#8217;Ã©preuve avant sa finalisation.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exemple suivant illustre un code utilisant des Ã©lÃ©ments de syntaxe
d&#8217;ECMAScript&#160;2018.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">babel/es2018.js</text:p><text:p text:style-name="Code">const a = {one: 1, two: 2};</text:p><text:p text:style-name="Code">const b = {three: 3, four: 4};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log({...a, ...b});<text:s text:c="6"/><text:span text:style-name="PuceCode">1</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">{ one: 1, two: 2, three: 3, four: 4 }</text:span> si le navigateur supporte l&#8217;opÃ©rateur <text:span text:style-name="T4">spread</text:span> sur les objets (<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-object.assign"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;3</text:a>).<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce code reprÃ©sente l&#8217;idÃ©al de ce que l&#8217;on souhaite Ã©crire.
Le seul obstacle consiste Ã  traduire ce code pour l&#8217;ensemble des navigateurs
compatibles avec ECMAScript&#160;5.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">ExÃ©cutons cette commande&#160;:</text:p>
<text:p text:style-name="Code">$ npm run babel -- examples/babel/es2018.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La sortie a changÃ© et renvoie un code totalement fonctionnel sur des navigateurs
ne prenant pas ECMAScript&#160;2018 en charge&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">babel/es2018-es5.js</text:p><text:p text:style-name="Code">"use strict";</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">function _objectSpread(target) { for (var i = 1; i &lt; arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">var a = {one: 1, two: 2};</text:p><text:p text:style-name="Code">var b = {three: 3, four: 4};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(_objectSpread({}, a, b));</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Chaque fonctionnalitÃ© d&#8217;ECMAScript est transformÃ©e selon une rÃ¨gle personnalisable,
intÃ©grÃ©e Ã  <text:span text:style-name="T4">Babel</text:span> ou disponible sous forme d&#8217;un plug-in.
Les <text:span text:style-name="T4">presets</text:span> sont des modules&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> qui regroupent les rÃ¨gles
de transformation selon un certaine logique.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">preset-env</text:span> <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/babel-preset-env" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/babel-preset-env</text:a></text:span> convertit
notre code dans une version compatible avec la majoritÃ© des navigateurs
supportÃ©s sur le marchÃ©.
Si vos besoins sont diffÃ©rents, sa configuration sait cibler des navigateurs
en fonction soit de leur version, soit de leur part de marchÃ©.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La configuration des presets et d&#8217;autres aspects de Babel se fait
dans un fichier nommÃ© <text:span text:style-name="CodeDansTexte">.babelrc</text:span>.
L&#8217;exemple suivant configure Babel pour prÃ©server les commentaires,
transformer la syntaxe JSX pour <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-react"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="T4">React</text:span></text:a> et transformer pour les
derniÃ¨res versions des navigateurs sur le marchÃ©&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">.babelrc</text:p><text:p text:style-name="Code">{</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"comments": false,</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"presets": [</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"@babel/preset-react",</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"@babel/preset-env"</text:p><text:p text:style-name="Code"><text:s text:c="2"/>],</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"plugins": [</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"@babel/plugin-proposal-object-rest-spread"</text:p><text:p text:style-name="Code"><text:s text:c="2"/>]</text:p><text:p text:style-name="Code">}</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Lien</text:span> Documentation de Babel</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Toutes les options de configuration sont documentÃ©es sur le site officiel
de Babel&#160;: <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://babeljs.io/docs/en/babel-core/#options" text:visited-style-name="Visited_20_Internet_20_Link">https://babeljs.io/docs/en/babel-core/#options</text:a></text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Une autre page explique oÃ¹ placer et quoi mettre dans les fichiers
<text:span text:style-name="CodeDansTexte">.babelrc</text:span>&#160;: <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://babeljs.io/docs/en/config-files/" text:visited-style-name="Visited_20_Internet_20_Link">https://babeljs.io/docs/en/config-files/</text:a></text:span>.</text:p>
<text:bookmark text:name="ref-polyfills" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Combler les manques avec des polyfills</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Des outils comme Babel nous permettent d&#8217;Ã©crire avec une syntaxe moderne qui
<text:span text:style-name="T7">comblent les fonctionnalitÃ©s manquantes</text:span>&#160;â€“ leur implÃ©mentation.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un <text:span text:style-name="T4">polyfill</text:span> harmonise la prÃ©sence d&#8217;une fonctionnalitÃ© au sein d&#8217;une variÃ©tÃ© de
navigateurs et d&#8217;environnements ECMAScript.
Cela se fera au prix de quelques kilo-octets de code Ã  charger en plus
dans nos applications.
L&#8217;appel Ã  un service de <text:span text:style-name="T4">polyfill</text:span> externe entraÃ®ne un lÃ©ger ralentissement du
chargement de notre&#160;page.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Prenons le bloc de code suivant&#160;:</text:p>
<text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">Promise.resolve('ok');</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Comprenons que&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">Cette syntaxe est valide dans toutes les versions d&#8217;ECMAScript
(Babel ne change rien Ã  ce code).</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">L&#8217;objet global <text:span text:style-name="CodeDansTexte">Promise</text:span> existe dans un navigateur moderne.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">L&#8217;objet global <text:span text:style-name="CodeDansTexte">Promise</text:span> n&#8217;existe pas dans <text:span text:style-name="T4">Internet Explorer 11</text:span>, entre autres.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce code fonctionnerait donc sur un navigateur moderne mais pas dans <text:span text:style-name="T4">IE11</text:span>.
L&#8217;inclusion d&#8217;un <text:span text:style-name="T4">polyfill</text:span> de <text:span text:style-name="CodeDansTexte">Promise</text:span> rÃ©soudrait le problÃ¨me.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Bonne pratique</text:span> Quand inclure les polyfills ?</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque"><text:span text:style-name="T7">Un <text:span text:style-name="T4">polyfill</text:span> se charge toujours en premier</text:span>.
On inclut tous les <text:span text:style-name="T4">polyfills</text:span> en une seule fois avant notre propre code.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Nous garantissons ainsi cohÃ©rence et stabilitÃ© de comportement au sein de
notre application, peu importe l&#8217;ordre d&#8217;exÃ©cution de nos scripts.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Parlons maintenant des mÃ©thodes d&#8217;inclusion des <text:span text:style-name="T4">polyfills</text:span> pour mieux
comprendre comment procÃ©der.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le service <text:span text:style-name="T4">polyfill.io</text:span> est de loin la mÃ©thode la plus simple Ã  utiliser.
Il suffit d&#8217;inclure un script dans toutes vos pages web et cet outil
dÃ©termine les <text:span text:style-name="T4">polyfills</text:span> Ã  charger en fonction de la
compatibilitÃ© du navigateur&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">polyfill.io.html</text:p><text:p text:style-name="Code">&lt;!DOCTYPE html&gt;</text:p><text:p text:style-name="Code">&lt;html&gt;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;head&gt;</text:p><text:p text:style-name="Code"><text:s text:c="4"/>&lt;title&gt;Example polyfill.io&lt;/title&gt;</text:p><text:p text:style-name="Code"><text:s text:c="4"/>&lt;script src="https://cdn.polyfill.io/v2/polyfill.min.js"&gt;&lt;/script&gt;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;/head&gt;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;body&gt;</text:p><text:p text:style-name="Code"><text:s text:c="4"/>&lt;script&gt;</text:p><text:p text:style-name="Code"><text:s text:c="6"/>Promise.resolve('ok')</text:p><text:p text:style-name="Code"><text:s text:c="8"/>.then(msg =&gt; console.log(msg));</text:p><text:p text:style-name="Code"><text:s text:c="4"/>&lt;/script&gt;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;/body&gt;</text:p><text:p text:style-name="Code">&lt;/html&gt;</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> polyfill.io</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">polyfill.io possÃ¨de une documentation trÃ¨s complÃ¨te qui aide Ã  configurer
finement le service en fonction de nos besoins&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://qa.polyfill.io/v2/docs/" text:visited-style-name="Visited_20_Internet_20_Link">https://qa.polyfill.io/v2/docs/</text:a></text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous pouvons dÃ©duire deux rÃ¨gles de cet exemple&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">Inclure les <text:span text:style-name="T4">polyfills</text:span> en tout premier.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Les inclure en dehors de notre code.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La deuxiÃ¨me mÃ©thode est d&#8217;embarquer les <text:span text:style-name="T4">polyfills</text:span> dans notre base de code.
L&#8217;avantage est de maÃ®triser notre base de code et de ne pas dÃ©pendre d&#8217;un service externe.
L&#8217;inconvÃ©nient est que nous chargeons du code qui sera inutile dans les
navigateurs et environnements disposant dÃ©jÃ  de ces fonctionnalitÃ©s.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">polyfill-import.html</text:p><text:p text:style-name="Code">&lt;!DOCTYPE html&gt;</text:p><text:p text:style-name="Code">&lt;html&gt;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;head&gt;</text:p><text:p text:style-name="Code"><text:s text:c="4"/>&lt;title&gt;Exemple polyfill custom&lt;/title&gt;</text:p><text:p text:style-name="Code"><text:s text:c="4"/>&lt;script type="module"&gt;</text:p><text:p text:style-name="Code"><text:s text:c="6"/>import 'es6-promise/auto';<text:s text:c="8"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="6"/>import 'core-js/fn/number/is-nan';<text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>&lt;/script&gt;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;/head&gt;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;body&gt;</text:p><text:p text:style-name="Code"><text:s text:c="4"/>&lt;script&gt;</text:p><text:p text:style-name="Code"><text:s text:c="6"/>Promise.resolve(Number.isNaN(NaN))</text:p><text:p text:style-name="Code"><text:s text:c="8"/>.then(msg =&gt; console.log(msg));</text:p><text:p text:style-name="Code"><text:s text:c="4"/>&lt;/script&gt;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;/body&gt;</text:p><text:p text:style-name="Code">&lt;/html&gt;</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Nous verrons <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-modules"  text:visited-style-name="Visited_20_Internet_20_Link">comment importer des modules</text:a> ci-aprÃ¨s.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> On importe un deuxiÃ¨me <text:span text:style-name="T4">polyfill</text:span>, celui de la mÃ©thode <text:span text:style-name="CodeDansTexte">Number.isNaN</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le module <text:span text:style-name="T4">npm</text:span> <text:span text:style-name="CodeDansTexte">core-js</text:span> est une bibliothÃ¨que exhaustive de <text:span text:style-name="T4">polyfills</text:span>
pouvant Ãªtre inclus un Ã  un ou par versions d&#8217;ECMAScript.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> core-js</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">La documentation en ligne de <text:span text:style-name="CodeDansTexte">core-js</text:span> liste l&#8217;ensemble des <text:span text:style-name="T4">polyfills</text:span>
pris en charge, ainsi que des exemples d&#8217;utilisation.</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/core-js" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/core-js</text:a></text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Attention</text:span> Performance et duplication</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Il faut veiller Ã  ne pas alourdir inutilement une application.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Laissons la responsabilitÃ© de <text:span text:style-name="T4">polyfiller</text:span> aux utilisateurs de notre code&#160;;
particuliÃ¨rement si celui-ci est redistribuÃ© en tant que module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> public.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Si plusieurs scripts nÃ©cessitent des <text:span text:style-name="T4">polyfills</text:span>, mieux vaut inclure ces
derniers en une&#160;fois&#160;:</text:p>
<text:p text:style-name="RemarqueCode">&lt;script src="polyfills.js"&gt;&lt;/script&gt;</text:p><text:p text:style-name="RemarqueCode">&lt;script src="script-a.js"&gt;&lt;/script&gt;</text:p><text:p text:style-name="RemarqueCode">&lt;script src="script-b.js"&gt;&lt;/script&gt;</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Enfin, une derniÃ¨re mÃ©thode est d&#8217;importer la fonction de <text:span text:style-name="T4">polyfill</text:span> sans
rÃ©Ã©crire les objets globaux.
Cette pratique a l&#8217;avantage de ne pas entraÃ®ner d&#8217;effets secondaires et de
garantir le mÃªme comportement dans tous les navigateurs.
L&#8217;inconvÃ©nient est qu&#8217;on n&#8217;utilise pas la fonctionnalitÃ© native des navigateurs
lorsqu&#8217;elle est prÃ©sente.
Nous nous retrouvons tributaires de la qualitÃ© d&#8217;implÃ©mentation du <text:span text:style-name="T4">polyfill</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">polyfill-require.js</text:p><text:p text:style-name="Code">import {Promise as PromisePolyfill} from 'es6-promise';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">PromisePolyfill.resolve('ok').then(msg =&gt; console.log(msg));</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log('Promise' in window);<text:s text:c="16"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(PromisePolyfill === window.Promise); <text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">true</text:span> si le navigateur implÃ©mente l&#8217;API <text:span text:style-name="T4">Promise</text:span>&#160;â€“ sinon affiche <text:span text:style-name="CodeDansTexte">false</text:span> et l&#8217;utilisation d&#8217;un <text:span text:style-name="T4">polyfill</text:span> prend tout son&#160;sens.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">false</text:span>, car le <text:span text:style-name="T4">polyfill</text:span> de <text:span text:style-name="T4">Promise</text:span> est une fonction strictement diffÃ©rente de <text:span text:style-name="CodeDansTexte">window.Promise</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Guide</text:span> Bonnes pratiques constatÃ©es</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">De bons usages des <text:span text:style-name="T4">polyfills</text:span> ainsi que les risques liÃ©s Ã  leur utilisation
sont compilÃ©s dans un guide Ã©ditÃ© par le&#160;W3C&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://w3ctag.github.io/polyfills/" text:visited-style-name="Visited_20_Internet_20_Link">https://w3ctag.github.io/polyfills/</text:a></text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-modules" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Importer des modules</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Importer des modules est une pratique courante avec Node.
Elle l&#8217;est en revanche beaucoup moins dans l&#8217;univers du Web puisqu&#8217;il n&#8217;existait
rien de natif avant les <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-modules-es2015"  text:visited-style-name="Visited_20_Internet_20_Link">modules ECMAScript</text:a>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Auparavant, on aura vu dÃ©barquer les modules AMD (<text:span text:style-name="T4">Asynchronous Module Definition</text:span>)
pour gÃ©rer les dÃ©pendances entre scripts.
Les bibliothÃ¨ques Dojo, RequireJS et YUI ont popularisÃ© ce motif de conception.
Un dÃ©sir d&#8217;universalitÃ© a ensuite Ã©mergÃ© avec la popularitÃ© croissante de Node,
conduisant aux modules&#160;UMD, conciliant AMD et CommonJS.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les modules ECMAScript ont Ã©mergÃ© de ce bouillonnement.</text:p>
<text:bookmark text:name="ref-modules-script" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">La balise &lt;script&gt;</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Rappelons-le, la mÃ©thode incontournable pour charger du code dans un navigateur
est l&#8217;utilisation de la base <text:span text:style-name="CodeDansTexte">&lt;script&gt;</text:span>.
Le chargement, l&#8217;Ã©valuation et l&#8217;exÃ©cution du script bloquent le temps
nÃ©cessaire au rendu d&#8217;un document&#160;HTML.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">import/script.html</text:p><text:p text:style-name="Code">&lt;script src="global-dom-log.js"&gt;&lt;/script&gt;</text:p><text:p text:style-name="Code">&lt;script src="script.js"&gt;&lt;/script&gt;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">&lt;div id="logs"&gt;&lt;/div&gt;</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les diffÃ©rents scripts partagent le mÃªme espace mÃ©moire, permettant ainsi Ã 
<text:span text:style-name="CodeDansTexte">script.js</text:span> d&#8217;avoir accÃ¨s Ã  la fonction <text:span text:style-name="CodeDansTexte">log</text:span> dÃ©finie dans <text:span text:style-name="CodeDansTexte">global-dom-log.js</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">import/global-dom-log.js</text:p><text:p text:style-name="Code">const log = (message) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const text = String(message).trim();</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>document.querySelector('#logs').textContent = text;</text:p><text:p text:style-name="Code">};</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">import/script.js</text:p><text:p text:style-name="Code">/* global log */</text:p><text:p text:style-name="Code">window.addEventListener('load', () =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>log('OK');<text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">log('KO');<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche une erreur car <text:span text:style-name="CodeDansTexte">&lt;div id="logs"&gt;</text:span> n&#8217;existe pas encore dans le document
Ã  ce stade de l&#8217;exÃ©cution.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Cette ligne est exÃ©cutÃ©e une fois le document chargÃ©&#160;â€“ <text:span text:style-name="CodeDansTexte">&lt;div id="logs"&gt;</text:span>
contient dÃ©sormais le texte&#160;<text:span text:style-name="CodeDansTexte">OK</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">S&#8217;il est facile d&#8217;ajouter du code dans le navigateur, on constate plusieurs problÃ¨mes&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">Partager du code entre scripts repose sur une attente explicite.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Le partage de variables entre scripts risque d&#8217;entraÃ®ner des collisions
(par exemple, deux variables du mÃªme nom dÃ©finies dans des scripts diffÃ©rents).</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Il n&#8217;y a pas de moyen Ã©vident de rendre des parties de code privÃ©es au sein de
chaque script.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le dÃ©veloppement <text:span text:style-name="T4">front-end</text:span> basÃ© sur de l&#8217;outillage Node va justement nous aider
Ã  <text:span text:style-name="T7">solidifier et renforcer la rÃ©utilisabilitÃ© de notre&#160;code</text:span>.</text:p>
<text:bookmark text:name="ref-modules-es2015" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Les modules ECMAScript</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous avons Ã©voquÃ© les <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-primitives"  text:visited-style-name="Visited_20_Internet_20_Link">primitives ECMAScript&#160;2015</text:a> dans le chapitre&#160;3.
Les modules font partie des fonctionnalitÃ©s tant attendues.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-09/images/module-import.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>9-undefined.</text:span> Utilisation des modules ECMAScript dans un navigateur web (ici, Safari pour macOS)</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;attribut <text:span text:style-name="CodeDansTexte">type="module"</text:span> sert Ã  maintenir une compatibilitÃ© entre les scripts
classiques et les modules ECMAScript.
Ce mÃ©canisme s&#8217;appuie sur plusieurs concepts importants&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">Toute variable est privÃ©e sauf si elle est exportÃ©e avec l&#8217;opÃ©rateur <text:span text:style-name="CodeDansTexte">export</text:span>.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Les modules sont explicitement inclus avec l&#8217;opÃ©rateur <text:span text:style-name="CodeDansTexte">import</text:span>.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Les variables globales dÃ©finies par l&#8217;utilisateur ne sont pas accessibles depuis un module.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Retravaillons le document HTML de la section prÃ©cÃ©dente&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">import/import.html</text:p><text:p text:style-name="Code">&lt;script&gt;const pro = 'test';&lt;/script&gt;</text:p><text:p text:style-name="Code">&lt;script type="module" src="script-import.js"&gt;&lt;/script&gt;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">&lt;div id="logs"&gt;&lt;/div&gt;</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous voulons maintenant (sa)voir si la variable&#160;<text:span text:style-name="CodeDansTexte">pro</text:span> dÃ©finie avant l&#8217;inclusion
du module <text:span text:style-name="CodeDansTexte">script-import.js</text:span> est accessible.
Nous voulons Ã©galement savoir si la syntaxe d&#8217;import de la fonction&#160;<text:span text:style-name="CodeDansTexte">log</text:span> fonctionne&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">import/script-import.js</text:p><text:p text:style-name="Code">import {log} from './dom-log.js';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(typeof pro);<text:s text:c="4"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(typeof log);<text:s text:c="4"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">console.log(typeof window); <text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">window.addEventListener('load', () =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>log('OK');</text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">undefined</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">function</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche <text:span text:style-name="CodeDansTexte">object</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">De mÃªme que nous avons utilisÃ© <text:span text:style-name="CodeDansTexte">import</text:span> pour importer de maniÃ¨re sÃ©lective une
fonction du module <text:span text:style-name="CodeDansTexte">dom-log.js</text:span>, l&#8217;opÃ©rateur <text:span text:style-name="CodeDansTexte">export</text:span> nous aide Ã  exposer des
objets, fonctions et variables&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">import/dom-log.js</text:p><text:p text:style-name="Code">export function log(message, target = '#logs') {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const text = String(message).trim();</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>document.querySelector(target).textContent = text;</text:p><text:p text:style-name="Code">}</text:p>
<text:bookmark text:name="ref-browserify" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Importer des modules&#160;npm pour le&#160;Web</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Qu&#8217;en est-il alors des modules&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>&#160;?
Nous pouvons transpiler et importer du code.
Ce serait trÃ¨s utile si nous pouvions Ã©galement importer du code tiers.
Cela nous Ã©viterait de rÃ©inventer la roue, nous donnerait accÃ¨s Ã  du code bien testÃ©
et trop coÃ»teux Ã  Ã©crire nous-mÃªmes.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous avons vu comment <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-modules"  text:visited-style-name="Visited_20_Internet_20_Link">charger des modules&#160;<text:span text:style-name="CodeDansTexte">npm</text:span></text:a>
dans le chapitre 5.
IntÃ©ressons-nous Ã  leur utilisation dans le contexte d&#8217;une application <text:span text:style-name="T4">front-end</text:span>.
Pour cela, adaptons l&#8217;exemple de la section prÃ©cÃ©dente&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">import/script-import-jquery.js</text:p><text:p text:style-name="Code">import $ from 'jquery';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log($.fn.jquery);<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">$(document).ready(() =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>$('#logs').text('OK');<text:s text:c="3"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> <text:span text:style-name="CodeDansTexte">$.fn.jquery</text:span> contient le numÃ©ro de version de jQuery.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Substitut jQuery pour remplacer le texte dans <text:span text:style-name="CodeDansTexte">&lt;div id="logs"&gt;</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le document HTML chargeant ce module est en tout point similaire au prÃ©cÃ©dent exemple&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">import/import-jquery.html</text:p><text:p text:style-name="Code">&lt;script type="module" src="script-import-jquery.js"&gt;&lt;/script&gt;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">&lt;div id="logs"&gt;&lt;/div&gt;</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le seul hic, c&#8217;est que <text:span text:style-name="T7">cela ne fonctionne pas</text:span>&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">Le navigateur ne peut pas savoir oÃ¹ se trouve la dÃ©pendance demandÃ©e.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Rien ne garantit que <text:span text:style-name="CodeDansTexte">jquery</text:span> expose son code en tant que module ECMAScript.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">On n&#8217;a certainement pas envie d&#8217;exposer publiquement le rÃ©pertoire <text:span text:style-name="CodeDansTexte">node_modules</text:span>.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">C&#8217;est alors qu&#8217;entre en jeu <text:span text:style-name="T4">Browserify</text:span>.
Il s&#8217;agit d&#8217;un outil gÃ©nÃ©rique de transformation de code.
Il peut Ãªtre utilisÃ© en ligne de commandes, via son API Node, mais aussi par
le biais de plug-in pour d&#8217;autres outils (comme Gulp ou Grunt).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">Browserify</text:span> a Ã©tÃ© initialement crÃ©Ã© pour transformer du code Ã©crit pour Node en
code fonctionnel dans les navigateurs.
Il expose notamment un concept d&#8217;intÃ©grations (les <text:span text:style-name="T4">transforms</text:span>) afin d&#8217;effectuer
des remplacements ligne Ã  ligne.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">LÃ  oÃ¹ <text:span text:style-name="T4">Babel</text:span> cherche uniquement Ã  traduire un langage vers un autre,
<text:span text:style-name="T4">Browserify</text:span> est le couteau suisse pour effectuer des remplacements majeurs dans le code&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">portage de la fonction <text:span text:style-name="CodeDansTexte">require()</text:span> et inclusion du code des modules sous-jacents&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">suppression de code conditionnel&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">remplacement d&#8217;API spÃ©cifiques Ã  Node par des <text:span text:style-name="T4">polyfills</text:span> pour le&#160;Web&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">extraction de&#160;CSS&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">etc.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">Browserify</text:span> est intÃ©ressant au sens oÃ¹ il nous apprend Ã  nous constituer
notre outillage, pour nos propres besoins.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Guide</text:span> Utiliser Browserify</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque"><text:span text:style-name="T4">Browserify</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/browserify" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/browserify</text:a></text:span>) est un outil extrÃªmement
adaptable, modulaire et puissant.
Son apprentissage progressif peut faire de lui un alliÃ© de choix dans tous
vos projets Node et&#160;Web.</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://github.com/substack/browserify-handbook" text:visited-style-name="Visited_20_Internet_20_Link">https://github.com/substack/browserify-handbook</text:a></text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Revenons maintenant Ã  notre code auquel il manque la comprÃ©hension des
modules&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>.
Nous allons maintenant chercher Ã  transformer le fichier <text:span text:style-name="CodeDansTexte">script-import-jquery.js</text:span>,
non seulement pour rendre la syntaxe <text:span text:style-name="CodeDansTexte">import</text:span> intelligible
(c&#8217;est le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-transpilation"  text:visited-style-name="Visited_20_Internet_20_Link">rÃ´le de Babel</text:a>), mais aussi pour faire le
lien avec les modules&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>&#160;:</text:p>
<text:p text:style-name="Code">$ npm run browserify -- \</text:p><text:p text:style-name="Code"><text:s text:c="2"/>-t babelify \</text:p><text:p text:style-name="Code"><text:s text:c="2"/>-e examples/import/script-import-jquery.js \</text:p><text:p text:style-name="Code"><text:s text:c="2"/>-o examples/import/script-import-jquery-browserify.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette commande exÃ©cute trois choses&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="CodeDansTexte">-t babelify</text:span> indique d&#8217;utiliser une intÃ©gration Babel (un <text:span text:style-name="T4">transform</text:span>) pour
transformer la syntaxe ECMAScript&#160;2015.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="CodeDansTexte">-e &#8230;&#8203;</text:span> indique le script d&#8217;entrÃ©e Ã  transformer.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="CodeDansTexte">-o &#8230;&#8203;</text:span> indique oÃ¹ stocker le script transformÃ©.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il en rÃ©sultera un fichier nommÃ© <text:span text:style-name="CodeDansTexte">script-import-jquery-browserify.js</text:span> compatible
ECMAScript&#160;5 et qui inclut dÃ©sormais le code source de jQuery.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il ne nous reste plus qu&#8217;Ã  charger le fichier transformÃ© dans notre page web pour
voir le rÃ©sultat&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">import/import-jquery-browserify.html</text:p><text:p text:style-name="Code">&lt;script src="script-import-jquery-browserify.js"&gt;&lt;/script&gt;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">&lt;div id="logs"&gt;&lt;/div&gt;</text:p>
<text:bookmark text:name="ref-rÃ©capitulatif" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">RÃ©capitulatif</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">En rÃ©sumÃ©, nous avons besoin de nous baser sur deux ou trois outils pour Ã©crire
un code modulaire et compatible avec n&#8217;importe quel type de syntaxe&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">Babel pour transformer la syntaxe&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">des <text:span text:style-name="T4">polyfills</text:span> pour harmoniser les fonctionnalitÃ©s&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="T4">browserify</text:span> pour l&#8217;intÃ©gration avec les modules&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ceux-ci ont l&#8217;avantage d&#8217;Ãªtre faciles Ã  prendre en main, modulaires et Ã©volutifs.
Nous pourrons aussi nous tourner vers d&#8217;autres outils de transformation de code
pour explorer d&#8217;autres horizons&#160;â€“ et il en existe Ã©normÃ©ment&#160;: webpack, rollup,
broccoli, etc.</text:p>
<text:bookmark text:name="ref-conception_modulaire" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Conception modulaire</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un autre paradigme change avec la mise Ã  disposition des modules et de
l&#8217;outillage&#160;: le code que l&#8217;on Ã©crit dÃ©pend surtout d&#8217;ECMAScript et de
l&#8217;environnement dans lequel on l&#8217;exÃ©cute, Ã  savoir Node ou un navigateur.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La section suivante s&#8217;intÃ©resse Ã  l&#8217;Ã©volution de l&#8217;Ã©criture du code, autrefois
dirigÃ©e par la structure du document HTML, vers un monde de
fonctions consommant des donnÃ©es, transformÃ©es pour un type d&#8217;affichage, que ce
soit HTML ou autre.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous illustrerons cette Ã©volution au travers d&#8217;un exemple relativement simple&#160;:
une balise HTML affichant l&#8217;heure dont nous actualisons le contenu toutes les secondes.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-09/images/modules-time.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>9-undefined.</text:span> RÃ©sultat de l&#8217;exemple dÃ©veloppÃ© dans les sections suivantes</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> <text:span text:style-name="T4">jQuery</text:span></text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Les exemples suivants se basent sur l&#8217;utilisation de la bibliothÃ¨que <text:span text:style-name="T4">jQuery</text:span>
(<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://api.jquery.com" text:visited-style-name="Visited_20_Internet_20_Link">https://api.jquery.com</text:a></text:span>).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Elle facilite la manipulation du DOM tout en gÃ©rant les incompatibilitÃ©s des
diffÃ©rents navigateurs.
Son utilisation est devenue moins dominante du fait d&#8217;une nette amÃ©lioration de
la qualitÃ© de ces derniers.</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://learn.jquery.com/using-jquery-core/" text:visited-style-name="Visited_20_Internet_20_Link">http://learn.jquery.com/using-jquery-core/</text:a></text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-le_syndrome_du_plug_in_jquery" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Le syndrome du plug-in jQuery</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce que j&#8217;appelle le <text:span text:style-name="">syndrome du plug-in <text:span text:style-name="T4">jQuery</text:span></text:span>, c&#8217;est une combinaison
des Ã©lÃ©ments suivants&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">crÃ©ation de code mÃ©tier inutilisable en dehors de <text:span text:style-name="T4">jQuery</text:span>&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">mÃ©lange de la prÃ©sentation des donnÃ©es et de l&#8217;organisation du code mÃ©tier&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">un code aveugle car Ã©loignÃ© de la structure HTML nÃ©cessaire Ã  son fonctionnement&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">fragilitÃ© du code en cas de changement de la structure HTML associÃ©e&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">en gÃ©nÃ©ral, un code difficilement testable&#160;â€“ difficile de ne pas aboutir Ã  une interface boguÃ©e.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Voici un exemple de document HTML fragile et mÃ©langeant tous les concepts en mÃªme temps.
Il est parfaitement valide, mais illustre un ensemble de pratiques courantes que
nous allons chercher Ã  dÃ©construire.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">modules/jquery-plugin.html</text:p><text:p text:style-name="Code">&lt;!DOCTYPE html&gt;</text:p><text:p text:style-name="Code">&lt;body&gt;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;link rel="stylesheet" type="text/css" href="styles.css"&gt;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;time datetime="" data-interval="1000"&gt;---&lt;/time&gt;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;script src="../../node_modules/jquery/dist/jquery.js"&gt;&lt;/script&gt;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;script src="jquery-plugin.js"&gt;&lt;/script&gt;</text:p><text:p text:style-name="Code">&lt;/body&gt;</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Maintenant que la structure HTML est dÃ©finie, nous devons Ã©crire le
code affichant l&#8217;heure dans un Ã©lÃ©ment HTML toutes les secondes.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">modules/jquery-plugin.js</text:p><text:p text:style-name="Code">/* global jQuery */</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">($ =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>$.fn.displaySeconds = function displaySeconds() {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>this.each((i, dateElement) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="6"/>setInterval(() =&gt; {<text:s text:c="18"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="8"/>const now = new Date();<text:s text:c="12"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="8"/>const seconds = now.getSeconds();</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="8"/>$(dateElement)<text:s text:c="21"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="10"/>.removeClass(seconds % 2 ? 'pair': 'impair')</text:p><text:p text:style-name="Code"><text:s text:c="10"/>.addClass(seconds % 2 ? 'impair': 'pair')</text:p><text:p text:style-name="Code"><text:s text:c="10"/>.attr('datetime', now.toISOString())</text:p><text:p text:style-name="Code"><text:s text:c="10"/>.text(now.toLocaleTimeString());</text:p><text:p text:style-name="Code"><text:s text:c="6"/>}, $(dateElement).data('interval')); <text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="4"/>return this;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>$(document).ready(() =&gt; {<text:s text:c="6"/><text:span text:style-name="PuceCode">5</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>$('time').displaySeconds();<text:s text:c="2"/><text:span text:style-name="PuceCode">6</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>});</text:p><text:p text:style-name="Code">})(jQuery);</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Ce bloc de code est exÃ©cutÃ© toutes les secondes.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> La donnÃ©e de temps est obtenue chaque seconde par notre plug-in <text:span text:style-name="T4">jQuery</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Certaines dÃ©cisions mÃ©tier sont mÃ©langÃ©es avec l&#8217;affichage de la donnÃ©e temps.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> L&#8217;intervalle est dÃ©terminÃ© par la valeur de l&#8217;attribut <text:span text:style-name="CodeDansTexte">data-interval</text:span>.<text:line-break/><text:span text:style-name="PuceCode">5</text:span> Ce bloc de code est exÃ©cutÃ© dÃ¨s que le document HTML est prÃªt&#160;â€“ toute sa structure HTML est disponible.<text:line-break/><text:span text:style-name="PuceCode">6</text:span> Le plug-in <text:span text:style-name="T4">jQuery</text:span> est appliquÃ© Ã  toutes les occurrences de <text:span text:style-name="CodeDansTexte">&lt;time&gt;</text:span> dans lequel il est exÃ©cutÃ©.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Certains motifs illustrÃ©s dans la section <text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-modules"  text:visited-style-name="Visited_20_Internet_20_Link">Importer des modules</text:a></text:span>
refont surface&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">Variables globales&#160;: que faire si <text:span text:style-name="CodeDansTexte">jQuery</text:span> n&#8217;existe pas&#160;?</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Connaissance implicite du document&#160;: que faire si une personne tierce remplace
la balise <text:span text:style-name="CodeDansTexte">&lt;time&gt;</text:span> par une autre balise&#160;?</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Code ECMAScript pilotÃ© par le document&#160;: que faire si une personne tierce
exprime l&#8217;intervalle en secondes et non en millisecondes&#160;?</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La faute n&#8217;est pas vraiment celle de <text:span text:style-name="T4">jQuery</text:span> mais plutÃ´t la nÃ´tre&#160;â€“ enfin, la mienne.
Nous avons mÃ©langÃ© rÃ¨gles de fonctionnement (contenu de balise, classe&#160;CSS
Ã  ajouter/enlever) et donnÃ©es (date courante, paritÃ© des secondes, Ã©vÃ©nement de
mise Ã  jour <text:span text:style-name="CodeDansTexte">setInterval()</text:span>).</text:p>
<text:bookmark text:name="ref-vers_une_approche_jquery_composite" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Vers une approche jQuery composite</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous allons maintenant reprendre les concepts appris prÃ©cÃ©demment et conserver
le mÃªme outil, Ã  savoir <text:span text:style-name="T4">jQuery</text:span>.
Certains outils encouragent de bons motifs de conception et donnent la sensation
de rÃ©soudre des problÃ¨mes.
Apprendre ces motifs et Ã  capitaliser sur les outils que nous connaissons dÃ©jÃ 
peuvent nous emmener tout aussi&#160;loin.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">modules/jquery-app.html</text:p><text:p text:style-name="Code">&lt;!DOCTYPE html&gt;</text:p><text:p text:style-name="Code">&lt;body&gt;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;link rel="stylesheet" type="text/css" href="styles.css"&gt;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;time datetime=""&gt;---&lt;/time&gt;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;script src="jquery-app-browserify.js"&gt;&lt;/script&gt;</text:p><text:p text:style-name="Code">&lt;/body&gt;</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le changement majeur rÃ©side dans la rÃ©organisation du code applicatif&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">modules/jquery-app.js</text:p><text:p text:style-name="Code">import $ from 'jquery';</text:p><text:p text:style-name="Code">import timerFn from './timer.js';<text:s text:c="19"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const displaySeconds = (tickData, dateElement) =&gt; { <text:span text:style-name="PuceCode">5</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>const {className, now} = tickData;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>$(dateElement)<text:s text:c="36"/><text:span text:style-name="PuceCode">6</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>.attr('class', className)</text:p><text:p text:style-name="Code"><text:s text:c="4"/>.attr('datetime', now.toISOString())</text:p><text:p text:style-name="Code"><text:s text:c="4"/>.text(now.toLocaleTimeString());</text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">$(document).ready(() =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const dateElements = $('time').get();<text:s text:c="13"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>const onTick = tickData =&gt; {<text:s text:c="22"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>dateElements.forEach(el =&gt; displaySeconds(tickData, el));</text:p><text:p text:style-name="Code"><text:s text:c="2"/>};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>timerFn({ interval: 1000, onTick });<text:s text:c="14"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Nous sÃ©lectionnons les Ã©lÃ©ments de la page Ã  actualiser chaque seconde.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Nous dÃ©finissons quoi faire avec les donnÃ©es transmises chaque seconde.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Nous dÃ©marrons un minuteur.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Le minuteur est une fonction externe, dont le comportement n&#8217;est pas rÃ©gi par <text:span text:style-name="T4">jQuery</text:span> ou une autre bibliothÃ¨que.<text:line-break/><text:span text:style-name="PuceCode">5</text:span> Cette fonction est responsable de l&#8217;affichage de donnÃ©es dans un Ã©lÃ©ment&#160;HTML.<text:line-break/><text:span text:style-name="PuceCode">6</text:span> Cette fois-ci, nous nous contentons de seulement mettre Ã  jour attributs et contenus&#160;â€“ la logique mÃ©tier a Ã©tÃ© dÃ©placÃ©e dans le module <text:span text:style-name="CodeDansTexte">timer.js</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le code a Ã©tÃ© divisÃ© en deux sections distinctes&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">celle qui dÃ©crit la rÃ©action Ã  une donnÃ©e&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">celle qui intÃ¨gre le minuteur avec les Ã©lÃ©ments du DOM.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous n&#8217;avons pas rÃ©ellement besoin de savoir comment fonctionne le minuteur Ã 
ce niveau&#160;â€“ nous devons pouvoir compter sur les donnÃ©es qu&#8217;il nous fournit.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">modules/timer.js</text:p><text:p text:style-name="Code">const tick = () =&gt; {<text:s text:c="14"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>const now = new Date;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>return {<text:s text:c="24"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>now,</text:p><text:p text:style-name="Code"><text:s text:c="4"/>className: now.getSeconds() % 2 ? 'impair': 'pair'</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">module.exports = function timer ({ onTick, interval }) {<text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>setInterval(() =&gt; onTick(tick()), interval);<text:s text:c="10"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>return tick();<text:s text:c="18"/><text:span text:style-name="PuceCode">5</text:span></text:p><text:p text:style-name="Code">}</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Cette fonction (privÃ©e) est chargÃ©e de dÃ©crire le temps prÃ©sent sous forme d&#8217;une structure de donnÃ©es.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Cette structure de donnÃ©es pourra retourner de nouvelles clÃ©s/valeurs sans remettre en cause le fonctionnement du code y ayant recours.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Le paramÃ¨tre <text:span text:style-name="CodeDansTexte">onTick</text:span> est une fonction passÃ©e en argument qui sera appelÃ©e Ã  chaque nouvel intervalle de temps.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> La responsabilitÃ© de <text:span text:style-name="CodeDansTexte">timer</text:span> est de communiquer une nouvelle structure de donnÃ©es Ã  un intervalle de temps donnÃ©.<text:line-break/><text:span text:style-name="PuceCode">5</text:span> On retourne immÃ©diatement une structure de donnÃ©es par commoditÃ© et de maniÃ¨re synchrone.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Pour un rÃ©sultat identique, nous avons dÃ©sormais sÃ©parÃ© notre code en trois
domaines distincts&#160;: le minuteur, son intÃ©gration, sa reprÃ©sentation sous forme HTML.
Cerise sur le gÃ¢teau, cette distinction se constate visuellement,
au premier coup&#160;d&#8217;Å“il.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Tout n&#8217;est pas parfait, car nous sommes encore liÃ©s Ã  la structure du
document&#160;HTML.</text:p>
<text:bookmark text:name="ref-partager_le_code_mÃ©tier_avecnode" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Partager le code mÃ©tier avec&#160;Node</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette sÃ©paration de principes (<text:span text:style-name="T4">separation of concerns</text:span>) va au-delÃ  du plaisir
de l&#8217;esthÃ¨te.
Nous venons sans le savoir de crÃ©er du <text:span text:style-name="T7">code ECMAScript universel</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Pourquoi universel&#160;?
Parce que nous pouvons tout aussi bien l&#8217;inclure et l&#8217;exÃ©cuter dans Node que
dans un navigateur&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">modules/node-timer.js</text:p><text:p text:style-name="Code">const timerFn = require('./timer.js');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">timerFn({ interval: 1000, onTick: console.log });</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exÃ©cution du script <text:span text:style-name="CodeDansTexte">node-timer.js</text:span> afficherait quelque chose comme ce
qui suit dans votre terminal&#160;:</text:p>
<text:p text:style-name="Code">$ node examples/modules/node-timer.js</text:p><text:p text:style-name="Code">{ now: 2017-02-17T11:07:29.752Z, className: 'impair' }</text:p><text:p text:style-name="Code">{ now: 2017-02-17T11:07:30.762Z, className: 'pair' }</text:p><text:p text:style-name="Code">{ now: 2017-02-17T11:07:31.768Z, className: 'impair' }</text:p><text:p text:style-name="Code">{ now: 2017-02-17T11:07:32.770Z, className: 'pair' }</text:p><text:p text:style-name="Code">{ now: 2017-02-17T11:07:33.775Z, className: 'impair' }</text:p><text:p text:style-name="Code">{ now: 2017-02-17T11:07:34.779Z, className: 'pair' }</text:p><text:p text:style-name="Code"><text:span text:style-name="Menu">[Ctrl+C]</text:span></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Chaque seconde, la fonction <text:span text:style-name="CodeDansTexte">console.log</text:span> est appelÃ©e et affiche la structure
de donnÃ©es de notre minuteur dans la sortie standard du terminal.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous pourrions dÃ¨s Ã  prÃ©sent utiliser le minuteur dans d&#8217;autres applications,
cÃ´tÃ© client, cÃ´tÃ© serveur et, pourquoi pas, un jour le publier sur le
registre&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>&#160;?</text:p>
<text:bookmark text:name="ref-sÃ©paration_du_fond_et_de_la_forme_donnÃ©es_rendu_et_interactions" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">SÃ©paration du fond et de la forme : donnÃ©es, rendu et interactions</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les praticienÂ·neÂ·s de l&#8217;intÃ©gration web nous le dirons souvent&#160;: il faut
<text:span text:style-name="T7">sÃ©parer le fond de la forme</text:span>.
Il en est de mÃªme dans notre code&#160;â€“ et pas que pour le dÃ©veloppement <text:span text:style-name="T4">front-end</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un code maintenable n&#8217;a pas besoin d&#8217;Ãªtre complexe.
Il nÃ©cessite surtout de bien isoler ses pÃ©rimÃ¨tres d&#8217;intervention.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les exemples prÃ©cÃ©dents nous ont permis de dÃ©celer trois pÃ©rimÃ¨tres phares&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">donnÃ©es&#160;: des structures prÃ©dictibles, obtenues ou modifiÃ©es&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">rendu&#160;: la reprÃ©sentation des donnÃ©es en contexte, que ce soit une page HTML,
un terminal ou un fichier&#160;CSV&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">interactions&#160;: des Ã©vÃ©nements dÃ©clenchÃ©s par les utilisateurs, par des
facteurs externes ou des rÃ¨gles mÃ©tier&#160;â€“ ils affectent les donnÃ©es et leur
reprÃ©sentation.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-react" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Rapprocher donnÃ©es, rendu et interactions avec&#160;React</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">React</text:span> a atteint un pic de popularitÃ© certain en&#160;2015 et&#160;2016,
pas seulement parce que c&#8217;est un outil bien conÃ§u, mais justement parce
qu&#8217;il encourage cette pratique de la reprÃ©sentation des donnÃ©es.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> API&#160;React</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Les exemples suivants se basent sur la bibliothÃ¨que <text:span text:style-name="T4">React</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://reactjs.org" text:visited-style-name="Visited_20_Internet_20_Link">https://reactjs.org</text:a></text:span>).
Sa documentation offre de bons exemples pour se familiariser avec son utilisation.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Notre code HTML n&#8217;est qu&#8217;un rÃ©sultat exposant des surfaces d&#8217;interaction.
Il se structure en composants.
Un composant est responsable de deux choses&#160;: la reprÃ©sentation de donnÃ©es et
la rÃ©action Ã  des Ã©vÃ©nements.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cela se traduira par un changement de taille&#160;: l&#8217;exemple que nous avons fait
Ã©voluer ne fait plus mention de balise <text:span text:style-name="CodeDansTexte">&lt;time&gt;</text:span> mais expose une balise dÃ©diÃ©e Ã 
contenir notre composant minuteur&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">modules/react-app.html</text:p><text:p text:style-name="Code">&lt;!DOCTYPE html&gt;</text:p><text:p text:style-name="Code">&lt;body&gt;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;link rel="stylesheet" type="text/css" href="styles.css"&gt;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;div id="app"&gt;&lt;/div&gt;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;script src="react-app-browserify.js"&gt;&lt;/script&gt;</text:p><text:p text:style-name="Code">&lt;/body&gt;</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Notre code applicatif est rÃ©duit Ã  son plus strict minimum&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">modules/react-app.js</text:p><text:p text:style-name="Code">import { createElement } from 'react';</text:p><text:p text:style-name="Code">import ReactDOM from 'react-dom';</text:p><text:p text:style-name="Code">import DateInterval from './date-interval.jsx';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">ReactDOM.render(<text:s text:c="34"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>createElement(DateInterval, {interval: 1000}),<text:s text:c="2"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>document.querySelector('#app')<text:s text:c="18"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">);</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> MÃ©thode responsable du rendu HTML de notre composant <text:span text:style-name="CodeDansTexte">TimeInterval</text:span> dans l&#8217;Ã©lÃ©ment <text:span text:style-name="CodeDansTexte">&lt;div id="app"&gt;</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> CrÃ©ation de notre composant minuteur avec un intervalle de mise Ã  jour de 1&#160;000 millisecondes.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Indication que le rendu du composant sera effectuÃ© dans l&#8217;Ã©lÃ©ment <text:span text:style-name="CodeDansTexte">&lt;div id="app"&gt;</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cela ressemble fortement au contenu de nos prÃ©cÃ©dentes invocations de
<text:span text:style-name="CodeDansTexte">$(document).ready()</text:span> mais sans avoir Ã  se soucier du fonctionnement interne du minuteur.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La reprÃ©sentation et le fonctionnement du minuteur sont dÃ©sormais regroupÃ©s
dans un seul composant.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">modules/date-interval.jsx</text:p><text:p text:style-name="Code">import React, { Component } from 'react';</text:p><text:p text:style-name="Code">import timerFn from './timer.js';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">export default class DateInterval extends Component {<text:s text:c="4"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>constructor(props) {<text:s text:c="35"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>super(props);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="4"/>const {interval} = props;</text:p><text:p text:style-name="Code"><text:s text:c="4"/>this.onTick = this.onTick.bind(this);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="4"/>this.state = {</text:p><text:p text:style-name="Code"><text:s text:c="6"/>tickData: timerFn({ interval, onTick: this.onTick })<text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>};</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>onTick (tickData) {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>this.setState({ tickData });<text:s text:c="19"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>render() {<text:s text:c="39"/><text:span text:style-name="PuceCode">5</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>const {className, now} = this.state.tickData;<text:s text:c="2"/><text:span text:style-name="PuceCode">6</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="4"/>return (&lt;time className={className} dateTime={now.toISOString()}&gt;</text:p><text:p text:style-name="Code"><text:s text:c="6"/>{now.toLocaleTimeString()}</text:p><text:p text:style-name="Code"><text:s text:c="4"/>&lt;/time&gt;);</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">}</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Nous exportons un composant <text:span text:style-name="T4">React</text:span> grÃ¢ce Ã  l&#8217;opÃ©rateur <text:span text:style-name="CodeDansTexte">extends</text:span> (<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-primitive-class"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;3</text:a>).<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Le <text:span text:style-name="CodeDansTexte">constructor</text:span> est exÃ©cutÃ© quand le composant est rendu dans le document.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> La propriÃ©tÃ© <text:span text:style-name="CodeDansTexte">interval</text:span> nous est fournie dans <text:span text:style-name="CodeDansTexte">react-app.js</text:span> et nous stockons la structure de donnÃ©e retournÃ©e par le minuteur tout en dÃ©clenchant son actualisation toutes les 1&#160;000 millisecondes.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Ã€ chaque intervalle, nous mettons Ã  jour la valeur <text:span text:style-name="CodeDansTexte">tickData</text:span> de l&#8217;Ã©tat interne du composant (<text:span text:style-name="CodeDansTexte">this.state</text:span>).<text:line-break/><text:span text:style-name="PuceCode">5</text:span> La mÃ©thode <text:span text:style-name="CodeDansTexte">render()</text:span> est exÃ©cutÃ©e quand le composant est insÃ©rÃ© dans un document pour la premiÃ¨re fois et quand l&#8217;Ã©tat interne (<text:span text:style-name="CodeDansTexte">this.state</text:span>) change.<text:line-break/><text:span text:style-name="PuceCode">6</text:span> Nous dÃ©structurons la valeur connue de <text:span text:style-name="CodeDansTexte">tickData</text:span> pour effectuer une opÃ©ration qui nous rappelle les diffÃ©rents appels Ã  <text:span text:style-name="CodeDansTexte">.attr('class')</text:span> et <text:span text:style-name="CodeDansTexte">.text()</text:span> de <text:span text:style-name="T4">jQuery</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">React</text:span> introduit trois concepts au sein des composants&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">un cycle de vie basÃ© sur des propriÃ©tÃ©s (<text:span text:style-name="T4">props</text:span>) et un Ã©tat interne (<text:span text:style-name="T4">state</text:span>)&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">des propriÃ©tÃ©s immuables pour le paramÃ©trage initial&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">un Ã©tat interne mutable pour contenir les changements et demander une
actualisation de leur reprÃ©sentation dans le document.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">React</text:span> dÃ©termine les opÃ©rations Ã  effectuer dans le document HTML en fonction
de leur lourdeur&#160;: (re)crÃ©ation complÃ¨te de <text:span text:style-name="CodeDansTexte">&lt;time&gt;</text:span> dans le nÅ“ud
parent, simple mise Ã  jour d&#8217;un ou plusieurs attribut(s) ou encore dÃ©placement
du composant ailleurs dans le document HTML, etc.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;intelligence d&#8217;une bibliothÃ¨que comme <text:span text:style-name="T4">React</text:span> est d&#8217;encourager Ã  dÃ©crire
les donnÃ©es et leur rendu pour se charger des opÃ©rations d&#8217;Ã©criture dans le DOM.
Cela conduit Ã  crÃ©er des composants faciles Ã  isoler, Ã  rÃ©utiliser et Ã  tester.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette approche nous a laissÃ©s rÃ©utiliser notre minuteur simplement en l&#8217;adaptant.
<text:span text:style-name="T4">React</text:span> nous permet de diriger l&#8217;affichage du document plutÃ´t que d&#8217;en dÃ©pendre.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Outil</text:span> React Developer Tools</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Une extension pour les navigateurs Chrome et Firefox dÃ©taille l&#8217;arborescence
des composants montÃ©s dans le document HTML ainsi qu&#8217;une vue de leurs propriÃ©tÃ©s
respectives&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://chrome.google.com/webstore/detail/fmkadmapgofadopljbjfkapdkoienihi" text:visited-style-name="Visited_20_Internet_20_Link">https://chrome.google.com/webstore/detail/fmkadmapgofadopljbjfkapdkoienihi</text:a></text:span></text:p>
</text:list-item><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://addons.mozilla.org/firefox/addon/react-devtools/" text:visited-style-name="Visited_20_Internet_20_Link">https://addons.mozilla.org/firefox/addon/react-devtools/</text:a></text:span></text:p>
</text:list-item></text:list>
<text:p text:style-name="RemarqueFigureNumero">(chapter-09/images/react-devtools.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>9-undefined.</text:span> React Developer Tools</text:p>
<text:bookmark text:name="ref-io" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Des requÃªtes Ajax vers du temps&#160;rÃ©el</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les technologies web offrent un panel de fonctionnalitÃ©s crÃ©atives et adaptables.
L&#8217;explosion du <text:span text:style-name="T4">Web 2.0</text:span> a coÃ¯ncidÃ© avec la redÃ©couverte de <text:span text:style-name="CodeDansTexte">XMLHttpRequest</text:span>,
une API initialement crÃ©Ã©e par Microsoft pour transfÃ©rer des donnÃ©es entre
client et serveur, de maniÃ¨re non&#160;bloquante.
Cette fonctionnalitÃ© a permis de basculer vers un monde de pages dynamiques et
rapides Ã  charger.
Des applications web comme Google&#160;Maps, Gmail ou la recherche instantanÃ©e de
Google ont parachevÃ© la popularisation de cette technique.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Toutefois, son API est peu intuitive et est unidirectionnelle, dirigÃ©e
du client vers le serveur.
Le terme <text:span text:style-name="CodeDansTexte">XMLHttpRequest</text:span> est parfois nommÃ© <text:span text:style-name="CodeDansTexte">Ajax</text:span> ou <text:span text:style-name="CodeDansTexte">xhr</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un mÃªme exemple cÃ´tÃ© client sera dÃ©veloppÃ© et successivement adaptÃ© aux
technologies <text:span text:style-name="CodeDansTexte">fetch()</text:span>, <text:span text:style-name="T4">EventSource</text:span> puis <text:span text:style-name="T4">WebSocket</text:span>.
Il nous permettra d&#8217;en faire Ã©merger les principes, leurs cas d&#8217;usage ainsi
que leur possible intÃ©gration avec&#160;Node.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;implÃ©mentation cÃ´tÃ© serveur est basÃ©e sur un serveur
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-express"  text:visited-style-name="Visited_20_Internet_20_Link">Express.js</text:a> dont l&#8217;usage est expliquÃ© au
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-07"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;7</text:a>.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-09/images/io-example.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>9-undefined.</text:span> RÃ©sultat attendu dans les exemples des sections suivantes</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Remarque</text:span> Node, mais pas&#160;que</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque"><text:span text:style-name="CodeDansTexte">fetch()</text:span>, <text:span text:style-name="T4">EventSource</text:span> et <text:span text:style-name="T4">WebSocket</text:span> reposent sur le protocole HTTP/1 et ses extensions.
Il est important de comprendre que leur contrepartie <text:span text:style-name="">cÃ´tÃ© serveur</text:span> existe aussi
dans d&#8217;autres langages et environnements comme Ruby, Python et PHP.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Il se trouve que la nature asynchrone mÃªme de Node rend cette intÃ©gration
relativement aisÃ©e et triviale, aussi et en grande partie grÃ¢ce Ã  l&#8217;Ã©cosystÃ¨me&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>.</text:p>
<text:bookmark text:name="ref-io-fetch" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Ã‰change ponctuel de donnÃ©es avec <text:span text:style-name="">fetch()</text:span></text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="CodeDansTexte">fetch()</text:span> offre une interface trÃ¨s simple pour appeler une ressource HTTP.
Le rÃ©sultat est retournÃ© sous forme de promesse
(<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-promise"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;3</text:a>).
Cette fonction sert aussi bien Ã  obtenir des ressources avec des requÃªtes de
type&#160;<text:span text:style-name="CodeDansTexte">GET</text:span> et <text:span text:style-name="CodeDansTexte">HEAD</text:span> qu&#8217;Ã  en crÃ©er et modifier avec des requÃªtes de type <text:span text:style-name="CodeDansTexte">POST</text:span>,
<text:span text:style-name="CodeDansTexte">PUT</text:span>, <text:span text:style-name="CodeDansTexte">DELETE</text:span> et <text:span text:style-name="CodeDansTexte">PATCH</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exemple associÃ© est accessible sur <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://localhost:4000/examples/io/fetch.html" text:visited-style-name="Visited_20_Internet_20_Link">http://localhost:4000/examples/io/fetch.html</text:a></text:span>.
Nous pouvons vÃ©rifier la compatibilitÃ© navigateur de <text:span text:style-name="CodeDansTexte">fetch()</text:span> sur
<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://caniuse.com#feat=fetch" text:visited-style-name="Visited_20_Internet_20_Link">http://caniuse.com#feat=fetch</text:a></text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le dÃ©roulÃ© d&#8217;exÃ©cution d&#8217;un appel Ã  <text:span text:style-name="CodeDansTexte">fetch()</text:span> est le suivant&#160;:</text:p>
<text:p text:style-name="ListeANumero">1.<text:tab/>Construction de la requÃªte (URL ou objet <text:span text:style-name="CodeDansTexte">Request</text:span>, options).</text:p><text:p text:style-name="ListeANumero">2.<text:tab/>RÃ©ception des en-tÃªtes de la rÃ©ponse (objet <text:span text:style-name="CodeDansTexte">Response</text:span>).</text:p><text:p text:style-name="ListeANumero">3.<text:tab/>DÃ©codage de la rÃ©ponse.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Plusieurs dÃ©codeurs de rÃ©ponse sont fournis nativement&#160;: texte
(<text:span text:style-name="CodeDansTexte">response.text()</text:span>), JSON (<text:span text:style-name="CodeDansTexte">response.json()</text:span>), ArrayBuffer
(<text:span text:style-name="CodeDansTexte">response.arrayBuffer()</text:span>), Blob (<text:span text:style-name="CodeDansTexte">response.blob()</text:span>) et FormData
(<text:span text:style-name="CodeDansTexte">response.formData()</text:span>).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">io/fetch-client.js</text:p><text:p text:style-name="Code">const userList = document.querySelector('#user-list');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">setInterval(() =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>fetch('/new-users')<text:s text:c="29"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>.then(response =&gt; response.text())<text:s text:c="12"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>.then(data =&gt; {<text:s text:c="31"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="6"/>const now = new Date().toLocaleTimeString();</text:p><text:p text:style-name="Code"><text:s text:c="6"/>const li = document.createElement('li');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="6"/>li.textContent = `${now} : ${data}`;</text:p><text:p text:style-name="Code"><text:s text:c="6"/>userList.prepend(li);</text:p><text:p text:style-name="Code"><text:s text:c="4"/>})</text:p><text:p text:style-name="Code">}, 2000);</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> ExÃ©cution de la requÃªte HTTP <text:span text:style-name="T4">GET</text:span> vers <text:span text:style-name="CodeDansTexte">/new-users</text:span> depuis le navigateur courant.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> DÃ©codage progressif de la rÃ©ponse.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Une fois le dÃ©codage terminÃ©, le rÃ©sultat de la requÃªte HTTP est mis Ã  disposition&#160;â€“ ici, sous forme de chaÃ®ne de caractÃ¨res.<text:line-break/></text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-09/images/fetch-frames.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>9-undefined.</text:span> Traces rÃ©seau d&#8217;appels successifs Ã  <text:span text:style-name="CodeDansTexte">fetch()</text:span> ; chacun rÃ©sultant en une nouvelle requÃªte&#160;HTTP</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;implÃ©mentation d&#8217;une ressource HTTP cÃ´tÃ© serveur s&#8217;effectue simplement
en retournant une rÃ©ponse lors d&#8217;une requÃªte.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">io/fetch-server.js</text:p><text:p text:style-name="Code">const chance = require('chance').Chance();</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">module.exports = (app) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>app.get('/new-users', (req, res) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>res.send(chance.name());</text:p><text:p text:style-name="Code"><text:s text:c="2"/>});</text:p><text:p text:style-name="Code">};</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Guide</text:span> Collection d&#8217;exemples</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Le site communautaire MDN met Ã  disposition une dizaine d&#8217;exemples
pour illustrer diffÃ©rents cas d&#8217;utilisation de <text:span text:style-name="CodeDansTexte">fetch()</text:span>&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://github.com/mdn/fetch-examples" text:visited-style-name="Visited_20_Internet_20_Link">https://github.com/mdn/fetch-examples</text:a></text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">En rÃ©sumÃ©, <text:span text:style-name="CodeDansTexte">fetch()</text:span> est idÃ©al pour des demandes ponctuelles de donnÃ©es,
du client vers le serveur.
Le module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> <text:span text:style-name="CodeDansTexte">node-fetch</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/node-fetch" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/node-fetch</text:a></text:span>) est une
implÃ©mentation de <text:span text:style-name="CodeDansTexte">fetch()</text:span> pour Node, tandis que <text:span text:style-name="CodeDansTexte">whatwg-fetch</text:span>
(<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/whatwg-fetch" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/whatwg-fetch</text:a></text:span>) s&#8217;occupe uniquement de <text:span text:style-name="T4">polyfiller</text:span> les
navigateurs.</text:p>
<text:bookmark text:name="ref-io-eventsource" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Approche unidirectionnelle avec EventSource</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">EventSource</text:span> est un mÃ©canisme moins connu que <text:span text:style-name="CodeDansTexte">fetch()</text:span> ou <text:span text:style-name="T4">WebSocket</text:span> mais qui
tire ses origines de la technologie <text:span text:style-name="T4">Comet</text:span>.
On peut l&#8217;assimiler Ã  une inversion de <text:span text:style-name="CodeDansTexte">fetch()</text:span>&#160;: le client appelle une ressource
serveur, maintient une connexion de longue durÃ©e et attend un ou plusieurs
message(s) dudit serveur.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Chaque connexion est ouverte en faisant appel Ã  la construction d&#8217;un objet
<text:span text:style-name="CodeDansTexte">EventSource</text:span>, qui Ã©met alors plusieurs types d&#8217;Ã©vÃ©nements en fonction des actions&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="CodeDansTexte">open</text:span>&#160;: lorsque le client s&#8217;est connectÃ© au serveur&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="CodeDansTexte">message</text:span>&#160;: lorsque le serveur Ã©met des donnÃ©es Ã  destination du client&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="CodeDansTexte">close</text:span>&#160;: lorsque la connexion est fermÃ©e par le serveur&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="CodeDansTexte">error</text:span>&#160;: lorsque la connexion est accidentellement interrompue.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce modÃ¨le de connexion permet tout aussi bien d&#8217;avoir un canal de donnÃ©es
unique avec chaque utilisateur ou encore d&#8217;Ã©mettre les mÃªmes donnÃ©es en temps
rÃ©el Ã  destination de tous les usagers.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Lâ€™exemple associÃ© est accessible sur <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://localhost:4000/examples/io/eventsource.html" text:visited-style-name="Visited_20_Internet_20_Link">http://localhost:4000/examples/io/eventsource.html</text:a></text:span>.
Nous pouvons vÃ©rifier la compatibilitÃ© navigateur de <text:span text:style-name="T4">EventSource</text:span> sur
<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://caniuse.com#feat=eventsource" text:visited-style-name="Visited_20_Internet_20_Link">http://caniuse.com#feat=eventsource</text:a></text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">io/eventsource-client.js</text:p><text:p text:style-name="Code">const connection = new EventSource('/new-users');<text:s text:c="5"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">const userList = document.querySelector('#user-list');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">connection.addEventListener('message', ({data}) =&gt; {<text:s text:c="2"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>const now = new Date().toLocaleTimeString();</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const li = document.createElement('li');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>li.textContent = `${now} : ${data}`;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>userList.prepend(li);</text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Nous ouvrons une nouvelle connexion <text:span text:style-name="T4">EventSource</text:span> de longue durÃ©e depuis
le navigateur courant.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Fonction appelÃ©e Ã  chaque fois que le serveur transmet un message au client.<text:line-break/></text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-09/images/eventsource-frames.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>9-undefined.</text:span> Plusieurs messages peuvent Ãªtre transmis par le biais d&#8217;une seule connexion HTTP avec <text:span text:style-name="T4">EventSource</text:span></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;implÃ©mentation d'<text:span text:style-name="T4">EventSource</text:span> demande un peu d&#8217;efforts cÃ´tÃ© serveur, mais ne
nÃ©cessite pas de framework particulier.
La complexitÃ© rÃ©side dans le maintien d&#8217;une transmission de donnÃ©es dÃ©diÃ©e Ã 
chaque client ainsi qu&#8217;Ã  la libÃ©ration de la connexion lorsque le client se dÃ©connecte.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">io/eventsource-server.js</text:p><text:p text:style-name="Code">const WebSocket = require('faye-websocket');</text:p><text:p text:style-name="Code">const {EventSource} = WebSocket;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const chance = require('chance').Chance();</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">module.exports = (app) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>app.get('/new-users', (req, res, next) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>if (!EventSource.isEventSource(req)) {<text:s text:c="6"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="6"/>return next();</text:p><text:p text:style-name="Code"><text:s text:c="4"/>}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="4"/>let es = new EventSource(req, res);<text:s text:c="9"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>const loop = setInterval(() =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="6"/>es.send(chance.name());<text:s text:c="19"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>}, 2000);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="4"/>es.on('close', () =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="6"/>clearInterval(loop);</text:p><text:p text:style-name="Code"><text:s text:c="6"/>es = null;</text:p><text:p text:style-name="Code"><text:s text:c="6"/>next();</text:p><text:p text:style-name="Code"><text:s text:c="4"/>});</text:p><text:p text:style-name="Code"><text:s text:c="2"/>});</text:p><text:p text:style-name="Code">};</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Une connexion <text:span text:style-name="T4">EventSource</text:span> s&#8217;effectue (presque) comme une requÃªte HTTP classique&#160;â€“ il convient de vÃ©rifier qu&#8217;elle s&#8217;annonce en tant que&#160;telle.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> CrÃ©ation d&#8217;un canal unique entre le client et le serveur.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Chaque appel Ã  <text:span text:style-name="CodeDansTexte">es.send</text:span> enverra un nouveau message au client.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le serveur est responsable de la gestion des connexions demandÃ©es par les
diffÃ©rents clients.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> EventSource</text:h>
Rendez-vous sur <text:span text:style-name="T4">MDN web docs</text:span> pour en savoir plus sur EventSource.<text:line-break/>
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://developer.mozilla.org/docs/fr/Server-sent_events" text:visited-style-name="Visited_20_Internet_20_Link">https://developer.mozilla.org/docs/fr/Server-sent_events</text:a>

<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">En rÃ©sumÃ©, <text:span text:style-name="T4">EventSource</text:span> est idÃ©al pour maintenir une connexion avec le serveur
et souscrire Ã  des mises Ã  jour en continu.
Chaque connexion <text:span text:style-name="T4">EventSource</text:span> devrait concerner qu&#8217;un seul et mÃªme type d&#8217;Ã©vÃ©nement.</text:p>
<text:bookmark text:name="ref-io-websocket" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Ã‰changes en temps&#160;rÃ©el avec WebSocket</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">WebSocket</text:span> est une technologie web favorisant les Ã©changes bidirectionnels
entre client et serveur.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ã€ l&#8217;inverse du protocole HTTP/1, tout message envoyÃ© par le client ou par le
serveur n&#8217;appelle pas Ã  une rÃ©ponse de la part du receveur.
Cet Ã©lÃ©ment et le maintien d&#8217;une connexion permanente expliquent la
rapiditÃ© du protocole en comparaison avec le modÃ¨le requÃªte/rÃ©ponse.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Lâ€™exemple associÃ© est accessible sur <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://localhost:4000/examples/io/websocket.html" text:visited-style-name="Visited_20_Internet_20_Link">http://localhost:4000/examples/io/websocket.html</text:a></text:span>.
Nous pouvons vÃ©rifier la compatibilitÃ© navigateur de <text:span text:style-name="T4">WebSocket</text:span> sur
<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://caniuse.com#feat=websocket" text:visited-style-name="Visited_20_Internet_20_Link">http://caniuse.com#feat=websocket</text:a></text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">io/websocket-client.js</text:p><text:p text:style-name="Code">let ws = new WebSocket('ws://localhost:4000/users');<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">const userList = document.querySelector('#user-list');</text:p><text:p text:style-name="Code">let interval;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">ws.addEventListener('open', () =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>interval = setInterval(() =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>ws.send(JSON.stringify({ action: 'getName' }));<text:s text:c="3"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>}, 2000);</text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">ws.addEventListener('message', ({data}) =&gt; {<text:s text:c="10"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>const li = document.createElement('li');</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const now = new Date().toLocaleTimeString();</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>li.textContent = `${now} : ${data}`;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>userList.prepend(li);</text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">ws.addEventListener('close', () =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>ws = null;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>clearInterval(interval);</text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Nous ouvrons une connexion <text:span text:style-name="T4">WebSocket</text:span> depuis le navigateur courant.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Ã‰mission d&#8217;un message Ã  destination du serveur.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> RÃ©action Ã  un message Ã©mis par le serveur.<text:line-break/></text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-09/images/websocket-frames.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>9-undefined.</text:span> Trame de messages envoyÃ©s par le client (sur fond vert) et par le serveur</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;implÃ©mentation cÃ´tÃ© serveur est lÃ©gÃ¨rement plus compliquÃ©e qu&#8217;avec
<text:span text:style-name="T4">EventSource</text:span> pour la simple et bonne raison que <text:span text:style-name="T4">Websocket</text:span> est une surcouche
du protocole&#160;<text:span text:style-name="CodeDansTexte">ws</text:span>.
HTTP n&#8217;est utilisÃ© que comme canal de communication pour Ã©tablir un lien avec
le serveur&#160;<text:span text:style-name="CodeDansTexte">ws</text:span>.
HTTP sert de tunnel tandis que le dialogue entre client et serveur s&#8217;effectue
dans un dialecte comprÃ©hensible uniquement de clients <text:span text:style-name="T4">WebSocket</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il est nÃ©cessaire d&#8217;utiliser un module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> <text:span text:style-name="T4">WebSocket</text:span> comme <text:span text:style-name="T4">faye</text:span>
(<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/faye-websocket" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/faye-websocket</text:a></text:span>) ou <text:span text:style-name="T4">socket.io</text:span>
(<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/socket.io" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/socket.io</text:a></text:span>) Ã  moins de vouloir rÃ©implÃ©menter le protocole
soi-mÃªme.
Le motif de conception est similaire Ã  celui d'<text:span text:style-name="T4">EventSource</text:span>, Ã  la diffÃ©rence prÃ¨s
qu&#8217;il faut aussi Ã©couter les messages transmis par le client.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Remarque</text:span> HTTP et le statut 101 Switching Protocols</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Voici ce qui se passe lorsqu&#8217;un client <text:span text:style-name="T4">WebSocket</text:span> se connecte sur <text:span text:style-name="CodeDansTexte">ws://example.com</text:span>&#160;:</text:p>
<text:p text:style-name="RemarqueNumero">1.<text:tab/>RequÃªte HTTP <text:span text:style-name="CodeDansTexte"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://example.com" text:visited-style-name="Visited_20_Internet_20_Link">http://example.com</text:a></text:span> standard contenant les en-tÃªtes <text:span text:style-name="CodeDansTexte">Upgrade: websocket</text:span> et <text:span text:style-name="CodeDansTexte">Connection: Upgrade</text:span>.</text:p><text:p text:style-name="RemarqueNumero">2.<text:tab/>Le serveur HTTP rÃ©pond avec un statut <text:span text:style-name="CodeDansTexte">101 Switching Protocols</text:span>.</text:p><text:p text:style-name="RemarqueNumero">3.<text:tab/>Le serveur <text:span text:style-name="T4">WebSocket</text:span> prend le relais dans le dialogue client/serveur.</text:p><text:p text:style-name="RemarqueNumero">4.<text:tab/>Client et serveur communiquent dÃ©sormais via le protocole <text:span text:style-name="CodeDansTexte">ws</text:span> au sein de la connexion HTTP initiale.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Par extension et de par la nature mÃªme du protocole <text:span text:style-name="CodeDansTexte">ws</text:span>, il serait tout Ã 
fait possible que <text:span text:style-name="T4">et</text:span> clients <text:span text:style-name="T4">et</text:span> serveur soient des agents Node.
Autrement dit, un client <text:span text:style-name="T4">WebSocket</text:span> ne doit pas nÃ©cessairement Ãªtre un navigateur.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">io/websocket-server.js</text:p><text:p text:style-name="Code">const WebSocket = require('faye-websocket');</text:p><text:p text:style-name="Code">const chance = require('chance').Chance();</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">module.exports = (server) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>server.on('upgrade', (req, socket, body, next) =&gt; {<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>if (!WebSocket.isWebSocket(req)) {<text:s text:c="11"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="6"/>return next();</text:p><text:p text:style-name="Code"><text:s text:c="4"/>}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="4"/>let ws = new WebSocket(req, socket, body);<text:s text:c="3"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="4"/>ws.on('message', event =&gt; {<text:s text:c="18"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code"><text:s text:c="6"/>const data = JSON.parse(event.data);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="6"/>if (data.action === 'getName') {</text:p><text:p text:style-name="Code"><text:s text:c="8"/>ws.send(chance.name());<text:s text:c="18"/><text:span text:style-name="PuceCode">5</text:span></text:p><text:p text:style-name="Code"><text:s text:c="6"/>}</text:p><text:p text:style-name="Code"><text:s text:c="4"/>});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="4"/>ws.on('close', () =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="6"/>ws = null;</text:p><text:p text:style-name="Code"><text:s text:c="4"/>});</text:p><text:p text:style-name="Code"><text:s text:c="2"/>});</text:p><text:p text:style-name="Code">};</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Le serveur HTTP vient de rÃ©pondre avec un statut <text:span text:style-name="CodeDansTexte">101 Switching Protocols</text:span> et dÃ©lÃ¨gue dÃ©sormais la responsabilitÃ© du dialogue client/serveur.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Nous vÃ©rifions que le changement de protocole concerne le protocole <text:span text:style-name="CodeDansTexte">ws</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> La connexion rÃ©seau (<text:span text:style-name="CodeDansTexte">socket</text:span>) est transmise au serveur <text:span text:style-name="T4">WebSocket</text:span> pour amorcer le dialogue client/serveur avec le protocole <text:span text:style-name="CodeDansTexte">ws</text:span>.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> RÃ©action Ã  la rÃ©ception d&#8217;un message client.<text:line-break/><text:span text:style-name="PuceCode">5</text:span> Ã‰mission d&#8217;un message Ã  destination d&#8217;un client.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">LÃ  aussi, le serveur est responsable de la gestion des connexions demandÃ©es par
les diffÃ©rents clients.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> WebSockets</text:h>
Rendez-vous sur <text:span text:style-name="T4">MDN web docs</text:span> pour en savoir plus sur WebSockets.<text:line-break/>
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://developer.mozilla.org/docs/fr/WebSockets" text:visited-style-name="Visited_20_Internet_20_Link">https://developer.mozilla.org/docs/fr/WebSockets</text:a>

<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">En rÃ©sumÃ©, <text:span text:style-name="T4">WebSocket</text:span> est idÃ©al pour maintenir une connexion en temps&#160;rÃ©el et
pour relayer plusieurs messages Ã  l&#8217;initiative du serveur et de tout client
connectÃ©&#160;â€“ qu&#8217;il s&#8217;agisse d&#8217;un navigateur ou d&#8217;un agent Node.
Chaque connexion <text:span text:style-name="T4">WebSocket</text:span> peut encapsuler plusieurs types de messages.</text:p>
<text:bookmark text:name="ref-dÃ©velopper_au_quotidien" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">DÃ©velopper au quotidien</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous avons beaucoup parlÃ© de nouvelles techniques et de modularisation.
Cela peut sembler rebutant, notamment par l&#8217;introduction d&#8217;outils auxquels
nous ne sommes pas encore familiers.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;Ã©cosystÃ¨me Node fournit Ã©normÃ©ment d&#8217;outils qui devraient nous faire
gagner du temps, en nous aidant Ã  organiser notre travail ou Ã  exÃ©cuter des actions
lorsqu&#8217;un fichier est modifiÃ©, mais aussi en actualisant automatiquement
notre application web au fil du dÃ©veloppement
(fini les appuis rÃ©pÃ©tÃ©s sur la touche&#160;<text:span text:style-name="Menu">[F5]</text:span>) ou encore en
optimisant nos fichiers graphiques.</text:p>
<text:bookmark text:name="ref-watchify" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Reconstruire en continu avec <text:span text:style-name="">watchify</text:span></text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;utilisation de <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-browserify"  text:visited-style-name="Visited_20_Internet_20_Link">browserify</text:a> nous apporte du confort avec la
possibilitÃ© d&#8217;inclure des modules&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> dans les navigateurs.
En revanche, cela nous demande de gÃ©nÃ©rer des artefacts&#160;â€“ des <text:span text:style-name="T4">bundles</text:span>&#160;â€“ Ã 
chaque modification pour consolider ces changements.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">C&#8217;est Ã  ce moment qu&#8217;intervient le module <text:span text:style-name="T4">watchify</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/watchify" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/watchify</text:a></text:span>).
Il fonctionne exactement comme <text:span text:style-name="T4">browserify</text:span>, mais au lieu de compiler une seule
fois, il compile dÃ¨s qu&#8217;un changement est dÃ©tectÃ©&#160;â€“ oÃ¹ que ce soit dans l&#8217;arbre
de dÃ©pendances du point d&#8217;entrÃ©e (paramÃ¨tre&#160;<text:span text:style-name="CodeDansTexte">-e</text:span>, <text:span text:style-name="CodeDansTexte">--entrypoint</text:span>).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La commande suivante compilerait le fichier <text:span text:style-name="CodeDansTexte">examples/modules/react-app.js</text:span>
une seule fois&#160;:</text:p>
<text:p text:style-name="Code">$ ./node_modules/.bin/browserify -t babelify \</text:p><text:p text:style-name="Code"><text:s text:c="2"/>-e examples/modules/react-app.js \</text:p><text:p text:style-name="Code"><text:s text:c="2"/>-o examples/modules/react-app-browserify.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il suffit de remplacer <text:span text:style-name="CodeDansTexte">browserify</text:span> par <text:span text:style-name="CodeDansTexte">watchify</text:span>&#160;â€“ le programme garde la main
et indique chaque nouvelle compilation sur une nouvelle ligne.</text:p>
<text:p text:style-name="Code">$ ./node_modules/.bin/watchify -dv -t babelify \</text:p><text:p text:style-name="Code"><text:s text:c="2"/>-e examples/modules/react-app.js \</text:p><text:p text:style-name="Code"><text:s text:c="2"/>-o examples/modules/react-app-browserify.js</text:p><text:p text:style-name="Code">1840601 bytes written to react-app-browserify.js (2.58 seconds) at 4:44:28 PM</text:p><text:p text:style-name="Code">352482 bytes written to react-app-browserify.js (0.10 seconds) at 4:45:09 PM</text:p><text:p text:style-name="Code">1840605 bytes written to react-app-browserify.js (0.25 seconds) at 4:45:15 PM</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">watchify</text:span> utilise un mÃ©canisme dit de <text:span text:style-name="T7">compilation incrÃ©mentale</text:span>&#160;: il ne
recompile pas tout, mais uniquement les diffÃ©rences depuis le dernier changement.
C&#8217;est beaucoup plus rapide et tout aussi efficace.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Trois arguments sont utiles Ã  <text:span text:style-name="T4">watchify</text:span>&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="CodeDansTexte">-v</text:span>&#160;(<text:span text:style-name="CodeDansTexte">--verbose</text:span>)&#160;: force la crÃ©ation du fichier compilÃ© au lancement de la commande.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="CodeDansTexte">-o</text:span>&#160;(<text:span text:style-name="CodeDansTexte">--outfile</text:span>)&#160;: spÃ©cifie le chemin d&#8217;enregistrement du fichier compilÃ©&#160;â€“ il est impossible d&#8217;utiliser la <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-stdio"  text:visited-style-name="Visited_20_Internet_20_Link">sortie standard</text:a> (<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-04"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;4</text:a>).</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="CodeDansTexte">-d</text:span>&#160;(<text:span text:style-name="CodeDansTexte">--debug</text:span>)&#160;: (lire <text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-browserify-sourcemaps"  text:visited-style-name="Visited_20_Internet_20_Link">Les source&#160;maps</text:a></text:span> dans ce mÃªme chapitre).</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-livereload" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Changements en temps&#160;rÃ©el dans le navigateur</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Modifier un fichier. Changer de fenÃªtre. Recharger. Changer de fenÃªtre. Re-modifier
un fichier. Changer de fenÃªtre. Recharger. LÃ  c&#8217;est bon.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La quantitÃ© d&#8217;outils Ã  disposition et leurs diffÃ©rentes opinions sur notre maniÃ¨re
de travailler nous obligent Ã  prendre des postures de travail qui ne vont
pas nÃ©cessairement dans le sens de la productivitÃ©.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;intÃ©gration de Node avec le systÃ¨me d&#8217;exploitation va nous aider Ã  dÃ©clencher
des actions lorsque des fichiers sont modifiÃ©s.
Ces modifications sont parfois de notre fait, directement ou par le biais d&#8217;un
autre logiciel (un optimiseur d&#8217;images ou la <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-node-sass"  text:visited-style-name="Visited_20_Internet_20_Link">compilation d&#8217;un fichier Sass</text:a> par exemple).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous allons explorer deux stratÃ©gies d&#8217;actualisation&#160;: le rafraÃ®chissement
automatique du navigateur et le remplacement de modules Ã  chaud
(<text:span text:style-name="T4">Hot Module Replacement</text:span>, HMR).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">browser-sync</text:span> est un outil formidable de dÃ©veloppement pour
rafraÃ®chir automatiquement une page web si son contenu ou une des ressources
associÃ©es change.
Il offre Ã©galement la possibilitÃ© de propager les changements sur plusieurs
fenÃªtres et terminaux&#160;â€“ y compris les clics, dÃ©filements et toute interaction
avec des formulaires.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">browser-sync</text:span> maintient la position du curseur de dÃ©filement lors d&#8217;un rechargement de contenu.
L&#8217;outil se lance soit de maniÃ¨re autonome, soit en <text:span text:style-name="T4">proxy</text:span> entre l&#8217;utilisateur
et tout autre serveur web.
Il ne nÃ©cessite pas non plus de plug-in ou d&#8217;extension navigateur pour fonctionner,
ce qui le rend idÃ©al pour du prototypage, de la recherche utilisateur ou du
dÃ©veloppement local.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">Lancement d&#8217;un serveur web autonome avec synchronisation sur le port&#160;4000</text:p><text:p text:style-name="Code">$ ./node_modules/.bin/browser-sync start --server --port 4000 .</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exemple suivant illustre l&#8217;intÃ©gration de <text:span text:style-name="T4">browser-sync</text:span> avec le serveur
web exposant les exemples de ce chapitre (voir le dÃ©tail dans le fichier <text:span text:style-name="CodeDansTexte">server.js</text:span>)&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">livereload/server-sync.js</text:p><text:p text:style-name="Code">const browserSync = require('browser-sync');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">module.exports = (server) =&gt; {<text:s text:c="13"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>return port =&gt; {<text:s text:c="25"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>const PUBLIC_PORT = 4000;<text:s text:c="14"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>const bs = browserSync.create();</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="4"/>server.listen(port);<text:s text:c="19"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="4"/>bs.init({<text:s text:c="30"/><text:span text:style-name="PuceCode">5</text:span></text:p><text:p text:style-name="Code"><text:s text:c="6"/>files: ['./examples'],</text:p><text:p text:style-name="Code"><text:s text:c="6"/>port: PUBLIC_PORT,</text:p><text:p text:style-name="Code"><text:s text:c="6"/>open: false,</text:p><text:p text:style-name="Code"><text:s text:c="6"/>logPrefix: 'nodebook',</text:p><text:p text:style-name="Code"><text:s text:c="6"/>proxy: {</text:p><text:p text:style-name="Code"><text:s text:c="8"/>target: `http://localhost:${port}`,<text:span text:style-name="PuceCode">6</text:span></text:p><text:p text:style-name="Code"><text:s text:c="8"/>ws: true,</text:p><text:p text:style-name="Code"><text:s text:c="6"/>}</text:p><text:p text:style-name="Code"><text:s text:c="4"/>});</text:p><text:p text:style-name="Code"><text:s text:c="2"/>};</text:p><text:p text:style-name="Code">};</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> On passe un serveur&#160;HTTP en argument (obtenu via <text:span text:style-name="CodeDansTexte">http.createServer()</text:span> par exemple).<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Ce port sera affectÃ© au serveur web mais ne sera pas vouÃ© Ã  Ãªtre public.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Ce port, lui, sera public.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> DÃ©marrage du serveur web sur le port privÃ©.<text:line-break/><text:span text:style-name="PuceCode">5</text:span> Initialisation de <text:span text:style-name="T4">browser-sync</text:span>.<text:line-break/><text:span text:style-name="PuceCode">6</text:span> InterfaÃ§age avec le serveur web crÃ©Ã© au point&#160;4.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La synchronisation peut Ãªtre activÃ©e avec tous les exemples du chapitre en
suffixant la commande <text:span text:style-name="CodeDansTexte">npm start</text:span>&#160;:</text:p>
<text:p text:style-name="Code">$ cd $(nodebook dir chapter-09)</text:p><text:p text:style-name="Code">$ npm start -- --with-sync</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> <text:span text:style-name="T4">browser-sync</text:span></text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque"><text:span text:style-name="T4">browser-sync</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://browsersync.io" text:visited-style-name="Visited_20_Internet_20_Link">https://browsersync.io</text:a></text:span>) est richement documentÃ© et
illustrÃ©, y&#160;compris ses intÃ©grations avec les outils Gulp et Grunt.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">browser-sync</text:span> a beau maintenir la position du dÃ©filement, il n&#8217;en reste pas
moins que chaque changement remet Ã  zÃ©ro l&#8217;espace mÃ©moire de la page.
C&#8217;est lÃ  qu&#8217;entre en jeu le remplacement des modules Ã  chaud.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le <text:span text:style-name="T7">remplacement des modules Ã  chaud</text:span> (<text:span text:style-name="T4">Hot Module Replacement</text:span> ou HMR) est
une technique basÃ©e sur le remplacement de fonctions ou d&#8217;objets tout en assurant
le maintien de leurs variables ou Ã©tats internes.
Cette technique a notamment Ã©tÃ© popularisÃ©e par la combinaison de la bibliothÃ¨que
<text:span text:style-name="T4">React</text:span> et de l&#8217;outil d&#8217;assemblage <text:span text:style-name="T4">Webpack</text:span>.
Il est toutefois possible de procÃ©der Ã  du remplacement Ã  chaud sans <text:span text:style-name="T4">React</text:span>
et sans <text:span text:style-name="T4">Webpack</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Quatre actions sont effectuÃ©es&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">Un serveur de remplacement Ã  chaud est dÃ©marrÃ© localement.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">L&#8217;outil d&#8217;assemblage (<text:span text:style-name="T4">browserify</text:span>, <text:span text:style-name="T4">Webpack</text:span>, etc.) insÃ¨re du code client
pour Ã©tablir un lien entre la page web et le serveur de remplacement Ã  chaud.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">L&#8217;outil d&#8217;assemblage dÃ©clare les fichiers modifiÃ©s, transmis par le serveur
de remplacement Ã  chaud vers le navigateur.</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Le code client remplace les modules et maintient leur Ã©tat interne.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le plug-in <text:span text:style-name="T4">Browserify</text:span> nommÃ© <text:span text:style-name="T4">livereactload</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/livereactload" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/livereactload</text:a></text:span>)
est trÃ¨s certainement le plus facile Ã  mettre en place pour remplacer des
modules <text:span text:style-name="T4">React</text:span> Ã  la volÃ©e.
Il nÃ©cessite une ligne de configuration cÃ´tÃ© <text:span text:style-name="T4">browserify</text:span> mais aucun
changement de code cÃ´tÃ© client.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> livereactload</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Des aides Ã  l&#8217;installation du module <text:span text:style-name="T4">livereactload</text:span> sont disponibles dans
son fichier README.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le remplacement Ã  chaud n&#8217;est possible que lorsque nous sommes dans un Ã©tat
de reconstruction en continu, par exemple avec <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-watchify"  text:visited-style-name="Visited_20_Internet_20_Link">watchify</text:a>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous pouvons constater les effets du remplacement Ã  chaud avec un des exemples
de ce chapitre, accessible sur <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://localhost:4000/examples/livereload/react-app-hmr.html" text:visited-style-name="Visited_20_Internet_20_Link">http://localhost:4000/examples/livereload/react-app-hmr.html</text:a></text:span>.
La commande <text:span text:style-name="CodeDansTexte">npm run watch</text:span> de ce chapitre dÃ©marre un serveur web et reconstruit
en continu le fichier <text:span text:style-name="CodeDansTexte">./examples/livereload/react-app-hmr.js</text:span>&#160;:</text:p>
<text:p text:style-name="Code">$ cd $(nodebook dir chapter-09)</text:p><text:p text:style-name="Code">$ npm run watch</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Qui n&#8217;est autre qu&#8217;un Ã©quivalent de&#160;:</text:p>
<text:p text:style-name="Code">$ ./node_modules/.bin/watchify -dv \</text:p><text:p text:style-name="Code"><text:s text:c="2"/>-t babelify \</text:p><text:p text:style-name="Code"><text:s text:c="2"/>-p livereactload \</text:p><text:p text:style-name="Code"><text:s text:c="2"/>-e ./examples/livereload/react-app-hmr.js \</text:p><text:p text:style-name="Code"><text:s text:c="2"/>-o ./examples/livereload/react-app-hmr-browserify.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Dans cet exemple, le <text:span text:style-name="T4">transform</text:span>&#160;(<text:span text:style-name="CodeDansTexte">-t</text:span>) modifie le code source Ã  la volÃ©e&#160;â€“
ici, pour adapter le code Ã©crit dans une syntaxe comprÃ©hensible par la majoritÃ©
des navigateurs grÃ¢ce Ã  l&#8217;outil <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-transpilation"  text:visited-style-name="Visited_20_Internet_20_Link">Babel</text:a>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le plug-in &#160;(<text:span text:style-name="CodeDansTexte">-p</text:span>) ne transforme pas le code mais le fonctionnement de
<text:span text:style-name="T4">watchify</text:span> pour y ajouter des fonctionnalitÃ©s&#160;â€“ ici, reflÃ©ter les
changements du fichier source vers le navigateur en temps rÃ©el.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il faudra ensuite modifier l&#8217;un des deux fichiers suivants&#160;â€“ en dÃ©commentant les lignes concernÃ©es par exemple&#160;â€“ pour constater les changements dans notre navigateur.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">livereload/react-app-hmr.js</text:p><text:p text:style-name="Code">import { createElement } from 'react';</text:p><text:p text:style-name="Code">import ReactDOM from 'react-dom';</text:p><text:p text:style-name="Code">import ButtonCount from './button-count.jsx';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">ReactDOM.render(</text:p><text:p text:style-name="Code"><text:s text:c="2"/>createElement('div', {}, [</text:p><text:p text:style-name="Code"><text:s text:c="4"/>createElement(ButtonCount),</text:p><text:p text:style-name="Code"><text:s text:c="4"/>createElement(ButtonCount),</text:p><text:p text:style-name="Code"><text:s text:c="4"/>// createElement(ButtonCount),</text:p><text:p text:style-name="Code"><text:s text:c="2"/>]),</text:p><text:p text:style-name="Code"><text:s text:c="2"/>document.querySelector('#app')</text:p><text:p text:style-name="Code">);</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Chaque instance du composant <text:span text:style-name="CodeDansTexte">livereload/button-count.jsx</text:span> gÃ¨re un Ã©tat interne
indÃ©pendant des autres instances de mÃªme type.
Nous aurions perdu cet Ã©tat interne en cas d&#8217;utilisation de <text:span text:style-name="T4">browser-sync</text:span>, sans
remplacement Ã  chaud&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">livereload/button-count.jsx</text:p><text:p text:style-name="Code">import React, { Component } from 'react';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">export default class ButtonCount extends Component {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>constructor(props) {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>super(props);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="4"/>this.handleClick = this.handleClick.bind(this);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="4"/>this.state = {</text:p><text:p text:style-name="Code"><text:s text:c="6"/>clickCount: 0<text:s text:c="43"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>};</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>handleClick () {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>this.setState({ clickCount: this.state.clickCount + 1 }); <text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>render() {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>let style = {};</text:p><text:p text:style-name="Code"><text:s text:c="4"/>// style = {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>//<text:s text:c="3"/>fontFamily: 'monospace',</text:p><text:p text:style-name="Code"><text:s text:c="4"/>//<text:s text:c="3"/>fontWeight: 'bold',</text:p><text:p text:style-name="Code"><text:s text:c="4"/>//<text:s text:c="3"/>textTransform:' uppercase',</text:p><text:p text:style-name="Code"><text:s text:c="4"/>// };</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="4"/>return (&lt;button style={style} onClick={this.handleClick}&gt;</text:p><text:p text:style-name="Code"><text:s text:c="6"/>Clics : {this.state.clickCount}</text:p><text:p text:style-name="Code"><text:s text:c="4"/>&lt;/button&gt;);</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">}</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Initialisation du compteur de clics propre Ã  chaque instance de <text:span text:style-name="CodeDansTexte">ButtonCount</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> IncrÃ©mentation du compteur de clics en rÃ©action Ã  un clic sur le composant <text:span text:style-name="CodeDansTexte">ButtonCount</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Alternative</text:span> ud et browserify-hmr</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Deux modules vont nous aider&#160;: <text:span text:style-name="T4">ud</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/ud" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/ud</text:a></text:span>)
et <text:span text:style-name="T4">browserify-hmr</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/browserify-hmr" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/browserify-hmr</text:a></text:span>), respectivement pour
dÃ©clarer des modules remplaÃ§ables et pour dÃ©marrer un serveur de remplacement
Ã  chaud minimaliste.</text:p>
<text:bookmark text:name="ref-node-sass" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Modulariser ses feuilles de styles avec&#160;Sass</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La modularitÃ© et l&#8217;Ã©criture d&#8217;un code isolÃ© facilitent sa rÃ©utilisation et
prÃ©viennent les effets de bord.
Dans le cas des feuilles de styles CSS, cela peut Ã©viter de faire
dÃ©border la cascade&#160;â€“ si l&#8217;on peut&#160;dire.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Avec le langage Sass (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://sass-lang.com" text:visited-style-name="Visited_20_Internet_20_Link">http://sass-lang.com</text:a></text:span>), nous pourrions songer Ã 
gÃ©nÃ©rer des blocs de code selon des listes (idÃ©al pour des thÃ¨mes de couleurs,
des rubriques produits, etc.), Ã  concevoir des composants comme des fonctions
ou Ã  bÃ©nÃ©ficier de fonctions de calcul de couleurs ou d&#8217;unitÃ©s de mesure.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le langage Sass est originaire du monde Ruby, mais il a Ã©tÃ© depuis rendu
accessible nativement Ã  l&#8217;Ã©cosystÃ¨me Node par le biais de <text:span text:style-name="T4">node-sass</text:span>
(<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/node-sass" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/node-sass</text:a></text:span>)â€“ et, par extension,
par la bibliothÃ¨que&#160;C <text:span text:style-name="T4">libsass</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Lecture</text:span> CSS maintenables avec Sass et Compass</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Je recommande la lecture de l&#8217;ouvrage de rÃ©fÃ©rence
<text:span text:style-name="T4">CSS&#160;maintenables avec Sass et Compass</text:span>,
Ã©crit par Kaelig&#160;Deloumeau-Prigent aux Ã©ditions Eyrolles.</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://editions-eyrolles.com/Livre/9782212136401" text:visited-style-name="Visited_20_Internet_20_Link">https://editions-eyrolles.com/Livre/9782212136401</text:a></text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Il dÃ©crit trÃ¨s bien les tenants et aboutissants de Sass, ainsi que de bonnes
mÃ©thodes d&#8217;organisation du code et de maintenabilitÃ© au sein d&#8217;une Ã©quipe de
travail.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">node-sass</text:span> offre un outil en ligne de commande pour compiler un fichier Sass,
plusieurs fichiers Sass ou encore une arborescence de rÃ©pertoires contenant des
fichiers Sass vers des fichiers CSS comprÃ©hensibles par les navigateurs.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">ui/buttons.scss</text:p><text:p text:style-name="Code">$sizes: (<text:s text:c="29"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>small: .8,</text:p><text:p text:style-name="Code"><text:s text:c="2"/>regular: 1,</text:p><text:p text:style-name="Code"><text:s text:c="2"/>large: 1.2</text:p><text:p text:style-name="Code">);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">.btn {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>@each $size, $factor in $sizes {<text:s text:c="4"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>&amp;.btn--#{$size} {<text:s text:c="17"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="6"/>font-size: $factor * 1em;<text:s text:c="7"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>}</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>&amp;.btn--icon {<text:s text:c="23"/><text:span text:style-name="PuceCode">5</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>svg {</text:p><text:p text:style-name="Code"><text:s text:c="6"/>height: 16px;</text:p><text:p text:style-name="Code"><text:s text:c="6"/>width: 16px;</text:p><text:p text:style-name="Code"><text:s text:c="6"/>margin-right: .5em;</text:p><text:p text:style-name="Code"><text:s text:c="4"/>}</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">}</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> DÃ©finition d&#8217;une <text:span text:style-name="CodeDansTexte">Map</text:span> nommÃ©e <text:span text:style-name="CodeDansTexte">$sizes</text:span> (ensemble clÃ©/valeur) dÃ©crivant des tailles et leur facteur multiplicateur.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> ItÃ©ration et extraction des clÃ©s/valeurs de <text:span text:style-name="CodeDansTexte">$sizes</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Interpolation d&#8217;une variable pour composer un sÃ©lecteur CSS (<text:span text:style-name="CodeDansTexte">.btn&#8212;&#8203;small</text:span>, <text:span text:style-name="CodeDansTexte">.btn&#8212;&#8203;regular</text:span> etc.).<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Calcul de la taille de la police de caractÃ¨res (<text:span text:style-name="CodeDansTexte">.8em</text:span>, <text:span text:style-name="CodeDansTexte">1em</text:span>, etc.).<text:line-break/><text:span text:style-name="PuceCode">5</text:span> Composition d&#8217;un sÃ©lecteur de classe Ã  partir du sÃ©lecteur courant (<text:span text:style-name="CodeDansTexte">.btn.btn&#8212;&#8203;icon</text:span>).<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La compilation des fichiers s&#8217;effectue trÃ¨s simplement&#160;:</text:p>
<text:p text:style-name="Code">$ ./node_modules/.bin/node-sass -o ./examples ./examples/buttons.scss</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Elle produit le fichier CSS <text:span text:style-name="CodeDansTexte">button.css</text:span>, lisible par tout navigateur&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">ui/buttons.css</text:p><text:p text:style-name="Code">.btn.btn--small {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>font-size: 0.8em; }</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">.btn.btn--regular {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>font-size: 1em; }</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">.btn.btn--large {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>font-size: 1.2em; }</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">.btn.btn--icon svg {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>height: 16px;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>width: 16px;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>margin-right: .5em; }</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Astuce</text:span> Oublions les vendor prefix</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Les navigateurs Ã©voluent plus vite que le cycle de vie de nos projets.
Certaines propriÃ©tÃ©s CSS sont abritÃ©es derriÃ¨re des prÃ©fixes (<text:span text:style-name="CodeDansTexte">-moz</text:span>, <text:span text:style-name="CodeDansTexte">-webkit</text:span>,
etc.) avant d&#8217;Ãªtre standardisÃ©es.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Les modules <text:span text:style-name="T4">autoprefixer</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/autoprefixer" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/autoprefixer</text:a></text:span>) et
<text:span text:style-name="T4">postcss</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/postcss" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/postcss</text:a></text:span>) nous facilitent la tÃ¢che en prÃ©fixant
et rÃ©Ã©crivant automatiquement les attributs en fonction de nos exigences de
compatibilitÃ© avec les navigateurs.</text:p>
<text:bookmark text:name="ref-ui-bundling" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Lier composants visuels et feuilles de&#160;styles</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Souvenons-nous de la section expliquant le
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-react"  text:visited-style-name="Visited_20_Internet_20_Link">rapprochement entre donnÃ©es, rendu et interactions avec React</text:a>.
Finalement, nous avons presque tout rapprochÃ©, exception faite de la prÃ©sentation
avec Sass ou CSS.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">En suivant la logique de notre approche modulaire, nous pourrions imaginer
un <text:span text:style-name="T4">transform browserify</text:span> pour compiler et/ou extraire notre code Sass ou
CSS depuis nos modules CommonJS ou ECMAScript.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">C&#8217;est exactement la proposition du module <text:span text:style-name="T4">sassify</text:span>.
Il intÃ¨gre <text:span text:style-name="T4">node-sass</text:span> en tant que <text:span text:style-name="T4">transform browserify</text:span> et transforme le
code Ã  la volÃ©e durant la phase de compilation.
Il se charge lui-mÃªme d&#8217;ajouter les styles dans le document HTML ou expose le
code CSS compilÃ© via la fonction <text:span text:style-name="CodeDansTexte">require()</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Une saine stratÃ©gie serait de charger des CSS de base dans une feuille de styles
en tÃªte de <text:span text:style-name="CodeDansTexte">&lt;head&gt;</text:span> puis de laisser les composants graphiques injecter leurs
feuilles CSS respectives aprÃ¨s coup.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exemple suivant expose deux composants <text:span text:style-name="T4">React</text:span>, regroupÃ©s dans une thÃ©matique
de composants de boutons HTML.
Une feuille de styles est importÃ©e Ã  mÃªme le module afin de gÃ©rer au mÃªme niveau
prÃ©sentation, rendu et interactions&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">ui/Buttons.jsx</text:p><text:p text:style-name="Code">import React from 'react';</text:p><text:p text:style-name="Code">import './buttons.scss';<text:s text:c="10"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const Icon = (props) =&gt; (&lt;svg aria-hidden="true"&gt;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;use xlinkHref={'symbols.svg#' + props.id} /&gt;</text:p><text:p text:style-name="Code">&lt;/svg&gt;);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">export const BaseButton = (props) =&gt; (</text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;button className={'btn btn--' + props.variant}&gt;{props.children}&lt;/button&gt;</text:p><text:p text:style-name="Code">);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">export const IconButton = (props) =&gt; (</text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;button className="btn btn--icon"&gt;</text:p><text:p text:style-name="Code"><text:s text:c="4"/>&lt;Icon id={props.icon} /&gt;</text:p><text:p text:style-name="Code"><text:s text:c="4"/>{props.children}</text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;/button&gt;</text:p><text:p text:style-name="Code">);</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Import d&#8217;un fichier Sass qui sera par la suite compilÃ© en CSS par le <text:span text:style-name="T4">transform sassify</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Sans surprise, le module <text:span text:style-name="T4">sassify</text:span> se charge comme la majoritÃ© des
<text:span text:style-name="T4">transforms browserify</text:span> comme vu dans la section
<text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-browserify"  text:visited-style-name="Visited_20_Internet_20_Link">Importer des modules&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> pour le Web</text:a></text:span> dans ce mÃªme chapitre&#160;:</text:p>
<text:p text:style-name="Code">$ ./node_modules/.bin/browserify \</text:p><text:p text:style-name="Code"><text:s text:c="2"/>-t sassify \</text:p><text:p text:style-name="Code"><text:s text:c="2"/>-t babelify \</text:p><text:p text:style-name="Code"><text:s text:c="2"/>-e ./examples/Buttons.jsx \</text:p><text:p text:style-name="Code"><text:s text:c="2"/>-o ./examples/Button-browserify.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La commande suivante injectera automatiquement les feuilles de style compilÃ©es
dans le document HTML lors de son exÃ©cution dans un navigateur&#160;:</text:p>
<text:p text:style-name="Code">$ ./node_modules/.bin/browserify \</text:p><text:p text:style-name="Code"><text:s text:c="2"/>-t [ sassify --auto-inject ] \</text:p><text:p text:style-name="Code"><text:s text:c="2"/>-t babelify \</text:p><text:p text:style-name="Code"><text:s text:c="2"/>-e ./examples/Buttons.jsx \</text:p><text:p text:style-name="Code"><text:s text:c="2"/>-o ./examples/Button-browserify.js</text:p>
<text:bookmark text:name="ref-optimiser_ses_ressources_graphiques" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Optimiser ses ressources graphiques</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Node est un outil de choix lorsque l&#8217;on souhaite s&#8217;atteler au dÃ©veloppement
<text:span text:style-name="T4">front-end</text:span> et ce n&#8217;est pas sans raison.
Outre l&#8217;outillage liÃ© Ã  la rÃ©Ã©criture du code, il regorge de modules&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>
rÃ©duisant les tÃ¢ches manuelles rÃ©pÃ©titives et possiblement sujettes Ã  erreur.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous retrouvons l&#8217;optimisation des ressources graphiques parmi cet ensemble de
tÃ¢ches rÃ©barbatives.
Quand j&#8217;Ã©cris ressources graphiques, j&#8217;entends par lÃ  le redimensionnement ou
la crÃ©ation de vignettes d&#8217;images, l&#8217;optimisation de leur poids, la fusion de
fichiers&#160;SVG sous forme de symboles, la crÃ©ation de piles de
polices de caractÃ¨res et mÃªme l&#8217;encodage audio/vidÃ©o&#160;â€“ via des logiciels
spÃ©cialisÃ©s comme <text:span text:style-name="T4">FFmpeg</text:span> ou <text:span text:style-name="T4">LAME</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;outil en ligne de commande <text:span text:style-name="T4">imagemin-cli</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/imagemin-cli" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/imagemin-cli</text:a></text:span>)
est le module de rÃ©fÃ©rence pour optimiser les fichiers graphiques.
Il est basÃ© sur la bibliothÃ¨que <text:span text:style-name="T4">imagemin</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/imagemin" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/imagemin</text:a></text:span>) et
se charge de rÃ©duire le poids de nos images JPEG, PNG mais aussi GIF (animÃ©s
et statiques) ainsi que le format vectoriel&#160;SVG.</text:p>
<text:p text:style-name="Code">$ ./node_modules/.bin/imagemin images/* --out-dir images</text:p><text:p text:style-name="Code">8 images minified</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Glossaire</text:span> Compression destructive et non&#160;destructive</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Il existe deux types de compression&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce">destructive&#160;: poids rÃ©duit au maximum, possibles artefacts visuels, destruction
potentielle de couleurs dans le cas d&#8217;images complexes&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="RemarquePuce">sans perte&#160;: poids rÃ©duit, les couleurs supprimÃ©es ne sont pas perceptibles
Ã  l&#8217;Å“il&#160;nu.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Il vaut mieux privilÃ©gier la <text:span text:style-name="T4">compression sans perte</text:span> pour Ã©viter les artefacts
visuels et respecter la crÃ©ation d&#8217;origine.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le redimensionnement d&#8217;images est une autre de ces tÃ¢ches courantes et rÃ©currentes
qui tombe rapidement aux oubliettes de par sa gourmandise en temps.
On voudra par exemple redimensionner des photos depuis des fichiers originaux,
gÃ©nÃ©rer des vignettes ou encore diffÃ©rentes tailles d&#8217;image adaptÃ©es
aux diffÃ©rentes dispositions d&#8217;un site web <text:span text:style-name="T4">responsive</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">sharp-cli</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/sharp-cli" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/sharp-cli</text:a></text:span>) rÃ©pond exactement Ã  ce cahier
des charges.
Ce module en ligne de commande est basÃ© sur <text:span text:style-name="T4">sharp</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/sharp" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/sharp</text:a></text:span>),
une bibliothÃ¨que Node de modification d&#8217;images Ã©crite en ECMAScript et <text:span text:style-name="T4">C&#43;&#43;</text:span>.
<text:span text:style-name="T4">sharp</text:span> nous aidera entre autres Ã  redimensionner, dÃ©couper, retourner, recentrer,
assembler et appliquer des effets graphiques de maniÃ¨re prÃ©dictible.</text:p>
<text:p text:style-name="Code">$ ./node_modules/.bin/sharp resize 500 \</text:p><text:p text:style-name="Code"><text:s text:c="2"/>--min \</text:p><text:p text:style-name="Code"><text:s text:c="2"/>-i images/*.png \</text:p><text:p text:style-name="Code"><text:s text:c="2"/>--output ./images/thumbs</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La commande prÃ©cÃ©dente illustre une opÃ©ration de redimensionnement d&#8217;images&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">d&#8217;une dimension de 500 pixels de largeur&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">minimum, pour respecter les proportions initiales&#160;â€“ sans cet attribut les images seraient des carrÃ©s
de 500 pixels de large et de haut&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">ciblant toutes les images PNG du rÃ©pertoire <text:span text:style-name="CodeDansTexte">images</text:span>&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">puis exportÃ©es dans le rÃ©pertoire <text:span text:style-name="CodeDansTexte">images/thumbs</text:span>.</text:p>
</text:list-item></text:list>
<text:p text:style-name="Code">$ ./node_modules/.bin/sharp grayscale \</text:p><text:p text:style-name="Code"><text:s text:c="2"/>-i images/*.png \</text:p><text:p text:style-name="Code"><text:s text:c="2"/>--output ./images/square</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ã€ l&#8217;inverse, cette commande illustre la conversion en noir et blanc
d&#8217;images ainsi que leur export dans un rÃ©pertoire diffÃ©rent.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;interface en ligne de commande de <text:span text:style-name="T4">sharp-cli</text:span> ne permet pas de crÃ©er
des opÃ©rations composites (redimensionner et convertir en niveaux de gris par exemple).
Il faudra recourir Ã  l&#8217;API Node de <text:span text:style-name="T4">sharp</text:span> et chaÃ®ner les opÃ©rations en
s&#8217;aidant des exemples documentÃ©s sur <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://sharp.dimens.io" text:visited-style-name="Visited_20_Internet_20_Link">http://sharp.dimens.io</text:a></text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Alternative</text:span> gm</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque"><text:span text:style-name="T4">gm</text:span>&#160;(<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/gm" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/gm</text:a></text:span>) est le module classique de
redimensionnement dans l&#8217;Ã©cosystÃ¨me Node.
Il s&#8217;interface avec les programmes <text:span text:style-name="T4">GraphicsMagick</text:span> et <text:span text:style-name="T4">ImageMagick</text:span>&#160;â€“
et nÃ©cessite donc leur prÃ©sence sur le systÃ¨me d&#8217;exploitation.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Cela rend l&#8217;utilisation de <text:span text:style-name="T4">gm</text:span> lÃ©gÃ¨rement moins triviale que celle de <text:span text:style-name="T4">sharp</text:span>
mais la quantitÃ© de ressources et la qualitÃ© du module en font une bonne
alternative Ã  considÃ©rer.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;utilisation d&#8217;un <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-npm-scripts"  text:visited-style-name="Visited_20_Internet_20_Link">script&#160;<text:span text:style-name="CodeDansTexte">npm</text:span></text:a>
(<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-05"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;5</text:a>) est idÃ©ale pour dÃ©crire les
diffÃ©rentes actions d&#8217;optimisation.
Les scripts sont alors Ã  invoquer manuellement, sur un crochet Git
(<text:span text:style-name="T4">git&#160;hook</text:span>) ou automatiquement lors du dÃ©ploiement avec un
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-deploy.ci"  text:visited-style-name="Visited_20_Internet_20_Link">service d&#8217;intÃ©gration continue</text:a>, par
exemple.</text:p>
<text:bookmark text:name="ref-testing" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Tester son code</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">C&#8217;est bien connu&#160;: <text:span text:style-name="">lorsqu&#8217;on produit du code de qualitÃ©, Ã©crire des tests est amplement superflu et ne sert qu&#8217;Ã  nous ralentir</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La rÃ©alitÃ© est tout autre et suit un paradigme trÃ¨s simple&#160;:
<text:span text:style-name="T7">plus il y a de lignes de code, plus il y a de risques de commettre des erreurs</text:span>.
Cela vaut aussi bien pour du HTML que du CSS ou encore de l&#8217;ECMAScript.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette derniÃ¨re section nous aidera Ã  comprendre quoi et comment tester
pour diminuer le coÃ»t de maintenance de nos applications.</text:p>
<text:bookmark text:name="ref-testing-101" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Que tester ?</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;idÃ©e d&#8217;Ã©crire des tests pour amÃ©liorer la qualitÃ© de son code est attrayante,
mais quand on ne sait pas quoi tester et ni Ã  qui demander pour se lancer,
il est Ã©vident qu&#8217;on ne va pas s&#8217;y mettre pour s&#8217;assurer que 1+1 valent bien 2.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Je pense Ã  ces trois rÃ¨gles lorsque je souhaite Ã©crire des tests&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">Qu&#8217;est-ce qui est public/exportÃ©&#160;?</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Qu&#8217;est-ce qui crÃ©e des branches dans mon code&#160;?</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Qu&#8217;est-ce qui vient du monde extÃ©rieur&#160;?</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La syntaxe de modules ECMAScript est idÃ©ale pour visualiser les segments
de code qui sont exportÃ©s par nos diffÃ©rents fichiers.
Ã‰lÃ©ment marquant&#160;: ce code est simple et devrait arriver Ã  compter le nombre
de mots mais nous n&#8217;avons aucune idÃ©e s&#8217;il fera correctement le travail sans
l&#8217;exÃ©cuter dans une application.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">test-export.js</text:p><text:p text:style-name="Code">const isString = (thing) =&gt; typeof thing === 'string';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const isWord = (word) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>return isString(word) &amp;&amp; /^[\w\s.,\-?!;+]{2,}$/.test(word);</text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">export default function countWords (sentence) { <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>return sentence.split(' ').filter(isWord).length;</text:p><text:p text:style-name="Code">}</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> La fonction <text:span text:style-name="CodeDansTexte">countWords</text:span> est le seul Ã©lÃ©ment exportÃ© par notre module et devrait donc Ãªtre le seul sujet de nos&#160;tests.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Une branche est une portion de code qui s&#8217;exÃ©cute de maniÃ¨re ponctuelle.
Ces sections de code s&#8217;activent ou non selon l&#8217;Ã©tat d&#8217;une structure de donnÃ©es.
Il faut prÃ©voir au moins autant de tests que de branches pour valider les
attentes.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">test-branches.js</text:p><text:p text:style-name="Code">export default function isOdd (number) {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>if (!Number.isFinite(number)) {<text:s text:c="21"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>throw new Error('number devrait Ãªtre un nombre');</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>if (number % 2) { <text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>return true;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code"><text:s text:c="2"/>else {<text:s text:c="12"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>return false;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">}</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> PremiÃ¨re branche activÃ©e dans deux cas de figure.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Seconde branche.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> TroisiÃ¨me branche.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Enfin, l&#8217;accÃ¨s Ã  toute donnÃ©e externe est susceptible de mal fonctionner
sans que nous puissions maÃ®triser l&#8217;origine des problÃ¨mes.
En revanche, l&#8217;Ã©criture de tests nous aidera Ã  accepter ce cas de figure et
Ã  le signaler Ã  nos applications.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">test-outside-world.js</text:p><text:p text:style-name="Code">export default function getLinkElementContent (linkElement) {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const {href} = linkElement;<text:s text:c="11"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>return fetch(href)<text:s text:c="20"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>.then(response =&gt; response.json())<text:s text:c="2"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>.then(pkg =&gt; pkg.dependencies);</text:p><text:p text:style-name="Code">}</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> <text:span text:style-name="CodeDansTexte">linkElement</text:span> peut ne pas Ãªtre un lien hypertexte (<text:span text:style-name="CodeDansTexte">document.querySelector</text:span> retourne&#160;<text:span text:style-name="CodeDansTexte">null</text:span>).<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Ici, tout peut arriver&#160;: <text:span text:style-name="CodeDansTexte">href</text:span> n&#8217;est pas une URL valide (balise <text:span text:style-name="CodeDansTexte">href</text:span> vide), serveur indisponible, etc.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Et lÃ , le fichier JSON peut Ãªtre mal formÃ© ou la rÃ©ponse est exprimÃ©e dans un autre format que&#160;JSON.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous savons dÃ©sormais Ã  peu prÃ¨s tout ce qu&#8217;il faut suspecter pour renforcer
nos applications en Ã©crivant quelques tests.</text:p>
<text:bookmark text:name="ref-soutiller_pour_Ã©crire_des_assertions" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">S&#8217;outiller pour Ã©crire des assertions</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Avant de nous lancer directement dans la conception et l&#8217;Ã©criture des tests,
penchons-nous sur la structure de l&#8217;outillage.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Assertion</text:h>
<text:p text:style-name="Remarque">C&#8217;est la vÃ©rification d&#8217;une vÃ©ritÃ©, d&#8217;une attente, du rÃ©sultat d&#8217;une opÃ©ration.
Une assertion couvre une branche de&#160;code.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Test</text:h>
<text:p text:style-name="Remarque">C&#8217;est un regroupement d&#8217;assertions couvrant toutes les branches des
fonctionnalitÃ©s publiques de notre&#160;code.</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">Suite de tests</text:h>
<text:p text:style-name="Remarque">C&#8217;est un ensemble de tests couvrant un aspect logique d&#8217;un code applicatif.
Une application peut comporter plusieurs suites selon sa complexitÃ©&#160;:
tests <text:span text:style-name="T7">unitaires</text:span> (interface de code),
tests <text:span text:style-name="T7">fonctionnels</text:span> (scÃ©narios d&#8217;utilisation d&#8217;une application),
tests d'<text:span text:style-name="T7">intÃ©gration</text:span> (dÃ©pendance vis Ã  vis d&#8217;autres applications et services).</text:p><text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre">ExÃ©cuteur de tests</text:h>
<text:p text:style-name="Remarque">C&#8217;est le logiciel responsable de crÃ©er l&#8217;environnement d&#8217;exÃ©cution d&#8217;une suite de tests.
Il exprime une opinion sur la structuration des tests ainsi que sur des
automatismes Ã  fournir pour accÃ©lÃ©rer l&#8217;Ã©criture des&#160;tests.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;outillage varie selon chacun de ces niveaux.
Certains outils offrent une Ã©criture d&#8217;assertion plus fluide, d&#8217;autres proposent une Ã©criture plus spÃ©cifiquement adaptÃ©e.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les sections suivantes sont complÃ©mentaires.
J&#8217;ai favorisÃ© des approches itÃ©ratives et modulaires pour faciliter l&#8217;ajout ou le retrait de tout outil de notre outillage&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">la bibliothÃ¨que <text:span text:style-name="T4">chai</text:span> pour les assertions&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">la bibliothÃ¨que <text:span text:style-name="T4">mocha</text:span> pour les tests&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">la bibliothÃ¨que <text:span text:style-name="T4">mocha</text:span> pour la suite de tests exÃ©cutable par&#160;Node&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">l&#8217;exÃ©cuteur de tests nommÃ©  <text:span text:style-name="T4">karma</text:span> pour faire fonctionner la suite de tests
dans les navigateurs.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> chai, mocha et karma</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Ces trois bibliothÃ¨ques disposent d&#8217;une documentation en ligne expliquant leurs
options respectives, ainsi que des exemples d&#8217;utilisation.</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="T4">chai</text:span>&#160;: <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://chaijs.com/api/bdd/" text:visited-style-name="Visited_20_Internet_20_Link">http://chaijs.com/api/bdd/</text:a></text:span>&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="T4">mocha</text:span>&#160;: <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://mochajs.org" text:visited-style-name="Visited_20_Internet_20_Link">https://mochajs.org</text:a></text:span>&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="T4">karma</text:span>&#160;: <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://karma-runner.github.io" text:visited-style-name="Visited_20_Internet_20_Link">https://karma-runner.github.io</text:a></text:span>.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">Exemple d&#8217;assertion avec la bibliothÃ¨que&#160;chai</text:p><text:p text:style-name="Code">import {expect} from 'chai';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">expect(2+2).to.equal(4);</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">Exemple de test avec la bibliothÃ¨que mocha</text:p><text:p text:style-name="Code">describe('functionName', () =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>it('should succeed with parameter cheese', () =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>// ...</text:p><text:p text:style-name="Code"><text:s text:c="2"/>});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>it('should throw an error with parameter meat', () =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>// ...</text:p><text:p text:style-name="Code"><text:s text:c="2"/>});</text:p><text:p text:style-name="Code">});</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">Exemple d&#8217;exÃ©cution de suites de tests avec mocha et karma</text:p><text:p text:style-name="Code">$ mocha tests/**/*.js</text:p><text:p text:style-name="Code">$ karma start</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exÃ©cuteur de tests <text:span text:style-name="T4">karma</text:span> se configure par le biais d&#8217;un fichier <text:span text:style-name="CodeDansTexte">karma.conf.js</text:span>.
Nous en trouverons un Ã  la racine du rÃ©pertoire des ressources du
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-04"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;4</text:a>.</text:p>
<text:bookmark text:name="ref-tester_ses_composants_react_sans_navigateur" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Tester ses composants React sans navigateur</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un des points forts de <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-react"  text:visited-style-name="Visited_20_Internet_20_Link">React</text:a> Ã©voquÃ©s dans ce chapitre est la
description de son rendu Ã  mÃªme le composant.
Nous bÃ©nÃ©ficions ainsi du rÃ©sultat final (son HTML par exemple) ainsi que d&#8217;un
arbre reprÃ©sentant une structure de sous-Ã©lÃ©ments et de propriÃ©tÃ©s.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous disposons de deux stratÃ©gies pour tester les diffÃ©rents comportements d&#8217;un
composant <text:span text:style-name="T4">React</text:span>&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">tester le rendu en comparant des chaÃ®nes de caractÃ¨res&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">tester l&#8217;Ã©tat en validant la prÃ©sence d&#8217;attributs ou le dÃ©clenchement de
certaines mÃ©thodes du composant.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La bibliothÃ¨que <text:span text:style-name="T4">Enzyme</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/enzyme" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/enzyme</text:a></text:span>) s&#8217;occupe trÃ¨s bien des
deux, en plus de s&#8217;intÃ©grer avec n&#8217;importe quelle bibliothÃ¨que de tests.
Dans tous les cas, elle nous permettra de monter nos composants, soit de maniÃ¨re
isolÃ©e, soit dans un vÃ©ritable arbre DOM, soit en rendu&#160;HTML.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> Enzyme</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">L&#8217;Ã©quipe d&#8217;Airbnb offre une documentation exhaustive sur <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://airbnb.io/enzyme/" text:visited-style-name="Visited_20_Internet_20_Link">http://airbnb.io/enzyme/</text:a></text:span>.
J&#8217;ai beaucoup apprÃ©ciÃ© les exemples complets d&#8217;intÃ©gration avec
<text:span text:style-name="T4">mocha</text:span>, <text:span text:style-name="T4">webpack</text:span> et&#160;<text:span text:style-name="T4">tape</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous allons nous baser sur le composant crÃ©Ã© dans la section
<text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-react"  text:visited-style-name="Visited_20_Internet_20_Link">Rapprocher donnÃ©es, rendu et interactions avec React</text:a></text:span> pour s&#8217;assurer
de son comportement avant mÃªme de l&#8217;inclure dans notre application.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">tests/date-interval.js (configuration)</text:p><text:p text:style-name="Code">import { createElement } from 'react';</text:p><text:p text:style-name="Code">import { expect } from 'chai';</text:p><text:p text:style-name="Code">import { shallow } from 'enzyme';</text:p><text:p text:style-name="Code">import DateInterval from '../modules/date-interval.jsx';<text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">describe('&lt;DateInterval /&gt;', () =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>// ... (tests)</text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Import du module <text:span text:style-name="CodeDansTexte">DateInterval</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Notre premier test consiste Ã  vÃ©rifier que notre composant React gÃ©nÃ¨re
bien une balise <text:span text:style-name="CodeDansTexte">&lt;time&gt;</text:span> en sortie.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">tests/date-interval.js (tests)</text:p><text:p text:style-name="Code">// (configuration)</text:p><text:p text:style-name="Code">describe('&lt;DateInterval /&gt;', () =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const element = createElement(DateInterval);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>it('affiche un Ã©lÃ©ment &lt;time&gt;', () =&gt; {<text:s text:c="15"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>const component = shallow(element);<text:s text:c="17"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="4"/>expect(component.find('time')).to.have.length(1);<text:s text:c="3"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>});</text:p><text:p text:style-name="Code"><text:s text:c="2"/>// ...</text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> CrÃ©ation d&#8217;un test destinÃ© Ã  vÃ©rifier la nature de la balise HTML Ã  gÃ©nÃ©rer.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> CrÃ©ation du composant isolÃ© (<text:span text:style-name="T4">shallow</text:span>)&#160;â€“ aucun Ã©lÃ©ment DOM ne sera crÃ©Ã© ni insÃ©rÃ© dans le document.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> On Ã©crit une assertion garantissant que l&#8217;on retourne un Ã©lÃ©ment <text:span text:style-name="CodeDansTexte">&lt;time&gt;</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le deuxiÃ¨me aspect Ã  tester concerne les donnÃ©es du composant, et leur effet
sur la valeur de classe de l&#8217;Ã©lÃ©ment HTML gÃ©nÃ©rÃ© en sortie.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">tests/date-interval.js (tests, suite)</text:p><text:p text:style-name="Code">// (configuration)</text:p><text:p text:style-name="Code">describe('&lt;DateInterval /&gt;', () =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const element = createElement(DateInterval);</text:p><text:p text:style-name="Code"><text:s text:c="2"/>// ...</text:p><text:p text:style-name="Code"><text:s text:c="2"/>it('la propriÃ©tÃ© tickDate influence la classe HTML', () =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>const OK_CLASS = ['pair', 'impair'];</text:p><text:p text:style-name="Code"><text:s text:c="4"/>const component = shallow(element);<text:s text:c="17"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>const {tickData} = component.state();<text:s text:c="15"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="4"/>const time = tickData.now.getTime();</text:p><text:p text:style-name="Code"><text:s text:c="4"/>expect(time).to.be.closeTo(Date.now(), 3);<text:s text:c="10"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>expect(tickData.className).to.be.oneOf(OK_CLASS);<text:s text:c="3"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>});</text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> CrÃ©ation d&#8217;un second composant isolÃ© dont l&#8217;Ã©tat est indÃ©pendant du premier.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> RÃ©cupÃ©ration de l&#8217;Ã©tat (<text:span text:style-name="T4">state</text:span>) du composant.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Assertion vÃ©rifiant que la date utilisÃ©e par le composant est proche de la date courante (Ã  quelques millisecondes&#160;prÃ¨s).<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Assertion vÃ©rifiant qu&#8217;une propriÃ©tÃ© de l&#8217;Ã©tat ne peut Ãªtre qu&#8217;une des deux valeurs parmi <text:span text:style-name="CodeDansTexte">pair</text:span> et <text:span text:style-name="CodeDansTexte">impair</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">En complÃ©ment, la bibliothÃ¨que <text:span text:style-name="T4">chai-enzyme</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/chai-enzyme" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/chai-enzyme</text:a></text:span>)
Ã©tend le vocabulaire de <text:span text:style-name="T4">chai</text:span> pour ajouter des assertions de composants.
C&#8217;est une question de goÃ»t plus qu&#8217;une nÃ©cessitÃ©.<text:line-break/>L&#8217;exemple suivant reprend le composant crÃ©Ã© dans la section
<text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-livereload"  text:visited-style-name="Visited_20_Internet_20_Link">Changements en temps&#160;rÃ©el dans le navigateur</text:a></text:span> et illustre une
assertion suite Ã  un clic sur le bouton&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">tests/button-count.js</text:p><text:p text:style-name="Code">import React from 'react';</text:p><text:p text:style-name="Code">import chai, { expect } from 'chai';</text:p><text:p text:style-name="Code">import chaiEnzyme from 'chai-enzyme';</text:p><text:p text:style-name="Code">import { shallow } from 'enzyme';</text:p><text:p text:style-name="Code">import ButtonCount from '../livereload/button-count.jsx';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">chai.use(chaiEnzyme());</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">describe('&lt;ButtonCount /&gt;', () =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>it('should increment state on click', () =&gt; {<text:s text:c="7"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>const component = shallow(&lt;ButtonCount /&gt;);</text:p><text:p text:style-name="Code"><text:s text:c="4"/>component.simulate('click');<text:s text:c="22"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="4"/>expect(component).to.have.state('clickCount', 1); <text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>});</text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Le libellÃ© du test dÃ©crit le rÃ©sultat attendu dans les assertions.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Simulation du clic sur le composant.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> L&#8217;Ã©tat interne a bien Ã©tÃ© changÃ© et correspond Ã  la valeur attendue.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le fichier <text:span text:style-name="CodeDansTexte">package.json</text:span> des ressources de ce chapitre
contient une tÃ¢che exÃ©cutant les tests exÃ©cutables dans un environnement Node uniquement.
Elle se lance de la maniÃ¨re suivante&#160;:</text:p>
<text:p text:style-name="Code">$ npm run test:node</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-09/images/mocha-react.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>9-undefined.</text:span> Extrait de la sortie de la commande npm&#160;run&#160;test:node</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Alternative</text:span> jest</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque"><text:span text:style-name="T4">jest</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/jest" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/jest</text:a></text:span>) est un exÃ©cuteur de tests moderne et
rapide particuliÃ¨rement adaptÃ© au test de composants cÃ´tÃ© serveur.
Au moment d&#8217;Ã©crire cet ouvrage, il n&#8217;Ã©tait pas encore possible de l&#8217;exÃ©cuter
dans un navigateur.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il est intÃ©ressant de retenir que les tests navigateurs ne sont pas indispensables
pour s&#8217;assurer du bon fonctionnement de nos composants.
Des bibliothÃ¨ques comme <text:span text:style-name="T4">React</text:span> sont dÃ©jÃ  solidement testÃ©es.
Cela nous laisse l&#8217;opportunitÃ© de nous concentrer uniquement sur notre logique mÃ©tier.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les tests navigateurs sont en revanche utiles pour tester la compatibilitÃ©
navigateurs, que ce soit au niveau de la syntaxe ECMAScript ou du rendu&#160;CSS.</text:p>
<text:bookmark text:name="ref-tester_code_et_composants_dans_les_navigateurs" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">Tester code et composants dans les navigateurs</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">C&#8217;est bien beau de tester uniquement l&#8217;interface de composants <text:span text:style-name="T4">React</text:span>
(ou autre technologie) mais comment faire lorsqu&#8217;on a besoin de tester avec un
vrai DOM ou dans plusieurs navigateurs&#160;?</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il est nÃ©cessaire d&#8217;effectuer des tests dans des navigateurs pour&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">s&#8217;assurer de la compatibilitÃ© de notre code avec les variations d&#8217;implÃ©mentation de navigateurs&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">valider notre choix de <text:span text:style-name="T4">polyfills</text:span>&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">tester fidÃ¨lement contre des API de navigateurs ou du DOM (comme <text:span text:style-name="T4">Web&#160;Audio</text:span> ou
<text:span text:style-name="T4">Service&#160;Workers</text:span>).</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Autrement dit, nous avons besoin d&#8217;un exÃ©cuteur de tests qui les fasse fonctionner
dans l&#8217;environnement d&#8217;un navigateur.
IdÃ©alement, nous voulons que cet exÃ©cuteur de tests n&#8217;influe pas sur l&#8217;outillage
employÃ© pour Ã©crire nos tests et donc nous permette d&#8217;utiliser <text:span text:style-name="T4">mocha</text:span> et <text:span text:style-name="T4">chai</text:span>
comme dans la section prÃ©cÃ©dente.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">karma</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/karma" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/karma</text:a></text:span>) est l&#8217;outil phare de l&#8217;Ã©cosystÃ¨me
Node dÃ©diÃ© aux tests dans les navigateurs.
Il a Ã©tÃ© crÃ©Ã© en&#160;2012 pour faciliter l&#8217;exÃ©cution des suites de tests de la
bibliothÃ¨que <text:span text:style-name="T4">Angular</text:span> et s&#8217;exÃ©cute en ligne de commandes.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les fonctionnalitÃ©s de <text:span text:style-name="T4">karma</text:span> s&#8217;Ã©tendent Ã  l&#8217;aide de modules&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">intÃ©grations avec des suites de tests&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">lanceurs de navigateurs&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">prÃ©processeurs pour transformer des fichiers, les servir et/ou les inclure
dans l&#8217;environnement de tests.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le pilotage de <text:span text:style-name="T4">karma</text:span> se fait via un fichier de configuration <text:span text:style-name="CodeDansTexte">karma.conf.js</text:span>.
Il est possible de surcharger ultÃ©rieurement cette configuration avec des
arguments de la ligne de commandes.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">Initialisation automatique d&#8217;un fichier de configuration <text:span text:style-name="CodeDansTexte">karma.conf.js</text:span></text:p><text:p text:style-name="Code">$ ./node_modules/.bin/karma init</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">karma</text:span> fonctionne avec des navigateurs installÃ©s sur notre machine de
dÃ©veloppement tout comme avec des services distants comme <text:span text:style-name="T4">SauceLabs</text:span> ou
<text:span text:style-name="T4">BrowserStack</text:span> (voir <text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-ci"  text:visited-style-name="Visited_20_Internet_20_Link">IntÃ©gration continue et compatibilitÃ© navigateurs</text:a></text:span>).
Les navigateurs doivent dÃ©jÃ  Ãªtre disponibles sur la machine de test (Firefox
et Chrome par exemple) et nous devons en parallÃ¨le installer les lanceurs
(<text:span text:style-name="CodeDansTexte">karma-firefox-launcher</text:span> et <text:span text:style-name="CodeDansTexte">karma-chrome-launcher</text:span> respectivement).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les navigateurs lancÃ©s par dÃ©faut lors des tests sont listÃ©s dans l&#8217;option <text:span text:style-name="CodeDansTexte">browsers</text:span>&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">karma.conf.js#L49</text:p><text:p text:style-name="Code">autoWatch: true,</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">karma</text:span> se charge d&#8217;inclure les fichiers ECMAScript ou de servir des fichiers
statiques en fonction de motifs de chemins.
Ces fichiers peuvent Ãªtre locaux (de prÃ©fÃ©rence) ou distants et mÃªme de
types diffÃ©rents comme JSON ou&#160;HTML.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">karma.conf.js#L7-17</text:p><text:p text:style-name="Code">files: [</text:p><text:p text:style-name="Code"><text:s text:c="2"/>//'https://cdn.polyfill.io/v2/polyfill.min.js',<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>'examples/tests-browser/**/*.js',<text:s text:c="16"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>'examples/tests/**/*.js',</text:p><text:p text:style-name="Code"><text:s text:c="2"/>'examples/tests-browser/**/*.html',<text:s text:c="14"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>{</text:p><text:p text:style-name="Code"><text:s text:c="4"/>pattern: 'package.json',<text:s text:c="23"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code"><text:s text:c="4"/>served: true,</text:p><text:p text:style-name="Code"><text:s text:c="4"/>included: false<text:s text:c="32"/><text:span text:style-name="PuceCode">5</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">],</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Il suffirait de dÃ©commenter cette ligne pour inclure les <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-polyfills"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="T4">polyfills</text:span> de navigateurs</text:a> sans toucher Ã  notre&#160;code.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Inclusion des fichiers de tests&#160;â€“ ils sont appelÃ©s dans des balises HTML <text:span text:style-name="CodeDansTexte">&lt;script&gt;</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Inclusion de fichiers HTML&#160;â€“ ils sont accessibles via&#160;HTTP.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Mise Ã  disposition du fichier <text:span text:style-name="CodeDansTexte">package.json</text:span>&#160;â€“ accessible via HTTP Ã  l&#8217;adresse <text:span text:style-name="CodeDansTexte">/base/package.json</text:span>.<text:line-break/><text:span text:style-name="PuceCode">5</text:span> Indique que ce fichier ne doit pas Ãªtre inclus dans une balise HTML <text:span text:style-name="CodeDansTexte">&lt;script&gt;</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Des intÃ©grations doivent Ãªtre dÃ©clarÃ©es pour augmenter les fonctionnalitÃ©s de
base de <text:span text:style-name="T4">karma</text:span>.
Ces derniÃ¨res se rÃ©sument Ã  charger des fichiers ECMAScript
dans une balise <text:span text:style-name="CodeDansTexte">&lt;script&gt;</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;extrait de configuration suivant illustre le chargement des plug-ins pour
<text:span text:style-name="T4">Browserify</text:span> (modules <text:span text:style-name="T4">CommonJS</text:span> et transpilation), <text:span text:style-name="T4">mocha</text:span> (suites de tests)
et <text:span text:style-name="T4">fixture</text:span> (donnÃ©es reprÃ©sentant des cas d&#8217;utilisation)&#160;â€“ respectivement
les modules <text:span text:style-name="CodeDansTexte">npm</text:span> <text:span text:style-name="CodeDansTexte">karma-browserify</text:span>, <text:span text:style-name="CodeDansTexte">karma-mocha</text:span> et <text:span text:style-name="CodeDansTexte">karma-fixture</text:span>&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">karma.conf.js#L5</text:p><text:p text:style-name="Code">frameworks: ['browserify', 'mocha', 'fixture'],</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Une fois encore, des motifs de chemins sont utilisÃ©s pour indiquer aux plug-ins
leur responsabilitÃ© de prise en charge.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">karma.conf.js#L21-25</text:p><text:p text:style-name="Code">preprocessors: {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>'examples/tests/**/*.js': ['browserify'],<text:s text:c="9"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>'examples/tests-browser/**/*.js': ['browserify'],</text:p><text:p text:style-name="Code"><text:s text:c="2"/>'examples/tests-browser/**/*.html': ['html2js'],<text:s text:c="2"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">},</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Ces fichiers seront transpilÃ©s par <text:span text:style-name="T4">browserify</text:span> avant d&#8217;Ãªtre chargÃ©s dans les tests de navigateurs.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Ces fichiers seront pris en charge par le prÃ©processeur nommÃ© <text:span text:style-name="T4">html2js</text:span>, utilisÃ© par <text:span text:style-name="CodeDansTexte">karma-fixture</text:span> pour transformer du HTML en arbre&#160;DOM.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous avons vu un exemple de code reposant sur un Ã©lÃ©ment du DOM dans la section
<text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-testing-101"  text:visited-style-name="Visited_20_Internet_20_Link">Que tester&#160;?</text:a></text:span>.
Nous allons nous intÃ©resser Ã  une maniÃ¨re possible de tester la fonction
exportÃ©e <text:span text:style-name="CodeDansTexte">getLinkElementContent()</text:span> en se basant sur un vÃ©ritable appel HTTP et
un vÃ©ritable Ã©lÃ©ment du DOM, crÃ©Ã© Ã  partir du fichier de <text:span text:style-name="T4">fixture</text:span> suivant&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">tests-browser/fixtures/link-package.html</text:p><text:p text:style-name="Code">&lt;a href="/base/package.json"&gt;Test&lt;/a&gt;</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce fichier de fixture est chargÃ© dans le DOM par le plug-in <text:span text:style-name="CodeDansTexte">karma-fixture</text:span>
pour prouver que l&#8217;on peut rÃ©cupÃ©rer les dÃ©pendances exposÃ©es par le fichier
<text:span text:style-name="CodeDansTexte">package.json</text:span> des ressources de ce chapitre&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">tests-browser/test-outside-world.js</text:p><text:p text:style-name="Code">import { expect } from 'chai';</text:p><text:p text:style-name="Code">import getLinkElementContent from '../test-outside-world.js';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">describe('getLinkElementContent', () =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>before(() =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>fixture.setBase('examples/tests-browser/fixtures'); <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>it('fetches dependencies from remote package.json', () =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>const [link] = fixture.load('link-package.html');<text:s text:c="3"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="4"/>return getLinkElementContent(link).then(deps =&gt; {<text:s text:c="3"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="6"/>expect(deps).to.contain.all.keys(<text:s text:c="17"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code"><text:s text:c="8"/>'@babel/core', 'react', 'enzyme'</text:p><text:p text:style-name="Code"><text:s text:c="6"/>);</text:p><text:p text:style-name="Code"><text:s text:c="4"/>});</text:p><text:p text:style-name="Code"><text:s text:c="2"/>});</text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> <text:span text:style-name="CodeDansTexte">before()</text:span> indique Ã  <text:span text:style-name="T4">mocha</text:span> d&#8217;exÃ©cuter ce bloc de code avant tout&#160;test.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Appel du plug-in de fixture pour obtenir l&#8217;Ã©lÃ©ment du DOM nÃ©cessaire Ã  la fonction <text:span text:style-name="CodeDansTexte">getLinkElementContent()</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Appel rÃ©el de la fonction <text:span text:style-name="CodeDansTexte">getLinkElementContent()</text:span>, rÃ©solu comme une <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-promise"  text:visited-style-name="Visited_20_Internet_20_Link">promesse</text:a> et dont nous testons le rÃ©sultat Ã  la ligne suivante.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Assertion vÃ©rifiant que le rÃ©sultat contient bien les clÃ©s de dÃ©pendances&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> attendues&#160;â€“ nous avons bien rÃ©cupÃ©rÃ© le bon fichier et le bon contenu&#160;!<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;invocation de <text:span text:style-name="T4">karma</text:span> se fait en invoquant <text:span text:style-name="CodeDansTexte">./node_modules/.bin/karma start</text:span>.
Par mesure de simplicitÃ©, cette commande a Ã©tÃ© abstraite en tant que
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-npm-scripts"  text:visited-style-name="Visited_20_Internet_20_Link">script&#160;<text:span text:style-name="CodeDansTexte">npm</text:span></text:a>&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">ExÃ©cution ponctuelle de karma</text:p><text:p text:style-name="Code">$ npm run test:browser</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les tests peuvent Ãªtre relancÃ©s en continu&#160;â€“ dÃ¨s qu&#8217;un fichier change&#160;â€“ en
dÃ©sactivant l&#8217;exÃ©cution unique (<text:span text:style-name="T4">single run</text:span>).
C&#8217;est idÃ©al lorsque les tests sont Ã©crits en parallÃ¨le de l&#8217;implÃ©mentation du
code ou que des ajustements frÃ©quents ont lieu en phase de dÃ©veloppement&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">ExÃ©cution continue de karma</text:p><text:p text:style-name="Code">$ npm run test:browser -- --no-single-run</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Comme tout processus de longue durÃ©e, il s&#8217;interrompt Ã  l&#8217;aide de la combinaison
de touches <text:span text:style-name="Menu">[CTRL+C]</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous en savons dÃ©sormais suffisamment pour tester dans les conditions des
navigateurs avec du code modulaire et rÃ©utilisable.
La question qui se pose dÃ©sormais est la suivante&#160;:
<text:span text:style-name="T7">comment faire pour tester plusieurs versions d&#8217;un mÃªme navigateur</text:span>, pour
tester sur un systÃ¨me d&#8217;exploitation que l&#8217;on n&#8217;a pas ou encore plusieurs
terminaux mobiles de type <text:span text:style-name="T4">smartphone</text:span> ou tablette&#160;?</text:p>
<text:bookmark text:name="ref-ci" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">IntÃ©gration continue et compatibilitÃ© navigateurs</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Deux cas de figure se prÃ©sentent en complÃ©ment de la section prÃ©cÃ©dente&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">la difficultÃ© d&#8217;accÃ¨s Ã  certaines combinaisons navigateur + systÃ¨me d&#8217;exploitation&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">l&#8217;envie d&#8217;automatiser les tests de navigateurs.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Sous Windows, il sera difficile de tester la version macOS de Safari.
Inversement, sous macOS, il sera difficile de tester
Internet&#160;Explorer ou Edge.
Que dire d&#8217;anciennes versions de navigateurs Android, dont la rapiditÃ© de
dÃ©veloppement et donc la compatibilitÃ© sont bien en-deÃ§Ã  des versions de Chrome
pour ordinateur ou mobile&#160;?</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;Ã©cosystÃ¨me de modules&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> liÃ©s Ã  <text:span text:style-name="T4">karma</text:span> s&#8217;est dÃ©jÃ  penchÃ© sur la question.
C&#8217;est le cas notamment du produit <text:span text:style-name="T4">BrowserStack</text:span> qui offre une intÃ©gration pour
dÃ©lÃ©guer l&#8217;exÃ©cution des tests sur leur plate-forme commerciale.
Il s&#8217;agit du module <text:span text:style-name="CodeDansTexte">karma-browserstack-launcher</text:span>
(<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/karma-browserstack-launcher" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/karma-browserstack-launcher</text:a></text:span>).</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> BrowserStack</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">La documentation de <text:span text:style-name="T4">BrowserStack</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://www.browserstack.com/automate/node" text:visited-style-name="Visited_20_Internet_20_Link">https://www.browserstack.com/automate/node</text:a></text:span>)
dÃ©crit les diffÃ©rents systÃ¨mes d&#8217;exploitation Ã  disposition ainsi que les
navigateurs compatibles, pour PC, Mac, iOS et Android.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">L&#8217;intÃ©gration avec Node est Ã©galement documentÃ©e au cas oÃ¹ vous souhaiteriez
effectuer des tests sans passer par <text:span text:style-name="T4">karma</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">BrowserStack</text:span> n&#8217;est pas un navigateur en soi, mais offre un accÃ¨s Ã  une multitude
de navigateurs.
Il faut donc crÃ©er de nouvelles configurations dans la propriÃ©tÃ© <text:span text:style-name="CodeDansTexte">customLaunchers</text:span>.
L&#8217;extrait de configuration suivant illustre la crÃ©ation d&#8217;un navigateur Safari
pour iPhone&#160;4S sous iOS&#160;5.1.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">karma.conf.js#L51-58</text:p><text:p text:style-name="Code">browsers: ['Chrome'],</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">customLaunchers: {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>iphone4: {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>base: 'BrowserStack',</text:p><text:p text:style-name="Code"><text:s text:c="4"/>device: 'iPhone 4S',</text:p><text:p text:style-name="Code"><text:s text:c="4"/>os: 'ios',</text:p><text:p text:style-name="Code"><text:s text:c="4"/>os_version: '5.1'</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;utilisation de <text:span text:style-name="T4">BrowserStack</text:span> nÃ©cessite un compte et l&#8217;obtention d&#8217;une clÃ©
d&#8217;API afin d&#8217;utiliser leur service.
Notre nom d&#8217;utilisateur et la clÃ© d&#8217;API doivent Ãªtre renseignÃ©s en tant que
variables d&#8217;environnement pour Ã©tablir une connexion au service et dÃ©marrer
notre bon vieil iPhone&#160;4&#160;:</text:p>
<text:p text:style-name="Code">$ export BROWSER_STACK_USERNAME=...</text:p><text:p text:style-name="Code">$ export BROWSER_STACK_ACCESS_KEY=...</text:p><text:p text:style-name="Code">$ npm run test:browser -- --browsers iphone4</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">BrowserStack</text:span> est configurable plus finement selon nos besoins.
Le rÃ©glage suivant s&#8217;assure de faire transiter les donnÃ©es HTTP
(scripts, HTML) via la connexion sÃ©curisÃ©e entre notre ordinateur et
<text:span text:style-name="T4">BrowserStack</text:span>.
C&#8217;est un rÃ©glage utile en cas de proxy exigeant ou de
rÃ©glages de connexion Ã  Internet bien spÃ©cifiques.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">karma.conf.js#L41-43</text:p><text:p text:style-name="Code">browserStack: {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>forcelocal: true,</text:p><text:p text:style-name="Code">},</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Alternative</text:span> Sauce&#160;Labs</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque"><text:span text:style-name="T4">Sauce&#160;Labs</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://saucelabs.com" text:visited-style-name="Visited_20_Internet_20_Link">https://saucelabs.com</text:a></text:span>) est un concurrent de <text:span text:style-name="T4">BrowserStack</text:span>.
Il offre des fonctionnalitÃ©s similaires et il est gratuit pour les projets open source.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">IndÃ©pendamment de <text:span text:style-name="T4">BrowserStack</text:span>, l&#8217;intÃ©gration continue est un mÃ©canisme
permettant l&#8217;exÃ©cution automatique des tests, de maniÃ¨re reproductible et
dans un environnement systÃ©matiquement propre&#160;â€“ sans trace d&#8217;exÃ©cution d&#8217;un
prÃ©cÃ©dent&#160;test.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cela a deux avantages indÃ©niables&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">exÃ©cuter les tests pour tout changement de code, peu importe qui en est l&#8217;auteur&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">s&#8217;assurer de l&#8217;exÃ©cution systÃ©matique des tests&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">mettre en commun la logique d&#8217;exÃ©cution de tests.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">On Ã©vite ainsi les <text:span text:style-name="T4">oublis</text:span> tout en enlevant le coÃ»t de mise en place de
l&#8217;infrastructure de tests chez des personnes contribuant de maniÃ¨re occasionnelle.
Cerise sur le gÃ¢teau, on prÃ©vient en partie les rÃ©gressions&#160;â€“ changements qui
cassent le fonctionnement attendu d&#8217;une fonctionnalitÃ©.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le service Travis&#160;CI (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://travis-ci.com" text:visited-style-name="Visited_20_Internet_20_Link">https://travis-ci.com</text:a></text:span>) est un service
d&#8217;intÃ©gration continue (<text:span text:style-name="T4">Continuous Integration</text:span>, <text:span text:style-name="T4">CI</text:span>) parmi d&#8217;autres, mais
qui a Ã©tÃ© rendu populaire pour son intÃ©gration avec GitHub.
Il est gratuit pour les projets open source.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un service d&#8217;intÃ©gration continue est configurÃ© pour dÃ©finir ce qui est
exÃ©cutÃ© avant, pendant et aprÃ¨s les tests.
Il a donc l&#8217;avantage de faciliter l&#8217;automatisation des tests de navigateurs
Ã  mÃªme la machine virtuelle (<text:span text:style-name="T4">Virtual Machine</text:span>, <text:span text:style-name="T4">VM</text:span>) de test ou bien
vers des plates-formes comme <text:span text:style-name="T4">BrowserStack</text:span>.
Son mÃ©canisme de variables d&#8217;environnement cryptÃ©es nous Ã©vitera de donner
accÃ¨s Ã  notre compte au premier&#160;venu.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un fichier de configuration minimal au format YAML est nÃ©cessaire.
Des services comme GitHub facilitent la connexion avec Travis&#160;CI et
dÃ©clenchent automatiquement l&#8217;exÃ©cution des tests Ã  chaque <text:span text:style-name="T4">commit</text:span>
ou <text:span text:style-name="T4">pull&#160;request</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">.travis.yml</text:p><text:p text:style-name="Code">language: node_js<text:s text:c="13"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">node_js: v10<text:s text:c="18"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">addons:</text:p><text:p text:style-name="Code"><text:s text:c="2"/>firefox: latest<text:s text:c="13"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">env:</text:p><text:p text:style-name="Code">- MOZ_HEADLESS=1<text:s text:c="38"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code">- BROWSER_STACK_USERNAME="$BROWSER_STACK_USERNAME"<text:s text:c="4"/><text:span text:style-name="PuceCode">5</text:span></text:p><text:p text:style-name="Code">- BROWSER_STACK_ACCESS_KEY="$BROWSER_STACK_ACCESS_KEY"</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">script: npm run test:browser -- --browsers Firefox</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Configuration de la&#160;VM pour utiliser&#160;Node.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Configuration de la&#160;VM pour utiliser la version la plus rÃ©cente de Node&#160;v10.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Installation de la derniÃ¨re version stable de Firefox.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> La variable d&#8217;environnement <text:span text:style-name="CodeDansTexte">MOZ_HEADLESS</text:span> indique Ã  Firefox de dÃ©marrer sans afficher d&#8217;interface graphique Ã  l&#8217;Ã©cran.<text:line-break/><text:span text:style-name="PuceCode">5</text:span> J&#8217;ai paramÃ©trÃ© la clÃ© d&#8217;accÃ¨s Ã  <text:span text:style-name="T4">BrowserStack</text:span> dans les rÃ©glages de <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-travis-ci"  text:visited-style-name="Visited_20_Internet_20_Link">Travis&#160;CI</text:a> (voir encadrÃ©).<text:line-break/></text:p>
<text:bookmark text:name="ref-travis-ci" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> Travis&#160;CI</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Des services comme Travis&#160;CI sont puissants et amplement configurable
pour de nombreux besoins&#160;â€“ dont Node (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://docs.travis-ci.com/user/languages/javascript-with-nodejs/" text:visited-style-name="Visited_20_Internet_20_Link">https://docs.travis-ci.com/user/languages/javascript-with-nodejs/</text:a></text:span>)&#160;â€“
et y&#160;compris pour se connecter Ã  des bases de donnÃ©es PostgreSQL ou MariaDB.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(chapter-09/images/travis-ci-encrypted-env.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>9-undefined.</text:span> Ã‰cran de paramÃ©trage des variables d&#8217;environnement secrÃ¨tes sur Travis&#160;CI</text:p>
<text:bookmark text:name="ref-conclusion_9" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Conclusion</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous sommes dÃ©sormais en mesure d'<text:span text:style-name="T7">exÃ©cuter des tests unitaires</text:span> impliquant
des <text:span text:style-name="T7">navigateurs web</text:span> sur notre machine, sur des <text:span text:style-name="T7">services distants</text:span> mais
Ã©galement de maniÃ¨re automatique avec des services d'<text:span text:style-name="T7">intÃ©gration continue</text:span>
comme Travis&#160;CI.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le recours aux modules&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> combinÃ©s aux modules ECMAScript facilite
<text:span text:style-name="T7">la conception et la maintenance de code testable et rÃ©utilisable</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ces pratiques de modularisation&#160;â€“ jusqu&#8217;au rendu intermÃ©diaire de <text:span text:style-name="T4">React</text:span>
â€“ incitent Ã  la <text:span text:style-name="T7">rigueur qui a un effet positif</text:span> sur la qualitÃ© de notre
code et renforce notre confiance Ã  le dÃ©ployer en production.</text:p>
<text:bookmark text:name="ref-appendix-a" /><text:p text:style-name="ChapitreNumero">A</text:p><text:h text:style-name="ChapitreTitre" text:outline-level="1">SÃ©lection de modules&#160;npm</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette annexe est une sÃ©lection de modules&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com</text:a></text:span>)
Ã  laquelle vous rÃ©fÃ©rer pour dÃ©marrer rapidement, mais aussi pour dÃ©couvrir
des usages et des domaines d&#8217;application insoupÃ§onnÃ©s.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">J&#8217;ai bÃ¢ti cette liste Ã  partir de mon expÃ©rience personnelle et sur la confiance
que je porte aux personnes Ã  l&#8217;origine de ces modules.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Remarque</text:span> Versions de Node et npm</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Le contenu de ce chapitre utilise les versions <text:span text:style-name="T7">Node&#160;v10</text:span>
et <text:span text:style-name="T7">npm&#160;v6</text:span>.
Ce sont les versions stables recommandÃ©es en&#160;2019.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Pratique</text:span> Jouer avec les exemples dans un terminal</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Les exemples titrÃ©s d&#8217;un nom de fichier peuvent Ãªtre installÃ©s sur votre ordinateur.
ExÃ©cutez-les dans un terminal et amusez-vous Ã  les modifier en parallÃ¨le de
votre lecture pour voir ce qui change.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Installation des exemples via le module npm <text:span text:style-name="CodeDansTexte">nodebook</text:span></text:p><text:p text:style-name="RemarqueCode">$ npm install --global nodebook</text:p><text:p text:style-name="RemarqueCode">$ nodebook install appendix-a</text:p><text:p text:style-name="RemarqueCode">$ cd $(nodebook dir appendix-a)</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">La commande suivante devrait afficher un rÃ©sultat qui confirme que vous Ãªtes
au bon endroit&#160;:</text:p>
<text:p text:style-name="RemarqueCode">$ node hello.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Suivez Ã  nouveau les instructions d&#8217;installation pour rÃ©tablir les exemples
dans leur Ã©tat initial.</text:p>
<text:bookmark text:name="ref-boÃ®te_Ã _outils_du_quotidien" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">BoÃ®te Ã  outils du quotidien</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ces modules rÃ©pondent Ã  des besoins quotidiens, pour travailler plus rapidement
sur des structures ECMAScript.</text:p>
<text:bookmark text:name="ref-lodash" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">lodash</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">lodash</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/lodash" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/lodash</text:a></text:span>) est une collection de plusieurs
dizaines de fonctions pour travailler plus facilement avec des chaÃ®nes de caractÃ¨res,
des tableaux, des fonctions et des objets.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Vous pourrez ainsi filtrer, sÃ©lectionner, fusionner, vÃ©rifier et composer
de nouvelles variables, aussi bien pour Node que dans les navigateurs.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">lodash.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const { intersection, first } = require('lodash');</text:p><text:p text:style-name="Code">const DC = ['Batman', 'Brainiac', 'Thor'];</text:p><text:p text:style-name="Code">const Marvel = ['Spiderman', 'Thor'];</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const result = first(intersection(DC, Marvel));</text:p><text:p text:style-name="Code">console.log(result);<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">Thor</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-he" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">he</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">he</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/he" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/he</text:a></text:span>) est un utilitaire pour encoder et dÃ©coder
des entitÃ©s HTML dans des chaÃ®nes de caractÃ¨res.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">he.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {encode} = require('he');</text:p><text:p text:style-name="Code">const html = '&lt;h1&gt;Blog Post&lt;/h1&gt;';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(html);<text:s text:c="19"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(encode(html));<text:s text:c="11"/><text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">&lt;h1&gt;Blog Post&lt;/h1&gt;</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">&amp;#x3C;h1&amp;#x3E;Blog Post&amp;#x3C;/h1&amp;#x3E;</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-chance" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">chance</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">chance</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/chance" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/chance</text:a></text:span>) crÃ©e des donnÃ©es de maniÃ¨re alÃ©atoire.
Le module retourne aussi des prÃ©noms fictifs, mais aussi des numÃ©ros de tÃ©lÃ©phone,
des nombres, des paragraphes, des dates d&#8217;anniversaire, des identifiants Android
ou Apple, etc.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il s&#8217;utilise surtout pour gÃ©nÃ©rer des donnÃ©es factices Ã  des fins de tests,
en attendant les vraies donnÃ©es.</text:p>
<text:bookmark text:name="ref-date_fns" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">date-fns</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">date-fns</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/date-fns" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/date-fns</text:a></text:span>) est une collection de fonctions
pour travailler avec des dates, plus facilement qu&#8217;avec l&#8217;objet natif&#160;<text:span text:style-name="CodeDansTexte">Date</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Vous pouvez formater, ajouter ou retirer des jours, vÃ©rifier si deux pÃ©riodes
de temps se chevauchent ou si deux dates font partie d&#8217;une mÃªme semaine calendaire.</text:p>
<text:bookmark text:name="ref-tcomb" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">tcomb</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">tcomb</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/tcomb" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/tcomb</text:a></text:span>) renforce la crÃ©ation de structures
typÃ©es et non mutables.
Cela rÃ©duit les effets de bord de nos applications lorsque les
donnÃ©es n&#8217;ont pas la structure attendue.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">tcomb.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const t = require('tcomb');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const GPS = t.struct({<text:s text:c="32"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>lat: t.Number,</text:p><text:p text:style-name="Code"><text:s text:c="2"/>lon: t.Number,</text:p><text:p text:style-name="Code">}, {strict: true});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const Bordeaux = GPS({ lat: 44.8638, lon: -0.6561 });</text:p><text:p text:style-name="Code">const Crest = GPS({ lat: 44.7311, long: 4.9861 });<text:s text:c="4"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">const Toulouse = GPS({ lat: 43.6008, lon: 'r0s3' });<text:s text:c="2"/><text:span text:style-name="PuceCode">3</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> DÃ©finition d&#8217;une structure stricte qui a pour propriÃ©tÃ©s <text:span text:style-name="CodeDansTexte">lat</text:span> et <text:span text:style-name="CodeDansTexte">lon</text:span>, pour <text:span text:style-name="T4">latitude</text:span> et <text:span text:style-name="T4">longitude</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Cet appel va lancer une exception car la propriÃ©tÃ© <text:span text:style-name="CodeDansTexte">long</text:span> est inconnue.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Cet appel va lancer une exception car la propriÃ©tÃ© <text:span text:style-name="CodeDansTexte">lon</text:span> doit Ãªtre un nombre.<text:line-break/></text:p>
<text:bookmark text:name="ref-eventemitter3" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">eventemitter3</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">eventemitter3</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/eventemitter3" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/eventemitter3</text:a></text:span>) sert Ã  gÃ©rer
des Ã©vÃ©nements de maniÃ¨re uniforme dans un script Node et dans les navigateurs.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">eventemitter3.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const EventEmitter = require('eventemitter3');</text:p><text:p text:style-name="Code">const emitter = new EventEmitter();</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">emitter.on('ping', data =&gt; console.log('on: %s', data));</text:p><text:p text:style-name="Code">emitter.once('ping', data =&gt; console.log('once: %s', data));</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(emitter.listeners('ping')); <text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">emitter.emit('ping', ['ping', 'ping']); <text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">emitter.emit('ping', ['pong']);<text:s text:c="9"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">emitter.removeListener('ping');</text:p><text:p text:style-name="Code">emitter.emit('ping', ['pong']);<text:s text:c="9"/><text:span text:style-name="PuceCode">4</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">[ [Function], [Function] ]</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">on: ping,ping</text:span> puis <text:span text:style-name="CodeDansTexte">once: ping,ping</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche <text:span text:style-name="CodeDansTexte">on: ping,ping</text:span>.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> N&#8217;affiche rien, l&#8217;Ã©vÃ©nement Ã©tant dÃ©sormais dÃ©connectÃ©.<text:line-break/></text:p>
<text:bookmark text:name="ref-dev" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Pendant le dÃ©veloppement</text:h><text:bookmark text:name="ref-debug" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">debug</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">debug</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/debug" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/debug</text:a></text:span>) rend optionnel l&#8217;affichage de
messages de dÃ©bogage.
Les messages s&#8217;affichent en prÃ©sence d&#8217;une variable d&#8217;environnement.
Nous pouvons ainsi lancer un processus et retracer un cheminement complexe de
donnÃ©es.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Par dÃ©faut, les messages ne s&#8217;affichent pas&#160;:</text:p>
<text:p text:style-name="Code">$ node examples/debug.js</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les messages du dÃ©bogueur <text:span text:style-name="CodeDansTexte">app</text:span> s&#8217;affichent dÃ©sormais&#160;:</text:p>
<text:p text:style-name="Code">$ <text:span text:style-name="CodeExergue">DEBUG=app</text:span> node examples/debug.js</text:p><text:p text:style-name="Code"><text:s text:c="2"/>app fromages [ 'livarot', 'chaource' ] +0ms</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Nous pouvons en afficher plusieurs en mÃªme temps, en usant du caractÃ¨re&#160;<text:span text:style-name="CodeDansTexte">*</text:span>
ou en sÃ©parant les noms de dÃ©bogueurs avec des virgules&#160;:</text:p>
<text:p text:style-name="Code">$ DEBUG=app<text:span text:style-name="CodeExergue">*</text:span> node examples/debug.js</text:p><text:p text:style-name="Code"><text:s text:c="2"/>app fromages [ 'livarot', 'chaource' ] +0ms</text:p><text:p text:style-name="Code"><text:s text:c="2"/>app:timer now 1531304027271 +0ms</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">debug.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const debug = require('debug');</text:p><text:p text:style-name="Code">const log = debug('app');<text:s text:c="21"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">const logInterval = debug('app:timer');<text:s text:c="7"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">log('fromages %o', ['livarot', 'chaource']);<text:s text:c="2"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">setTimeout(() =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>logInterval('now %d', Date.now());<text:s text:c="10"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code">}, 1000);</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> CrÃ©ation du dÃ©bogueur <text:span text:style-name="CodeDansTexte">app</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> CrÃ©ation du dÃ©bogueur <text:span text:style-name="CodeDansTexte">app:timer</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> La fonction de dÃ©bogage s&#8217;utilise de la mÃªme maniÃ¨re que <text:span text:style-name="CodeDansTexte">console.log</text:span>.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Cette fonction fait appel au dÃ©bogueur <text:span text:style-name="CodeDansTexte">app:timer</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-nodemon" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">nodemon</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">nodemon</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/nodemon" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/nodemon</text:a></text:span>) relance le processus actif
dÃ¨s qu&#8217;un fichier ECMAScript ou JSON est modifiÃ©.
C&#8217;est un module exÃ©cutable particuliÃ¨rement utile lorsque nous voulons prendre
en compte les changements dans une application qui tourne en continu.
C&#8217;est le cas des applications web, entre autres.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Pour en savoir plus, rendez-vous Ã  la section
<text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-dev"  text:visited-style-name="Visited_20_Internet_20_Link">Pendant le dÃ©veloppement&#160;: relancer le serveur automatiquement</text:a></text:span>
du <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-07"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;7</text:a>.</text:p>
<text:bookmark text:name="ref-npm_run_all" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">npm-run-all</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">npm-run-all</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/npm-run-all" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/npm-run-all</text:a></text:span>) est mon outil favori
pour composer avec les scripts&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>.
Il a l&#8217;avantage d&#8217;Ãªtre adaptable, de rÃ©gler finement ce qui
doit Ãªtre exÃ©cutÃ© en parallÃ¨le ou sÃ©quentiellement.
Le module transfÃ¨re les arguments aux sous-scripts.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">package.json</text:p><text:p text:style-name="Code">{</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"...": "...",</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"scripts": {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"build": "npm-run-all -p 'build:*' -s start",</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"build:css": "sass ...",</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"build:js": "browserify ...",</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"start": "node server.js"</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">}</text:p>
<text:bookmark text:name="ref-husky" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">husky</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">husky</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/husky" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/husky</text:a></text:span>) intÃ¨gre Git aux
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-scripts"  text:visited-style-name="Visited_20_Internet_20_Link">scripts&#160;<text:span text:style-name="CodeDansTexte">npm</text:span></text:a>.
Autrement dit, vous pouvez dÃ©clencher des scripts lors d&#8217;Ã©vÃ©nements Git,
lors d&#8217;un <text:span text:style-name="CodeDansTexte">push</text:span>, avant un <text:span text:style-name="CodeDansTexte">commit</text:span> ou aprÃ¨s avoir rapatriÃ© des changements.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">package.json</text:p><text:p text:style-name="Code">{</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"...": "...",</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"scripts": {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"precommit": "lint-staged",</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"post-merge": "npm install"</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">}</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La liste complÃ¨te des <text:span text:style-name="T4">hooks</text:span> Git se trouve dans la documentation
officielle&#160;: <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://git-scm.com/docs/githooks" text:visited-style-name="Visited_20_Internet_20_Link">https://git-scm.com/docs/githooks</text:a></text:span>.</text:p>
<text:bookmark text:name="ref-onchange" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">onchange</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">onchange</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/onchange" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/onchange</text:a></text:span>) observe une liste de fichiers
en continu et dÃ©clenche une commande dÃ¨s que l&#8217;un d&#8217;entre eux est modifiÃ©.
C&#8217;est particuliÃ¨rement utile pour reconstruire automatiquement des fichiers
de configuration ou des fichiers <text:span text:style-name="T4">front-end</text:span> pendant le dÃ©veloppement.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">package.json</text:p><text:p text:style-name="Code">{</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"...": "...",</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"scripts": {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"build:css": "sass ...",</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"dev": "npm-run-script -p 'watch:*' start",</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"watch:css": "onchange '**/*.scss' -- npm run build:css",</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"start": "node server.js"</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">}</text:p>
<text:bookmark text:name="ref-tiny_lr" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">tiny-lr</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">tiny-lr</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/tiny-lr" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/tiny-lr</text:a></text:span>) est une implÃ©mentation minimale
du protocole <text:span text:style-name="T4">livereload</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://livereload.com" text:visited-style-name="Visited_20_Internet_20_Link">http://livereload.com</text:a></text:span>).
Il s&#8217;intÃ¨gre Ã  un serveur HTTP ou Ã  une application <text:span text:style-name="T4">Express</text:span> pour relayer
la liste des fichiers modifiÃ©s cÃ´tÃ© client.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le script ou l&#8217;extension navigateur client remplace les anciens fichiers
par les nouveaux pour reflÃ©ter les changements sans recharger la&#160;page.</text:p>
<text:bookmark text:name="ref-livereactload" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">livereactload</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">livereactload</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/livereactload" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/livereactload</text:a></text:span>) recherche les composants
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-react"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="T4">React</text:span></text:a> Ã  chaud, c&#8217;est-Ã -dire sans rafraÃ®chir la page ni perdre l&#8217;Ã©tat des donnÃ©es.
C&#8217;est un module indispensable pour dÃ©velopper des applications <text:span text:style-name="T4">front-end</text:span> rÃ©actives.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Rendez-vous dans la section <text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-livereload"  text:visited-style-name="Visited_20_Internet_20_Link">Changements en temps&#160;rÃ©el dans le navigateur</text:a></text:span>
du <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-09"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;9</text:a> pour en savoir plus sur son
installation et son intÃ©gration.</text:p>
<text:bookmark text:name="ref-protÃ©ger_nos_applications" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">ProtÃ©ger nos applications</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le code que nous Ã©crivons se protÃ¨ge dÃ¨s la conception et dans le temps.
Certains modules filtrent les tentatives d&#8217;exploitation de nos
applications, tandis que d&#8217;autres vÃ©rifient si le code dÃ©ployÃ© est toujours&#160;sÃ»r.</text:p>
<text:bookmark text:name="ref-sanitize_filename" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">sanitize-filename</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">sanitize-filename</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/sanitize-filename" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/sanitize-filename</text:a></text:span>) nettoie
une variable de tout caractÃ¨re ambigu ou qui ne serait pas attendu.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">sanitize-filename.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const sanitize = require('sanitize-filename');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">console.log(sanitize('aucun-problÃ¨me.txt'));<text:s text:c="2"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">console.log(sanitize('../../.ssh/id_rsa'));<text:s text:c="3"/><text:span text:style-name="PuceCode">2</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche <text:span text:style-name="CodeDansTexte">aucun-problÃ¨me.txt</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche <text:span text:style-name="CodeDansTexte">.....sshid_rsa</text:span>&#160;â€“ les caractÃ¨res&#160;<text:span text:style-name="CodeDansTexte">/</text:span> sont nettoyÃ©s car il permettrait de crÃ©er des chemins compromettants pour l&#8217;application ou le systÃ¨me d&#8217;exploitation.<text:line-break/></text:p>
<text:bookmark text:name="ref-helmet" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">helmet</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">helmet</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/helmet" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/helmet</text:a></text:span>) est un module Ã  intÃ©grer systÃ©matiquement
dans toute application <text:span text:style-name="T4">Express</text:span>.
Il ajoute des en-tÃªtes HTTP <text:span text:style-name="T4">Content-Security Policy</text:span>, <text:span text:style-name="T4">Strict Transport Policy</text:span>
et d&#8217;autres qui empÃªchent le dÃ©tournement d&#8217;informations.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Chacune de ses protections se configure aussi au cas par cas.
Elles s&#8217;intÃ¨grent manuellement dans d&#8217;autres types d&#8217;applications web,
y&#160;compris un serveur HTTP natif Ã &#160;Node.</text:p>
<text:bookmark text:name="ref-dompurify" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">dompurify</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">dompurify</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/dompurify" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/dompurify</text:a></text:span>) nettoie un contenu HTML
pour le rendre affichable en toute sÃ©curitÃ©.
Il nettoie des scripts indÃ©sirÃ©s, des balises mal formÃ©es qui casseraient l&#8217;affichage,
ou encore des <text:span text:style-name="T4">iframes</text:span> qui injecteraient des contenus tiers sans notre consentement.</text:p>
<text:bookmark text:name="ref-filenamify" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">filenamify</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">filenamify</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/filenamify" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/filenamify</text:a></text:span>) nettoie une valeur
pour retirer tout caractÃ¨re invalide dans un nom de fichier.
C&#8217;est pratique pour laisser la possibilitÃ© Ã  un utilisateur de choisir
un nom de fichier sans pour autant mettre en danger le systÃ¨me ou l&#8217;application.</text:p>
<text:bookmark text:name="ref-retire_js" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">retire.js</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">retire.js</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/retire" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/retire</text:a></text:span>) sert Ã  scanner soi-mÃªme des
vulnÃ©rabilitÃ©s connues dans des fichiers JavaScript.
Il est complÃ©mentaire de la commande <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-audit"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="CodeDansTexte">npm audit</text:span></text:a>
car il inspecte des dÃ©pendances qui ne sont pas forcÃ©ment sur&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>.</text:p>
<text:bookmark text:name="ref-snyk" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">snyk</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">snyk</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/snyk" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/snyk</text:a></text:span>) est Ã  la fois un service en ligne
et un module pour vÃ©rifier la prÃ©sence de failles de sÃ©curitÃ© connues
dans les dÃ©pendances de nos projets.</text:p>
<text:bookmark text:name="ref-vÃ©rifier_la_syntaxe_de_notrecode" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">VÃ©rifier la syntaxe de notre&#160;code</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La vÃ©rification syntaxique est un mÃ©canisme s&#8217;assurant que votre code respecte
la grammaire du langage associÃ©.
Elle rÃ©vÃ¨le aussi des anomalies fondamentales (balise mal fermÃ©e,
expression inconnue, etc.) et renforce des pratiques de programmation commune
au groupe de dÃ©veloppement.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">VÃ©rifier la syntaxe de notre code est une excellente premiÃ¨re Ã©tape avant
d&#8217;introduire des tests unitaires ou fonctionnels.</text:p>
<text:bookmark text:name="ref-htmlhint" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">htmlhint</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">htmlhint</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/htmlhint" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/htmlhint</text:a></text:span>) vÃ©rifie la structure de
nos documents HTML.
Il rapporte les doublons d&#8217;attributs&#160;<text:span text:style-name="CodeDansTexte">id</text:span>, la prÃ©sence de balises
mal formÃ©es, l&#8217;absence de balise fermante ou encore l&#8217;existence de chaÃ®nes de
caractÃ¨res non imprimables dans des attributs critiques, entre autres.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Prenons en exemple le document suivant&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">sample.html</text:p><text:p text:style-name="Code">&lt;html&gt;</text:p><text:p text:style-name="Code">&lt;head&gt;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;link rel="stylesheet" href="sample.css"&gt;</text:p><text:p text:style-name="Code">&lt;/head&gt;</text:p><text:p text:style-name="Code">&lt;body&gt;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;button id="btn" class="btn btn-primary"&gt;OK&lt;/button&gt;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;button id="btn" class="btn"&gt;KO&lt;/button&gt;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;BUTTON class='btn__primary--curent btn--active'&gt;&lt;/BUTTON&gt;</text:p><text:p text:style-name="Code">&lt;/body&gt;</text:p><text:p text:style-name="Code">&lt;/html&gt;</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Une lecture distraite pourrait nous faire passer Ã  cÃ´tÃ© d&#8217;erreurs et
d&#8217;incohÃ©rences de programmation.
Les erreurs de ce genre passent d&#8217;autant plus inaperÃ§ues que la base de code
devient volumineuse et change frÃ©quemment.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exÃ©cution de <text:span text:style-name="T4">htmlhint</text:span> avec ses rÃ¨gles par dÃ©faut remontera les alertes
suivantes&#160;:</text:p>
<text:p text:style-name="Code">$ ../node_modules/.bin/htmlhint sample.html</text:p><text:p text:style-name="Code">sample.html:</text:p><text:p text:style-name="Code">line 1, col 1: Doctype must be first.</text:p><text:p text:style-name="Code">line 8, col 10: Id redefinition of [ btn ].</text:p><text:p text:style-name="Code">line 10, col 3: Tagname [ BUTTON ] must be lower case.</text:p><text:p text:style-name="Code">...</text:p><text:p text:style-name="Code">line 10, col 52: Tagname [ BUTTON ] must be lower case.</text:p>
<text:bookmark text:name="ref-eslint" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">eslint</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">eslint</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/eslint" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/eslint</text:a></text:span>) est l&#8217;outil de vÃ©rification
syntaxique pour ECMAScript par excellence.
Il est souple, rapide Ã  mettre en Å“uvre et s&#8217;adapte Ã  des contextes complexes.
J&#8217;aime son mÃ©canisme de configuration de rÃ¨gles&#160;: utilisation systÃ©matique du
<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-strict"  text:visited-style-name="Visited_20_Internet_20_Link">mode strict</text:a>, nombre maximum de paramÃ¨tres
de fonctions, objets non dÃ©clarÃ©s, variables inconnues, etc.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">eslint</text:span> expose Ã©galement des fonctions pour crÃ©er vos propres rÃ¨gles mÃ©tier.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">package.json</text:p><text:p text:style-name="Code">{</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"...": "...",</text:p><text:p text:style-name="Code"><text:s text:c="2"/>"eslintConfig": {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"env": {</text:p><text:p text:style-name="Code"><text:s text:c="6"/>"node": true,</text:p><text:p text:style-name="Code"><text:s text:c="6"/>"es6": true</text:p><text:p text:style-name="Code"><text:s text:c="4"/>},</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"extends": [</text:p><text:p text:style-name="Code"><text:s text:c="6"/>"eslint:recommended"</text:p><text:p text:style-name="Code"><text:s text:c="4"/>],</text:p><text:p text:style-name="Code"><text:s text:c="4"/>"rules": {</text:p><text:p text:style-name="Code"><text:s text:c="6"/>"strict": ["error", "global"],</text:p><text:p text:style-name="Code"><text:s text:c="6"/>"quotes": ["error", "single"],</text:p><text:p text:style-name="Code"><text:s text:c="6"/>"no-undef": "error",</text:p><text:p text:style-name="Code"><text:s text:c="6"/>"curly": "error",</text:p><text:p text:style-name="Code"><text:s text:c="6"/>"eqeqeq": "error"</text:p><text:p text:style-name="Code"><text:s text:c="4"/>}</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">}</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le niveau de sÃ©vÃ©ritÃ© de chaque rÃ¨gle est reprÃ©sentÃ© par un identifiant&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="CodeDansTexte">none</text:span>&#160;: rÃ¨gle dÃ©sactivÃ©e&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="CodeDansTexte">warn</text:span>&#160;: affiche un avertissement&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="CodeDansTexte">error</text:span>&#160;: affiche une erreur (le processus se terminera avec un code d&#8217;erreur).</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Certaines rÃ¨gles demandent ou acceptent des arguments supplÃ©mentaires.
Elles sont toutes documentÃ©es sur le site web du projet&#160;:
<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="http://eslint.org/docs/rules/" text:visited-style-name="Visited_20_Internet_20_Link">http://eslint.org/docs/rules/</text:a></text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:h text:style-name="RemarqueTitre" text:outline-level="7"><text:span text:style-name="RemarquePreTitre">Documentation</text:span> RÃ¨gles personnalisÃ©es</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Un exemple rÃ©utilisable de rÃ¨gles personnalisÃ©es se trouve sur le dÃ©pÃ´t
GitHub de Airbnb&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="RemarquePuce"><text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://github.com/airbnb/javascript" text:visited-style-name="Visited_20_Internet_20_Link">https://github.com/airbnb/javascript</text:a></text:span></text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-csslint" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">csslint</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">csslint</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/csslint" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/csslint</text:a></text:span>) est un outil de vÃ©rification
syntaxique de feuilles de style CSS.
Il a Ã©tÃ© crÃ©Ã© par deux anciens ingÃ©nieurs de Yahoo! dont les anciens travaux
dans le domaine de la performance ont influencÃ©
l&#8217;architecture et le choix des rÃ¨gles par dÃ©faut.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">csslint</text:span> fournit les mÃ©canismes de vÃ©rification adÃ©quats pour alerter de
possibles effets de bord de <text:span text:style-name="T4">box&#160;model</text:span>, de dÃ©claration incompatible de
<text:span text:style-name="CodeDansTexte">@font-face</text:span>, de <text:span text:style-name="T4">vendor prefix</text:span> dÃ©prÃ©ciÃ©s ou encore de combinaisons de
propriÃ©tÃ©s connues pour casser l&#8217;affichage dans certains navigateurs.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Prenons par exemple le fichier CSS suivant&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">sample.css</text:p><text:p text:style-name="Code">.btn {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>background: white;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>color: black;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>border: 0px solid black;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>height: 20px;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>padding: 10px;</text:p><text:p text:style-name="Code">}</text:p><text:p text:style-name="Code">.btn__primary {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>background-color: blue;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>color: white;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>font-size: 1.3em;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>transition: font-weight 0.2s ease;</text:p><text:p text:style-name="Code">}</text:p><text:p text:style-name="Code">.btn__primary--current {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>color: gray;</text:p><text:p text:style-name="Code">}</text:p><text:p text:style-name="Code">.btn__primary--current.btn--active {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>font-weight: 700;</text:p><text:p text:style-name="Code">}</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">csslint</text:span> lancera trois alertes en lisant le fichier <text:span text:style-name="CodeDansTexte">sample.css</text:span>,
mÃªme si celui-ci est syntaxiquement parfaitement valide&#160;:</text:p>
<text:p text:style-name="Code">$ ../node_modules/.bin/csslint sample.css</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">csslint: There are 3 problems in sample.css.</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">sample.css</text:p><text:p text:style-name="Code">1: warning at line 4, col 11</text:p><text:p text:style-name="Code">Values of 0 shouldn't have units specified.</text:p><text:p text:style-name="Code"><text:s text:c="2"/>border: 0px solid black;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">sample.css</text:p><text:p text:style-name="Code">2: warning at line 4, col 3</text:p><text:p text:style-name="Code">Using height with border can sometimes make</text:p><text:p text:style-name="Code"><text:s text:c="2"/>elements larger than you expect.</text:p><text:p text:style-name="Code"><text:s text:c="2"/>border: 0px solid black;</text:p><text:p text:style-name="Code">...</text:p>
<text:bookmark text:name="ref-doiuse" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">doiuse</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">doiuse</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/doiuse" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/doiuse</text:a></text:span>) est un utilitaire qui repose
sur la base de donnÃ©es du site communautaire <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://caniuse.com" text:visited-style-name="Visited_20_Internet_20_Link">https://caniuse.com</text:a></text:span>.
Il nous alerte des possibles incompatibilitÃ©s de syntaxe en fonction de la liste
de navigateurs Ã  gÃ©rer.
Cette liste concerne aussi bien des versions spÃ©cifiques (Internet Explorer&#160;8)
que des parts de marchÃ© (tous les navigateurs avec plus de 5&#160;% de parts de marchÃ©).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exemple suivant illustre les alertes relevÃ©es par <text:span text:style-name="T4">doiuse</text:span> dans le cas
d&#8217;une recherche de compatibilitÃ© avec Internet Explorer&#160;6 et Internet
Explorer&#160;7&#160;:</text:p>
<text:p text:style-name="Code">$ ../node_modules/.bin/doiuse -b 'ie &lt; 8' sample.css</text:p><text:p text:style-name="Code">sample.css:1:1: CSS 2.1 selectors not supported by: IE (6)</text:p><text:p text:style-name="Code">sample.css:8:1: CSS 2.1 selectors not supported by: IE (6)</text:p><text:p text:style-name="Code">sample.css:12:1: CSS3 Transitions not supported by: IE (6,7)</text:p><text:p text:style-name="Code">sample.css:14:1: CSS 2.1 selectors not supported by: IE (6)</text:p>
<text:bookmark text:name="ref-optimize" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Optimiser notre&#160;code</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Commentaires, indentations ou encore noms de variables&#160;: tout cela occupe de
la place&#160;â€“ autant d&#8217;octets transfÃ©rÃ©s sur le rÃ©seau avant d&#8217;Ãªtre exÃ©cutÃ©s
par un client web.
Les outils d&#8217;optimisation offrent l&#8217;opportunitÃ© aux dÃ©veloppeurs et dÃ©veloppeuses
d&#8217;Ã©crire du code sans compromettre sa lisibilitÃ© et sa maintenabilitÃ©.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les minifieurs et optimiseurs mettent en Å“uvre diffÃ©rentes techniques pour
rÃ©duire le poids de notre&#160;code&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero">suppression des commentaires et caractÃ¨res non significatifs&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">renommage de variables&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">factorisation d&#8217;occurrences multiples similaires&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">suppression des instructions relatives au dÃ©bogage/dÃ©veloppement&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">suppression du code inutilisÃ©&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">Ã©criture automatique de code pour prendre en charge des environnements anciens ou futurs.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-uglify_es" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">uglify-es</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">UglifyJS</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/uglify-es" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/uglify-es</text:a></text:span>) est un des premiers
compresseurs Ã  utiliser une reprÃ©sentation syntaxique en arbre
(<text:span text:style-name="T4">Abstract Syntax Tree</text:span>&#160;â€“ <text:span text:style-name="T4">AST</text:span>) en lieu et place des classiques
optimisations avec expressions rÃ©guliÃ¨res.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette mÃ©thode Ã©largit les perspectives de la compression via de
la rÃ©Ã©criture de&#160;code&#160;:</text:p>
<text:bookmark text:name="ref-undefined" /><text:list text:style-name="List_20_1"><text:list-item>
<text:p text:style-name="ListeANumero"><text:span text:style-name="T4">hoisting</text:span> des variables (remontÃ©e de leur dÃ©claration en dÃ©but de portÃ©e)&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">combinaison des dÃ©clarations de variables&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">factorisation des valeurs de variables&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">rÃ©Ã©criture partielle d&#8217;expressions&#160;;</text:p>
</text:list-item><text:list-item>
<text:p text:style-name="ListeANumero">injection en ligne du contenu de variables.</text:p>
</text:list-item></text:list>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">UglifyJS</text:span> s&#8217;utilise en ligne de commande ou comme un module&#160;Node.</text:p>
<text:bookmark text:name="ref-postcss" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">postcss</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">PostCSS</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/postcss" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/postcss</text:a></text:span>) est une optimiseur CSS modulaire.
Cet outil est construit autour d&#8217;un parseur CSS, d&#8217;un arbre syntaxique
et d&#8217;un compilateur de texte.
C&#8217;est la mÃªme recette qui a participÃ© au succÃ¨s et Ã  la richesse fonctionnelle
d&#8217;outils comme <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-uglify-js2"  text:visited-style-name="Visited_20_Internet_20_Link">UglifyJS</text:a> et <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-eslint"  text:visited-style-name="Visited_20_Internet_20_Link">ESLint</text:a>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Avec une ou plusieurs extension(s), vous basculez d&#8217;un optimiseur de code
vers la possibilitÃ© de crÃ©er votre propre prÃ©processeur, comme&#160;Sass&#160;!</text:p>
<text:bookmark text:name="ref-autoprefixer" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">autoprefixer</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">autoprefixer</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/autoprefixer" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/autoprefixer</text:a></text:span>) est <text:span text:style-name="T4">le</text:span> module qui
vous Ã©pargnera l&#8217;Ã©criture de centaines de lignes CSS.
Il ajoute automatiquement les prÃ©fixes navigateurs aux bons endroits&#160;:
<text:span text:style-name="CodeDansTexte">-webkit</text:span>, <text:span text:style-name="CodeDansTexte">-moz</text:span>, etc.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">autoprefixer</text:span> s&#8217;utilise comme extension au module <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-postcss"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="T4">PostCSS</text:span></text:a>,
en ligne de commande ou comme module&#160;Node.</text:p>
<text:p text:style-name="Code">$ ../node_modules/.bin/postcss sample.css \</text:p><text:p text:style-name="Code"><text:s text:c="4"/>--use autoprefixer<text:s text:c="2"/>| grep transition</text:p><text:p text:style-name="Code"><text:s text:c="10"/>transition: font-weight 0.2s ease;</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le choix de compatibilitÃ© avec les navigateurs repose sur la variable
d&#8217;environnement <text:span text:style-name="CodeDansTexte">BROWSERSLIST</text:span>, gÃ©rÃ©e par le module <text:span text:style-name="T4">browserslist</text:span>
(<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/browserslist" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/browserslist</text:a></text:span>)&#160;:</text:p>
<text:p text:style-name="Code">$ export BROWSERSLIST='firefox &gt; 8'</text:p><text:p text:style-name="Code">$ ../node_modules/.bin/postcss sample.css \</text:p><text:p text:style-name="Code"><text:s text:c="4"/>--use autoprefixer | grep transition</text:p><text:p text:style-name="Code"><text:s text:c="5"/>-moz-transition: font-weight 0.2s ease;</text:p><text:p text:style-name="Code"><text:s text:c="10"/>transition: font-weight 0.2s ease;</text:p>
<text:bookmark text:name="ref-uncss" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">uncss</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">uncss</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/uncss" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/uncss</text:a></text:span>) est le pendant inverse d'<text:span text:style-name="T4">autoprefixer</text:span>
puisqu&#8217;il se charge de supprimer le code CSS inutilisÃ©.
Il s&#8217;utilise de maniÃ¨re autonome ou comme module <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-postcss"  text:visited-style-name="Visited_20_Internet_20_Link">PostCSS</text:a>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le module charge une ou plusieurs page(s) web, calcule la diffÃ©rence entre
les rÃ¨gles utilisÃ©es et celles qui ne le sont pas.
Vous Ãªtes libre de mentionner une liste blanche de rÃ¨gles Ã  ne jamais supprimer.</text:p>
<text:bookmark text:name="ref-csswring" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">csswring</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">csswring</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/csswring" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/csswring</text:a></text:span>) est un minifieur de code CSS
qui s&#8217;interface lui aussi avec <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-postcss"  text:visited-style-name="Visited_20_Internet_20_Link">PostCSS</text:a>.
Vous lui donnez du code, il en ressort une version avec le minimum de caractÃ¨res
possible.</text:p>
<text:bookmark text:name="ref-google_closure_compiler_js" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">google-closure-compiler-js</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">Google Closure Compiler</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/google-closure-compiler-js" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/google-closure-compiler-js</text:a></text:span>)
est un compilateur ECMAScript plus poussÃ© qu'<text:span text:style-name="T4">UglifyJS</text:span> mais qui impose un
style d&#8217;Ã©criture plus strict, voire plus contraignant.
Ses optimisations sont en gÃ©nÃ©ral bien plus poussÃ©es et permettent d&#8217;atteindre
des niveaux de finesse difficiles Ã  obtenir autrement.</text:p>
<text:bookmark text:name="ref-csso" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">csso</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">csso</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/csso" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/csso</text:a></text:span>) est une alternative Ã  <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-csswring"  text:visited-style-name="Visited_20_Internet_20_Link">csswring</text:a>,
Ã©crite par l&#8217;Ã©quipe derriÃ¨re la mÃ©thodologie BEM (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://en.bem.info" text:visited-style-name="Visited_20_Internet_20_Link">https://en.bem.info</text:a></text:span>).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">csso</text:span> ira jusqu&#8217;Ã  rÃ©Ã©crire les codes couleurs, les <text:span text:style-name="CodeDansTexte">margin</text:span> et <text:span text:style-name="CodeDansTexte">padding</text:span> et
factorisera les sÃ©lecteurs similaires.</text:p>
<text:bookmark text:name="ref-svgo" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">svgo</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">svgo</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://www.npmjs.com/svgo" text:visited-style-name="Visited_20_Internet_20_Link">https://www.npmjs.com/svgo</text:a></text:span>) s&#8217;attaque au nettoyage des fichiers
graphiques vectoriels au format SVG.
Il simplifie les chemins et supprime les attributs et dÃ©clarations superflues.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Vous pouvez l&#8217;essayer en ligne sur <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://jakearchibald.github.io/svgomg/" text:visited-style-name="Visited_20_Internet_20_Link">https://jakearchibald.github.io/svgomg/</text:a></text:span>
ou l&#8217;intÃ©grer comme extension Ã  <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-postcss"  text:visited-style-name="Visited_20_Internet_20_Link">PostCSS</text:a>.</text:p>
<text:bookmark text:name="ref-wawoff2" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">wawoff2</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">wawoff2</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/wawoff2" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/wawoff2</text:a></text:span>) optimise des polices de caractÃ¨res
pour le Web.
Le module convertit des polices au format TTF vers le format WOFF2&#160;â€“ Ã  prÃ©fÃ©rer
car plus lÃ©ger et donc rapide Ã  charger.</text:p>
<text:bookmark text:name="ref-transpiling" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Passer d&#8217;un langage Ã  un autre</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les prÃ©processeurs sont des outils de productivitÃ© pour CSS.
Ils transforment un langage plus avancÃ© dans quelque chose qui est compris
par un navigateur&#160;web.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La mÃªme chose s&#8217;applique avec la compilation ou la transpilation pour ECMAScript,
pour utiliser dÃ¨s maintenant une version du futur.</text:p>
<text:bookmark text:name="ref-less" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">less</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">less</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/less" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/less</text:a></text:span>) est un prÃ©processeur CSS.
Il gÃ¨re des variables, des <text:span text:style-name="T4">mixins</text:span>, des calculs de couleurs et des fonctions
qui encouragent une Ã©criture modulaire, plus logique et plus succincte.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">stylesheet.less</text:p><text:p text:style-name="Code">@warning-color: red;</text:p><text:p text:style-name="Code">@base-font-size: 18px;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">.btn {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>border: 1px solid black;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>border-radius: @base-font-size / 6;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>font-size: @base-font-size;</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>&amp;--large {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>font-size: @base-font-size * 1.5;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>&amp;--warning {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>border-color: fadeout(@warning-color, 10%);</text:p><text:p text:style-name="Code"><text:s text:c="4"/>color: @warning-color;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">}</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exÃ©cutable <text:span text:style-name="CodeDansTexte">lessc</text:span> compile le fichier <text:span text:style-name="T4">less</text:span>:</text:p>
<text:p text:style-name="Code">$ ../node_modules/.bin/lessc stylesheet.less</text:p>
<text:bookmark text:name="ref-sass" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">sass</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">sass</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/node-sass" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/node-sass</text:a></text:span>) est un autre prÃ©processeur CSS.
Il est issu du monde Ruby et est dÃ©sormais tout aussi puissant dans Node
grÃ¢ce Ã  <text:span text:style-name="T4">LibSass</text:span>, un module rapide et portable Ã©crit en&#160;C&#43;&#43;.</text:p>
<text:bookmark text:name="ref-browserify_2" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">browserify</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">browserify</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/browserify" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/browserify</text:a></text:span>) transforme des modules et du
code initialement Ã©crit pour Node vers du code exÃ©cutable dans un navigateur&#160;web.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Un puissant mÃ©canisme de transformations Ã©tend ses capacitÃ©s au coup par&#160;coup.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="Remarque">Nous en parlons plus en dÃ©tail dans la section
<text:span text:style-name=""><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-browserify"  text:visited-style-name="Visited_20_Internet_20_Link">Importer des modules&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> pour le Web</text:a></text:span>
au <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chapter-09"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;9</text:a>.</text:p>
<text:bookmark text:name="ref-babel" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">babel</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">babel</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/babel" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/babel</text:a></text:span>) est un outil qui permet de passer
d&#8217;une version d&#8217;ECMAScript Ã  une autre, fonctionnalitÃ© par fonctionnalitÃ©.
C&#8217;est un outil indispensable pour Ã©crire un code moderne et le faire
fonctionner dans des navigateurs anciens.</text:p>
<text:bookmark text:name="ref-typescript" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">typescript</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">TypeScript</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/typescript" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/typescript</text:a></text:span>) est un langage de programmation
typÃ©.
Toute structure utilisÃ©e est dÃ©crite avec un schÃ©ma que TypeScript valide.
Nous sommes prÃ©venuÂ·eÂ·s des erreurs avant mÃªme d&#8217;avoir exÃ©cutÃ© notre code
car l&#8217;outillage sait si on manipule des donnÃ©es qui existent.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Au final, le code est transformÃ© en ECMAScript et exÃ©cutÃ© en tant que tel.
Le code est tellement propre que nous pouvons arrÃªter d&#8217;utiliser TypeScript
du jour au lendemain et travailler sur le code qu&#8217;il aura gÃ©nÃ©rÃ© sans aucun problÃ¨me.</text:p>
<text:bookmark text:name="ref-fs" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">GÃ©rer des fichiers</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ces bibliothÃ¨ques nous aident Ã  Ã©crire moins de lignes de code
pour des besoins quotidiens de manipulation de fichiers.</text:p>
<text:bookmark text:name="ref-mkdirp" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">mkdirp</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">mkdirp</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/mkdirp" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/mkdirp</text:a></text:span>) est identique Ã  la
commande Unix <text:span text:style-name="CodeDansTexte">mkdir -p</text:span>, c&#8217;est-Ã -dire que les rÃ©pertoires seront crÃ©Ã©s rÃ©cursivement
s&#8217;ils n&#8217;existent pas au prÃ©alable.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Si nous utilisions le module Node&#160;<text:span text:style-name="CodeDansTexte">fs</text:span>, nous devrions crÃ©er l&#8217;arborescence de
rÃ©pertoires par nous-mÃªme, niveau par niveau.</text:p>
<text:bookmark text:name="ref-rimraf" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">rimraf</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">rimraf</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/rimraf" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/rimraf</text:a></text:span>) est le pendant opposÃ© de <text:span text:style-name="T4">mkdirp</text:span>.
Il supprime une arborescence de maniÃ¨re rÃ©cursive.
C&#8217;est l&#8217;Ã©quivalent de la commande Unix&#160;<text:span text:style-name="CodeDansTexte">rm -rf</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Si nous utilisions le module Node&#160;<text:span text:style-name="CodeDansTexte">fs</text:span>, nous devrions supprimer d&#8217;abord
les fichiers puis les rÃ©pertoires, un par&#160;un.</text:p>
<text:bookmark text:name="ref-glob" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">glob</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">glob</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/glob" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/glob</text:a></text:span>) est un utilitaire pour obtenir
une liste de fichiers en utilisant des motifs.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">glob.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {promisify} = require('util');</text:p><text:p text:style-name="Code">const glob = promisify(require('glob'));</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">glob('*.js').then(console.log);<text:s text:c="5"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">glob('re*.js').then(console.log);<text:s text:c="3"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">glob('sample.*').then(console.log); <text:span text:style-name="PuceCode">3</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Affiche une liste de fichiers dont l&#8217;extension est&#160;<text:span text:style-name="CodeDansTexte">.js</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Affiche une liste de fichiers qui commencent par&#160;<text:span text:style-name="CodeDansTexte">re</text:span> et dont l&#8217;extension est&#160;<text:span text:style-name="CodeDansTexte">.js</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche une liste de fichiers qui s&#8217;appellent <text:span text:style-name="CodeDansTexte">sample</text:span>, peu importe leur extension.<text:line-break/></text:p>
<text:bookmark text:name="ref-fs_extra" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">fs-extra</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">fs-extra</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/fs-extra" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/fs-extra</text:a></text:span>) est une collection
de fonctions pour gÃ©rer les opÃ©rations de fichiers.
Le module inclut <text:span text:style-name="T4">rimraf</text:span> et <text:span text:style-name="T4">mkdirp</text:span> en plus d&#8217;autres fonctions rÃ©cursives,
pour copier, dÃ©placer ou supprimer des fichiers.</text:p>
<text:bookmark text:name="ref-graceful_fs" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">graceful-fs</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">graceful-fs</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/graceful-fs" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/graceful-fs</text:a></text:span>) est identique
au module Node&#160;<text:span text:style-name="CodeDansTexte">fs</text:span>.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La diffÃ©rence se situe sous le capot&#160;: le module gÃ¨re les dÃ©faillances
du systÃ¨me et tente d&#8217;accÃ©der Ã  nouveau aux ressources demandÃ©es
si les erreurs sont liÃ©es Ã  des problÃ¨mes de performance.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">C&#8217;est un module Ã  utiliser si notre application dÃ©pend fortement de la disponibilitÃ©
du systÃ¨me de fichiers et si celui-ci est fortement sollicitÃ©.</text:p>
<text:bookmark text:name="ref-chokidar" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">chokidar</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">chokidar</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/chokidar" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/chokidar</text:a></text:span>) crÃ©e des observateurs du
systÃ¨me de fichiers.
Il gÃ¨re les diffÃ©rences des systÃ¨mes d&#8217;exploitation et nous permet d&#8217;Ã©crire
un seul et mÃªme code.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">C&#8217;est la bibliothÃ¨que vers laquelle se tourner lorsque nous avons besoin
de dÃ©clencher des actions quand des fichiers sont modifiÃ©s.</text:p>
<text:bookmark text:name="ref-databases" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Stocker dans des bases de donnÃ©es</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Node sait communiquer avec tout type de bases de donnÃ©es grÃ¢ce Ã  l&#8217;Ã©cosystÃ¨me&#160;<text:span text:style-name="CodeDansTexte">npm</text:span>.
PrÃ©fÃ©rez les modules faisant Ã©tat de pilote natif/binaire&#160;â€“
le transfert de donnÃ©es n&#8217;en sera que plus rapide.</text:p>
<text:bookmark text:name="ref-db_migrate" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">db-migrate</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">db-migrate</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/db-migrate" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/db-migrate</text:a></text:span>) est un outil de gestion
de migrations pour MySQL, SQLite, MongoDB et PostgreSQL.
Ã€ l&#8217;aide de scripts de migration, il rend reproductibles des changements
de structure dans une base de donnÃ©es&#160;â€“ ajout ou suppression de champ, de table
ou d&#8217;index.</text:p>
<text:bookmark text:name="ref-knex" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">knex</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">knex</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/knex" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/knex</text:a></text:span>) propose d&#8217;interagir et d&#8217;interroger
des bases de donnÃ©es SQL comme PostgreSQL, MariaDB, MySQL et SQLite.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les requÃªtes s&#8217;Ã©crivent en SQL pur ou en utilisant une API dite <text:span text:style-name="">fluide</text:span>,
pour ne pas Ã©crire le SQL Ã  la&#160;main.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">knex.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {join} = require('path');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const db = require('knex')({</text:p><text:p text:style-name="Code"><text:s text:c="2"/>client: 'sqlite3',<text:s text:c="28"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>connection: {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>filename: join(__dirname, 'sample.sqlite')<text:s text:c="2"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">Promise.all([</text:p><text:p text:style-name="Code"><text:s text:c="2"/>db('books').where('title', 'like', '%Node%'), <text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>db('books').count('title as count').first(),<text:s text:c="2"/><text:span text:style-name="PuceCode">4</text:span></text:p><text:p text:style-name="Code">])</text:p><text:p text:style-name="Code">.then(([rows, count]) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log(rows);<text:s text:c="28"/><text:span text:style-name="PuceCode">5</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log(count);<text:s text:c="27"/><text:span text:style-name="PuceCode">6</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>db.destroy();</text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> Indique que nous allons nous connecter Ã  une base de donnÃ©es de type SQLite.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> SpÃ©cifie l&#8217;emplacement de la base de donnÃ©es.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Effectue une recherche floue sur les lignes dont le titre contient le mot&#160;<text:span text:style-name="CodeDansTexte">'Node'</text:span>.<text:line-break/><text:span text:style-name="PuceCode">4</text:span> Compte le nombre de lignes et retourne le premier (et seul) rÃ©sultat de la requÃªte.<text:line-break/><text:span text:style-name="PuceCode">5</text:span> Affiche <text:span text:style-name="CodeDansTexte">[ { id: 1, title: 'Node.js ', created_at: '2018-07-11 10:34:33' } ]</text:span>.<text:line-break/><text:span text:style-name="PuceCode">6</text:span> Affiche <text:span text:style-name="CodeDansTexte">{ count: 3 }</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-bookshelf" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">bookshelf</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">bookshelf</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/bookshelf" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/bookshelf</text:a></text:span>) est une surcouche Ã  <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-knex"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="T4">Knex</text:span></text:a>,
Ã©crite par les mÃªmes personnes.
Elle modÃ©lise les donnÃ©es sous forme d&#8217;objets et de schÃ©mas (ORM) pour
automatiser des actions et ajouter plus d'<text:span text:style-name="">intelligence</text:span> Ã  notre modÃ¨le de donnÃ©es.</text:p>
<text:bookmark text:name="ref-sequelize" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">sequelize</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">sequelize</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/sequelize" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/sequelize</text:a></text:span>) est une alternative
Ã  <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-knex"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="T4">Knex</text:span></text:a> et Ã  <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-bookshelf"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="T4">Bookshelf</text:span></text:a>.
Elle gÃ¨re des schÃ©mas de donnÃ©es de maniÃ¨re optionnelle, mais aussi les migrations.
Ces derniÃ¨res permettent de scripter les changements de structure d&#8217;une base
de donnÃ©es, de les tester en local avant de les jouer en production.</text:p>
<text:bookmark text:name="ref-mongoose" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">mongoose</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">mongoose</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/mongoose" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/mongoose</text:a></text:span>) sert Ã  composer des modÃ¨les
de donnÃ©es pour la base de donnÃ©es MongoDB&#160;â€“ dite NoSQL.
Elle dÃ©finit des comportements annexes comme des mixins
ou des <text:span text:style-name="T4">accesseurs</text:span> dynamiques.</text:p>
<text:bookmark text:name="ref-levelup" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">levelup</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">LevelDB</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/levelup" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/levelup</text:a></text:span>) est un systÃ¨me de bases de
donnÃ©es clÃ©/valeur extrÃªmement modulaire.
Le stockage se fait sur disque par dÃ©faut, mais il peut Ã©voluer vers du stockage
en mÃ©moire (module <text:span text:style-name="CodeDansTexte">memdown</text:span>) ou mÃªme dans un navigateur web (avec IndexedDB).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">levelup.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const levelup = require('levelup');</text:p><text:p text:style-name="Code">const memdown = require('memdown');</text:p><text:p text:style-name="Code">const encode = require('encoding-down');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const db = levelup(encode(memdown(),<text:s text:c="10"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>{ valueEncoding: 'json' }</text:p><text:p text:style-name="Code">));</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">Promise.all([</text:p><text:p text:style-name="Code"><text:s text:c="2"/>db.put('node', {title: 'Node.js'}),</text:p><text:p text:style-name="Code"><text:s text:c="2"/>db.put('css', {title: 'CSS maintenables'}),</text:p><text:p text:style-name="Code"><text:s text:c="2"/>db.put('opensky', {title: 'Open Sky'}),</text:p><text:p text:style-name="Code">])</text:p><text:p text:style-name="Code">.then(() =&gt; db.get('node'))<text:s text:c="19"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">.then(result =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log(result);<text:s text:c="24"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> CrÃ©e la connexion Ã  la base de donnÃ©es en mÃ©moire.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Recherche un enregistrement aprÃ¨s l&#8217;avoir enregistrÃ© en mÃ©moire.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Affiche <text:span text:style-name="CodeDansTexte">{ title: 'Node.js' }</text:span>.<text:line-break/></text:p>
<text:bookmark text:name="ref-redis" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">redis</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">redis</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/redis" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/redis</text:a></text:span>) est un gestionnaire de bases de donnÃ©es
clÃ©s/valeurs distribuÃ©es et performantes.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">redis.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const client = require('redis').createClient();</text:p><text:p text:style-name="Code">const hset = require('util').promisify(client.hset);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">Promise.all([</text:p><text:p text:style-name="Code"><text:s text:c="2"/>hset('book:node', 'title', 'Node.js'),</text:p><text:p text:style-name="Code"><text:s text:c="2"/>hset('book:css', 'title', 'CSS maintenables'),</text:p><text:p text:style-name="Code"><text:s text:c="2"/>hset('book:opensky', 'title', 'Open Sky')</text:p><text:p text:style-name="Code">])</text:p><text:p text:style-name="Code">.then(() =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log('Enregistrements crÃ©Ã©s.');</text:p><text:p text:style-name="Code"><text:s text:c="2"/>client.end();</text:p><text:p text:style-name="Code">});</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">hiredis</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/hiredis" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/hiredis</text:a></text:span>) est un pilote C&#43;&#43; qui
augmente les performances de connexion Ã  une base de donnÃ©es&#160;<text:span text:style-name="T4">redis</text:span>.</text:p>
<text:bookmark text:name="ref-elasticsearch" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">elasticsearch</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">elasticsearch</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/elasticsearch" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/elasticsearch</text:a></text:span>) est un client pour
simplifier la connexion Ã  une base de donnÃ©es Elasticsearch.
Une base de ce type est particuliÃ¨rement adaptÃ©e Ã  l&#8217;indexation des donnÃ©es,
pour des recherches performantes et complexes.</text:p>
<text:bookmark text:name="ref-cli" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Ligne de commande</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ces modules complÃ¨tent le panorama dÃ©jÃ  trÃ¨s variÃ© prÃ©sentÃ©
dans le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-../chapter-08/index.adoc"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;8</text:a>.</text:p>
<text:bookmark text:name="ref-yargs_parser" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">yargs-parser</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">yargs-parser</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/yargs-parser" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/yargs-parser</text:a></text:span>) est le module
d&#8217;interprÃ©tation des arguments utilisÃ© par le module <text:span text:style-name="T4">yargs</text:span>.
C&#8217;est une alternative plus puissante et plus complexe que <text:span text:style-name="T4">minimist</text:span>.</text:p>
<text:bookmark text:name="ref-args_2" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">args</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">args</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/args" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/args</text:a></text:span>) est un module minimaliste
pour interprÃ©ter les arguments, les structurer et afficher une aide
claire Ã  nos utilisateurs et utilisatrices.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cerise sur le gÃ¢teau&#160;: le module suggÃ¨re un choix de commande en cas
d&#8217;erreur de frappe.</text:p>
<text:bookmark text:name="ref-caporal" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">caporal</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">caporal</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/caporal" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/caporal</text:a></text:span>) est un framework complet
pour bÃ¢tir des applications en ligne de commandes.
Il gÃ¨re les classiques arguments et options ainsi que les sous-commandes,
les types de valeurs et l&#8217;autocomplÃ©tion.</text:p>
<text:bookmark text:name="ref-promptly" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">promptly</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">promptly</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/promptly" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/promptly</text:a></text:span>) est un utilitaire pour
poser des questions, valider et travailler avec les rÃ©ponses obtenues.
Il est minimaliste et a un faible nombre de dÃ©pendances.</text:p>
<text:bookmark text:name="ref-supports_color" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">supports-color</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">supports-color</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/supports-color" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/supports-color</text:a></text:span>) vÃ©rifie
si le contexte d&#8217;exÃ©cution du programme en ligne de commande
supporte les couleurs.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cela nous Ã©vite d&#8217;envoyer des codes ANSI, qui, seraient affichÃ©s
au lieu d&#8217;Ãªtre interprÃ©tÃ©s comme des couleurs.</text:p>
<text:bookmark text:name="ref-webapp" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Applications&#160;web</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ces modules complÃ¨tent le panorama dÃ©jÃ  trÃ¨s variÃ© prÃ©sentÃ©
dans le <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-../chapter-07/index.adoc"  text:visited-style-name="Visited_20_Internet_20_Link">chapitre&#160;7</text:a>.</text:p>
<text:bookmark text:name="ref-fastify" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">fastify</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">fastify</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/fastify" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/fastify</text:a></text:span>) est un framework
inspirÃ© de <text:span text:style-name="T4">Express</text:span>.
Il se focalise sur la simplicitÃ© de l&#8217;expÃ©rience de dÃ©veloppement et sur
de hautes performances.
Il sait valider les donnÃ©es sortantes Ã  l&#8217;aide de schÃ©mas.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Pour aller au-delÃ  des donnÃ©es, il se combine avec le module <text:span text:style-name="T4">point-of-view</text:span>
(<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/point-of-view" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/point-of-view</text:a></text:span>).
Vous avez ainsi accÃ¨s Ã  l&#8217;utilisation de <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-templating"  text:visited-style-name="Visited_20_Internet_20_Link">modules de templating</text:a>.</text:p>
<text:bookmark text:name="ref-passport" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">passport</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">passport</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/passport" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/passport</text:a></text:span>) est une bibliothÃ¨que modulaire
d&#8217;authentification pour <text:span text:style-name="T4">Express</text:span>.
Elle se branche Ã  diffÃ©rents mÃ©canismes pour vÃ©rifier les utilisateurs&#160;:
utilisateur et mot de passe, compte GitHub, Twitter, OAuth, etc.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les sessions d&#8217;utilisateurs se gÃ¨rent Ã  cÃ´tÃ©&#160;â€“ pour mÃ©moriser
qui est connectÃ© ou non, et avec quel identifiant sÃ©curisÃ© et unique.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">RÃ©fÃ©rez-vous Ã  sa documentation pour des exemples dÃ©taillÃ©s d&#8217;utilisation.</text:p>
<text:bookmark text:name="ref-restify" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">restify</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">restify</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/restify" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/restify</text:a></text:span>) est un framework web
spÃ©cialisÃ© dans la crÃ©ation d&#8217;API&#160;HTTP.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Il gÃ¨re les versions de routes et expose un client permettant de consommer
des donnÃ©es sur d&#8217;autres API&#160;REST&#160;â€“ proxy.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">restify.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const restify = require('restify');</text:p><text:p text:style-name="Code">const {NotFoundError} = require('restify-errors');</text:p><text:p text:style-name="Code">const server = restify.createServer();</text:p><text:p text:style-name="Code">const countries = require('i18n-iso-countries');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const responseV1 = (request, response, next) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const codes = countries.getNames('en');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>if (codes[request.params.code] === undefined) {</text:p><text:p text:style-name="Code"><text:s text:c="4"/>return next(new NotFoundError('Country not found'));</text:p><text:p text:style-name="Code"><text:s text:c="2"/>}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>response.send(200, codes[request.params.code]);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>next();</text:p><text:p text:style-name="Code">};</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">server.get({ path: '/:code', version: '1.0.0' }, responseV1);</text:p><text:p text:style-name="Code">server.listen(8080, () =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>console.log('Serveur accessible sur %s', server.url);</text:p><text:p text:style-name="Code">});</text:p>
<text:bookmark text:name="ref-faye" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">faye</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">faye</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/faye" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/faye</text:a></text:span>) est un serveur WebSocket pour communiquer
en temps rÃ©el entre un client et un serveur.
Il sait dÃ©brayer vers Ajax ou JSON-P pour les navigateurs anciens qui
ne comprennent pas WebSocket.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">faye.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const http = require('http');</text:p><text:p text:style-name="Code">const faye = require('faye');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const ws = new faye.NodeAdapter({</text:p><text:p text:style-name="Code"><text:s text:c="2"/>mount: '/realtime', timeout: 10</text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const server = http.createServer((req, res) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>res.writeHead(200, { 'Content-Tyoe': 'text/plain' });</text:p><text:p text:style-name="Code"><text:s text:c="2"/>res.end('Contenu non temps rÃ©el');</text:p><text:p text:style-name="Code">});</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">ws.attach(server);</text:p><text:p text:style-name="Code">server.listen(3000);</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cet exemple de serveur minimaliste expose un point d&#8217;entrÃ©e auquel on peut accÃ©der
via le client <text:span text:style-name="T4">Faye</text:span>, dans un navigateur ou via un autre script&#160;Node.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Tout message Ã©mit par un client sera relayÃ© auprÃ¨s des autres clients
connectÃ©s.</text:p>
<text:bookmark text:name="ref-swagger_client" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">swagger-client</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">swagger-client</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/swagger-client" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/swagger-client</text:a></text:span>) sert Ã  valider
des requÃªtes et des rÃ©ponses HTTP en fonction de schÃ©mas qui rÃ©pondent
Ã  la spÃ©cification OpenAPI.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Cette spÃ©cification permet entre autres de gÃ©rer automatiquement les routes
de notre application pour nous concentrer sur le code qui gÃ©nÃ¨re les donnÃ©es de sortie.</text:p>
<text:bookmark text:name="ref-templating" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Modules front-end et templating</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Les bibliothÃ¨ques de templating proposent d&#8217;associer
une structure de donnÃ©es Ã  une logique de prÃ©sentation.
Pour la plupart, elles fonctionnent aussi bien sous Node que dans les navigateurs,
ce qui est une excellente nouvelle pour partager des comportements d&#8217;affichage
entre les deux environnements.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Tous les modules que nous allons voir gÃ©nÃ©reront cette sortie&#160;HTML&#160;:</text:p>
<text:p text:style-name="Code">&lt;!DOCTYPE html&gt;</text:p><text:p text:style-name="Code">&lt;html&gt;</text:p><text:p text:style-name="Code">&lt;head&gt;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;title&gt;Template demo&lt;/title&gt;</text:p><text:p text:style-name="Code">&lt;/head&gt;</text:p><text:p text:style-name="Code">&lt;body&gt;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;ul&gt;</text:p><text:p text:style-name="Code"><text:s text:c="4"/>&lt;li&gt;CSS maintenables&lt;/li&gt;</text:p><text:p text:style-name="Code"><text:s text:c="4"/>&lt;li&gt;Node.js&lt;/li&gt;</text:p><text:p text:style-name="Code"><text:s text:c="4"/>&lt;li&gt;Open Sky&lt;/li&gt;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;/ul&gt;</text:p><text:p text:style-name="Code">&lt;/body&gt;</text:p><text:p text:style-name="Code">&lt;/html&gt;</text:p>
<text:bookmark text:name="ref-nunjucks" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">nunjucks</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">nunjucks</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/nunjucks" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/nunjucks</text:a></text:span>) est un portage de <text:span text:style-name="T4">Jinja</text:span>,
bibliothÃ¨que bien connue par les adeptes de Python.
Sa syntaxe inclut des fonctionnalitÃ©s comme les filtres, les blocs ou
l&#8217;hÃ©ritage de gabarit.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">template.html</text:p><text:p text:style-name="Code">&lt;!DOCTYPE html&gt;</text:p><text:p text:style-name="Code">&lt;html&gt;</text:p><text:p text:style-name="Code">&lt;head&gt;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;title&gt;{{ title | default('Template demo') | capitalize }}&lt;/title&gt;</text:p><text:p text:style-name="Code">&lt;/head&gt;</text:p><text:p text:style-name="Code">&lt;body&gt;</text:p><text:p text:style-name="Code">{% set items = ['Node.js', 'CSS maintenables', 'Open Sky'] -%}</text:p><text:p text:style-name="Code">&lt;ul&gt;</text:p><text:p text:style-name="Code">{% for item in items|sort -%}</text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;li&gt;{{ item }}&lt;/li&gt;</text:p><text:p text:style-name="Code">{% endfor -%}</text:p><text:p text:style-name="Code">&lt;/ul&gt;</text:p><text:p text:style-name="Code">&lt;/body&gt;</text:p><text:p text:style-name="Code">&lt;/html&gt;</text:p>
<text:bookmark text:name="ref-handlebars" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">handlebars</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">handlebars</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/handlebars" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/handlebars</text:a></text:span>) et son prÃ©dÃ©cesseur <text:span text:style-name="T4">mustache</text:span>
sont les vÃ©tÃ©rans du templating Node.
Leur parti pris est de proposer le minimum de logique afin que celle-ci
reste au plus prÃ¨s des donnÃ©es.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">handlebars</text:span> sait aussi prÃ©compiler les gabarits sous forme de fonctions ECMAScript.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">template.hbs</text:p><text:p text:style-name="Code">&lt;!DOCTYPE html&gt;</text:p><text:p text:style-name="Code">&lt;html&gt;</text:p><text:p text:style-name="Code">&lt;head&gt;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;title&gt;{{#if title}}{{title}}{{else}}Template demo{{/if}}&lt;/title&gt;</text:p><text:p text:style-name="Code">&lt;/head&gt;</text:p><text:p text:style-name="Code">&lt;body&gt;</text:p><text:p text:style-name="Code">&lt;ul&gt;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>{{#each items}}</text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;li&gt;{{.}}&lt;/li&gt;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>{{/each}}</text:p><text:p text:style-name="Code">&lt;/ul&gt;</text:p><text:p text:style-name="Code">&lt;/body&gt;</text:p><text:p text:style-name="Code">&lt;/html&gt;</text:p>
<text:bookmark text:name="ref-pug" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">pug</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">pug</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/pug" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/pug</text:a></text:span>) opte pour un parti minimaliste qui
repose entiÃ¨rement sur l&#8217;indentation.
Son mÃ©canisme de blocs facilite la rÃ©utilisation d&#8217;Ã©lÃ©ments de prÃ©sentation.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">template.pug</text:p><text:p text:style-name="Code">doctype html</text:p><text:p text:style-name="Code">html</text:p><text:p text:style-name="Code"><text:s text:c="2"/>head</text:p><text:p text:style-name="Code"><text:s text:c="4"/>title= title || 'Template demo'</text:p><text:p text:style-name="Code"><text:s text:c="2"/>body</text:p><text:p text:style-name="Code"><text:s text:c="4"/>ul</text:p><text:p text:style-name="Code"><text:s text:c="6"/>each item in ['Node.js', 'CSS maintenables', 'Open Sky']</text:p><text:p text:style-name="Code"><text:s text:c="8"/>li= item</text:p>
<text:bookmark text:name="ref-ejs" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">ejs</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">ejs</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/ejs" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/ejs</text:a></text:span>) part du principe qu&#8217;il n&#8217;y a pas besoin
d&#8217;un langage de templating autre qu&#8217;ECMAScript.
Donc c&#8217;est tout simplement ce qui vous sera proposÃ©, impliquant de ce fait
une faible courbe d&#8217;apprentissage.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">template.ejs</text:p><text:p text:style-name="Code">&lt;!DOCTYPE html&gt;</text:p><text:p text:style-name="Code">&lt;html&gt;</text:p><text:p text:style-name="Code">&lt;head&gt;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;title&gt;&lt;%= typeof title === 'string' ? title : 'Template demo' %&gt;&lt;/title&gt;</text:p><text:p text:style-name="Code">&lt;/head&gt;</text:p><text:p text:style-name="Code">&lt;body&gt;</text:p><text:p text:style-name="Code">&lt;ul&gt;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;% ['Node.js', 'CSS maintenables', 'Open Sky'].forEach((item) =&gt; { -%&gt;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;li&gt;&lt;%= item %&gt;&lt;/li&gt;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;% }); -%&gt;</text:p><text:p text:style-name="Code">&lt;/ul&gt;</text:p><text:p text:style-name="Code">&lt;/body&gt;</text:p><text:p text:style-name="Code">&lt;/html&gt;</text:p>
<text:bookmark text:name="ref-react_2" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">react</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">React</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/react" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/react</text:a></text:span>) est une bibliothÃ¨que de prÃ©sentation
dite <text:span text:style-name="">rÃ©active</text:span> et orientÃ©e composants.
Elle gÃ©nÃ¨re un arbre visuel Ã  partir de donnÃ©es passÃ©es en entrÃ©e.
Cet arbre est ensuite transformÃ© en HTML, en interface iOS ou Android, entre autres.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">template.jsx</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const React = require('react');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const BookList = ({books=[]}) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>return (&lt;ul&gt;</text:p><text:p text:style-name="Code"><text:s text:c="4"/>{books.map((bookName, i) =&gt; (</text:p><text:p text:style-name="Code"><text:s text:c="6"/>&lt;li key={i}&gt;{bookName}&lt;/li&gt;</text:p><text:p text:style-name="Code"><text:s text:c="4"/>))}</text:p><text:p text:style-name="Code"><text:s text:c="2"/>&lt;/ul&gt;);</text:p><text:p text:style-name="Code">}</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">module.exports = ({title, books}) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>return (</text:p><text:p text:style-name="Code"><text:s text:c="4"/>&lt;html&gt;</text:p><text:p text:style-name="Code"><text:s text:c="6"/>&lt;head&gt;</text:p><text:p text:style-name="Code"><text:s text:c="8"/>&lt;title&gt;{title || 'Template demo'}&lt;/title&gt;</text:p><text:p text:style-name="Code"><text:s text:c="6"/>&lt;/head&gt;</text:p><text:p text:style-name="Code"><text:s text:c="6"/>&lt;body&gt;</text:p><text:p text:style-name="Code"><text:s text:c="8"/>&lt;BookList books={books} /&gt;</text:p><text:p text:style-name="Code"><text:s text:c="6"/>&lt;/body&gt;</text:p><text:p text:style-name="Code"><text:s text:c="4"/>&lt;/html&gt;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>);</text:p><text:p text:style-name="Code">};</text:p>
<text:bookmark text:name="ref-storybook" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">storybook</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">storybook</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://github.com/storybooks/storybook" text:visited-style-name="Visited_20_Internet_20_Link">https://github.com/storybooks/storybook</text:a></text:span>) complÃ¨te <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-react"  text:visited-style-name="Visited_20_Internet_20_Link">React</text:a>
et d&#8217;autres frameworks de <text:span text:style-name="T4">templating</text:span> en crÃ©ant un catalogue de composants
auto-documentÃ©s.
Les composants sont affichÃ©s en mÃªme temps que le code nÃ©cessaire pour les utiliser
dans une autre application.</text:p>
<text:bookmark text:name="ref-testing" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Tester notre code</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le module <text:span text:style-name="CodeDansTexte">assert</text:span> intÃ©grÃ© Ã  Node suffit pour dÃ©marrer.
Il existe cependant tout un outillage pour tester notre code Ã  destination de
Node (tests unitaires) ou des navigateurs (tests fonctionnels) ainsi que pour
Ã©crire des assertions plus facilement.</text:p>
<text:bookmark text:name="ref-tape" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">tape</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">tape</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/tape" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/tape</text:a></text:span>) est une bibliothÃ¨que
d&#8217;exÃ©cution de tests minimaliste qui se base sur le
<text:span text:style-name="T4">Test Anything Protocol</text:span> (<text:span text:style-name="T4">TAP</text:span>, <text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://testanything.org" text:visited-style-name="Visited_20_Internet_20_Link">https://testanything.org</text:a></text:span>).
Elle embarque aussi le minimum vital pour Ã©crire des assertions.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">tape.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const test = require('tape');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">test('Date test', (t) =&gt; {<text:s text:c="29"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>t.plan(1);</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>t.ok(Date.now() &gt; new Date('2013-03-24').getTime()); <text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> CrÃ©ation d&#8217;un test.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Ã‰criture d&#8217;une assertion.<text:line-break/></text:p>
<text:bookmark text:name="ref-chai" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">chai</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">chai</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/chai" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/chai</text:a></text:span>) est une bibliothÃ¨que poussÃ©e d&#8217;assertions.
Son mÃ©canisme chaÃ®ne permet de quasiment Ã©crire des phrases pour exprimer
l&#8217;intention des choses Ã  vÃ©rifier.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">chai.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const {expect} = require('chai');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">expect([1, 2]).to.be.an('array');<text:s text:c="13"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code">expect([1, 2]).to.deep.equal([1, 2]);<text:s text:c="9"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code">expect({}).to.be.an('object').and.to.be.empty;<text:span text:style-name="PuceCode">3</text:span></text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> VÃ©rification du type d&#8217;une variable.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> VÃ©rification stricte de valeur d&#8217;une variable.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Double vÃ©rification&#160;â€“ il s&#8217;agit bien d&#8217;objet et il est vide, sans clÃ©/valeur.<text:line-break/></text:p>
<text:bookmark text:name="ref-sinon" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">sinon</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">sinon</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/sinon" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/sinon</text:a></text:span>) est un compagnon idÃ©al pour
intercepter le fonctionnement interne de variables et d&#8217;objets.
Le module propose de crÃ©er des Ã©couteurs (<text:span text:style-name="T4">spys</text:span>) et des bouchons
(<text:span text:style-name="T4">stubs</text:span>, <text:span text:style-name="T4">mocks</text:span>).</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">En d&#8217;autres termes, vous prenez la main sur des portions de votre propre
code pendant la durÃ©e des tests.
Ces techniques servent pour simuler des erreurs et diffÃ©rentes situations
tout en observant le comportement rÃ©el de notre&#160;code.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="CodeTitre">sinon.js</text:p><text:p text:style-name="Code">'use strict';</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">const test = require('tape');</text:p><text:p text:style-name="Code">const sinon = require('sinon');</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">test('Date', (t) =&gt; {</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const d = Date;</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const dateTime = new Date('1983-03-24').getTime();</text:p><text:p text:style-name="Code"><text:s text:c="2"/>const stub = sinon.stub(d, 'now');<text:s text:c="4"/><text:span text:style-name="PuceCode">1</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>stub.returns(9999999999999);<text:s text:c="10"/><text:span text:style-name="PuceCode">2</text:span></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>d.now();</text:p><text:p text:style-name="Code"><text:s text:c="2"/>t.equal(stub.calledOnce, true);<text:s text:c="7"/><text:span text:style-name="PuceCode">3</text:span></text:p><text:p text:style-name="Code"><text:s text:c="2"/>t.ok(stub.returnValues[0] &gt; dateTime);</text:p><text:p text:style-name="Code"><text:s text:c="2"/>t.end();</text:p><text:p text:style-name="Code">});</text:p>
<text:p text:style-name="TexteCourant"><text:span text:style-name="PuceCode">1</text:span> CrÃ©ation d&#8217;un bouchon pour la mÃ©thode <text:span text:style-name="CodeDansTexte">now()</text:span> d&#8217;un objet&#160;<text:span text:style-name="CodeDansTexte">Date</text:span>.<text:line-break/><text:span text:style-name="PuceCode">2</text:span> Surcharge de la valeur retournÃ©e par la mÃ©thode <text:span text:style-name="CodeDansTexte">d.now()</text:span>.<text:line-break/><text:span text:style-name="PuceCode">3</text:span> Nous constatons le nombre de fois oÃ¹ la mÃ©thode <text:span text:style-name="CodeDansTexte">d.now()</text:span> a Ã©tÃ© appelÃ©e.<text:line-break/></text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le module <text:span text:style-name="T4">sinon-chai</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/sinon-chai" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/sinon-chai</text:a></text:span>)
intÃ¨gre <text:span text:style-name="T4">sinon</text:span> avec le mÃ©canisme d&#8217;assertions de&#160;<text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-chai"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="T4">chai</text:span></text:a>.</text:p>
<text:bookmark text:name="ref-nyc" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">nyc</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">nyc</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/nyc" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/nyc</text:a></text:span>) gÃ©nÃ¨re une couverture de code.
Il inspecte le code exÃ©cutÃ© pendant les tests et en dÃ©duit les portions
qui n&#8217;ont pas Ã©tÃ© visitÃ©es et, donc, qui n&#8217;ont pas Ã©tÃ© testÃ©es.
C&#8217;est un indicateur utile pour attester de la fiabilitÃ© d&#8217;une base de code
â€“ plus la couverture est importante, plus il y a de chances que les cas Ã  la marge
aient Ã©tÃ© vÃ©rifiÃ©s.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(appendix-a/images/nyc-cli.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>A-undefined.</text:span> Couverture de code visualisÃ©e dans un terminal</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">nyc</text:span> se greffe sur n&#8217;importe quelle bibliothÃ¨que d&#8217;exÃ©cution de tests.
Sous le capot, c&#8217;est le module <text:span text:style-name="T4">istanbul</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/istanbul" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/istanbul</text:a></text:span>)
qui est utilisÃ© pour effectuer les calculs de couverture de&#160;code.</text:p>
<text:p text:style-name="RemarqueFigureNumero">(appendix-a/images/nyc-web.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>A-undefined.</text:span> Couverture de code visualisÃ©e dans un navigateur&#160;web</text:p>
<text:bookmark text:name="ref-karma" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">karma</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">karma</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/karma" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/karma</text:a></text:span>) pilote l&#8217;exÃ©cution de tests
depuis un ou plusieur(s) navigateurs web.
Ces derniers (Chrome, Safari, Firefox, etc.) se pilotent sur notre ordinateur,
depuis une machine virtuelle (VirtualBox) ou mÃªme par le biais d&#8217;un service
en ligne (<text:span text:style-name="T4">SauceLabs</text:span>, <text:span text:style-name="T4">BrowserStack</text:span>, etc.).</text:p>
<text:p text:style-name="RemarqueFigureNumero">(appendix-a/images/karma.png)</text:p><text:p text:style-name="RemarqueFigureLegende"><text:span text:style-name="Numero">Figure<text:s text:c="1"/>A-undefined.</text:span> Exemple d&#8217;exÃ©cution de tests en continu avec&#160;Karma</text:p>
<text:bookmark text:name="ref-supertest" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">supertest</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">supertest</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/supertest" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/supertest</text:a></text:span>) sert Ã  tester une interface HTTP.
Le module envoie des requÃªtes et nos assertions vÃ©rifient qu&#8217;elles retournent
bien ce qui est attendu&#160;â€“ code HTTP, structure de rÃ©ponse etc.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Je trouve ce module pratique pour tester des choses qui seraient difficiles
Ã  couvrir uniquement avec des tests unitaires.</text:p>
<text:bookmark text:name="ref-internet-of-things" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Objets connectÃ©s</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Node a bÃ©nÃ©ficiÃ© de l&#8217;engouement autour des objets connectÃ©s grÃ¢ce Ã  sa nature
asynchrone et Ã  sa lÃ©gÃ¨retÃ©.
C&#8217;est une plate-forme de choix pour dialoguer ou embarquer dans des
nano-ordinateurs, rÃ©frigÃ©rateurs et autres ampoules connectÃ©es.</text:p>
<text:bookmark text:name="ref-nitrogen" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">nitrogen</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">nitrogen</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/nitrogen" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/nitrogen</text:a></text:span>) gÃ¨re les interactions entre
diffÃ©rents pÃ©riphÃ©riques, sur un mÃªme rÃ©seau local et Ã  travers Internet.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">La bibliothÃ¨que se base sur un mÃ©canisme dÃ©claratif de fonctionnalitÃ©s et de
terminaux ainsi que la publication de messages.</text:p>
<text:bookmark text:name="ref-serialport" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">serialport</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">serialport</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/serialport" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/serialport</text:a></text:span>) est la bibliothÃ¨que de base
pour communiquer avec le <text:span text:style-name="T4">port sÃ©rie</text:span> d&#8217;un appareil.
Un cÃ¢ble USB suffit ensuite pour envoyer nos instructions Ã  cet appareil.</text:p>
<text:bookmark text:name="ref-firmata" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">firmata</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">firmata</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/firmata" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/firmata</text:a></text:span>) est un <text:span text:style-name="T4">firmware</text:span>, un protocole
de communication, ainsi qu&#8217;une bibliothÃ¨que de communication pour microcontrÃ´leur
Arduino.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Le module Node apprend ainsi Ã  communiquer avec un Arduino prÃ©alablement
flashÃ© avec Firmata.
Cela nous permet notamment d&#8217;Ã©crire des applications en JavaScript au lieu
d&#8217;utiliser&#160;du&#160;C.</text:p>
<text:bookmark text:name="ref-johnny_five" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">johnny-five</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">johnny-five</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/johnny-five" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/johnny-five</text:a></text:span>) est une bibliothÃ¨que
haut&#160;niveau pour Arduino, Raspberry&#160;Pi et tout autre microcontrÃ´leur.
Elle simplifie les interactions avec des moteurs, des servo-contrÃ´leurs,
des capteurs etc.</text:p>
<text:bookmark text:name="ref-node_red" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">node-red</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">node-red</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/node-red" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/node-red</text:a></text:span>) est une interface visuelle
pour programmer des flux de donnÃ©es entre objets connectÃ©s.
Le projet Ã©mane d&#8217;employÃ©Â·eÂ·s&#160;d&#8217;IBM.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;exÃ©cutable dÃ©marre un serveur web dont l&#8217;interface nous sert Ã  relier
des sources de donnÃ©es, des rÃ©actions Ã  des Ã©vÃ©nements avec des objets prÃªts Ã 
recevoir les instructions.</text:p>
<text:bookmark text:name="ref-accessibilitÃ©" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">AccessibilitÃ©</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">L&#8217;Ã©cosystÃ¨me&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> a participÃ© Ã  un essor d&#8217;outillage liÃ© Ã  l&#8217;accessibilitÃ©
d&#8217;applications web.
Auparavant, les outils Ã©taient difficilement automatisables.</text:p>
<text:bookmark text:name="ref-a11y" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">a11y</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">a11y</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/a11y" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/a11y</text:a></text:span>) est un automate d&#8217;inspection de pages web.
Il dÃ©tecte des problÃ¨mes de contrastes, de calques qui masquent du contenu
ou d&#8217;Ã©lÃ©ments qui ne seraient pas navigables au clavier, entre autres.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">C&#8217;est un excellent outil pour amÃ©liorer la qualitÃ© d&#8217;une application tout en
l&#8217;ouvrant Ã  un public trop souvent mis de&#160;cÃ´tÃ©.</text:p>
<text:p text:style-name="Code">$ npx a11y https://oncletom.io</text:p><text:p text:style-name="Code"><text:s text:c="2"/>âœ– Controls and media elements should have labels</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"><text:s text:c="2"/>#search &gt; .form-control</text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code"></text:p><text:p text:style-name="Code">âœ” This element does not support ARIA roles</text:p><text:p text:style-name="Code">âœ” Elements with ARIA roles must be in the correct scope</text:p><text:p text:style-name="Code">âœ” This element has an invalid ARIA attribute</text:p><text:p text:style-name="Code">âœ” ARIA state and property values must be valid</text:p>
<text:bookmark text:name="ref-a11y_css" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">a11y.css</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">a11y.css</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/a11y.css" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/a11y.css</text:a></text:span>) est une feuille de styles CSS
Ã  injecter dans une page web pour rendre visible des incohÃ©rences.
Parmi ces derniÃ¨res, nous retrouvons des boutons sans intitulÃ©, l&#8217;absence
de langue du document ou encore l&#8217;absence de bouton de validation de formulaire
ou de texte alternatif d&#8217;images.</text:p>
<text:bookmark text:name="ref-lighthouse" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">lighthouse</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">lighthouse</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/lighthouse" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/lighthouse</text:a></text:span>) est l&#8217;outil d&#8217;analyse de
performances, de rÃ©fÃ©rencement (SEO) et d&#8217;accessibilitÃ© embarquÃ© dans
le navigateur web Google&#160;Chrome.</text:p>
<text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant">Ce module&#160;<text:span text:style-name="CodeDansTexte">npm</text:span> le rend utilisable depuis un terminal et Ã©crit le rapport
dans un fichier&#160;HTML.</text:p>
<text:bookmark text:name="ref-storybook_addon_a11y" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">storybook-addon-a11y</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">storybook-addon-a11y</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/storybook-addon-a11y" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/storybook-addon-a11y</text:a></text:span>)
est une extension au module <text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="#ref-storybook"  text:visited-style-name="Visited_20_Internet_20_Link"><text:span text:style-name="T4">storybook</text:span></text:a>.
Le module signale les problÃ¨mes d&#8217;accessibilitÃ© au niveau de chaque composant.
Le suivi est ainsi fait en continu, au plus proche des composants distribuÃ©s
et utilisÃ©s dans les applications.</text:p>
<text:bookmark text:name="ref-travailler_avec_des_images_des_sons_et_des_vidÃ©os" /><text:h text:style-name="TitreNiveau1" text:outline-level="2">Travailler avec des images, des sons et des vidÃ©os</text:h><text:bookmark text:name="ref-sharp" /><text:h text:style-name="TitreNiveau2" text:outline-level="3">sharp</text:h><text:bookmark text:name="ref-undefined" /><text:p text:style-name="TexteCourant"><text:span text:style-name="T4">sharp</text:span> (<text:span text:style-name="URL"><text:a xlink:type="simple" text:style-name="Internet_20_link" xlink:href="https://npmjs.com/sharp" text:visited-style-name="Visited_20_Internet_20_Link">https://npmjs.com/sharp</text:a></text:span>) est un module de redimensionnement
et de transformation d&#8217;images JPG, PNG et WebP Ã©crit en JavaScript et&#160;C&#43;&#43;.
Il ne nÃ©cessite pas de programme externe et est compatible avec une approche
en flux.</text:p></office:text>
  </office:body>
</office:document>