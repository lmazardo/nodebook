<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<title>Cr√©er un outil en ligne de commande</title>
<style>
#header,
#content,
#footer {
  margin: 2rem auto;
  max-width: 46rem;
}

#header {
  margin-top: 0;
}

.title,
#toctitle {
  color: var(--dark-accent);
}

a {
  /* white-space: nowrap; */
}

img, iframe, video, audio {
  max-width: 100%;
}

p {
  font-weight: normal;
}

/* Taken out from book.css */
dl dt {
  margin-bottom: 0.3125em;
  font-weight: bold;
}
dl dd {
  margin-bottom: 1.25em;
}

dt,
th.tableblock,
td.content,
div.footnote {
  text-rendering: optimizeLegibility;
}

.literalblock pre,
.literalblock pre[class],
.listingblock pre,
.listingblock pre[class] {
  overflow: auto;
  word-wrap: break-word;
}
.literalblock pre.nowrap,
.literalblock pre[class].nowrap,
.listingblock pre.nowrap,
.listingblock pre[class].nowrap {
  overflow-x: auto;
  white-space: pre;
  word-wrap: normal;
}

.listingblock {
  margin: 0 0 2em;
}
.listingblock > .content {
  position: relative;
}
.listingblock > .title {
  font-weight: bold;
}
.listingblock code[data-lang]::before {
  display: none;
  content: attr(data-lang);
  position: absolute;
  font-size: 0.75em;
  top: 1em;
  right: 1em;
  line-height: 1;
  text-transform: uppercase;
  color: #999;
}
.listingblock:hover code[data-lang]::before {
  display: block;
}
.listingblock.terminal pre .command::before {
  content: attr(data-prompt);
  padding-right: 0.5em;
  color: #999;
}

td.hdlist1,
td.hdlist2 {
  vertical-align: top;
  padding-right: 0.625em;
}
td.hdlist1 {
  font-weight: bold;
}
.literalblock + .colist,
.listingblock + .colist {
  margin-top: -1.5em;
}
.colist td:not([class]):first-child {
  padding: 0.4em 0.75em 0 0.75em;
  line-height: 1;
  vertical-align: top;
}
.colist td:not([class]):first-child img {
  max-width: none;
}
.colist td:not([class]):last-child {
  padding: 0.25em 0;
}

/* Custom classes */

.line-through {
  text-decoration: line-through;
}

.RemarquePreTitre,
#toctitle {
  font-style: normal;
  font-weight: bold;
}
  .RemarquePreTitre::after {
    content: "‚Ä¢";
    padding-left: 5px;
  }
.admonitionblock {
}
.admonitionblock > table,
.exampleblock {
  --commented: rgba(17, 17, 68, .65);
  --border-radius-base: 8px;

  background-color: #fafafa;
  border: 1px solid var(--dark-shade);
  border-left: none;
  border-right: none;
  margin: 1.5em 0;
  padding: 1em;
}
.exampleblock .title {
  font-weight: bold;
}
.icon .title {
  font-size: 2em;
}
  .admonitionblock > table td.icon {
    display: none;
  }

  @media screen and (min-width: 769px) {
    .admonitionblock > table td.icon {
      display: table-cell;
    }
  }

  .admonitionblock > table td.icon {
    padding-right: 1em;
  }
  .admonitionblock > table td.icon img {
    max-width: none;
  }

.colist ol {
  margin-left: 1.5em;  /* aligns with the listing edge */
  padding-left: 0;
  font-weight: bold;   /* makes it stand out more */
}
  .colist ol p {
    margin: 0 0 .5em;
  }
.listingblock:not(.prismjs) pre,
.language-bash.hljs {
  background: #323232;
  color: wheat;
  margin: 0;
  padding: 1rem;
}
.language-bash.hljs .hljs-built_in,
.language-bash.hljs .hljs-builtin-name {
  color: white;
}
.language-bash.hljs .hljs-string {
  color: lightgreen;
}
.language-bash.hljs .hljs-variable {
  color: lightskyblue;
}
.keyseq {
  font-weight: normal;
  white-space: nowrap;
}
.language-bash.hljs .keyseq {
  color: white;
}
.language-bash.hljs kbd {
  background: transparent;
  box-shadow: none;
  color: white;
  font-size: 0.8em;
  font-weight: bold;
  padding: 0.1em 0.4em;
}
.listingblock pre.highlightjs,
.listingblock.prismjs pre {
  background-color: transparent;
  margin: 0;
  padding: 0;
}
.listingblock pre.highlightjs > code,
.listingblock.prismjs .highlight {
  border-left: 4px solid var(--dark-accent);
  padding-left: 1em;
  font-size: .8em;
}
.listingblock pre.highlightjs > code.language-bash {
  border-left-color: limegreen;
}

.hdlist .hdlist1 {
  text-align: right;
  white-space: nowrap;
}

td > p:first-child {
  margin-top: 0;
}

.hljs-comment {
  font-style: normal !important;
}

#toc.toc2 a {
  text-decoration: none;
  white-space: normal;
}
  #toc.toc2 a:hover,
  #toc.toc2 a:focus {
    text-decoration: underline;
  }

#toc.toc2 ul {
  list-style: none;
}

  #toc.toc2 > ul {
    padding-left: 0;
  }

  #toc.toc2 ul ul {
    padding-left: 1em;
  }

@media screen and (min-width: 769px) {
  body {
    padding-left: 25vw !important;
  }

  #header,
  #content,
  #footer {
    margin-left: 0;
  }

  #toc.toc2 {
    height: 100%;
    left: 0;
    max-width: 20vw;
    overflow: auto;
    padding: 1rem;
    position: fixed;
    top: 0;
    z-index: 1000;
  }

  #toc.toc2 > ul {
    font-size: 0.85em;
  }

  #toc li.active > a[href^="#"],
  [id]:target {
    background: #ffc;
  }
}

.admonitionblock.context-callout > table {
  border-width: 5px;
  border-color: var(--brand-color);
}

</style>
<link rel="stylesheet" href="https://oncletom.io/styles/blog.css?v=v3.3.2">
<!-- WebMentions -->
<link rel="pingback" href="https://webmention.io/oncletom.io/xmlrpc">
<link rel="webmention" href="https://webmention.io/oncletom.io/webmention">
<!-- Open Graph -->
<meta property="og:type" content="book">
<meta property="og:book:author" content="Thomas Parisot">
<meta property="og:book:isbn" content="978-2212139938">
<meta property="og:book:release_date" content="978-2212139938">
<meta property="og:book:tag" content="Node.js">
<meta property="og:book:tag" content="JavaScript">
<meta property="og:book:tag" content="npm">
<meta property="og:book:tag" content="D√©veloppement front-end">
<meta property="og:book:tag" content="D√©veloppement back-end">
<meta property="og:locale" content="fr_FR">
<meta property="og:site_name" content="Node.js ‚Ä¢¬†Apprendre par la pratique">
<!-- Twitter OpenGraph -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@oncletom">
<meta name="twitter:creator" content="@oncletom">
<style type="text/css" class="prism-theme">/**
 * prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */

code[class*="language-"],
pre[class*="language-"] {
	color: black;
	background: none;
	text-shadow: 0 1px white;
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection,
code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
	text-shadow: none;
	background: #b3d4fc;
}

pre[class*="language-"]::selection, pre[class*="language-"] ::selection,
code[class*="language-"]::selection, code[class*="language-"] ::selection {
	text-shadow: none;
	background: #b3d4fc;
}

@media print {
	code[class*="language-"],
	pre[class*="language-"] {
		text-shadow: none;
	}
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #f5f2f0;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: slategray;
}

.token.punctuation {
	color: #999;
}

.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
	color: #905;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #690;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
	color: #9a6e3a;
	background: hsla(0, 0%, 100%, .5);
}

.token.atrule,
.token.attr-value,
.token.keyword {
	color: #07a;
}

.token.function,
.token.class-name {
	color: #DD4A68;
}

.token.regex,
.token.important,
.token.variable {
	color: #e90;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
</style>
<style type="text/css" class="extension-interactive-runner">[data-interactive-runtime="loaded"] .interactive--javascript code[data-lang]:before {
  background-color: #fcfcfc;
  border: 1px solid #0c2;
  border-radius: 1px;
  color: #0c2;
  cursor: pointer;
  display: inline-block;
  font-weight: bold;
  padding: .5em 1em;
  top: -2em;
}

  [lang="en"] [data-interactive-runtime="loaded"] .interactive--javascript code[data-lang]:before {
    content: "‚ñ∂ run code";
  }
  [lang="fr"] [data-interactive-runtime="loaded"] .interactive--javascript code[data-lang]:before {
    content: "‚ñ∂ voir le r√©sultat";
  }
  .interactive--javascript code[data-label]:before {
    content: attr(data-label);
  }

.interactive iframe {
  position: absolute;
  visibility: hidden;
}

.interactive.status--loaded iframe {
  position: inherit;
  visibility: visible;
}

.interactive.status--loading {
  opacity: .5;
}
</style>
<script class="extension-interactive-runner">
(function(d){
  document.addEventListener('DOMContentLoaded', function(){
    const script = d.createElement('script');
    script.src = 'https://embed.runkit.com/';
    script.async = true;
    script.onload = function(){
      function makeListingInteractive (element){
  if (element.classList.contains('interactive--installed') || element.classList.contains('status--loading')) {
    return;
  }

  const code = element.querySelector('code');
  const nodeVersion = /interactive--runtime--node-([^\s]+)/.exec(element.className)[1];
  const isEndpoint = element.classList.contains('interactive--endpoint');
  const mode = isEndpoint ? 'endpoint' : null;
  let preamble = '';

  const source = code
    .textContent
    .replace(/\/\/\s*\(\d+\)$/gm, '')
    .replace(/^["']?use strict["'][; ]*\n/, '');

  if (isEndpoint) {
    preamble = `process.nextTick(() => {
      if (typeof module.exports === 'function') {
        exports.endpoint = module.exports;
      }
      else if (typeof server !== 'undefined') {
        exports.endpoint = server.listeners("request").pop();
      }
});`
  }

  element.classList.add('status--loading');

  // eslint-disable-next-line no-undef
  RunKit.createNotebook({
    nodeVersion,
    element,
    source,
    mode,
    preamble,
    onLoad: function(ntbk) {
      element.classList.add('interactive--installed');
      element.classList.remove('status--loading');
      element.classList.add('status--loaded');
      code.parentNode.setAttribute('hidden', true);

      ntbk.evaluate();
    }
  });
}
function installEvents () {
  function getParent(el, condition) {
    let parent = el;

    while(parent = parent.parentNode) {
      if (condition(parent)) {
        return parent;
      }
    }
  }

  function hasClass(className) {
    return function check(el) {
      return el.classList.contains(className);
    }
  }

  document.querySelector('body').addEventListener('click', function(el) {
    if (el.target.classList.contains('language-javascript') || el.target.classList.contains('language-js')) {
      const parentNode = getParent(
        el.target,
        hasClass('interactive--javascript')
      );

      makeListingInteractive(parentNode);
    }
  });
}
      installEvents();
      document.body.dataset.interactiveRuntime = 'loaded';
    };
    document.body.appendChild(script);
  });
})(document);</script>
<style type="text/css">
.listingblock [data-bash-subs]::before {
  content: attr(data-bash-subs) " ";
  opacity: .5; }

.listingblock [data-bash-conum]::before {
  content: "(" attr(data-bash-conum) ")";
  font-weight: bold;
  opacity: .7;
}</style>
<script>
(function(d){
  d.addEventListener('DOMContentLoaded', function(){
    const script = d.createElement('script');
    script.src = 'https://unpkg.com/menuspy@1.3.0/dist/menuspy.js';
    script.async = true;
    script.onload = () => new MenuSpy(document.querySelector('#toc'), {enableLocationHash: false});
    d.body.appendChild(script);
  });
})(document);</script>
<style type="text/css">
#toc li.active > a[href^="#"] {
  font-weight: bold;
}
#toc li.active > a[href^="#"]::before {
  content: "‚ñ∂ ";
  display: inline-block;
  position: absolute;
  margin-left: -1.2em;
  font-size: .8em;
  margin-top: 3px;
}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Cr√©er un outil en ligne de commande</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table des mati√®res</div>
<ul class="sectlevel1">
<li><a href="#start">1. Cr√©er un script ex√©cutable</a>
<ul class="sectlevel2">
<li><a href="#script">1.1. Au d√©part, un simple script&#160;Node</a></li>
<li><a href="#permissions">1.2. Modifier les permissions du&#160;script</a></li>
<li><a href="#shebang">1.3. Pr√©ciser le contexte d&#8217;ex√©cution (shebang)</a></li>
<li><a href="#package.json">1.4. Faire le lien avec un module&#160;npm</a></li>
</ul>
</li>
<li><a href="#interactive">2. Du script au programme interactif</a>
<ul class="sectlevel2">
<li><a href="#args">2.1. Utiliser des arguments et des options</a></li>
<li><a href="#colours">2.2. Am√©liorer la lisibilit√© gr√¢ce aux couleurs</a></li>
<li><a href="#prompt">2.3. Demander une s√©rie d&#8217;informations</a></li>
<li><a href="#progress">2.4. Informer de la progression</a></li>
<li><a href="#tables">2.5. Afficher des informations sous forme de tableau</a></li>
<li><a href="#update">2.6. Inviter √† mettre √† jour le module</a></li>
</ul>
</li>
<li><a href="#tests">3. Vers un code r√©utilisable et testable</a>
<ul class="sectlevel2">
<li><a href="#interface">3.1. Modulariser le code du fichier ex√©cutable</a></li>
<li><a href="#tests.interface">3.2. Tester le code partag√©</a></li>
<li><a href="#display">3.3. Pr√©senter les messages en contexte</a></li>
<li><a href="#tests.cli">3.4. Tester l&#8217;ex√©cutable</a></li>
<li><a href="#doc">3.5. Documenter notre programme</a></li>
</ul>
</li>
<li><a href="#advanced">4. Pour aller plus loin</a>
<ul class="sectlevel2">
<li><a href="#application">4.1. Utilisation d&#8217;un framework d&#8217;application en ligne de commande</a></li>
<li><a href="#files">4.2. Strat√©gies pour g√©rer les chemins d&#8217;acc√®s</a></li>
<li><a href="#streaming">4.3. Utiliser les flux de donn√©es (stdin, stdout et stderr)</a></li>
<li><a href="#autocomplete">4.4. Activer l&#8217;autocompl√©tion des commandes</a></li>
<li><a href="#packaging">4.5. Rendre le programme ind√©pendant de&#160;Node</a></li>
</ul>
</li>
<li><a href="#conclusion">5. Conclusion</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="admonitionblock tip context-callout">
<table>
<tr>
<td class="icon">
<div class="title">üí°</div>
</td>
<td class="content">
<div class="paragraph">
<p>Vous √™tes en train de lire le
<a href="https://oncletom.io/node.js/">livre &#8220;Node.js&#8221;</a>, √©crit par
<a href="https://oncletom.io">Thomas Parisot</a> et publi√© par les
<a href="https://www.eyrolles.com/Informatique/Livre/node-js-9782212139938/">√âditions Eyrolles</a>.</p>
</div>
<div class="paragraph">
<p>Il vous pla√Æt&#160;? Achetez-le en ligne sur
<a href="https://amzn.to/2E58PEw">Amazon</a>,
<a href="https://www.eyrolles.com/Informatique/Livre/node-js-9782212139938/">Eyrolles</a> ou
<a href="https://www.placedeslibraires.fr/livre/9782212139938">Place des Libraires</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Cr√©er un outil en ligne de commande est un savoir utile pour forger ses
propres outils, automatiser des actions et mieux s&#8217;int√©grer au
syst√®me d&#8217;exploitation.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="ulist">
<div class="title">Sommaire</div>
<ul>
<li>
<p>Cr√©er un script ex√©cutable.</p>
</li>
<li>
<p>Du script au programme interactif.</p>
</li>
<li>
<p>Vers un code r√©utilisable et testable.</p>
</li>
<li>
<p>Utilisation d‚Äôun framework d‚Äôapplication en ligne de commandes.</p>
</li>
<li>
<p>G√©rer les chemins d&#8217;acc√®s et les flux de donn√©es.</p>
</li>
<li>
<p>Rendre le programme ind√©pendant de&#160;Node.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Ce chapitre est une invitation √† cr√©er des applications au plus proche des
syst√®mes d&#8217;exploitation, l√† o√π Node excelle.</p>
</div>
<div class="paragraph">
<p>Nous apprendrons √† passer d&#8217;un script Node ordinaire √† un script qui
s&#8217;ex√©cute comme un programme de notre syst√®me d&#8217;exploitation.</p>
</div>
<div class="paragraph">
<p>Nous compl√©terons ce programme en am√©liorant son exp√©rience utilisateur
mais aussi en le rendant robuste gr√¢ce aux tests et √† l&#8217;√©criture d&#8217;une
documentation minimaliste, g√©n√©r√©e automatiquement.</p>
</div>
<div class="paragraph">
<p>Enfin, nous verrons aussi comment aller plus loin en organisation son code
comme dans une v√©ritable application, avec une compr√©hension plus pouss√©e
des chemins d&#8217;acc√®s et des traitements en continu sur des flux de donn√©es.</p>
</div>
</blockquote>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">üí¨</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Remarque</span> Versions de Node et npm</div>
<div class="paragraph">
<p>Le contenu de ce chapitre utilise les versions <strong>Node&#160;v10</strong>
et <strong>npm&#160;v6</strong>.
Ce sont les versions stables recommand√©es en&#160;2019.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Un script en ligne de commande revient souvent √† une installation globale
d&#8217;un module&#160;<code>npm</code> (<code>npm install --global &lt;module&gt;</code>).


Il prend aussi bien la forme d&#8217;un petit outil que d&#8217;une application compl√®te.
Dans tous les cas, le terminal est l&#8217;interface d&#8217;affichage.
</p>
</div>
<div class="paragraph">
<p>Node est particuli√®rement adapt√© √† la cr√©ation d&#8217;outils en ligne de commande
gr√¢ce √† son mod√®le de gestion m√©moire et son processus unique.
Il doit toutefois partager la m√©moire et les ressources de la machine avec
les autres programmes&#160;‚Äì √† nous de faire le choix de la frugalit√©.</p>
</div>
<div class="paragraph">
<p>Ces codes nous servent √† outiller nos projets, √† cr√©er des programmes autonomes,
des interfaces visuelles dans un terminal et √† automatiser ce qui doit l&#8217;√™tre.
Leur distribution sur le registre&#160;<code>npm</code>
(<a href="../chapter-05/index.html">chapitre&#160;5</a>) en facilite l&#8217;acc√®s et le partage,
surtout si vous les avez bien <a href="#tests">test√©s et document√©s</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="start">1. Cr√©er un script ex√©cutable</h2>
<div class="sectionbody">
<div class="paragraph">
<p></p>
</div>
<div class="paragraph">
<p>La premi√®re √©tape est de rendre ex√©cutable votre script Node.
Le syst√®me d&#8217;exploitation ne le percevra plus comme un simple fichier texte,
mais bel et bien comme un programme, au m√™me titre que l&#8217;ex√©cutable&#160;<code>npm</code>.</p>
</div>
<div class="paragraph">
<p>Nous allons apprendre ce cheminement ensemble, jusqu&#8217;√† rendre notre
code distribuable sous forme d&#8217;un <a href="../chapter-05/index.html#modules">module&#160;<code>npm</code></a>
(<a href="../chapter-05/index.html">chapitre&#160;5</a>).</p>
</div>
<div class="sect2">
<h3 id="script">1.1. Au d√©part, un simple script&#160;Node</h3>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph">
<p>Ce dont nous avons besoin pour d√©marrer, c&#8217;est d&#8217;un script Node que nous
pouvons appeler depuis notre terminal.
Nous allons placer l&#8217;exemple suivant dans le r√©pertoire <code>bin</code>
(pour <em>binary</em> en anglais, c&#8217;est-√†-dire <em>ex√©cutable</em>).
Cela n&#8217;a pas d&#8217;incidence technique, mais c&#8217;est une pratique courante au sein
de la communaut√© Node pour rep√©rer plus facilement les ex√©cutables
sans ambigu√Øt√©.</p>
</div>
<div class="listingblock prismjs highlight-prismjs interactive interactive--javascript interactive--runtime--node-v10">
<div class="title">bin/time.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// <b class="conum">(1)</b></span>
<span class="token keyword">const</span> hour <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> minutes <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Il est </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>hour<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">h</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>minutes<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Cr√©e un objet qui repr√©sente la <a href="../chapter-03/index.html#date">date</a> courante (<a href="../chapter-03/index.html">chapitre&#160;3</a>).</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">üí°</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Pratique</span> Jouer avec les exemples dans un terminal</div>
<div class="paragraph">
<p>Les exemples titr√©s d&#8217;un nom de fichier peuvent √™tre install√©s sur votre ordinateur.
Ex√©cutez-les dans un terminal et amusez-vous √† les modifier en parall√®le de
votre lecture pour voir ce qui change.</p>
</div>
<div class="listingblock">
<div class="title">Installation des exemples via le module npm <code>nodebook</code></div>
<div class="content">
<pre><span data-bash-subs="$"></span>npm install --global nodebook
<span data-bash-subs="$"></span>nodebook install chapter-08
<span data-bash-subs="$"></span>cd $(nodebook dir chapter-08)</pre>
</div>
</div>
<div class="paragraph">
<p>La commande suivante devrait afficher un r√©sultat qui confirme que vous √™tes
au bon endroit&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node hello.js</pre>
</div>
</div>
<div class="paragraph">
<p>Suivez √† nouveau les instructions d&#8217;installation pour r√©tablir les exemples
dans leur √©tat initial.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>L&#8217;ex√©cution du script avec Node retourne la date et l&#8217;heure courante&#160;‚Äì selon
l&#8217;horloge de l&#8217;ordinateur qui ex√©cute le&#160;code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node bin/time.js
Il est 13h42.</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="permissions">1.2. Modifier les permissions du&#160;script</h3>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph">
<p>Les syst√®mes d&#8217;exploitation modernes distinguent les fichiers ordinaires
des fichiers ex√©cutables.
L&#8217;appel √† un fichier ex√©cutable se fait sans avoir √† conna√Ætre quoi que ce soit
d&#8217;autre que son emplacement.</p>
</div>
<div class="paragraph">
<p>Essayons d&#8217;ex√©cuter le script pr√©c√©dent pour nous en rendre compte.
Pour ce faire, nous allons l&#8217;invoquer seulement avec son chemin
‚Äì ici, son chemin relatif&#160;:
</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>./bin/time.js
sh: permission denied: ./bin/time.js</pre>
</div>
</div>
<div class="paragraph">
<p>Le syst√®me refuse de l&#8217;ex√©cuter car les permissions du fichier ne sont pas
ad√©quates.
Comme nous ne les connaissons pas, utilisons la commande&#160;<code>ls</code> ainsi que
l&#8217;option&#160;<code>-l</code> pour afficher ses informations d√©taill√©es&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>ls -l bin/time.js
<mark>-rw-r--r--</mark> oncletom  staff  175 Jun 14 13:47 bin/time.js</pre>
</div>
</div>
<div class="paragraph">
<p>Cet affichage d√©taille les permissions du fichier, l&#8217;utilisateur et le groupe
propri√©taire, son poids et enfin la date de derni√®re modification.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">üí¨</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">D√©chiffrer</span> Lire les permissions Unix</div>
<div class="paragraph">
<p>

Le premier caract√®re sp√©cifie le type (fichier, r√©pertoire, lien symbolique) et
ensuite, ce sont des blocs de trois caract√®res qui d√©crivent les permissions de
l&#8217;utilisateur propri√©taire, du groupe propri√©taire et du reste des utilisateurs
du syst√®me d&#8217;exploitation.</p>
</div>
<div class="paragraph">
<p>Chaque bloc affiche <code>r</code>&#160;s&#8217;il est lisible, <code>w</code>&#160;s&#8217;il est modifiable et
<code>x</code>&#160;s&#8217;il est ex√©cutable&#160;‚Äì c&#8217;est ce dernier qui nous int√©resse.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Nous allons rendre le fichier ex√©cutable&#160;(<code>+x</code>) pour notre utilisateur&#160;(<code>u</code>)
gr√¢ce √† la commande&#160;<code>chmod</code>.
Je pr√©f√®re utiliser cette notation car elle √©vite des effets de bord&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>chmod u+x bin/time.js</pre>
</div>
</div>
<div class="paragraph">
<p>L&#8217;utilisation renouvel√©e de la commande&#160;<code>ls</code> confirme que la
permission <em>ex√©cutable</em> du fichier a √©t√© attribu√©e √† l&#8217;utilisateur propri√©taire
du fichier&#160;:
</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>ls -l bin/time.js
-rwxr--r-- oncletom  staff  175 Jun 14 13:47 bin/time.js</pre>
</div>
</div>
<div class="paragraph">
<p>Nous sommes accueillis avec un nouveau message d&#8217;erreur lorsque nous
tentons d&#8217;ex√©cuter le fichier <code>bin/time.js</code>&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>./bin/time.js
./bin/time.js: line 1: use strict: command not found
./bin/time.js: line 3: syntax error near unexpected token `('</pre>
</div>
</div>
<div class="paragraph">
<p>La bonne nouvelle, c&#8217;est que le fichier est ex√©cutable.
N√©anmoins, il semblerait que le syst√®me d&#8217;exploitation ait du mal
√† l&#8217;interpr√©ter.</p>
</div>
</div>
<div class="sect2">
<h3 id="shebang">1.3. Pr√©ciser le contexte d&#8217;ex√©cution (shebang)</h3>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph">
<p>Donner les permissions d&#8217;ex√©cution √† un fichier ne suffit donc pas.
Nous avons perdu un √©l√©ment contextuel en supprimant l&#8217;appel √† <code>node</code>
dans l&#8217;ex√©cution du script.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">‚ö†Ô∏è</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Interop√©rabilit√©</span> Un fonctionnement diff√©rent sous Windows</div>
<div class="paragraph">
<p>Ce m√©canisme n&#8217;est pas compris par le syst√®me d&#8217;exploitation Windows.
Ce dernier utilise une surcouche qui serait trop longue √† expliquer dans
cet ouvrage.</p>
</div>
<div class="paragraph">
<p>Je recommande cependant de conserver le contexte d&#8217;ex√©cution sous Windows
car l&#8217;ex√©cutable&#160;<code>npm</code> g√®re l&#8217;interop√©rabilit√© pour nous.
Nous verrons comment dans la <a href="#package.json">section suivante</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Le caract√®re&#160;<code>+<mark>+</code> plac√© en d√©but de ligne d&#8217;un script syst√®me signale une ligne
plac√©e en commentaire.
C&#8217;est l&#8217;√©quivalent de&#160;<code>+//+</code> en ECMAScript.
Il existe un cas sp√©cial&#160;: lorsque le caract√®re&#160;<code>+</mark>+</code> est suivi d&#8217;un&#160;<code>!</code>
<em>et</em> lorsqu&#8217;il s&#8217;agit de la premi√®re ligne d&#8217;un fichier.
Le contenu du commentaire est alors utilis√© par le syst√®me d&#8217;exploitation
pour d√©terminer quel programme utiliser pour interpr√©ter le script.
C&#8217;est ce qu&#8217;on appelle <em>shebang</em>.</p>
</div>
<div class="paragraph">
<p>Modifions le script de la section pr√©c√©dente pour ajouter le <em>shebang</em>&#160;:</p>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">bin/time-sh.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node   # <b class="conum">(1)</b>

<span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">...</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Le programme <code>/usr/bin/env</code> est ex√©cut√© avec un argument,&#160;<code>node</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Le programme <code>/usr/bin/env</code> cr√©e un nouvel environnement d&#8217;ex√©cution
et le reste du script est pass√© au programme r√©f√©renc√© en argument&#160;‚Äì ici,&#160;<code>node</code>.
Ce nouvel environnement dure le temps de l&#8217;ex√©cution du script.</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>./bin/time-sh.js
Il est 13h42.</pre>
</div>
</div>
<div class="paragraph">
<p>Le dernier effort √† faire pour distribuer ce script ex√©cutable de mani√®re
interop√©rable est de le lier √† un
<a href="../chapter-05/index.html#package.json">module&#160;<code>npm</code></a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="package.json">1.4. Faire le lien avec un module&#160;npm</h3>
<div class="paragraph">
<p>

</p>
</div>
<div class="paragraph">
<p>Nous avons vu dans le <a href="../chapter-05/index.html">chapitre&#160;5</a>
que Node utilisait la valeur <code>main</code> du fichier <code>package.json</code> pour d√©terminer
quel script inclure en faisant <code>require('&lt;module&gt;')</code> ou <code>import &lt;module&gt; from '&lt;module&gt;'</code>.</p>
</div>
<div class="paragraph">
<p>Le champ <code>bin</code> est une transposition de <code>main</code> pour associer un script
ex√©cutable √† notre module&#160;<code>npm</code>&#160;:</p>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">package.json</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json"><span class="token punctuation">{</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"nodebook.chapter-08"</span><span class="token punctuation">,</span>
  <span class="token property">"bin"</span><span class="token operator">:</span> <span class="token string">"examples/bin/time-sh.js"</span><span class="token punctuation">,</span>
  <span class="token property">"..."</span><span class="token operator">:</span> <span class="token string">"..."</span>
<span class="token punctuation">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Le moyen le plus simple pour tester l&#8217;int√©gration de l&#8217;ex√©cutable
avec notre syst√®me d&#8217;exploitation est de
l'<a href="../chapter-05/index.html#install.global">installer globalement</a>.
L&#8217;ex√©cutable&#160;<code>npm</code> sait aussi installer un module √† partir
d&#8217;un chemin vers un r√©pertoire contenant un fichier <code>package.json</code>&#160;:
</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>npm install --global .</pre>
</div>
</div>
<div class="paragraph">
<p>Par d√©faut, l&#8217;ex√©cutable est disponible sous le nom du module en question,
d√©clar√© dans le champ <code>name</code> du fichier <code>package.json</code>&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>nodebook.chapter-08
Il est 13h42.</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">üí°</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Pratique</span> Un autre nom ou plusieurs ex√©cutables</div>
<div class="paragraph">
<p>

Le champ&#160;<code>bin</code> s&#8217;√©crit sous forme d&#8217;un objet si vous souhaitez utiliser
un autre nom que celui du module&#160;<code>npm</code>.
La cl√© correspond au nom de l&#8217;ex√©cutable tel qu&#8217;il sera utilisable sur le
syst√®me, tandis que la valeur contient le chemin d&#8217;acc√®s au script ex√©cutable.
Plusieurs ex√©cutables sont alors install√©s si nous renseignons plusieurs
cl√©s et valeurs.</p>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">package.json</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json"><span class="token punctuation">{</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"nodebook.chapter-08"</span><span class="token punctuation">,</span>
  <span class="token property">"bin"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"&lt;mark>quelle-heure-est-il&lt;/mark>"</span><span class="token operator">:</span> <span class="token string">"examples/bin/time-sh.js"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>L&#8217;installation de l&#8217;ex√©cutable <code>examples/bin/time-sh.js</code> se fera sous le nom <code>quelle-heure-est-il</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="interactive">2. Du script au programme interactif</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Nous avons appris √† transformer un script Node ordinaire en un script
ex√©cutable et pr√™t √† <a href="../chapter-05/index.html#publish">publier sur un registre&#160;<code>npm</code></a>
(<a href="../chapter-05/index.html">chapitre&#160;5</a>).</p>
</div>
<div class="paragraph">
<p>Cette section se focalise sur l&#8217;enrichissement d&#8217;un tel script pour en faire
une application plus compl√®te, interactive et robuste, de quoi se constituer
un outillage sur mesure, partageable avec le reste de notre √©quipe et de
l&#8217;√©cosyst√®me de modules <code>npm</code>.</p>
</div>
<div class="sect2">
<h3 id="args">2.1. Utiliser des arguments et des options</h3>
<div class="paragraph">
<p>

</p>
</div>
<div class="paragraph">
<p>Nous avons vu comment r√©cup√©rer les arguments d&#8217;un script Node
en d√©couvrant le <a href="../chapter-04/index.html#process">module <code>process</code></a>
au <a href="../chapter-04/index.html">chapitre&#160;4</a>.
Pour rappel, la variable <code>process.argv</code> est un tableau qui contient tous
les arguments pass√©s au script principal&#160;:</p>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">options/intro.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> args <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Cela donne le r√©sultat suivant quand nous lan√ßons ce script dans un terminal&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node options/intro.js --country FR --fast
[ '--country', 'FR', '--fast' ]</pre>
</div>
</div>
<div class="paragraph">
<p>Ce tableau est un peu &#8220;l√©ger&#8221; car il se contente de retourner les arguments,
sans compr√©hension de la logique recherch√©e.
C&#8217;est √† nous de dire que&#160;<code>FR</code> est une valeur associ√©e √† <code>--country</code>.</p>
</div>
<div class="paragraph">
<p>Dans le contexte des outils en ligne de commandes,
les arguments et les options sont des param√®tres qui sont interpr√©t√©s
par le programme pour contextualiser son action.
Ils fonctionnent un peu comme des arguments de
<a href="../chapter-03/index.html#function">fonction</a> et des param√®tres&#160;d&#8217;URL.</p>
</div>
<div class="paragraph">
<p>L&#8217;enjeu des arguments et des options est de les
<strong>transformer en une structure de donn√©es</strong> afin de les passer en tant
que param√®tres d&#8217;une fonction.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Tableau 1. Repr√©sentation des arguments et des options dans un outil en ligne de commandes, une fonction et une&#160;URL</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">Options</th>
<th class="tableblock halign-left valign-top">Arguments</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fonction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>prog({country: 'FR', 'fast': true})</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>prog('FR', 'fast')</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ligne de commande</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>prog --country FR --fast</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>prog FR fast</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>prog/?country=FR&amp;fast=true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>prog/FR/fast</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph">
<p>Nous allons utiliser le module&#160;<code>npm</code> <em>minimist</em> (<span class="URL"><a href="https://npmjs.com/minimist" class="bare">npmjs.com/minimist</a></span>)
dans les exemples suivants.

Il prend en charge la complexit√© de l&#8217;interpr√©tation de <code>process.argv</code> et je
le trouve robuste, bien test√© et minimaliste.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">üí¨</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Histoire</span> Au commencement √©tait getopt</div>
<div class="paragraph">
<p>
<code>getopt</code> (<span class="URL"><a href="https://linux.die.net/man/3/getopt" class="bare">linux.die.net/man/3/getopt</a></span>) est le programme Linux
qui sert √† l&#8217;analyse des arguments et des options.
Les modules&#160;<code>npm</code> se calquent sur son mod√®le de fonctionnement.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="args.options" class="paragraph">
<p>Commen√ßons par les <strong>options</strong> et voyons ce que <em>minimist</em> affiche&#160;:
</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node options/parse.js --country FR --fast
{ _: [], country: 'FR', fast: true }   <span data-bash-conum="1"></span></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>La valeur&#160;<code>_</code> contient les <a href="#args.arguments">arguments</a> d&#8217;ex√©cution&#160;‚Äì nous y reviendrons.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Les options sont adapt√©es pour <strong>nommer des param√®tres facultatifs</strong> dont
l&#8217;ordre n&#8217;a pas d&#8217;importance, sous forme d&#8217;un &#8220;interrupteur&#8221; dans le cas
d&#8217;un bool√©en ou d&#8217;une valeur&#160;‚Äì nombre ou cha√Æne de caract√®res, peu importe.</p>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">options/parse.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> parse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'minimist'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token function">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Les options s&#8217;√©crivent sous une <strong>forme raccourcie</strong> (<em>alias</em>).
Un alias r√©duit l&#8217;encombrement visuel et est signal√© avec un seul tiret
(au lieu de deux pour leur forme compl√®te)&#160;:
</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node options/alias.js <mark>-c</mark> FR
{ _: [], c: 'FR', country: 'FR' }</pre>
</div>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">options/alias.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> parse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'minimist'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> alias <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">'c'</span><span class="token punctuation">:</span> <span class="token string">'country'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// <b class="conum">(1)</b></span>

<span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token function">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> alias <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// <b class="conum">(2)</b></span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>D√©finition de l&#8217;option&#160;<code>-c</code> en tant qu&#8217;alias de <code>--country</code>.</p>
</li>
<li>
<p>L&#8217;affichage repr√©sente √† la fois la valeur de l&#8217;option et celle de l&#8217;alias.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>La lecture est rendue plus difficile pour celui ou celle qui n&#8217;a pas consult√©
le manuel d&#8217;utilisation en d√©tail&#160;‚Äì ce qui est souvent le cas, surtout
pour des personnes qui d√©couvrent un nouveau logiciel.</p>
</div>
<div class="paragraph">
<p>J&#8217;ai tendance √† utiliser les alias pour les options principales ou importantes.
Je privil√©gie la forme longue dans les exemples et dans la documentation,
afin d&#8217;augmenter les chances de compr√©hension.</p>
</div>
<div class="paragraph">
<p>Les <strong>valeurs par d√©faut</strong> simplifient le param√©trage en rendant certaines
valeurs implicites&#160;:
</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node options/defaults.js --fast
{ _: [], country: 'FR', fast: true }  <span data-bash-conum="1"></span></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>La cl√© <code>country</code> affiche une valeur alors que nous ne l&#8217;avons pas sp√©cifi√©e dans la commande.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>L&#8217;enjeu r√©side donc dans l&#8217;utilisation des valeurs √† bon escient, pour
que le programme fasse ce qui est attendu d&#8217;un point de vue utilisateur.
Le param√©trage est similaire √† celui des <em>alias</em>.</p>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">options/defaults.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> parse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'minimist'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>defaults<span class="token punctuation">:</span> <span class="token punctuation">{</span>country<span class="token punctuation">:</span> <span class="token string">'FR'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>      <span class="token comment">// <b class="conum">(1)</b></span>

<span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token function">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>L&#8217;option <code>--country</code> aura&#160;<code>FR</code> comme valeur par d√©faut.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Un autre concept utile est celui des <strong>types</strong>.
Nous d√©finissons explicitement nos attentes sur ce que telle ou telle option
est cens√©e recevoir&#160;:
</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node options/types.js --country --fast furious   <span data-bash-conum="1"></span>
{ _: [ 'furious' ], fast: true, country: '' }
<span data-bash-subs="$"></span>node options/types.js --country FR
{ _: [], fast: false, country: 'FR' }              <span data-bash-conum="2"></span></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Omission de la valeur de <code>--option</code> et tentative d&#8217;affectation de valeur √† l&#8217;option bool√©enne <code>--fast</code>.</p>
</li>
<li>
<p>Une option vaut implicitement <code>false</code> par d√©faut quand elle est typ√©e comme bool√©enne.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>L&#8217;exemple pr√©c√©dent renforce nos attentes&#160;: l&#8217;option <code>--country</code> sans valeur
ne sera pas comprise comme un bool√©en et, au contraire, l&#8217;option bool√©enne <code>--fast</code>
n&#8217;accepte pas de valeur&#160;‚Äì cette derni√®re est interpr√©t√©e
comme un <a href="#args.arguments">argument</a>.</p>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">options/types.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> argv <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> parse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'minimist'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> string <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> boolean <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'fast'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">parse</span><span class="token punctuation">(</span>argv<span class="token punctuation">,</span> <span class="token punctuation">{</span> string<span class="token punctuation">,</span> boolean <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
</div>
<div class="hdlist">
<div class="title">Synth√®se des diff√©rentes formes d&#8217;options</div>
<table>
<tr>
<td class="hdlist1">
<code>--country FR</code>
<br>
<code>-c FR</code>
</td>
<td class="hdlist2">
<p>Un nombre ou une cha√Æne de caract√®res.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>--country FR UK</code>
<br>
<code>--country FR --country UK</code>
</td>
<td class="hdlist2">
<p>Un ou plusieurs nombre(s) ou cha√Æne(s) de caract√®res.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>--fast</code>
<br>
<code>--no-fast</code>
<br>
<code>-f</code>
</td>
<td class="hdlist2">
<p>Un bool√©en dont la valeur vaut <code>true</code>.
La valeur vaut <code>false</code> quand l&#8217;option d√©bute avec&#160;<code>no-</code>.
C&#8217;est utile quand nous avons besoin d&#8217;activer ou de d√©sactiver quelque chose.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>--verbose --verbose</code>
<br>
<code>-vv</code>
</td>
<td class="hdlist2">
<p>Certaines biblioth√®ques utilisent la r√©p√©tition d&#8217;un bool√©en comme un compteur.
Dans ce cas, la notation <code>--verbose --verbose</code> correspond √† la valeur <code>{verbose: 2}</code>.
C&#8217;est utile pour g√©rer la gradation d&#8217;une option comme la loquacit√© de l&#8217;affichage
des <em>logs</em>.</p>
</td>
</tr>
</table>
</div>
<div id="args.arguments" class="paragraph">
<p>
Les arguments sont adapt√©s √† des situations o√π <strong>des valeurs sont obligatoires</strong>,
n&#8217;ont pas besoin d&#8217;√™tre nomm√©es et pour en accepter un nombre arbitraire.
Si les valeurs ne correspondent pas √† une liste, le positionnement des arguments
est important car il d√©termine leur identification.
Les arguments se pr√™tent particuli√®rement bien √† exprimer
une liste de fichiers ou d&#8217;identifiants.</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node options/parse.js Europe/London
{ _: [ 'Europe/London' ] }</pre>
</div>
</div>
<div class="paragraph">
<p>Le param√®tre pass√© en argument est l&#8217;expression d&#8217;un fuseau horaire
selon l&#8217;organisme de standardisation <em>IANA</em> (<span class="URL"><a href="https://www.iana.org/time-zones" class="bare">www.iana.org/time-zones</a></span>).
Une liste de fuseaux se trouve sur <span class="URL"><a href="https://time.is/time_zones" class="bare">time.is/time_zones</a></span>.
L&#8217;id√©e est d&#8217;afficher l&#8217;heure courante selon le fuseau horaire donn√© en argument.
C&#8217;est un param√®tre obligatoire qu&#8217;il n&#8217;est pas n√©cessaire de nommer&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node options/timezone.js Europe/London
22:29
<span data-bash-subs="$"></span>node options/timezone.js America/New_York
17:29
<span data-bash-subs="$"></span>node options/timezone.js Indian/Antananarivo   <span data-bash-conum="1"></span>
17/6/2018, 00:36</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Fuseau horaire de l&#8217;√Æle de Madagascar.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Nous pouvons travailler avec les fuseaux horaires sans module additionnel,
gr√¢ce √† la fonctionnalit√© de
<a href="../chapter-03/index.html#intl.datetimeformat">formatage internationalis√©</a>
(<a href="../chapter-03/index.html">chapitre&#160;3</a>)&#160;:</p>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">options/timezone.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> parse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'minimist'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token function">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>timezone<span class="token punctuation">]</span> <span class="token operator">=</span> args<span class="token punctuation">.</span>_<span class="token punctuation">;</span>                          <span class="token comment">// <b class="conum">(1)</b></span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>timezone<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">'Merci d\'indiquer un fuseau horaire :-)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  timeZone<span class="token punctuation">:</span> timezone<span class="token punctuation">,</span>
  hour<span class="token punctuation">:</span> <span class="token string">'numeric'</span><span class="token punctuation">,</span> minute<span class="token punctuation">:</span> <span class="token string">'numeric'</span><span class="token punctuation">,</span> hour12<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token comment">// <b class="conum">(2)</b></span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLocaleDateString</span><span class="token punctuation">(</span><span class="token string">'fr-FR'</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>                                  <span class="token comment">// <b class="conum">(3)</b></span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Nous affectons √† <code>timezone</code> la premi√®re valeur du tableau d&#8217;arguments.</p>
</li>
<li>
<p>Configuration des pr√©f√©rences d&#8217;affichage de l&#8217;heure.</p>
</li>
<li>
<p>Utilisation de la m√©thode <code>toLocaleDateString()</code> avec nos options pour afficher la date courante.
</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Cet exemple se transformerait de la mani√®re suivante si nous souhaitions
√©tendre l&#8217;affichage de l&#8217;heure √† autant de fuseaux horaires que voulus&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node options/timezones.js Europe/London America/New_York
Europe/London : 22:29
America/New_York : 17:29</pre>
</div>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">options/timezones.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> parse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'minimist'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token function">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> timezones <span class="token operator">=</span> args<span class="token punctuation">.</span>_<span class="token punctuation">;</span>

<span class="token keyword">const</span> output <span class="token operator">=</span> timezones<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">timeZone</span> <span class="token operator">=></span> <span class="token punctuation">{</span>              <span class="token comment">// <b class="conum">(1)</b></span>
  <span class="token keyword">const</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLocaleDateString</span><span class="token punctuation">(</span><span class="token string">'fr-FR'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    timeZone<span class="token punctuation">,</span>
    hour<span class="token punctuation">:</span> <span class="token string">'numeric'</span><span class="token punctuation">,</span> minute<span class="token punctuation">:</span> <span class="token string">'numeric'</span><span class="token punctuation">,</span> hour12<span class="token punctuation">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>timeZone<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> : </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>date<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">;</span>                       <span class="token comment">// <b class="conum">(2)</b></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>output<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                         <span class="token comment">// <b class="conum">(3)</b></span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Nous constituons un nouveau tableau en it√©rant sur chacun des arguments.</p>
</li>
<li>
<p>Valeur de retour utilis√©e dans le nouveau tableau <code>output</code> (<a href="../chapter-03/index.html#array">chapitre&#160;3</a>).</p>
</li>
<li>
<p>Le tableau est joint pour constituer une cha√Æne de caract√®res sur plusieurs lignes.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Ce script accepte un nombre ind√©fini d&#8217;arguments et son temps d&#8217;ex√©cution
d√©pendra de la longueur de cette liste.
Elle n&#8217;a d&#8217;ailleurs pas forc√©ment √† √™tre connue √† l&#8217;avance et les valeurs
s&#8217;obtiennent dynamiquement, en les listant depuis un fichier, par exemple&#160;:</p>
</div>
<div class="listingblock">
<div class="title">options/zones.txt</div>
<div class="content">
<pre class="highlight"><code>Europe/London
America/New_York</code></pre>
</div>
</div>
<div class="paragraph">
<p>Le contenu du fichier s&#8217;obtient d&#8217;une traite en bash avec l&#8217;utilisation combin√©e
de capture de valeur (<code>$(&#160;)</code>) et de l&#8217;op√©rateur de redirection&#160;<code>&lt;</code>&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node options/timezones.js $(< options/zones.txt)
Europe/London : 22:29
America/New_York : 17:29</pre>
</div>
</div>
<div class="paragraph">
<p>C&#8217;est minimal, mais le fichier doit √™tre lu
dans son int√©gralit√© et copi√© enti√®rement dans la m√©moire de Node avant d&#8217;en
faire quelque chose.
Une approche plus √©conomique est d&#8217;utiliser les
<a href="../chapter-04/index.html#stream">flux de donn√©es</a> (<a href="../chapter-04/index.html">chapitre&#160;4</a>.
Nous y reviendrons <a href="#streaming">plus loin</a>.

</p>
</div>
<div class="hdlist">
<div class="title">Synth√®se des diff√©rentes formes d&#8217;arguments</div>
<table>
<tr>
<td class="hdlist1">
<code>prog [argument1, ‚Ä¶]</code>
</td>
<td class="hdlist2">
<p>L&#8217;ordre de placement √©tant important, les arguments facultatifs doivent
√™tre plac√©s √† droite des arguments obligatoires.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>prog sous-commande [argument1, ‚Ä¶]</code>
</td>
<td class="hdlist2">
<p>C&#8217;est un cas particulier pour d√©couper un programme complet en plusieurs
domaines d&#8217;action.
Le premier argument est alors utilis√© comme identifiant d&#8217;action,
avec ses propres arguments et options.</p>
</td>
</tr>
</table>
</div>
<div id="args.subcommand" class="paragraph">
<p>
L&#8217;utilisation des sous-commandes est la bienvenue pour organiser des actions
de mani√®re ind√©pendante, l√† o√π les choses deviendraient implicites et chaotiques
avec les options.
C&#8217;est l&#8217;√©quivalent d&#8217;une <em>route</em> dans une
<a href="../chapter-07/index.html">application web</a> (<a href="../chapter-07/index.html">chapitre&#160;7</a>).
</p>
</div>
<div class="paragraph">
<p>Les commandes suivantes illustrent la g√©n√©ration de r√©sultats al√©atoires.
Leur nature varie en fonction de la sous-commande employ√©e&#160;;</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node options/random.js number
51151
<span data-bash-subs="$"></span>node options/random.js words 2
streamline THX</pre>
</div>
</div>
<div class="paragraph">
<p>Nous associons une fonction diff√©rente √† chaque sous-commande pour
renforcer cette notion d&#8217;actions ind√©pendantes mais qui partagent
les options et arguments du script.</p>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">options/random.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span>random<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'faker/locale/fr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'minimist'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>action<span class="token punctuation">,</span> <span class="token operator">...</span>actionArgs<span class="token punctuation">]</span> <span class="token operator">=</span> args<span class="token punctuation">.</span>_<span class="token punctuation">;</span>               <span class="token comment">// <b class="conum">(1)</b></span>

<span class="token keyword">const</span> <span class="token function-variable function">number</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> random<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment">// <b class="conum">(2)</b></span>
<span class="token keyword">const</span> <span class="token function-variable function">words</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">count<span class="token operator">=</span><span class="token number">5</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> random<span class="token punctuation">.</span><span class="token function">words</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// <b class="conum">(3)</b></span>
<span class="token keyword">const</span> <span class="token function-variable function">log</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>action <span class="token operator">===</span> <span class="token string">'words'</span><span class="token punctuation">)</span>  <span class="token function">log</span><span class="token punctuation">(</span><span class="token function">words</span><span class="token punctuation">(</span><span class="token operator">...</span>actionArgs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// <b class="conum">(4)</b></span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>action <span class="token operator">===</span> <span class="token string">'number'</span><span class="token punctuation">)</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>L&#8217;action est le premier argument&#160;; le reste est accumul√© dans le tableau <code>actionArgs</code>.</p>
</li>
<li>
<p>Fonction qui retourne un nombre al√©atoire.</p>
</li>
<li>
<p>Fonction qui retourne un nombre d√©fini de mots&#160;‚Äì 5&#160;par d√©faut.</p>
</li>
<li>
<p>Chaque argument qui suit la sous-commande correspondra ainsi √† un argument de la fonction <code>words</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>L'<a href="../chapter-05/index.html">ex√©cutable&#160;<code>npm</code></a> est un exemple d&#8217;application
qui repose sur des sous-commandes pour d√©terminer quelle action ex√©cuter
‚Äì installer un module, lancer une recherche ou encore initialiser un projet, entre autres.</p>
</div>
<div class="paragraph">
<p>Des applications en ligne de commande plus complexes soul√®vent de nouveaux
besoins pour √©viter les effets de bord et pour faciliter la modularit√© de
notre code&#160;: la <strong>validation</strong> des param√®tres, une gestion plus fine des
sous-commandes, ainsi que la <strong>g√©n√©ration automatique de la documentation</strong>.
Nous y reviendrons dans la section &#8220;<a href="#application">Utilisation d&#8217;un framework</a>&#8221;.</p>
</div>
</div>
<div class="sect2">
<h3 id="colours">2.2. Am√©liorer la lisibilit√© gr√¢ce aux couleurs</h3>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph">
<p>Les couleurs vont nous aider √† faire ressortir, diff√©rencier et distinguer
des √©l√©ments au sein d&#8217;une interface monochrome.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/cli-colors.png" alt="cli colors" width="60%">
</div>
<div class="title">Figure 1. Exemple d&#8217;utilisation de couleurs dans un terminal</div>
</div>
<div class="paragraph">
<p>L&#8217;alternance de texte color√© et monochrome a √©t√© cr√©√©e √† partir du
script suivant&#160;:</p>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">colors/ansi.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'\x1B[31mHello\x1B[0m World'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Par d√©faut, tout caract√®re envoy√© vers la console est affich√©.
Un m√©canisme de <strong>commandes</strong> s&#8217;active en envoyant un caract√®re invisible
suivi d&#8217;une s√©rie de symboles.
Ces commandes changent la couleur du texte, sa couleur de fond, l&#8217;emphase,
le soulignement et m√™me la position du curseur.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">üí¨</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">ANSI</span> Structure d&#8217;une commande d&#8217;√©chappement</div>
<div class="paragraph">
<p>


Le caract√®re d'<em>√©chappement</em> est un caract√®re invisible, ici repr√©sent√©
en hexad√©cimal par&#160;<code>\x1B</code>.
Il existe sur nos claviers d&#8217;ordinateur&#160;: c&#8217;est la fameuse touche
<kbd>ECHAP</kbd> ou <kbd>ESC</kbd>&#160;!<br>
Une commande suit le caract√®re&#160;<code>[</code> jusqu&#8217;au caract√®re&#160;<code>m</code>.
Les commandes compos√©es utilisent le caract√®re&#160;<code>;</code> comme s√©parateur.</p>
</div>
<div class="paragraph">
<p>Pour r√©sumer, une commande a la forme <code>&lt;ECHAP&gt;[&lt;commande&gt;m</code> ou
<code>&lt;ECHAP&gt;[&lt;commande;commande;&#8230;&#8203;&gt;m</code>.</p>
</div>
<div class="paragraph">
<p>Pour en savoir plus √† propos de cette syntaxe, je vous recommande la lecture de
la page Wikip√©dia suivante&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><span class="URL"><a href="https://en.wikipedia.org/wiki/ANSI_escape_code" class="bare">en.wikipedia.org/wiki/ANSI_escape_code</a></span></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Les huit couleurs principales et les huit couleurs vives s&#8217;affichent dans
√† peu pr√®s tous les terminaux.
Cela vaut aussi pour leur utilisation en couleur de&#160;fond.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/cli-colors-all.png" alt="cli colors all" width="60%">
</div>
<div class="title">Figure 2. Affichage des huit couleurs principales et des huit couleurs&#160;vives</div>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">colors/all.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> brightColors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">93</span><span class="token punctuation">,</span> <span class="token number">94</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span><span class="token operator">...</span>colors<span class="token punctuation">,</span> <span class="token operator">...</span>brightColors<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">code</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> color <span class="token operator">=</span> <span class="token template-string"><span class="token string">`\x1B[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>code<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">m`</span></span><span class="token punctuation">;</span>            <span class="token comment">// <b class="conum">(1)</b></span>
  <span class="token keyword">const</span> bgColor <span class="token operator">=</span> <span class="token template-string"><span class="token string">`\x1B[30;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>code <span class="token operator">+</span> <span class="token number">10</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">m`</span></span><span class="token punctuation">;</span>  <span class="token comment">// <b class="conum">(2)</b></span>
  <span class="token keyword">const</span> reset <span class="token operator">=</span> <span class="token string">'\x1B[0m'</span><span class="token punctuation">;</span>                  <span class="token comment">// <b class="conum">(3)</b></span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>color<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">Hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>bgColor<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">World</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>reset<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Couleur d&#8217;affichage du texte.</p>
</li>
<li>
<p>Couleur de fond du texte tandis que les caract√®res sont en noir (<code>30</code>).</p>
</li>
<li>
<p>Remise √† z√©ro de tous les styles.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">üí¨</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Compatibilit√©</span> Combien de couleurs dans mon terminal ?</div>
<div class="paragraph">
<p>Les terminaux proposent un nombre limit√© de couleurs, au moins&#160;8, en majorit√©&#160;256
et parfois plusieurs millions selon le logiciel utilis√©.
Le programme Linux et macOS <code>tput</code> fournit des informations √† propos
du terminal, dont le nombre de couleurs&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>tput colors
256</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Un autre type de commande s√©lectionne dans une palette de 256&#160;couleurs
mais aussi dans la <em>palette&#160;RGB</em> (<em>Red Green Blue</em>, <em>Rouge Vert Bleu</em>).
Ces commandes d√©butent par <code>[38;5</code> et <code>[38;2</code>, respectivement&#160;:
</p>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">colors/palette.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'\x1B[38;5;213mHello\x1B[0m World'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// <b class="conum">(1)</b></span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'\x1B[38;2;255;69;0mHello\x1B[0m World'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// <b class="conum">(2)</b></span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Utilisation de la palette 8&#160;bits (256&#160;couleurs) - <code>213</code>&#160;est un rose clair.</p>
</li>
<li>
<p>Utilisation de la palette RGB (millions de couleurs)&#160;‚Äì <code>255,69,0</code> correspond au orange.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Le module&#160;<code>npm</code> <em>chalk</em> (<span class="URL"><a href="https://npmjs.com/chalk" class="bare">npmjs.com/chalk</a></span>) facilite l&#8217;utilisation
des codes ANSI en leur donnant des libell√©s m√©morisables, en g√©rant
la compatibilit√© du nombre des couleurs support√©es par le terminal voire
en d√©sactivant les couleurs si n√©cessaire.
</p>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">colors/chalk.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span>magentaBright<span class="token punctuation">,</span> green<span class="token punctuation">,</span> bgRed<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'chalk'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">magentaBright</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> World`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// <b class="conum">(1)</b></span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>green<span class="token punctuation">.</span><span class="token function">italic</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> World`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// <b class="conum">(2)</b></span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">bgRed</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> World`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// <b class="conum">(3)</b></span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Utilisation de la couleur vive magenta.</p>
</li>
<li>
<p>Utilisation de la couleur verte et de l&#8217;italique.</p>
</li>
<li>
<p>Utilisation de la couleur de fond rouge.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Le module s&#8217;utilise aussi comme mod√®le avec les guillemets obliques,
ce qui augmente encore plus la clart√© d&#8217;affichage.</p>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">colors/chalk-literal.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> chalk <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'chalk'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token template-string"><span class="token string">`{magentaBright Hello} World`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token template-string"><span class="token string">`{green.italic Hello} World`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token template-string"><span class="token string">`{bgRed Hello} World`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token template-string"><span class="token string">`{rgb(255,69,0) Hello} World`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="prompt">2.3. Demander une s√©rie d&#8217;informations</h3>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph">
<p>Les programmes interactifs demandent des informations de mani√®re
guid√©e √† la personne utilisant l&#8217;ex√©cutable,
en plus des <a href="#arguments">arguments et options</a>.
Poser une s√©rie de questions est une mani√®re d&#8217;accompagner une personne
dans une d√©cision, d&#8217;exposer des choix dynamiques et de r√©duire les erreurs
dans la cr√©ation de fichiers, par exemple.</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node prompt/intro.js
Quel est ton nom ? Thomas
Coucou Thomas !</pre>
</div>
</div>
<div class="paragraph">
<p>Le module <code>readline</code> propos√© par Node est peu connu.
Il sert √† transformer les <a href="../chapter-04/index.html#process.std">flux d&#8217;entr√©e et de sortie</a>
(<a href="../chapter-04/index.html">chapitre&#160;4</a>.


Le syst√®me de curseur sait mettre en pause, revenir en arri√®re et effacer tout
ou une partie d&#8217;une ligne, entre autres.
Ce module sait aussi poser des questions&#160;(!)&#160;:</p>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">prompt/intro.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> readline <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'readline'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> rl <span class="token operator">=</span> readline<span class="token punctuation">.</span><span class="token function">createInterface</span><span class="token punctuation">(</span><span class="token punctuation">{</span>             <span class="token comment">// <b class="conum">(1)</b></span>
  input<span class="token punctuation">:</span> process<span class="token punctuation">.</span>stdin<span class="token punctuation">,</span>
  output<span class="token punctuation">:</span> process<span class="token punctuation">.</span>stdout
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

rl<span class="token punctuation">.</span><span class="token function">question</span><span class="token punctuation">(</span><span class="token string">'Quel est ton nom ? '</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">answer</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>  <span class="token comment">// <b class="conum">(2)</b></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Coucou </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>answer<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> !`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  rl<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                     <span class="token comment">// <b class="conum">(3)</b></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Cr√©ation de l&#8217;interface qui s&#8217;intercale entre les flux d&#8217;entr√©e et de sortie&#160;‚Äì ici, l&#8217;entr√©e et la sortie standard.</p>
</li>
<li>
<p>La fonction de rappel est invoqu√©e d√®s que l&#8217;utilisateur a saisi sa r√©ponse.</p>
</li>
<li>
<p>La m√©thode <code>close()</code> stoppe l&#8217;interface et rend la main au script&#160;‚Äì sans cet appel le script tournerait ind√©finiment.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Nous allons utiliser le module&#160;<code>npm</code> <em>inquirer</em> (<span class="URL"><a href="https://npmjs.com/inquirer" class="bare">npmjs.com/inquirer</a></span>)
dans la suite de cette section.


Il se base sur <code>readline</code> et <strong>simplifie grandement l&#8217;interactivit√©</strong>&#160;:
question, liste √† choix unique navigable au clavier, bo√Æte √† cocher,
confirmation, validation de r√©ponse et ex√©cution conditionnelle, si telle ou
telle question contient les valeurs qui nous int√©ressent, par exemple.</p>
</div>
<div class="paragraph">
<p>L&#8217;exemple pr√©c√©dent peut √™tre r√©√©crit de la sorte&#160;:</p>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">prompt/question.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span>prompt<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'inquirer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> questions <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'name'</span><span class="token punctuation">,</span> message <span class="token punctuation">:</span> <span class="token string">'Quel est ton nom ?'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// <b class="conum">(1)</b></span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token function">prompt</span><span class="token punctuation">(</span>questions<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">answers</span> <span class="token operator">=></span> <span class="token punctuation">{</span>                 <span class="token comment">// <b class="conum">(2)</b></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Coucou </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>answers<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> !`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// <b class="conum">(3)</b></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>La question est cr√©√©e avec l&#8217;identifiant <code>name</code>&#160;‚Äì cela facilite l&#8217;utilisation des r√©ponses.</p>
</li>
<li>
<p>Les r√©sultats sont retourn√©s dans une <a href="../chapter-04/index.html#promise">promesse</a>&#160;‚Äì c&#8217;est plus √©l√©gant et pratique √† g√©rer qu&#8217;une fonction de rappel.
</p>
</li>
<li>
<p>Les valeurs des r√©ponses s&#8217;obtiennent gr√¢ce √† leurs identifiants.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Ce n&#8217;est pas beaucoup plus compliqu√© de poser plusieurs questions et de les
personnaliser avec les r√©ponses aux pr√©c√©dentes questions&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node prompt/questions.js
? Quel est ton nom ? Thomas
? Quel √¢ge as-tu Thomas ? 35
Thomas, tu as 35 ans.</pre>
</div>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">prompt/questions.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span>prompt<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'inquirer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> questions <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'name'</span><span class="token punctuation">,</span> message <span class="token punctuation">:</span> <span class="token string">'Quel est ton nom ?'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'age'</span><span class="token punctuation">,</span> <span class="token function-variable function">message</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">answers</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>            <span class="token comment">// <b class="conum">(1)</b></span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`Quel √¢ge as-tu </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>answers<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> ?`</span></span><span class="token punctuation">;</span>      <span class="token comment">// <b class="conum">(2)</b></span>
  <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token function">prompt</span><span class="token punctuation">(</span>questions<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">answers</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>answers<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, tu as </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>answers<span class="token punctuation">.</span>age<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> ans.`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>La valeur de <code>message</code> peut √™tre une fonction √† laquelle est pass√©e l&#8217;int√©gralit√© des r√©ponses aux questions pr√©c√©dentes.</p>
</li>
<li>
<p>La valeur d&#8217;une r√©ponse s&#8217;obtient au travers de son identifiant.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Dans cet exemple, rien ne nous emp√™chait de saisir autre chose qu&#8217;un nombre
dans la question de l&#8217;√¢ge.
C&#8217;est g√™nant, mais cela se r√©sout √† l&#8217;aide de la propri√©t√© de configuration <code>validate</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node prompt/validate.js
? Devine le nombre secret (entre 1 et 100): trois
>> Ce n'est pas un nombre
? Devine le nombre secret (entre 1 et 100): 10
>> C'est plus petit.
? Devine le nombre secret (entre 1 et 100): 5
Bravo, la r√©ponse est 5 !</pre>
</div>
</div>
<div class="paragraph">
<p>Cette fonction est appel√©e √† chaque tentative de r√©ponse.
La question est inlassablement pos√©e tant que la fonction <code>validate</code> retourne
autre chose que le bool√©en <code>true</code>&#160;:</p>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">prompt/validate.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span>prompt<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'inquirer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> secret_number <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> questions <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'Devine le nombre secret (entre 1 et 100)'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">validate</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">input<span class="token punctuation">,</span> answers</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>Number<span class="token punctuation">.</span><span class="token function">isNaN</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// <b class="conum">(1)</b></span>
        <span class="token keyword">return</span> <span class="token string">'Ce n\'est pas un nombre'</span><span class="token punctuation">;</span>     <span class="token comment">// <b class="conum">(2)</b></span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>input <span class="token operator">></span> secret_number<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">'C\'est plus petit.'</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>input <span class="token operator">&lt;</span> secret_number<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">'C\'est plus grand.'</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>                            <span class="token comment">// <b class="conum">(3)</b></span>
  <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token function">prompt</span><span class="token punctuation">(</span>questions<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">answers</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Bravo, la r√©ponse est </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>secret_number<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> !`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Nous nous assurons que la valeur saisie est assimil√©e √† un nombre.</p>
</li>
<li>
<p>Sinon, nous retournons un texte utilis√© comme message d&#8217;erreur.</p>
</li>
<li>
<p>Cette condition remplie, le module passera √† la question suivante.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Enfin, deux modes de liste sont propos√©s par le module <em>inquirer</em>&#160;: <code>list</code>
et <code>checkbox</code>.

Dans le premier cas, nous naviguons au clavier pour s√©lectionner une seule r√©ponse.
Dans le deuxi√®me, nous naviguons au clavier et s√©lectionnons les choix
√† l&#8217;aide de la touche <b class="button">Espace</b>&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node prompt/list.js
? Tu fais quoi lundi ?
  Je quitte mon job
‚ùØ Je pars en vacances
  J'apprends Node.js</pre>
</div>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">prompt/list.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span>prompt<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'inquirer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">prompt</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'type'</span><span class="token punctuation">,</span>
    type<span class="token punctuation">:</span> <span class="token string">'list'</span><span class="token punctuation">,</span>                     <span class="token comment">// <b class="conum">(1)</b></span>
    message <span class="token punctuation">:</span> <span class="token string">'Tu fais quoi lundi ?'</span><span class="token punctuation">,</span>
    choices<span class="token punctuation">:</span> <span class="token punctuation">[</span>                        <span class="token comment">// <b class="conum">(2)</b></span>
      <span class="token string">'Je quitte mon job'</span><span class="token punctuation">,</span>
      <span class="token string">'Je pars en vacances'</span><span class="token punctuation">,</span>
      <span class="token string">'J\'apprends Node.js'</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Le champ <code>type</code> sert √† expliciter la nature de la question&#160;‚Äì l&#8217;interface utilisateur s&#8217;adapte.</p>
</li>
<li>
<p>Le champ <code>choices</code> contient la liste des choix propos√©s √† l&#8217;√©cran.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Le potentiel de combinaison de ces √©l√©ments est vraiment int√©ressant.
Nous pourrions cr√©er des quiz, des interfaces de recherche ou faciliter
la cr√©ation de fichiers de configuration sans avoir √† mettre les mains dans le
cambouis.
Les choix mis √† disposition dans l&#8217;interface se cr√©ent aussi dynamiquement,
√† partir de donn√©es obtenues depuis une ressource distante&#160;‚Äì
ils n&#8217;est pas n√©cessaire de les √©crire en dur dans le code.</p>
</div>
</div>
<div class="sect2">
<h3 id="progress">2.4. Informer de la progression</h3>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph">
<p>Je trouve que <strong>transmettre un feedback est un √©l√©ment diff√©renciant</strong> dans la
conception d&#8217;une application&#160;‚Äì qu&#8217;elle soit utilis√©e sur le Web ou dans un
terminal.
Informer de la progression est un des moyens d&#8217;y parvenir.
La progression concerne aussi bien l&#8217;indication du <strong>franchissement d&#8217;√©tapes</strong>
que celle de <strong>pourcentage d&#8217;accomplissement</strong> d&#8217;une t√¢che.</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node progress/intro.js
(‚Ä¢¬∑¬∑) Un-deux-trois
(‚Ä¢‚Ä¢¬∑) Un-deux-trois
(‚Ä¢‚Ä¢‚Ä¢) Un-deux-trois ‚òÄÔ∏è</pre>
</div>
</div>
<div class="paragraph">
<p>Cette approche est une premi√®re tentative d&#8217;indiquer une progression √† travers
deux m√©canismes&#160;: le passage du vide au plein en utilisant un caract√®re qui
v√©hicule ce changement et l&#8217;utilisation d&#8217;un signal visuel pour informer de
l&#8217;accomplissement de la t√¢che.</p>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">progress/intro.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">display</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> progress <span class="token operator">=</span> <span class="token string">'‚Ä¢'</span><span class="token punctuation">.</span><span class="token function">repeat</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padEnd</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'¬∑'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// <b class="conum">(2)</b></span>
  <span class="token keyword">const</span> sun <span class="token operator">=</span> count <span class="token operator">===</span> <span class="token number">3</span> <span class="token operator">?</span> <span class="token string">'‚òÄÔ∏è'</span> <span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>progress<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">) Un-deux-trois </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sun<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// <b class="conum">(3)</b></span>
<span class="token punctuation">}</span>

<span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  counter<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token function">display</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">// <b class="conum">(1)</b></span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>counter <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">)</span> process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Cette fonction affiche la progression toutes les secondes.</p>
</li>
<li>
<p>La m√©thode <code>padEnd()</code> (<a href="../chapter-03/index.html">chapitre&#160;3</a>) compl√®te la barre de progression jusqu&#8217;√† atteindre le nombre souhait√© de points.</p>
</li>
<li>
<p>Le message de progression est param√©tr√© pour afficher les √©l√©ments n√©cessaires&#160;‚Äì l&#8217;√©moji &#8220;soleil&#8221; s&#8217;affiche quand le compteur atteint&#160;<code>3</code>.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">üí°</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Performance</span> La vitesse est toute relative</div>
<div class="paragraph">
<p>Une action qui est instantan√©e sur notre ordinateur peut durer
plusieurs secondes sur un autre, du fait de ressources moindres ou d&#8217;un acc√®s
r√©seau moins favorable par exemple.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>La seule chose qu&#8217;il manque √† mon go√ªt est d&#8217;avoir un r√©el sens de progression,
c&#8217;est-√†-dire une actualisation du contenu qui informe de l&#8217;avancement.</p>
</div>
<div class="paragraph">
<p>Nous avons parl√© des commandes ANSI pour <a href="#colors">changer les couleurs</a>.


Il se trouve que certaines de ces commandes contr√¥lent aussi la <strong>position du curseur</strong>.
Ainsi, au lieu d&#8217;√©crire √† la suite, nous pouvons revenir en arri√®re et m√™me
effacer le contenu d&#8217;une ligne.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/cli-dots.png" alt="cli dots">
</div>
<div class="title">Figure 3. Pendant et apr√®s la progression d&#8217;un script&#160;Node</div>
</div>
<div class="paragraph">
<p>Il n&#8217;y a pas beaucoup de code √† changer dans l&#8217;exemple pr√©c√©dent pour y parvenir.</p>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">progress/dots.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">display</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> dots <span class="token operator">=</span> <span class="token string">'‚Ä¢'</span><span class="token punctuation">.</span><span class="token function">repeat</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padEnd</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'¬∑'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> sun <span class="token operator">=</span> count <span class="token operator">===</span> <span class="token number">3</span> <span class="token operator">?</span> <span class="token string">'‚òÄÔ∏è'</span> <span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> cmd <span class="token operator">=</span> counter <span class="token operator">!==</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token string">'\x1B[1F'</span> <span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span>           <span class="token comment">// <b class="conum">(1)</b></span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>cmd<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dots<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">) Un-deux-trois </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sun<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// <b class="conum">(2)</b></span>
<span class="token punctuation">}</span>

<span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  counter<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token function">display</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>counter <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">)</span> process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>La s√©quence d&#8217;√©chappement&#160;<code>\x1B</code> suivie de la commande&#160;<code>1F</code> d√©place le curseur d&#8217;une ligne vers le haut.</p>
</li>
<li>
<p>Cette s√©quence est ajout√©e en d√©but de ligne remonter d&#8217;une ligne avant d&#8217;√©crire la suite des caract√®res.</p>
</li>
</ol>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Tableau 2. Liste de commandes ANSI pour d√©placer le curseur</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Commande</th>
<th class="tableblock halign-left valign-top">Effet</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;n&gt;E</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Descend le curseur de <code>&lt;n&gt;</code>&#160;lignes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;n&gt;F</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remonte le curseur de <code>&lt;n&gt;</code>&#160;lignes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;n&gt;K</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Efface le contenu de la ligne, jusqu&#8217;√† la fin si <code>&lt;n&gt;</code>&#160;vaut&#160;<code>0</code>, jusqu&#8217;au d√©but si <code>&lt;n&gt;</code>&#160;vaut&#160;<code>1</code>, enti√®rement si <code>&lt;n&gt;</code>&#160;vaut&#160;<code>2</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;n&gt;A</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">D√©place le curseur de <code>&lt;n&gt;</code>&#160;cases vers le haut.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;n&gt;B</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">D√©place le curseur de <code>&lt;n&gt;</code>&#160;cases vers le bas.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;n&gt;C</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">D√©place le curseur de <code>&lt;n&gt;</code>&#160;cases vers la droite.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;n&gt;D</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">D√©place le curseur de <code>&lt;n&gt;</code>&#160;cases vers la gauche.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>√Ä partir de l√†, nous sommes libres d&#8217;√©crire nos propres barres de progression,
des indicateurs d&#8217;activit√© et de ne garder √† l&#8217;√©cran que les informations
refl√©tant l&#8217;√©tat actuel de l&#8217;application.</p>
</div>
<div class="paragraph">
<p>Deux modules <code>npm</code> simplifient la vie quand on n&#8217;appr√©cie pas trop les commandes ANSI&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>ansi-escapes</em> (<span class="URL"><a href="https://npmjs.com/ansi-escapes" class="bare">npmjs.com/ansi-escapes</a></span>) est l&#8217;√©quivalent
de <em>chalk</em> mais pour d√©placer le curseur.

L&#8217;utilisation de m√©thodes nomm√©es remplace celle des commandes&#160;ANSI.</p>
</li>
<li>
<p><em>progress-string</em> (<span class="URL"><a href="https://npmjs.com/progress-string" class="bare">npmjs.com/progress-string</a></span>) met
√† disposition une base pour afficher des barres de progression
avec un minimum d&#8217;options.
</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Terminons cette section avec l&#8217;utilisation d&#8217;un indicateur d&#8217;activit√©
et une information de r√©ussite ou non de notre action.
Nous nous aidons du module&#160;<code>npm</code> <em>ora</em> (<span class="URL"><a href="https://npmjs.com/ora" class="bare">npmjs.com/ora</a></span>).


Il est rapide √† configurer et propose une palette int√©ressante d&#8217;animations.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/cli-spinner.png" alt="cli spinner">
</div>
<div class="title">Figure 4. Pendant et apr√®s la progression avec le module&#160;ora</div>
</div>
<div class="paragraph">
<p>Nous nous retrouvons √† enlever encore quelques lignes par rapport aux
exemples pr√©c√©dents&#160;:</p>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">progress/spinner.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> ora <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ora'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> progress <span class="token operator">=</span> <span class="token function">ora</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token string">'Un-deux-trois‚Ä¶'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// <b class="conum">(1)</b></span>

<span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  counter<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>counter <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    progress<span class="token punctuation">.</span><span class="token function">succeed</span><span class="token punctuation">(</span><span class="token string">'Un-deux-trois‚Ä¶ Soleil !'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// <b class="conum">(2)</b></span>
    process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Cr√©e et affiche un indicateur de progression anim√©.</p>
</li>
<li>
<p>Nous indiquons que la t√¢che est termin√©e&#160;‚Äì l&#8217;animation est remplac√©e par une marque de succ√®s.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Nous pouvons aussi tirer parti du fonctionnement du module <em>ora</em> en reproduisant
l&#8217;animation et en personnalisant le symbole de r√©ussite.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/cli-spinner-custom.png" alt="cli spinner custom">
</div>
<div class="title">Figure 5. Pendant et&#160;apr√®s l&#8217;indicateur de progression personnalis√© avec le module&#160;ora</div>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">progress/spinner-custom.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> ora <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ora'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> progress <span class="token operator">=</span> <span class="token function">ora</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  color<span class="token punctuation">:</span> <span class="token string">'yellow'</span><span class="token punctuation">,</span>
  spinner<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    frames<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'¬∑¬∑¬∑'</span><span class="token punctuation">,</span> <span class="token string">'‚Ä¢¬∑¬∑'</span><span class="token punctuation">,</span> <span class="token string">'‚Ä¢‚Ä¢¬∑'</span><span class="token punctuation">,</span> <span class="token string">'‚Ä¢‚Ä¢‚Ä¢'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// <b class="conum">(1)</b></span>
    interval<span class="token punctuation">:</span> <span class="token number">1000</span>                        <span class="token comment">// <b class="conum">(2)</b></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

progress<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token string">'Un-deux-trois‚Ä¶'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  progress<span class="token punctuation">.</span><span class="token function">stopAndPersist</span><span class="token punctuation">(</span><span class="token punctuation">{</span> symbol<span class="token punctuation">:</span> <span class="token string">'‚òÄÔ∏è'</span><span class="token punctuation">,</span> text<span class="token punctuation">:</span> <span class="token string">'Soleil !'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Cr√©ation d&#8217;une s√©rie d&#8217;√©l√©ments d&#8217;animation.</p>
</li>
<li>
<p>Nous passons d&#8217;un index √† l&#8217;autre √† la vitesse exprim√©e en millisecondes.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="tables">2.5. Afficher des informations sous forme de tableau</h3>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph">
<p>L&#8217;affichage d&#8217;informations sous forme de tableau est id√©al pour
le <strong>confort de lecture de listes</strong>.
Notre lecture gagne en qualit√© quand notre vision s&#8217;attend
√† retrouver une structure pr√©dictible.</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node table.js
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï§‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë Titre                       ‚îÇ ISBN           ‚ïë
‚ïü‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ï¢
‚ïë Node.js                     ‚îÇ 978-2212139938 ‚ïë
‚ïü‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ï¢
‚ïë Sass pour les web designers ‚îÇ 978-2212141474 ‚ïë
‚ïü‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ï¢
‚ïë Design Systems              ‚îÇ 978-3945749586 ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïß‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù</pre>
</div>
</div>
<div class="paragraph">
<p>Cet exemple est g√©n√©r√© √† l&#8217;aide du module&#160;<code>npm</code> <em>table</em> (<span class="URL"><a href="https://npmjs.com/table" class="bare">npmjs.com/table</a></span>).

Il s&#8217;utilise sans configuration pour d√©marrer.
Il a la capacit√© de tronquer et limiter la largeur des colonnes, mais aussi
de g√©rer l&#8217;alignement des contenus dans les cellules.</p>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">table.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span>table<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'table'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>bold<span class="token punctuation">,</span> green<span class="token punctuation">:</span>g<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'chalk'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token function">bold</span><span class="token punctuation">(</span><span class="token string">'Titre'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">bold</span><span class="token punctuation">(</span><span class="token string">'ISBN'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token comment">// <b class="conum">(1)</b></span>
  <span class="token punctuation">[</span><span class="token function">g</span><span class="token punctuation">(</span><span class="token string">'Node.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'978-2212139938'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>   <span class="token comment">// <b class="conum">(2)</b></span>
  <span class="token punctuation">[</span><span class="token function">g</span><span class="token punctuation">(</span><span class="token string">'Sass pour les web designers'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'978-2212141474'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token function">g</span><span class="token punctuation">(</span><span class="token string">'Design Systems'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'978-3945749586'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">table</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// <b class="conum">(3)</b></span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>L&#8217;en-t√™te du tableau se distingue gr√¢ce √† un style diff√©rent&#160;‚Äì du texte en gras.</p>
</li>
<li>
<p>Chaque ligne du tableau est elle-m√™me un tableau, √† deux colonnes dans ce cas de figure.</p>
</li>
<li>
<p>L&#8217;affichage se fait sur un simple appel de fonction&#160;‚Äì <em>table</em> calcule la largeur des colonnes pour&#160;nous.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">üí°</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Pratique</span> Utilisation des couleurs</div>
<div class="paragraph">
<p>
La lecture de la section &#8220;<a href="#colors">am√©liorer la lisibilit√© gr√¢ce aux couleurs</a>&#8221;
vous aidera √† am√©liorer la lisibilit√© de vos tableaux.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Il est √† noter que le module <em>table</em> expose aussi une interface en flux, pour ajouter
des lignes au fur et √† mesure&#160;‚Äì par exemple en cas de lecture continue
ou sur un <a href="#streaming">fichier volumineux</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="update">2.6. Inviter √† mettre √† jour le module</h3>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph">
<p>L&#8217;inconv√©nient d'<a href="../chapter-05/index.html#install.global">installer un module ex√©cutable</a>,
c&#8217;est la difficult√© de savoir si une mise √† jour int√©ressante a √©t√© publi√©e
(probablement parce que je ne pense pas √† lancer la commande <code>npm outdated --global</code>).
Il existe toutefois des moyens de signaler aux personnes qui utilisent votre
ex√©cutable qu&#8217;une version plus r√©cente existe.</p>
</div>
<div class="paragraph">
<p>J&#8217;aime l&#8217;approche minimaliste du module&#160;<code>npm</code> <em>update-check</em>
(<span class="URL"><a href="https://npmjs.com/update-check" class="bare">npmjs.com/update-check</a></span>).

Il compare le num√©ro de version pass√© en param√®tre avec celui de la derni√®re
version de ce m√™me module, sur le registre&#160;<code>npm</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node update/intro.js
{ latest: '0.10.0', fromCache: false }</pre>
</div>
</div>
<div class="paragraph">
<p>Dans cet exemple, <em>update-check</em> interroge le registre&#160;<code>npm</code>
pour d√©terminer la version la plus r√©cente de <em>nodebook</em>.

S&#8217;il estime que la version install√©e localement est plus
ancienne, il retourne un objet avec le num√©ro de version √† installer.</p>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">update/intro.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> check <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'update-check'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> pkg <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'nodebook'</span><span class="token punctuation">,</span> version<span class="token punctuation">:</span> <span class="token string">'0.8.0'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// <b class="conum">(1)</b></span>

<span class="token function">check</span><span class="token punctuation">(</span>pkg<span class="token punctuation">)</span>                              <span class="token comment">// <b class="conum">(2)</b></span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">update</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>update<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// <b class="conum">(3)</b></span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Les champs <code>name</code> et <code>version</code> suffisent √† accomplir la comparaison.</p>
</li>
<li>
<p>D√©marrage de la comparaison.</p>
</li>
<li>
<p>Un objet est retourn√© en cas de version plus r√©cente&#160;; sinon, c&#8217;est la valeur&#160;<code>null</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>En temps normal, c&#8217;est-√†-dire dans le cas d&#8217;un module dont nous sommes √† l&#8217;origine
et que nous publions sur le registre&#160;<code>npm</code>, nous aurions tendance
√† utiliser le contenu du fichier <code>package.json</code> en argument de la fonction <code>check</code>.</p>
</div>
<div class="paragraph">
<p>Maintenant, nous pouvons pr√©senter une information
plus digeste et actionnable √† la personne qui utilise notre module&#160;:
</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node update/cli.js
nodebook@0.10.0 est dispo
Tape 'npm install --global nodebook'</pre>
</div>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">update/cli.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> parse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'minimist'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> check <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'update-check'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> pkg <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'nodebook'</span><span class="token punctuation">,</span> version<span class="token punctuation">:</span> <span class="token string">'0.8.0'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">logError</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>message<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">checkUpdate</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">update</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>update<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>name<span class="token punctuation">}</span> <span class="token operator">=</span> pkg<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">@</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>update<span class="token punctuation">.</span>latest<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> est dispo`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Tape 'npm install -g </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pkg<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">'`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">check</span><span class="token punctuation">(</span>pkg<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>checkUpdate<span class="token punctuation">,</span> logError<span class="token punctuation">)</span>      <span class="token comment">// <b class="conum">(1)</b></span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token function">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...                          // <b class="conum">(2)</b></span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Nous v√©rifions et affichons la mise √† jour si n√©cessaire&#160;; nous g√©rons aussi une erreur (par exemple, r√©seau indisponible ou registre&#160;HS).</p>
</li>
<li>
<p>Nous g√©rons ensuite le code de notre ex√©cutable&#160;‚Äì <em>parsing</em> des arguments, gestion des actions, etc.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Les utilisatrices et utilisateurs sont inform√©s de la disponibilit√© d&#8217;une mise
√† jour d√®s qu&#8217;elles se servenrt du module ex√©cutable en question.
La d√©cision d&#8217;actualiser leur appartient toutefois.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tests">3. Vers un code r√©utilisable et testable</h2>
<div class="sectionbody">
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph">
<p>Nous avons appris comment transformer un script Node en un programme param√©trable,
clair et agr√©able √† utiliser.
Cette section a pour but de renforcer la robustesse de notre code.
Nous allons tout d&#8217;abord s√©parer ce qui est r√©utilisable de l&#8217;interface en ligne
de commande pour progressivement tester notre code, puis l&#8217;ex√©cutable lui-m√™me.</p>
</div>
<div class="paragraph">
<p>Notre progression va s&#8217;effectuer en transformant l&#8217;exemple <code>options/timezone.js</code>
de la section &#8220;<a href="#args">Utiliser des arguments et des options</a>&#8221;.

</p>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">options/timezone.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> parse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'minimist'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token function">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>timezone<span class="token punctuation">]</span> <span class="token operator">=</span> args<span class="token punctuation">.</span>_<span class="token punctuation">;</span>                          <span class="token comment">// <b class="conum">(1)</b></span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>timezone<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">'Merci d\'indiquer un fuseau horaire :-)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  timeZone<span class="token punctuation">:</span> timezone<span class="token punctuation">,</span>
  hour<span class="token punctuation">:</span> <span class="token string">'numeric'</span><span class="token punctuation">,</span> minute<span class="token punctuation">:</span> <span class="token string">'numeric'</span><span class="token punctuation">,</span> hour12<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token comment">// <b class="conum">(2)</b></span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLocaleDateString</span><span class="token punctuation">(</span><span class="token string">'fr-FR'</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>                                  <span class="token comment">// <b class="conum">(3)</b></span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Nous affectons aÃÄ <code>timezone</code> la premieÃÄre valeur du tableau d‚Äôarguments.</p>
</li>
<li>
<p>Configuration des pr√©f√©rences d&#8217;affichage de l&#8217;heure.</p>
</li>
<li>
<p>Utilisation de la m√©thode <code>toLocaleDateString()</code> avec nos options pour afficher la date courante.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="interface">3.1. Modulariser le code du fichier ex√©cutable</h3>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph">
<p>Un programme qui accepte beaucoup d&#8217;options devient de plus en plus
compliqu√© √† maintenir car il est difficile de tester tous les cas
de figure √† la main.</p>
</div>
<div class="paragraph">
<p>Un programme ex√©cutable robuste est un script qui contient le moins possible de code
sp√©cifique √† la gestion de la ligne de commandes.
Pour ce faire, nous allons s√©parer la logique d&#8217;ex√©cution en la pla√ßant dans une
fonction, dans un autre module.</p>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">testing/01/cli.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> getTime <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./lib.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'minimist'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>timezone<span class="token punctuation">]</span> <span class="token operator">=</span> args<span class="token punctuation">.</span>_<span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getTime</span><span class="token punctuation">(</span>timezone<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// <b class="conum">(1)</b></span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Tout le code a √©t√© modularis√© sous forme d&#8217;une seule fonction.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Nous avons op√©r√© un changement&#160;: l&#8217;utilisation de <code>console.log()</code> pour l&#8217;affichage
des r√©sultats revient du c√¥t√© de l&#8217;ex√©cutable.</p>
</div>
<div class="paragraph">
<p>Notre code est portable s&#8217;il retourne un r√©sultat et en laissant la
responsabilit√© de l&#8217;affichage au code le plus proche de l&#8217;utilisateur
‚Äì c&#8217;est le cas ici avec la fonction <code>getTime()</code>.</p>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">testing/01/lib.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">timezone</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>timezone<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">'Merci d\'indiquer un fuseau horaire :-)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
    timeZone<span class="token punctuation">:</span> timezone<span class="token punctuation">,</span>
    hour<span class="token punctuation">:</span> <span class="token string">'numeric'</span><span class="token punctuation">,</span> minute<span class="token punctuation">:</span> <span class="token string">'numeric'</span><span class="token punctuation">,</span> hour12<span class="token punctuation">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLocaleDateString</span><span class="token punctuation">(</span><span class="token string">'fr-FR'</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Cette √©criture facilite l&#8217;√©criture de tests.
Justement, parlons-en.</p>
</div>
</div>
<div class="sect2">
<h3 id="tests.interface">3.2. Tester le code partag√©</h3>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph">
<p>L&#8217;√©criture de tests nous aide √† d√©couvrir qu&#8217;une modification produit un r√©sultat
diff√©rent de celui attendu.
Les tests documentent aussi les cas √† la marge de notre code.
En g√©n√©ral, d√®s qu&#8217;il y a un <code>if &#8230;&#8203; else</code>, cela implique d&#8217;√©crire au moins une
nouvelle assertion.
</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">üí¨</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Glossaire</span> Test et assertion</div>
<div class="paragraph">
<p>Une assertion est l&#8217;expression d&#8217;une attente quant au fonctionnement de notre code.</p>
</div>
<div class="paragraph">
<p>Un test s&#8217;applique √† une fonction et utilise une √† plusieurs assertion(s) pour
couvrir le spectre de ses fonctionnalit√©s.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Pour des besoins simples, j&#8217;utilise le module&#160;<code>npm</code> <em>tape</em>
(<span class="URL"><a href="https://npmjs.com/tape" class="bare">npmjs.com/tape</a></span>).

Il g√®re l&#8217;ex√©cution des tests et il fournit quelques m√©thodes pour exprimer
nos attentes&#160;‚Äì les assertions.
</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node testing/01/lib.test.js
TAP version 13
<span data-bash-subs="#"></span>getTime
ok 1 should be truthy
ok 2 should throw

1..2
<span data-bash-subs="#"></span>tests 2
<span data-bash-subs="#"></span>pass  2

<span data-bash-subs="#"></span>ok</pre>
</div>
</div>
<div class="paragraph">
<p>Dans ce cas pr√©cis, j&#8217;ai √©crit deux assertions qui illustrent les diff√©rents
cas de figure repr√©sent√©s dans le fichier <code>01/lib.js</code>
‚Äì quand l&#8217;erreur est provoqu√©e et quand le r√©sultat est retourn√©&#160;:</p>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">testing/01/lib.test.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> test <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'tape'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> getTime <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./lib.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'getTime'</span><span class="token punctuation">,</span> <span class="token parameter">t</span> <span class="token operator">=></span> <span class="token punctuation">{</span>                          <span class="token comment">// <b class="conum">(1)</b></span>
  t<span class="token punctuation">.</span><span class="token function">plan</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                    <span class="token comment">// <b class="conum">(2)</b></span>

  t<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token string">'Europe/Paris'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// <b class="conum">(3)</b></span>
  t<span class="token punctuation">.</span><span class="token function">throws</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token regex">/fuseau horaire/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// <b class="conum">(4)</b></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Cr√©ation d&#8217;un test&#160;‚Äì le param√®tre&#160;<code>t</code> contient les m√©thodes d&#8217;assertion.</p>
</li>
<li>
<p>La m√©thode <code>t.plan()</code> sp√©cifie le nombre d&#8217;assertions attendues&#160;‚Äì si ce nombre n&#8217;est pas atteint, <em>tape</em> consid√®re qu&#8217;il y a un probl√®me.</p>
</li>
<li>
<p>Assertion qui teste que la fonction <code>getTime()</code> retourne bien un r√©sultat.</p>
</li>
<li>
<p>Assertion qui teste que la fonction <code>getTime()</code> provoque une erreur si aucun argument n&#8217;est pass√©.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Nous sommes par√©s √† toute √©ventualit√©, mais en y r√©fl√©chissant, le module <code>cli.js</code>
ne g√®re pas vraiment le cas o√π aucun argument n&#8217;est transmis.</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node testing/01/cli.js
/‚Ä¶/chapter-08/examples/testing/01/lib.js:5
    throw Error('Merci d\'indiquer un fuseau horaire :-)');
    ^

Error: Merci d'indiquer un fuseau horaire :-)
    at module.exports (/‚Ä¶/examples/testing/01/lib.js:5:11)
    at Object.<anonymous> (/‚Ä¶/examples/testing/01/cli.js:7:13)
    at Module._compile (internal/modules/cjs/loader.js:702:30)
    at Object.Module._extensions..js (‚Ä¶/cjs/loader.js:713:10)
    ‚Ä¶</pre>
</div>
</div>
<div class="paragraph">
<p>Je trouve peu √©l√©gant d&#8217;√™tre accueilli¬∑e avec une trace d&#8217;erreur comme celle-ci.
L&#8217;erreur m√©riterait d&#8217;√™tre pr√©sent√©e en contexte, celui de notre utilisation
et non celui des rouages internes de&#160;Node.</p>
</div>
</div>
<div class="sect2">
<h3 id="display">3.3. Pr√©senter les messages en contexte</h3>
<div class="paragraph">
<p>La pr√©sentation des messages de r√©ussite et d&#8217;erreur n√©cessite d&#8217;√™tre √† l&#8217;√©coute
des signaux envoy√©s par notre code afin de le restituer de mani√®re adapt√©e.</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node testing/02/cli.js
Merci d'indiquer un fuseau horaire :-)</pre>
</div>
</div>
<div class="paragraph">
<p>Afin de parvenir √† ce r√©sultat, j&#8217;ai opt√© pour l&#8217;utilisation de
<a href="../chapter-03/index.html#promise">promesse</a> (<a href="../chapter-03/index.html">chapitre&#160;3</a>).

Je trouve cette m√©thode plus √©l√©gante car nous g√©rons le r√©sultat et le message
d&#8217;erreur d&#8217;une mani√®re visuellement similaire, mais s√©par√©e.</p>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">testing/02/cli.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> getTime <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./lib.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'minimist'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>timezone<span class="token punctuation">]</span> <span class="token operator">=</span> args<span class="token punctuation">.</span>_<span class="token punctuation">;</span>

<span class="token function">getTime</span><span class="token punctuation">(</span>timezone<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">time</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// <b class="conum">(1)</b></span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// <b class="conum">(2)</b></span>
    process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// <b class="conum">(3)</b></span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Le r√©sultat est affich√© en cas de succ√®s.</p>
</li>
<li>
<p>En cas d&#8217;erreur produite dans la fonction <code>getTime()</code>, nous affichons le message en question.</p>
</li>
<li>
<p>Nous arr√™tons le programme avec un code d&#8217;erreur pour la signaler au niveau du syst√®me d&#8217;exploitation.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Ce changement n&#8217;implique pas de bouleversement dans notre code.
L&#8217;appel √† <code>throw</code> est remplac√© par <code>reject()</code> et le <code>return</code> se transforme en <code>resolve()</code>.</p>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">testing/02/lib.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">timezone</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span> <span class="token comment">// <b class="conum">(1)</b></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>timezone<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">'Merci d\'indiquer un fuseau horaire :-)'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
      timeZone<span class="token punctuation">:</span> timezone<span class="token punctuation">,</span>
      hour<span class="token punctuation">:</span> <span class="token string">'numeric'</span><span class="token punctuation">,</span> minute<span class="token punctuation">:</span> <span class="token string">'numeric'</span><span class="token punctuation">,</span> hour12<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLocaleDateString</span><span class="token punctuation">(</span><span class="token string">'fr-FR'</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Nous englobons le contenu entier de la fonction dans une promesse&#160;‚Äì en cas de probl√®me √† un endroit impr√©vu, il sera remont√© et pris en charge de la m√™me mani√®re que notre rejet explicite.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Nous n&#8217;avons plus √† modifier le fichier <code>cli.js</code> pour g√©rer de nouveaux messages
d&#8217;erreur.
Nous pourrions mieux g√©rer certains cas de figure, par exemple quand
un fuseau horaire inconnu est sp√©cifi√©.</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node testing/02/cli.js Brexit/London
Unsupported time zone specified Brexit/London</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tests.cli">3.4. Tester l&#8217;ex√©cutable</h3>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph">
<p>Tester l&#8217;ex√©cutable est un moyen de v√©rifier que les c√¢blages entre notre
ex√©cutable et notre mode Node sont bien faits.
L&#8217;id√©e n&#8217;est pas de tester √† nouveau les m√™mes aspects du code, mais bel et
bien de nous assurer que les conditions d&#8217;utilisation du programme sont remplies.</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node testing/02/cli.test.js
TAP version 13
<span data-bash-subs="#"></span>cli w/o arg
ok 1 exit code matched
<span data-bash-subs="#"></span>cli w/ arg
ok 2 matched /\d{2}:\d{2}/
ok 3 exit code matched

1..3
<span data-bash-subs="#"></span>tests 3
<span data-bash-subs="#"></span>pass  3

<span data-bash-subs="#"></span>ok</pre>
</div>
</div>
<div class="paragraph">
<p>Nous avons √† nouveau recours au module <em>tape</em>.
Cette fois-ci, nous l&#8217;accompagnons d&#8217;un autre module,
<em>tape-spawn</em> (<span class="URL"><a href="https://npmjs.com/tape-spawn" class="bare">npmjs.com/tape-spawn</a></span>).


Ce dernier int√®gre √† <em>tape</em> le test de processus externes.
En l&#8217;occurrence ici, cela concerne nos ex√©cutables en ligne de commandes.</p>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">testing/02/cli.test.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> test <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'tape'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> spawn <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'tape-spawn'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> opts <span class="token operator">=</span> <span class="token punctuation">{</span>cwd<span class="token punctuation">:</span> __dirname<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'cli w/o arg'</span><span class="token punctuation">,</span> <span class="token parameter">t</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> proc <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token string">'./cli.js'</span><span class="token punctuation">,</span> opts<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// <b class="conum">(1)</b></span>
  proc<span class="token punctuation">.</span><span class="token function">exitCode</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                         <span class="token comment">// <b class="conum">(2)</b></span>
  proc<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'cli w/ arg'</span><span class="token punctuation">,</span> <span class="token parameter">t</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> proc <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token string">'./cli.js Europe/Paris'</span><span class="token punctuation">,</span> opts<span class="token punctuation">)</span><span class="token punctuation">;</span>
  proc<span class="token punctuation">.</span><span class="token function">exitCode</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  proc<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/\d{2}:\d{2}/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// <b class="conum">(3)</b></span>
  proc<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Nous d√©marrons un nouveau processus&#160;‚Äì ici, nous sp√©cifions que le chemin d&#8217;acc√®s est relatif au r√©pertoire du script de tests.</p>
</li>
<li>
<p>Nous testons le code de sortie du programme&#160;‚Äì c&#8217;est coh√©rent avec l&#8217;invocation de <code>process.exit(1)</code> dans <code>cli.js</code>.</p>
</li>
<li>
<p>En cas de r√©ussite, nous avons bien une heure qui s&#8217;affiche dans la sortie standard.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>L&#8217;utilisation conjointe des tests unitaires et de ceux de l&#8217;ex√©cutable
nous permet de gagner en confiance dans la robustesse de notre code,
de d√©celer de nouveaux cas √† la marge et de nous rendre compte de certaines
incoh√©rences d&#8217;interface utilisateur.</p>
</div>
</div>
<div class="sect2">
<h3 id="doc">3.5. Documenter notre programme</h3>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph">
<p>La documentation d&#8217;un logiciel est aussi importante que son code.
C&#8217;est le premier √©l√©ment qui donne une id√©e de la simplicit√© ou de
la complexit√© d&#8217;utilisation d&#8217;un logiciel, de ce qu&#8217;il est possible de faire avec
et des concepts qui s&#8217;y rapportent.</p>
</div>
<div class="paragraph">
<p>Le premier endroit o√π documenter son application est dans l&#8217;ex√©cutable lui-m√™me,
avec l&#8217;option <code>--help</code>&#160;‚Äì ou son raccourci&#160;<code>-h</code>.
C&#8217;est une convention pour afficher une aide synth√©tique, rapide d&#8217;acc√®s
et facile √† comprendre.</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node application/intro.js --help

Options:
  --help     Affiche de l'aide             [bool√©en]
  --version  Affiche le num√©ro de version  [bool√©en]
  --utc, -u                                [bool√©en]</pre>
</div>
</div>
<div class="paragraph">
<p>L&#8217;aide propos√©e ici est minimale et n&#8217;indique que trop peu l&#8217;intention du programme.
Nous n&#8217;avons aucune id√©e de l&#8217;effet de telle ou telle option,
du r√©sultat qui va se produire ou encore des valeurs accept√©es par le programme.</p>
</div>
<div class="paragraph">
<p>Une aide qui me rassure et m&#8217;informe ressemble plut√¥t √† ce qui suit&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node help/time.js --help
Affiche l'heure courante d'ici ou d'ailleurs.

Commandes:
  time.js timezones  Affiche les fuseaux horaires IANA.

Options:
  --version   Affiche le num√©ro de version            [bool√©en]
  --utc       Utilise le fuseau horaire universel.    [bool√©en]
  --timezone  Pr√©cise le fuseau horaire au format IANA.
  --help      Affiche de l'aide                       [bool√©en]

Exemples:
  time.js --utc                    Heure universelle.
  time.js --timezone=Europe/Lisbon Heure de Lisbonne.</pre>
</div>
</div>
<div class="paragraph">
<p>Elle v√©hicule l'<strong>intention du programme</strong>, des exemples qui pr√©cisent un concept
que je ne connais pas (fuseau horaire IANA) et j&#8217;y d√©couvre m√™me
l&#8217;existence d&#8217;une commande qui liste ces fameux fuseaux horaires.
Au premier coup d&#8217;≈ìil, je ne d√©c√®le pas d&#8217;impasse et j&#8217;y vois plut√¥t une
invitation √† essayer sans appr√©hension.</p>
</div>
<div class="paragraph">
<p>Cette aide a √©t√© g√©n√©r√©e automatiquement en utilisant le <a href="#application">framework</a>
<em>yargs</em>&#160;‚Äì nous en parlerons dans la section suivante.

Ses m√©thodes <code>.usage()</code> et <code>.example()</code> ainsi que la propri√©t√© <code>description</code> de chaque
option suffisent √† constituer un affichage clair et informatif.</p>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">help/time.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'yargs'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">usage</span><span class="token punctuation">(</span><span class="token string">'Affiche l\'heure courante d\'ici ou d\'ailleurs.'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">example</span><span class="token punctuation">(</span><span class="token string">'$0 --utc'</span><span class="token punctuation">,</span> <span class="token string">'Heure universelle.'</span><span class="token punctuation">)</span>            <span class="token comment">// <b class="conum">(1)</b></span>
  <span class="token punctuation">.</span><span class="token function">example</span><span class="token punctuation">(</span><span class="token string">'$0 --timezone=Europe/Lisbon'</span><span class="token punctuation">,</span> <span class="token string">'Heure de Lisbonne.'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">'timezones'</span><span class="token punctuation">,</span> <span class="token string">'Affiche les fuseaux horaires IANA.'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'utc'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> <span class="token string">'boolean'</span><span class="token punctuation">,</span>                                    <span class="token comment">// <b class="conum">(2)</b></span>
    description<span class="token punctuation">:</span> <span class="token string">'Utilise le fuseau horaire universel.'</span> <span class="token comment">// <b class="conum">(3)</b></span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'timezone'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    description<span class="token punctuation">:</span> <span class="token string">'Pr√©cise le fuseau horaire au format IANA.'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">locale</span><span class="token punctuation">(</span><span class="token string">'fr'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span>argv<span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Documente un exemple d&#8217;utilisation et une description qui pr√©cisent l&#8217;intention.</p>
</li>
<li>
<p>Le type de l&#8217;option est rendu explicite lors de l&#8217;affichage de la documentation.</p>
</li>
<li>
<p>La description pr√©cise l&#8217;intention de l&#8217;option pour mieux comprendre son effet si elle est activ√©e.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">üí¨</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Alternative</span> module&#160;npm help-version</div>
<div class="paragraph">
<p>

Le module <em>help-version</em> (<span class="URL"><a href="https://npmjs.com/help-version" class="bare">npmjs.com/help-version</a></span>) g√®re l&#8217;appel
√† l&#8217;option <code>--help</code> et il est ind√©pendant de tout autre module.</p>
</div>
<div class="paragraph">
<p>Le seul risque est d&#8217;avoir une documentation qui est d√©synchronis√©e du
fonctionnement du programme.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Un autre lieu courant pour documenter un projet est le <code>README</code>.


C&#8217;est un fichier texte souvent affich√© en premier sur la page d&#8217;accueil
d&#8217;un projet logiciel.
Sa mise en forme s&#8217;am√©liore avec l&#8217;utilisation d&#8217;une syntaxe de balisage l√©ger
comme <em>Markdown</em>.</p>
</div>
<div class="paragraph">
<p>Ce type de fichier est tr√®s largement suffisant pour documenter un projet.
C&#8217;est l&#8217;√©quivalent de l&#8217;option <code>--help</code>, √† l&#8217;√©chelle de l&#8217;application&#160;‚Äì
son intention g√©n√©rale, sa compatibilit√© de version avec Node, comment l&#8217;installer,
o√π poser des questions et peut-√™tre m√™me davantage d&#8217;exemples pour mieux comprendre
ce qui ne tiendrait pas dans l&#8217;option <code>--help</code>.</p>
</div>
<div class="paragraph">
<p>Je trouve que le <code>README</code> est un excellent endroit pour reporter
l&#8217;affichage de la commande <code>--help</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/documentation-readme.png" alt="documentation readme">
</div>
<div class="title">Figure 6. Pr√©sentation de la documentation d&#8217;un ex√©cutable dans un&#160;README</div>
</div>
<div class="paragraph">
<p>Nul besoin de faire compliqu√© pour v√©hiculer autant d&#8217;informations essentielles
avec un minimum d&#8217;efforts.
D√©marrer un projet en √©crivant cette documentation est un excellent moyen pour
travailler √† la clarification de ses id√©es et pour commencer √† imaginer la
forme que va prendre l'<a href="#tests">√©criture des&#160;tests</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="advanced">4. Pour aller plus loin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Dans les pr√©c√©dentes sections, nous avons vu des composantes essentielles
pour cr√©er un programme ex√©cutable clair et fonctionnel.
Cette derni√®re section va se focaliser sur des concepts qui structurent,
simplifient et rapprochent un ex√©cutable en ligne de commande d&#8217;une application
web ou <em>front-end</em>.</p>
</div>
<div class="sect2">
<h3 id="application">4.1. Utilisation d&#8217;un framework d&#8217;application en ligne de commande</h3>
<div class="paragraph">
<p>
</p>
</div>
<div class="paragraph">
<p>Une application en ligne de commande dont le nombre de lignes de code augmente
devient de <strong>plus en plus complexe √† maintenir</strong>.
Potentiellement, l&#8217;exp√©rience d&#8217;utilisation se d√©grade aussi.
Il faut continuer √† <strong>prendre soin de la coh√©rence des arguments</strong>, des options et
de valider que ce sont les valeurs attendues.
Cette complexit√© appelle aussi √† afficher une aide √† la demande ou de mani√®re
contextuelle, par exemple au niveau de la sous-commande.</p>
</div>
<div class="paragraph">
<p>Des modules&#160;<code>npm</code> comme <em>yargs</em> (<span class="URL"><a href="https://npmjs.com/yargs" class="bare">npmjs.com/yargs</a></span>) aident √†
structurer la cr√©ation d&#8217;applications en ligne de commande en int√©grant
la majorit√© des fonctionnalit√©s vues dans la section
&#8220;<a href="#interactive">Du script au programme interactif</a>&#8221;.
La g√©n√©ration de l&#8217;aide, le <em>parsing</em> d&#8217;arguments et d&#8217;options et leur validation
sont connect√©s ensemble, de mani√®re transparente.</p>
</div>
<div class="paragraph">
<p>Ce genre de module est int√©ressant √† utiliser quand l&#8217;assemblage d&#8217;autres
modules ind√©pendants rend le <a href="#interface">programme trop fragile</a> et
<a href="#tests">trop compliqu√© √† tester</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node application/intro.js --help
Options:
  --version  Affiche le num√©ro de version      [bool√©en]
  --utc, -u                                    [bool√©en]
  --help     Affiche de l'aide                 [bool√©en]</pre>
</div>
</div>
<div class="paragraph">
<p>La commande d&#8217;aide est g√©n√©r√©e automatiquement √† partir de la
d√©finition d&#8217;arguments et d&#8217;options.</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node application/intro.js
{ _: [],
  version: false,
  utc: false,
  u: false,
  help: false,
  '$0': 'application/intro.js' }</pre>
</div>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">application/intro.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> yargs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'yargs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> args <span class="token operator">=</span> yargs
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'utc'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>    <span class="token comment">// <b class="conum">(1)</b></span>
    alias<span class="token punctuation">:</span> <span class="token string">'u'</span><span class="token punctuation">,</span>
    type<span class="token punctuation">:</span> <span class="token string">'boolean'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">locale</span><span class="token punctuation">(</span><span class="token string">'fr'</span><span class="token punctuation">)</span>       <span class="token comment">// <b class="conum">(2)</b></span>
  <span class="token punctuation">.</span>argv<span class="token punctuation">;</span>              <span class="token comment">// <b class="conum">(3)</b></span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Cr√©ation de l&#8217;option <code>--utc</code> avec l&#8217;alias&#160;<code>-u</code>, de type bool√©en.</p>
</li>
<li>
<p>Les messages g√©n√©r√©s par l&#8217;application seront en fran√ßais&#160;‚Äì sans cette option, la langue s&#8217;adapte √† celle du syst√®me d&#8217;exploitation.</p>
</li>
<li>
<p>Applique les r√®gles pr√©c√©dentes aux √©l√©ments contenus dans <code>process.argv</code> et retourne un r√©sultat sous forme d&#8217;objet.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Le m√©canisme de coercition d√©finit la r√®gle de transformation d&#8217;une option
vers une autre repr√©sentation, plus pratique √† utiliser.
C&#8217;est le cas des dates par exemple&#160;: nous les recevons sous forme de cha√Æne de
caract√®res alors qu&#8217;il serait plus facile de travailler avec des
<a href="../chapter-03/index.html#date">objets&#160;<code>Date</code></a>
(<a href="../chapter-03/index.html">chapitre&#160;3</a>).

</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node application/coerce.js --help
Options:
  --help     Affiche de l'aide               [bool√©en]
  --version  Affiche le num√©ro de version    [bool√©en]
  --date               [cha√Æne de caract√®re] [d√©faut: now]</pre>
</div>
</div>
<div class="paragraph">
<p>Par d√©faut, la date est cal√©e sur l&#8217;instant pr√©sent&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node application/coerce.js
2018-06-21T08:41:23.091Z</pre>
</div>
</div>
<div class="paragraph">
<p>Une date peut m√™me √™tre incompl√®te&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node application/coerce.js --date 2018-03-24
2018-03-24T00:00:00.000Z</pre>
</div>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">application/coerce.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> yargs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'yargs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> args <span class="token operator">=</span> yargs
  <span class="token punctuation">.</span><span class="token function">locale</span><span class="token punctuation">(</span><span class="token string">'fr'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'date'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token comment">// <b class="conum">(1)</b></span>
    defaultDescription<span class="token punctuation">:</span> <span class="token string">'now'</span><span class="token punctuation">,</span>        <span class="token comment">// <b class="conum">(2)</b></span>
    <span class="token function-variable function">coerce</span><span class="token punctuation">:</span> <span class="token parameter">input</span> <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span>  <span class="token comment">// <b class="conum">(3)</b></span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span>argv<span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>date<span class="token punctuation">.</span><span class="token function">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>La valeur par d√©faut de l&#8217;option <code>--date</code> est un objet <code>Date</code>.</p>
</li>
<li>
<p>Ce r√©glage personnalise l&#8217;affichage de la valeur par d√©faut dans la zone d&#8217;aide&#160;‚Äì sans cela, la date compl√®te serait affich√©e, ce qui est peu √©l√©gant et moins informatif.</p>
</li>
<li>
<p>Cette fonction s&#8217;assure que toute valeur pass√©e en option est transform√©e en objet&#160;<code>Date</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Voici un autre exemple du m√©canisme de coercition, cette fois-ci appliqu√©
√† un chemin d&#8217;acc√®s de fichier&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node application/coerce-file.js --json-file ../package.json
{ name: 'nodebook.chapter-08',
  version: '1.0.0',
  ...
}</pre>
</div>
</div>
<div class="paragraph">
<p>Le chemin d&#8217;acc√®s pass√© en option est intercept√© par une fonction.
Elle le re√ßoit en argument et a la responsabilit√© d&#8217;en lire
le contenu et de le transformer en objet ECMAScript gr√¢ce √† la fonction
<a href="../chapter-03.index.html#json"><code>JSON.parse()</code></a>
(<a href="../chapter-03/index.html">chapitre&#160;3</a>).
</p>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">application/coerce-file.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> yargs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'yargs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>readFileSync<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">parseJSON</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> args <span class="token operator">=</span> yargs
  <span class="token punctuation">.</span><span class="token function">locale</span><span class="token punctuation">(</span><span class="token string">'fr'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'json-file'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
    coerce<span class="token punctuation">:</span> parseJSON<span class="token punctuation">,</span>        <span class="token comment">// <b class="conum">(1)</b></span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span>argv<span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>jsonFile<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// <b class="conum">(2)</b></span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Notre fonction <code>parseJSON()</code> assure la transformation de l&#8217;argument <code>--json-file</code>.</p>
</li>
<li>
<p>C&#8217;est bien le contenu du fichier qui s&#8217;affiche et non la valeur pass√©e au programme.</p>
</li>
</ol>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">‚ö†Ô∏è</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Performance</span> Lire et √©crire des fichiers</div>
<div class="paragraph">
<p>


La lecture de fichiers dont la taille d√©passe quelques centaines de kilo-octets
devient probl√©matique sur des machines avec peu de ressources,
si vous souhaitez obtenir des r√©sultats le plus t√¥t possible et si
vous avez d&#8217;autres imp√©ratifs de performance.</p>
</div>
<div class="paragraph">
<p>Je vous invite √† lire la section &#8220;<a href="#streaming">Utiliser les flux de donn√©es</a>&#8221;
pour en savoir plus.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Cette pratique renforce une approche applicative modulaire.
L'<strong>interface absorbe</strong> les sp√©cificit√©s de la ligne de commandes.
L'<strong>application r√©agit aux param√®tres</strong> sans avoir √† se pr√©occuper du contexte,
que ce soit sur le Web ou dans un terminal.</p>
</div>
<div class="paragraph">
<p>Les frameworks d&#8217;application en ligne de commande facilitent
l&#8217;organisation et la d√©finition de <a href="#args.subcommand">sous-commandes</a>.
</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node application/random.js --help
random.js [command]

Commandes:
  random.js words [count]  Des mots
  random.js number         Un nombre

Options:
  --help     Affiche de l'aide                [bool√©en]
  --version  Affiche le num√©ro de version     [bool√©en]</pre>
</div>
</div>
<div class="paragraph">
<p>C&#8217;est l&#8217;occasion d&#8217;adapter l&#8217;exemple utilis√© dans la section
&#8220;<a href="#args.subcommand">Utiliser des arguments et des options</a>&#8221;.


L&#8217;intention est de modifier le moins possible le code initial.</p>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">application/random.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span>random<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'faker/locale/fr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> yargs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'yargs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">number</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> random<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">words</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">count<span class="token operator">=</span><span class="token number">5</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> random<span class="token punctuation">.</span><span class="token function">words</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>

yargs
  <span class="token punctuation">.</span><span class="token function">locale</span><span class="token punctuation">(</span><span class="token string">'fr'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">'words [count]'</span><span class="token punctuation">,</span> <span class="token string">'Des mots'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span> <span class="token comment">// <b class="conum">(1)</b></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">words</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                     <span class="token comment">// <b class="conum">(2)</b></span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">'number'</span><span class="token punctuation">,</span> <span class="token string">'Un nombre'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span>argv<span class="token punctuation">;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>La commande <code>words</code> accepte un argument optionnel <code>count</code>.</p>
</li>
<li>
<p>Cette fonction est d√©clench√©e quand la commande <code>words</code> est ex√©cut√©e.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Je trouve qu&#8217;il est plus facile d&#8217;ex√©cuter une fonction avec les bons arguments
en utilisant ce m√©canisme de sous-commandes.
Nous n&#8217;avons m√™me pas eu √† modifier la signature des fonctions <code>words</code> et <code>number</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">üí¨</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Syntaxe</span> Annotation des arguments dans une commande</div>
<div class="paragraph">
<p>
Certains frameworks comme <em>yargs</em> interpr√®tent la commande que nous d√©clarons.
Lorsque c&#8217;est le cas, les arguments sont rang√©s dans un objet d&#8217;arguments nomm√©s.
Les frameworks g√®rent plusieurs cas de figure qui ont chacun leur notation.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Syntaxe</th>
<th class="tableblock halign-left valign-top">Type d&#8217;argument</th>
<th class="tableblock halign-left valign-top">Explication</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmd [arg1]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optionnel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L&#8217;argument <code>arg1</code> n&#8217;est pas obligatoire.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmd &lt;arg1&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Obligatoire</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L&#8217;argument <code>arg1</code> est obligatoire.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">`cmd &lt;arg1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">arg2&gt;`</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alias</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">L&#8217;argument est obligatoire et accepte deux informations diff√©rentes ‚Äì un identifiant ou une adresse courriel par exemple.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmd [&#8230;&#8203;args]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tableau</p></td>
</tr>
</tbody>
</table>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Un r√©sultat identique s&#8217;obtient en organisant les sous-commandes dans des fichiers
individuels et en indiquant √† <em>yargs</em> dans quel r√©pertoire les charger.</p>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">application/random-dir.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> yargs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'yargs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

yargs
  <span class="token punctuation">.</span><span class="token function">locale</span><span class="token punctuation">(</span><span class="token string">'fr'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">commandDir</span><span class="token punctuation">(</span><span class="token string">'./commands'</span><span class="token punctuation">)</span> <span class="token comment">// <b class="conum">(1)</b></span>
  <span class="token punctuation">.</span>argv<span class="token punctuation">;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>D√©claration du r√©pertoire dans lequel nous avons rang√© les sous-commandes.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Nous ne d√©clarons plus les commandes sous forme d&#8217;un appel de fonction mais
en retournant un module Node.
Chacune de ses cl√©s configure un aspect de la commande&#160;:</p>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">application/commands/words.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span>random<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'faker/locale/fr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  command<span class="token punctuation">:</span> <span class="token string">'words [count]'</span><span class="token punctuation">,</span>                      <span class="token comment">// <b class="conum">(1)</b></span>
  desc<span class="token punctuation">:</span> <span class="token string">'G√©n√®re des mots'</span><span class="token punctuation">,</span>                       <span class="token comment">// <b class="conum">(2)</b></span>
  <span class="token function-variable function">handler</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>                           <span class="token comment">// <b class="conum">(3)</b></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span><span class="token function">words</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>count <span class="token operator">||</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Arguments accept√©s par la commande.</p>
</li>
<li>
<p>Description de la commande.</p>
</li>
<li>
<p>Fonction d√©clench√©e lorsque la commande est ex√©cut√©e.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="files">4.2. Strat√©gies pour g√©rer les chemins d&#8217;acc√®s</h3>
<div class="paragraph">
<p>

</p>
</div>
<div class="paragraph">
<p>Il y a des cas o√π passer des chemins d&#8217;acc√®s √† des fichiers en <a href="#args">arguments</a>
d&#8217;un ex√©cutable ne suffit pas.
C&#8217;est le cas notamment quand on ne conna√Æt pas la liste exacte des fichiers ou
lorsqu&#8217;elle est susceptible de changer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node files/intro.js ../package.json \
  "$(nodebook dir chapter-08 --root)/package-lock.json"

[ '‚Ä¶/chapter-08/package.json',
  '‚Ä¶/chapter-08/package-lock.json' ]</pre>
</div>
</div>
<div class="paragraph">
<p>Cet exemple illustre l&#8217;utilisation d&#8217;un chemin relatif et d&#8217;un
chemin absolu, tous deux normalis√©s en chemins absolus.
En proc√©dant ainsi, nous rendons notre code ind√©pendant de son
contexte d&#8217;ex√©cution&#160;‚Äì ici, notre emplacement au sein du syst√®me de fichiers.</p>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">files/intro.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span>resolve<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> files <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// <b class="conum">(1)</b></span>

<span class="token keyword">const</span> <span class="token function-variable function">resolveFile</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">resolve</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// <b class="conum">(2)</b></span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>files<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>resolveFile<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// <b class="conum">(3)</b></span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>La liste des fichiers correspond √† tous les arguments du script.</p>
</li>
<li>
<p>Chaque chemin d&#8217;acc√®s est transform√© en chemin absolu.</p>
</li>
<li>
<p>La liste homog√©n√©is√©e est affich√©e √† l&#8217;√©cran.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">üí¨</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Rep√®re</span> Chemin relatif, absolu ou __dirname ?</div>
<div class="paragraph">
<p>


Les fichiers pass√©s en argument peuvent √™tre un m√©lange de chemins absolus
et de chemins relatifs, qui se normalisent avec la fonction <code>path.resolve()</code>.


La base √† consid√©rer est le <em>r√©pertoire courant</em>, l√† o√π le programme est ex√©cut√©,
c&#8217;est-√†-dire la valeur de <code>process.cwd()</code>
(<a href="../chapter-04/index.html#path">chapitre&#160;4</a>).</p>
</div>
<div class="paragraph">
<p><code>__dirname</code> est une base √† utiliser lorsqu&#8217;un chemin est relatif au code source.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>La saisie des chemins se simplifie en utilisant deux m√©canismes&#160;: l'<em>expansion</em>
et le <em>globbing</em>.
Le module&#160;<code>npm</code> <em>glob</em> (<span class="URL"><a href="https://npmjs.com/glob" class="bare">npmjs.com/glob</a></span>) fait tr√®s bien ce travail,
mais nous allons nous baser sur <em>globby</em> (<span class="URL"><a href="https://npmjs.com/globby" class="bare">npmjs.com/globby</a></span>) √† la place.


Il g√®re les <a href="../chapter-03/index.html#promise">promesses</a> et je le trouve
plus simple d&#8217;utilisation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node files/glob.js '../package-*.json'
['‚Ä¶/chapter-08/package.json', '‚Ä¶/package-lock.json']</pre>
</div>
</div>
<div class="paragraph">
<p>Dans cet exemple, nous partons √† la recherche de tous les fichiers pr√©fix√©s
par <code>package-</code> et termin√©s par <code>.json</code>.
Cette intention est exprim√©e par un seul argument qui contient le caract√®re
de <em>globbing</em>&#160;(<code>*</code>).</p>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">files/glob.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> glob <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'globby'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>resolve<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> patterns <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">resolveFiles</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">files</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> files<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">file</span> <span class="token operator">=></span> <span class="token function">resolve</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">glob</span><span class="token punctuation">(</span>patterns<span class="token punctuation">)</span>                                <span class="token comment">// <b class="conum">(1)</b></span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">files</span> <span class="token operator">=></span> <span class="token function">resolveFiles</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">)</span>         <span class="token comment">// <b class="conum">(2)</b></span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">files</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// <b class="conum">(3)</b></span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Le module <em>globby</em> accepte un ou plusieurs motif(s)&#160;‚Äì ici nous n&#8217;en utilisons qu&#8217;un.</p>
</li>
<li>
<p>Nous transformons les fichiers identifi√©s en chemins absolus.</p>
</li>
<li>
<p>Pour ensuite les afficher dans le terminal.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>L&#8217;expansion est caract√©ris√©e par l&#8217;utilisation des accolades.
Les valeurs sont s√©par√©es par des virgules, qui signifient <em>ou</em>.
Les deux syntaxes se combinent ici pour r√©cup√©rer les fichiers suffix√©s par
<code>.adoc</code> ou par&#160;<code>.html</code>&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node files/glob.js '../*.{adoc,html}'
['‚Ä¶/chapter-08/index.adoc']</pre>
</div>
</div>
<div class="paragraph">
<p>Enfin, l&#8217;utilisation de la double-√©toile&#160;(<code>**</code>) signifie <em>dans tous les r√©pertoires</em>.
Nous r√©cup√©rons ainsi tous les fichiers&#160;<code>.js</code> contenus dans ce r√©pertoire
et les sous-r√©pertoires&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node files/glob.js '**/*.js'
['‚Ä¶/chapter-08/examples/hello.js', ‚Ä¶]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="streaming">4.3. Utiliser les flux de donn√©es (stdin, stdout et stderr)</h3>
<div class="paragraph">
<p>Cette section compl√®te notre d√©couverte du
<a href="../chapter-04/index.html#stream">module <code>stream</code></a>
(<a href="../chapter-04/index.html">chapitre&#160;4</a>).
Mon intention est de vous aiguiller dans la conception d&#8217;applications
en ligne de commande qui acceptent des flux de donn√©es, en entr√©e
comme en sortie.
La ligne de commande se pr√™te tout particuli√®rement au <em>streaming</em> et
nos applications gagnent √† fonctionner longtemps en consommant le
moins de ressources possibles.</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>cat blah.txt
blah blah
<span data-bash-subs="$"></span>cat blah.txt | node streaming/intro.js
BLAH BLAH</pre>
</div>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">streaming/intro.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> getStdin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'get-stdin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// <b class="conum">(1)</b></span>

<span class="token keyword">const</span> <span class="token function-variable function">uppercase</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token operator">=></span> text<span class="token punctuation">.</span><span class="token function">toLocaleUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">log</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token operator">=></span> process<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">getStdin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>uppercase<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment">// <b class="conum">(2)</b></span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Le module&#160;<code>npm</code> <em>get-stdin</em> (<span class="URL"><a href="https://npmjs.com/get-stdin" class="bare">npmjs.com/get-stdin</a></span>) est pratique pour un flux d&#8217;entr√©e √† petit volume.</p>
</li>
<li>
<p>Il retourne une promesse quand il a termin√© de lire le flux d&#8217;entr√©e.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>J&#8217;aime bien proposer une alternative √† l&#8217;entr√©e standard, en utilisant
les <strong>arguments lorsqu&#8217;il y a un nombre ind√©fini d&#8217;√©l√©ments</strong> √† lire.
Je trouve que cette proposition √©vite de renoncer √† un outil
dans un contexte o√π il est impossible de configurer un flux d&#8217;entr√©e.</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>cat blah.txt | node streaming/intro-fallback.js
BLAH BLAH
<span data-bash-subs="$"></span>node streaming/intro-fallback.js $(< blah.txt)
BLAH BLAH</pre>
</div>
</div>
<div class="paragraph">
<p>La strat√©gie consiste √† utiliser l&#8217;entr√©e standard quand on d√©tecte une absence
d&#8217;arguments et, sinon, d&#8217;utiliser ces derniers.</p>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">streaming/intro-fallback.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> getStdin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'get-stdin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> input <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// <b class="conum">(1)</b></span>

<span class="token keyword">const</span> <span class="token function-variable function">uppercase</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token operator">=></span> text<span class="token punctuation">.</span><span class="token function">toLocaleUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">log</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token operator">=></span> process<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>input<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                 <span class="token comment">// <b class="conum">(2)</b></span>
  <span class="token function">getStdin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>uppercase<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token punctuation">{</span>                                    <span class="token comment">// <b class="conum">(3)</b></span>
  Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>uppercase<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Nous r√©cup√©rons les arguments du script.</p>
</li>
<li>
<p>Chaque mot (s√©par√© par un espace) est consid√©r√© comme un argument&#160;‚Äì s&#8217;il n&#8217;y en a pas, nous pouvons utiliser l&#8217;entr√©e standard.</p>
</li>
<li>
<p>Sinon nous rassemblons les mots en une seule cha√Æne de caract√®res.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Notons au passage l&#8217;utilisation de <code>Promise.resolve()</code>
(<a href="../chapter-03/index.html#promise">chapitre&#160;3</a>) pour transformer deux
sources de donn√©es de mani√®re identique.</p>
</div>
<div class="paragraph">
<p>Les <a href="#args.options">options</a> sont adapt√©es pour <strong>indiquer l&#8217;emplacement d&#8217;une ressource</strong>.
La m√©thode <code>fs.createReadStream</code> (<a href="../chapter-04/index.html#fs">chapitre&#160;4</a>)
lit les donn√©es d&#8217;une ressource de la m√™me mani√®re que nous consommons
l&#8217;entr√©e standard.</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node streaming/input.js --input blah.txt
BLAH BLAH</pre>
</div>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">streaming/input.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> minimist <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'minimist'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> getStream <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'get-stream'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// <b class="conum">(1)</b></span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>createReadStream<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>input<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">minimist</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">uppercase</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token operator">=></span> text<span class="token punctuation">.</span><span class="token function">toLocaleUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">log</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token operator">=></span> process<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>input<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">getStream</span><span class="token punctuation">(</span><span class="token function">createReadStream</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment">// <b class="conum">(2)</b></span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>uppercase<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Le module&#160;<code>npm</code> <em>get-stream</em> (<span class="URL"><a href="https://npmjs.com/get-stream" class="bare">npmjs.com/get-stream</a></span>) est similaire √† <em>get-stdin</em> et fonctionne avec tout flux de lecture.</p>
</li>
<li>
<p>Il r√©sout une promesse d√®s qu&#8217;il a termin√© de consommer le flux de lecture.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>L√† aussi, je trouve int√©ressant de proposer une approche double, en acceptant
un chemin de fichier en option et son contenu via l&#8217;entr√©e standard&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node streaming/input-fallback.js --input blah.txt
BLAH BLAH
<span data-bash-subs="$"></span>cat blah.txt | node streaming/input-fallback.js
BLAH BLAH</pre>
</div>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">streaming/input-fallback.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> minimist <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'minimist'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> through <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'through2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>createReadStream<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>input<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">minimist</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">uppercase</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token operator">=></span> text<span class="token punctuation">.</span><span class="token function">toLocaleUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> transform <span class="token operator">=</span> <span class="token function">through</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// <b class="conum">(1)</b></span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">uppercase</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// <b class="conum">(2)</b></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>input<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  process<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>transform<span class="token punctuation">)</span>             <span class="token comment">// <b class="conum">(3)</b></span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>stdout<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token function">createReadStream</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>transform<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>stdout<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Le module&#160;<code>npm</code> <em>through2</em> (<span class="URL"><a href="https://npmjs.com/through2" class="bare">npmjs.com/through2</a></span>) s&#8217;int√®gre √† un flux en ex√©cutant une fonction √† chaque arriv√©e de donn√©es.</p>
</li>
<li>
<p>Nous transformons la cha√Æne de caract√®res entrante dans le flux de sortie.</p>
</li>
<li>
<p>Ce flux de sortie est lui-m√™me redirig√© vers la sortie standard du programme.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Ce qui est int√©ressant avec cette approche est qu&#8217;elle nous apprend
√† intervenir nous-m√™me sur un flux sans avoir √† en conna√Ætre les tenants et aboutissant.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">üí°</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Alternative</span> Sp√©cifier l&#8217;entr√©e ou la sortie standard en tant qu&#8217;option</div>
<div class="paragraph">
<p>Certains programmes Linux utilisent le caract√®re&#160;<code>-</code> pour symboliser l&#8217;entr√©e
ou la sortie standard, selon l&#8217;intention de l&#8217;option.</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>cat blah.txt | node streaming/input-fallback.js --input ##-##</pre>
</div>
</div>
<div class="paragraph">
<p>Cette notation est utile quand vous voulez rendre l&#8217;entr√©e standard
optionnelle et explicite.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Le pr√©c√©dent exemple nous permet aussi de nous lib√©rer des modules
<em>get-stdin</em> et <em>get-stream</em>.
Ces derniers obligent quand m√™me √† <em>charger tout le contenu</em> du flux entrant
en m√©moire.
En travaillant directement sur les flux avec le module <em>through2</em>,
les transformations sont faites en temps r√©el, au fur et √† mesure o√π les donn√©es
sont lues, bloc par&#160;bloc.</p>
</div>
<div class="paragraph">
<p>Nous sommes d√©sormais en mesure de travailler avec des fichiers au m√™me
titre qu&#8217;avec l&#8217;entr√©e et la sortie standards.</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>cat blah.txt | node streaming/pipe-in.js
BLAH BLAH</pre>
</div>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">streaming/pipe-in.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> minimist <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'minimist'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> through <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'through2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>createReadStream<span class="token punctuation">:</span>read<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>i<span class="token punctuation">:</span>input<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">minimist</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> source <span class="token operator">=</span> input <span class="token operator">?</span> <span class="token function">read</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span> <span class="token punctuation">:</span> process<span class="token punctuation">.</span>stdin<span class="token punctuation">;</span>   <span class="token comment">// <b class="conum">(1)</b></span>
<span class="token keyword">const</span> <span class="token function-variable function">uppercase</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token operator">=></span> text<span class="token punctuation">.</span><span class="token function">toLocaleUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> transform <span class="token operator">=</span> <span class="token function">through</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">uppercase</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

source<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>transform<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>stdout<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// <b class="conum">(2)</b></span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>La source de donn√©es provient soit du flux de lecture de fichier, soit de l&#8217;entr√©e standard.</p>
</li>
<li>
<p>Le travail sur le contenu est ainsi factoris√©, avec un fonctionnement identique peu importe la source de donn√©es.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>L&#8217;utilisation d&#8217;un m√™me concept pour lire et pour √©crire des donn√©es
simplifie notre code tout en offrant des performances optimales.</p>
</div>
<div class="paragraph">
<p>Il ne reste plus grand-chose √† faire pour appliquer cet effort √† la sortie du
programme, pour √©crire en continu dans un fichier ou bien vers la sortie standard.</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>node streaming/pipe-out.js -i blah.txt
BLAH BLAH
<span data-bash-subs="$"></span>node streaming/pipe-out.js -i blah.txt -o debug.txt
<span data-bash-subs="$"></span>cat blah.txt | node streaming/pipe-out.js -o debug.txt</pre>
</div>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">streaming/pipe-out.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> minimist <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'minimist'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> through <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'through2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>createReadStream<span class="token punctuation">:</span>read<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>createWriteStream<span class="token punctuation">:</span>write<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>i<span class="token punctuation">:</span>input<span class="token punctuation">,</span>o<span class="token punctuation">:</span>output<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">minimist</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> source <span class="token operator">=</span> input <span class="token operator">?</span> <span class="token function">read</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span> <span class="token punctuation">:</span> process<span class="token punctuation">.</span>stdin<span class="token punctuation">;</span>
<span class="token keyword">const</span> dest <span class="token operator">=</span> output <span class="token operator">?</span> <span class="token function">write</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span> <span class="token punctuation">:</span> process<span class="token punctuation">.</span>stdout<span class="token punctuation">;</span> <span class="token comment">// <b class="conum">(1)</b></span>
<span class="token keyword">const</span> <span class="token function-variable function">uppercase</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token operator">=></span> text<span class="token punctuation">.</span><span class="token function">toLocaleUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> transform <span class="token operator">=</span> <span class="token function">through</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">uppercase</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

source<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>transform<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>dest<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// <b class="conum">(2)</b></span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>La destination des donn√©es est choisie par un m√©canisme similaire √† celui pour la source de donn√©es.</p>
</li>
<li>
<p>Le processus de traitement est d√©sormais indiff√©rent √† la source et √† la destination des donn√©es.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>En quelques exemples, nous sommes pass√©¬∑e¬∑s d&#8217;une utilisation potentiellement
√©nergivore √† un traitement en continu, plus doux pour les ressources syst√®me
et int√©grable √† tous les outils en ligne de commande qui lisent depuis
l&#8217;entr√©e standard ou √©crivent vers la sortie standard.</p>
</div>
</div>
<div class="sect2">
<h3 id="autocomplete">4.4. Activer l&#8217;autocompl√©tion des commandes</h3>
<div class="paragraph">
<p>Faire en sorte que les options possibles s&#8217;affichent √† l&#8217;√©cran sur une simple
pression de la touche <kbd>Tab</kbd> est la cerise sur le g√¢teau&#160;!
Cette technique facilite la d√©couverte d&#8217;une application par t√¢tonnement.
Elle acc√©l√®re et r√©duit le risque d&#8217;erreurs durant la saisie des commandes.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">‚ö†Ô∏è</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Compatibilit√©</span> Incertitudes de fonctionnement sous Windows</div>
<div class="paragraph">
<p>Cette section n&#8217;a pas √©t√© test√©e avec les syst√®mes d&#8217;exploitation Windows.
Les commandes r√©f√©renc√©es ci-apr√®s ne fonctionnent peut-√™tre pas
sous ses syst√®mes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Pr√©requis pour installer les ex√©cutables de ce chapitre</div>
<div class="content">
<pre><span data-bash-subs="$"></span>npm install --global $(nodebook dir chapter-08 --root)</pre>
</div>
</div>
<div class="paragraph">
<p>Le m√©canisme d&#8217;autocompl√©tion est fourni par l&#8217;environnement d&#8217;ex√©cution
de notre terminal, le <em>shell</em>.
Sous Linux et macOS, il s&#8217;agit de <em>bash</em>, de <em>zsh</em> ou plus rarement, de <em>fish</em>.
Il &#8220;suffit&#8221; donc d&#8217;interconnecter notre programme ex√©cutable pour qu&#8217;il fournisse
les r√©sultats de compl√©tion au m√©canisme de notre <em>shell</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>eval $(nodebook.ch08.autocomplete --completion)  <span data-bash-conum="1"></span>
<span data-bash-subs="$"></span>nodebook.ch08.autocomplete <kbd>Tab</kbd>
--help coucou</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>L&#8217;option <code>--completion</code> est une option sp√©ciale comprise par le module&#160;<code>npm</code> utilis√© dans cet exemple.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Le m√©canisme de compl√©tion est fourni par le module&#160;<code>npm</code> <em>omelette</em>
(<span class="URL"><a href="https://npmjs.com/omelette" class="bare">npmjs.com/omelette</a></span>).
Il est totalement ind√©pendant de notre outillage d'<a href="#args">arguments et d&#8217;options</a>.
Je le trouve l√©ger et rapide √† prendre en main.</p>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">autocomplete/intro.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node

<span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> omelette <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'omelette'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> args <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'--help'</span><span class="token punctuation">,</span><span class="token string">'coucou'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                    <span class="token comment">// <b class="conum">(2)</b></span>

omelette<span class="token template-string"><span class="token string">`nodebook.ch08.autocomplete </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>options<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// <b class="conum">(1)</b></span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>                                      <span class="token comment">// <b class="conum">(3)</b></span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>D√©claration du nom de programme et des options et arguments √† sugg√©rer.</p>
</li>
<li>
<p>Ces deux options et arguments sont utilis√©s pour la compl√©tion du programme.</p>
</li>
<li>
<p>Cette partie est atteinte seulement quand le programme est ex√©cut√©.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>L&#8217;autocompl√©tion peut aller jusqu&#8217;√† sugg√©rer les valeurs associ√©es aux options
et arguments de notre programme.</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>eval $(nodebook.ch08.omelette --completion)
<span data-bash-subs="$"></span>nodebook.ch08.omelette <kbd>Tab</kbd>
--timezone now

<span data-bash-subs="$"></span>nodebook.ch08.omelette --timezone<kbd>Tab</kbd><kbd>Tab</kbd>
Africa/Abidjan                  Asia/Almaty
Africa/Accra                    Asia/Amman
Africa/Addis_Ababa              Asia/Anadyr
‚Ä¶</pre>
</div>
</div>
<div class="paragraph">
<p>Pour cela, le module <em>omelette</em> accepte un arbre de d√©clarations afin de
comprendre quoi sugg√©rer en fonction de ce qui a √©t√© pr√©c√©demment saisi&#160;:</p>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">autocomplete/omelette.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node

<span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> omelette <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'omelette'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'minimist'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> timezones <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'tz-ids'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">omelette</span><span class="token punctuation">(</span><span class="token string">'nodebook.ch08.omelette'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">tree</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                     <span class="token comment">// <b class="conum">(1)</b></span>
    <span class="token string">'--timezone'</span><span class="token punctuation">:</span> timezones<span class="token punctuation">,</span>  <span class="token comment">// <b class="conum">(2)</b></span>
    <span class="token string">'now'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>timezone<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>L&#8217;arbre est un objet ECMAScript.</p>
</li>
<li>
<p>L&#8217;option <code>--timezone</code> sugg√®re la liste compl√®te des fuseaux horaires.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>C&#8217;est tr√®s pratique quand on ne sait pas par o√π commencer et quand on ne
conna√Æt pas la liste exhaustive des propositions.</p>
</div>
<div class="paragraph">
<p>Nous avons parl√© du module&#160;<code>npm</code> <em>yargs</em> dans la section sur
l'<a href="#application">utilisation d&#8217;un framework</a>.
Il embarque un module d&#8217;autocompl√©tion.
Si vous utilisez d√©j√† ce module, l&#8217;autocompl√©tion revient √† ajouter une ligne
de code √† notre programme.
Elle est un peu plus basique et demande plus de travail pour
arriver √† la qualit√© des r√©sultats du module <em>omelette</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>eval $(nodebook.ch08.yargs completion)
<span data-bash-subs="$"></span>nodebook.ch08.yargs -<kbd>Tab</kbd>
--help      --timezone  --version</pre>
</div>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">autocomplete/yargs.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node

<span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'yargs'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'timezone'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">completion</span><span class="token punctuation">(</span><span class="token punctuation">)</span>           <span class="token comment">// <b class="conum">(1)</b></span>
  <span class="token punctuation">.</span>argv<span class="token punctuation">;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Cette m√©thode ajoute la compr√©hension de l&#8217;argument <code>completion</code> pour s&#8217;int√©grer avec le <em>shell</em> de notre syst√®me d&#8217;exploitation.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">üí°</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Pratique</span> Rendre l&#8217;autocompl√©tion permanente</div>
<div class="paragraph">
<p>Les commandes <code>eval $(&#8230;&#8203;)</code> des pr√©c√©dents exemples sont √† consigner
dans le fichier de configuration de votre shell,
c&#8217;est-√†-dire dans le fichier <code>~/.bashrc</code> pour <em>bash</em>, <code>~/.zshrc</code> pour <em>zsh</em>
et <code>~/.config/fish/config.fish</code> pour&#160;<em>fish</em>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="packaging">4.5. Rendre le programme ind√©pendant de&#160;Node</h3>
<div class="paragraph">
<p>Nos programmes ex√©cutables souffrent d&#8217;un d√©faut&#160;: ils imposent
l&#8217;installation pr√©alable de Node pour fonctionner.
Ce n&#8217;est pas grave pour une machine de dev√©loppement ou sur une machine
de production car nous sommes √† m√™me de contr√¥ler l&#8217;environnement d&#8217;ex√©cution.</p>
</div>
<div class="paragraph">
<p>La premi√®re solution consiste √† empaqueter notre application avec le module
npm <em>pkg</em> (<span class="URL"><a href="https://npmjs.com/pkg" class="bare">npmjs.com/pkg</a></span>).
Cet ex√©cutable embarque notre code, les d√©pendances npm du projet
et la version de Node de notre choix sous la forme d&#8217;un unique fichier ex√©cutable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>npm install --global pkg
<span data-bash-subs="$"></span>pkg --targets latest-linux,latest-macos,latest-win ..
<span data-bash-subs="$"></span>./nodebook
Il est 22h49.</pre>
</div>
</div>
<div class="paragraph">
<p>Dans ce cas, nous avons empaquet√© une m√™me application √† la fois pour les
syst√®mes d&#8217;exploitation Windows, Linux et macOS.
Nous pourrions faire de m√™me pour des ordinateurs l√©gers de type Raspberry&#160;Pi.</p>
</div>
<div class="paragraph">
<p>Une solution alternative consiste √† utiliser le logiciel <em>Docker</em>
(<span class="URL"><a href="https://docker.com/community-edition" class="bare">docker.com/community-edition</a></span>).
Ce syst√®me cr√©e une base d&#8217;environnement r√©utilisable (le conteneur) √† partir
d&#8217;une recette d&#8217;installation (l&#8217;image).
Une m√™me image applicative se r√©plique √† l&#8217;infini, sans avoir
connaissance de notre syst√®me d&#8217;exploitation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre><span data-bash-subs="$"></span>docker build -t nodebook/chapter-08 ..
<span data-bash-subs="$"></span>docker run -ti --rm nodebook/chapter-08
Bienvenue dans le chapitre 8 üòä</pre>
</div>
</div>
<div class="paragraph">
<p>Une image se construit depuis un fichier <code>Dockerfile</code> avec la commande <code>docker build</code>.
Elle s&#8217;ex√©cute sous forme d&#8217;un conteneur jetable avec la commande <code>docker run</code>.
La recette d&#8217;installation est une suite d&#8217;instructions jou√©es les unes √† la suite
des autres&#160;:</p>
</div>
<div class="listingblock prismjs highlight-prismjs">
<div class="title">Dockerfile</div>
<div class="content">
<pre class="highlight"><code class="language-dockerfile" data-lang="dockerfile"><span class="token keyword">FROM</span> node<span class="token punctuation">:</span>alpine

<span class="token keyword">WORKDIR</span> /nodebook
<span class="token keyword">ADD</span> ./package.json ./package<span class="token punctuation">-</span>lock.json ./
<span class="token keyword">RUN</span> npm ci
<span class="token keyword">ADD</span> ./examples ./examples

<span class="token keyword">CMD</span> <span class="token punctuation">[</span><span class="token string">"node"</span><span class="token punctuation">,</span> <span class="token string">"examples/hello.js"</span><span class="token punctuation">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Je recommande de doubler le fichier <code>Dockerfile</code> d&#8217;un fichier <code>.dockerignore</code>.
Il suit les m√™mes r√®gles de fonctionnement qu&#8217;un fichier <code>.gitignore</code>.
Il exclut une liste d√©finie de fichiers du contexte d&#8217;ex√©cution et d&#8217;une possible
copie vers l&#8217;image Docker.</p>
</div>
<div class="listingblock">
<div class="title">.dockerignore</div>
<div class="content">
<pre class="highlight"><code>node_modules</code></pre>
</div>
</div>
<div class="paragraph">
<p>Une fois construite, une image se distribue sous forme de fichier transf√©rable,
sur le registre public <span class="URL"><a href="https://hub.docker.com" class="bare">hub.docker.com</a></span> ou sur tout autre
registre priv√©&#160;‚Äì dont ceux fournis par certains
<a href="../chapter-06/index.html#deploy.docker">h√©bergeurs cloud</a>
(<a href="../chapter-06/index.html">chapitre&#160;6</a>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">üí¨</div>
</td>
<td class="content">
<div class="title"><span class="RemarquePreTitre">Alternative</span> Windows sous Docker</div>
<div class="paragraph">
<p>Microsoft met √† disposition des images de Windows Server pour Docker √† l&#8217;adresse suivante&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><span class="URL"><a href="https://hub.docker.com/r/microsoft/windowsservercore/" class="bare">hub.docker.com/r/microsoft/windowsservercore/</a></span>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Nous pouvons tester une application Node dans un environnement Windows
sans quitter notre syst√®me d&#8217;exploitation Linux ou macOS.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conclusion">5. Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>L&#8217;√©criture d&#8217;un ex√©cutable en ligne de commande est un
<strong>exercice proche de celui d&#8217;une application web</strong> √©crite avec&#160;Node.</p>
</div>
<div class="paragraph">
<p>Nous avons vu que l&#8217;enjeu majeur tient dans la <strong>modularisation du code applicatif</strong>
et dans la <strong>cr√©ation d&#8217;une interface coh√©rente</strong>, informative et document√©e.</p>
</div>
<div class="paragraph">
<p><a href="#args"><strong>Les options et les arguments</strong></a> sont essentiels √† ma√Ætriser et
√† <a href="#doc">documenter</a> car ils servent de pierre angulaire pour cr√©er un pont
avec les utilisateurs.</p>
</div>
<div class="paragraph">
<p>Ils deviennent encore plus puissants une fois combin√©s avec
la <a href="#files">gestion des chemins d&#8217;acc√®s</a> ainsi qu&#8217;avec
les <a href="#streaming">flux d&#8217;entr√©e et de sortie</a>.</p>
</div>
</div>
</div>
</div>
<section class="next">
  <a href="#top">Haut de page</a> ou
  <a href="https://oncletom.io/node.js/#apprendre-node-js-en-ligne" class="read-more">retour au sommaire</a>.
</section>
</body>
</html>